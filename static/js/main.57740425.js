/*! For license information please see main.57740425.js.LICENSE.txt */
(function(){var __webpack_modules__={4309:function(e,t,n){"use strict";n.r(t),n.d(t,{userAgent:function(){return r}});var r=""},6075:function(e,t,n){"use strict";n.r(t),n.d(t,{now:function(){return a},timing:function(){return i}});var r=n.g.process.hrtime(),a=function(){var e=n.g.process.hrtime(r);return e[0]+e[1]/1e9},i={navigationStart:Date.now()}},5842:function(e,t,n){"use strict";var r=n(886),a=r.Reader,i=r.Writer,o=r.util,s=r.roots.default||(r.roots.default={});s.tensorflow=function(){var e={};return e.magenta=function(){var e={};return e.NoteSequence=function(){function e(e){if(this.timeSignatures=[],this.keySignatures=[],this.tempos=[],this.notes=[],this.pitchBends=[],this.controlChanges=[],this.partInfos=[],this.textAnnotations=[],this.sectionAnnotations=[],this.sectionGroups=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.id="",e.prototype.filename="",e.prototype.referenceNumber=o.Long?o.Long.fromBits(0,0,!1):0,e.prototype.collectionName="",e.prototype.ticksPerQuarter=0,e.prototype.timeSignatures=o.emptyArray,e.prototype.keySignatures=o.emptyArray,e.prototype.tempos=o.emptyArray,e.prototype.notes=o.emptyArray,e.prototype.totalTime=0,e.prototype.totalQuantizedSteps=o.Long?o.Long.fromBits(0,0,!1):0,e.prototype.pitchBends=o.emptyArray,e.prototype.controlChanges=o.emptyArray,e.prototype.partInfos=o.emptyArray,e.prototype.sourceInfo=null,e.prototype.textAnnotations=o.emptyArray,e.prototype.sectionAnnotations=o.emptyArray,e.prototype.sectionGroups=o.emptyArray,e.prototype.quantizationInfo=null,e.prototype.subsequenceInfo=null,e.prototype.sequenceMetadata=null,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=i.create()),null!=e.id&&e.hasOwnProperty("id")&&t.uint32(10).string(e.id),null!=e.filename&&e.hasOwnProperty("filename")&&t.uint32(18).string(e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&t.uint32(26).string(e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&t.uint32(32).int32(e.ticksPerQuarter),null!=e.timeSignatures&&e.timeSignatures.length)for(var n=0;n<e.timeSignatures.length;++n)s.tensorflow.magenta.NoteSequence.TimeSignature.encode(e.timeSignatures[n],t.uint32(42).fork()).ldelim();if(null!=e.keySignatures&&e.keySignatures.length)for(n=0;n<e.keySignatures.length;++n)s.tensorflow.magenta.NoteSequence.KeySignature.encode(e.keySignatures[n],t.uint32(50).fork()).ldelim();if(null!=e.tempos&&e.tempos.length)for(n=0;n<e.tempos.length;++n)s.tensorflow.magenta.NoteSequence.Tempo.encode(e.tempos[n],t.uint32(58).fork()).ldelim();if(null!=e.notes&&e.notes.length)for(n=0;n<e.notes.length;++n)s.tensorflow.magenta.NoteSequence.Note.encode(e.notes[n],t.uint32(66).fork()).ldelim();if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&t.uint32(73).double(e.totalTime),null!=e.pitchBends&&e.pitchBends.length)for(n=0;n<e.pitchBends.length;++n)s.tensorflow.magenta.NoteSequence.PitchBend.encode(e.pitchBends[n],t.uint32(82).fork()).ldelim();if(null!=e.controlChanges&&e.controlChanges.length)for(n=0;n<e.controlChanges.length;++n)s.tensorflow.magenta.NoteSequence.ControlChange.encode(e.controlChanges[n],t.uint32(90).fork()).ldelim();if(null!=e.partInfos&&e.partInfos.length)for(n=0;n<e.partInfos.length;++n)s.tensorflow.magenta.NoteSequence.PartInfo.encode(e.partInfos[n],t.uint32(98).fork()).ldelim();if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&s.tensorflow.magenta.NoteSequence.SourceInfo.encode(e.sourceInfo,t.uint32(106).fork()).ldelim(),null!=e.textAnnotations&&e.textAnnotations.length)for(n=0;n<e.textAnnotations.length;++n)s.tensorflow.magenta.NoteSequence.TextAnnotation.encode(e.textAnnotations[n],t.uint32(114).fork()).ldelim();if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&s.tensorflow.magenta.NoteSequence.QuantizationInfo.encode(e.quantizationInfo,t.uint32(122).fork()).ldelim(),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&t.uint32(128).int64(e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&s.tensorflow.magenta.NoteSequence.SubsequenceInfo.encode(e.subsequenceInfo,t.uint32(138).fork()).ldelim(),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&t.uint32(144).int64(e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&s.tensorflow.magenta.SequenceMetadata.encode(e.sequenceMetadata,t.uint32(154).fork()).ldelim(),null!=e.sectionAnnotations&&e.sectionAnnotations.length)for(n=0;n<e.sectionAnnotations.length;++n)s.tensorflow.magenta.NoteSequence.SectionAnnotation.encode(e.sectionAnnotations[n],t.uint32(162).fork()).ldelim();if(null!=e.sectionGroups&&e.sectionGroups.length)for(n=0;n<e.sectionGroups.length;++n)s.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroups[n],t.uint32(170).fork()).ldelim();return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.id=e.string();break;case 2:r.filename=e.string();break;case 18:r.referenceNumber=o.Long?e.int64().toNumber():e.int64();break;case 3:r.collectionName=e.string();break;case 4:r.ticksPerQuarter=e.int32();break;case 5:r.timeSignatures&&r.timeSignatures.length||(r.timeSignatures=[]),r.timeSignatures.push(s.tensorflow.magenta.NoteSequence.TimeSignature.decode(e,e.uint32()));break;case 6:r.keySignatures&&r.keySignatures.length||(r.keySignatures=[]),r.keySignatures.push(s.tensorflow.magenta.NoteSequence.KeySignature.decode(e,e.uint32()));break;case 7:r.tempos&&r.tempos.length||(r.tempos=[]),r.tempos.push(s.tensorflow.magenta.NoteSequence.Tempo.decode(e,e.uint32()));break;case 8:r.notes&&r.notes.length||(r.notes=[]),r.notes.push(s.tensorflow.magenta.NoteSequence.Note.decode(e,e.uint32()));break;case 9:r.totalTime=e.double();break;case 16:r.totalQuantizedSteps=o.Long?e.int64().toNumber():e.int64();break;case 10:r.pitchBends&&r.pitchBends.length||(r.pitchBends=[]),r.pitchBends.push(s.tensorflow.magenta.NoteSequence.PitchBend.decode(e,e.uint32()));break;case 11:r.controlChanges&&r.controlChanges.length||(r.controlChanges=[]),r.controlChanges.push(s.tensorflow.magenta.NoteSequence.ControlChange.decode(e,e.uint32()));break;case 12:r.partInfos&&r.partInfos.length||(r.partInfos=[]),r.partInfos.push(s.tensorflow.magenta.NoteSequence.PartInfo.decode(e,e.uint32()));break;case 13:r.sourceInfo=s.tensorflow.magenta.NoteSequence.SourceInfo.decode(e,e.uint32());break;case 14:r.textAnnotations&&r.textAnnotations.length||(r.textAnnotations=[]),r.textAnnotations.push(s.tensorflow.magenta.NoteSequence.TextAnnotation.decode(e,e.uint32()));break;case 20:r.sectionAnnotations&&r.sectionAnnotations.length||(r.sectionAnnotations=[]),r.sectionAnnotations.push(s.tensorflow.magenta.NoteSequence.SectionAnnotation.decode(e,e.uint32()));break;case 21:r.sectionGroups&&r.sectionGroups.length||(r.sectionGroups=[]),r.sectionGroups.push(s.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32()));break;case 15:r.quantizationInfo=s.tensorflow.magenta.NoteSequence.QuantizationInfo.decode(e,e.uint32());break;case 17:r.subsequenceInfo=s.tensorflow.magenta.NoteSequence.SubsequenceInfo.decode(e,e.uint32());break;case 19:r.sequenceMetadata=s.tensorflow.magenta.SequenceMetadata.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";if(null!=e.id&&e.hasOwnProperty("id")&&!o.isString(e.id))return"id: string expected";if(null!=e.filename&&e.hasOwnProperty("filename")&&!o.isString(e.filename))return"filename: string expected";if(null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&!o.isInteger(e.referenceNumber)&&!(e.referenceNumber&&o.isInteger(e.referenceNumber.low)&&o.isInteger(e.referenceNumber.high)))return"referenceNumber: integer|Long expected";if(null!=e.collectionName&&e.hasOwnProperty("collectionName")&&!o.isString(e.collectionName))return"collectionName: string expected";if(null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&!o.isInteger(e.ticksPerQuarter))return"ticksPerQuarter: integer expected";if(null!=e.timeSignatures&&e.hasOwnProperty("timeSignatures")){if(!Array.isArray(e.timeSignatures))return"timeSignatures: array expected";for(var t=0;t<e.timeSignatures.length;++t){if(n=s.tensorflow.magenta.NoteSequence.TimeSignature.verify(e.timeSignatures[t]))return"timeSignatures."+n}}if(null!=e.keySignatures&&e.hasOwnProperty("keySignatures")){if(!Array.isArray(e.keySignatures))return"keySignatures: array expected";for(t=0;t<e.keySignatures.length;++t){if(n=s.tensorflow.magenta.NoteSequence.KeySignature.verify(e.keySignatures[t]))return"keySignatures."+n}}if(null!=e.tempos&&e.hasOwnProperty("tempos")){if(!Array.isArray(e.tempos))return"tempos: array expected";for(t=0;t<e.tempos.length;++t){if(n=s.tensorflow.magenta.NoteSequence.Tempo.verify(e.tempos[t]))return"tempos."+n}}if(null!=e.notes&&e.hasOwnProperty("notes")){if(!Array.isArray(e.notes))return"notes: array expected";for(t=0;t<e.notes.length;++t){if(n=s.tensorflow.magenta.NoteSequence.Note.verify(e.notes[t]))return"notes."+n}}if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&"number"!==typeof e.totalTime)return"totalTime: number expected";if(null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&!o.isInteger(e.totalQuantizedSteps)&&!(e.totalQuantizedSteps&&o.isInteger(e.totalQuantizedSteps.low)&&o.isInteger(e.totalQuantizedSteps.high)))return"totalQuantizedSteps: integer|Long expected";if(null!=e.pitchBends&&e.hasOwnProperty("pitchBends")){if(!Array.isArray(e.pitchBends))return"pitchBends: array expected";for(t=0;t<e.pitchBends.length;++t){if(n=s.tensorflow.magenta.NoteSequence.PitchBend.verify(e.pitchBends[t]))return"pitchBends."+n}}if(null!=e.controlChanges&&e.hasOwnProperty("controlChanges")){if(!Array.isArray(e.controlChanges))return"controlChanges: array expected";for(t=0;t<e.controlChanges.length;++t){if(n=s.tensorflow.magenta.NoteSequence.ControlChange.verify(e.controlChanges[t]))return"controlChanges."+n}}if(null!=e.partInfos&&e.hasOwnProperty("partInfos")){if(!Array.isArray(e.partInfos))return"partInfos: array expected";for(t=0;t<e.partInfos.length;++t){if(n=s.tensorflow.magenta.NoteSequence.PartInfo.verify(e.partInfos[t]))return"partInfos."+n}}if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n=s.tensorflow.magenta.NoteSequence.SourceInfo.verify(e.sourceInfo)))return"sourceInfo."+n;if(null!=e.textAnnotations&&e.hasOwnProperty("textAnnotations")){if(!Array.isArray(e.textAnnotations))return"textAnnotations: array expected";for(t=0;t<e.textAnnotations.length;++t){if(n=s.tensorflow.magenta.NoteSequence.TextAnnotation.verify(e.textAnnotations[t]))return"textAnnotations."+n}}if(null!=e.sectionAnnotations&&e.hasOwnProperty("sectionAnnotations")){if(!Array.isArray(e.sectionAnnotations))return"sectionAnnotations: array expected";for(t=0;t<e.sectionAnnotations.length;++t){if(n=s.tensorflow.magenta.NoteSequence.SectionAnnotation.verify(e.sectionAnnotations[t]))return"sectionAnnotations."+n}}if(null!=e.sectionGroups&&e.hasOwnProperty("sectionGroups")){if(!Array.isArray(e.sectionGroups))return"sectionGroups: array expected";for(t=0;t<e.sectionGroups.length;++t){var n;if(n=s.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroups[t]))return"sectionGroups."+n}}if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n=s.tensorflow.magenta.NoteSequence.QuantizationInfo.verify(e.quantizationInfo)))return"quantizationInfo."+n;if(null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n=s.tensorflow.magenta.NoteSequence.SubsequenceInfo.verify(e.subsequenceInfo)))return"subsequenceInfo."+n;if(null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n=s.tensorflow.magenta.SequenceMetadata.verify(e.sequenceMetadata)))return"sequenceMetadata."+n;return null},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence)return e;var t=new s.tensorflow.magenta.NoteSequence;if(null!=e.id&&(t.id=String(e.id)),null!=e.filename&&(t.filename=String(e.filename)),null!=e.referenceNumber&&(o.Long?(t.referenceNumber=o.Long.fromValue(e.referenceNumber)).unsigned=!1:"string"===typeof e.referenceNumber?t.referenceNumber=parseInt(e.referenceNumber,10):"number"===typeof e.referenceNumber?t.referenceNumber=e.referenceNumber:"object"===typeof e.referenceNumber&&(t.referenceNumber=new o.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber())),null!=e.collectionName&&(t.collectionName=String(e.collectionName)),null!=e.ticksPerQuarter&&(t.ticksPerQuarter=0|e.ticksPerQuarter),e.timeSignatures){if(!Array.isArray(e.timeSignatures))throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: array expected");t.timeSignatures=[];for(var n=0;n<e.timeSignatures.length;++n){if("object"!==typeof e.timeSignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: object expected");t.timeSignatures[n]=s.tensorflow.magenta.NoteSequence.TimeSignature.fromObject(e.timeSignatures[n])}}if(e.keySignatures){if(!Array.isArray(e.keySignatures))throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: array expected");t.keySignatures=[];for(n=0;n<e.keySignatures.length;++n){if("object"!==typeof e.keySignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: object expected");t.keySignatures[n]=s.tensorflow.magenta.NoteSequence.KeySignature.fromObject(e.keySignatures[n])}}if(e.tempos){if(!Array.isArray(e.tempos))throw TypeError(".tensorflow.magenta.NoteSequence.tempos: array expected");t.tempos=[];for(n=0;n<e.tempos.length;++n){if("object"!==typeof e.tempos[n])throw TypeError(".tensorflow.magenta.NoteSequence.tempos: object expected");t.tempos[n]=s.tensorflow.magenta.NoteSequence.Tempo.fromObject(e.tempos[n])}}if(e.notes){if(!Array.isArray(e.notes))throw TypeError(".tensorflow.magenta.NoteSequence.notes: array expected");t.notes=[];for(n=0;n<e.notes.length;++n){if("object"!==typeof e.notes[n])throw TypeError(".tensorflow.magenta.NoteSequence.notes: object expected");t.notes[n]=s.tensorflow.magenta.NoteSequence.Note.fromObject(e.notes[n])}}if(null!=e.totalTime&&(t.totalTime=Number(e.totalTime)),null!=e.totalQuantizedSteps&&(o.Long?(t.totalQuantizedSteps=o.Long.fromValue(e.totalQuantizedSteps)).unsigned=!1:"string"===typeof e.totalQuantizedSteps?t.totalQuantizedSteps=parseInt(e.totalQuantizedSteps,10):"number"===typeof e.totalQuantizedSteps?t.totalQuantizedSteps=e.totalQuantizedSteps:"object"===typeof e.totalQuantizedSteps&&(t.totalQuantizedSteps=new o.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber())),e.pitchBends){if(!Array.isArray(e.pitchBends))throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: array expected");t.pitchBends=[];for(n=0;n<e.pitchBends.length;++n){if("object"!==typeof e.pitchBends[n])throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: object expected");t.pitchBends[n]=s.tensorflow.magenta.NoteSequence.PitchBend.fromObject(e.pitchBends[n])}}if(e.controlChanges){if(!Array.isArray(e.controlChanges))throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: array expected");t.controlChanges=[];for(n=0;n<e.controlChanges.length;++n){if("object"!==typeof e.controlChanges[n])throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: object expected");t.controlChanges[n]=s.tensorflow.magenta.NoteSequence.ControlChange.fromObject(e.controlChanges[n])}}if(e.partInfos){if(!Array.isArray(e.partInfos))throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: array expected");t.partInfos=[];for(n=0;n<e.partInfos.length;++n){if("object"!==typeof e.partInfos[n])throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: object expected");t.partInfos[n]=s.tensorflow.magenta.NoteSequence.PartInfo.fromObject(e.partInfos[n])}}if(null!=e.sourceInfo){if("object"!==typeof e.sourceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.sourceInfo: object expected");t.sourceInfo=s.tensorflow.magenta.NoteSequence.SourceInfo.fromObject(e.sourceInfo)}if(e.textAnnotations){if(!Array.isArray(e.textAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: array expected");t.textAnnotations=[];for(n=0;n<e.textAnnotations.length;++n){if("object"!==typeof e.textAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: object expected");t.textAnnotations[n]=s.tensorflow.magenta.NoteSequence.TextAnnotation.fromObject(e.textAnnotations[n])}}if(e.sectionAnnotations){if(!Array.isArray(e.sectionAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: array expected");t.sectionAnnotations=[];for(n=0;n<e.sectionAnnotations.length;++n){if("object"!==typeof e.sectionAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: object expected");t.sectionAnnotations[n]=s.tensorflow.magenta.NoteSequence.SectionAnnotation.fromObject(e.sectionAnnotations[n])}}if(e.sectionGroups){if(!Array.isArray(e.sectionGroups))throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: array expected");t.sectionGroups=[];for(n=0;n<e.sectionGroups.length;++n){if("object"!==typeof e.sectionGroups[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: object expected");t.sectionGroups[n]=s.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroups[n])}}if(null!=e.quantizationInfo){if("object"!==typeof e.quantizationInfo)throw TypeError(".tensorflow.magenta.NoteSequence.quantizationInfo: object expected");t.quantizationInfo=s.tensorflow.magenta.NoteSequence.QuantizationInfo.fromObject(e.quantizationInfo)}if(null!=e.subsequenceInfo){if("object"!==typeof e.subsequenceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.subsequenceInfo: object expected");t.subsequenceInfo=s.tensorflow.magenta.NoteSequence.SubsequenceInfo.fromObject(e.subsequenceInfo)}if(null!=e.sequenceMetadata){if("object"!==typeof e.sequenceMetadata)throw TypeError(".tensorflow.magenta.NoteSequence.sequenceMetadata: object expected");t.sequenceMetadata=s.tensorflow.magenta.SequenceMetadata.fromObject(e.sequenceMetadata)}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.timeSignatures=[],n.keySignatures=[],n.tempos=[],n.notes=[],n.pitchBends=[],n.controlChanges=[],n.partInfos=[],n.textAnnotations=[],n.sectionAnnotations=[],n.sectionGroups=[]),t.defaults){if(n.id="",n.filename="",n.collectionName="",n.ticksPerQuarter=0,n.totalTime=0,n.sourceInfo=null,n.quantizationInfo=null,o.Long){var r=new o.Long(0,0,!1);n.totalQuantizedSteps=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.totalQuantizedSteps=t.longs===String?"0":0;if(n.subsequenceInfo=null,o.Long){r=new o.Long(0,0,!1);n.referenceNumber=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.referenceNumber=t.longs===String?"0":0;n.sequenceMetadata=null}if(null!=e.id&&e.hasOwnProperty("id")&&(n.id=e.id),null!=e.filename&&e.hasOwnProperty("filename")&&(n.filename=e.filename),null!=e.collectionName&&e.hasOwnProperty("collectionName")&&(n.collectionName=e.collectionName),null!=e.ticksPerQuarter&&e.hasOwnProperty("ticksPerQuarter")&&(n.ticksPerQuarter=e.ticksPerQuarter),e.timeSignatures&&e.timeSignatures.length){n.timeSignatures=[];for(var a=0;a<e.timeSignatures.length;++a)n.timeSignatures[a]=s.tensorflow.magenta.NoteSequence.TimeSignature.toObject(e.timeSignatures[a],t)}if(e.keySignatures&&e.keySignatures.length){n.keySignatures=[];for(a=0;a<e.keySignatures.length;++a)n.keySignatures[a]=s.tensorflow.magenta.NoteSequence.KeySignature.toObject(e.keySignatures[a],t)}if(e.tempos&&e.tempos.length){n.tempos=[];for(a=0;a<e.tempos.length;++a)n.tempos[a]=s.tensorflow.magenta.NoteSequence.Tempo.toObject(e.tempos[a],t)}if(e.notes&&e.notes.length){n.notes=[];for(a=0;a<e.notes.length;++a)n.notes[a]=s.tensorflow.magenta.NoteSequence.Note.toObject(e.notes[a],t)}if(null!=e.totalTime&&e.hasOwnProperty("totalTime")&&(n.totalTime=t.json&&!isFinite(e.totalTime)?String(e.totalTime):e.totalTime),e.pitchBends&&e.pitchBends.length){n.pitchBends=[];for(a=0;a<e.pitchBends.length;++a)n.pitchBends[a]=s.tensorflow.magenta.NoteSequence.PitchBend.toObject(e.pitchBends[a],t)}if(e.controlChanges&&e.controlChanges.length){n.controlChanges=[];for(a=0;a<e.controlChanges.length;++a)n.controlChanges[a]=s.tensorflow.magenta.NoteSequence.ControlChange.toObject(e.controlChanges[a],t)}if(e.partInfos&&e.partInfos.length){n.partInfos=[];for(a=0;a<e.partInfos.length;++a)n.partInfos[a]=s.tensorflow.magenta.NoteSequence.PartInfo.toObject(e.partInfos[a],t)}if(null!=e.sourceInfo&&e.hasOwnProperty("sourceInfo")&&(n.sourceInfo=s.tensorflow.magenta.NoteSequence.SourceInfo.toObject(e.sourceInfo,t)),e.textAnnotations&&e.textAnnotations.length){n.textAnnotations=[];for(a=0;a<e.textAnnotations.length;++a)n.textAnnotations[a]=s.tensorflow.magenta.NoteSequence.TextAnnotation.toObject(e.textAnnotations[a],t)}if(null!=e.quantizationInfo&&e.hasOwnProperty("quantizationInfo")&&(n.quantizationInfo=s.tensorflow.magenta.NoteSequence.QuantizationInfo.toObject(e.quantizationInfo,t)),null!=e.totalQuantizedSteps&&e.hasOwnProperty("totalQuantizedSteps")&&("number"===typeof e.totalQuantizedSteps?n.totalQuantizedSteps=t.longs===String?String(e.totalQuantizedSteps):e.totalQuantizedSteps:n.totalQuantizedSteps=t.longs===String?o.Long.prototype.toString.call(e.totalQuantizedSteps):t.longs===Number?new o.LongBits(e.totalQuantizedSteps.low>>>0,e.totalQuantizedSteps.high>>>0).toNumber():e.totalQuantizedSteps),null!=e.subsequenceInfo&&e.hasOwnProperty("subsequenceInfo")&&(n.subsequenceInfo=s.tensorflow.magenta.NoteSequence.SubsequenceInfo.toObject(e.subsequenceInfo,t)),null!=e.referenceNumber&&e.hasOwnProperty("referenceNumber")&&("number"===typeof e.referenceNumber?n.referenceNumber=t.longs===String?String(e.referenceNumber):e.referenceNumber:n.referenceNumber=t.longs===String?o.Long.prototype.toString.call(e.referenceNumber):t.longs===Number?new o.LongBits(e.referenceNumber.low>>>0,e.referenceNumber.high>>>0).toNumber():e.referenceNumber),null!=e.sequenceMetadata&&e.hasOwnProperty("sequenceMetadata")&&(n.sequenceMetadata=s.tensorflow.magenta.SequenceMetadata.toObject(e.sequenceMetadata,t)),e.sectionAnnotations&&e.sectionAnnotations.length){n.sectionAnnotations=[];for(a=0;a<e.sectionAnnotations.length;++a)n.sectionAnnotations[a]=s.tensorflow.magenta.NoteSequence.SectionAnnotation.toObject(e.sectionAnnotations[a],t)}if(e.sectionGroups&&e.sectionGroups.length){n.sectionGroups=[];for(a=0;a<e.sectionGroups.length;++a)n.sectionGroups[a]=s.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroups[a],t)}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e.Note=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.pitch=0,e.prototype.pitchName=0,e.prototype.velocity=0,e.prototype.startTime=0,e.prototype.quantizedStartStep=o.Long?o.Long.fromBits(0,0,!1):0,e.prototype.endTime=0,e.prototype.quantizedEndStep=o.Long?o.Long.fromBits(0,0,!1):0,e.prototype.numerator=0,e.prototype.denominator=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.prototype.part=0,e.prototype.voice=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=i.create()),null!=e.pitch&&e.hasOwnProperty("pitch")&&t.uint32(8).int32(e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&t.uint32(16).int32(e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&t.uint32(25).double(e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&t.uint32(33).double(e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(40).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(48).int32(e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(56).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(64).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(72).bool(e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(80).int32(e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&t.uint32(88).int32(e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&t.uint32(96).int32(e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&t.uint32(104).int64(e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&t.uint32(112).int64(e.quantizedEndStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence.Note;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.pitch=e.int32();break;case 11:r.pitchName=e.int32();break;case 2:r.velocity=e.int32();break;case 3:r.startTime=e.double();break;case 13:r.quantizedStartStep=o.Long?e.int64().toNumber():e.int64();break;case 4:r.endTime=e.double();break;case 14:r.quantizedEndStep=o.Long?e.int64().toNumber():e.int64();break;case 5:r.numerator=e.int32();break;case 6:r.denominator=e.int32();break;case 7:r.instrument=e.int32();break;case 8:r.program=e.int32();break;case 9:r.isDrum=e.bool();break;case 10:r.part=e.int32();break;case 12:r.voice=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";if(null!=e.pitch&&e.hasOwnProperty("pitch")&&!o.isInteger(e.pitch))return"pitch: integer expected";if(null!=e.pitchName&&e.hasOwnProperty("pitchName"))switch(e.pitchName){default:return"pitchName: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:}return null!=e.velocity&&e.hasOwnProperty("velocity")&&!o.isInteger(e.velocity)?"velocity: integer expected":null!=e.startTime&&e.hasOwnProperty("startTime")&&"number"!==typeof e.startTime?"startTime: number expected":null==e.quantizedStartStep||!e.hasOwnProperty("quantizedStartStep")||o.isInteger(e.quantizedStartStep)||e.quantizedStartStep&&o.isInteger(e.quantizedStartStep.low)&&o.isInteger(e.quantizedStartStep.high)?null!=e.endTime&&e.hasOwnProperty("endTime")&&"number"!==typeof e.endTime?"endTime: number expected":null==e.quantizedEndStep||!e.hasOwnProperty("quantizedEndStep")||o.isInteger(e.quantizedEndStep)||e.quantizedEndStep&&o.isInteger(e.quantizedEndStep.low)&&o.isInteger(e.quantizedEndStep.high)?null!=e.numerator&&e.hasOwnProperty("numerator")&&!o.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!o.isInteger(e.denominator)?"denominator: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!o.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!o.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!==typeof e.isDrum?"isDrum: boolean expected":null!=e.part&&e.hasOwnProperty("part")&&!o.isInteger(e.part)?"part: integer expected":null!=e.voice&&e.hasOwnProperty("voice")&&!o.isInteger(e.voice)?"voice: integer expected":null:"quantizedEndStep: integer|Long expected":"quantizedStartStep: integer|Long expected"},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence.Note)return e;var t=new s.tensorflow.magenta.NoteSequence.Note;switch(null!=e.pitch&&(t.pitch=0|e.pitch),e.pitchName){case"UNKNOWN_PITCH_NAME":case 0:t.pitchName=0;break;case"F_FLAT_FLAT":case 1:t.pitchName=1;break;case"C_FLAT_FLAT":case 2:t.pitchName=2;break;case"G_FLAT_FLAT":case 3:t.pitchName=3;break;case"D_FLAT_FLAT":case 4:t.pitchName=4;break;case"A_FLAT_FLAT":case 5:t.pitchName=5;break;case"E_FLAT_FLAT":case 6:t.pitchName=6;break;case"B_FLAT_FLAT":case 7:t.pitchName=7;break;case"F_FLAT":case 8:t.pitchName=8;break;case"C_FLAT":case 9:t.pitchName=9;break;case"G_FLAT":case 10:t.pitchName=10;break;case"D_FLAT":case 11:t.pitchName=11;break;case"A_FLAT":case 12:t.pitchName=12;break;case"E_FLAT":case 13:t.pitchName=13;break;case"B_FLAT":case 14:t.pitchName=14;break;case"F":case 15:t.pitchName=15;break;case"C":case 16:t.pitchName=16;break;case"G":case 17:t.pitchName=17;break;case"D":case 18:t.pitchName=18;break;case"A":case 19:t.pitchName=19;break;case"E":case 20:t.pitchName=20;break;case"B":case 21:t.pitchName=21;break;case"F_SHARP":case 22:t.pitchName=22;break;case"C_SHARP":case 23:t.pitchName=23;break;case"G_SHARP":case 24:t.pitchName=24;break;case"D_SHARP":case 25:t.pitchName=25;break;case"A_SHARP":case 26:t.pitchName=26;break;case"E_SHARP":case 27:t.pitchName=27;break;case"B_SHARP":case 28:t.pitchName=28;break;case"F_SHARP_SHARP":case 29:t.pitchName=29;break;case"C_SHARP_SHARP":case 30:t.pitchName=30;break;case"G_SHARP_SHARP":case 31:t.pitchName=31;break;case"D_SHARP_SHARP":case 32:t.pitchName=32;break;case"A_SHARP_SHARP":case 33:t.pitchName=33;break;case"E_SHARP_SHARP":case 34:t.pitchName=34;break;case"B_SHARP_SHARP":case 35:t.pitchName=35}return null!=e.velocity&&(t.velocity=0|e.velocity),null!=e.startTime&&(t.startTime=Number(e.startTime)),null!=e.quantizedStartStep&&(o.Long?(t.quantizedStartStep=o.Long.fromValue(e.quantizedStartStep)).unsigned=!1:"string"===typeof e.quantizedStartStep?t.quantizedStartStep=parseInt(e.quantizedStartStep,10):"number"===typeof e.quantizedStartStep?t.quantizedStartStep=e.quantizedStartStep:"object"===typeof e.quantizedStartStep&&(t.quantizedStartStep=new o.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber())),null!=e.endTime&&(t.endTime=Number(e.endTime)),null!=e.quantizedEndStep&&(o.Long?(t.quantizedEndStep=o.Long.fromValue(e.quantizedEndStep)).unsigned=!1:"string"===typeof e.quantizedEndStep?t.quantizedEndStep=parseInt(e.quantizedEndStep,10):"number"===typeof e.quantizedEndStep?t.quantizedEndStep=e.quantizedEndStep:"object"===typeof e.quantizedEndStep&&(t.quantizedEndStep=new o.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber())),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),null!=e.part&&(t.part=0|e.part),null!=e.voice&&(t.voice=0|e.voice),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults){if(n.pitch=0,n.velocity=0,n.startTime=0,n.endTime=0,n.numerator=0,n.denominator=0,n.instrument=0,n.program=0,n.isDrum=!1,n.part=0,n.pitchName=t.enums===String?"UNKNOWN_PITCH_NAME":0,n.voice=0,o.Long){var r=new o.Long(0,0,!1);n.quantizedStartStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStartStep=t.longs===String?"0":0;if(o.Long){r=new o.Long(0,0,!1);n.quantizedEndStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedEndStep=t.longs===String?"0":0}return null!=e.pitch&&e.hasOwnProperty("pitch")&&(n.pitch=e.pitch),null!=e.velocity&&e.hasOwnProperty("velocity")&&(n.velocity=e.velocity),null!=e.startTime&&e.hasOwnProperty("startTime")&&(n.startTime=t.json&&!isFinite(e.startTime)?String(e.startTime):e.startTime),null!=e.endTime&&e.hasOwnProperty("endTime")&&(n.endTime=t.json&&!isFinite(e.endTime)?String(e.endTime):e.endTime),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.pitchName&&e.hasOwnProperty("pitchName")&&(n.pitchName=t.enums===String?s.tensorflow.magenta.NoteSequence.PitchName[e.pitchName]:e.pitchName),null!=e.voice&&e.hasOwnProperty("voice")&&(n.voice=e.voice),null!=e.quantizedStartStep&&e.hasOwnProperty("quantizedStartStep")&&("number"===typeof e.quantizedStartStep?n.quantizedStartStep=t.longs===String?String(e.quantizedStartStep):e.quantizedStartStep:n.quantizedStartStep=t.longs===String?o.Long.prototype.toString.call(e.quantizedStartStep):t.longs===Number?new o.LongBits(e.quantizedStartStep.low>>>0,e.quantizedStartStep.high>>>0).toNumber():e.quantizedStartStep),null!=e.quantizedEndStep&&e.hasOwnProperty("quantizedEndStep")&&("number"===typeof e.quantizedEndStep?n.quantizedEndStep=t.longs===String?String(e.quantizedEndStep):e.quantizedEndStep:n.quantizedEndStep=t.longs===String?o.Long.prototype.toString.call(e.quantizedEndStep):t.longs===Number?new o.LongBits(e.quantizedEndStep.low>>>0,e.quantizedEndStep.high>>>0).toNumber():e.quantizedEndStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.PitchName=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_PITCH_NAME"]=0,t[e[1]="F_FLAT_FLAT"]=1,t[e[2]="C_FLAT_FLAT"]=2,t[e[3]="G_FLAT_FLAT"]=3,t[e[4]="D_FLAT_FLAT"]=4,t[e[5]="A_FLAT_FLAT"]=5,t[e[6]="E_FLAT_FLAT"]=6,t[e[7]="B_FLAT_FLAT"]=7,t[e[8]="F_FLAT"]=8,t[e[9]="C_FLAT"]=9,t[e[10]="G_FLAT"]=10,t[e[11]="D_FLAT"]=11,t[e[12]="A_FLAT"]=12,t[e[13]="E_FLAT"]=13,t[e[14]="B_FLAT"]=14,t[e[15]="F"]=15,t[e[16]="C"]=16,t[e[17]="G"]=17,t[e[18]="D"]=18,t[e[19]="A"]=19,t[e[20]="E"]=20,t[e[21]="B"]=21,t[e[22]="F_SHARP"]=22,t[e[23]="C_SHARP"]=23,t[e[24]="G_SHARP"]=24,t[e[25]="D_SHARP"]=25,t[e[26]="A_SHARP"]=26,t[e[27]="E_SHARP"]=27,t[e[28]="B_SHARP"]=28,t[e[29]="F_SHARP_SHARP"]=29,t[e[30]="C_SHARP_SHARP"]=30,t[e[31]="G_SHARP_SHARP"]=31,t[e[32]="D_SHARP_SHARP"]=32,t[e[33]="A_SHARP_SHARP"]=33,t[e[34]="E_SHARP_SHARP"]=34,t[e[35]="B_SHARP_SHARP"]=35,t}(),e.TimeSignature=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.numerator=0,e.prototype.denominator=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=i.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&t.uint32(16).int32(e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&t.uint32(24).int32(e.denominator),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence.TimeSignature;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.numerator=e.int32();break;case 3:r.denominator=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!==typeof e.time?"time: number expected":null!=e.numerator&&e.hasOwnProperty("numerator")&&!o.isInteger(e.numerator)?"numerator: integer expected":null!=e.denominator&&e.hasOwnProperty("denominator")&&!o.isInteger(e.denominator)?"denominator: integer expected":null},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence.TimeSignature)return e;var t=new s.tensorflow.magenta.NoteSequence.TimeSignature;return null!=e.time&&(t.time=Number(e.time)),null!=e.numerator&&(t.numerator=0|e.numerator),null!=e.denominator&&(t.denominator=0|e.denominator),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.numerator=0,n.denominator=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.numerator&&e.hasOwnProperty("numerator")&&(n.numerator=e.numerator),null!=e.denominator&&e.hasOwnProperty("denominator")&&(n.denominator=e.denominator),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.KeySignature=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.key=0,e.prototype.mode=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=i.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.key&&e.hasOwnProperty("key")&&t.uint32(16).int32(e.key),null!=e.mode&&e.hasOwnProperty("mode")&&t.uint32(24).int32(e.mode),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence.KeySignature;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.key=e.int32();break;case 3:r.mode=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!==typeof e.time)return"time: number expected";if(null!=e.key&&e.hasOwnProperty("key"))switch(e.key){default:return"key: enum value expected";case 0:case 1:case 1:case 2:case 3:case 3:case 4:case 5:case 6:case 6:case 7:case 8:case 8:case 9:case 10:case 10:case 11:}if(null!=e.mode&&e.hasOwnProperty("mode"))switch(e.mode){default:return"mode: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:}return null},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence.KeySignature)return e;var t=new s.tensorflow.magenta.NoteSequence.KeySignature;switch(null!=e.time&&(t.time=Number(e.time)),e.key){case"C":case 0:t.key=0;break;case"C_SHARP":case 1:case"D_FLAT":case 1:t.key=1;break;case"D":case 2:t.key=2;break;case"D_SHARP":case 3:case"E_FLAT":case 3:t.key=3;break;case"E":case 4:t.key=4;break;case"F":case 5:t.key=5;break;case"F_SHARP":case 6:case"G_FLAT":case 6:t.key=6;break;case"G":case 7:t.key=7;break;case"G_SHARP":case 8:case"A_FLAT":case 8:t.key=8;break;case"A":case 9:t.key=9;break;case"A_SHARP":case 10:case"B_FLAT":case 10:t.key=10;break;case"B":case 11:t.key=11}switch(e.mode){case"MAJOR":case 0:t.mode=0;break;case"MINOR":case 1:t.mode=1;break;case"NOT_SPECIFIED":case 2:t.mode=2;break;case"MIXOLYDIAN":case 3:t.mode=3;break;case"DORIAN":case 4:t.mode=4;break;case"PHRYGIAN":case 5:t.mode=5;break;case"LYDIAN":case 6:t.mode=6;break;case"LOCRIAN":case 7:t.mode=7}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.key=t.enums===String?"C":0,n.mode=t.enums===String?"MAJOR":0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.key&&e.hasOwnProperty("key")&&(n.key=t.enums===String?s.tensorflow.magenta.NoteSequence.KeySignature.Key[e.key]:e.key),null!=e.mode&&e.hasOwnProperty("mode")&&(n.mode=t.enums===String?s.tensorflow.magenta.NoteSequence.KeySignature.Mode[e.mode]:e.mode),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e.Key=function(){var e={},t=Object.create(e);return t[e[0]="C"]=0,t[e[1]="C_SHARP"]=1,t.D_FLAT=1,t[e[2]="D"]=2,t[e[3]="D_SHARP"]=3,t.E_FLAT=3,t[e[4]="E"]=4,t[e[5]="F"]=5,t[e[6]="F_SHARP"]=6,t.G_FLAT=6,t[e[7]="G"]=7,t[e[8]="G_SHARP"]=8,t.A_FLAT=8,t[e[9]="A"]=9,t[e[10]="A_SHARP"]=10,t.B_FLAT=10,t[e[11]="B"]=11,t}(),e.Mode=function(){var e={},t=Object.create(e);return t[e[0]="MAJOR"]=0,t[e[1]="MINOR"]=1,t[e[2]="NOT_SPECIFIED"]=2,t[e[3]="MIXOLYDIAN"]=3,t[e[4]="DORIAN"]=4,t[e[5]="PHRYGIAN"]=5,t[e[6]="LYDIAN"]=6,t[e[7]="LOCRIAN"]=7,t}(),e}(),e.Tempo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.qpm=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=i.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&t.uint32(17).double(e.qpm),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence.Tempo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.qpm=e.double();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!==typeof e.time?"time: number expected":null!=e.qpm&&e.hasOwnProperty("qpm")&&"number"!==typeof e.qpm?"qpm: number expected":null},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence.Tempo)return e;var t=new s.tensorflow.magenta.NoteSequence.Tempo;return null!=e.time&&(t.time=Number(e.time)),null!=e.qpm&&(t.qpm=Number(e.qpm)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.qpm=0),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.qpm&&e.hasOwnProperty("qpm")&&(n.qpm=t.json&&!isFinite(e.qpm)?String(e.qpm):e.qpm),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.PitchBend=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.bend=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=i.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.bend&&e.hasOwnProperty("bend")&&t.uint32(16).int32(e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(24).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(32).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(40).bool(e.isDrum),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence.PitchBend;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 2:r.bend=e.int32();break;case 3:r.instrument=e.int32();break;case 4:r.program=e.int32();break;case 5:r.isDrum=e.bool();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!==typeof e.time?"time: number expected":null!=e.bend&&e.hasOwnProperty("bend")&&!o.isInteger(e.bend)?"bend: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!o.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!o.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!==typeof e.isDrum?"isDrum: boolean expected":null},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence.PitchBend)return e;var t=new s.tensorflow.magenta.NoteSequence.PitchBend;return null!=e.time&&(t.time=Number(e.time)),null!=e.bend&&(t.bend=0|e.bend),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.time=0,n.bend=0,n.instrument=0,n.program=0,n.isDrum=!1),null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.bend&&e.hasOwnProperty("bend")&&(n.bend=e.bend),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.ControlChange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.quantizedStep=o.Long?o.Long.fromBits(0,0,!1):0,e.prototype.controlNumber=0,e.prototype.controlValue=0,e.prototype.instrument=0,e.prototype.program=0,e.prototype.isDrum=!1,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=i.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&t.uint32(16).int32(e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&t.uint32(24).int32(e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&t.uint32(32).int32(e.instrument),null!=e.program&&e.hasOwnProperty("program")&&t.uint32(40).int32(e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&t.uint32(48).bool(e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(56).int64(e.quantizedStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence.ControlChange;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 7:r.quantizedStep=o.Long?e.int64().toNumber():e.int64();break;case 2:r.controlNumber=e.int32();break;case 3:r.controlValue=e.int32();break;case 4:r.instrument=e.int32();break;case 5:r.program=e.int32();break;case 6:r.isDrum=e.bool();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!==typeof e.time?"time: number expected":null==e.quantizedStep||!e.hasOwnProperty("quantizedStep")||o.isInteger(e.quantizedStep)||e.quantizedStep&&o.isInteger(e.quantizedStep.low)&&o.isInteger(e.quantizedStep.high)?null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&!o.isInteger(e.controlNumber)?"controlNumber: integer expected":null!=e.controlValue&&e.hasOwnProperty("controlValue")&&!o.isInteger(e.controlValue)?"controlValue: integer expected":null!=e.instrument&&e.hasOwnProperty("instrument")&&!o.isInteger(e.instrument)?"instrument: integer expected":null!=e.program&&e.hasOwnProperty("program")&&!o.isInteger(e.program)?"program: integer expected":null!=e.isDrum&&e.hasOwnProperty("isDrum")&&"boolean"!==typeof e.isDrum?"isDrum: boolean expected":null:"quantizedStep: integer|Long expected"},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence.ControlChange)return e;var t=new s.tensorflow.magenta.NoteSequence.ControlChange;return null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(o.Long?(t.quantizedStep=o.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"===typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"===typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"===typeof e.quantizedStep&&(t.quantizedStep=new o.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.controlNumber&&(t.controlNumber=0|e.controlNumber),null!=e.controlValue&&(t.controlValue=0|e.controlValue),null!=e.instrument&&(t.instrument=0|e.instrument),null!=e.program&&(t.program=0|e.program),null!=e.isDrum&&(t.isDrum=Boolean(e.isDrum)),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.controlNumber=0,n.controlValue=0,n.instrument=0,n.program=0,n.isDrum=!1,o.Long){var r=new o.Long(0,0,!1);n.quantizedStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.controlNumber&&e.hasOwnProperty("controlNumber")&&(n.controlNumber=e.controlNumber),null!=e.controlValue&&e.hasOwnProperty("controlValue")&&(n.controlValue=e.controlValue),null!=e.instrument&&e.hasOwnProperty("instrument")&&(n.instrument=e.instrument),null!=e.program&&e.hasOwnProperty("program")&&(n.program=e.program),null!=e.isDrum&&e.hasOwnProperty("isDrum")&&(n.isDrum=e.isDrum),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&("number"===typeof e.quantizedStep?n.quantizedStep=t.longs===String?String(e.quantizedStep):e.quantizedStep:n.quantizedStep=t.longs===String?o.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new o.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.PartInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.part=0,e.prototype.name="",e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=i.create()),null!=e.part&&e.hasOwnProperty("part")&&t.uint32(8).int32(e.part),null!=e.name&&e.hasOwnProperty("name")&&t.uint32(18).string(e.name),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence.PartInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.part=e.int32();break;case 2:r.name=e.string();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.part&&e.hasOwnProperty("part")&&!o.isInteger(e.part)?"part: integer expected":null!=e.name&&e.hasOwnProperty("name")&&!o.isString(e.name)?"name: string expected":null},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence.PartInfo)return e;var t=new s.tensorflow.magenta.NoteSequence.PartInfo;return null!=e.part&&(t.part=0|e.part),null!=e.name&&(t.name=String(e.name)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.part=0,n.name=""),null!=e.part&&e.hasOwnProperty("part")&&(n.part=e.part),null!=e.name&&e.hasOwnProperty("name")&&(n.name=e.name),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.SourceInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sourceType=0,e.prototype.encodingType=0,e.prototype.parser=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=i.create()),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&t.uint32(8).int32(e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&t.uint32(16).int32(e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&t.uint32(24).int32(e.parser),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence.SourceInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.sourceType=e.int32();break;case 2:r.encodingType=e.int32();break;case 3:r.parser=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";if(null!=e.sourceType&&e.hasOwnProperty("sourceType"))switch(e.sourceType){default:return"sourceType: enum value expected";case 0:case 1:case 2:}if(null!=e.encodingType&&e.hasOwnProperty("encodingType"))switch(e.encodingType){default:return"encodingType: enum value expected";case 0:case 1:case 2:case 3:case 4:}if(null!=e.parser&&e.hasOwnProperty("parser"))switch(e.parser){default:return"parser: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:}return null},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence.SourceInfo)return e;var t=new s.tensorflow.magenta.NoteSequence.SourceInfo;switch(e.sourceType){case"UNKNOWN_SOURCE_TYPE":case 0:t.sourceType=0;break;case"SCORE_BASED":case 1:t.sourceType=1;break;case"PERFORMANCE_BASED":case 2:t.sourceType=2}switch(e.encodingType){case"UNKNOWN_ENCODING_TYPE":case 0:t.encodingType=0;break;case"MUSIC_XML":case 1:t.encodingType=1;break;case"ABC":case 2:t.encodingType=2;break;case"MIDI":case 3:t.encodingType=3;break;case"MUSICNET":case 4:t.encodingType=4}switch(e.parser){case"UNKNOWN_PARSER":case 0:t.parser=0;break;case"MUSIC21":case 1:t.parser=1;break;case"PRETTY_MIDI":case 2:t.parser=2;break;case"MAGENTA_MUSIC_XML":case 3:t.parser=3;break;case"MAGENTA_MUSICNET":case 4:t.parser=4;break;case"MAGENTA_ABC":case 5:t.parser=5;break;case"TONEJS_MIDI_CONVERT":case 6:t.parser=6}return t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.sourceType=t.enums===String?"UNKNOWN_SOURCE_TYPE":0,n.encodingType=t.enums===String?"UNKNOWN_ENCODING_TYPE":0,n.parser=t.enums===String?"UNKNOWN_PARSER":0),null!=e.sourceType&&e.hasOwnProperty("sourceType")&&(n.sourceType=t.enums===String?s.tensorflow.magenta.NoteSequence.SourceInfo.SourceType[e.sourceType]:e.sourceType),null!=e.encodingType&&e.hasOwnProperty("encodingType")&&(n.encodingType=t.enums===String?s.tensorflow.magenta.NoteSequence.SourceInfo.EncodingType[e.encodingType]:e.encodingType),null!=e.parser&&e.hasOwnProperty("parser")&&(n.parser=t.enums===String?s.tensorflow.magenta.NoteSequence.SourceInfo.Parser[e.parser]:e.parser),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e.SourceType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_SOURCE_TYPE"]=0,t[e[1]="SCORE_BASED"]=1,t[e[2]="PERFORMANCE_BASED"]=2,t}(),e.EncodingType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_ENCODING_TYPE"]=0,t[e[1]="MUSIC_XML"]=1,t[e[2]="ABC"]=2,t[e[3]="MIDI"]=3,t[e[4]="MUSICNET"]=4,t}(),e.Parser=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN_PARSER"]=0,t[e[1]="MUSIC21"]=1,t[e[2]="PRETTY_MIDI"]=2,t[e[3]="MAGENTA_MUSIC_XML"]=3,t[e[4]="MAGENTA_MUSICNET"]=4,t[e[5]="MAGENTA_ABC"]=5,t[e[6]="TONEJS_MIDI_CONVERT"]=6,t}(),e}(),e.TextAnnotation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.quantizedStep=o.Long?o.Long.fromBits(0,0,!1):0,e.prototype.text="",e.prototype.annotationType=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=i.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.text&&e.hasOwnProperty("text")&&t.uint32(18).string(e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&t.uint32(24).int32(e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&t.uint32(32).int64(e.quantizedStep),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence.TextAnnotation;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 4:r.quantizedStep=o.Long?e.int64().toNumber():e.int64();break;case 2:r.text=e.string();break;case 3:r.annotationType=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";if(null!=e.time&&e.hasOwnProperty("time")&&"number"!==typeof e.time)return"time: number expected";if(null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&!o.isInteger(e.quantizedStep)&&!(e.quantizedStep&&o.isInteger(e.quantizedStep.low)&&o.isInteger(e.quantizedStep.high)))return"quantizedStep: integer|Long expected";if(null!=e.text&&e.hasOwnProperty("text")&&!o.isString(e.text))return"text: string expected";if(null!=e.annotationType&&e.hasOwnProperty("annotationType"))switch(e.annotationType){default:return"annotationType: enum value expected";case 0:case 1:case 2:}return null},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence.TextAnnotation)return e;var t=new s.tensorflow.magenta.NoteSequence.TextAnnotation;switch(null!=e.time&&(t.time=Number(e.time)),null!=e.quantizedStep&&(o.Long?(t.quantizedStep=o.Long.fromValue(e.quantizedStep)).unsigned=!1:"string"===typeof e.quantizedStep?t.quantizedStep=parseInt(e.quantizedStep,10):"number"===typeof e.quantizedStep?t.quantizedStep=e.quantizedStep:"object"===typeof e.quantizedStep&&(t.quantizedStep=new o.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber())),null!=e.text&&(t.text=String(e.text)),e.annotationType){case"UNKNOWN":case 0:t.annotationType=0;break;case"CHORD_SYMBOL":case 1:t.annotationType=1;break;case"BEAT":case 2:t.annotationType=2}return t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,n.text="",n.annotationType=t.enums===String?"UNKNOWN":0,o.Long){var r=new o.Long(0,0,!1);n.quantizedStep=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.quantizedStep=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.text&&e.hasOwnProperty("text")&&(n.text=e.text),null!=e.annotationType&&e.hasOwnProperty("annotationType")&&(n.annotationType=t.enums===String?s.tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType[e.annotationType]:e.annotationType),null!=e.quantizedStep&&e.hasOwnProperty("quantizedStep")&&("number"===typeof e.quantizedStep?n.quantizedStep=t.longs===String?String(e.quantizedStep):e.quantizedStep:n.quantizedStep=t.longs===String?o.Long.prototype.toString.call(e.quantizedStep):t.longs===Number?new o.LongBits(e.quantizedStep.low>>>0,e.quantizedStep.high>>>0).toNumber():e.quantizedStep),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e.TextAnnotationType=function(){var e={},t=Object.create(e);return t[e[0]="UNKNOWN"]=0,t[e[1]="CHORD_SYMBOL"]=1,t[e[2]="BEAT"]=2,t}(),e}(),e.QuantizationInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.stepsPerQuarter=0,e.prototype.stepsPerSecond=0,Object.defineProperty(e.prototype,"resolution",{get:o.oneOfGetter(t=["stepsPerQuarter","stepsPerSecond"]),set:o.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=i.create()),null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&t.uint32(8).int32(e.stepsPerQuarter),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&t.uint32(16).int32(e.stepsPerSecond),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence.QuantizationInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.stepsPerQuarter=e.int32();break;case 2:r.stepsPerSecond=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";var t={};if(null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(t.resolution=1,!o.isInteger(e.stepsPerQuarter)))return"stepsPerQuarter: integer expected";if(null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")){if(1===t.resolution)return"resolution: multiple values";if(t.resolution=1,!o.isInteger(e.stepsPerSecond))return"stepsPerSecond: integer expected"}return null},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence.QuantizationInfo)return e;var t=new s.tensorflow.magenta.NoteSequence.QuantizationInfo;return null!=e.stepsPerQuarter&&(t.stepsPerQuarter=0|e.stepsPerQuarter),null!=e.stepsPerSecond&&(t.stepsPerSecond=0|e.stepsPerSecond),t},e.toObject=function(e,t){t||(t={});var n={};return null!=e.stepsPerQuarter&&e.hasOwnProperty("stepsPerQuarter")&&(n.stepsPerQuarter=e.stepsPerQuarter,t.oneofs&&(n.resolution="stepsPerQuarter")),null!=e.stepsPerSecond&&e.hasOwnProperty("stepsPerSecond")&&(n.stepsPerSecond=e.stepsPerSecond,t.oneofs&&(n.resolution="stepsPerSecond")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.SubsequenceInfo=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.startTimeOffset=0,e.prototype.endTimeOffset=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=i.create()),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&t.uint32(9).double(e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&t.uint32(17).double(e.endTimeOffset),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence.SubsequenceInfo;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.startTimeOffset=e.double();break;case 2:r.endTimeOffset=e.double();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&"number"!==typeof e.startTimeOffset?"startTimeOffset: number expected":null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&"number"!==typeof e.endTimeOffset?"endTimeOffset: number expected":null},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence.SubsequenceInfo)return e;var t=new s.tensorflow.magenta.NoteSequence.SubsequenceInfo;return null!=e.startTimeOffset&&(t.startTimeOffset=Number(e.startTimeOffset)),null!=e.endTimeOffset&&(t.endTimeOffset=Number(e.endTimeOffset)),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.startTimeOffset=0,n.endTimeOffset=0),null!=e.startTimeOffset&&e.hasOwnProperty("startTimeOffset")&&(n.startTimeOffset=t.json&&!isFinite(e.startTimeOffset)?String(e.startTimeOffset):e.startTimeOffset),null!=e.endTimeOffset&&e.hasOwnProperty("endTimeOffset")&&(n.endTimeOffset=t.json&&!isFinite(e.endTimeOffset)?String(e.endTimeOffset):e.endTimeOffset),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.SectionAnnotation=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.time=0,e.prototype.sectionId=o.Long?o.Long.fromBits(0,0,!1):0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=i.create()),null!=e.time&&e.hasOwnProperty("time")&&t.uint32(9).double(e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(32).int64(e.sectionId),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence.SectionAnnotation;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.time=e.double();break;case 4:r.sectionId=o.Long?e.int64().toNumber():e.int64();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.time&&e.hasOwnProperty("time")&&"number"!==typeof e.time?"time: number expected":null==e.sectionId||!e.hasOwnProperty("sectionId")||o.isInteger(e.sectionId)||e.sectionId&&o.isInteger(e.sectionId.low)&&o.isInteger(e.sectionId.high)?null:"sectionId: integer|Long expected"},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence.SectionAnnotation)return e;var t=new s.tensorflow.magenta.NoteSequence.SectionAnnotation;return null!=e.time&&(t.time=Number(e.time)),null!=e.sectionId&&(o.Long?(t.sectionId=o.Long.fromValue(e.sectionId)).unsigned=!1:"string"===typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"===typeof e.sectionId?t.sectionId=e.sectionId:"object"===typeof e.sectionId&&(t.sectionId=new o.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),t},e.toObject=function(e,t){t||(t={});var n={};if(t.defaults)if(n.time=0,o.Long){var r=new o.Long(0,0,!1);n.sectionId=t.longs===String?r.toString():t.longs===Number?r.toNumber():r}else n.sectionId=t.longs===String?"0":0;return null!=e.time&&e.hasOwnProperty("time")&&(n.time=t.json&&!isFinite(e.time)?String(e.time):e.time),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&("number"===typeof e.sectionId?n.sectionId=t.longs===String?String(e.sectionId):e.sectionId:n.sectionId=t.longs===String?o.Long.prototype.toString.call(e.sectionId):t.longs===Number?new o.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.Section=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}var t;return e.prototype.sectionId=o.Long?o.Long.fromBits(0,0,!1):0,e.prototype.sectionGroup=null,Object.defineProperty(e.prototype,"sectionType",{get:o.oneOfGetter(t=["sectionId","sectionGroup"]),set:o.oneOfSetter(t)}),e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=i.create()),null!=e.sectionId&&e.hasOwnProperty("sectionId")&&t.uint32(8).int64(e.sectionId),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&s.tensorflow.magenta.NoteSequence.SectionGroup.encode(e.sectionGroup,t.uint32(18).fork()).ldelim(),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence.Section;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.sectionId=o.Long?e.int64().toNumber():e.int64();break;case 2:r.sectionGroup=s.tensorflow.magenta.NoteSequence.SectionGroup.decode(e,e.uint32());break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";var t={};if(null!=e.sectionId&&e.hasOwnProperty("sectionId")&&(t.sectionType=1,!o.isInteger(e.sectionId)&&!(e.sectionId&&o.isInteger(e.sectionId.low)&&o.isInteger(e.sectionId.high))))return"sectionId: integer|Long expected";if(null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")){if(1===t.sectionType)return"sectionType: multiple values";t.sectionType=1;var n=s.tensorflow.magenta.NoteSequence.SectionGroup.verify(e.sectionGroup);if(n)return"sectionGroup."+n}return null},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence.Section)return e;var t=new s.tensorflow.magenta.NoteSequence.Section;if(null!=e.sectionId&&(o.Long?(t.sectionId=o.Long.fromValue(e.sectionId)).unsigned=!1:"string"===typeof e.sectionId?t.sectionId=parseInt(e.sectionId,10):"number"===typeof e.sectionId?t.sectionId=e.sectionId:"object"===typeof e.sectionId&&(t.sectionId=new o.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber())),null!=e.sectionGroup){if("object"!==typeof e.sectionGroup)throw TypeError(".tensorflow.magenta.NoteSequence.Section.sectionGroup: object expected");t.sectionGroup=s.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(e.sectionGroup)}return t},e.toObject=function(e,t){t||(t={});var n={};return null!=e.sectionId&&e.hasOwnProperty("sectionId")&&("number"===typeof e.sectionId?n.sectionId=t.longs===String?String(e.sectionId):e.sectionId:n.sectionId=t.longs===String?o.Long.prototype.toString.call(e.sectionId):t.longs===Number?new o.LongBits(e.sectionId.low>>>0,e.sectionId.high>>>0).toNumber():e.sectionId,t.oneofs&&(n.sectionType="sectionId")),null!=e.sectionGroup&&e.hasOwnProperty("sectionGroup")&&(n.sectionGroup=s.tensorflow.magenta.NoteSequence.SectionGroup.toObject(e.sectionGroup,t),t.oneofs&&(n.sectionType="sectionGroup")),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.SectionGroup=function(){function e(e){if(this.sections=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.sections=o.emptyArray,e.prototype.numTimes=0,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=i.create()),null!=e.sections&&e.sections.length)for(var n=0;n<e.sections.length;++n)s.tensorflow.magenta.NoteSequence.Section.encode(e.sections[n],t.uint32(10).fork()).ldelim();return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&t.uint32(16).int32(e.numTimes),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.NoteSequence.SectionGroup;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.sections&&r.sections.length||(r.sections=[]),r.sections.push(s.tensorflow.magenta.NoteSequence.Section.decode(e,e.uint32()));break;case 2:r.numTimes=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";if(null!=e.sections&&e.hasOwnProperty("sections")){if(!Array.isArray(e.sections))return"sections: array expected";for(var t=0;t<e.sections.length;++t){var n=s.tensorflow.magenta.NoteSequence.Section.verify(e.sections[t]);if(n)return"sections."+n}}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&!o.isInteger(e.numTimes)?"numTimes: integer expected":null},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.NoteSequence.SectionGroup)return e;var t=new s.tensorflow.magenta.NoteSequence.SectionGroup;if(e.sections){if(!Array.isArray(e.sections))throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: array expected");t.sections=[];for(var n=0;n<e.sections.length;++n){if("object"!==typeof e.sections[n])throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: object expected");t.sections[n]=s.tensorflow.magenta.NoteSequence.Section.fromObject(e.sections[n])}}return null!=e.numTimes&&(t.numTimes=0|e.numTimes),t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.sections=[]),t.defaults&&(n.numTimes=0),e.sections&&e.sections.length){n.sections=[];for(var r=0;r<e.sections.length;++r)n.sections[r]=s.tensorflow.magenta.NoteSequence.Section.toObject(e.sections[r],t)}return null!=e.numTimes&&e.hasOwnProperty("numTimes")&&(n.numTimes=e.numTimes),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e}(),e.SequenceMetadata=function(){function e(e){if(this.genre=[],this.composers=[],e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.title="",e.prototype.artist="",e.prototype.genre=o.emptyArray,e.prototype.composers=o.emptyArray,e.create=function(t){return new e(t)},e.encode=function(e,t){if(t||(t=i.create()),null!=e.title&&e.hasOwnProperty("title")&&t.uint32(10).string(e.title),null!=e.artist&&e.hasOwnProperty("artist")&&t.uint32(18).string(e.artist),null!=e.genre&&e.genre.length)for(var n=0;n<e.genre.length;++n)t.uint32(26).string(e.genre[n]);if(null!=e.composers&&e.composers.length)for(n=0;n<e.composers.length;++n)t.uint32(34).string(e.composers[n]);return t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.SequenceMetadata;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.title=e.string();break;case 2:r.artist=e.string();break;case 3:r.genre&&r.genre.length||(r.genre=[]),r.genre.push(e.string());break;case 4:r.composers&&r.composers.length||(r.composers=[]),r.composers.push(e.string());break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){if("object"!==typeof e||null===e)return"object expected";if(null!=e.title&&e.hasOwnProperty("title")&&!o.isString(e.title))return"title: string expected";if(null!=e.artist&&e.hasOwnProperty("artist")&&!o.isString(e.artist))return"artist: string expected";if(null!=e.genre&&e.hasOwnProperty("genre")){if(!Array.isArray(e.genre))return"genre: array expected";for(var t=0;t<e.genre.length;++t)if(!o.isString(e.genre[t]))return"genre: string[] expected"}if(null!=e.composers&&e.hasOwnProperty("composers")){if(!Array.isArray(e.composers))return"composers: array expected";for(t=0;t<e.composers.length;++t)if(!o.isString(e.composers[t]))return"composers: string[] expected"}return null},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.SequenceMetadata)return e;var t=new s.tensorflow.magenta.SequenceMetadata;if(null!=e.title&&(t.title=String(e.title)),null!=e.artist&&(t.artist=String(e.artist)),e.genre){if(!Array.isArray(e.genre))throw TypeError(".tensorflow.magenta.SequenceMetadata.genre: array expected");t.genre=[];for(var n=0;n<e.genre.length;++n)t.genre[n]=String(e.genre[n])}if(e.composers){if(!Array.isArray(e.composers))throw TypeError(".tensorflow.magenta.SequenceMetadata.composers: array expected");t.composers=[];for(n=0;n<e.composers.length;++n)t.composers[n]=String(e.composers[n])}return t},e.toObject=function(e,t){t||(t={});var n={};if((t.arrays||t.defaults)&&(n.genre=[],n.composers=[]),t.defaults&&(n.title="",n.artist=""),null!=e.title&&e.hasOwnProperty("title")&&(n.title=e.title),null!=e.artist&&e.hasOwnProperty("artist")&&(n.artist=e.artist),e.genre&&e.genre.length){n.genre=[];for(var r=0;r<e.genre.length;++r)n.genre[r]=e.genre[r]}if(e.composers&&e.composers.length){n.composers=[];for(r=0;r<e.composers.length;++r)n.composers[r]=e.composers[r]}return n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e.VelocityRange=function(){function e(e){if(e)for(var t=Object.keys(e),n=0;n<t.length;++n)null!=e[t[n]]&&(this[t[n]]=e[t[n]])}return e.prototype.min=0,e.prototype.max=0,e.create=function(t){return new e(t)},e.encode=function(e,t){return t||(t=i.create()),null!=e.min&&e.hasOwnProperty("min")&&t.uint32(8).int32(e.min),null!=e.max&&e.hasOwnProperty("max")&&t.uint32(16).int32(e.max),t},e.encodeDelimited=function(e,t){return this.encode(e,t).ldelim()},e.decode=function(e,t){e instanceof a||(e=a.create(e));for(var n=void 0===t?e.len:e.pos+t,r=new s.tensorflow.magenta.VelocityRange;e.pos<n;){var i=e.uint32();switch(i>>>3){case 1:r.min=e.int32();break;case 2:r.max=e.int32();break;default:e.skipType(7&i)}}return r},e.decodeDelimited=function(e){return e instanceof a||(e=new a(e)),this.decode(e,e.uint32())},e.verify=function(e){return"object"!==typeof e||null===e?"object expected":null!=e.min&&e.hasOwnProperty("min")&&!o.isInteger(e.min)?"min: integer expected":null!=e.max&&e.hasOwnProperty("max")&&!o.isInteger(e.max)?"max: integer expected":null},e.fromObject=function(e){if(e instanceof s.tensorflow.magenta.VelocityRange)return e;var t=new s.tensorflow.magenta.VelocityRange;return null!=e.min&&(t.min=0|e.min),null!=e.max&&(t.max=0|e.max),t},e.toObject=function(e,t){t||(t={});var n={};return t.defaults&&(n.min=0,n.max=0),null!=e.min&&e.hasOwnProperty("min")&&(n.min=e.min),null!=e.max&&e.hasOwnProperty("max")&&(n.max=e.max),n},e.prototype.toJSON=function(){return this.constructor.toObject(this,r.util.toJSONOptions)},e}(),e}(),e}(),e.exports=s},7206:function(e){"use strict";e.exports=function(e,t){var n=new Array(arguments.length-1),r=0,a=2,i=!0;for(;a<arguments.length;)n[r++]=arguments[a++];return new Promise((function(a,o){n[r]=function(e){if(i)if(i=!1,e)o(e);else{for(var t=new Array(arguments.length-1),n=0;n<t.length;)t[n++]=arguments[n];a.apply(null,t)}};try{e.apply(t||null,n)}catch(s){i&&(i=!1,o(s))}}))}},1:function(e,t){"use strict";var n=t;n.length=function(e){var t=e.length;if(!t)return 0;for(var n=0;--t%4>1&&"="===e.charAt(t);)++n;return Math.ceil(3*e.length)/4-n};for(var r=new Array(64),a=new Array(123),i=0;i<64;)a[r[i]=i<26?i+65:i<52?i+71:i<62?i-4:i-59|43]=i++;n.encode=function(e,t,n){for(var a,i=null,o=[],s=0,u=0;t<n;){var c=e[t++];switch(u){case 0:o[s++]=r[c>>2],a=(3&c)<<4,u=1;break;case 1:o[s++]=r[a|c>>4],a=(15&c)<<2,u=2;break;case 2:o[s++]=r[a|c>>6],o[s++]=r[63&c],u=0}s>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,o)),s=0)}return u&&(o[s++]=r[a],o[s++]=61,1===u&&(o[s++]=61)),i?(s&&i.push(String.fromCharCode.apply(String,o.slice(0,s))),i.join("")):String.fromCharCode.apply(String,o.slice(0,s))};var o="invalid encoding";n.decode=function(e,t,n){for(var r,i=n,s=0,u=0;u<e.length;){var c=e.charCodeAt(u++);if(61===c&&s>1)break;if(void 0===(c=a[c]))throw Error(o);switch(s){case 0:r=c,s=1;break;case 1:t[n++]=r<<2|(48&c)>>4,r=c,s=2;break;case 2:t[n++]=(15&r)<<4|(60&c)>>2,r=c,s=3;break;case 3:t[n++]=(3&r)<<6|c,s=0}}if(1===s)throw Error(o);return n-i},n.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}},7111:function(e){"use strict";function t(){this._listeners={}}e.exports=t,t.prototype.on=function(e,t,n){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:n||this}),this},t.prototype.off=function(e,t){if(void 0===e)this._listeners={};else if(void 0===t)this._listeners[e]=[];else for(var n=this._listeners[e],r=0;r<n.length;)n[r].fn===t?n.splice(r,1):++r;return this},t.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var n=[],r=1;r<arguments.length;)n.push(arguments[r++]);for(r=0;r<t.length;)t[r].fn.apply(t[r++].ctx,n)}return this}},802:function(e){"use strict";function t(e){return"undefined"!==typeof Float32Array?function(){var t=new Float32Array([-0]),n=new Uint8Array(t.buffer),r=128===n[3];function a(e,r,a){t[0]=e,r[a]=n[0],r[a+1]=n[1],r[a+2]=n[2],r[a+3]=n[3]}function i(e,r,a){t[0]=e,r[a]=n[3],r[a+1]=n[2],r[a+2]=n[1],r[a+3]=n[0]}function o(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],t[0]}function s(e,r){return n[3]=e[r],n[2]=e[r+1],n[1]=e[r+2],n[0]=e[r+3],t[0]}e.writeFloatLE=r?a:i,e.writeFloatBE=r?i:a,e.readFloatLE=r?o:s,e.readFloatBE=r?s:o}():function(){function t(e,t,n,r){var a=t<0?1:0;if(a&&(t=-t),0===t)e(1/t>0?0:2147483648,n,r);else if(isNaN(t))e(2143289344,n,r);else if(t>34028234663852886e22)e((a<<31|2139095040)>>>0,n,r);else if(t<11754943508222875e-54)e((a<<31|Math.round(t/1401298464324817e-60))>>>0,n,r);else{var i=Math.floor(Math.log(t)/Math.LN2);e((a<<31|i+127<<23|8388607&Math.round(t*Math.pow(2,-i)*8388608))>>>0,n,r)}}function o(e,t,n){var r=e(t,n),a=2*(r>>31)+1,i=r>>>23&255,o=8388607&r;return 255===i?o?NaN:a*(1/0):0===i?1401298464324817e-60*a*o:a*Math.pow(2,i-150)*(o+8388608)}e.writeFloatLE=t.bind(null,n),e.writeFloatBE=t.bind(null,r),e.readFloatLE=o.bind(null,a),e.readFloatBE=o.bind(null,i)}(),"undefined"!==typeof Float64Array?function(){var t=new Float64Array([-0]),n=new Uint8Array(t.buffer),r=128===n[7];function a(e,r,a){t[0]=e,r[a]=n[0],r[a+1]=n[1],r[a+2]=n[2],r[a+3]=n[3],r[a+4]=n[4],r[a+5]=n[5],r[a+6]=n[6],r[a+7]=n[7]}function i(e,r,a){t[0]=e,r[a]=n[7],r[a+1]=n[6],r[a+2]=n[5],r[a+3]=n[4],r[a+4]=n[3],r[a+5]=n[2],r[a+6]=n[1],r[a+7]=n[0]}function o(e,r){return n[0]=e[r],n[1]=e[r+1],n[2]=e[r+2],n[3]=e[r+3],n[4]=e[r+4],n[5]=e[r+5],n[6]=e[r+6],n[7]=e[r+7],t[0]}function s(e,r){return n[7]=e[r],n[6]=e[r+1],n[5]=e[r+2],n[4]=e[r+3],n[3]=e[r+4],n[2]=e[r+5],n[1]=e[r+6],n[0]=e[r+7],t[0]}e.writeDoubleLE=r?a:i,e.writeDoubleBE=r?i:a,e.readDoubleLE=r?o:s,e.readDoubleBE=r?s:o}():function(){function t(e,t,n,r,a,i){var o=r<0?1:0;if(o&&(r=-r),0===r)e(0,a,i+t),e(1/r>0?0:2147483648,a,i+n);else if(isNaN(r))e(0,a,i+t),e(2146959360,a,i+n);else if(r>17976931348623157e292)e(0,a,i+t),e((o<<31|2146435072)>>>0,a,i+n);else{var s;if(r<22250738585072014e-324)e((s=r/5e-324)>>>0,a,i+t),e((o<<31|s/4294967296)>>>0,a,i+n);else{var u=Math.floor(Math.log(r)/Math.LN2);1024===u&&(u=1023),e(4503599627370496*(s=r*Math.pow(2,-u))>>>0,a,i+t),e((o<<31|u+1023<<20|1048576*s&1048575)>>>0,a,i+n)}}}function o(e,t,n,r,a){var i=e(r,a+t),o=e(r,a+n),s=2*(o>>31)+1,u=o>>>20&2047,c=4294967296*(1048575&o)+i;return 2047===u?c?NaN:s*(1/0):0===u?5e-324*s*c:s*Math.pow(2,u-1075)*(c+4503599627370496)}e.writeDoubleLE=t.bind(null,n,0,4),e.writeDoubleBE=t.bind(null,r,4,0),e.readDoubleLE=o.bind(null,a,0,4),e.readDoubleBE=o.bind(null,i,4,0)}(),e}function n(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}function r(e,t,n){t[n]=e>>>24,t[n+1]=e>>>16&255,t[n+2]=e>>>8&255,t[n+3]=255&e}function a(e,t){return(e[t]|e[t+1]<<8|e[t+2]<<16|e[t+3]<<24)>>>0}function i(e,t){return(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}e.exports=t(t)},7172:function(module){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},8236:function(e){"use strict";e.exports=function(e,t,n){var r=n||8192,a=r>>>1,i=null,o=r;return function(n){if(n<1||n>a)return e(n);o+n>r&&(i=e(r),o=0);var s=t.call(i,o,o+=n);return 7&o&&(o=1+(7|o)),s}}},3861:function(e,t){"use strict";var n=t;n.length=function(e){for(var t=0,n=0,r=0;r<e.length;++r)(n=e.charCodeAt(r))<128?t+=1:n<2048?t+=2:55296===(64512&n)&&56320===(64512&e.charCodeAt(r+1))?(++r,t+=4):t+=3;return t},n.read=function(e,t,n){if(n-t<1)return"";for(var r,a=null,i=[],o=0;t<n;)(r=e[t++])<128?i[o++]=r:r>191&&r<224?i[o++]=(31&r)<<6|63&e[t++]:r>239&&r<365?(r=((7&r)<<18|(63&e[t++])<<12|(63&e[t++])<<6|63&e[t++])-65536,i[o++]=55296+(r>>10),i[o++]=56320+(1023&r)):i[o++]=(15&r)<<12|(63&e[t++])<<6|63&e[t++],o>8191&&((a||(a=[])).push(String.fromCharCode.apply(String,i)),o=0);return a?(o&&a.push(String.fromCharCode.apply(String,i.slice(0,o))),a.join("")):String.fromCharCode.apply(String,i.slice(0,o))},n.write=function(e,t,n){for(var r,a,i=n,o=0;o<e.length;++o)(r=e.charCodeAt(o))<128?t[n++]=r:r<2048?(t[n++]=r>>6|192,t[n++]=63&r|128):55296===(64512&r)&&56320===(64512&(a=e.charCodeAt(o+1)))?(r=65536+((1023&r)<<10)+(1023&a),++o,t[n++]=r>>18|240,t[n++]=r>>12&63|128,t[n++]=r>>6&63|128,t[n++]=63&r|128):(t[n++]=r>>12|224,t[n++]=r>>6&63|128,t[n++]=63&r|128);return n-i}},1146:function(e,t){"use strict";function n(e,t,n){void 0===n&&(n="ticks");var r=0,a=e.length,i=a;if(a>0&&e[a-1][n]<=t)return a-1;for(;r<i;){var o=Math.floor(r+(i-r)/2),s=e[o],u=e[o+1];if(s[n]===t){for(var c=o;c<e.length;c++){e[c][n]===t&&(o=c)}return o}if(s[n]<t&&u[n]>t)return o;s[n]>t?i=o:s[n]<t&&(r=o+1)}return-1}Object.defineProperty(t,"__esModule",{value:!0}),t.insert=t.search=void 0,t.search=n,t.insert=function(e,t,r){if(void 0===r&&(r="ticks"),e.length){var a=n(e,t[r],r);e.splice(a+1,0,t)}else e.push(t)}},7182:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ControlChange=t.controlChangeIds=t.controlChangeNames=void 0,t.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},t.controlChangeIds=Object.keys(t.controlChangeNames).reduce((function(e,n){return e[t.controlChangeNames[n]]=n,e}),{});var n=new WeakMap,r=new WeakMap,a=function(){function e(e,t){n.set(this,t),r.set(this,e.controllerType),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(e.prototype,"number",{get:function(){return r.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return t.controlChangeNames[this.number]?t.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return n.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=n.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},e}();t.ControlChange=a},6966:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createControlChanges=void 0;var r=n(7182);t.createControlChanges=function(){return new Proxy({},{get:function(e,t){return e[t]?e[t]:r.controlChangeIds.hasOwnProperty(t)?e[r.controlChangeIds[t]]:void 0},set:function(e,t,n){return r.controlChangeIds.hasOwnProperty(t)?e[r.controlChangeIds[t]]=n:e[t]=n,!0}})}},8573:function(e,t,n){"use strict";var r=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))};Object.defineProperty(t,"__esModule",{value:!0}),t.encode=void 0;var a=n(8191),i=n(4809),o=n(6861);function s(e){return(0,o.flatten)(e.notes.map((function(t){return function(e,t){return[{absoluteTime:e.ticks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOn",velocity:Math.floor(127*e.velocity)},{absoluteTime:e.ticks+e.durationTicks,channel:t,deltaTime:0,noteNumber:e.midi,type:"noteOff",velocity:Math.floor(127*e.noteOffVelocity)}]}(t,e.channel)})))}function u(e,t){return{absoluteTime:e.ticks,channel:t,controllerType:e.number,deltaTime:0,type:"controller",value:Math.floor(127*e.value)}}function c(e){return{absoluteTime:0,channel:e.channel,deltaTime:0,programNumber:e.instrument.number,type:"programChange"}}function l(e){return{absoluteTime:0,deltaTime:0,meta:!0,text:e,type:"trackName"}}t.encode=function(e){var t={header:{format:1,numTracks:e.tracks.length+1,ticksPerBeat:e.header.ppq},tracks:r([r(r(r(r([{absoluteTime:0,deltaTime:0,meta:!0,text:e.header.name,type:"trackName"}],e.header.keySignatures.map((function(e){return function(e){var t=i.keySignatureKeys.indexOf(e.key);return{absoluteTime:e.ticks,deltaTime:0,key:t+7,meta:!0,scale:"major"===e.scale?0:1,type:"keySignature"}}(e)})),!0),e.header.meta.map((function(e){return{absoluteTime:(t=e).ticks,deltaTime:0,meta:!0,text:t.text,type:t.type};var t})),!0),e.header.tempos.map((function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/e.bpm),type:"setTempo"}}(e)})),!0),e.header.timeSignatures.map((function(e){return function(e){return{absoluteTime:e.ticks,deltaTime:0,denominator:e.timeSignature[1],meta:!0,metronome:24,numerator:e.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}(e)})),!0)],e.tracks.map((function(e){return r(r(r([l(e.name),c(e)],s(e),!0),function(e){for(var t=[],n=0;n<127;n++)e.controlChanges.hasOwnProperty(n)&&e.controlChanges[n].forEach((function(n){t.push(u(n,e.channel))}));return t}(e),!0),function(e){var t=[];return e.pitchBends.forEach((function(n){t.push(function(e,t){return{absoluteTime:e.ticks,channel:t,deltaTime:0,type:"pitchBend",value:e.value}}(n,e.channel))})),t}(e),!0)})),!0)};return t.tracks=t.tracks.map((function(e){e=e.sort((function(e,t){return e.absoluteTime-t.absoluteTime}));var t=0;return e.forEach((function(e){e.deltaTime=e.absoluteTime-t,t=e.absoluteTime,delete e.absoluteTime})),e.push({deltaTime:0,meta:!0,type:"endOfTrack"}),e})),new Uint8Array((0,a.writeMidi)(t))}},4809:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.keySignatureKeys=void 0;var r=n(1146),a=new WeakMap;t.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var i=function(){function e(e){var n=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",a.set(this,480),e){a.set(this,e.header.ticksPerBeat),e.tracks.forEach((function(e){e.forEach((function(e){e.meta&&("timeSignature"===e.type?n.timeSignatures.push({ticks:e.absoluteTime,timeSignature:[e.numerator,e.denominator]}):"setTempo"===e.type?n.tempos.push({bpm:6e7/e.microsecondsPerBeat,ticks:e.absoluteTime}):"keySignature"===e.type&&n.keySignatures.push({key:t.keySignatureKeys[e.key+7],scale:0===e.scale?"major":"minor",ticks:e.absoluteTime}))}))}));var r=0;e.tracks[0].forEach((function(e){r+=e.deltaTime,e.meta&&("trackName"===e.type?n.name=e.text:"text"!==e.type&&"cuePoint"!==e.type&&"marker"!==e.type&&"lyrics"!==e.type||n.meta.push({text:e.text,ticks:r,type:e.type}))})),this.update()}}return e.prototype.update=function(){var e=this,t=0,n=0;this.tempos.sort((function(e,t){return e.ticks-t.ticks})),this.tempos.forEach((function(r,a){var i=a>0?e.tempos[a-1].bpm:e.tempos[0].bpm,o=r.ticks/e.ppq-n,s=60/i*o;r.time=s+t,t=r.time,n+=o})),this.timeSignatures.sort((function(e,t){return e.ticks-t.ticks})),this.timeSignatures.forEach((function(t,n){var r=n>0?e.timeSignatures[n-1]:e.timeSignatures[0],a=(t.ticks-r.ticks)/e.ppq/r.timeSignature[0]/(r.timeSignature[1]/4);r.measures=r.measures||0,t.measures=a+r.measures}))},e.prototype.ticksToSeconds=function(e){var t=(0,r.search)(this.tempos,e);if(-1!==t){var n=this.tempos[t],a=n.time,i=(e-n.ticks)/this.ppq;return a+60/n.bpm*i}return.5*(e/this.ppq)},e.prototype.ticksToMeasures=function(e){var t=(0,r.search)(this.timeSignatures,e);if(-1!==t){var n=this.timeSignatures[t],a=(e-n.ticks)/this.ppq;return n.measures+a/(n.timeSignature[0]/n.timeSignature[1])/4}return e/this.ppq/4},Object.defineProperty(e.prototype,"ppq",{get:function(){return a.get(this)},enumerable:!1,configurable:!0}),e.prototype.secondsToTicks=function(e){var t=(0,r.search)(this.tempos,e,"time");if(-1!==t){var n=this.tempos[t],a=(e-n.time)/(60/n.bpm);return Math.round(n.ticks+a*this.ppq)}var i=e/.5;return Math.round(i*this.ppq)},e.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map((function(e){return{bpm:e.bpm,ticks:e.ticks}})),timeSignatures:this.timeSignatures}},e.prototype.fromJSON=function(e){this.name=e.name,this.tempos=e.tempos.map((function(e){return Object.assign({},e)})),this.timeSignatures=e.timeSignatures.map((function(e){return Object.assign({},e)})),this.keySignatures=e.keySignatures.map((function(e){return Object.assign({},e)})),this.meta=e.meta.map((function(e){return Object.assign({},e)})),a.set(this,e.ppq),this.update()},e.prototype.setTempo=function(e){this.tempos=[{bpm:e,ticks:0}],this.update()},e}();t.Header=i},9950:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Instrument=void 0;var r=n(5910),a=new WeakMap,i=function(){function e(e,t){if(this.number=0,a.set(this,t),this.number=0,e){var n=e.find((function(e){return"programChange"===e.type}));n&&(this.number=n.programNumber)}}return Object.defineProperty(e.prototype,"name",{get:function(){return this.percussion?r.DrumKitByPatchID[this.number]:r.instrumentByPatchID[this.number]},set:function(e){var t=r.instrumentByPatchID.indexOf(e);-1!==t&&(this.number=t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"family",{get:function(){return this.percussion?"drums":r.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"percussion",{get:function(){return 9===a.get(this).channel},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},e.prototype.fromJSON=function(e){this.number=e.number},e}();t.Instrument=i},5910:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DrumKitByPatchID=t.InstrumentFamilyByID=t.instrumentByPatchID=void 0,t.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],t.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],t.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},1493:function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=(a=o.trys).length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(s){i=[6,s],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.Header=t.Track=t.Midi=void 0;var i=n(8191),o=n(4809),s=n(3868),u=n(8573),c=function(){function e(e){var t=this,n=null;if(e){var r=e instanceof ArrayBuffer?new Uint8Array(e):e;(n=(0,i.parseMidi)(r)).tracks.forEach((function(e){var t=0;e.forEach((function(e){t+=e.deltaTime,e.absoluteTime=t}))})),n.tracks=function(e){for(var t=[],n=0;n<e.length;n++)for(var r=t.length,a=new Map,i=Array(16).fill(0),o=0,s=e[n];o<s.length;o++){var u=s[o],c=r,l=u.channel;if(void 0!==l){"programChange"===u.type&&(i[l]=u.programNumber);var h=i[l],f="".concat(h," ").concat(l);a.has(f)?c=a.get(f):(c=r+a.size,a.set(f,c))}t[c]||t.push([]),t[c].push(u)}return t}(n.tracks)}this.header=new o.Header(n),this.tracks=[],e&&(this.tracks=n.tracks.map((function(e){return new s.Track(e,t.header)})),1===n.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return e.fromUrl=function(t){return r(this,void 0,void 0,(function(){var n;return a(this,(function(r){switch(r.label){case 0:return[4,fetch(t)];case 1:return(n=r.sent()).ok?[4,n.arrayBuffer()]:[3,3];case 2:return[2,new e(r.sent())];case 3:throw new Error("Could not load '".concat(t,"'"))}}))}))},Object.defineProperty(e.prototype,"name",{get:function(){return this.header.name},set:function(e){this.header.name=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var e=this.tracks.map((function(e){return e.duration}));return Math.max.apply(Math,e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){var e=this.tracks.map((function(e){return e.durationTicks}));return Math.max.apply(Math,e)},enumerable:!1,configurable:!0}),e.prototype.addTrack=function(){var e=new s.Track(void 0,this.header);return this.tracks.push(e),e},e.prototype.toArray=function(){return(0,u.encode)(this)},e.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map((function(e){return e.toJSON()}))}},e.prototype.fromJSON=function(e){var t=this;this.header=new o.Header,this.header.fromJSON(e.header),this.tracks=e.tracks.map((function(e){var n=new s.Track(void 0,t.header);return n.fromJSON(e),n}))},e.prototype.clone=function(){var t=new e;return t.fromJSON(this.toJSON()),t},e}();t.Midi=c;var l=n(3868);Object.defineProperty(t,"Track",{enumerable:!0,get:function(){return l.Track}});var h=n(4809);Object.defineProperty(t,"Header",{enumerable:!0,get:function(){return h.Header}})},4477:function(e,t){"use strict";function n(e){return["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"][e%12]}Object.defineProperty(t,"__esModule",{value:!0}),t.Note=void 0;var r=function(){var e=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,t={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var r=e.exec(n),a=r[1],i=r[2];return t[a.toLowerCase()]+12*(parseInt(i,10)+1)}}(),a=new WeakMap,i=function(){function e(e,t,n){a.set(this,n),this.midi=e.midi,this.velocity=e.velocity,this.noteOffVelocity=t.velocity,this.ticks=e.ticks,this.durationTicks=t.ticks-e.ticks}return Object.defineProperty(e.prototype,"name",{get:function(){return function(e){var t=Math.floor(e/12)-1;return n(e)+t.toString()}(this.midi)},set:function(e){this.midi=r(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(e){var t=e-this.octave;this.midi+=12*t},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"pitch",{get:function(){return n(this.midi)},set:function(e){this.midi=12*(this.octave+1)+["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"].indexOf(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){var e=a.get(this);return e.ticksToSeconds(this.ticks+this.durationTicks)-e.ticksToSeconds(this.ticks)},set:function(e){var t=a.get(this).secondsToTicks(this.time+e);this.durationTicks=t-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"time",{get:function(){return a.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=a.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"bars",{get:function(){return a.get(this).ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},e}();t.Note=i},3106:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PitchBend=void 0;var n=new WeakMap,r=function(){function e(e,t){n.set(this,t),this.ticks=e.absoluteTime,this.value=e.value}return Object.defineProperty(e.prototype,"time",{get:function(){return n.get(this).ticksToSeconds(this.ticks)},set:function(e){var t=n.get(this);this.ticks=t.secondsToTicks(e)},enumerable:!1,configurable:!0}),e.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},e}();t.PitchBend=r},3868:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Track=void 0;var r=n(1146),a=n(7182),i=n(6966),o=n(3106),s=n(9950),u=n(4477),c=new WeakMap,l=function(){function e(e,t){var n=this;if(this.name="",this.notes=[],this.controlChanges=(0,i.createControlChanges)(),this.pitchBends=[],c.set(this,t),e){var r=e.find((function(e){return"trackName"===e.type}));this.name=r?r.text:""}if(this.instrument=new s.Instrument(e,this),this.channel=0,e){for(var a=e.filter((function(e){return"noteOn"===e.type})),o=e.filter((function(e){return"noteOff"===e.type})),u=function(){var e=a.shift();l.channel=e.channel;var t=o.findIndex((function(t){return t.noteNumber===e.noteNumber&&t.absoluteTime>=e.absoluteTime}));if(-1!==t){var n=o.splice(t,1)[0];l.addNote({durationTicks:n.absoluteTime-e.absoluteTime,midi:e.noteNumber,noteOffVelocity:n.velocity/127,ticks:e.absoluteTime,velocity:e.velocity/127})}},l=this;a.length;)u();e.filter((function(e){return"controller"===e.type})).forEach((function(e){n.addCC({number:e.controllerType,ticks:e.absoluteTime,value:e.value/127})})),e.filter((function(e){return"pitchBend"===e.type})).forEach((function(e){n.addPitchBend({ticks:e.absoluteTime,value:e.value/Math.pow(2,13)})}));var h=e.find((function(e){return"endOfTrack"===e.type}));this.endOfTrackTicks=void 0!==h?h.absoluteTime:void 0}}return e.prototype.addNote=function(e){var t=c.get(this),n=new u.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},t);return Object.assign(n,e),(0,r.insert)(this.notes,n,"ticks"),this},e.prototype.addCC=function(e){var t=c.get(this),n=new a.ControlChange({controllerType:e.number},t);return delete e.number,Object.assign(n,e),Array.isArray(this.controlChanges[n.number])||(this.controlChanges[n.number]=[]),(0,r.insert)(this.controlChanges[n.number],n,"ticks"),this},e.prototype.addPitchBend=function(e){var t=c.get(this),n=new o.PitchBend({},t);return Object.assign(n,e),(0,r.insert)(this.pitchBends,n,"ticks"),this},Object.defineProperty(e.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,t=0;t<this.notes.length-1;t++){var n=this.notes[t].time+this.notes[t].duration;e<n&&(e=n)}return e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var e=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,t=0;t<this.notes.length-1;t++){var n=this.notes[t].ticks+this.notes[t].durationTicks;e<n&&(e=n)}return e},enumerable:!1,configurable:!0}),e.prototype.fromJSON=function(e){var t=this;for(var n in this.name=e.name,this.channel=e.channel,this.instrument=new s.Instrument(void 0,this),this.instrument.fromJSON(e.instrument),void 0!==e.endOfTrackTicks&&(this.endOfTrackTicks=e.endOfTrackTicks),e.controlChanges)e.controlChanges[n]&&e.controlChanges[n].forEach((function(e){t.addCC({number:e.number,ticks:e.ticks,value:e.value})}));e.notes.forEach((function(e){t.addNote({durationTicks:e.durationTicks,midi:e.midi,ticks:e.ticks,velocity:e.velocity})}))},e.prototype.toJSON=function(){for(var e={},t=0;t<127;t++)this.controlChanges.hasOwnProperty(t)&&(e[t]=this.controlChanges[t].map((function(e){return e.toJSON()})));var n={channel:this.channel,controlChanges:e,pitchBends:this.pitchBends.map((function(e){return e.toJSON()})),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map((function(e){return e.toJSON()}))};return void 0!==this.endOfTrackTicks&&(n.endOfTrackTicks=this.endOfTrackTicks),n},e}();t.Track=l},6861:function(e,t,n){"use strict";function r(e){var t=[];return a(e,t),t}function a(e,t){for(var n=0;n<e.length;n++){var r=e[n];Array.isArray(r)?a(r,t):t.push(r)}}n.r(t),n.d(t,{flatten:function(){return r}})},8667:function(e,t,n){!function(e,t,n,r){"use strict";function a(e){return e&&"object"===typeof e&&"default"in e?e:{default:e}}var i=a(t),o=a(n),s=a(r),u=function(e,t,n){return{endTime:t,insertTime:n,type:"exponentialRampToValue",value:e}},c=function(e,t,n){return{endTime:t,insertTime:n,type:"linearRampToValue",value:e}},l=function(e,t){return{startTime:t,type:"setValue",value:e}},h=function(e,t,n){return{duration:n,startTime:t,type:"setValueCurve",values:e}},f=function(e,t,n){var r=n.startTime,a=n.target,i=n.timeConstant;return a+(t-a)*Math.exp((r-e)/i)},d=function(e){return"exponentialRampToValue"===e.type},p=function(e){return"linearRampToValue"===e.type},v=function(e){return d(e)||p(e)},m=function(e){return"setValue"===e.type},g=function(e){return"setValueCurve"===e.type},y=function e(t,n,r,a){var i=t[n];return void 0===i?a:v(i)||m(i)?i.value:g(i)?i.values[i.values.length-1]:f(r,e(t,n-1,i.startTime,a),i)},b=function(e,t,n,r,a){return void 0===n?[r.insertTime,a]:v(n)?[n.endTime,n.value]:m(n)?[n.startTime,n.value]:g(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,y(e,t-1,n.startTime,a)]},x=function(e){return"cancelAndHold"===e.type},k=function(e){return"cancelScheduledValues"===e.type},w=function(e){return x(e)||k(e)?e.cancelTime:d(e)||p(e)?e.endTime:e.startTime},_=function(e,t,n,r){var a=r.endTime,i=r.value;return n===i?i:0<n&&0<i||n<0&&i<0?n*Math.pow(i/n,(e-t)/(a-t)):0},S=function(e,t,n,r){return n+(e-t)/(r.endTime-t)*(r.value-n)},C=function(e,t){var n=Math.floor(t),r=Math.ceil(t);return n===r?e[n]:(1-(t-n))*e[n]+(1-(r-t))*e[r]},T=function(e,t){var n=t.duration,r=t.startTime,a=t.values,i=(e-r)/n*(a.length-1);return C(a,i)},E=function(e){return"setTarget"===e.type},I=function(e){function t(e){o.default(this,t),this._automationEvents=[],this._currenTime=0,this._defaultValue=e}return s.default(t,[{key:e,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(e){var t=w(e);if(x(e)||k(e)){var n=this._automationEvents.findIndex((function(n){return k(e)&&g(n)?n.startTime+n.duration>=t:w(n)>=t})),r=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),x(e)){var a=this._automationEvents[this._automationEvents.length-1];if(void 0!==r&&v(r)){if(E(a))throw new Error("The internal list is malformed.");var i=g(a)?a.startTime+a.duration:w(a),o=g(a)?a.values[a.values.length-1]:a.value,s=d(r)?_(t,i,o,r):S(t,i,o,r),f=d(r)?u(s,t,this._currenTime):c(s,t,this._currenTime);this._automationEvents.push(f)}void 0!==a&&E(a)&&this._automationEvents.push(l(this.getValue(t),t)),void 0!==a&&g(a)&&a.startTime+a.duration>t&&(this._automationEvents[this._automationEvents.length-1]=h(new Float32Array([6,7]),a.startTime,t-a.startTime))}}else{var m=this._automationEvents.findIndex((function(e){return w(e)>t})),y=-1===m?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[m-1];if(void 0!==y&&g(y)&&w(y)+y.duration>t)return!1;var b=d(e)?u(e.value,e.endTime,this._currenTime):p(e)?c(e.value,t,this._currenTime):e;if(-1===m)this._automationEvents.push(b);else{if(g(e)&&t+e.duration>w(this._automationEvents[m]))return!1;this._automationEvents.splice(m,0,b)}}return!0}},{key:"flush",value:function(e){var t=this._automationEvents.findIndex((function(t){return w(t)>e}));if(t>1){var n=this._automationEvents.slice(t-1),r=n[0];E(r)&&n.unshift(l(y(this._automationEvents,t-2,r.startTime,this._defaultValue),r.startTime)),this._automationEvents=n}}},{key:"getValue",value:function(e){if(0===this._automationEvents.length)return this._defaultValue;var t=this._automationEvents.findIndex((function(t){return w(t)>e})),n=this._automationEvents[t],r=(-1===t?this._automationEvents.length:t)-1,a=this._automationEvents[r];if(void 0!==a&&E(a)&&(void 0===n||!v(n)||n.insertTime>e))return f(e,y(this._automationEvents,r-1,a.startTime,this._defaultValue),a);if(void 0!==a&&m(a)&&(void 0===n||!v(n)))return a.value;if(void 0!==a&&g(a)&&(void 0===n||!v(n)||a.startTime+a.duration>e))return e<a.startTime+a.duration?T(e,a):a.values[a.values.length-1];if(void 0!==a&&v(a)&&(void 0===n||!v(n)))return a.value;if(void 0!==n&&d(n)){var o=b(this._automationEvents,r,a,n,this._defaultValue),s=i.default(o,2),u=s[0],c=s[1];return _(e,u,c,n)}if(void 0!==n&&p(n)){var l=b(this._automationEvents,r,a,n,this._defaultValue),h=i.default(l,2),x=h[0],k=h[1];return S(e,x,k,n)}return this._defaultValue}}]),t}(Symbol.iterator),A=function(e){return{cancelTime:e,type:"cancelAndHold"}},M=function(e){return{cancelTime:e,type:"cancelScheduledValues"}},N=function(e,t){return{endTime:t,type:"exponentialRampToValue",value:e}},R=function(e,t){return{endTime:t,type:"linearRampToValue",value:e}},D=function(e,t,n){return{startTime:t,target:e,timeConstant:n,type:"setTarget"}};e.AutomationEventList=I,e.createCancelAndHoldAutomationEvent=A,e.createCancelScheduledValuesAutomationEvent=M,e.createExponentialRampToValueAutomationEvent=N,e.createLinearRampToValueAutomationEvent=R,e.createSetTargetAutomationEvent=D,e.createSetValueAutomationEvent=l,e.createSetValueCurveAutomationEvent=h,Object.defineProperty(e,"__esModule",{value:!0})}(t,n(5463),n(8860),n(9450))},2009:function(e,t){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,i=u(e),o=i[0],s=i[1],c=new a(function(e,t,n){return 3*(t+n)/4-n}(0,o,s)),l=0,h=s>0?o-4:o;for(n=0;n<h;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],c[l++]=t>>16&255,c[l++]=t>>8&255,c[l++]=255&t;2===s&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,c[l++]=255&t);1===s&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,c[l++]=t>>8&255,c[l++]=255&t);return c},t.fromByteArray=function(e){for(var t,r=e.length,a=r%3,i=[],o=16383,s=0,u=r-a;s<u;s+=o)i.push(c(e,s,s+o>u?u:s+o));1===a?(t=e[r-1],i.push(n[t>>2]+n[t<<4&63]+"==")):2===a&&(t=(e[r-2]<<8)+e[r-1],i.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"="));return i.join("")};for(var n=[],r=[],a="undefined"!==typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,s=i.length;o<s;++o)n[o]=i[o],r[i.charCodeAt(o)]=o;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function c(e,t,r){for(var a,i,o=[],s=t;s<r;s+=3)a=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]),o.push(n[(i=a)>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return o.join("")}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},5844:function(e,t){"use strict";function n(e){var t=32;return(e&=-e)&&t--,65535&e&&(t-=16),16711935&e&&(t-=8),252645135&e&&(t-=4),858993459&e&&(t-=2),1431655765&e&&(t-=1),t}t.INT_BITS=32,t.INT_MAX=2147483647,t.INT_MIN=-1<<31,t.sign=function(e){return(e>0)-(e<0)},t.abs=function(e){var t=e>>31;return(e^t)-t},t.min=function(e,t){return t^(e^t)&-(e<t)},t.max=function(e,t){return e^(e^t)&-(e<t)},t.isPow2=function(e){return!(e&e-1)&&!!e},t.log2=function(e){var t,n;return t=(e>65535)<<4,t|=n=((e>>>=t)>255)<<3,t|=n=((e>>>=n)>15)<<2,(t|=n=((e>>>=n)>3)<<1)|(e>>>=n)>>1},t.log10=function(e){return e>=1e9?9:e>=1e8?8:e>=1e7?7:e>=1e6?6:e>=1e5?5:e>=1e4?4:e>=1e3?3:e>=100?2:e>=10?1:0},t.popCount=function(e){return 16843009*((e=(858993459&(e-=e>>>1&1431655765))+(e>>>2&858993459))+(e>>>4)&252645135)>>>24},t.countTrailingZeros=n,t.nextPow2=function(e){return e+=0===e,--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},t.prevPow2=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},t.parity=function(e){return e^=e>>>16,e^=e>>>8,e^=e>>>4,27030>>>(e&=15)&1};var r=new Array(256);!function(e){for(var t=0;t<256;++t){var n=t,r=t,a=7;for(n>>>=1;n;n>>>=1)r<<=1,r|=1&n,--a;e[t]=r<<a&255}}(r),t.reverse=function(e){return r[255&e]<<24|r[e>>>8&255]<<16|r[e>>>16&255]<<8|r[e>>>24&255]},t.interleave2=function(e,t){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))<<1},t.deinterleave2=function(e,t){return(e=65535&((e=16711935&((e=252645135&((e=858993459&((e=e>>>t&1431655765)|e>>>1))|e>>>2))|e>>>4))|e>>>16))<<16>>16},t.interleave3=function(e,t,n){return e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2),(e|=(t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},t.deinterleave3=function(e,t){return(e=1023&((e=4278190335&((e=251719695&((e=3272356035&((e=e>>>t&1227133513)|e>>>2))|e>>>4))|e>>>8))|e>>>16))<<22>>22},t.nextCombination=function(e){var t=e|e-1;return t+1|(~t&-~t)-1>>>n(e)+1}},9778:function(e,t,n){"use strict";var r=n(2009),a=n(4038),i="function"===typeof Symbol&&"function"===typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;t.lW=u,t.h2=50;var o=2147483647;function s(e){if(e>o)throw new RangeError('The value "'+e+'" is invalid for option "size"');var t=new Uint8Array(e);return Object.setPrototypeOf(t,u.prototype),t}function u(e,t,n){if("number"===typeof e){if("string"===typeof t)throw new TypeError('The "string" argument must be of type string. Received type number');return h(e)}return c(e,t,n)}function c(e,t,n){if("string"===typeof e)return function(e,t){"string"===typeof t&&""!==t||(t="utf8");if(!u.isEncoding(t))throw new TypeError("Unknown encoding: "+t);var n=0|v(e,t),r=s(n),a=r.write(e,t);a!==n&&(r=r.slice(0,a));return r}(e,t);if(ArrayBuffer.isView(e))return function(e){if(V(e,Uint8Array)){var t=new Uint8Array(e);return d(t.buffer,t.byteOffset,t.byteLength)}return f(e)}(e);if(null==e)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e);if(V(e,ArrayBuffer)||e&&V(e.buffer,ArrayBuffer))return d(e,t,n);if("undefined"!==typeof SharedArrayBuffer&&(V(e,SharedArrayBuffer)||e&&V(e.buffer,SharedArrayBuffer)))return d(e,t,n);if("number"===typeof e)throw new TypeError('The "value" argument must not be of type number. Received type number');var r=e.valueOf&&e.valueOf();if(null!=r&&r!==e)return u.from(r,t,n);var a=function(e){if(u.isBuffer(e)){var t=0|p(e.length),n=s(t);return 0===n.length||e.copy(n,0,0,t),n}if(void 0!==e.length)return"number"!==typeof e.length||W(e.length)?s(0):f(e);if("Buffer"===e.type&&Array.isArray(e.data))return f(e.data)}(e);if(a)return a;if("undefined"!==typeof Symbol&&null!=Symbol.toPrimitive&&"function"===typeof e[Symbol.toPrimitive])return u.from(e[Symbol.toPrimitive]("string"),t,n);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof e)}function l(e){if("number"!==typeof e)throw new TypeError('"size" argument must be of type number');if(e<0)throw new RangeError('The value "'+e+'" is invalid for option "size"')}function h(e){return l(e),s(e<0?0:0|p(e))}function f(e){for(var t=e.length<0?0:0|p(e.length),n=s(t),r=0;r<t;r+=1)n[r]=255&e[r];return n}function d(e,t,n){if(t<0||e.byteLength<t)throw new RangeError('"offset" is outside of buffer bounds');if(e.byteLength<t+(n||0))throw new RangeError('"length" is outside of buffer bounds');var r;return r=void 0===t&&void 0===n?new Uint8Array(e):void 0===n?new Uint8Array(e,t):new Uint8Array(e,t,n),Object.setPrototypeOf(r,u.prototype),r}function p(e){if(e>=o)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+o.toString(16)+" bytes");return 0|e}function v(e,t){if(u.isBuffer(e))return e.length;if(ArrayBuffer.isView(e)||V(e,ArrayBuffer))return e.byteLength;if("string"!==typeof e)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof e);var n=e.length,r=arguments.length>2&&!0===arguments[2];if(!r&&0===n)return 0;for(var a=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":return z(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return B(e).length;default:if(a)return r?-1:z(e).length;t=(""+t).toLowerCase(),a=!0}}function m(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return M(this,t,n);case"utf8":case"utf-8":return T(this,t,n);case"ascii":return I(this,t,n);case"latin1":case"binary":return A(this,t,n);case"base64":return C(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return N(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function g(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function y(e,t,n,r,a){if(0===e.length)return-1;if("string"===typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),W(n=+n)&&(n=a?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(a)return-1;n=e.length-1}else if(n<0){if(!a)return-1;n=0}if("string"===typeof t&&(t=u.from(t,r)),u.isBuffer(t))return 0===t.length?-1:b(e,t,n,r,a);if("number"===typeof t)return t&=255,"function"===typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):b(e,[t],n,r,a);throw new TypeError("val must be string, number or Buffer")}function b(e,t,n,r,a){var i,o=1,s=e.length,u=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;o=2,s/=2,u/=2,n/=2}function c(e,t){return 1===o?e[t]:e.readUInt16BE(t*o)}if(a){var l=-1;for(i=n;i<s;i++)if(c(e,i)===c(t,-1===l?0:i-l)){if(-1===l&&(l=i),i-l+1===u)return l*o}else-1!==l&&(i-=i-l),l=-1}else for(n+u>s&&(n=s-u),i=n;i>=0;i--){for(var h=!0,f=0;f<u;f++)if(c(e,i+f)!==c(t,f)){h=!1;break}if(h)return i}return-1}function x(e,t,n,r){n=Number(n)||0;var a=e.length-n;r?(r=Number(r))>a&&(r=a):r=a;var i=t.length;r>i/2&&(r=i/2);for(var o=0;o<r;++o){var s=parseInt(t.substr(2*o,2),16);if(W(s))return o;e[n+o]=s}return o}function k(e,t,n,r){return U(z(t,e.length-n),e,n,r)}function w(e,t,n,r){return U(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function _(e,t,n,r){return U(B(t),e,n,r)}function S(e,t,n,r){return U(function(e,t){for(var n,r,a,i=[],o=0;o<e.length&&!((t-=2)<0);++o)r=(n=e.charCodeAt(o))>>8,a=n%256,i.push(a),i.push(r);return i}(t,e.length-n),e,n,r)}function C(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function T(e,t,n){n=Math.min(e.length,n);for(var r=[],a=t;a<n;){var i,o,s,u,c=e[a],l=null,h=c>239?4:c>223?3:c>191?2:1;if(a+h<=n)switch(h){case 1:c<128&&(l=c);break;case 2:128===(192&(i=e[a+1]))&&(u=(31&c)<<6|63&i)>127&&(l=u);break;case 3:i=e[a+1],o=e[a+2],128===(192&i)&&128===(192&o)&&(u=(15&c)<<12|(63&i)<<6|63&o)>2047&&(u<55296||u>57343)&&(l=u);break;case 4:i=e[a+1],o=e[a+2],s=e[a+3],128===(192&i)&&128===(192&o)&&128===(192&s)&&(u=(15&c)<<18|(63&i)<<12|(63&o)<<6|63&s)>65535&&u<1114112&&(l=u)}null===l?(l=65533,h=1):l>65535&&(l-=65536,r.push(l>>>10&1023|55296),l=56320|1023&l),r.push(l),a+=h}return function(e){var t=e.length;if(t<=E)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=E));return n}(r)}u.TYPED_ARRAY_SUPPORT=function(){try{var e=new Uint8Array(1),t={foo:function(){return 42}};return Object.setPrototypeOf(t,Uint8Array.prototype),Object.setPrototypeOf(e,t),42===e.foo()}catch(n){return!1}}(),u.TYPED_ARRAY_SUPPORT||"undefined"===typeof console||"function"!==typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(u.prototype,"parent",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.buffer}}),Object.defineProperty(u.prototype,"offset",{enumerable:!0,get:function(){if(u.isBuffer(this))return this.byteOffset}}),u.poolSize=8192,u.from=function(e,t,n){return c(e,t,n)},Object.setPrototypeOf(u.prototype,Uint8Array.prototype),Object.setPrototypeOf(u,Uint8Array),u.alloc=function(e,t,n){return function(e,t,n){return l(e),e<=0?s(e):void 0!==t?"string"===typeof n?s(e).fill(t,n):s(e).fill(t):s(e)}(e,t,n)},u.allocUnsafe=function(e){return h(e)},u.allocUnsafeSlow=function(e){return h(e)},u.isBuffer=function(e){return null!=e&&!0===e._isBuffer&&e!==u.prototype},u.compare=function(e,t){if(V(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),V(t,Uint8Array)&&(t=u.from(t,t.offset,t.byteLength)),!u.isBuffer(e)||!u.isBuffer(t))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(e===t)return 0;for(var n=e.length,r=t.length,a=0,i=Math.min(n,r);a<i;++a)if(e[a]!==t[a]){n=e[a],r=t[a];break}return n<r?-1:r<n?1:0},u.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},u.concat=function(e,t){if(!Array.isArray(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return u.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=u.allocUnsafe(t),a=0;for(n=0;n<e.length;++n){var i=e[n];if(V(i,Uint8Array))a+i.length>r.length?u.from(i).copy(r,a):Uint8Array.prototype.set.call(r,i,a);else{if(!u.isBuffer(i))throw new TypeError('"list" argument must be an Array of Buffers');i.copy(r,a)}a+=i.length}return r},u.byteLength=v,u.prototype._isBuffer=!0,u.prototype.swap16=function(){var e=this.length;if(e%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)g(this,t,t+1);return this},u.prototype.swap32=function(){var e=this.length;if(e%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)g(this,t,t+3),g(this,t+1,t+2);return this},u.prototype.swap64=function(){var e=this.length;if(e%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)g(this,t,t+7),g(this,t+1,t+6),g(this,t+2,t+5),g(this,t+3,t+4);return this},u.prototype.toString=function(){var e=this.length;return 0===e?"":0===arguments.length?T(this,0,e):m.apply(this,arguments)},u.prototype.toLocaleString=u.prototype.toString,u.prototype.equals=function(e){if(!u.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===u.compare(this,e)},u.prototype.inspect=function(){var e="",n=t.h2;return e=this.toString("hex",0,n).replace(/(.{2})/g,"$1 ").trim(),this.length>n&&(e+=" ... "),"<Buffer "+e+">"},i&&(u.prototype[i]=u.prototype.inspect),u.prototype.compare=function(e,t,n,r,a){if(V(e,Uint8Array)&&(e=u.from(e,e.offset,e.byteLength)),!u.isBuffer(e))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof e);if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===a&&(a=this.length),t<0||n>e.length||r<0||a>this.length)throw new RangeError("out of range index");if(r>=a&&t>=n)return 0;if(r>=a)return-1;if(t>=n)return 1;if(this===e)return 0;for(var i=(a>>>=0)-(r>>>=0),o=(n>>>=0)-(t>>>=0),s=Math.min(i,o),c=this.slice(r,a),l=e.slice(t,n),h=0;h<s;++h)if(c[h]!==l[h]){i=c[h],o=l[h];break}return i<o?-1:o<i?1:0},u.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},u.prototype.indexOf=function(e,t,n){return y(this,e,t,n,!0)},u.prototype.lastIndexOf=function(e,t,n){return y(this,e,t,n,!1)},u.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"===typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t>>>=0,isFinite(n)?(n>>>=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var a=this.length-t;if((void 0===n||n>a)&&(n=a),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var i=!1;;)switch(r){case"hex":return x(this,e,t,n);case"utf8":case"utf-8":return k(this,e,t,n);case"ascii":case"latin1":case"binary":return w(this,e,t,n);case"base64":return _(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return S(this,e,t,n);default:if(i)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),i=!0}},u.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var E=4096;function I(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(127&e[a]);return r}function A(e,t,n){var r="";n=Math.min(e.length,n);for(var a=t;a<n;++a)r+=String.fromCharCode(e[a]);return r}function M(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var a="",i=t;i<n;++i)a+=G[e[i]];return a}function N(e,t,n){for(var r=e.slice(t,n),a="",i=0;i<r.length-1;i+=2)a+=String.fromCharCode(r[i]+256*r[i+1]);return a}function R(e,t,n){if(e%1!==0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function D(e,t,n,r,a,i){if(!u.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>a||t<i)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function P(e,t,n,r,a,i){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function O(e,t,n,r,i){return t=+t,n>>>=0,i||P(e,0,n,4),a.write(e,t,n,r,23,4),n+4}function L(e,t,n,r,i){return t=+t,n>>>=0,i||P(e,0,n,8),a.write(e,t,n,r,52,8),n+8}u.prototype.slice=function(e,t){var n=this.length;(e=~~e)<0?(e+=n)<0&&(e=0):e>n&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):t>n&&(t=n),t<e&&(t=e);var r=this.subarray(e,t);return Object.setPrototypeOf(r,u.prototype),r},u.prototype.readUintLE=u.prototype.readUIntLE=function(e,t,n){e>>>=0,t>>>=0,n||R(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r},u.prototype.readUintBE=u.prototype.readUIntBE=function(e,t,n){e>>>=0,t>>>=0,n||R(e,t,this.length);for(var r=this[e+--t],a=1;t>0&&(a*=256);)r+=this[e+--t]*a;return r},u.prototype.readUint8=u.prototype.readUInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),this[e]},u.prototype.readUint16LE=u.prototype.readUInt16LE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]|this[e+1]<<8},u.prototype.readUint16BE=u.prototype.readUInt16BE=function(e,t){return e>>>=0,t||R(e,2,this.length),this[e]<<8|this[e+1]},u.prototype.readUint32LE=u.prototype.readUInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},u.prototype.readUint32BE=u.prototype.readUInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},u.prototype.readIntLE=function(e,t,n){e>>>=0,t>>>=0,n||R(e,t,this.length);for(var r=this[e],a=1,i=0;++i<t&&(a*=256);)r+=this[e+i]*a;return r>=(a*=128)&&(r-=Math.pow(2,8*t)),r},u.prototype.readIntBE=function(e,t,n){e>>>=0,t>>>=0,n||R(e,t,this.length);for(var r=t,a=1,i=this[e+--r];r>0&&(a*=256);)i+=this[e+--r]*a;return i>=(a*=128)&&(i-=Math.pow(2,8*t)),i},u.prototype.readInt8=function(e,t){return e>>>=0,t||R(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},u.prototype.readInt16LE=function(e,t){e>>>=0,t||R(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt16BE=function(e,t){e>>>=0,t||R(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},u.prototype.readInt32LE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},u.prototype.readInt32BE=function(e,t){return e>>>=0,t||R(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},u.prototype.readFloatLE=function(e,t){return e>>>=0,t||R(e,4,this.length),a.read(this,e,!0,23,4)},u.prototype.readFloatBE=function(e,t){return e>>>=0,t||R(e,4,this.length),a.read(this,e,!1,23,4)},u.prototype.readDoubleLE=function(e,t){return e>>>=0,t||R(e,8,this.length),a.read(this,e,!0,52,8)},u.prototype.readDoubleBE=function(e,t){return e>>>=0,t||R(e,8,this.length),a.read(this,e,!1,52,8)},u.prototype.writeUintLE=u.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||D(this,e,t,n,Math.pow(2,8*n)-1,0);var a=1,i=0;for(this[t]=255&e;++i<n&&(a*=256);)this[t+i]=e/a&255;return t+n},u.prototype.writeUintBE=u.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t>>>=0,n>>>=0,r)||D(this,e,t,n,Math.pow(2,8*n)-1,0);var a=n-1,i=1;for(this[t+a]=255&e;--a>=0&&(i*=256);)this[t+a]=e/i&255;return t+n},u.prototype.writeUint8=u.prototype.writeUInt8=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,1,255,0),this[t]=255&e,t+1},u.prototype.writeUint16LE=u.prototype.writeUInt16LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,65535,0),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeUint16BE=u.prototype.writeUInt16BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,65535,0),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeUint32LE=u.prototype.writeUInt32LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,4294967295,0),this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e,t+4},u.prototype.writeUint32BE=u.prototype.writeUInt32BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,4294967295,0),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var a=Math.pow(2,8*n-1);D(this,e,t,n,a-1,-a)}var i=0,o=1,s=0;for(this[t]=255&e;++i<n&&(o*=256);)e<0&&0===s&&0!==this[t+i-1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},u.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t>>>=0,!r){var a=Math.pow(2,8*n-1);D(this,e,t,n,a-1,-a)}var i=n-1,o=1,s=0;for(this[t+i]=255&e;--i>=0&&(o*=256);)e<0&&0===s&&0!==this[t+i+1]&&(s=1),this[t+i]=(e/o>>0)-s&255;return t+n},u.prototype.writeInt8=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,1,127,-128),e<0&&(e=255+e+1),this[t]=255&e,t+1},u.prototype.writeInt16LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,32767,-32768),this[t]=255&e,this[t+1]=e>>>8,t+2},u.prototype.writeInt16BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,2,32767,-32768),this[t]=e>>>8,this[t+1]=255&e,t+2},u.prototype.writeInt32LE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,2147483647,-2147483648),this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24,t+4},u.prototype.writeInt32BE=function(e,t,n){return e=+e,t>>>=0,n||D(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e,t+4},u.prototype.writeFloatLE=function(e,t,n){return O(this,e,t,!0,n)},u.prototype.writeFloatBE=function(e,t,n){return O(this,e,t,!1,n)},u.prototype.writeDoubleLE=function(e,t,n){return L(this,e,t,!0,n)},u.prototype.writeDoubleBE=function(e,t,n){return L(this,e,t,!1,n)},u.prototype.copy=function(e,t,n,r){if(!u.isBuffer(e))throw new TypeError("argument should be a Buffer");if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("Index out of range");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var a=r-n;return this===e&&"function"===typeof Uint8Array.prototype.copyWithin?this.copyWithin(t,n,r):Uint8Array.prototype.set.call(e,this.subarray(n,r),t),a},u.prototype.fill=function(e,t,n,r){if("string"===typeof e){if("string"===typeof t?(r=t,t=0,n=this.length):"string"===typeof n&&(r=n,n=this.length),void 0!==r&&"string"!==typeof r)throw new TypeError("encoding must be a string");if("string"===typeof r&&!u.isEncoding(r))throw new TypeError("Unknown encoding: "+r);if(1===e.length){var a=e.charCodeAt(0);("utf8"===r&&a<128||"latin1"===r)&&(e=a)}}else"number"===typeof e?e&=255:"boolean"===typeof e&&(e=Number(e));if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var i;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"===typeof e)for(i=t;i<n;++i)this[i]=e;else{var o=u.isBuffer(e)?e:u.from(e,r),s=o.length;if(0===s)throw new TypeError('The value "'+e+'" is invalid for argument "value"');for(i=0;i<n-t;++i)this[i+t]=o[i%s]}return this};var F=/[^+/0-9A-Za-z-_]/g;function z(e,t){var n;t=t||1/0;for(var r=e.length,a=null,i=[],o=0;o<r;++o){if((n=e.charCodeAt(o))>55295&&n<57344){if(!a){if(n>56319){(t-=3)>-1&&i.push(239,191,189);continue}if(o+1===r){(t-=3)>-1&&i.push(239,191,189);continue}a=n;continue}if(n<56320){(t-=3)>-1&&i.push(239,191,189),a=n;continue}n=65536+(a-55296<<10|n-56320)}else a&&(t-=3)>-1&&i.push(239,191,189);if(a=null,n<128){if((t-=1)<0)break;i.push(n)}else if(n<2048){if((t-=2)<0)break;i.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;i.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;i.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return i}function B(e){return r.toByteArray(function(e){if((e=(e=e.split("=")[0]).trim().replace(F,"")).length<2)return"";for(;e.length%4!==0;)e+="=";return e}(e))}function U(e,t,n,r){for(var a=0;a<r&&!(a+n>=t.length||a>=e.length);++a)t[a+n]=e[a];return a}function V(e,t){return e instanceof t||null!=e&&null!=e.constructor&&null!=e.constructor.name&&e.constructor.name===t.name}function W(e){return e!==e}var G=function(){for(var e="0123456789abcdef",t=new Array(256),n=0;n<16;++n)for(var r=16*n,a=0;a<16;++a)t[r+a]=e[n]+e[a];return t}()},7549:function(e,t,n){"use strict";var r=n(6747);function a(){this.argTypes=[],this.shimArgs=[],this.arrayArgs=[],this.arrayBlockIndices=[],this.scalarArgs=[],this.offsetArgs=[],this.offsetArgIndex=[],this.indexArgs=[],this.shapeArgs=[],this.funcName="",this.pre=null,this.body=null,this.post=null,this.debug=!1}e.exports=function(e){var t=new a;t.pre=e.pre,t.body=e.body,t.post=e.post;var n=e.args.slice(0);t.argTypes=n;for(var i=0;i<n.length;++i){var o=n[i];if("array"===o||"object"===typeof o&&o.blockIndices){if(t.argTypes[i]="array",t.arrayArgs.push(i),t.arrayBlockIndices.push(o.blockIndices?o.blockIndices:0),t.shimArgs.push("array"+i),i<t.pre.args.length&&t.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array args");if(i<t.post.args.length&&t.post.args[i].count>0)throw new Error("cwise: post() block may not reference array args")}else if("scalar"===o)t.scalarArgs.push(i),t.shimArgs.push("scalar"+i);else if("index"===o){if(t.indexArgs.push(i),i<t.pre.args.length&&t.pre.args[i].count>0)throw new Error("cwise: pre() block may not reference array index");if(i<t.body.args.length&&t.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array index");if(i<t.post.args.length&&t.post.args[i].count>0)throw new Error("cwise: post() block may not reference array index")}else if("shape"===o){if(t.shapeArgs.push(i),i<t.pre.args.length&&t.pre.args[i].lvalue)throw new Error("cwise: pre() block may not write to array shape");if(i<t.body.args.length&&t.body.args[i].lvalue)throw new Error("cwise: body() block may not write to array shape");if(i<t.post.args.length&&t.post.args[i].lvalue)throw new Error("cwise: post() block may not write to array shape")}else{if("object"!==typeof o||!o.offset)throw new Error("cwise: Unknown argument type "+n[i]);t.argTypes[i]="offset",t.offsetArgs.push({array:o.array,offset:o.offset}),t.offsetArgIndex.push(i)}}if(t.arrayArgs.length<=0)throw new Error("cwise: No array arguments specified");if(t.pre.args.length>n.length)throw new Error("cwise: Too many arguments in pre() block");if(t.body.args.length>n.length)throw new Error("cwise: Too many arguments in body() block");if(t.post.args.length>n.length)throw new Error("cwise: Too many arguments in post() block");return t.debug=!!e.printCode||!!e.debug,t.funcName=e.funcName||"cwise",t.blockSize=e.blockSize||64,r(t)}},5154:function(e,t,n){"use strict";var r=n(8871);function a(e,t,n){var r,a,i=e.length,o=t.arrayArgs.length,s=t.indexArgs.length>0,u=[],c=[],l=0,h=0;for(r=0;r<i;++r)c.push(["i",r,"=0"].join(""));for(a=0;a<o;++a)for(r=0;r<i;++r)h=l,l=e[r],0===r?c.push(["d",a,"s",r,"=t",a,"p",l].join("")):c.push(["d",a,"s",r,"=(t",a,"p",l,"-s",h,"*t",a,"p",h,")"].join(""));for(c.length>0&&u.push("var "+c.join(",")),r=i-1;r>=0;--r)l=e[r],u.push(["for(i",r,"=0;i",r,"<s",l,";++i",r,"){"].join(""));for(u.push(n),r=0;r<i;++r){for(h=l,l=e[r],a=0;a<o;++a)u.push(["p",a,"+=d",a,"s",r].join(""));s&&(r>0&&u.push(["index[",h,"]-=s",h].join("")),u.push(["++index[",l,"]"].join(""))),u.push("}")}return u.join("\n")}function i(e,t,n){for(var r=e.body,a=[],i=[],o=0;o<e.args.length;++o){var s=e.args[o];if(!(s.count<=0)){var u=new RegExp(s.name,"g"),c="",l=t.arrayArgs.indexOf(o);switch(t.argTypes[o]){case"offset":var h=t.offsetArgIndex.indexOf(o);l=t.offsetArgs[h].array,c="+q"+h;case"array":c="p"+l+c;var f="l"+o,d="a"+l;if(0===t.arrayBlockIndices[l])1===s.count?"generic"===n[l]?s.lvalue?(a.push(["var ",f,"=",d,".get(",c,")"].join("")),r=r.replace(u,f),i.push([d,".set(",c,",",f,")"].join(""))):r=r.replace(u,[d,".get(",c,")"].join("")):r=r.replace(u,[d,"[",c,"]"].join("")):"generic"===n[l]?(a.push(["var ",f,"=",d,".get(",c,")"].join("")),r=r.replace(u,f),s.lvalue&&i.push([d,".set(",c,",",f,")"].join(""))):(a.push(["var ",f,"=",d,"[",c,"]"].join("")),r=r.replace(u,f),s.lvalue&&i.push([d,"[",c,"]=",f].join("")));else{for(var p=[s.name],v=[c],m=0;m<Math.abs(t.arrayBlockIndices[l]);m++)p.push("\\s*\\[([^\\]]+)\\]"),v.push("$"+(m+1)+"*t"+l+"b"+m);if(u=new RegExp(p.join(""),"g"),c=v.join("+"),"generic"===n[l])throw new Error("cwise: Generic arrays not supported in combination with blocks!");r=r.replace(u,[d,"[",c,"]"].join(""))}break;case"scalar":r=r.replace(u,"Y"+t.scalarArgs.indexOf(o));break;case"index":r=r.replace(u,"index");break;case"shape":r=r.replace(u,"shape")}}}return[a.join("\n"),r,i.join("\n")].join("\n").trim()}function o(e){for(var t=new Array(e.length),n=!0,r=0;r<e.length;++r){var a=e[r],i=a.match(/\d+/);i=i?i[0]:"",0===a.charAt(0)?t[r]="u"+a.charAt(1)+i:t[r]=a.charAt(0)+i,r>0&&(n=n&&t[r]===t[r-1])}return n?t[0]:t.join("")}e.exports=function(e,t){for(var n=t[1].length-Math.abs(e.arrayBlockIndices[0])|0,s=new Array(e.arrayArgs.length),u=new Array(e.arrayArgs.length),c=0;c<e.arrayArgs.length;++c)u[c]=t[2*c],s[c]=t[2*c+1];var l=[],h=[],f=[],d=[],p=[];for(c=0;c<e.arrayArgs.length;++c){e.arrayBlockIndices[c]<0?(f.push(0),d.push(n),l.push(n),h.push(n+e.arrayBlockIndices[c])):(f.push(e.arrayBlockIndices[c]),d.push(e.arrayBlockIndices[c]+n),l.push(0),h.push(e.arrayBlockIndices[c]));for(var v=[],m=0;m<s[c].length;m++)f[c]<=s[c][m]&&s[c][m]<d[c]&&v.push(s[c][m]-f[c]);p.push(v)}var g=["SS"],y=["'use strict'"],b=[];for(m=0;m<n;++m)b.push(["s",m,"=SS[",m,"]"].join(""));for(c=0;c<e.arrayArgs.length;++c){g.push("a"+c),g.push("t"+c),g.push("p"+c);for(m=0;m<n;++m)b.push(["t",c,"p",m,"=t",c,"[",f[c]+m,"]"].join(""));for(m=0;m<Math.abs(e.arrayBlockIndices[c]);++m)b.push(["t",c,"b",m,"=t",c,"[",l[c]+m,"]"].join(""))}for(c=0;c<e.scalarArgs.length;++c)g.push("Y"+c);if(e.shapeArgs.length>0&&b.push("shape=SS.slice(0)"),e.indexArgs.length>0){var x=new Array(n);for(c=0;c<n;++c)x[c]="0";b.push(["index=[",x.join(","),"]"].join(""))}for(c=0;c<e.offsetArgs.length;++c){var k=e.offsetArgs[c],w=[];for(m=0;m<k.offset.length;++m)0!==k.offset[m]&&(1===k.offset[m]?w.push(["t",k.array,"p",m].join("")):w.push([k.offset[m],"*t",k.array,"p",m].join("")));0===w.length?b.push("q"+c+"=0"):b.push(["q",c,"=",w.join("+")].join(""))}var _=r([].concat(e.pre.thisVars).concat(e.body.thisVars).concat(e.post.thisVars));for((b=b.concat(_)).length>0&&y.push("var "+b.join(",")),c=0;c<e.arrayArgs.length;++c)y.push("p"+c+"|=0");e.pre.body.length>3&&y.push(i(e.pre,e,u));var S=i(e.body,e,u),C=function(e){for(var t=0,n=e[0].length;t<n;){for(var r=1;r<e.length;++r)if(e[r][t]!==e[0][t])return t;++t}return t}(p);C<n?y.push(function(e,t,n,r){for(var i=t.length,o=n.arrayArgs.length,s=n.blockSize,u=n.indexArgs.length>0,c=[],l=0;l<o;++l)c.push(["var offset",l,"=p",l].join(""));for(l=e;l<i;++l)c.push(["for(var j"+l+"=SS[",t[l],"]|0;j",l,">0;){"].join("")),c.push(["if(j",l,"<",s,"){"].join("")),c.push(["s",t[l],"=j",l].join("")),c.push(["j",l,"=0"].join("")),c.push(["}else{s",t[l],"=",s].join("")),c.push(["j",l,"-=",s,"}"].join("")),u&&c.push(["index[",t[l],"]=j",l].join(""));for(l=0;l<o;++l){for(var h=["offset"+l],f=e;f<i;++f)h.push(["j",f,"*t",l,"p",t[f]].join(""));c.push(["p",l,"=(",h.join("+"),")"].join(""))}for(c.push(a(t,n,r)),l=e;l<i;++l)c.push("}");return c.join("\n")}(C,p[0],e,S)):y.push(a(p[0],e,S)),e.post.body.length>3&&y.push(i(e.post,e,u)),e.debug&&console.log("-----Generated cwise routine for ",t,":\n"+y.join("\n")+"\n----------");var T=[e.funcName||"unnamed","_cwise_loop_",s[0].join("s"),"m",C,o(u)].join("");return new Function(["function ",T,"(",g.join(","),"){",y.join("\n"),"} return ",T].join(""))()}},6747:function(e,t,n){"use strict";var r=n(5154);e.exports=function(e){var t=["'use strict'","var CACHED={}"],n=[],a=e.funcName+"_cwise_thunk";t.push(["return function ",a,"(",e.shimArgs.join(","),"){"].join(""));for(var i=[],o=[],s=[["array",e.arrayArgs[0],".shape.slice(",Math.max(0,e.arrayBlockIndices[0]),e.arrayBlockIndices[0]<0?","+e.arrayBlockIndices[0]+")":")"].join("")],u=[],c=[],l=0;l<e.arrayArgs.length;++l){var h=e.arrayArgs[l];n.push(["t",h,"=array",h,".dtype,","r",h,"=array",h,".order"].join("")),i.push("t"+h),i.push("r"+h),o.push("t"+h),o.push("r"+h+".join()"),s.push("array"+h+".data"),s.push("array"+h+".stride"),s.push("array"+h+".offset|0"),l>0&&(u.push("array"+e.arrayArgs[0]+".shape.length===array"+h+".shape.length+"+(Math.abs(e.arrayBlockIndices[0])-Math.abs(e.arrayBlockIndices[l]))),c.push("array"+e.arrayArgs[0]+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[0])+"]===array"+h+".shape[shapeIndex+"+Math.max(0,e.arrayBlockIndices[l])+"]"))}for(e.arrayArgs.length>1&&(t.push("if (!("+u.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same dimensionality!')"),t.push("for(var shapeIndex=array"+e.arrayArgs[0]+".shape.length-"+Math.abs(e.arrayBlockIndices[0])+"; shapeIndex--\x3e0;) {"),t.push("if (!("+c.join(" && ")+")) throw new Error('cwise: Arrays do not all have the same shape!')"),t.push("}")),l=0;l<e.scalarArgs.length;++l)s.push("scalar"+e.scalarArgs[l]);return n.push(["type=[",o.join(","),"].join()"].join("")),n.push("proc=CACHED[type]"),t.push("var "+n.join(",")),t.push(["if(!proc){","CACHED[type]=proc=compile([",i.join(","),"])}","return proc(",s.join(","),")}"].join("")),e.debug&&console.log("-----Generated thunk:\n"+t.join("\n")+"\n----------"),new Function("compile",t.join("\n"))(r.bind(void 0,e))}},3546:function(e,t,n){"use strict";var r=n(1977),a=n(8871),i=0;function o(e,t,n){this.name=e,this.lvalue=t,this.rvalue=n,this.count=0}function s(e,t,n,r){this.body=e,this.args=t,this.thisVars=n,this.localVars=r}e.exports=function(e){for(var t=["(",e,")()"].join(""),u=r.parse(t,{range:!0}),c="_inline_"+i+++"_",l=function(e){for(var t=e.body[0].expression.callee.params,n=new Array(t.length),r=0;r<t.length;++r)n[r]=t[r].name;return n}(u),h=new Array(l.length),f=0;f<l.length;++f)h[f]=new o([c,"arg",f,"_"].join(""),!1,!1);for(var d=new Array(t.length),p=(f=0,t.length);f<p;++f)d[f]=t.charAt(f);var v,m=[],g=[];function y(e,t){for(var n=e.range[0],r=e.range[1],a=n+1;a<r;++a)d[a]="";d[n]=t}return function e(t,r){if(t.parent=r,"MemberExpression"===t.type)t.computed?(e(t.object,t),e(t.property,t)):"ThisExpression"===t.object.type?y(t,function(e){var t="this_"+e.replace(/\_/g,"__");return g.push(t),t}(t.property.name)):e(t.object,t);else{if("ThisExpression"===t.type)throw new Error("cwise-parser: Computed this is not allowed");if("Identifier"===t.type){var a=t.name,i=l.indexOf(a);if(i>=0){var o=h[i],s=function(e){return"AssignmentExpression"===e.parent.type&&e.parent.left===e?"="===e.parent.operator?1:3:"UpdateExpression"===e.parent.type?3:2}(t);1&s&&(o.lvalue=!0),2&s&&(o.rvalue=!0),++o.count,y(t,o.name)}else(function(e){if("eval"===e)throw new Error("cwise-parser: eval() not allowed");return"undefined"!==typeof window?e in window:"undefined"!==typeof n.g?e in n.g:"undefined"!==typeof self&&e in self})(a)||y(t,function(e){var t=c+e.replace(/\_/g,"__");return m.push(t),t}(a))}else if("Literal"===t.type)"string"===typeof t.value&&y(t,"'"+t.value.replace(/\_/g,"\\_").replace(/\'/g,"'")+"'");else{if("WithStatement"===t.type)throw new Error("cwise-parser: with() statements not allowed");for(var u=Object.keys(t),f=0,d=u.length;f<d;++f)if("parent"!==u[f]){var p=t[u[f]];if(p)if(p instanceof Array)for(var v=0;v<p.length;++v)p[v]&&"string"===typeof p[v].type&&e(p[v],t);else"string"===typeof p.type&&e(p,t)}}}}(u.body[0].expression.callee.body,void 0),a(m),a(g),new s((v=u.body[0].expression.callee.body,d.slice(v.range[0],v.range[1]).join("")),h,g,m)}},1977:function(e,t){var n,r,a;!function(i,o){"use strict";r=[t],n=function(e){var t,n,r,a,i,o,s,u,c,l,h,f,d,p,v,m,g,y;function b(e,t){if(!e)throw new Error("ASSERT: "+t)}function x(e){return e>=48&&e<=57}function k(e){return"0123456789abcdefABCDEF".indexOf(e)>=0}function w(e){return"01234567".indexOf(e)>=0}function _(e){return 32===e||9===e||11===e||12===e||160===e||e>=5760&&[5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8239,8287,12288,65279].indexOf(e)>=0}function S(e){return 10===e||13===e||8232===e||8233===e}function C(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||92===e||e>=128&&s.NonAsciiIdentifierStart.test(String.fromCharCode(e))}function T(e){return 36===e||95===e||e>=65&&e<=90||e>=97&&e<=122||e>=48&&e<=57||92===e||e>=128&&s.NonAsciiIdentifierPart.test(String.fromCharCode(e))}function E(e){switch(e){case"class":case"enum":case"export":case"extends":case"import":case"super":return!0;default:return!1}}function I(e){switch(e){case"implements":case"interface":case"package":case"private":case"protected":case"public":case"static":case"yield":case"let":return!0;default:return!1}}function A(e){return"eval"===e||"arguments"===e}function M(e){if(l&&I(e))return!0;switch(e.length){case 2:return"if"===e||"in"===e||"do"===e;case 3:return"var"===e||"for"===e||"new"===e||"try"===e||"let"===e;case 4:return"this"===e||"else"===e||"case"===e||"void"===e||"with"===e||"enum"===e;case 5:return"while"===e||"break"===e||"catch"===e||"throw"===e||"const"===e||"yield"===e||"class"===e||"super"===e;case 6:return"return"===e||"typeof"===e||"delete"===e||"switch"===e||"export"===e||"import"===e;case 7:return"default"===e||"finally"===e||"extends"===e;case 8:return"function"===e||"continue"===e||"debugger"===e;case 10:return"instanceof"===e;default:return!1}}function N(e,t,n,r,a){var i;b("number"===typeof n,"Comment must have valid position"),g.lastCommentStart>=n||(g.lastCommentStart=n,i={type:e,value:t},y.range&&(i.range=[n,r]),y.loc&&(i.loc=a),y.comments.push(i),y.attachComment&&(y.leadingComments.push(i),y.trailingComments.push(i)))}function R(e){var t,n,r,a;for(t=h-e,n={start:{line:f,column:h-d-e}};h<p;)if(r=c.charCodeAt(h),++h,S(r))return y.comments&&(a=c.slice(t+e,h-1),n.end={line:f,column:h-d-1},N("Line",a,t,h-1,n)),13===r&&10===c.charCodeAt(h)&&++h,++f,void(d=h);y.comments&&(a=c.slice(t+e,h),n.end={line:f,column:h-d},N("Line",a,t,h,n))}function D(){var e,t,n,r;for(y.comments&&(e=h-2,t={start:{line:f,column:h-d-2}});h<p;)if(S(n=c.charCodeAt(h)))13===n&&10===c.charCodeAt(h+1)&&++h,++f,++h,d=h,h>=p&&ie({},o.UnexpectedToken,"ILLEGAL");else if(42===n){if(47===c.charCodeAt(h+1))return++h,++h,void(y.comments&&(r=c.slice(e+2,h-2),t.end={line:f,column:h-d},N("Block",r,e,h,t)));++h}else++h;ie({},o.UnexpectedToken,"ILLEGAL")}function P(){var e,t;for(t=0===h;h<p;)if(_(e=c.charCodeAt(h)))++h;else if(S(e))++h,13===e&&10===c.charCodeAt(h)&&++h,++f,d=h,t=!0;else if(47===e)if(47===(e=c.charCodeAt(h+1)))++h,++h,R(2),t=!0;else{if(42!==e)break;++h,++h,D()}else if(t&&45===e){if(45!==c.charCodeAt(h+1)||62!==c.charCodeAt(h+2))break;h+=3,R(3)}else{if(60!==e)break;if("!--"!==c.slice(h+1,h+4))break;++h,++h,++h,++h,R(4)}}function O(e){var t,n,r,a=0;for(n="u"===e?4:2,t=0;t<n;++t){if(!(h<p&&k(c[h])))return"";r=c[h++],a=16*a+"0123456789abcdef".indexOf(r.toLowerCase())}return String.fromCharCode(a)}function L(){var e,t;for(e=c.charCodeAt(h++),t=String.fromCharCode(e),92===e&&(117!==c.charCodeAt(h)&&ie({},o.UnexpectedToken,"ILLEGAL"),++h,(e=O("u"))&&"\\"!==e&&C(e.charCodeAt(0))||ie({},o.UnexpectedToken,"ILLEGAL"),t=e);h<p&&T(e=c.charCodeAt(h));)++h,t+=String.fromCharCode(e),92===e&&(t=t.substr(0,t.length-1),117!==c.charCodeAt(h)&&ie({},o.UnexpectedToken,"ILLEGAL"),++h,(e=O("u"))&&"\\"!==e&&T(e.charCodeAt(0))||ie({},o.UnexpectedToken,"ILLEGAL"),t+=e);return t}function F(){var e,t;for(e=h++;h<p;){if(92===(t=c.charCodeAt(h)))return h=e,L();if(!T(t))break;++h}return c.slice(e,h)}function z(){var e,n;return e=h,{type:1===(n=92===c.charCodeAt(h)?L():F()).length?t.Identifier:M(n)?t.Keyword:"null"===n?t.NullLiteral:"true"===n||"false"===n?t.BooleanLiteral:t.Identifier,value:n,lineNumber:f,lineStart:d,start:e,end:h}}function B(){var e,n,r,a,i=h,s=c.charCodeAt(h),u=c[h];switch(s){case 46:case 40:case 41:case 59:case 44:case 123:case 125:case 91:case 93:case 58:case 63:case 126:return++h,y.tokenize&&(40===s?y.openParenToken=y.tokens.length:123===s&&(y.openCurlyToken=y.tokens.length)),{type:t.Punctuator,value:String.fromCharCode(s),lineNumber:f,lineStart:d,start:i,end:h};default:if(61===(e=c.charCodeAt(h+1)))switch(s){case 43:case 45:case 47:case 60:case 62:case 94:case 124:case 37:case 38:case 42:return h+=2,{type:t.Punctuator,value:String.fromCharCode(s)+String.fromCharCode(e),lineNumber:f,lineStart:d,start:i,end:h};case 33:case 61:return h+=2,61===c.charCodeAt(h)&&++h,{type:t.Punctuator,value:c.slice(i,h),lineNumber:f,lineStart:d,start:i,end:h}}}return">>>="===(a=c.substr(h,4))?(h+=4,{type:t.Punctuator,value:a,lineNumber:f,lineStart:d,start:i,end:h}):">>>"===(r=a.substr(0,3))||"<<="===r||">>="===r?(h+=3,{type:t.Punctuator,value:r,lineNumber:f,lineStart:d,start:i,end:h}):u===(n=r.substr(0,2))[1]&&"+-<>&|".indexOf(u)>=0||"=>"===n?(h+=2,{type:t.Punctuator,value:n,lineNumber:f,lineStart:d,start:i,end:h}):"<>=!+-*%&|^/".indexOf(u)>=0?(++h,{type:t.Punctuator,value:u,lineNumber:f,lineStart:d,start:i,end:h}):void ie({},o.UnexpectedToken,"ILLEGAL")}function U(e){for(var n="";h<p&&k(c[h]);)n+=c[h++];return 0===n.length&&ie({},o.UnexpectedToken,"ILLEGAL"),C(c.charCodeAt(h))&&ie({},o.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseInt("0x"+n,16),lineNumber:f,lineStart:d,start:e,end:h}}function V(e){for(var n="0"+c[h++];h<p&&w(c[h]);)n+=c[h++];return(C(c.charCodeAt(h))||x(c.charCodeAt(h)))&&ie({},o.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseInt(n,8),octal:!0,lineNumber:f,lineStart:d,start:e,end:h}}function W(){var e,t;for(e=h+1;e<p;++e){if("8"===(t=c[e])||"9"===t)return!1;if(!w(t))return!0}return!0}function G(){var e,n,r;if(b(x((r=c[h]).charCodeAt(0))||"."===r,"Numeric literal must start with a decimal digit or a decimal point"),n=h,e="","."!==r){if(e=c[h++],r=c[h],"0"===e){if("x"===r||"X"===r)return++h,U(n);if(w(r)&&W())return V(n)}for(;x(c.charCodeAt(h));)e+=c[h++];r=c[h]}if("."===r){for(e+=c[h++];x(c.charCodeAt(h));)e+=c[h++];r=c[h]}if("e"===r||"E"===r)if(e+=c[h++],"+"!==(r=c[h])&&"-"!==r||(e+=c[h++]),x(c.charCodeAt(h)))for(;x(c.charCodeAt(h));)e+=c[h++];else ie({},o.UnexpectedToken,"ILLEGAL");return C(c.charCodeAt(h))&&ie({},o.UnexpectedToken,"ILLEGAL"),{type:t.NumericLiteral,value:parseFloat(e),lineNumber:f,lineStart:d,start:n,end:h}}function j(){var e,n,r,a,i,s,u,l,v="",m=!1;for(u=f,l=d,b("'"===(e=c[h])||'"'===e,"String literal must starts with a quote"),n=h,++h;h<p;){if((r=c[h++])===e){e="";break}if("\\"===r)if((r=c[h++])&&S(r.charCodeAt(0)))++f,"\r"===r&&"\n"===c[h]&&++h,d=h;else switch(r){case"u":case"x":s=h,(i=O(r))?v+=i:(h=s,v+=r);break;case"n":v+="\n";break;case"r":v+="\r";break;case"t":v+="\t";break;case"b":v+="\b";break;case"f":v+="\f";break;case"v":v+="\v";break;default:w(r)?(0!==(a="01234567".indexOf(r))&&(m=!0),h<p&&w(c[h])&&(m=!0,a=8*a+"01234567".indexOf(c[h++]),"0123".indexOf(r)>=0&&h<p&&w(c[h])&&(a=8*a+"01234567".indexOf(c[h++]))),v+=String.fromCharCode(a)):v+=r}else{if(S(r.charCodeAt(0)))break;v+=r}}return""!==e&&ie({},o.UnexpectedToken,"ILLEGAL"),{type:t.StringLiteral,value:v,octal:m,startLineNumber:u,startLineStart:l,lineNumber:f,lineStart:d,start:n,end:h}}function q(e,t){var n;try{n=new RegExp(e,t)}catch(r){ie({},o.InvalidRegExp)}return n}function H(){var e,t,n,r;for(b("/"===(e=c[h]),"Regular expression literal must start with a slash"),t=c[h++],n=!1,r=!1;h<p;)if(t+=e=c[h++],"\\"===e)S((e=c[h++]).charCodeAt(0))&&ie({},o.UnterminatedRegExp),t+=e;else if(S(e.charCodeAt(0)))ie({},o.UnterminatedRegExp);else if(n)"]"===e&&(n=!1);else{if("/"===e){r=!0;break}"["===e&&(n=!0)}return r||ie({},o.UnterminatedRegExp),{value:t.substr(1,t.length-2),literal:t}}function X(){var e,t,n,r;for(t="",n="";h<p&&T((e=c[h]).charCodeAt(0));)if(++h,"\\"===e&&h<p)if("u"===(e=c[h])){if(r=++h,e=O("u"))for(n+=e,t+="\\u";r<h;++r)t+=c[r];else h=r,n+="u",t+="\\u";oe({},o.UnexpectedToken,"ILLEGAL")}else t+="\\",oe({},o.UnexpectedToken,"ILLEGAL");else n+=e,t+=e;return{value:n,literal:t}}function K(){var e,n,r,a;return m=null,P(),e=h,n=H(),r=X(),a=q(n.value,r.value),y.tokenize?{type:t.RegularExpression,value:a,lineNumber:f,lineStart:d,start:e,end:h}:{literal:n.literal+r.literal,value:a,start:e,end:h}}function Y(){var e,t,n,r;return P(),e=h,t={start:{line:f,column:h-d}},n=K(),t.end={line:f,column:h-d},y.tokenize||(y.tokens.length>0&&(r=y.tokens[y.tokens.length-1]).range[0]===e&&"Punctuator"===r.type&&("/"!==r.value&&"/="!==r.value||y.tokens.pop()),y.tokens.push({type:"RegularExpression",value:n.literal,range:[e,h],loc:t})),n}function Q(e){return e.type===t.Identifier||e.type===t.Keyword||e.type===t.BooleanLiteral||e.type===t.NullLiteral}function Z(){var e,t;if(!(e=y.tokens[y.tokens.length-1]))return Y();if("Punctuator"===e.type){if("]"===e.value)return B();if(")"===e.value)return!(t=y.tokens[y.openParenToken-1])||"Keyword"!==t.type||"if"!==t.value&&"while"!==t.value&&"for"!==t.value&&"with"!==t.value?B():Y();if("}"===e.value){if(y.tokens[y.openCurlyToken-3]&&"Keyword"===y.tokens[y.openCurlyToken-3].type){if(!(t=y.tokens[y.openCurlyToken-4]))return B()}else{if(!y.tokens[y.openCurlyToken-4]||"Keyword"!==y.tokens[y.openCurlyToken-4].type)return B();if(!(t=y.tokens[y.openCurlyToken-5]))return Y()}return r.indexOf(t.value)>=0?B():Y()}return Y()}return"Keyword"===e.type&&"this"!==e.value?Y():B()}function J(){var e;return P(),h>=p?{type:t.EOF,lineNumber:f,lineStart:d,start:h,end:h}:C(e=c.charCodeAt(h))?z():40===e||41===e||59===e?B():39===e||34===e?j():46===e?x(c.charCodeAt(h+1))?G():B():x(e)?G():y.tokenize&&47===e?Z():B()}function $(){var e,r,a;return P(),e={start:{line:f,column:h-d}},r=J(),e.end={line:f,column:h-d},r.type!==t.EOF&&(a=c.slice(r.start,r.end),y.tokens.push({type:n[r.type],value:a,range:[r.start,r.end],loc:e})),r}function ee(){var e;return h=(e=m).end,f=e.lineNumber,d=e.lineStart,m="undefined"!==typeof y.tokens?$():J(),h=e.end,f=e.lineNumber,d=e.lineStart,e}function te(){var e,t,n;e=h,t=f,n=d,m="undefined"!==typeof y.tokens?$():J(),h=e,f=t,d=n}function ne(e,t){this.line=e,this.column=t}function re(e,t,n,r){this.start=new ne(e,t),this.end=new ne(n,r)}function ae(){var e,t,n,r;return e=h,t=f,n=d,P(),r=f!==t,h=e,f=t,d=n,r}function ie(e,t){var n,r=Array.prototype.slice.call(arguments,2),a=t.replace(/%(\d)/g,(function(e,t){return b(t<r.length,"Message reference must be in range"),r[t]}));throw"number"===typeof e.lineNumber?((n=new Error("Line "+e.lineNumber+": "+a)).index=e.start,n.lineNumber=e.lineNumber,n.column=e.start-d+1):((n=new Error("Line "+f+": "+a)).index=h,n.lineNumber=f,n.column=h-d+1),n.description=a,n}function oe(){try{ie.apply(null,arguments)}catch(e){if(!y.errors)throw e;y.errors.push(e)}}function se(e){if(e.type===t.EOF&&ie(e,o.UnexpectedEOS),e.type===t.NumericLiteral&&ie(e,o.UnexpectedNumber),e.type===t.StringLiteral&&ie(e,o.UnexpectedString),e.type===t.Identifier&&ie(e,o.UnexpectedIdentifier),e.type===t.Keyword){if(E(e.value))ie(e,o.UnexpectedReserved);else if(l&&I(e.value))return void oe(e,o.StrictReservedWord);ie(e,o.UnexpectedToken,e.value)}ie(e,o.UnexpectedToken,e.value)}function ue(e){var n=ee();n.type===t.Punctuator&&n.value===e||se(n)}function ce(e){var n=ee();n.type===t.Keyword&&n.value===e||se(n)}function le(e){return m.type===t.Punctuator&&m.value===e}function he(e){return m.type===t.Keyword&&m.value===e}function fe(){var e;return m.type===t.Punctuator&&("="===(e=m.value)||"*="===e||"/="===e||"%="===e||"+="===e||"-="===e||"<<="===e||">>="===e||">>>="===e||"&="===e||"^="===e||"|="===e)}function de(){var e,n=h,r=f,a=d,i=m;if(59===c.charCodeAt(h)||le(";"))ee();else{if(e=f,P(),f!==e)return h=n,f=r,d=a,void(m=i);m.type===t.EOF||le("}")||se(m)}}function pe(e){return e.type===a.Identifier||e.type===a.MemberExpression}function ve(){var e,t=[];for(e=m,ue("[");!le("]");)le(",")?(ee(),t.push(null)):(t.push(Pe()),le("]")||ue(","));return ee(),v.markEnd(v.createArrayExpression(t),e)}function me(e,t){var n,r,a;return n=l,a=m,r=st(),t&&l&&A(e[0].name)&&oe(t,o.StrictParamName),l=n,v.markEnd(v.createFunctionExpression(null,e,[],r),a)}function ge(){var e,n;return n=m,(e=ee()).type===t.StringLiteral||e.type===t.NumericLiteral?(l&&e.octal&&oe(e,o.StrictOctalLiteral),v.markEnd(v.createLiteral(e),n)):v.markEnd(v.createIdentifier(e.value),n)}function ye(){var e,n,r,a,i,s;return s=m,(e=m).type===t.Identifier?(r=ge(),"get"!==e.value||le(":")?"set"!==e.value||le(":")?(ue(":"),a=Pe(),v.markEnd(v.createProperty("init",r,a),s)):(n=ge(),ue("("),(e=m).type!==t.Identifier?(ue(")"),oe(e,o.UnexpectedToken,e.value),a=me([])):(i=[ze()],ue(")"),a=me(i,e)),v.markEnd(v.createProperty("set",n,a),s)):(n=ge(),ue("("),ue(")"),a=me([]),v.markEnd(v.createProperty("get",n,a),s))):e.type!==t.EOF&&e.type!==t.Punctuator?(n=ge(),ue(":"),a=Pe(),v.markEnd(v.createProperty("init",n,a),s)):void se(e)}function be(){var e,t,n,r,s,u=[],c={},h=String;for(s=m,ue("{");!le("}");)t=(e=ye()).key.type===a.Identifier?e.key.name:h(e.key.value),r="init"===e.kind?i.Data:"get"===e.kind?i.Get:i.Set,n="$"+t,Object.prototype.hasOwnProperty.call(c,n)?(c[n]===i.Data?l&&r===i.Data?oe({},o.StrictDuplicateProperty):r!==i.Data&&oe({},o.AccessorDataProperty):r===i.Data?oe({},o.AccessorDataProperty):c[n]&r&&oe({},o.AccessorGetSet),c[n]|=r):c[n]=r,u.push(e),le("}")||ue(",");return ue("}"),v.markEnd(v.createObjectExpression(u),s)}function xe(){var e;return ue("("),e=Oe(),ue(")"),e}function ke(){var e,n,r,a;if(le("("))return xe();if(le("["))return ve();if(le("{"))return be();if(e=m.type,a=m,e===t.Identifier)r=v.createIdentifier(ee().value);else if(e===t.StringLiteral||e===t.NumericLiteral)l&&m.octal&&oe(m,o.StrictOctalLiteral),r=v.createLiteral(ee());else if(e===t.Keyword){if(he("function"))return lt();he("this")?(ee(),r=v.createThisExpression()):se(ee())}else e===t.BooleanLiteral?((n=ee()).value="true"===n.value,r=v.createLiteral(n)):e===t.NullLiteral?((n=ee()).value=null,r=v.createLiteral(n)):le("/")||le("/=")?(r="undefined"!==typeof y.tokens?v.createLiteral(Y()):v.createLiteral(K()),te()):se(ee());return v.markEnd(r,a)}function we(){var e=[];if(ue("("),!le(")"))for(;h<p&&(e.push(Pe()),!le(")"));)ue(",");return ue(")"),e}function _e(){var e,t;return t=m,Q(e=ee())||se(e),v.markEnd(v.createIdentifier(e.value),t)}function Se(){return ue("."),_e()}function Ce(){var e;return ue("["),e=Oe(),ue("]"),e}function Te(){var e,t,n;return n=m,ce("new"),e=Ie(),t=le("(")?we():[],v.markEnd(v.createNewExpression(e,t),n)}function Ee(){var e,t,n,r,a=g.allowIn;for(r=m,g.allowIn=!0,e=he("new")?Te():ke();;){if(le("."))n=Se(),e=v.createMemberExpression(".",e,n);else if(le("("))t=we(),e=v.createCallExpression(e,t);else{if(!le("["))break;n=Ce(),e=v.createMemberExpression("[",e,n)}v.markEnd(e,r)}return g.allowIn=a,e}function Ie(){var e,t,n;for(b(g.allowIn,"callee of new expression always allow in keyword."),n=m,e=he("new")?Te():ke();le(".")||le("[");)le("[")?(t=Ce(),e=v.createMemberExpression("[",e,t)):(t=Se(),e=v.createMemberExpression(".",e,t)),v.markEnd(e,n);return e}function Ae(){var e,n,r=m;return e=Ee(),m.type===t.Punctuator&&(!le("++")&&!le("--")||ae()||(l&&e.type===a.Identifier&&A(e.name)&&oe({},o.StrictLHSPostfix),pe(e)||oe({},o.InvalidLHSInAssignment),n=ee(),e=v.markEnd(v.createPostfixExpression(n.value,e),r))),e}function Me(){var e,n,r;return m.type!==t.Punctuator&&m.type!==t.Keyword?n=Ae():le("++")||le("--")?(r=m,e=ee(),n=Me(),l&&n.type===a.Identifier&&A(n.name)&&oe({},o.StrictLHSPrefix),pe(n)||oe({},o.InvalidLHSInAssignment),n=v.createUnaryExpression(e.value,n),n=v.markEnd(n,r)):le("+")||le("-")||le("~")||le("!")?(r=m,e=ee(),n=Me(),n=v.createUnaryExpression(e.value,n),n=v.markEnd(n,r)):he("delete")||he("void")||he("typeof")?(r=m,e=ee(),n=Me(),n=v.createUnaryExpression(e.value,n),n=v.markEnd(n,r),l&&"delete"===n.operator&&n.argument.type===a.Identifier&&oe({},o.StrictDelete)):n=Ae(),n}function Ne(e,n){var r=0;if(e.type!==t.Punctuator&&e.type!==t.Keyword)return 0;switch(e.value){case"||":r=1;break;case"&&":r=2;break;case"|":r=3;break;case"^":r=4;break;case"&":r=5;break;case"==":case"!=":case"===":case"!==":r=6;break;case"<":case">":case"<=":case">=":case"instanceof":r=7;break;case"in":r=n?7:0;break;case"<<":case">>":case">>>":r=8;break;case"+":case"-":r=9;break;case"*":case"/":case"%":r=11}return r}function Re(){var e,t,n,r,a,i,o,s,u,c;if(e=m,u=Me(),0===(a=Ne(r=m,g.allowIn)))return u;for(r.prec=a,ee(),t=[e,m],i=[u,r,o=Me()];(a=Ne(m,g.allowIn))>0;){for(;i.length>2&&a<=i[i.length-2].prec;)o=i.pop(),s=i.pop().value,u=i.pop(),n=v.createBinaryExpression(s,u,o),t.pop(),e=t[t.length-1],v.markEnd(n,e),i.push(n);(r=ee()).prec=a,i.push(r),t.push(m),n=Me(),i.push(n)}for(n=i[c=i.length-1],t.pop();c>1;)n=v.createBinaryExpression(i[c-1].value,i[c-2],n),c-=2,e=t.pop(),v.markEnd(n,e);return n}function De(){var e,t,n,r,a;return a=m,e=Re(),le("?")&&(ee(),t=g.allowIn,g.allowIn=!0,n=Pe(),g.allowIn=t,ue(":"),r=Pe(),e=v.createConditionalExpression(e,n,r),v.markEnd(e,a)),e}function Pe(){var e,t,n,r,i;return e=m,i=m,r=t=De(),fe()&&(pe(t)||oe({},o.InvalidLHSInAssignment),l&&t.type===a.Identifier&&A(t.name)&&oe(e,o.StrictLHSAssignment),e=ee(),n=Pe(),r=v.markEnd(v.createAssignmentExpression(e.value,t,n),i)),r}function Oe(){var e,t=m;if(e=Pe(),le(",")){for(e=v.createSequenceExpression([e]);h<p&&le(",");)ee(),e.expressions.push(Pe());v.markEnd(e,t)}return e}function Le(){for(var e,t=[];h<p&&!le("}")&&"undefined"!==typeof(e=ht());)t.push(e);return t}function Fe(){var e,t;return t=m,ue("{"),e=Le(),ue("}"),v.markEnd(v.createBlockStatement(e),t)}function ze(){var e,n;return n=m,(e=ee()).type!==t.Identifier&&se(e),v.markEnd(v.createIdentifier(e.value),n)}function Be(e){var t,n,r=null;return n=m,t=ze(),l&&A(t.name)&&oe({},o.StrictVarName),"const"===e?(ue("="),r=Pe()):le("=")&&(ee(),r=Pe()),v.markEnd(v.createVariableDeclarator(t,r),n)}function Ue(e){var t=[];do{if(t.push(Be(e)),!le(","))break;ee()}while(h<p);return t}function Ve(){var e;return ce("var"),e=Ue(),de(),v.createVariableDeclaration(e,"var")}function We(e){var t,n;return n=m,ce(e),t=Ue(e),de(),v.markEnd(v.createVariableDeclaration(t,e),n)}function Ge(){return ue(";"),v.createEmptyStatement()}function je(){var e=Oe();return de(),v.createExpressionStatement(e)}function qe(){var e,t,n;return ce("if"),ue("("),e=Oe(),ue(")"),t=ot(),he("else")?(ee(),n=ot()):n=null,v.createIfStatement(e,t,n)}function He(){var e,t,n;return ce("do"),n=g.inIteration,g.inIteration=!0,e=ot(),g.inIteration=n,ce("while"),ue("("),t=Oe(),ue(")"),le(";")&&ee(),v.createDoWhileStatement(e,t)}function Xe(){var e,t,n;return ce("while"),ue("("),e=Oe(),ue(")"),n=g.inIteration,g.inIteration=!0,t=ot(),g.inIteration=n,v.createWhileStatement(e,t)}function Ke(){var e,t,n;return n=m,e=ee(),t=Ue(),v.markEnd(v.createVariableDeclaration(t,e.value),n)}function Ye(){var e,t,n,r,a,i,s,u=g.allowIn;return e=t=n=null,ce("for"),ue("("),le(";")?ee():(he("var")||he("let")?(g.allowIn=!1,e=Ke(),g.allowIn=u,1===e.declarations.length&&he("in")&&(ee(),r=e,a=Oe(),e=null)):(g.allowIn=!1,e=Oe(),g.allowIn=u,he("in")&&(pe(e)||oe({},o.InvalidLHSInForIn),ee(),r=e,a=Oe(),e=null)),"undefined"===typeof r&&ue(";")),"undefined"===typeof r&&(le(";")||(t=Oe()),ue(";"),le(")")||(n=Oe())),ue(")"),s=g.inIteration,g.inIteration=!0,i=ot(),g.inIteration=s,"undefined"===typeof r?v.createForStatement(e,t,n,i):v.createForInStatement(r,a,i)}function Qe(){var e,n=null;return ce("continue"),59===c.charCodeAt(h)?(ee(),g.inIteration||ie({},o.IllegalContinue),v.createContinueStatement(null)):ae()?(g.inIteration||ie({},o.IllegalContinue),v.createContinueStatement(null)):(m.type===t.Identifier&&(e="$"+(n=ze()).name,Object.prototype.hasOwnProperty.call(g.labelSet,e)||ie({},o.UnknownLabel,n.name)),de(),null!==n||g.inIteration||ie({},o.IllegalContinue),v.createContinueStatement(n))}function Ze(){var e,n=null;return ce("break"),59===c.charCodeAt(h)?(ee(),g.inIteration||g.inSwitch||ie({},o.IllegalBreak),v.createBreakStatement(null)):ae()?(g.inIteration||g.inSwitch||ie({},o.IllegalBreak),v.createBreakStatement(null)):(m.type===t.Identifier&&(e="$"+(n=ze()).name,Object.prototype.hasOwnProperty.call(g.labelSet,e)||ie({},o.UnknownLabel,n.name)),de(),null!==n||g.inIteration||g.inSwitch||ie({},o.IllegalBreak),v.createBreakStatement(n))}function Je(){var e=null;return ce("return"),g.inFunctionBody||oe({},o.IllegalReturn),32===c.charCodeAt(h)&&C(c.charCodeAt(h+1))?(e=Oe(),de(),v.createReturnStatement(e)):ae()?v.createReturnStatement(null):(le(";")||le("}")||m.type===t.EOF||(e=Oe()),de(),v.createReturnStatement(e))}function $e(){var e,t;return l&&(P(),oe({},o.StrictModeWith)),ce("with"),ue("("),e=Oe(),ue(")"),t=ot(),v.createWithStatement(e,t)}function et(){var e,t,n,r=[];for(n=m,he("default")?(ee(),e=null):(ce("case"),e=Oe()),ue(":");h<p&&!(le("}")||he("default")||he("case"));)t=ot(),r.push(t);return v.markEnd(v.createSwitchCase(e,r),n)}function tt(){var e,t,n,r,a;if(ce("switch"),ue("("),e=Oe(),ue(")"),ue("{"),t=[],le("}"))return ee(),v.createSwitchStatement(e,t);for(r=g.inSwitch,g.inSwitch=!0,a=!1;h<p&&!le("}");)null===(n=et()).test&&(a&&ie({},o.MultipleDefaultsInSwitch),a=!0),t.push(n);return g.inSwitch=r,ue("}"),v.createSwitchStatement(e,t)}function nt(){var e;return ce("throw"),ae()&&ie({},o.NewlineAfterThrow),e=Oe(),de(),v.createThrowStatement(e)}function rt(){var e,t,n;return n=m,ce("catch"),ue("("),le(")")&&se(m),e=ze(),l&&A(e.name)&&oe({},o.StrictCatchVariable),ue(")"),t=Fe(),v.markEnd(v.createCatchClause(e,t),n)}function at(){var e,t=[],n=null;return ce("try"),e=Fe(),he("catch")&&t.push(rt()),he("finally")&&(ee(),n=Fe()),0!==t.length||n||ie({},o.NoCatchOrFinally),v.createTryStatement(e,[],t,n)}function it(){return ce("debugger"),de(),v.createDebuggerStatement()}function ot(){var e,n,r,i,s=m.type;if(s===t.EOF&&se(m),s===t.Punctuator&&"{"===m.value)return Fe();if(i=m,s===t.Punctuator)switch(m.value){case";":return v.markEnd(Ge(),i);case"(":return v.markEnd(je(),i)}if(s===t.Keyword)switch(m.value){case"break":return v.markEnd(Ze(),i);case"continue":return v.markEnd(Qe(),i);case"debugger":return v.markEnd(it(),i);case"do":return v.markEnd(He(),i);case"for":return v.markEnd(Ye(),i);case"function":return v.markEnd(ct(),i);case"if":return v.markEnd(qe(),i);case"return":return v.markEnd(Je(),i);case"switch":return v.markEnd(tt(),i);case"throw":return v.markEnd(nt(),i);case"try":return v.markEnd(at(),i);case"var":return v.markEnd(Ve(),i);case"while":return v.markEnd(Xe(),i);case"with":return v.markEnd($e(),i)}return(e=Oe()).type===a.Identifier&&le(":")?(ee(),r="$"+e.name,Object.prototype.hasOwnProperty.call(g.labelSet,r)&&ie({},o.Redeclaration,"Label",e.name),g.labelSet[r]=!0,n=ot(),delete g.labelSet[r],v.markEnd(v.createLabeledStatement(e,n),i)):(de(),v.markEnd(v.createExpressionStatement(e),i))}function st(){var e,n,r,i,s,u,f,d,y=[];for(d=m,ue("{");h<p&&m.type===t.StringLiteral&&(n=m,e=ht(),y.push(e),e.expression.type===a.Literal);)"use strict"===c.slice(n.start+1,n.end-1)?(l=!0,r&&oe(r,o.StrictOctalLiteral)):!r&&n.octal&&(r=n);for(i=g.labelSet,s=g.inIteration,u=g.inSwitch,f=g.inFunctionBody,g.labelSet={},g.inIteration=!1,g.inSwitch=!1,g.inFunctionBody=!0;h<p&&!le("}")&&"undefined"!==typeof(e=ht());)y.push(e);return ue("}"),g.labelSet=i,g.inIteration=s,g.inSwitch=u,g.inFunctionBody=f,v.markEnd(v.createBlockStatement(y),d)}function ut(e){var t,n,r,a,i,s,u=[];if(ue("("),!le(")"))for(a={};h<p&&(n=m,t=ze(),i="$"+n.value,l?(A(n.value)&&(r=n,s=o.StrictParamName),Object.prototype.hasOwnProperty.call(a,i)&&(r=n,s=o.StrictParamDupe)):e||(A(n.value)?(e=n,s=o.StrictParamName):I(n.value)?(e=n,s=o.StrictReservedWord):Object.prototype.hasOwnProperty.call(a,i)&&(e=n,s=o.StrictParamDupe)),u.push(t),a[i]=!0,!le(")"));)ue(",");return ue(")"),{params:u,stricted:r,firstRestricted:e,message:s}}function ct(){var e,t,n,r,a,i,s,u,c,h=[];return c=m,ce("function"),n=m,e=ze(),l?A(n.value)&&oe(n,o.StrictFunctionName):A(n.value)?(i=n,s=o.StrictFunctionName):I(n.value)&&(i=n,s=o.StrictReservedWord),h=(a=ut(i)).params,r=a.stricted,i=a.firstRestricted,a.message&&(s=a.message),u=l,t=st(),l&&i&&ie(i,s),l&&r&&oe(r,s),l=u,v.markEnd(v.createFunctionDeclaration(e,h,[],t),c)}function lt(){var e,t,n,r,a,i,s,u,c=null,h=[];return u=m,ce("function"),le("(")||(e=m,c=ze(),l?A(e.value)&&oe(e,o.StrictFunctionName):A(e.value)?(n=e,r=o.StrictFunctionName):I(e.value)&&(n=e,r=o.StrictReservedWord)),h=(a=ut(n)).params,t=a.stricted,n=a.firstRestricted,a.message&&(r=a.message),s=l,i=st(),l&&n&&ie(n,r),l&&t&&oe(t,r),l=s,v.markEnd(v.createFunctionExpression(c,h,[],i),u)}function ht(){if(m.type===t.Keyword)switch(m.value){case"const":case"let":return We(m.value);case"function":return ct();default:return ot()}if(m.type!==t.EOF)return ot()}function ft(){for(var e,n,r,i=[];h<p&&(n=m).type===t.StringLiteral&&(e=ht(),i.push(e),e.expression.type===a.Literal);)"use strict"===c.slice(n.start+1,n.end-1)?(l=!0,r&&oe(r,o.StrictOctalLiteral)):!r&&n.octal&&(r=n);for(;h<p&&"undefined"!==typeof(e=ht());)i.push(e);return i}function dt(){var e,t;return P(),te(),t=m,l=!1,e=ft(),v.markEnd(v.createProgram(e),t)}function pt(){var e,t,n,r=[];for(e=0;e<y.tokens.length;++e)n={type:(t=y.tokens[e]).type,value:t.value},y.range&&(n.range=t.range),y.loc&&(n.loc=t.loc),r.push(n);y.tokens=r}function vt(e,n){var r;"string"===typeof e||e instanceof String||(e=String(e)),v=u,h=0,f=(c=e).length>0?1:0,d=0,p=c.length,m=null,g={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},y={},(n=n||{}).tokens=!0,y.tokens=[],y.tokenize=!0,y.openParenToken=-1,y.openCurlyToken=-1,y.range="boolean"===typeof n.range&&n.range,y.loc="boolean"===typeof n.loc&&n.loc,"boolean"===typeof n.comment&&n.comment&&(y.comments=[]),"boolean"===typeof n.tolerant&&n.tolerant&&(y.errors=[]);try{if(te(),m.type===t.EOF)return y.tokens;for(ee();m.type!==t.EOF;)try{ee()}catch(a){if(m,y.errors){y.errors.push(a);break}throw a}pt(),r=y.tokens,"undefined"!==typeof y.comments&&(r.comments=y.comments),"undefined"!==typeof y.errors&&(r.errors=y.errors)}catch(i){throw i}finally{y={}}return r}function mt(e,t){var n,r;r=String,"string"===typeof e||e instanceof String||(e=r(e)),v=u,h=0,f=(c=e).length>0?1:0,d=0,p=c.length,m=null,g={allowIn:!0,labelSet:{},inFunctionBody:!1,inIteration:!1,inSwitch:!1,lastCommentStart:-1},y={},"undefined"!==typeof t&&(y.range="boolean"===typeof t.range&&t.range,y.loc="boolean"===typeof t.loc&&t.loc,y.attachComment="boolean"===typeof t.attachComment&&t.attachComment,y.loc&&null!==t.source&&void 0!==t.source&&(y.source=r(t.source)),"boolean"===typeof t.tokens&&t.tokens&&(y.tokens=[]),"boolean"===typeof t.comment&&t.comment&&(y.comments=[]),"boolean"===typeof t.tolerant&&t.tolerant&&(y.errors=[]),y.attachComment&&(y.range=!0,y.comments=[],y.bottomRightStack=[],y.trailingComments=[],y.leadingComments=[]));try{n=dt(),"undefined"!==typeof y.comments&&(n.comments=y.comments),"undefined"!==typeof y.tokens&&(pt(),n.tokens=y.tokens),"undefined"!==typeof y.errors&&(n.errors=y.errors)}catch(a){throw a}finally{y={}}return n}(n={})[(t={BooleanLiteral:1,EOF:2,Identifier:3,Keyword:4,NullLiteral:5,NumericLiteral:6,Punctuator:7,StringLiteral:8,RegularExpression:9}).BooleanLiteral]="Boolean",n[t.EOF]="<end>",n[t.Identifier]="Identifier",n[t.Keyword]="Keyword",n[t.NullLiteral]="Null",n[t.NumericLiteral]="Numeric",n[t.Punctuator]="Punctuator",n[t.StringLiteral]="String",n[t.RegularExpression]="RegularExpression",r=["(","{","[","in","typeof","instanceof","new","return","case","delete","throw","void","=","+=","-=","*=","/=","%=","<<=",">>=",">>>=","&=","|=","^=",",","+","-","*","/","%","++","--","<<",">>",">>>","&","|","^","!","~","&&","||","?",":","===","==",">=","<=","<",">","!=","!=="],a={AssignmentExpression:"AssignmentExpression",ArrayExpression:"ArrayExpression",BlockStatement:"BlockStatement",BinaryExpression:"BinaryExpression",BreakStatement:"BreakStatement",CallExpression:"CallExpression",CatchClause:"CatchClause",ConditionalExpression:"ConditionalExpression",ContinueStatement:"ContinueStatement",DoWhileStatement:"DoWhileStatement",DebuggerStatement:"DebuggerStatement",EmptyStatement:"EmptyStatement",ExpressionStatement:"ExpressionStatement",ForStatement:"ForStatement",ForInStatement:"ForInStatement",FunctionDeclaration:"FunctionDeclaration",FunctionExpression:"FunctionExpression",Identifier:"Identifier",IfStatement:"IfStatement",Literal:"Literal",LabeledStatement:"LabeledStatement",LogicalExpression:"LogicalExpression",MemberExpression:"MemberExpression",NewExpression:"NewExpression",ObjectExpression:"ObjectExpression",Program:"Program",Property:"Property",ReturnStatement:"ReturnStatement",SequenceExpression:"SequenceExpression",SwitchStatement:"SwitchStatement",SwitchCase:"SwitchCase",ThisExpression:"ThisExpression",ThrowStatement:"ThrowStatement",TryStatement:"TryStatement",UnaryExpression:"UnaryExpression",UpdateExpression:"UpdateExpression",VariableDeclaration:"VariableDeclaration",VariableDeclarator:"VariableDeclarator",WhileStatement:"WhileStatement",WithStatement:"WithStatement"},i={Data:1,Get:2,Set:4},o={UnexpectedToken:"Unexpected token %0",UnexpectedNumber:"Unexpected number",UnexpectedString:"Unexpected string",UnexpectedIdentifier:"Unexpected identifier",UnexpectedReserved:"Unexpected reserved word",UnexpectedEOS:"Unexpected end of input",NewlineAfterThrow:"Illegal newline after throw",InvalidRegExp:"Invalid regular expression",UnterminatedRegExp:"Invalid regular expression: missing /",InvalidLHSInAssignment:"Invalid left-hand side in assignment",InvalidLHSInForIn:"Invalid left-hand side in for-in",MultipleDefaultsInSwitch:"More than one default clause in switch statement",NoCatchOrFinally:"Missing catch or finally after try",UnknownLabel:"Undefined label '%0'",Redeclaration:"%0 '%1' has already been declared",IllegalContinue:"Illegal continue statement",IllegalBreak:"Illegal break statement",IllegalReturn:"Illegal return statement",StrictModeWith:"Strict mode code may not include a with statement",StrictCatchVariable:"Catch variable may not be eval or arguments in strict mode",StrictVarName:"Variable name may not be eval or arguments in strict mode",StrictParamName:"Parameter name eval or arguments is not allowed in strict mode",StrictParamDupe:"Strict mode function may not have duplicate parameter names",StrictFunctionName:"Function name may not be eval or arguments in strict mode",StrictOctalLiteral:"Octal literals are not allowed in strict mode.",StrictDelete:"Delete of an unqualified identifier in strict mode.",StrictDuplicateProperty:"Duplicate data property in object literal not allowed in strict mode",AccessorDataProperty:"Object literal may not have data and accessor property with the same name",AccessorGetSet:"Object literal may not have multiple get/set accessors with the same name",StrictLHSAssignment:"Assignment to eval or arguments is not allowed in strict mode",StrictLHSPostfix:"Postfix increment/decrement may not have eval or arguments operand in strict mode",StrictLHSPrefix:"Prefix increment/decrement may not have eval or arguments operand in strict mode",StrictReservedWord:"Use of future reserved word in strict mode"},s={NonAsciiIdentifierStart:new RegExp("[\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0370-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u05d0-\u05ea\u05f0-\u05f2\u0620-\u064a\u066e\u066f\u0671-\u06d3\u06d5\u06e5\u06e6\u06ee\u06ef\u06fa-\u06fc\u06ff\u0710\u0712-\u072f\u074d-\u07a5\u07b1\u07ca-\u07ea\u07f4\u07f5\u07fa\u0800-\u0815\u081a\u0824\u0828\u0840-\u0858\u08a0\u08a2-\u08ac\u0904-\u0939\u093d\u0950\u0958-\u0961\u0971-\u0977\u0979-\u097f\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bd\u09ce\u09dc\u09dd\u09df-\u09e1\u09f0\u09f1\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a59-\u0a5c\u0a5e\u0a72-\u0a74\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abd\u0ad0\u0ae0\u0ae1\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3d\u0b5c\u0b5d\u0b5f-\u0b61\u0b71\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bd0\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d\u0c58\u0c59\u0c60\u0c61\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbd\u0cde\u0ce0\u0ce1\u0cf1\u0cf2\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d\u0d4e\u0d60\u0d61\u0d7a-\u0d7f\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0e01-\u0e30\u0e32\u0e33\u0e40-\u0e46\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb0\u0eb2\u0eb3\u0ebd\u0ec0-\u0ec4\u0ec6\u0edc-\u0edf\u0f00\u0f40-\u0f47\u0f49-\u0f6c\u0f88-\u0f8c\u1000-\u102a\u103f\u1050-\u1055\u105a-\u105d\u1061\u1065\u1066\u106e-\u1070\u1075-\u1081\u108e\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1711\u1720-\u1731\u1740-\u1751\u1760-\u176c\u176e-\u1770\u1780-\u17b3\u17d7\u17dc\u1820-\u1877\u1880-\u18a8\u18aa\u18b0-\u18f5\u1900-\u191c\u1950-\u196d\u1970-\u1974\u1980-\u19ab\u19c1-\u19c7\u1a00-\u1a16\u1a20-\u1a54\u1aa7\u1b05-\u1b33\u1b45-\u1b4b\u1b83-\u1ba0\u1bae\u1baf\u1bba-\u1be5\u1c00-\u1c23\u1c4d-\u1c4f\u1c5a-\u1c7d\u1ce9-\u1cec\u1cee-\u1cf1\u1cf5\u1cf6\u1d00-\u1dbf\u1e00-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u2071\u207f\u2090-\u209c\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cee\u2cf2\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d80-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2e2f\u3005-\u3007\u3021-\u3029\u3031-\u3035\u3038-\u303c\u3041-\u3096\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua61f\ua62a\ua62b\ua640-\ua66e\ua67f-\ua697\ua6a0-\ua6ef\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua801\ua803-\ua805\ua807-\ua80a\ua80c-\ua822\ua840-\ua873\ua882-\ua8b3\ua8f2-\ua8f7\ua8fb\ua90a-\ua925\ua930-\ua946\ua960-\ua97c\ua984-\ua9b2\ua9cf\uaa00-\uaa28\uaa40-\uaa42\uaa44-\uaa4b\uaa60-\uaa76\uaa7a\uaa80-\uaaaf\uaab1\uaab5\uaab6\uaab9-\uaabd\uaac0\uaac2\uaadb-\uaadd\uaae0-\uaaea\uaaf2-\uaaf4\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabe2\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d\ufb1f-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe70-\ufe74\ufe76-\ufefc\uff21-\uff3a\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]"),NonAsciiIdentifierPart:new RegExp("[\xaa\xb5\xba\xc0-\xd6\xd8-\xf6\xf8-\u02c1\u02c6-\u02d1\u02e0-\u02e4\u02ec\u02ee\u0300-\u0374\u0376\u0377\u037a-\u037d\u0386\u0388-\u038a\u038c\u038e-\u03a1\u03a3-\u03f5\u03f7-\u0481\u0483-\u0487\u048a-\u0527\u0531-\u0556\u0559\u0561-\u0587\u0591-\u05bd\u05bf\u05c1\u05c2\u05c4\u05c5\u05c7\u05d0-\u05ea\u05f0-\u05f2\u0610-\u061a\u0620-\u0669\u066e-\u06d3\u06d5-\u06dc\u06df-\u06e8\u06ea-\u06fc\u06ff\u0710-\u074a\u074d-\u07b1\u07c0-\u07f5\u07fa\u0800-\u082d\u0840-\u085b\u08a0\u08a2-\u08ac\u08e4-\u08fe\u0900-\u0963\u0966-\u096f\u0971-\u0977\u0979-\u097f\u0981-\u0983\u0985-\u098c\u098f\u0990\u0993-\u09a8\u09aa-\u09b0\u09b2\u09b6-\u09b9\u09bc-\u09c4\u09c7\u09c8\u09cb-\u09ce\u09d7\u09dc\u09dd\u09df-\u09e3\u09e6-\u09f1\u0a01-\u0a03\u0a05-\u0a0a\u0a0f\u0a10\u0a13-\u0a28\u0a2a-\u0a30\u0a32\u0a33\u0a35\u0a36\u0a38\u0a39\u0a3c\u0a3e-\u0a42\u0a47\u0a48\u0a4b-\u0a4d\u0a51\u0a59-\u0a5c\u0a5e\u0a66-\u0a75\u0a81-\u0a83\u0a85-\u0a8d\u0a8f-\u0a91\u0a93-\u0aa8\u0aaa-\u0ab0\u0ab2\u0ab3\u0ab5-\u0ab9\u0abc-\u0ac5\u0ac7-\u0ac9\u0acb-\u0acd\u0ad0\u0ae0-\u0ae3\u0ae6-\u0aef\u0b01-\u0b03\u0b05-\u0b0c\u0b0f\u0b10\u0b13-\u0b28\u0b2a-\u0b30\u0b32\u0b33\u0b35-\u0b39\u0b3c-\u0b44\u0b47\u0b48\u0b4b-\u0b4d\u0b56\u0b57\u0b5c\u0b5d\u0b5f-\u0b63\u0b66-\u0b6f\u0b71\u0b82\u0b83\u0b85-\u0b8a\u0b8e-\u0b90\u0b92-\u0b95\u0b99\u0b9a\u0b9c\u0b9e\u0b9f\u0ba3\u0ba4\u0ba8-\u0baa\u0bae-\u0bb9\u0bbe-\u0bc2\u0bc6-\u0bc8\u0bca-\u0bcd\u0bd0\u0bd7\u0be6-\u0bef\u0c01-\u0c03\u0c05-\u0c0c\u0c0e-\u0c10\u0c12-\u0c28\u0c2a-\u0c33\u0c35-\u0c39\u0c3d-\u0c44\u0c46-\u0c48\u0c4a-\u0c4d\u0c55\u0c56\u0c58\u0c59\u0c60-\u0c63\u0c66-\u0c6f\u0c82\u0c83\u0c85-\u0c8c\u0c8e-\u0c90\u0c92-\u0ca8\u0caa-\u0cb3\u0cb5-\u0cb9\u0cbc-\u0cc4\u0cc6-\u0cc8\u0cca-\u0ccd\u0cd5\u0cd6\u0cde\u0ce0-\u0ce3\u0ce6-\u0cef\u0cf1\u0cf2\u0d02\u0d03\u0d05-\u0d0c\u0d0e-\u0d10\u0d12-\u0d3a\u0d3d-\u0d44\u0d46-\u0d48\u0d4a-\u0d4e\u0d57\u0d60-\u0d63\u0d66-\u0d6f\u0d7a-\u0d7f\u0d82\u0d83\u0d85-\u0d96\u0d9a-\u0db1\u0db3-\u0dbb\u0dbd\u0dc0-\u0dc6\u0dca\u0dcf-\u0dd4\u0dd6\u0dd8-\u0ddf\u0df2\u0df3\u0e01-\u0e3a\u0e40-\u0e4e\u0e50-\u0e59\u0e81\u0e82\u0e84\u0e87\u0e88\u0e8a\u0e8d\u0e94-\u0e97\u0e99-\u0e9f\u0ea1-\u0ea3\u0ea5\u0ea7\u0eaa\u0eab\u0ead-\u0eb9\u0ebb-\u0ebd\u0ec0-\u0ec4\u0ec6\u0ec8-\u0ecd\u0ed0-\u0ed9\u0edc-\u0edf\u0f00\u0f18\u0f19\u0f20-\u0f29\u0f35\u0f37\u0f39\u0f3e-\u0f47\u0f49-\u0f6c\u0f71-\u0f84\u0f86-\u0f97\u0f99-\u0fbc\u0fc6\u1000-\u1049\u1050-\u109d\u10a0-\u10c5\u10c7\u10cd\u10d0-\u10fa\u10fc-\u1248\u124a-\u124d\u1250-\u1256\u1258\u125a-\u125d\u1260-\u1288\u128a-\u128d\u1290-\u12b0\u12b2-\u12b5\u12b8-\u12be\u12c0\u12c2-\u12c5\u12c8-\u12d6\u12d8-\u1310\u1312-\u1315\u1318-\u135a\u135d-\u135f\u1380-\u138f\u13a0-\u13f4\u1401-\u166c\u166f-\u167f\u1681-\u169a\u16a0-\u16ea\u16ee-\u16f0\u1700-\u170c\u170e-\u1714\u1720-\u1734\u1740-\u1753\u1760-\u176c\u176e-\u1770\u1772\u1773\u1780-\u17d3\u17d7\u17dc\u17dd\u17e0-\u17e9\u180b-\u180d\u1810-\u1819\u1820-\u1877\u1880-\u18aa\u18b0-\u18f5\u1900-\u191c\u1920-\u192b\u1930-\u193b\u1946-\u196d\u1970-\u1974\u1980-\u19ab\u19b0-\u19c9\u19d0-\u19d9\u1a00-\u1a1b\u1a20-\u1a5e\u1a60-\u1a7c\u1a7f-\u1a89\u1a90-\u1a99\u1aa7\u1b00-\u1b4b\u1b50-\u1b59\u1b6b-\u1b73\u1b80-\u1bf3\u1c00-\u1c37\u1c40-\u1c49\u1c4d-\u1c7d\u1cd0-\u1cd2\u1cd4-\u1cf6\u1d00-\u1de6\u1dfc-\u1f15\u1f18-\u1f1d\u1f20-\u1f45\u1f48-\u1f4d\u1f50-\u1f57\u1f59\u1f5b\u1f5d\u1f5f-\u1f7d\u1f80-\u1fb4\u1fb6-\u1fbc\u1fbe\u1fc2-\u1fc4\u1fc6-\u1fcc\u1fd0-\u1fd3\u1fd6-\u1fdb\u1fe0-\u1fec\u1ff2-\u1ff4\u1ff6-\u1ffc\u200c\u200d\u203f\u2040\u2054\u2071\u207f\u2090-\u209c\u20d0-\u20dc\u20e1\u20e5-\u20f0\u2102\u2107\u210a-\u2113\u2115\u2119-\u211d\u2124\u2126\u2128\u212a-\u212d\u212f-\u2139\u213c-\u213f\u2145-\u2149\u214e\u2160-\u2188\u2c00-\u2c2e\u2c30-\u2c5e\u2c60-\u2ce4\u2ceb-\u2cf3\u2d00-\u2d25\u2d27\u2d2d\u2d30-\u2d67\u2d6f\u2d7f-\u2d96\u2da0-\u2da6\u2da8-\u2dae\u2db0-\u2db6\u2db8-\u2dbe\u2dc0-\u2dc6\u2dc8-\u2dce\u2dd0-\u2dd6\u2dd8-\u2dde\u2de0-\u2dff\u2e2f\u3005-\u3007\u3021-\u302f\u3031-\u3035\u3038-\u303c\u3041-\u3096\u3099\u309a\u309d-\u309f\u30a1-\u30fa\u30fc-\u30ff\u3105-\u312d\u3131-\u318e\u31a0-\u31ba\u31f0-\u31ff\u3400-\u4db5\u4e00-\u9fcc\ua000-\ua48c\ua4d0-\ua4fd\ua500-\ua60c\ua610-\ua62b\ua640-\ua66f\ua674-\ua67d\ua67f-\ua697\ua69f-\ua6f1\ua717-\ua71f\ua722-\ua788\ua78b-\ua78e\ua790-\ua793\ua7a0-\ua7aa\ua7f8-\ua827\ua840-\ua873\ua880-\ua8c4\ua8d0-\ua8d9\ua8e0-\ua8f7\ua8fb\ua900-\ua92d\ua930-\ua953\ua960-\ua97c\ua980-\ua9c0\ua9cf-\ua9d9\uaa00-\uaa36\uaa40-\uaa4d\uaa50-\uaa59\uaa60-\uaa76\uaa7a\uaa7b\uaa80-\uaac2\uaadb-\uaadd\uaae0-\uaaef\uaaf2-\uaaf6\uab01-\uab06\uab09-\uab0e\uab11-\uab16\uab20-\uab26\uab28-\uab2e\uabc0-\uabea\uabec\uabed\uabf0-\uabf9\uac00-\ud7a3\ud7b0-\ud7c6\ud7cb-\ud7fb\uf900-\ufa6d\ufa70-\ufad9\ufb00-\ufb06\ufb13-\ufb17\ufb1d-\ufb28\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40\ufb41\ufb43\ufb44\ufb46-\ufbb1\ufbd3-\ufd3d\ufd50-\ufd8f\ufd92-\ufdc7\ufdf0-\ufdfb\ufe00-\ufe0f\ufe20-\ufe26\ufe33\ufe34\ufe4d-\ufe4f\ufe70-\ufe74\ufe76-\ufefc\uff10-\uff19\uff21-\uff3a\uff3f\uff41-\uff5a\uff66-\uffbe\uffc2-\uffc7\uffca-\uffcf\uffd2-\uffd7\uffda-\uffdc]")},u={name:"SyntaxTree",processComment:function(e){var t,n;if(!(e.type===a.Program&&e.body.length>0)){for(y.trailingComments.length>0?y.trailingComments[0].range[0]>=e.range[1]?(n=y.trailingComments,y.trailingComments=[]):y.trailingComments.length=0:y.bottomRightStack.length>0&&y.bottomRightStack[y.bottomRightStack.length-1].trailingComments&&y.bottomRightStack[y.bottomRightStack.length-1].trailingComments[0].range[0]>=e.range[1]&&(n=y.bottomRightStack[y.bottomRightStack.length-1].trailingComments,delete y.bottomRightStack[y.bottomRightStack.length-1].trailingComments);y.bottomRightStack.length>0&&y.bottomRightStack[y.bottomRightStack.length-1].range[0]>=e.range[0];)t=y.bottomRightStack.pop();t?t.leadingComments&&t.leadingComments[t.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=t.leadingComments,delete t.leadingComments):y.leadingComments.length>0&&y.leadingComments[y.leadingComments.length-1].range[1]<=e.range[0]&&(e.leadingComments=y.leadingComments,y.leadingComments=[]),n&&(e.trailingComments=n),y.bottomRightStack.push(e)}},markEnd:function(e,t){return y.range&&(e.range=[t.start,h]),y.loc&&(e.loc=new re(void 0===t.startLineNumber?t.lineNumber:t.startLineNumber,t.start-(void 0===t.startLineStart?t.lineStart:t.startLineStart),f,h-d),this.postProcess(e)),y.attachComment&&this.processComment(e),e},postProcess:function(e){return y.source&&(e.loc.source=y.source),e},createArrayExpression:function(e){return{type:a.ArrayExpression,elements:e}},createAssignmentExpression:function(e,t,n){return{type:a.AssignmentExpression,operator:e,left:t,right:n}},createBinaryExpression:function(e,t,n){return{type:"||"===e||"&&"===e?a.LogicalExpression:a.BinaryExpression,operator:e,left:t,right:n}},createBlockStatement:function(e){return{type:a.BlockStatement,body:e}},createBreakStatement:function(e){return{type:a.BreakStatement,label:e}},createCallExpression:function(e,t){return{type:a.CallExpression,callee:e,arguments:t}},createCatchClause:function(e,t){return{type:a.CatchClause,param:e,body:t}},createConditionalExpression:function(e,t,n){return{type:a.ConditionalExpression,test:e,consequent:t,alternate:n}},createContinueStatement:function(e){return{type:a.ContinueStatement,label:e}},createDebuggerStatement:function(){return{type:a.DebuggerStatement}},createDoWhileStatement:function(e,t){return{type:a.DoWhileStatement,body:e,test:t}},createEmptyStatement:function(){return{type:a.EmptyStatement}},createExpressionStatement:function(e){return{type:a.ExpressionStatement,expression:e}},createForStatement:function(e,t,n,r){return{type:a.ForStatement,init:e,test:t,update:n,body:r}},createForInStatement:function(e,t,n){return{type:a.ForInStatement,left:e,right:t,body:n,each:!1}},createFunctionDeclaration:function(e,t,n,r){return{type:a.FunctionDeclaration,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createFunctionExpression:function(e,t,n,r){return{type:a.FunctionExpression,id:e,params:t,defaults:n,body:r,rest:null,generator:!1,expression:!1}},createIdentifier:function(e){return{type:a.Identifier,name:e}},createIfStatement:function(e,t,n){return{type:a.IfStatement,test:e,consequent:t,alternate:n}},createLabeledStatement:function(e,t){return{type:a.LabeledStatement,label:e,body:t}},createLiteral:function(e){return{type:a.Literal,value:e.value,raw:c.slice(e.start,e.end)}},createMemberExpression:function(e,t,n){return{type:a.MemberExpression,computed:"["===e,object:t,property:n}},createNewExpression:function(e,t){return{type:a.NewExpression,callee:e,arguments:t}},createObjectExpression:function(e){return{type:a.ObjectExpression,properties:e}},createPostfixExpression:function(e,t){return{type:a.UpdateExpression,operator:e,argument:t,prefix:!1}},createProgram:function(e){return{type:a.Program,body:e}},createProperty:function(e,t,n){return{type:a.Property,key:t,value:n,kind:e}},createReturnStatement:function(e){return{type:a.ReturnStatement,argument:e}},createSequenceExpression:function(e){return{type:a.SequenceExpression,expressions:e}},createSwitchCase:function(e,t){return{type:a.SwitchCase,test:e,consequent:t}},createSwitchStatement:function(e,t){return{type:a.SwitchStatement,discriminant:e,cases:t}},createThisExpression:function(){return{type:a.ThisExpression}},createThrowStatement:function(e){return{type:a.ThrowStatement,argument:e}},createTryStatement:function(e,t,n,r){return{type:a.TryStatement,block:e,guardedHandlers:t,handlers:n,finalizer:r}},createUnaryExpression:function(e,t){return"++"===e||"--"===e?{type:a.UpdateExpression,operator:e,argument:t,prefix:!0}:{type:a.UnaryExpression,operator:e,argument:t,prefix:!0}},createVariableDeclaration:function(e,t){return{type:a.VariableDeclaration,declarations:e,kind:t}},createVariableDeclarator:function(e,t){return{type:a.VariableDeclarator,id:e,init:t}},createWhileStatement:function(e,t){return{type:a.WhileStatement,test:e,body:t}},createWithStatement:function(e,t){return{type:a.WithStatement,object:e,body:t}}},e.version="1.2.5",e.tokenize=vt,e.parse=mt,e.Syntax=function(){var e,t={};for(e in"function"===typeof Object.create&&(t=Object.create(null)),a)a.hasOwnProperty(e)&&(t[e]=a[e]);return"function"===typeof Object.freeze&&Object.freeze(t),t}()},void 0===(a="function"===typeof n?n.apply(t,r):n)||(e.exports=a)}()},3675:function(e,t,n){"use strict";var r=n(3546),a=n(7549),i=["args","body"],o=["pre","post","printCode","funcName","blockSize"];e.exports=function(e){for(var t in e)i.indexOf(t)<0&&o.indexOf(t)<0&&console.warn("cwise: Unknown argument '"+t+"' passed to expression compiler");for(var n=0;n<i.length;++n)if(!e[i[n]])throw new Error("cwise: Missing argument: "+i[n]);return a({args:e.args,pre:r(e.pre||function(){}),body:r(e.body),post:r(e.post||function(){}),debug:!!e.printCode,funcName:e.funcName||e.body.name||"cwise",blockSize:e.blockSize||64})}},7494:function(e){function t(e,t,n){var r,a,i,o,s;function u(){var c=Date.now()-o;c<t&&c>=0?r=setTimeout(u,t-c):(r=null,n||(s=e.apply(i,a),i=a=null))}null==t&&(t=100);var c=function(){i=this,a=arguments,o=Date.now();var c=n&&!r;return r||(r=setTimeout(u,t)),c&&(s=e.apply(i,a),i=a=null),s};return c.clear=function(){r&&(clearTimeout(r),r=null)},c.flush=function(){r&&(s=e.apply(i,a),i=a=null,clearTimeout(r),r=null)},c}t.debounce=t,e.exports=t},8287:function(e){"use strict";function t(e,n,r){var a=0|e[r];if(a<=0)return[];var i,o=new Array(a);if(r===e.length-1)for(i=0;i<a;++i)o[i]=n;else for(i=0;i<a;++i)o[i]=t(e,n,r+1);return o}e.exports=function(e,n){switch("undefined"===typeof n&&(n=0),typeof e){case"number":if(e>0)return function(e,t){var n,r;for(n=new Array(e),r=0;r<e;++r)n[r]=t;return n}(0|e,n);break;case"object":if("number"===typeof e.length)return t(e,n,0)}return[]}},567:function(e){"use strict";function t(e){if(this.size=0|e,this.size<=1||0!==(this.size&this.size-1))throw new Error("FFT size must be a power of two and bigger than 1");this._csize=e<<1;for(var t=new Array(2*this.size),n=0;n<t.length;n+=2){var r=Math.PI*n/this.size;t[n]=Math.cos(r),t[n+1]=-Math.sin(r)}this.table=t;for(var a=0,i=1;this.size>i;i<<=1)a++;this._width=a%2===0?a-1:a,this._bitrev=new Array(1<<this._width);for(var o=0;o<this._bitrev.length;o++){this._bitrev[o]=0;for(var s=0;s<this._width;s+=2){var u=this._width-s-2;this._bitrev[o]|=(o>>>s&3)<<u}}this._out=null,this._data=null,this._inv=0}e.exports=t,t.prototype.fromComplexArray=function(e,t){for(var n=t||new Array(e.length>>>1),r=0;r<e.length;r+=2)n[r>>>1]=e[r];return n},t.prototype.createComplexArray=function(){for(var e=new Array(this._csize),t=0;t<e.length;t++)e[t]=0;return e},t.prototype.toComplexArray=function(e,t){for(var n=t||this.createComplexArray(),r=0;r<n.length;r+=2)n[r]=e[r>>>1],n[r+1]=0;return n},t.prototype.completeSpectrum=function(e){for(var t=this._csize,n=t>>>1,r=2;r<n;r+=2)e[t-r]=e[r],e[t-r+1]=-e[r+1]},t.prototype.transform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=0,this._transform4(),this._out=null,this._data=null},t.prototype.realTransform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=0,this._realTransform4(),this._out=null,this._data=null},t.prototype.inverseTransform=function(e,t){if(e===t)throw new Error("Input and output buffers must be different");this._out=e,this._data=t,this._inv=1,this._transform4();for(var n=0;n<e.length;n++)e[n]/=this.size;this._out=null,this._data=null},t.prototype._transform4=function(){var e,t,n=this._out,r=this._csize,a=1<<this._width,i=r/a<<1,o=this._bitrev;if(4===i)for(e=0,t=0;e<r;e+=i,t++){var s=o[t];this._singleTransform2(e,s,a)}else for(e=0,t=0;e<r;e+=i,t++){var u=o[t];this._singleTransform4(e,u,a)}var c=this._inv?-1:1,l=this.table;for(a>>=2;a>=2;a>>=2){var h=(i=r/a<<1)>>>2;for(e=0;e<r;e+=i)for(var f=e+h,d=e,p=0;d<f;d+=2,p+=a){var v=d,m=v+h,g=m+h,y=g+h,b=n[v],x=n[v+1],k=n[m],w=n[m+1],_=n[g],S=n[g+1],C=n[y],T=n[y+1],E=b,I=x,A=l[p],M=c*l[p+1],N=k*A-w*M,R=k*M+w*A,D=l[2*p],P=c*l[2*p+1],O=_*D-S*P,L=_*P+S*D,F=l[3*p],z=c*l[3*p+1],B=C*F-T*z,U=C*z+T*F,V=E+O,W=I+L,G=E-O,j=I-L,q=N+B,H=R+U,X=c*(N-B),K=c*(R-U),Y=V+q,Q=W+H,Z=V-q,J=W-H,$=G+K,ee=j-X,te=G-K,ne=j+X;n[v]=Y,n[v+1]=Q,n[m]=$,n[m+1]=ee,n[g]=Z,n[g+1]=J,n[y]=te,n[y+1]=ne}}},t.prototype._singleTransform2=function(e,t,n){var r=this._out,a=this._data,i=a[t],o=a[t+1],s=a[t+n],u=a[t+n+1],c=i+s,l=o+u,h=i-s,f=o-u;r[e]=c,r[e+1]=l,r[e+2]=h,r[e+3]=f},t.prototype._singleTransform4=function(e,t,n){var r=this._out,a=this._data,i=this._inv?-1:1,o=2*n,s=3*n,u=a[t],c=a[t+1],l=a[t+n],h=a[t+n+1],f=a[t+o],d=a[t+o+1],p=a[t+s],v=a[t+s+1],m=u+f,g=c+d,y=u-f,b=c-d,x=l+p,k=h+v,w=i*(l-p),_=i*(h-v),S=m+x,C=g+k,T=y+_,E=b-w,I=m-x,A=g-k,M=y-_,N=b+w;r[e]=S,r[e+1]=C,r[e+2]=T,r[e+3]=E,r[e+4]=I,r[e+5]=A,r[e+6]=M,r[e+7]=N},t.prototype._realTransform4=function(){var e,t,n=this._out,r=this._csize,a=1<<this._width,i=r/a<<1,o=this._bitrev;if(4===i)for(e=0,t=0;e<r;e+=i,t++){var s=o[t];this._singleRealTransform2(e,s>>>1,a>>>1)}else for(e=0,t=0;e<r;e+=i,t++){var u=o[t];this._singleRealTransform4(e,u>>>1,a>>>1)}var c=this._inv?-1:1,l=this.table;for(a>>=2;a>=2;a>>=2){var h=(i=r/a<<1)>>>1,f=h>>>1,d=f>>>1;for(e=0;e<r;e+=i)for(var p=0,v=0;p<=d;p+=2,v+=a){var m=e+p,g=m+f,y=g+f,b=y+f,x=n[m],k=n[m+1],w=n[g],_=n[g+1],S=n[y],C=n[y+1],T=n[b],E=n[b+1],I=x,A=k,M=l[v],N=c*l[v+1],R=w*M-_*N,D=w*N+_*M,P=l[2*v],O=c*l[2*v+1],L=S*P-C*O,F=S*O+C*P,z=l[3*v],B=c*l[3*v+1],U=T*z-E*B,V=T*B+E*z,W=I+L,G=A+F,j=I-L,q=A-F,H=R+U,X=D+V,K=c*(R-U),Y=c*(D-V),Q=W+H,Z=G+X,J=j+Y,$=q-K;if(n[m]=Q,n[m+1]=Z,n[g]=J,n[g+1]=$,0!==p){if(p!==d){var ee=j+-c*Y,te=-q+-c*K,ne=W+-c*H,re=-G- -c*X,ae=e+f-p,ie=e+h-p;n[ae]=ee,n[ae+1]=te,n[ie]=ne,n[ie+1]=re}}else{var oe=W-H,se=G-X;n[y]=oe,n[y+1]=se}}}},t.prototype._singleRealTransform2=function(e,t,n){var r=this._out,a=this._data,i=a[t],o=a[t+n],s=i+o,u=i-o;r[e]=s,r[e+1]=0,r[e+2]=u,r[e+3]=0},t.prototype._singleRealTransform4=function(e,t,n){var r=this._out,a=this._data,i=this._inv?-1:1,o=2*n,s=3*n,u=a[t],c=a[t+n],l=a[t+o],h=a[t+s],f=u+l,d=u-l,p=c+h,v=i*(c-h),m=f+p,g=d,y=-v,b=f-p,x=d,k=v;r[e]=m,r[e+1]=0,r[e+2]=g,r[e+3]=y,r[e+4]=b,r[e+5]=0,r[e+6]=x,r[e+7]=k}},2110:function(e,t,n){"use strict";var r=n(7441),a={childContextTypes:!0,contextType:!0,contextTypes:!0,defaultProps:!0,displayName:!0,getDefaultProps:!0,getDerivedStateFromError:!0,getDerivedStateFromProps:!0,mixins:!0,propTypes:!0,type:!0},i={name:!0,length:!0,prototype:!0,caller:!0,callee:!0,arguments:!0,arity:!0},o={$$typeof:!0,compare:!0,defaultProps:!0,displayName:!0,propTypes:!0,type:!0},s={};function u(e){return r.isMemo(e)?o:s[e.$$typeof]||a}s[r.ForwardRef]={$$typeof:!0,render:!0,defaultProps:!0,displayName:!0,propTypes:!0},s[r.Memo]=o;var c=Object.defineProperty,l=Object.getOwnPropertyNames,h=Object.getOwnPropertySymbols,f=Object.getOwnPropertyDescriptor,d=Object.getPrototypeOf,p=Object.prototype;e.exports=function e(t,n,r){if("string"!==typeof n){if(p){var a=d(n);a&&a!==p&&e(t,a,r)}var o=l(n);h&&(o=o.concat(h(n)));for(var s=u(t),v=u(n),m=0;m<o.length;++m){var g=o[m];if(!i[g]&&(!r||!r[g])&&(!v||!v[g])&&(!s||!s[g])){var y=f(n,g);try{c(t,g,y)}catch(b){}}}}return t}},4038:function(e,t){t.read=function(e,t,n,r,a){var i,o,s=8*a-r-1,u=(1<<s)-1,c=u>>1,l=-7,h=n?a-1:0,f=n?-1:1,d=e[t+h];for(h+=f,i=d&(1<<-l)-1,d>>=-l,l+=s;l>0;i=256*i+e[t+h],h+=f,l-=8);for(o=i&(1<<-l)-1,i>>=-l,l+=r;l>0;o=256*o+e[t+h],h+=f,l-=8);if(0===i)i=1-c;else{if(i===u)return o?NaN:1/0*(d?-1:1);o+=Math.pow(2,r),i-=c}return(d?-1:1)*o*Math.pow(2,i-r)},t.write=function(e,t,n,r,a,i){var o,s,u,c=8*i-a-1,l=(1<<c)-1,h=l>>1,f=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,d=r?0:i-1,p=r?1:-1,v=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(s=isNaN(t)?1:0,o=l):(o=Math.floor(Math.log(t)/Math.LN2),t*(u=Math.pow(2,-o))<1&&(o--,u*=2),(t+=o+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(o++,u/=2),o+h>=l?(s=0,o=l):o+h>=1?(s=(t*u-1)*Math.pow(2,a),o+=h):(s=t*Math.pow(2,h-1)*Math.pow(2,a),o=0));a>=8;e[n+d]=255&s,d+=p,s/=256,a-=8);for(o=o<<a|s,c+=a;c>0;e[n+d]=255&o,d+=p,o/=256,c-=8);e[n+d-p]|=128*v}},9897:function(e){"use strict";e.exports=function(e){for(var t=new Array(e),n=0;n<e;++n)t[n]=n;return t}},5586:function(e){function t(e){return!!e.constructor&&"function"===typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}e.exports=function(e){return null!=e&&(t(e)||function(e){return"function"===typeof e.readFloatLE&&"function"===typeof e.slice&&t(e.slice(0,0))}(e)||!!e._isBuffer)}},8987:function(e){e.exports=n;var t=null;try{t=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch(C){}function n(e,t,n){this.low=0|e,this.high=0|t,this.unsigned=!!n}function r(e){return!0===(e&&e.__isLong__)}n.prototype.__isLong__,Object.defineProperty(n.prototype,"__isLong__",{value:!0}),n.isLong=r;var a={},i={};function o(e,t){var n,r,o;return t?(o=0<=(e>>>=0)&&e<256)&&(r=i[e])?r:(n=u(e,(0|e)<0?-1:0,!0),o&&(i[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(r=a[e])?r:(n=u(e,e<0?-1:0,!1),o&&(a[e]=n),n)}function s(e,t){if(isNaN(e))return t?g:m;if(t){if(e<0)return g;if(e>=d)return w}else{if(e<=-p)return _;if(e+1>=p)return k}return e<0?s(-e,t).neg():u(e%f|0,e/f|0,t)}function u(e,t,r){return new n(e,t,r)}n.fromInt=o,n.fromNumber=s,n.fromBits=u;var c=Math.pow;function l(e,t,n){if(0===e.length)throw Error("empty string");if("NaN"===e||"Infinity"===e||"+Infinity"===e||"-Infinity"===e)return m;if("number"===typeof t?(n=t,t=!1):t=!!t,(n=n||10)<2||36<n)throw RangeError("radix");var r;if((r=e.indexOf("-"))>0)throw Error("interior hyphen");if(0===r)return l(e.substring(1),t,n).neg();for(var a=s(c(n,8)),i=m,o=0;o<e.length;o+=8){var u=Math.min(8,e.length-o),h=parseInt(e.substring(o,o+u),n);if(u<8){var f=s(c(n,u));i=i.mul(f).add(s(h))}else i=(i=i.mul(a)).add(s(h))}return i.unsigned=t,i}function h(e,t){return"number"===typeof e?s(e,t):"string"===typeof e?l(e,t):u(e.low,e.high,"boolean"===typeof t?t:e.unsigned)}n.fromString=l,n.fromValue=h;var f=4294967296,d=f*f,p=d/2,v=o(1<<24),m=o(0);n.ZERO=m;var g=o(0,!0);n.UZERO=g;var y=o(1);n.ONE=y;var b=o(1,!0);n.UONE=b;var x=o(-1);n.NEG_ONE=x;var k=u(-1,2147483647,!1);n.MAX_VALUE=k;var w=u(-1,-1,!0);n.MAX_UNSIGNED_VALUE=w;var _=u(0,-2147483648,!1);n.MIN_VALUE=_;var S=n.prototype;S.toInt=function(){return this.unsigned?this.low>>>0:this.low},S.toNumber=function(){return this.unsigned?(this.high>>>0)*f+(this.low>>>0):this.high*f+(this.low>>>0)},S.toString=function(e){if((e=e||10)<2||36<e)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative()){if(this.eq(_)){var t=s(e),n=this.div(t),r=n.mul(t).sub(this);return n.toString(e)+r.toInt().toString(e)}return"-"+this.neg().toString(e)}for(var a=s(c(e,6),this.unsigned),i=this,o="";;){var u=i.div(a),l=(i.sub(u.mul(a)).toInt()>>>0).toString(e);if((i=u).isZero())return l+o;for(;l.length<6;)l="0"+l;o=""+l+o}},S.getHighBits=function(){return this.high},S.getHighBitsUnsigned=function(){return this.high>>>0},S.getLowBits=function(){return this.low},S.getLowBitsUnsigned=function(){return this.low>>>0},S.getNumBitsAbs=function(){if(this.isNegative())return this.eq(_)?64:this.neg().getNumBitsAbs();for(var e=0!=this.high?this.high:this.low,t=31;t>0&&0==(e&1<<t);t--);return 0!=this.high?t+33:t+1},S.isZero=function(){return 0===this.high&&0===this.low},S.eqz=S.isZero,S.isNegative=function(){return!this.unsigned&&this.high<0},S.isPositive=function(){return this.unsigned||this.high>=0},S.isOdd=function(){return 1===(1&this.low)},S.isEven=function(){return 0===(1&this.low)},S.equals=function(e){return r(e)||(e=h(e)),(this.unsigned===e.unsigned||this.high>>>31!==1||e.high>>>31!==1)&&(this.high===e.high&&this.low===e.low)},S.eq=S.equals,S.notEquals=function(e){return!this.eq(e)},S.neq=S.notEquals,S.ne=S.notEquals,S.lessThan=function(e){return this.comp(e)<0},S.lt=S.lessThan,S.lessThanOrEqual=function(e){return this.comp(e)<=0},S.lte=S.lessThanOrEqual,S.le=S.lessThanOrEqual,S.greaterThan=function(e){return this.comp(e)>0},S.gt=S.greaterThan,S.greaterThanOrEqual=function(e){return this.comp(e)>=0},S.gte=S.greaterThanOrEqual,S.ge=S.greaterThanOrEqual,S.compare=function(e){if(r(e)||(e=h(e)),this.eq(e))return 0;var t=this.isNegative(),n=e.isNegative();return t&&!n?-1:!t&&n?1:this.unsigned?e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1:this.sub(e).isNegative()?-1:1},S.comp=S.compare,S.negate=function(){return!this.unsigned&&this.eq(_)?_:this.not().add(y)},S.neg=S.negate,S.add=function(e){r(e)||(e=h(e));var t=this.high>>>16,n=65535&this.high,a=this.low>>>16,i=65535&this.low,o=e.high>>>16,s=65535&e.high,c=e.low>>>16,l=0,f=0,d=0,p=0;return d+=(p+=i+(65535&e.low))>>>16,f+=(d+=a+c)>>>16,l+=(f+=n+s)>>>16,l+=t+o,u((d&=65535)<<16|(p&=65535),(l&=65535)<<16|(f&=65535),this.unsigned)},S.subtract=function(e){return r(e)||(e=h(e)),this.add(e.neg())},S.sub=S.subtract,S.multiply=function(e){if(this.isZero())return m;if(r(e)||(e=h(e)),t)return u(t.mul(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned);if(e.isZero())return m;if(this.eq(_))return e.isOdd()?_:m;if(e.eq(_))return this.isOdd()?_:m;if(this.isNegative())return e.isNegative()?this.neg().mul(e.neg()):this.neg().mul(e).neg();if(e.isNegative())return this.mul(e.neg()).neg();if(this.lt(v)&&e.lt(v))return s(this.toNumber()*e.toNumber(),this.unsigned);var n=this.high>>>16,a=65535&this.high,i=this.low>>>16,o=65535&this.low,c=e.high>>>16,l=65535&e.high,f=e.low>>>16,d=65535&e.low,p=0,g=0,y=0,b=0;return y+=(b+=o*d)>>>16,g+=(y+=i*d)>>>16,y&=65535,g+=(y+=o*f)>>>16,p+=(g+=a*d)>>>16,g&=65535,p+=(g+=i*f)>>>16,g&=65535,p+=(g+=o*l)>>>16,p+=n*d+a*f+i*l+o*c,u((y&=65535)<<16|(b&=65535),(p&=65535)<<16|(g&=65535),this.unsigned)},S.mul=S.multiply,S.divide=function(e){if(r(e)||(e=h(e)),e.isZero())throw Error("division by zero");var n,a,i;if(t)return this.unsigned||-2147483648!==this.high||-1!==e.low||-1!==e.high?u((this.unsigned?t.div_u:t.div_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this;if(this.isZero())return this.unsigned?g:m;if(this.unsigned){if(e.unsigned||(e=e.toUnsigned()),e.gt(this))return g;if(e.gt(this.shru(1)))return b;i=g}else{if(this.eq(_))return e.eq(y)||e.eq(x)?_:e.eq(_)?y:(n=this.shr(1).div(e).shl(1)).eq(m)?e.isNegative()?y:x:(a=this.sub(e.mul(n)),i=n.add(a.div(e)));if(e.eq(_))return this.unsigned?g:m;if(this.isNegative())return e.isNegative()?this.neg().div(e.neg()):this.neg().div(e).neg();if(e.isNegative())return this.div(e.neg()).neg();i=m}for(a=this;a.gte(e);){n=Math.max(1,Math.floor(a.toNumber()/e.toNumber()));for(var o=Math.ceil(Math.log(n)/Math.LN2),l=o<=48?1:c(2,o-48),f=s(n),d=f.mul(e);d.isNegative()||d.gt(a);)d=(f=s(n-=l,this.unsigned)).mul(e);f.isZero()&&(f=y),i=i.add(f),a=a.sub(d)}return i},S.div=S.divide,S.modulo=function(e){return r(e)||(e=h(e)),t?u((this.unsigned?t.rem_u:t.rem_s)(this.low,this.high,e.low,e.high),t.get_high(),this.unsigned):this.sub(this.div(e).mul(e))},S.mod=S.modulo,S.rem=S.modulo,S.not=function(){return u(~this.low,~this.high,this.unsigned)},S.and=function(e){return r(e)||(e=h(e)),u(this.low&e.low,this.high&e.high,this.unsigned)},S.or=function(e){return r(e)||(e=h(e)),u(this.low|e.low,this.high|e.high,this.unsigned)},S.xor=function(e){return r(e)||(e=h(e)),u(this.low^e.low,this.high^e.high,this.unsigned)},S.shiftLeft=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?u(this.low<<e,this.high<<e|this.low>>>32-e,this.unsigned):u(0,this.low<<e-32,this.unsigned)},S.shl=S.shiftLeft,S.shiftRight=function(e){return r(e)&&(e=e.toInt()),0===(e&=63)?this:e<32?u(this.low>>>e|this.high<<32-e,this.high>>e,this.unsigned):u(this.high>>e-32,this.high>=0?0:-1,this.unsigned)},S.shr=S.shiftRight,S.shiftRightUnsigned=function(e){if(r(e)&&(e=e.toInt()),0===(e&=63))return this;var t=this.high;return e<32?u(this.low>>>e|t<<32-e,t>>>e,this.unsigned):u(32===e?t:t>>>e-32,0,this.unsigned)},S.shru=S.shiftRightUnsigned,S.shr_u=S.shiftRightUnsigned,S.toSigned=function(){return this.unsigned?u(this.low,this.high,!1):this},S.toUnsigned=function(){return this.unsigned?this:u(this.low,this.high,!0)},S.toBytes=function(e){return e?this.toBytesLE():this.toBytesBE()},S.toBytesLE=function(){var e=this.high,t=this.low;return[255&t,t>>>8&255,t>>>16&255,t>>>24,255&e,e>>>8&255,e>>>16&255,e>>>24]},S.toBytesBE=function(){var e=this.high,t=this.low;return[e>>>24,e>>>16&255,e>>>8&255,255&e,t>>>24,t>>>16&255,t>>>8&255,255&t]},n.fromBytes=function(e,t,r){return r?n.fromBytesLE(e,t):n.fromBytesBE(e,t)},n.fromBytesLE=function(e,t){return new n(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24,t)},n.fromBytesBE=function(e,t){return new n(e[4]<<24|e[5]<<16|e[6]<<8|e[7],e[0]<<24|e[1]<<16|e[2]<<8|e[3],t)}},8191:function(e,t,n){t.parseMidi=n(3169),t.writeMidi=n(9695)},3169:function(e){function t(e){for(var t,r=new n(e),a=[];!r.eof();){var i=o();a.push(i)}return a;function o(){var e={};e.deltaTime=r.readVarInt();var n=r.readUInt8();if(240===(240&n)){if(255!==n){if(240==n){e.type="sysEx";i=r.readVarInt();return e.data=r.readBytes(i),e}if(247==n){e.type="endSysEx";i=r.readVarInt();return e.data=r.readBytes(i),e}throw"Unrecognised MIDI event type byte: "+n}e.meta=!0;var a=r.readUInt8(),i=r.readVarInt();switch(a){case 0:if(e.type="sequenceNumber",2!==i)throw"Expected length for sequenceNumber event is 2, got "+i;return e.number=r.readUInt16(),e;case 1:return e.type="text",e.text=r.readString(i),e;case 2:return e.type="copyrightNotice",e.text=r.readString(i),e;case 3:return e.type="trackName",e.text=r.readString(i),e;case 4:return e.type="instrumentName",e.text=r.readString(i),e;case 5:return e.type="lyrics",e.text=r.readString(i),e;case 6:return e.type="marker",e.text=r.readString(i),e;case 7:return e.type="cuePoint",e.text=r.readString(i),e;case 32:if(e.type="channelPrefix",1!=i)throw"Expected length for channelPrefix event is 1, got "+i;return e.channel=r.readUInt8(),e;case 33:if(e.type="portPrefix",1!=i)throw"Expected length for portPrefix event is 1, got "+i;return e.port=r.readUInt8(),e;case 47:if(e.type="endOfTrack",0!=i)throw"Expected length for endOfTrack event is 0, got "+i;return e;case 81:if(e.type="setTempo",3!=i)throw"Expected length for setTempo event is 3, got "+i;return e.microsecondsPerBeat=r.readUInt24(),e;case 84:if(e.type="smpteOffset",5!=i)throw"Expected length for smpteOffset event is 5, got "+i;var o=r.readUInt8();return e.frameRate={0:24,32:25,64:29,96:30}[96&o],e.hour=31&o,e.min=r.readUInt8(),e.sec=r.readUInt8(),e.frame=r.readUInt8(),e.subFrame=r.readUInt8(),e;case 88:if(e.type="timeSignature",2!=i&&4!=i)throw"Expected length for timeSignature event is 4 or 2, got "+i;return e.numerator=r.readUInt8(),e.denominator=1<<r.readUInt8(),4===i?(e.metronome=r.readUInt8(),e.thirtyseconds=r.readUInt8()):(e.metronome=36,e.thirtyseconds=8),e;case 89:if(e.type="keySignature",2!=i)throw"Expected length for keySignature event is 2, got "+i;return e.key=r.readInt8(),e.scale=r.readUInt8(),e;case 127:return e.type="sequencerSpecific",e.data=r.readBytes(i),e;default:return e.type="unknownMeta",e.data=r.readBytes(i),e.metatypeByte=a,e}}else{var s;if(0===(128&n)){if(null===t)throw"Running status byte encountered before status byte";s=n,n=t,e.running=!0}else s=r.readUInt8(),t=n;var u=n>>4;switch(e.channel=15&n,u){case 8:return e.type="noteOff",e.noteNumber=s,e.velocity=r.readUInt8(),e;case 9:var c=r.readUInt8();return e.type=0===c?"noteOff":"noteOn",e.noteNumber=s,e.velocity=c,0===c&&(e.byte9=!0),e;case 10:return e.type="noteAftertouch",e.noteNumber=s,e.amount=r.readUInt8(),e;case 11:return e.type="controller",e.controllerType=s,e.value=r.readUInt8(),e;case 12:return e.type="programChange",e.programNumber=s,e;case 13:return e.type="channelAftertouch",e.amount=s,e;case 14:return e.type="pitchBend",e.value=s+(r.readUInt8()<<7)-8192,e;default:throw"Unrecognised MIDI event type: "+u}}}}function n(e){this.buffer=e,this.bufferLen=this.buffer.length,this.pos=0}n.prototype.eof=function(){return this.pos>=this.bufferLen},n.prototype.readUInt8=function(){var e=this.buffer[this.pos];return this.pos+=1,e},n.prototype.readInt8=function(){var e=this.readUInt8();return 128&e?e-256:e},n.prototype.readUInt16=function(){return(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readInt16=function(){var e=this.readUInt16();return 32768&e?e-65536:e},n.prototype.readUInt24=function(){return(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readInt24=function(){var e=this.readUInt24();return 8388608&e?e-16777216:e},n.prototype.readUInt32=function(){return(this.readUInt8()<<24)+(this.readUInt8()<<16)+(this.readUInt8()<<8)+this.readUInt8()},n.prototype.readBytes=function(e){var t=this.buffer.slice(this.pos,this.pos+e);return this.pos+=e,t},n.prototype.readString=function(e){var t=this.readBytes(e);return String.fromCharCode.apply(null,t)},n.prototype.readVarInt=function(){for(var e=0;!this.eof();){var t=this.readUInt8();if(!(128&t))return e+t;e+=127&t,e<<=7}return e},n.prototype.readChunk=function(){var e=this.readString(4),t=this.readUInt32();return{id:e,length:t,data:this.readBytes(t)}},e.exports=function(e){var r=new n(e),a=r.readChunk();if("MThd"!=a.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+a.id+"'";for(var i=function(e){var t=new n(e),r=t.readUInt16(),a=t.readUInt16(),i={format:r,numTracks:a},o=t.readUInt16();32768&o?(i.framesPerSecond=256-(o>>8),i.ticksPerFrame=255&o):i.ticksPerBeat=o;return i}(a.data),o=[],s=0;!r.eof()&&s<i.numTracks;s++){var u=r.readChunk();if("MTrk"!=u.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+u.id+"'";var c=t(u.data);o.push(c)}return{header:i,tracks:o}}},9695:function(e){function t(e,t,a){var i,o=new r,s=t.length,u=null;for(i=0;i<s;i++)!1!==a.running&&(a.running||t[i].running)||(u=null),u=n(o,t[i],u,a.useByte9ForNoteOff);e.writeChunk("MTrk",o.buffer)}function n(e,t,n,r){var a=t.type,i=t.deltaTime,o=t.text||"",s=t.data||[],u=null;switch(e.writeVarInt(i),a){case"sequenceNumber":e.writeUInt8(255),e.writeUInt8(0),e.writeVarInt(2),e.writeUInt16(t.number);break;case"text":e.writeUInt8(255),e.writeUInt8(1),e.writeVarInt(o.length),e.writeString(o);break;case"copyrightNotice":e.writeUInt8(255),e.writeUInt8(2),e.writeVarInt(o.length),e.writeString(o);break;case"trackName":e.writeUInt8(255),e.writeUInt8(3),e.writeVarInt(o.length),e.writeString(o);break;case"instrumentName":e.writeUInt8(255),e.writeUInt8(4),e.writeVarInt(o.length),e.writeString(o);break;case"lyrics":e.writeUInt8(255),e.writeUInt8(5),e.writeVarInt(o.length),e.writeString(o);break;case"marker":e.writeUInt8(255),e.writeUInt8(6),e.writeVarInt(o.length),e.writeString(o);break;case"cuePoint":e.writeUInt8(255),e.writeUInt8(7),e.writeVarInt(o.length),e.writeString(o);break;case"channelPrefix":e.writeUInt8(255),e.writeUInt8(32),e.writeVarInt(1),e.writeUInt8(t.channel);break;case"portPrefix":e.writeUInt8(255),e.writeUInt8(33),e.writeVarInt(1),e.writeUInt8(t.port);break;case"endOfTrack":e.writeUInt8(255),e.writeUInt8(47),e.writeVarInt(0);break;case"setTempo":e.writeUInt8(255),e.writeUInt8(81),e.writeVarInt(3),e.writeUInt24(t.microsecondsPerBeat);break;case"smpteOffset":e.writeUInt8(255),e.writeUInt8(84),e.writeVarInt(5);var c=31&t.hour|{24:0,25:32,29:64,30:96}[t.frameRate];e.writeUInt8(c),e.writeUInt8(t.min),e.writeUInt8(t.sec),e.writeUInt8(t.frame),e.writeUInt8(t.subFrame);break;case"timeSignature":e.writeUInt8(255),e.writeUInt8(88),e.writeVarInt(4),e.writeUInt8(t.numerator);var l=255&Math.floor(Math.log(t.denominator)/Math.LN2);e.writeUInt8(l),e.writeUInt8(t.metronome),e.writeUInt8(t.thirtyseconds||8);break;case"keySignature":e.writeUInt8(255),e.writeUInt8(89),e.writeVarInt(2),e.writeInt8(t.key),e.writeUInt8(t.scale);break;case"sequencerSpecific":e.writeUInt8(255),e.writeUInt8(127),e.writeVarInt(s.length),e.writeBytes(s);break;case"unknownMeta":null!=t.metatypeByte&&(e.writeUInt8(255),e.writeUInt8(t.metatypeByte),e.writeVarInt(s.length),e.writeBytes(s));break;case"sysEx":e.writeUInt8(240),e.writeVarInt(s.length),e.writeBytes(s);break;case"endSysEx":e.writeUInt8(247),e.writeVarInt(s.length),e.writeBytes(s);break;case"noteOff":(u=(!1!==r&&t.byte9||r&&0==t.velocity?144:128)|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteOn":(u=144|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.velocity);break;case"noteAftertouch":(u=160|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.noteNumber),e.writeUInt8(t.amount);break;case"controller":(u=176|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.controllerType),e.writeUInt8(t.value);break;case"programChange":(u=192|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.programNumber);break;case"channelAftertouch":(u=208|t.channel)!==n&&e.writeUInt8(u),e.writeUInt8(t.amount);break;case"pitchBend":(u=224|t.channel)!==n&&e.writeUInt8(u);var h=8192+t.value,f=127&h,d=h>>7&127;e.writeUInt8(f),e.writeUInt8(d);break;default:throw"Unrecognized event type: "+a}return u}function r(){this.buffer=[]}r.prototype.writeUInt8=function(e){this.buffer.push(255&e)},r.prototype.writeInt8=r.prototype.writeUInt8,r.prototype.writeUInt16=function(e){var t=e>>8&255,n=255&e;this.writeUInt8(t),this.writeUInt8(n)},r.prototype.writeInt16=r.prototype.writeUInt16,r.prototype.writeUInt24=function(e){var t=e>>16&255,n=e>>8&255,r=255&e;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r)},r.prototype.writeInt24=r.prototype.writeUInt24,r.prototype.writeUInt32=function(e){var t=e>>24&255,n=e>>16&255,r=e>>8&255,a=255&e;this.writeUInt8(t),this.writeUInt8(n),this.writeUInt8(r),this.writeUInt8(a)},r.prototype.writeInt32=r.prototype.writeUInt32,r.prototype.writeBytes=function(e){this.buffer=this.buffer.concat(Array.prototype.slice.call(e,0))},r.prototype.writeString=function(e){var t,n=e.length,r=[];for(t=0;t<n;t++)r.push(e.codePointAt(t));this.writeBytes(r)},r.prototype.writeVarInt=function(e){if(e<0)throw"Cannot write negative variable-length integer";if(e<=127)this.writeUInt8(e);else{var t=e,n=[];for(n.push(127&t),t>>=7;t;){var r=127&t|128;n.push(r),t>>=7}this.writeBytes(n.reverse())}},r.prototype.writeChunk=function(e,t){this.writeString(e),this.writeUInt32(t.length),this.writeBytes(t)},e.exports=function(e,n){if("object"!==typeof e)throw"Invalid MIDI data";n=n||{};var a,i=e.header||{},o=e.tracks||[],s=o.length,u=new r;for(function(e,t,n){var a=null==t.format?1:t.format,i=128;t.timeDivision?i=t.timeDivision:t.ticksPerFrame&&t.framesPerSecond?i=-(255&t.framesPerSecond)<<8|255&t.ticksPerFrame:t.ticksPerBeat&&(i=32767&t.ticksPerBeat);var o=new r;o.writeUInt16(a),o.writeUInt16(n),o.writeUInt16(i),e.writeChunk("MThd",o.buffer)}(u,i,s),a=0;a<s;a++)t(u,o[a],n);return u.buffer}},2446:function(e,t,n){"use strict";var r=n(6519),a=n(8383),i=n(4008),o=n(4068);e.exports=function(e,t,n){var s,u,c=t.shape,l=c.length,h=1,f=new Array(l),d=0;for(s=l-1;s>=0;--s)if(f[s]=h,h*=c[s],d=Math.max(d,o.scratchMemory(c[s])),t.shape[s]!==n.shape[s])throw new Error("Shape mismatch, real and imaginary arrays must have same size");var p,v=4*h+d;p="array"===t.dtype||"float64"===t.dtype||"custom"===t.dtype?i.mallocDouble(v):i.mallocFloat(v);var m,g,y,b,x=a(p,c.slice(0),f,0),k=a(p,c.slice(0),f.slice(0),h),w=a(p,c.slice(0),f.slice(0),2*h),_=a(p,c.slice(0),f.slice(0),3*h),S=4*h;for(r.assign(x,t),r.assign(k,n),s=l-1;s>=0&&(o(e,h/c[s],c[s],p,x.offset,k.offset,S),0!==s);--s){for(g=1,y=w.stride,b=_.stride,u=s-1;u<l;++u)b[u]=y[u]=g,g*=c[u];for(u=s-2;u>=0;--u)b[u]=y[u]=g,g*=c[u];r.assign(w,x),r.assign(_,k),m=x,x=w,w=m,m=k,k=_,_=m}r.assign(t,x),r.assign(n,k),i.free(p)}},4068:function(e,t,n){var r=n(5844);function a(e,t,n,a,i,o){var s,u,c,l,h,f,d,p,v,m,g,y,b,x,k,w,_,S,C,T,E,I,A,M;for(e|=0,t|=0,i|=0,o|=0,s=n|=0,u=r.log2(s),S=0;S<t;++S){for(d=s>>1,h=0,c=0;c<s-1;c++){for(c<h&&(b=a[i+c],a[i+c]=a[i+h],a[i+h]=b,b=a[o+c],a[o+c]=a[o+h],a[o+h]=b),f=d;f<=h;)h-=f,f>>=1;h+=f}for(g=-1,y=0,m=1,p=0;p<u;p++){for(v=m,m<<=1,w=1,_=0,h=0;h<v;h++){for(c=h;c<s;c+=m)C=a[i+(l=c+v)],T=a[o+l],E=a[i+c],I=a[o+c],x=(A=w*(C+T))-T*(w+_),k=A+(M=C*(_-w)),a[i+l]=E-x,a[o+l]=I-k,a[i+c]+=x,a[o+c]+=k;M=w*(y-g),w=(A=g*(w+_))-_*(g+y),_=A+M}y=Math.sqrt((1-g)/2),e<0&&(y=-y),g=Math.sqrt((1+g)/2)}if(e<0){var N=1/s;for(c=0;c<s;c++)a[i+c]*=N,a[o+c]*=N}i+=n,o+=n}}e.exports=function(e,t,n,i,o,s,u){e|=0,t|=0,n|=0,o|=0,s|=0,r.isPow2(n)?a(e,t,n,i,o,s):function(e,t,n,i,o,s,u){e|=0,t|=0,n|=0,o|=0,s|=0,u|=0;var c,l,h,f,d,p,v,m,g,y=r.nextPow2(2*n+1),b=u,x=b+n,k=x+n,w=k+y,_=w+y,S=_+y,C=-e*Math.PI/n;for(g=0;g<n;++g)l=C*(g*g%(2*n)),f=Math.cos(l),d=Math.sin(l),i[_+(y-g)]=i[_+g]=i[b+g]=f,i[S+(y-g)]=i[S+g]=i[x+g]=d;for(g=n;g<=y-n;++g)i[_+g]=0;for(g=n;g<=y-n;++g)i[S+g]=0;a(1,1,y,i,_,S),C=e<0?1/n:1;for(c=0;c<t;++c){for(g=0;g<n;++g)l=i[o+g],h=i[s+g],p=(f=i[b+g])*(l+h),v=l*((d=-i[x+g])-f),m=h*(f+d),i[k+g]=p-m,i[w+g]=p+v;for(g=n;g<y;++g)i[k+g]=0;for(g=n;g<y;++g)i[w+g]=0;for(a(1,1,y,i,k,w),g=0;g<y;++g)l=i[k+g],h=i[w+g],p=(f=i[_+g])*(l+h),v=l*((d=i[S+g])-f),m=h*(f+d),i[k+g]=p-m,i[w+g]=p+v;for(a(-1,1,y,i,k,w),g=0;g<n;++g)l=i[k+g],h=i[w+g],p=(f=i[b+g])*(l+h),v=l*((d=-i[x+g])-f),m=h*(f+d),i[o+g]=C*(p-m),i[s+g]=C*(p+v);o+=n,s+=n}}(e,t,n,i,o,s,u)},e.exports.scratchMemory=function(e){return r.isPow2(e)?0:2*e+4*r.nextPow2(2*e+1)}},6519:function(e,t,n){"use strict";var r=n(7549),a={body:"",args:[],thisVars:[],localVars:[]};function i(e){if(!e)return a;for(var t=0;t<e.args.length;++t){var n=e.args[t];e.args[t]=0===t?{name:n,lvalue:!0,rvalue:!!e.rvalue,count:e.count||1}:{name:n,lvalue:!1,rvalue:!0,count:1}}return e.thisVars||(e.thisVars=[]),e.localVars||(e.localVars=[]),e}function o(e){for(var t=[],n=0;n<e.args.length;++n)t.push("a"+n);return new Function("P",["return function ",e.funcName,"_ndarrayops(",t.join(","),") {P(",t.join(","),");return a0}"].join(""))(function(e){return r({args:e.args,pre:i(e.pre),body:i(e.body),post:i(e.proc),funcName:e.funcName})}(e))}var s={add:"+",sub:"-",mul:"*",div:"/",mod:"%",band:"&",bor:"|",bxor:"^",lshift:"<<",rshift:">>",rrshift:">>>"};!function(){for(var e in s){var n=s[e];t[e]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:e}),t[e+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a"+n+"=b"},rvalue:!0,funcName:e+"eq"}),t[e+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:e+"s"}),t[e+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a"+n+"=s"},rvalue:!0,funcName:e+"seq"})}}();var u={not:"!",bnot:"~",neg:"-",recip:"1.0/"};!function(){for(var e in u){var n=u[e];t[e]=o({args:["array","array"],body:{args:["a","b"],body:"a="+n+"b"},funcName:e}),t[e+"eq"]=o({args:["array"],body:{args:["a"],body:"a="+n+"a"},rvalue:!0,count:2,funcName:e+"eq"})}}();var c={and:"&&",or:"||",eq:"===",neq:"!==",lt:"<",gt:">",leq:"<=",geq:">="};!function(){for(var e in c){var n=c[e];t[e]=o({args:["array","array","array"],body:{args:["a","b","c"],body:"a=b"+n+"c"},funcName:e}),t[e+"s"]=o({args:["array","array","scalar"],body:{args:["a","b","s"],body:"a=b"+n+"s"},funcName:e+"s"}),t[e+"eq"]=o({args:["array","array"],body:{args:["a","b"],body:"a=a"+n+"b"},rvalue:!0,count:2,funcName:e+"eq"}),t[e+"seq"]=o({args:["array","scalar"],body:{args:["a","s"],body:"a=a"+n+"s"},rvalue:!0,count:2,funcName:e+"seq"})}}();var l=["abs","acos","asin","atan","ceil","cos","exp","floor","log","round","sin","sqrt","tan"];!function(){for(var e=0;e<l.length;++e){var n=l[e];t[n]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b)",thisVars:["this_f"]},funcName:n}),t[n+"eq"]=o({args:["array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a"],body:"a=this_f(a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"})}}();var h=["max","min","atan2","pow"];!function(){for(var e=0;e<h.length;++e){var n=h[e];t[n]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n}),t[n+"s"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(b,c)",thisVars:["this_f"]},funcName:n+"s"}),t[n+"eq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"eq"}),t[n+"seq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(a,b)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"seq"})}}();var f=["atan2","pow"];!function(){for(var e=0;e<f.length;++e){var n=f[e];t[n+"op"]=o({args:["array","array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"op"}),t[n+"ops"]=o({args:["array","array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b","c"],body:"a=this_f(c,b)",thisVars:["this_f"]},funcName:n+"ops"}),t[n+"opeq"]=o({args:["array","array"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opeq"}),t[n+"opseq"]=o({args:["array","scalar"],pre:{args:[],body:"this_f=Math."+n,thisVars:["this_f"]},body:{args:["a","b"],body:"a=this_f(b,a)",thisVars:["this_f"]},rvalue:!0,count:2,funcName:n+"opseq"})}}(),t.any=r({args:["array"],pre:a,body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"if(a){return true}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return false"},funcName:"any"}),t.all=r({args:["array"],pre:a,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1}],body:"if(!x){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"all"}),t.sum=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s+=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"sum"}),t.prod=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=1"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:1}],body:"this_s*=a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"prod"}),t.norm2squared=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm2squared"}),t.norm2=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:2}],body:"this_s+=a*a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return Math.sqrt(this_s)"},funcName:"norm2"}),t.norminf=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:4}],body:"if(-a>this_s){this_s=-a}else if(a>this_s){this_s=a}",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norminf"}),t.norm1=r({args:["array"],pre:{args:[],localVars:[],thisVars:["this_s"],body:"this_s=0"},body:{args:[{name:"a",lvalue:!1,rvalue:!0,count:3}],body:"this_s+=a<0?-a:a",localVars:[],thisVars:["this_s"]},post:{args:[],localVars:[],thisVars:["this_s"],body:"return this_s"},funcName:"norm1"}),t.sup=r({args:["array"],pre:{body:"this_h=-Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_>this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.inf=r({args:["array"],pre:{body:"this_h=Infinity",args:[],thisVars:["this_h"],localVars:[]},body:{body:"if(_inline_1_arg0_<this_h)this_h=_inline_1_arg0_",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_h"],localVars:[]},post:{body:"return this_h",args:[],thisVars:["this_h"],localVars:[]}}),t.argmin=r({args:["index","array","shape"],pre:{body:"{this_v=Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_<this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.argmax=r({args:["index","array","shape"],pre:{body:"{this_v=-Infinity;this_i=_inline_0_arg2_.slice(0)}",args:[{name:"_inline_0_arg0_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg1_",lvalue:!1,rvalue:!1,count:0},{name:"_inline_0_arg2_",lvalue:!1,rvalue:!0,count:1}],thisVars:["this_i","this_v"],localVars:[]},body:{body:"{if(_inline_1_arg1_>this_v){this_v=_inline_1_arg1_;for(var _inline_1_k=0;_inline_1_k<_inline_1_arg0_.length;++_inline_1_k){this_i[_inline_1_k]=_inline_1_arg0_[_inline_1_k]}}}",args:[{name:"_inline_1_arg0_",lvalue:!1,rvalue:!0,count:2},{name:"_inline_1_arg1_",lvalue:!1,rvalue:!0,count:2}],thisVars:["this_i","this_v"],localVars:["_inline_1_k"]},post:{body:"{return this_i}",args:[],thisVars:["this_i"],localVars:[]}}),t.random=o({args:["array"],pre:{args:[],body:"this_f=Math.random",thisVars:["this_f"]},body:{args:["a"],body:"a=this_f()",thisVars:["this_f"]},funcName:"random"}),t.assign=o({args:["array","array"],body:{args:["a","b"],body:"a=b"},funcName:"assign"}),t.assigns=o({args:["array","scalar"],body:{args:["a","b"],body:"a=b"},funcName:"assigns"}),t.equals=r({args:["array","array"],pre:a,body:{args:[{name:"x",lvalue:!1,rvalue:!0,count:1},{name:"y",lvalue:!1,rvalue:!0,count:1}],body:"if(x!==y){return false}",localVars:[],thisVars:[]},post:{args:[],localVars:[],thisVars:[],body:"return true"},funcName:"equals"})},6800:function(e,t,n){"use strict";var r=n(2446),a=n(7217),i=n(6519),o=n(3675)({args:["array","array","scalar","scalar","scalar"],body:function(e,t,n,r,a){var i=t*n;i<r&&(i=r),i>a&&(i=a)}});e.exports=function(e,t,n,s){"undefined"===typeof n&&(n=-1/0),"undefined"===typeof s&&(s=1/0);var u=t.shape,c=e.shape;if(t.shape.length!==e.shape.length)throw new Error("ndarray-resample: input and output arrays should have the same dimensions");var l,h=u.map((function(){return 0}));if(1===e.size)return(l=i.sum(t)/t.size)<n&&(l=n),l>s&&(l=s),void e.set.apply(e,h.concat(l));if(1===t.size)return(l=t.get.apply(t,h))<n&&(l=n),l>s&&(l=s),void i.assigns(e,l);for(var f=u.length,d=new Array(f),p=!1,v=0;v<f;v++)d[v]=Math.min(c[v],u[v]),c[v]>u[v]&&(p=!0);var m=a.malloc(u),g=a.malloc(u);i.assign(m,t),i.assigns(g,0),r(1,m,g);var y=m.lo,b=m.hi,x=a.malloc(c),k=a.malloc(c);p&&(i.assigns(x,0),i.assigns(k,0));var w=new Array(f),_=new Array(f),S=new Array(f),C=new Array(f);for(v=0;v<1<<f;++v){for(var T=0;T<f;++T)if(v&1<<T){if(w[T]=d[T]-(d[T]+1>>>1),0===w[T])continue;_[T]=c[T]-w[T],S[T]=u[T]-w[T],C[T]=1&d[T]?0:1}else w[T]=d[T]+1>>>1,_[T]=0,S[T]=0,C[T]=0;i.assign(b.apply(y.apply(x,_),w),b.apply(y.apply(m,S),w)),i.assign(y.apply(b.apply(y.apply(k,_),w),C),y.apply(b.apply(y.apply(g,S),w),C)),i.assigns(b.apply(b.apply(y.apply(k,_),w),C),0)}r(-1,x,k),o(e,x,e.size/t.size,n,s),a.free(m),a.free(g),a.free(x),a.free(k)}},7217:function(e,t,n){"use strict";var r=n(8383),a=n(6519),i=n(4008);t.clone=function(e){var t=e.dtype;"generic"!==t&&"array"!==t||(t="double");var n=i.malloc(e.size,t),o=r(n,e.shape);return a.assign(o,e),o},t.malloc=function(e,t){t||(t="double");for(var n=1,a=new Array(e.length),o=e.length-1;o>=0;--o)a[o]=n,n*=e[o];return r(i.malloc(n,t),e,a,0)},t.free=function(e){"generic"!==e.dtype&&"array"!==e.dtype&&i.free(e.data)},t.zeros=function(e,t){t||(t="double");for(var n=1,a=new Array(e.length),o=e.length-1;o>=0;--o)a[o]=n,n*=e[o];var s=i.malloc(n,t);for(o=0;o<n;++o)s[o]=0;return r(s,e,a,0)},t.ones=function(e,t){t||(t="double");for(var n=1,a=new Array(e.length),o=e.length-1;o>=0;--o)a[o]=n,n*=e[o];var s=i.malloc(n,t);for(o=0;o<n;++o)s[o]=1;return r(s,e,a,0)},t.eye=function(e,t){var n,a;t||(t="double");var o=1,s=new Array(e.length);for(n=e.length-1;n>=0;--n)s[n]=o,o*=e[n];var u=i.malloc(o,t);for(n=0;n<o;++n)u[n]=0;var c=1/0,l=0;for(n=e.length-1;n>=0;n--)l+=s[n],c=Math.min(c,e[n]);for(n=0,a=0;n<c;n++,a+=l)u[a]=1;return r(u,e,s,0)}},8383:function(e,t,n){var r=n(9897),a=n(5586),i="undefined"!==typeof Float64Array;function o(e,t){return e[0]-t[0]}function s(){var e,t=this.stride,n=new Array(t.length);for(e=0;e<n.length;++e)n[e]=[Math.abs(t[e]),e];n.sort(o);var r=new Array(n.length);for(e=0;e<r.length;++e)r[e]=n[e][1];return r}function u(e,t){var n=["View",t,"d",e].join("");t<0&&(n="View_Nil"+e);var a="generic"===e;if(-1===t){var i="function "+n+"(a){this.data=a;};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return -1};proto.size=0;proto.dimension=-1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function(){return new "+n+"(this.data);};proto.get=proto.set=function(){};proto.pick=function(){return null};return function construct_"+n+"(a){return new "+n+"(a);}";return new Function(i)()}if(0===t){i="function "+n+"(a,d) {this.data = a;this.offset = d};var proto="+n+".prototype;proto.dtype='"+e+"';proto.index=function(){return this.offset};proto.dimension=0;proto.size=1;proto.shape=proto.stride=proto.order=[];proto.lo=proto.hi=proto.transpose=proto.step=function "+n+"_copy() {return new "+n+"(this.data,this.offset)};proto.pick=function "+n+"_pick(){return TrivialArray(this.data);};proto.valueOf=proto.get=function "+n+"_get(){return "+(a?"this.data.get(this.offset)":"this.data[this.offset]")+"};proto.set=function "+n+"_set(v){return "+(a?"this.data.set(this.offset,v)":"this.data[this.offset]=v")+"};return function construct_"+n+"(a,b,c,d){return new "+n+"(a,d)}";return new Function("TrivialArray",i)(c[e][0])}i=["'use strict'"];var o=r(t),u=o.map((function(e){return"i"+e})),l="this.offset+"+o.map((function(e){return"this.stride["+e+"]*i"+e})).join("+"),h=o.map((function(e){return"b"+e})).join(","),f=o.map((function(e){return"c"+e})).join(",");i.push("function "+n+"(a,"+h+","+f+",d){this.data=a","this.shape=["+h+"]","this.stride=["+f+"]","this.offset=d|0}","var proto="+n+".prototype","proto.dtype='"+e+"'","proto.dimension="+t),i.push("Object.defineProperty(proto,'size',{get:function "+n+"_size(){return "+o.map((function(e){return"this.shape["+e+"]"})).join("*"),"}})"),1===t?i.push("proto.order=[0]"):(i.push("Object.defineProperty(proto,'order',{get:"),t<4?(i.push("function "+n+"_order(){"),2===t?i.push("return (Math.abs(this.stride[0])>Math.abs(this.stride[1]))?[1,0]:[0,1]}})"):3===t&&i.push("var s0=Math.abs(this.stride[0]),s1=Math.abs(this.stride[1]),s2=Math.abs(this.stride[2]);if(s0>s1){if(s1>s2){return [2,1,0];}else if(s0>s2){return [1,2,0];}else{return [1,0,2];}}else if(s0>s2){return [2,0,1];}else if(s2>s1){return [0,1,2];}else{return [0,2,1];}}})")):i.push("ORDER})")),i.push("proto.set=function "+n+"_set("+u.join(",")+",v){"),a?i.push("return this.data.set("+l+",v)}"):i.push("return this.data["+l+"]=v}"),i.push("proto.get=function "+n+"_get("+u.join(",")+"){"),a?i.push("return this.data.get("+l+")}"):i.push("return this.data["+l+"]}"),i.push("proto.index=function "+n+"_index(",u.join(),"){return "+l+"}"),i.push("proto.hi=function "+n+"_hi("+u.join(",")+"){return new "+n+"(this.data,"+o.map((function(e){return["(typeof i",e,"!=='number'||i",e,"<0)?this.shape[",e,"]:i",e,"|0"].join("")})).join(",")+","+o.map((function(e){return"this.stride["+e+"]"})).join(",")+",this.offset)}");var d=o.map((function(e){return"a"+e+"=this.shape["+e+"]"})),p=o.map((function(e){return"c"+e+"=this.stride["+e+"]"}));i.push("proto.lo=function "+n+"_lo("+u.join(",")+"){var b=this.offset,d=0,"+d.join(",")+","+p.join(","));for(var v=0;v<t;++v)i.push("if(typeof i"+v+"==='number'&&i"+v+">=0){d=i"+v+"|0;b+=c"+v+"*d;a"+v+"-=d}");i.push("return new "+n+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"c"+e})).join(",")+",b)}"),i.push("proto.step=function "+n+"_step("+u.join(",")+"){var "+o.map((function(e){return"a"+e+"=this.shape["+e+"]"})).join(",")+","+o.map((function(e){return"b"+e+"=this.stride["+e+"]"})).join(",")+",c=this.offset,d=0,ceil=Math.ceil");for(v=0;v<t;++v)i.push("if(typeof i"+v+"==='number'){d=i"+v+"|0;if(d<0){c+=b"+v+"*(a"+v+"-1);a"+v+"=ceil(-a"+v+"/d)}else{a"+v+"=ceil(a"+v+"/d)}b"+v+"*=d}");i.push("return new "+n+"(this.data,"+o.map((function(e){return"a"+e})).join(",")+","+o.map((function(e){return"b"+e})).join(",")+",c)}");var m=new Array(t),g=new Array(t);for(v=0;v<t;++v)m[v]="a[i"+v+"]",g[v]="b[i"+v+"]";i.push("proto.transpose=function "+n+"_transpose("+u+"){"+u.map((function(e,t){return e+"=("+e+"===undefined?"+t+":"+e+"|0)"})).join(";"),"var a=this.shape,b=this.stride;return new "+n+"(this.data,"+m.join(",")+","+g.join(",")+",this.offset)}"),i.push("proto.pick=function "+n+"_pick("+u+"){var a=[],b=[],c=this.offset");for(v=0;v<t;++v)i.push("if(typeof i"+v+"==='number'&&i"+v+">=0){c=(c+this.stride["+v+"]*i"+v+")|0}else{a.push(this.shape["+v+"]);b.push(this.stride["+v+"])}");return i.push("var ctor=CTOR_LIST[a.length+1];return ctor(this.data,a,b,c)}"),i.push("return function construct_"+n+"(data,shape,stride,offset){return new "+n+"(data,"+o.map((function(e){return"shape["+e+"]"})).join(",")+","+o.map((function(e){return"stride["+e+"]"})).join(",")+",offset)}"),new Function("CTOR_LIST","ORDER",i.join("\n"))(c[e],s)}var c={float32:[],float64:[],int8:[],int16:[],int32:[],uint8:[],uint16:[],uint32:[],array:[],uint8_clamped:[],bigint64:[],biguint64:[],buffer:[],generic:[]};e.exports=function(e,t,n,r){if(void 0===e)return(0,c.array[0])([]);"number"===typeof e&&(e=[e]),void 0===t&&(t=[e.length]);var o=t.length;if(void 0===n){n=new Array(o);for(var s=o-1,l=1;s>=0;--s)n[s]=l,l*=t[s]}if(void 0===r){r=0;for(s=0;s<o;++s)n[s]<0&&(r-=(t[s]-1)*n[s])}for(var h=function(e){if(a(e))return"buffer";if(i)switch(Object.prototype.toString.call(e)){case"[object Float64Array]":return"float64";case"[object Float32Array]":return"float32";case"[object Int8Array]":return"int8";case"[object Int16Array]":return"int16";case"[object Int32Array]":return"int32";case"[object Uint8Array]":return"uint8";case"[object Uint16Array]":return"uint16";case"[object Uint32Array]":return"uint32";case"[object Uint8ClampedArray]":return"uint8_clamped";case"[object BigInt64Array]":return"bigint64";case"[object BigUint64Array]":return"biguint64"}return Array.isArray(e)?"array":"generic"}(e),f=c[h];f.length<=o+1;)f.push(u(h,f.length-1));return(0,f[o+1])(e,t,n,r)}},5359:function(e,t){"use strict";var n=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n)return n;throw new Error("unable to locate global object")}();e.exports=t=n.fetch,n.fetch&&(t.default=n.fetch.bind(n)),t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response},886:function(e,t,n){"use strict";e.exports=n(4722)},4722:function(e,t,n){"use strict";var r=t;function a(){r.util._configure(),r.Writer._configure(r.BufferWriter),r.Reader._configure(r.BufferReader)}r.build="minimal",r.Writer=n(7063),r.BufferWriter=n(2815),r.Reader=n(6216),r.BufferReader=n(3557),r.util=n(3097),r.rpc=n(9994),r.roots=n(7907),r.configure=a,a()},6216:function(e,t,n){"use strict";e.exports=u;var r,a=n(3097),i=a.LongBits,o=a.utf8;function s(e,t){return RangeError("index out of range: "+e.pos+" + "+(t||1)+" > "+e.len)}function u(e){this.buf=e,this.pos=0,this.len=e.length}var c="undefined"!==typeof Uint8Array?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new u(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new u(e);throw Error("illegal buffer")},l=function(){return a.Buffer?function(e){return(u.create=function(e){return a.Buffer.isBuffer(e)?new r(e):c(e)})(e)}:c};function h(){var e=new i(0,0),t=0;if(!(this.len-this.pos>4)){for(;t<3;++t){if(this.pos>=this.len)throw s(this);if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(127&this.buf[this.pos++])<<7*t)>>>0,e}for(;t<4;++t)if(e.lo=(e.lo|(127&this.buf[this.pos])<<7*t)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(127&this.buf[this.pos])<<28)>>>0,e.hi=(e.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return e;if(t=0,this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw s(this);if(e.hi=(e.hi|(127&this.buf[this.pos])<<7*t+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}function f(e,t){return(e[t-4]|e[t-3]<<8|e[t-2]<<16|e[t-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw s(this,8);return new i(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))}u.create=l(),u.prototype._slice=a.Array.prototype.subarray||a.Array.prototype.slice,u.prototype.uint32=function(){var e=4294967295;return function(){if(e=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return e;if(e=(e|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return e;if((this.pos+=5)>this.len)throw this.pos=this.len,s(this,10);return e}}(),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(1&e)|0},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw s(this,4);return f(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw s(this,4);return 0|f(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw s(this,4);var e=a.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e},u.prototype.double=function(){if(this.pos+8>this.len)throw s(this,4);var e=a.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e},u.prototype.bytes=function(){var e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw s(this,e);return this.pos+=e,Array.isArray(this.buf)?this.buf.slice(t,n):t===n?new this.buf.constructor(0):this._slice.call(this.buf,t,n)},u.prototype.string=function(){var e=this.bytes();return o.read(e,0,e.length)},u.prototype.skip=function(e){if("number"===typeof e){if(this.pos+e>this.len)throw s(this,e);this.pos+=e}else do{if(this.pos>=this.len)throw s(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;4!==(e=7&this.uint32());)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+e+" at offset "+this.pos)}return this},u._configure=function(e){r=e,u.create=l(),r._configure();var t=a.Long?"toLong":"toNumber";a.merge(u.prototype,{int64:function(){return h.call(this)[t](!1)},uint64:function(){return h.call(this)[t](!0)},sint64:function(){return h.call(this).zzDecode()[t](!1)},fixed64:function(){return d.call(this)[t](!0)},sfixed64:function(){return d.call(this)[t](!1)}})}},3557:function(e,t,n){"use strict";e.exports=i;var r=n(6216);(i.prototype=Object.create(r.prototype)).constructor=i;var a=n(3097);function i(e){r.call(this,e)}i._configure=function(){a.Buffer&&(i.prototype._slice=a.Buffer.prototype.slice)},i.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))},i._configure()},7907:function(e){"use strict";e.exports={}},9994:function(e,t,n){"use strict";t.Service=n(4281)},4281:function(e,t,n){"use strict";e.exports=a;var r=n(3097);function a(e,t,n){if("function"!==typeof e)throw TypeError("rpcImpl must be a function");r.EventEmitter.call(this),this.rpcImpl=e,this.requestDelimited=Boolean(t),this.responseDelimited=Boolean(n)}(a.prototype=Object.create(r.EventEmitter.prototype)).constructor=a,a.prototype.rpcCall=function e(t,n,a,i,o){if(!i)throw TypeError("request must be specified");var s=this;if(!o)return r.asPromise(e,s,t,n,a,i);if(s.rpcImpl)try{return s.rpcImpl(t,n[s.requestDelimited?"encodeDelimited":"encode"](i).finish(),(function(e,n){if(e)return s.emit("error",e,t),o(e);if(null!==n){if(!(n instanceof a))try{n=a[s.responseDelimited?"decodeDelimited":"decode"](n)}catch(e){return s.emit("error",e,t),o(e)}return s.emit("data",n,t),o(null,n)}s.end(!0)}))}catch(u){return s.emit("error",u,t),void setTimeout((function(){o(u)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},a.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},9351:function(e,t,n){"use strict";e.exports=a;var r=n(3097);function a(e,t){this.lo=e>>>0,this.hi=t>>>0}var i=a.zero=new a(0,0);i.toNumber=function(){return 0},i.zzEncode=i.zzDecode=function(){return this},i.length=function(){return 1};var o=a.zeroHash="\0\0\0\0\0\0\0\0";a.fromNumber=function(e){if(0===e)return i;var t=e<0;t&&(e=-e);var n=e>>>0,r=(e-n)/4294967296>>>0;return t&&(r=~r>>>0,n=~n>>>0,++n>4294967295&&(n=0,++r>4294967295&&(r=0))),new a(n,r)},a.from=function(e){if("number"===typeof e)return a.fromNumber(e);if(r.isString(e)){if(!r.Long)return a.fromNumber(parseInt(e,10));e=r.Long.fromString(e)}return e.low||e.high?new a(e.low>>>0,e.high>>>0):i},a.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=1+~this.lo>>>0,n=~this.hi>>>0;return t||(n=n+1>>>0),-(t+4294967296*n)}return this.lo+4294967296*this.hi},a.prototype.toLong=function(e){return r.Long?new r.Long(0|this.lo,0|this.hi,Boolean(e)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(e)}};var s=String.prototype.charCodeAt;a.fromHash=function(e){return e===o?i:new a((s.call(e,0)|s.call(e,1)<<8|s.call(e,2)<<16|s.call(e,3)<<24)>>>0,(s.call(e,4)|s.call(e,5)<<8|s.call(e,6)<<16|s.call(e,7)<<24)>>>0)},a.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},a.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this},a.prototype.zzDecode=function(){var e=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this},a.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===t?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}},3097:function(e,t,n){"use strict";var r=t;function a(e,t,n){for(var r=Object.keys(t),a=0;a<r.length;++a)void 0!==e[r[a]]&&n||(e[r[a]]=t[r[a]]);return e}function i(e){function t(e,n){if(!(this instanceof t))return new t(e,n);Object.defineProperty(this,"message",{get:function(){return e}}),Error.captureStackTrace?Error.captureStackTrace(this,t):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&a(this,n)}return(t.prototype=Object.create(Error.prototype)).constructor=t,Object.defineProperty(t.prototype,"name",{get:function(){return e}}),t.prototype.toString=function(){return this.name+": "+this.message},t}r.asPromise=n(7206),r.base64=n(1),r.EventEmitter=n(7111),r.float=n(802),r.inquire=n(7172),r.utf8=n(3861),r.pool=n(8236),r.LongBits=n(9351),r.isNode=Boolean("undefined"!==typeof n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),r.global=r.isNode&&n.g||"undefined"!==typeof window&&window||"undefined"!==typeof self&&self||this,r.emptyArray=Object.freeze?Object.freeze([]):[],r.emptyObject=Object.freeze?Object.freeze({}):{},r.isInteger=Number.isInteger||function(e){return"number"===typeof e&&isFinite(e)&&Math.floor(e)===e},r.isString=function(e){return"string"===typeof e||e instanceof String},r.isObject=function(e){return e&&"object"===typeof e},r.isset=r.isSet=function(e,t){var n=e[t];return!(null==n||!e.hasOwnProperty(t))&&("object"!==typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},r.Buffer=function(){try{var e=r.inquire("buffer").Buffer;return e.prototype.utf8Write?e:null}catch(t){return null}}(),r._Buffer_from=null,r._Buffer_allocUnsafe=null,r.newBuffer=function(e){return"number"===typeof e?r.Buffer?r._Buffer_allocUnsafe(e):new r.Array(e):r.Buffer?r._Buffer_from(e):"undefined"===typeof Uint8Array?e:new Uint8Array(e)},r.Array="undefined"!==typeof Uint8Array?Uint8Array:Array,r.Long=r.global.dcodeIO&&r.global.dcodeIO.Long||r.global.Long||r.inquire("long"),r.key2Re=/^true|false|0|1$/,r.key32Re=/^-?(?:0|[1-9][0-9]*)$/,r.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,r.longToHash=function(e){return e?r.LongBits.from(e).toHash():r.LongBits.zeroHash},r.longFromHash=function(e,t){var n=r.LongBits.fromHash(e);return r.Long?r.Long.fromBits(n.lo,n.hi,t):n.toNumber(Boolean(t))},r.merge=a,r.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)},r.newError=i,r.ProtocolError=i("ProtocolError"),r.oneOfGetter=function(e){for(var t={},n=0;n<e.length;++n)t[e[n]]=1;return function(){for(var e=Object.keys(this),n=e.length-1;n>-1;--n)if(1===t[e[n]]&&void 0!==this[e[n]]&&null!==this[e[n]])return e[n]}},r.oneOfSetter=function(e){return function(t){for(var n=0;n<e.length;++n)e[n]!==t&&delete this[e[n]]}},r.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},r._configure=function(){var e=r.Buffer;e?(r._Buffer_from=e.from!==Uint8Array.from&&e.from||function(t,n){return new e(t,n)},r._Buffer_allocUnsafe=e.allocUnsafe||function(t){return new e(t)}):r._Buffer_from=r._Buffer_allocUnsafe=null}},7063:function(e,t,n){"use strict";e.exports=h;var r,a=n(3097),i=a.LongBits,o=a.base64,s=a.utf8;function u(e,t,n){this.fn=e,this.len=t,this.next=void 0,this.val=n}function c(){}function l(e){this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}function h(){this.len=0,this.head=new u(c,0,0),this.tail=this.head,this.states=null}var f=function(){return a.Buffer?function(){return(h.create=function(){return new r})()}:function(){return new h}};function d(e,t,n){t[n]=255&e}function p(e,t){this.len=e,this.next=void 0,this.val=t}function v(e,t,n){for(;e.hi;)t[n++]=127&e.lo|128,e.lo=(e.lo>>>7|e.hi<<25)>>>0,e.hi>>>=7;for(;e.lo>127;)t[n++]=127&e.lo|128,e.lo=e.lo>>>7;t[n++]=e.lo}function m(e,t,n){t[n]=255&e,t[n+1]=e>>>8&255,t[n+2]=e>>>16&255,t[n+3]=e>>>24}h.create=f(),h.alloc=function(e){return new a.Array(e)},a.Array!==Array&&(h.alloc=a.pool(h.alloc,a.Array.prototype.subarray)),h.prototype._push=function(e,t,n){return this.tail=this.tail.next=new u(e,t,n),this.len+=t,this},p.prototype=Object.create(u.prototype),p.prototype.fn=function(e,t,n){for(;e>127;)t[n++]=127&e|128,e>>>=7;t[n]=e},h.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new p((e>>>=0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this},h.prototype.int32=function(e){return e<0?this._push(v,10,i.fromNumber(e)):this.uint32(e)},h.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)},h.prototype.uint64=function(e){var t=i.from(e);return this._push(v,t.length(),t)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(e){var t=i.from(e).zzEncode();return this._push(v,t.length(),t)},h.prototype.bool=function(e){return this._push(d,1,e?1:0)},h.prototype.fixed32=function(e){return this._push(m,4,e>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(e){var t=i.from(e);return this._push(m,4,t.lo)._push(m,4,t.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(e){return this._push(a.float.writeFloatLE,4,e)},h.prototype.double=function(e){return this._push(a.float.writeDoubleLE,8,e)};var g=a.Array.prototype.set?function(e,t,n){t.set(e,n)}:function(e,t,n){for(var r=0;r<e.length;++r)t[n+r]=e[r]};h.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(d,1,0);if(a.isString(e)){var n=h.alloc(t=o.length(e));o.decode(e,n,0),e=n}return this.uint32(t)._push(g,t,e)},h.prototype.string=function(e){var t=s.length(e);return t?this.uint32(t)._push(s.write,t,e):this._push(d,1,0)},h.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new u(c,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(c,0,0),this.len=0),this},h.prototype.ldelim=function(){var e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=e.next,this.tail=t,this.len+=n),this},h.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),n=0;e;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t},h._configure=function(e){r=e,h.create=f(),r._configure()}},2815:function(e,t,n){"use strict";e.exports=i;var r=n(7063);(i.prototype=Object.create(r.prototype)).constructor=i;var a=n(3097);function i(){r.call(this)}function o(e,t,n){e.length<40?a.utf8.write(e,t,n):t.utf8Write?t.utf8Write(e,n):t.write(e,n)}i._configure=function(){i.alloc=a._Buffer_allocUnsafe,i.writeBytesBuffer=a.Buffer&&a.Buffer.prototype instanceof Uint8Array&&"set"===a.Buffer.prototype.set.name?function(e,t,n){t.set(e,n)}:function(e,t,n){if(e.copy)e.copy(t,n,0,e.length);else for(var r=0;r<e.length;)t[n++]=e[r++]}},i.prototype.bytes=function(e){a.isString(e)&&(e=a._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(i.writeBytesBuffer,t,e),this},i.prototype.string=function(e){var t=a.Buffer.byteLength(e);return this.uint32(t),t&&this._push(o,t,e),this},i._configure()},4463:function(e,t,n){"use strict";var r=n(2791),a=n(5585);function i(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var o=new Set,s={};function u(e,t){c(e,t),c(e+"Capture",t)}function c(e,t){for(s[e]=t,e=0;e<t.length;e++)o.add(t[e])}var l=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),h=Object.prototype.hasOwnProperty,f=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,d={},p={};function v(e,t,n,r,a,i,o){this.acceptsBooleans=2===t||3===t||4===t,this.attributeName=r,this.attributeNamespace=a,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=o}var m={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach((function(e){m[e]=new v(e,0,!1,e,null,!1,!1)})),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach((function(e){var t=e[0];m[t]=new v(t,1,!1,e[1],null,!1,!1)})),["contentEditable","draggable","spellCheck","value"].forEach((function(e){m[e]=new v(e,2,!1,e.toLowerCase(),null,!1,!1)})),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach((function(e){m[e]=new v(e,2,!1,e,null,!1,!1)})),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach((function(e){m[e]=new v(e,3,!1,e.toLowerCase(),null,!1,!1)})),["checked","multiple","muted","selected"].forEach((function(e){m[e]=new v(e,3,!0,e,null,!1,!1)})),["capture","download"].forEach((function(e){m[e]=new v(e,4,!1,e,null,!1,!1)})),["cols","rows","size","span"].forEach((function(e){m[e]=new v(e,6,!1,e,null,!1,!1)})),["rowSpan","start"].forEach((function(e){m[e]=new v(e,5,!1,e.toLowerCase(),null,!1,!1)}));var g=/[\-:]([a-z])/g;function y(e){return e[1].toUpperCase()}function b(e,t,n,r){var a=m.hasOwnProperty(t)?m[t]:null;(null!==a?0!==a.type:r||!(2<t.length)||"o"!==t[0]&&"O"!==t[0]||"n"!==t[1]&&"N"!==t[1])&&(function(e,t,n,r){if(null===t||"undefined"===typeof t||function(e,t,n,r){if(null!==n&&0===n.type)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return!r&&(null!==n?!n.acceptsBooleans:"data-"!==(e=e.toLowerCase().slice(0,5))&&"aria-"!==e);default:return!1}}(e,t,n,r))return!0;if(r)return!1;if(null!==n)switch(n.type){case 3:return!t;case 4:return!1===t;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}(t,n,a,r)&&(n=null),r||null===a?function(e){return!!h.call(p,e)||!h.call(d,e)&&(f.test(e)?p[e]=!0:(d[e]=!0,!1))}(t)&&(null===n?e.removeAttribute(t):e.setAttribute(t,""+n)):a.mustUseProperty?e[a.propertyName]=null===n?3!==a.type&&"":n:(t=a.attributeName,r=a.attributeNamespace,null===n?e.removeAttribute(t):(n=3===(a=a.type)||4===a&&!0===n?"":""+n,r?e.setAttributeNS(r,t,n):e.setAttribute(t,n))))}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,null,!1,!1)})),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)})),["xml:base","xml:lang","xml:space"].forEach((function(e){var t=e.replace(g,y);m[t]=new v(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)})),["tabIndex","crossOrigin"].forEach((function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!1,!1)})),m.xlinkHref=new v("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach((function(e){m[e]=new v(e,1,!1,e.toLowerCase(),null,!0,!0)}));var x=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,k=Symbol.for("react.element"),w=Symbol.for("react.portal"),_=Symbol.for("react.fragment"),S=Symbol.for("react.strict_mode"),C=Symbol.for("react.profiler"),T=Symbol.for("react.provider"),E=Symbol.for("react.context"),I=Symbol.for("react.forward_ref"),A=Symbol.for("react.suspense"),M=Symbol.for("react.suspense_list"),N=Symbol.for("react.memo"),R=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var D=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var P=Symbol.iterator;function O(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=P&&e[P]||e["@@iterator"])?e:null}var L,F=Object.assign;function z(e){if(void 0===L)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);L=t&&t[1]||""}return"\n"+L+e}var B=!1;function U(e,t){if(!e||B)return"";B=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var a=c.stack.split("\n"),i=r.stack.split("\n"),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==i[s]){var u="\n"+a[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=o&&0<=s);break}}}finally{B=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?z(e):""}function V(e){switch(e.tag){case 5:return z(e.type);case 16:return z("Lazy");case 13:return z("Suspense");case 19:return z("SuspenseList");case 0:case 2:case 15:return e=U(e.type,!1);case 11:return e=U(e.type.render,!1);case 1:return e=U(e.type,!0);default:return""}}function W(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case _:return"Fragment";case w:return"Portal";case C:return"Profiler";case S:return"StrictMode";case A:return"Suspense";case M:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case E:return(e.displayName||"Context")+".Consumer";case T:return(e._context.displayName||"Context")+".Provider";case I:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case N:return null!==(t=e.displayName||null)?t:W(e.type)||"Memo";case R:t=e._payload,e=e._init;try{return W(e(t))}catch(n){}}return null}function G(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return W(t);case 8:return t===S?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function j(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function q(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function H(e){e._valueTracker||(e._valueTracker=function(e){var t=q(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),r=""+e[t];if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var a=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return a.call(this)},set:function(e){r=""+e,i.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e))}function X(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),r="";return e&&(r=q(e)?e.checked?"true":"false":e.value),(e=r)!==n&&(t.setValue(e),!0)}function K(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}function Y(e,t){var n=t.checked;return F({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=n?n:e._wrapperState.initialChecked})}function Q(e,t){var n=null==t.defaultValue?"":t.defaultValue,r=null!=t.checked?t.checked:t.defaultChecked;n=j(null!=t.value?t.value:n),e._wrapperState={initialChecked:r,initialValue:n,controlled:"checkbox"===t.type||"radio"===t.type?null!=t.checked:null!=t.value}}function Z(e,t){null!=(t=t.checked)&&b(e,"checked",t,!1)}function J(e,t){Z(e,t);var n=j(t.value),r=t.type;if(null!=n)"number"===r?(0===n&&""===e.value||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if("submit"===r||"reset"===r)return void e.removeAttribute("value");t.hasOwnProperty("value")?ee(e,t.type,n):t.hasOwnProperty("defaultValue")&&ee(e,t.type,j(t.defaultValue)),null==t.checked&&null!=t.defaultChecked&&(e.defaultChecked=!!t.defaultChecked)}function $(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var r=t.type;if(!("submit"!==r&&"reset"!==r||void 0!==t.value&&null!==t.value))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}""!==(n=e.name)&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,""!==n&&(e.name=n)}function ee(e,t,n){"number"===t&&K(e.ownerDocument)===e||(null==n?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ne(e,t,n,r){if(e=e.options,t){t={};for(var a=0;a<n.length;a++)t["$"+n[a]]=!0;for(n=0;n<e.length;n++)a=t.hasOwnProperty("$"+e[n].value),e[n].selected!==a&&(e[n].selected=a),a&&r&&(e[n].defaultSelected=!0)}else{for(n=""+j(n),t=null,a=0;a<e.length;a++){if(e[a].value===n)return e[a].selected=!0,void(r&&(e[a].defaultSelected=!0));null!==t||e[a].disabled||(t=e[a])}null!==t&&(t.selected=!0)}}function re(e,t){if(null!=t.dangerouslySetInnerHTML)throw Error(i(91));return F({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function ae(e,t){var n=t.value;if(null==n){if(n=t.children,t=t.defaultValue,null!=n){if(null!=t)throw Error(i(92));if(te(n)){if(1<n.length)throw Error(i(93));n=n[0]}t=n}null==t&&(t=""),n=t}e._wrapperState={initialValue:j(n)}}function ie(e,t){var n=j(t.value),r=j(t.defaultValue);null!=n&&((n=""+n)!==e.value&&(e.value=n),null==t.defaultValue&&e.defaultValue!==n&&(e.defaultValue=n)),null!=r&&(e.defaultValue=""+r)}function oe(e){var t=e.textContent;t===e._wrapperState.initialValue&&""!==t&&null!==t&&(e.value=t)}function se(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ue(e,t){return null==e||"http://www.w3.org/1999/xhtml"===e?se(t):"http://www.w3.org/2000/svg"===e&&"foreignObject"===t?"http://www.w3.org/1999/xhtml":e}var ce,le,he=(le=function(e,t){if("http://www.w3.org/2000/svg"!==e.namespaceURI||"innerHTML"in e)e.innerHTML=t;else{for((ce=ce||document.createElement("div")).innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=ce.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}},"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(e,t,n,r){MSApp.execUnsafeLocalFunction((function(){return le(e,t)}))}:le);function fe(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&3===n.nodeType)return void(n.nodeValue=t)}e.textContent=t}var de={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},pe=["Webkit","ms","Moz","O"];function ve(e,t,n){return null==t||"boolean"===typeof t||""===t?"":n||"number"!==typeof t||0===t||de.hasOwnProperty(e)&&de[e]?(""+t).trim():t+"px"}function me(e,t){for(var n in e=e.style,t)if(t.hasOwnProperty(n)){var r=0===n.indexOf("--"),a=ve(n,t[n],r);"float"===n&&(n="cssFloat"),r?e.setProperty(n,a):e[n]=a}}Object.keys(de).forEach((function(e){pe.forEach((function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),de[t]=de[e]}))}));var ge=F({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function ye(e,t){if(t){if(ge[e]&&(null!=t.children||null!=t.dangerouslySetInnerHTML))throw Error(i(137,e));if(null!=t.dangerouslySetInnerHTML){if(null!=t.children)throw Error(i(60));if("object"!==typeof t.dangerouslySetInnerHTML||!("__html"in t.dangerouslySetInnerHTML))throw Error(i(61))}if(null!=t.style&&"object"!==typeof t.style)throw Error(i(62))}}function be(e,t){if(-1===e.indexOf("-"))return"string"===typeof t.is;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xe=null;function ke(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var we=null,_e=null,Se=null;function Ce(e){if(e=ba(e)){if("function"!==typeof we)throw Error(i(280));var t=e.stateNode;t&&(t=ka(t),we(e.stateNode,e.type,t))}}function Te(e){_e?Se?Se.push(e):Se=[e]:_e=e}function Ee(){if(_e){var e=_e,t=Se;if(Se=_e=null,Ce(e),t)for(e=0;e<t.length;e++)Ce(t[e])}}function Ie(e,t){return e(t)}function Ae(){}var Me=!1;function Ne(e,t,n){if(Me)return e(t,n);Me=!0;try{return Ie(e,t,n)}finally{Me=!1,(null!==_e||null!==Se)&&(Ae(),Ee())}}function Re(e,t){var n=e.stateNode;if(null===n)return null;var r=ka(n);if(null===r)return null;n=r[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(r=!r.disabled)||(r=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!r;break e;default:e=!1}if(e)return null;if(n&&"function"!==typeof n)throw Error(i(231,t,typeof n));return n}var De=!1;if(l)try{var Pe={};Object.defineProperty(Pe,"passive",{get:function(){De=!0}}),window.addEventListener("test",Pe,Pe),window.removeEventListener("test",Pe,Pe)}catch(le){De=!1}function Oe(e,t,n,r,a,i,o,s,u){var c=Array.prototype.slice.call(arguments,3);try{t.apply(n,c)}catch(l){this.onError(l)}}var Le=!1,Fe=null,ze=!1,Be=null,Ue={onError:function(e){Le=!0,Fe=e}};function Ve(e,t,n,r,a,i,o,s,u){Le=!1,Fe=null,Oe.apply(Ue,arguments)}function We(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function Ge(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function je(e){if(We(e)!==e)throw Error(i(188))}function qe(e){return null!==(e=function(e){var t=e.alternate;if(!t){if(null===(t=We(e)))throw Error(i(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var o=a.alternate;if(null===o){if(null!==(r=a.return)){n=r;continue}break}if(a.child===o.child){for(o=a.child;o;){if(o===n)return je(a),e;if(o===r)return je(a),t;o=o.sibling}throw Error(i(188))}if(n.return!==r.return)n=a,r=o;else{for(var s=!1,u=a.child;u;){if(u===n){s=!0,n=a,r=o;break}if(u===r){s=!0,r=a,n=o;break}u=u.sibling}if(!s){for(u=o.child;u;){if(u===n){s=!0,n=o,r=a;break}if(u===r){s=!0,r=o,n=a;break}u=u.sibling}if(!s)throw Error(i(189))}}if(n.alternate!==r)throw Error(i(190))}if(3!==n.tag)throw Error(i(188));return n.stateNode.current===n?e:t}(e))?He(e):null}function He(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=He(e);if(null!==t)return t;e=e.sibling}return null}var Xe=a.unstable_scheduleCallback,Ke=a.unstable_cancelCallback,Ye=a.unstable_shouldYield,Qe=a.unstable_requestPaint,Ze=a.unstable_now,Je=a.unstable_getCurrentPriorityLevel,$e=a.unstable_ImmediatePriority,et=a.unstable_UserBlockingPriority,tt=a.unstable_NormalPriority,nt=a.unstable_LowPriority,rt=a.unstable_IdlePriority,at=null,it=null;var ot=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(st(e)/ut|0)|0},st=Math.log,ut=Math.LN2;var ct=64,lt=4194304;function ht(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function ft(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~a;0!==s?r=ht(s):0!==(i&=o)&&(r=ht(i))}else 0!==(o=n&~a)?r=ht(o):0!==i&&(r=ht(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(i=t&-t)||16===a&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-ot(t)),r|=e[n],t&=~a;return r}function dt(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function pt(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function vt(){var e=ct;return 0===(4194240&(ct<<=1))&&(ct=64),e}function mt(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function gt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-ot(t)]=n}function yt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-ot(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var bt=0;function xt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var kt,wt,_t,St,Ct,Tt=!1,Et=[],It=null,At=null,Mt=null,Nt=new Map,Rt=new Map,Dt=[],Pt="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Ot(e,t){switch(e){case"focusin":case"focusout":It=null;break;case"dragenter":case"dragleave":At=null;break;case"mouseover":case"mouseout":Mt=null;break;case"pointerover":case"pointerout":Nt.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Rt.delete(t.pointerId)}}function Lt(e,t,n,r,a,i){return null===e||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:r,nativeEvent:i,targetContainers:[a]},null!==t&&(null!==(t=ba(t))&&wt(t)),e):(e.eventSystemFlags|=r,t=e.targetContainers,null!==a&&-1===t.indexOf(a)&&t.push(a),e)}function Ft(e){var t=ya(e.target);if(null!==t){var n=We(t);if(null!==n)if(13===(t=n.tag)){if(null!==(t=Ge(n)))return e.blockedOn=t,void Ct(e.priority,(function(){_t(n)}))}else if(3===t&&n.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===n.tag?n.stateNode.containerInfo:null)}e.blockedOn=null}function zt(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var n=Yt(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(null!==n)return null!==(t=ba(n))&&wt(t),e.blockedOn=n,!1;var r=new(n=e.nativeEvent).constructor(n.type,n);xe=r,n.target.dispatchEvent(r),xe=null,t.shift()}return!0}function Bt(e,t,n){zt(e)&&n.delete(t)}function Ut(){Tt=!1,null!==It&&zt(It)&&(It=null),null!==At&&zt(At)&&(At=null),null!==Mt&&zt(Mt)&&(Mt=null),Nt.forEach(Bt),Rt.forEach(Bt)}function Vt(e,t){e.blockedOn===t&&(e.blockedOn=null,Tt||(Tt=!0,a.unstable_scheduleCallback(a.unstable_NormalPriority,Ut)))}function Wt(e){function t(t){return Vt(t,e)}if(0<Et.length){Vt(Et[0],e);for(var n=1;n<Et.length;n++){var r=Et[n];r.blockedOn===e&&(r.blockedOn=null)}}for(null!==It&&Vt(It,e),null!==At&&Vt(At,e),null!==Mt&&Vt(Mt,e),Nt.forEach(t),Rt.forEach(t),n=0;n<Dt.length;n++)(r=Dt[n]).blockedOn===e&&(r.blockedOn=null);for(;0<Dt.length&&null===(n=Dt[0]).blockedOn;)Ft(n),null===n.blockedOn&&Dt.shift()}var Gt=x.ReactCurrentBatchConfig,jt=!0;function qt(e,t,n,r){var a=bt,i=Gt.transition;Gt.transition=null;try{bt=1,Xt(e,t,n,r)}finally{bt=a,Gt.transition=i}}function Ht(e,t,n,r){var a=bt,i=Gt.transition;Gt.transition=null;try{bt=4,Xt(e,t,n,r)}finally{bt=a,Gt.transition=i}}function Xt(e,t,n,r){if(jt){var a=Yt(e,t,n,r);if(null===a)jr(e,t,r,Kt,n),Ot(e,r);else if(function(e,t,n,r,a){switch(t){case"focusin":return It=Lt(It,e,t,n,r,a),!0;case"dragenter":return At=Lt(At,e,t,n,r,a),!0;case"mouseover":return Mt=Lt(Mt,e,t,n,r,a),!0;case"pointerover":var i=a.pointerId;return Nt.set(i,Lt(Nt.get(i)||null,e,t,n,r,a)),!0;case"gotpointercapture":return i=a.pointerId,Rt.set(i,Lt(Rt.get(i)||null,e,t,n,r,a)),!0}return!1}(a,e,t,n,r))r.stopPropagation();else if(Ot(e,r),4&t&&-1<Pt.indexOf(e)){for(;null!==a;){var i=ba(a);if(null!==i&&kt(i),null===(i=Yt(e,t,n,r))&&jr(e,t,r,Kt,n),i===a)break;a=i}null!==a&&r.stopPropagation()}else jr(e,t,r,null,n)}}var Kt=null;function Yt(e,t,n,r){if(Kt=null,null!==(e=ya(e=ke(r))))if(null===(t=We(e)))e=null;else if(13===(n=t.tag)){if(null!==(e=Ge(t)))return e;e=null}else if(3===n){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return Kt=e,null}function Qt(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Je()){case $e:return 1;case et:return 4;case tt:case nt:return 16;case rt:return 536870912;default:return 16}default:return 16}}var Zt=null,Jt=null,$t=null;function en(){if($t)return $t;var e,t,n=Jt,r=n.length,a="value"in Zt?Zt.value:Zt.textContent,i=a.length;for(e=0;e<r&&n[e]===a[e];e++);var o=r-e;for(t=1;t<=o&&n[r-t]===a[i-t];t++);return $t=a.slice(e,1<t?1-t:void 0)}function tn(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function nn(){return!0}function rn(){return!1}function an(e){function t(t,n,r,a,i){for(var o in this._reactName=t,this._targetInst=r,this.type=n,this.nativeEvent=a,this.target=i,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(a):a[o]);return this.isDefaultPrevented=(null!=a.defaultPrevented?a.defaultPrevented:!1===a.returnValue)?nn:rn,this.isPropagationStopped=rn,this}return F(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=nn)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=nn)},persist:function(){},isPersistent:nn}),t}var on,sn,un,cn={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ln=an(cn),hn=F({},cn,{view:0,detail:0}),fn=an(hn),dn=F({},hn,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Cn,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==un&&(un&&"mousemove"===e.type?(on=e.screenX-un.screenX,sn=e.screenY-un.screenY):sn=on=0,un=e),on)},movementY:function(e){return"movementY"in e?e.movementY:sn}}),pn=an(dn),vn=an(F({},dn,{dataTransfer:0})),mn=an(F({},hn,{relatedTarget:0})),gn=an(F({},cn,{animationName:0,elapsedTime:0,pseudoElement:0})),yn=F({},cn,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),bn=an(yn),xn=an(F({},cn,{data:0})),kn={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},wn={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_n={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Sn(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=_n[e])&&!!t[e]}function Cn(){return Sn}var Tn=F({},hn,{key:function(e){if(e.key){var t=kn[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=tn(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?wn[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Cn,charCode:function(e){return"keypress"===e.type?tn(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?tn(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}}),En=an(Tn),In=an(F({},dn,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),An=an(F({},hn,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Cn})),Mn=an(F({},cn,{propertyName:0,elapsedTime:0,pseudoElement:0})),Nn=F({},dn,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Rn=an(Nn),Dn=[9,13,27,32],Pn=l&&"CompositionEvent"in window,On=null;l&&"documentMode"in document&&(On=document.documentMode);var Ln=l&&"TextEvent"in window&&!On,Fn=l&&(!Pn||On&&8<On&&11>=On),zn=String.fromCharCode(32),Bn=!1;function Un(e,t){switch(e){case"keyup":return-1!==Dn.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Vn(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Wn=!1;var Gn={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function jn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Gn[e.type]:"textarea"===t}function qn(e,t,n,r){Te(r),0<(t=Hr(t,"onChange")).length&&(n=new ln("onChange","change",null,n,r),e.push({event:n,listeners:t}))}var Hn=null,Xn=null;function Kn(e){zr(e,0)}function Yn(e){if(X(xa(e)))return e}function Qn(e,t){if("change"===e)return t}var Zn=!1;if(l){var Jn;if(l){var $n="oninput"in document;if(!$n){var er=document.createElement("div");er.setAttribute("oninput","return;"),$n="function"===typeof er.oninput}Jn=$n}else Jn=!1;Zn=Jn&&(!document.documentMode||9<document.documentMode)}function tr(){Hn&&(Hn.detachEvent("onpropertychange",nr),Xn=Hn=null)}function nr(e){if("value"===e.propertyName&&Yn(Xn)){var t=[];qn(t,Xn,e,ke(e)),Ne(Kn,t)}}function rr(e,t,n){"focusin"===e?(tr(),Xn=n,(Hn=t).attachEvent("onpropertychange",nr)):"focusout"===e&&tr()}function ar(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return Yn(Xn)}function ir(e,t){if("click"===e)return Yn(t)}function or(e,t){if("input"===e||"change"===e)return Yn(t)}var sr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function ur(e,t){if(sr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!h.call(t,a)||!sr(e[a],t[a]))return!1}return!0}function cr(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function lr(e,t){var n,r=cr(e);for(e=0;r;){if(3===r.nodeType){if(n=e+r.textContent.length,e<=t&&n>=t)return{node:r,offset:t-e};e=n}e:{for(;r;){if(r.nextSibling){r=r.nextSibling;break e}r=r.parentNode}r=void 0}r=cr(r)}}function hr(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?hr(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function fr(){for(var e=window,t=K();t instanceof e.HTMLIFrameElement;){try{var n="string"===typeof t.contentWindow.location.href}catch(r){n=!1}if(!n)break;t=K((e=t.contentWindow).document)}return t}function dr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}function pr(e){var t=fr(),n=e.focusedElem,r=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&hr(n.ownerDocument.documentElement,n)){if(null!==r&&dr(n))if(t=r.start,void 0===(e=r.end)&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if((e=(t=n.ownerDocument||document)&&t.defaultView||window).getSelection){e=e.getSelection();var a=n.textContent.length,i=Math.min(r.start,a);r=void 0===r.end?i:Math.min(r.end,a),!e.extend&&i>r&&(a=r,r=i,i=a),a=lr(n,i);var o=lr(n,r);a&&o&&(1!==e.rangeCount||e.anchorNode!==a.node||e.anchorOffset!==a.offset||e.focusNode!==o.node||e.focusOffset!==o.offset)&&((t=t.createRange()).setStart(a.node,a.offset),e.removeAllRanges(),i>r?(e.addRange(t),e.extend(o.node,o.offset)):(t.setEnd(o.node,o.offset),e.addRange(t)))}for(t=[],e=n;e=e.parentNode;)1===e.nodeType&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for("function"===typeof n.focus&&n.focus(),n=0;n<t.length;n++)(e=t[n]).element.scrollLeft=e.left,e.element.scrollTop=e.top}}var vr=l&&"documentMode"in document&&11>=document.documentMode,mr=null,gr=null,yr=null,br=!1;function xr(e,t,n){var r=n.window===n?n.document:9===n.nodeType?n:n.ownerDocument;br||null==mr||mr!==K(r)||("selectionStart"in(r=mr)&&dr(r)?r={start:r.selectionStart,end:r.selectionEnd}:r={anchorNode:(r=(r.ownerDocument&&r.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:r.anchorOffset,focusNode:r.focusNode,focusOffset:r.focusOffset},yr&&ur(yr,r)||(yr=r,0<(r=Hr(gr,"onSelect")).length&&(t=new ln("onSelect","select",null,t,n),e.push({event:t,listeners:r}),t.target=mr)))}function kr(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var wr={animationend:kr("Animation","AnimationEnd"),animationiteration:kr("Animation","AnimationIteration"),animationstart:kr("Animation","AnimationStart"),transitionend:kr("Transition","TransitionEnd")},_r={},Sr={};function Cr(e){if(_r[e])return _r[e];if(!wr[e])return e;var t,n=wr[e];for(t in n)if(n.hasOwnProperty(t)&&t in Sr)return _r[e]=n[t];return e}l&&(Sr=document.createElement("div").style,"AnimationEvent"in window||(delete wr.animationend.animation,delete wr.animationiteration.animation,delete wr.animationstart.animation),"TransitionEvent"in window||delete wr.transitionend.transition);var Tr=Cr("animationend"),Er=Cr("animationiteration"),Ir=Cr("animationstart"),Ar=Cr("transitionend"),Mr=new Map,Nr="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Rr(e,t){Mr.set(e,t),u(t,[e])}for(var Dr=0;Dr<Nr.length;Dr++){var Pr=Nr[Dr];Rr(Pr.toLowerCase(),"on"+(Pr[0].toUpperCase()+Pr.slice(1)))}Rr(Tr,"onAnimationEnd"),Rr(Er,"onAnimationIteration"),Rr(Ir,"onAnimationStart"),Rr("dblclick","onDoubleClick"),Rr("focusin","onFocus"),Rr("focusout","onBlur"),Rr(Ar,"onTransitionEnd"),c("onMouseEnter",["mouseout","mouseover"]),c("onMouseLeave",["mouseout","mouseover"]),c("onPointerEnter",["pointerout","pointerover"]),c("onPointerLeave",["pointerout","pointerover"]),u("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),u("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),u("onBeforeInput",["compositionend","keypress","textInput","paste"]),u("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),u("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Or="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Lr=new Set("cancel close invalid load scroll toggle".split(" ").concat(Or));function Fr(e,t,n){var r=e.type||"unknown-event";e.currentTarget=n,function(e,t,n,r,a,o,s,u,c){if(Ve.apply(this,arguments),Le){if(!Le)throw Error(i(198));var l=Fe;Le=!1,Fe=null,ze||(ze=!0,Be=l)}}(r,t,void 0,e),e.currentTarget=null}function zr(e,t){t=0!==(4&t);for(var n=0;n<e.length;n++){var r=e[n],a=r.event;r=r.listeners;e:{var i=void 0;if(t)for(var o=r.length-1;0<=o;o--){var s=r[o],u=s.instance,c=s.currentTarget;if(s=s.listener,u!==i&&a.isPropagationStopped())break e;Fr(a,s,c),i=u}else for(o=0;o<r.length;o++){if(u=(s=r[o]).instance,c=s.currentTarget,s=s.listener,u!==i&&a.isPropagationStopped())break e;Fr(a,s,c),i=u}}}if(ze)throw e=Be,ze=!1,Be=null,e}function Br(e,t){var n=t[va];void 0===n&&(n=t[va]=new Set);var r=e+"__bubble";n.has(r)||(Gr(t,e,2,!1),n.add(r))}function Ur(e,t,n){var r=0;t&&(r|=4),Gr(n,e,r,t)}var Vr="_reactListening"+Math.random().toString(36).slice(2);function Wr(e){if(!e[Vr]){e[Vr]=!0,o.forEach((function(t){"selectionchange"!==t&&(Lr.has(t)||Ur(t,!1,e),Ur(t,!0,e))}));var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Vr]||(t[Vr]=!0,Ur("selectionchange",!1,t))}}function Gr(e,t,n,r){switch(Qt(t)){case 1:var a=qt;break;case 4:a=Ht;break;default:a=Xt}n=a.bind(null,t,n,e),a=void 0,!De||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(a=!0),r?void 0!==a?e.addEventListener(t,n,{capture:!0,passive:a}):e.addEventListener(t,n,!0):void 0!==a?e.addEventListener(t,n,{passive:a}):e.addEventListener(t,n,!1)}function jr(e,t,n,r,a){var i=r;if(0===(1&t)&&0===(2&t)&&null!==r)e:for(;;){if(null===r)return;var o=r.tag;if(3===o||4===o){var s=r.stateNode.containerInfo;if(s===a||8===s.nodeType&&s.parentNode===a)break;if(4===o)for(o=r.return;null!==o;){var u=o.tag;if((3===u||4===u)&&((u=o.stateNode.containerInfo)===a||8===u.nodeType&&u.parentNode===a))return;o=o.return}for(;null!==s;){if(null===(o=ya(s)))return;if(5===(u=o.tag)||6===u){r=i=o;continue e}s=s.parentNode}}r=r.return}Ne((function(){var r=i,a=ke(n),o=[];e:{var s=Mr.get(e);if(void 0!==s){var u=ln,c=e;switch(e){case"keypress":if(0===tn(n))break e;case"keydown":case"keyup":u=En;break;case"focusin":c="focus",u=mn;break;case"focusout":c="blur",u=mn;break;case"beforeblur":case"afterblur":u=mn;break;case"click":if(2===n.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":u=pn;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":u=vn;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":u=An;break;case Tr:case Er:case Ir:u=gn;break;case Ar:u=Mn;break;case"scroll":u=fn;break;case"wheel":u=Rn;break;case"copy":case"cut":case"paste":u=bn;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":u=In}var l=0!==(4&t),h=!l&&"scroll"===e,f=l?null!==s?s+"Capture":null:s;l=[];for(var d,p=r;null!==p;){var v=(d=p).stateNode;if(5===d.tag&&null!==v&&(d=v,null!==f&&(null!=(v=Re(p,f))&&l.push(qr(p,v,d)))),h)break;p=p.return}0<l.length&&(s=new u(s,c,null,n,a),o.push({event:s,listeners:l}))}}if(0===(7&t)){if(u="mouseout"===e||"pointerout"===e,(!(s="mouseover"===e||"pointerover"===e)||n===xe||!(c=n.relatedTarget||n.fromElement)||!ya(c)&&!c[pa])&&(u||s)&&(s=a.window===a?a:(s=a.ownerDocument)?s.defaultView||s.parentWindow:window,u?(u=r,null!==(c=(c=n.relatedTarget||n.toElement)?ya(c):null)&&(c!==(h=We(c))||5!==c.tag&&6!==c.tag)&&(c=null)):(u=null,c=r),u!==c)){if(l=pn,v="onMouseLeave",f="onMouseEnter",p="mouse","pointerout"!==e&&"pointerover"!==e||(l=In,v="onPointerLeave",f="onPointerEnter",p="pointer"),h=null==u?s:xa(u),d=null==c?s:xa(c),(s=new l(v,p+"leave",u,n,a)).target=h,s.relatedTarget=d,v=null,ya(a)===r&&((l=new l(f,p+"enter",c,n,a)).target=d,l.relatedTarget=h,v=l),h=v,u&&c)e:{for(f=c,p=0,d=l=u;d;d=Xr(d))p++;for(d=0,v=f;v;v=Xr(v))d++;for(;0<p-d;)l=Xr(l),p--;for(;0<d-p;)f=Xr(f),d--;for(;p--;){if(l===f||null!==f&&l===f.alternate)break e;l=Xr(l),f=Xr(f)}l=null}else l=null;null!==u&&Kr(o,s,u,l,!1),null!==c&&null!==h&&Kr(o,h,c,l,!0)}if("select"===(u=(s=r?xa(r):window).nodeName&&s.nodeName.toLowerCase())||"input"===u&&"file"===s.type)var m=Qn;else if(jn(s))if(Zn)m=or;else{m=ar;var g=rr}else(u=s.nodeName)&&"input"===u.toLowerCase()&&("checkbox"===s.type||"radio"===s.type)&&(m=ir);switch(m&&(m=m(e,r))?qn(o,m,n,a):(g&&g(e,s,r),"focusout"===e&&(g=s._wrapperState)&&g.controlled&&"number"===s.type&&ee(s,"number",s.value)),g=r?xa(r):window,e){case"focusin":(jn(g)||"true"===g.contentEditable)&&(mr=g,gr=r,yr=null);break;case"focusout":yr=gr=mr=null;break;case"mousedown":br=!0;break;case"contextmenu":case"mouseup":case"dragend":br=!1,xr(o,n,a);break;case"selectionchange":if(vr)break;case"keydown":case"keyup":xr(o,n,a)}var y;if(Pn)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Wn?Un(e,n)&&(b="onCompositionEnd"):"keydown"===e&&229===n.keyCode&&(b="onCompositionStart");b&&(Fn&&"ko"!==n.locale&&(Wn||"onCompositionStart"!==b?"onCompositionEnd"===b&&Wn&&(y=en()):(Jt="value"in(Zt=a)?Zt.value:Zt.textContent,Wn=!0)),0<(g=Hr(r,b)).length&&(b=new xn(b,e,null,n,a),o.push({event:b,listeners:g}),y?b.data=y:null!==(y=Vn(n))&&(b.data=y))),(y=Ln?function(e,t){switch(e){case"compositionend":return Vn(t);case"keypress":return 32!==t.which?null:(Bn=!0,zn);case"textInput":return(e=t.data)===zn&&Bn?null:e;default:return null}}(e,n):function(e,t){if(Wn)return"compositionend"===e||!Pn&&Un(e,t)?(e=en(),$t=Jt=Zt=null,Wn=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Fn&&"ko"!==t.locale?null:t.data}}(e,n))&&(0<(r=Hr(r,"onBeforeInput")).length&&(a=new xn("onBeforeInput","beforeinput",null,n,a),o.push({event:a,listeners:r}),a.data=y))}zr(o,t)}))}function qr(e,t,n){return{instance:e,listener:t,currentTarget:n}}function Hr(e,t){for(var n=t+"Capture",r=[];null!==e;){var a=e,i=a.stateNode;5===a.tag&&null!==i&&(a=i,null!=(i=Re(e,n))&&r.unshift(qr(e,i,a)),null!=(i=Re(e,t))&&r.push(qr(e,i,a))),e=e.return}return r}function Xr(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag);return e||null}function Kr(e,t,n,r,a){for(var i=t._reactName,o=[];null!==n&&n!==r;){var s=n,u=s.alternate,c=s.stateNode;if(null!==u&&u===r)break;5===s.tag&&null!==c&&(s=c,a?null!=(u=Re(n,i))&&o.unshift(qr(n,u,s)):a||null!=(u=Re(n,i))&&o.push(qr(n,u,s))),n=n.return}0!==o.length&&e.push({event:t,listeners:o})}var Yr=/\r\n?/g,Qr=/\u0000|\uFFFD/g;function Zr(e){return("string"===typeof e?e:""+e).replace(Yr,"\n").replace(Qr,"")}function Jr(e,t,n){if(t=Zr(t),Zr(e)!==t&&n)throw Error(i(425))}function $r(){}var ea=null,ta=null;function na(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var ra="function"===typeof setTimeout?setTimeout:void 0,aa="function"===typeof clearTimeout?clearTimeout:void 0,ia="function"===typeof Promise?Promise:void 0,oa="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof ia?function(e){return ia.resolve(null).then(e).catch(sa)}:ra;function sa(e){setTimeout((function(){throw e}))}function ua(e,t){var n=t,r=0;do{var a=n.nextSibling;if(e.removeChild(n),a&&8===a.nodeType)if("/$"===(n=a.data)){if(0===r)return e.removeChild(a),void Wt(t);r--}else"$"!==n&&"$?"!==n&&"$!"!==n||r++;n=a}while(n);Wt(t)}function ca(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t)break;if("/$"===t)return null}}return e}function la(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var n=e.data;if("$"===n||"$!"===n||"$?"===n){if(0===t)return e;t--}else"/$"===n&&t++}e=e.previousSibling}return null}var ha=Math.random().toString(36).slice(2),fa="__reactFiber$"+ha,da="__reactProps$"+ha,pa="__reactContainer$"+ha,va="__reactEvents$"+ha,ma="__reactListeners$"+ha,ga="__reactHandles$"+ha;function ya(e){var t=e[fa];if(t)return t;for(var n=e.parentNode;n;){if(t=n[pa]||n[fa]){if(n=t.alternate,null!==t.child||null!==n&&null!==n.child)for(e=la(e);null!==e;){if(n=e[fa])return n;e=la(e)}return t}n=(e=n).parentNode}return null}function ba(e){return!(e=e[fa]||e[pa])||5!==e.tag&&6!==e.tag&&13!==e.tag&&3!==e.tag?null:e}function xa(e){if(5===e.tag||6===e.tag)return e.stateNode;throw Error(i(33))}function ka(e){return e[da]||null}var wa=[],_a=-1;function Sa(e){return{current:e}}function Ca(e){0>_a||(e.current=wa[_a],wa[_a]=null,_a--)}function Ta(e,t){_a++,wa[_a]=e.current,e.current=t}var Ea={},Ia=Sa(Ea),Aa=Sa(!1),Ma=Ea;function Na(e,t){var n=e.type.contextTypes;if(!n)return Ea;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function Ra(e){return null!==(e=e.childContextTypes)&&void 0!==e}function Da(){Ca(Aa),Ca(Ia)}function Pa(e,t,n){if(Ia.current!==Ea)throw Error(i(168));Ta(Ia,t),Ta(Aa,n)}function Oa(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(i(108,G(e)||"Unknown",a));return F({},n,r)}function La(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ea,Ma=Ia.current,Ta(Ia,e),Ta(Aa,Aa.current),!0}function Fa(e,t,n){var r=e.stateNode;if(!r)throw Error(i(169));n?(e=Oa(e,t,Ma),r.__reactInternalMemoizedMergedChildContext=e,Ca(Aa),Ca(Ia),Ta(Ia,e)):Ca(Aa),Ta(Aa,n)}var za=null,Ba=!1,Ua=!1;function Va(e){null===za?za=[e]:za.push(e)}function Wa(){if(!Ua&&null!==za){Ua=!0;var e=0,t=bt;try{var n=za;for(bt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}za=null,Ba=!1}catch(a){throw null!==za&&(za=za.slice(e+1)),Xe($e,Wa),a}finally{bt=t,Ua=!1}}return null}var Ga=[],ja=0,qa=null,Ha=0,Xa=[],Ka=0,Ya=null,Qa=1,Za="";function Ja(e,t){Ga[ja++]=Ha,Ga[ja++]=qa,qa=e,Ha=t}function $a(e,t,n){Xa[Ka++]=Qa,Xa[Ka++]=Za,Xa[Ka++]=Ya,Ya=e;var r=Qa;e=Za;var a=32-ot(r)-1;r&=~(1<<a),n+=1;var i=32-ot(t)+a;if(30<i){var o=a-a%5;i=(r&(1<<o)-1).toString(32),r>>=o,a-=o,Qa=1<<32-ot(t)+a|n<<a|r,Za=i+e}else Qa=1<<i|n<<a|r,Za=e}function ei(e){null!==e.return&&(Ja(e,1),$a(e,1,0))}function ti(e){for(;e===qa;)qa=Ga[--ja],Ga[ja]=null,Ha=Ga[--ja],Ga[ja]=null;for(;e===Ya;)Ya=Xa[--Ka],Xa[Ka]=null,Za=Xa[--Ka],Xa[Ka]=null,Qa=Xa[--Ka],Xa[Ka]=null}var ni=null,ri=null,ai=!1,ii=null;function oi(e,t){var n=Nc(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function si(e,t){switch(e.tag){case 5:var n=e.type;return null!==(t=1!==t.nodeType||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t)&&(e.stateNode=t,ni=e,ri=ca(t.firstChild),!0);case 6:return null!==(t=""===e.pendingProps||3!==t.nodeType?null:t)&&(e.stateNode=t,ni=e,ri=null,!0);case 13:return null!==(t=8!==t.nodeType?null:t)&&(n=null!==Ya?{id:Qa,overflow:Za}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Nc(18,null,null,0)).stateNode=t,n.return=e,e.child=n,ni=e,ri=null,!0);default:return!1}}function ui(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function ci(e){if(ai){var t=ri;if(t){var n=t;if(!si(e,t)){if(ui(e))throw Error(i(418));t=ca(n.nextSibling);var r=ni;t&&si(e,t)?oi(r,n):(e.flags=-4097&e.flags|2,ai=!1,ni=e)}}else{if(ui(e))throw Error(i(418));e.flags=-4097&e.flags|2,ai=!1,ni=e}}}function li(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;ni=e}function hi(e){if(e!==ni)return!1;if(!ai)return li(e),ai=!0,!1;var t;if((t=3!==e.tag)&&!(t=5!==e.tag)&&(t="head"!==(t=e.type)&&"body"!==t&&!na(e.type,e.memoizedProps)),t&&(t=ri)){if(ui(e))throw fi(),Error(i(418));for(;t;)oi(e,t),t=ca(t.nextSibling)}if(li(e),13===e.tag){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(i(317));e:{for(e=e.nextSibling,t=0;e;){if(8===e.nodeType){var n=e.data;if("/$"===n){if(0===t){ri=ca(e.nextSibling);break e}t--}else"$"!==n&&"$!"!==n&&"$?"!==n||t++}e=e.nextSibling}ri=null}}else ri=ni?ca(e.stateNode.nextSibling):null;return!0}function fi(){for(var e=ri;e;)e=ca(e.nextSibling)}function di(){ri=ni=null,ai=!1}function pi(e){null===ii?ii=[e]:ii.push(e)}var vi=x.ReactCurrentBatchConfig;function mi(e,t){if(e&&e.defaultProps){for(var n in t=F({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var gi=Sa(null),yi=null,bi=null,xi=null;function ki(){xi=bi=yi=null}function wi(e){var t=gi.current;Ca(gi),e._currentValue=t}function _i(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function Si(e,t){yi=e,xi=bi=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(xs=!0),e.firstContext=null)}function Ci(e){var t=e._currentValue;if(xi!==e)if(e={context:e,memoizedValue:t,next:null},null===bi){if(null===yi)throw Error(i(308));bi=e,yi.dependencies={lanes:0,firstContext:e}}else bi=bi.next=e;return t}var Ti=null;function Ei(e){null===Ti?Ti=[e]:Ti.push(e)}function Ii(e,t,n,r){var a=t.interleaved;return null===a?(n.next=n,Ei(t)):(n.next=a.next,a.next=n),t.interleaved=n,Ai(e,r)}function Ai(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}var Mi=!1;function Ni(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Ri(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Di(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function Pi(e,t,n){var r=e.updateQueue;if(null===r)return null;if(r=r.shared,0!==(2&Iu)){var a=r.pending;return null===a?t.next=t:(t.next=a.next,a.next=t),r.pending=t,Ai(e,n)}return null===(a=r.interleaved)?(t.next=t,Ei(r)):(t.next=a.next,a.next=t),r.interleaved=t,Ai(e,n)}function Oi(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}function Li(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=o:i=i.next=o,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Fi(e,t,n,r){var a=e.updateQueue;Mi=!1;var i=a.firstBaseUpdate,o=a.lastBaseUpdate,s=a.shared.pending;if(null!==s){a.shared.pending=null;var u=s,c=u.next;u.next=null,null===o?i=c:o.next=c,o=u;var l=e.alternate;null!==l&&((s=(l=l.updateQueue).lastBaseUpdate)!==o&&(null===s?l.firstBaseUpdate=c:s.next=c,l.lastBaseUpdate=u))}if(null!==i){var h=a.baseState;for(o=0,l=c=u=null,s=i;;){var f=s.lane,d=s.eventTime;if((r&f)===f){null!==l&&(l=l.next={eventTime:d,lane:0,tag:s.tag,payload:s.payload,callback:s.callback,next:null});e:{var p=e,v=s;switch(f=t,d=n,v.tag){case 1:if("function"===typeof(p=v.payload)){h=p.call(d,h,f);break e}h=p;break e;case 3:p.flags=-65537&p.flags|128;case 0:if(null===(f="function"===typeof(p=v.payload)?p.call(d,h,f):p)||void 0===f)break e;h=F({},h,f);break e;case 2:Mi=!0}}null!==s.callback&&0!==s.lane&&(e.flags|=64,null===(f=a.effects)?a.effects=[s]:f.push(s))}else d={eventTime:d,lane:f,tag:s.tag,payload:s.payload,callback:s.callback,next:null},null===l?(c=l=d,u=h):l=l.next=d,o|=f;if(null===(s=s.next)){if(null===(s=a.shared.pending))break;s=(f=s).next,f.next=null,a.lastBaseUpdate=f,a.shared.pending=null}}if(null===l&&(u=h),a.baseState=u,a.firstBaseUpdate=c,a.lastBaseUpdate=l,null!==(t=a.shared.interleaved)){a=t;do{o|=a.lane,a=a.next}while(a!==t)}else null===i&&(a.shared.lanes=0);Lu|=o,e.lanes=o,e.memoizedState=h}}function zi(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(i(191,a));a.call(r)}}}var Bi=(new r.Component).refs;function Ui(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:F({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Vi={isMounted:function(e){return!!(e=e._reactInternals)&&We(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ec(),a=tc(e),i=Di(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Pi(e,i,a))&&(nc(t,e,a,r),Oi(t,e,a))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ec(),a=tc(e),i=Di(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),null!==(t=Pi(e,i,a))&&(nc(t,e,a,r),Oi(t,e,a))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ec(),r=tc(e),a=Di(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),null!==(t=Pi(e,a,r))&&(nc(t,e,r,n),Oi(t,e,r))}};function Wi(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!ur(n,r)||!ur(a,i))}function Gi(e,t,n){var r=!1,a=Ea,i=t.contextType;return"object"===typeof i&&null!==i?i=Ci(i):(a=Ra(t)?Ma:Ia.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?Na(e,a):Ea),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Vi,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function ji(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Vi.enqueueReplaceState(t,t.state,null)}function qi(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=Bi,Ni(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=Ci(i):(i=Ra(t)?Ma:Ia.current,a.context=Na(e,i)),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(Ui(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&Vi.enqueueReplaceState(a,a.state,null),Fi(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}function Hi(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(i(309));var r=n.stateNode}if(!r)throw Error(i(147,e));var a=r,o=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===o?t.ref:(t=function(e){var t=a.refs;t===Bi&&(t=a.refs={}),null===e?delete t[o]:t[o]=e},t._stringRef=o,t)}if("string"!==typeof e)throw Error(i(284));if(!n._owner)throw Error(i(290,e))}return e}function Xi(e,t){throw e=Object.prototype.toString.call(t),Error(i(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function Ki(e){return(0,e._init)(e._payload)}function Yi(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=Dc(e,t)).index=0,e.sibling=null,e}function o(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function u(e,t,n,r){return null===t||6!==t.tag?((t=Fc(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function c(e,t,n,r){var i=n.type;return i===_?h(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===R&&Ki(i)===t.type)?((r=a(t,n.props)).ref=Hi(e,t,n),r.return=e,r):((r=Pc(n.type,n.key,n.props,null,e.mode,r)).ref=Hi(e,t,n),r.return=e,r)}function l(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=zc(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function h(e,t,n,r,i){return null===t||7!==t.tag?((t=Oc(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function f(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=Fc(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case k:return(n=Pc(t.type,t.key,t.props,null,e.mode,n)).ref=Hi(e,null,t),n.return=e,n;case w:return(t=zc(t,e.mode,n)).return=e,t;case R:return f(e,(0,t._init)(t._payload),n)}if(te(t)||O(t))return(t=Oc(t,e.mode,n,null)).return=e,t;Xi(e,t)}return null}function d(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:u(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case k:return n.key===a?c(e,t,n,r):null;case w:return n.key===a?l(e,t,n,r):null;case R:return d(e,t,(a=n._init)(n._payload),r)}if(te(n)||O(n))return null!==a?null:h(e,t,n,r,null);Xi(e,n)}return null}function p(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return u(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case k:return c(t,e=e.get(null===r.key?n:r.key)||null,r,a);case w:return l(t,e=e.get(null===r.key?n:r.key)||null,r,a);case R:return p(e,t,n,(0,r._init)(r._payload),a)}if(te(r)||O(r))return h(t,e=e.get(n)||null,r,a,null);Xi(t,r)}return null}function v(a,i,s,u){for(var c=null,l=null,h=i,v=i=0,m=null;null!==h&&v<s.length;v++){h.index>v?(m=h,h=null):m=h.sibling;var g=d(a,h,s[v],u);if(null===g){null===h&&(h=m);break}e&&h&&null===g.alternate&&t(a,h),i=o(g,i,v),null===l?c=g:l.sibling=g,l=g,h=m}if(v===s.length)return n(a,h),ai&&Ja(a,v),c;if(null===h){for(;v<s.length;v++)null!==(h=f(a,s[v],u))&&(i=o(h,i,v),null===l?c=h:l.sibling=h,l=h);return ai&&Ja(a,v),c}for(h=r(a,h);v<s.length;v++)null!==(m=p(h,a,v,s[v],u))&&(e&&null!==m.alternate&&h.delete(null===m.key?v:m.key),i=o(m,i,v),null===l?c=m:l.sibling=m,l=m);return e&&h.forEach((function(e){return t(a,e)})),ai&&Ja(a,v),c}function m(a,s,u,c){var l=O(u);if("function"!==typeof l)throw Error(i(150));if(null==(u=l.call(u)))throw Error(i(151));for(var h=l=null,v=s,m=s=0,g=null,y=u.next();null!==v&&!y.done;m++,y=u.next()){v.index>m?(g=v,v=null):g=v.sibling;var b=d(a,v,y.value,c);if(null===b){null===v&&(v=g);break}e&&v&&null===b.alternate&&t(a,v),s=o(b,s,m),null===h?l=b:h.sibling=b,h=b,v=g}if(y.done)return n(a,v),ai&&Ja(a,m),l;if(null===v){for(;!y.done;m++,y=u.next())null!==(y=f(a,y.value,c))&&(s=o(y,s,m),null===h?l=y:h.sibling=y,h=y);return ai&&Ja(a,m),l}for(v=r(a,v);!y.done;m++,y=u.next())null!==(y=p(v,a,m,y.value,c))&&(e&&null!==y.alternate&&v.delete(null===y.key?m:y.key),s=o(y,s,m),null===h?l=y:h.sibling=y,h=y);return e&&v.forEach((function(e){return t(a,e)})),ai&&Ja(a,m),l}return function e(r,i,o,u){if("object"===typeof o&&null!==o&&o.type===_&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case k:e:{for(var c=o.key,l=i;null!==l;){if(l.key===c){if((c=o.type)===_){if(7===l.tag){n(r,l.sibling),(i=a(l,o.props.children)).return=r,r=i;break e}}else if(l.elementType===c||"object"===typeof c&&null!==c&&c.$$typeof===R&&Ki(c)===l.type){n(r,l.sibling),(i=a(l,o.props)).ref=Hi(r,l,o),i.return=r,r=i;break e}n(r,l);break}t(r,l),l=l.sibling}o.type===_?((i=Oc(o.props.children,r.mode,u,o.key)).return=r,r=i):((u=Pc(o.type,o.key,o.props,null,r.mode,u)).ref=Hi(r,i,o),u.return=r,r=u)}return s(r);case w:e:{for(l=o.key;null!==i;){if(i.key===l){if(4===i.tag&&i.stateNode.containerInfo===o.containerInfo&&i.stateNode.implementation===o.implementation){n(r,i.sibling),(i=a(i,o.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=zc(o,r.mode,u)).return=r,r=i}return s(r);case R:return e(r,i,(l=o._init)(o._payload),u)}if(te(o))return v(r,i,o,u);if(O(o))return m(r,i,o,u);Xi(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==i&&6===i.tag?(n(r,i.sibling),(i=a(i,o)).return=r,r=i):(n(r,i),(i=Fc(o,r.mode,u)).return=r,r=i),s(r)):n(r,i)}}var Qi=Yi(!0),Zi=Yi(!1),Ji={},$i=Sa(Ji),eo=Sa(Ji),to=Sa(Ji);function no(e){if(e===Ji)throw Error(i(174));return e}function ro(e,t){switch(Ta(to,t),Ta(eo,e),Ta($i,Ji),e=t.nodeType){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ue(null,"");break;default:t=ue(t=(e=8===e?t.parentNode:t).namespaceURI||null,e=e.tagName)}Ca($i),Ta($i,t)}function ao(){Ca($i),Ca(eo),Ca(to)}function io(e){no(to.current);var t=no($i.current),n=ue(t,e.type);t!==n&&(Ta(eo,e),Ta($i,n))}function oo(e){eo.current===e&&(Ca($i),Ca(eo))}var so=Sa(0);function uo(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||"$?"===n.data||"$!"===n.data))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var co=[];function lo(){for(var e=0;e<co.length;e++)co[e]._workInProgressVersionPrimary=null;co.length=0}var ho=x.ReactCurrentDispatcher,fo=x.ReactCurrentBatchConfig,po=0,vo=null,mo=null,go=null,yo=!1,bo=!1,xo=0,ko=0;function wo(){throw Error(i(321))}function _o(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!sr(e[n],t[n]))return!1;return!0}function So(e,t,n,r,a,o){if(po=o,vo=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ho.current=null===e||null===e.memoizedState?ss:us,e=n(r,a),bo){o=0;do{if(bo=!1,xo=0,25<=o)throw Error(i(301));o+=1,go=mo=null,t.updateQueue=null,ho.current=cs,e=n(r,a)}while(bo)}if(ho.current=os,t=null!==mo&&null!==mo.next,po=0,go=mo=vo=null,yo=!1,t)throw Error(i(300));return e}function Co(){var e=0!==xo;return xo=0,e}function To(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===go?vo.memoizedState=go=e:go=go.next=e,go}function Eo(){if(null===mo){var e=vo.alternate;e=null!==e?e.memoizedState:null}else e=mo.next;var t=null===go?vo.memoizedState:go.next;if(null!==t)go=t,mo=e;else{if(null===e)throw Error(i(310));e={memoizedState:(mo=e).memoizedState,baseState:mo.baseState,baseQueue:mo.baseQueue,queue:mo.queue,next:null},null===go?vo.memoizedState=go=e:go=go.next=e}return go}function Io(e,t){return"function"===typeof t?t(e):t}function Ao(e){var t=Eo(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=mo,a=r.baseQueue,o=n.pending;if(null!==o){if(null!==a){var s=a.next;a.next=o.next,o.next=s}r.baseQueue=a=o,n.pending=null}if(null!==a){o=a.next,r=r.baseState;var u=s=null,c=null,l=o;do{var h=l.lane;if((po&h)===h)null!==c&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var f={lane:h,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===c?(u=c=f,s=r):c=c.next=f,vo.lanes|=h,Lu|=h}l=l.next}while(null!==l&&l!==o);null===c?s=r:c.next=u,sr(r,t.memoizedState)||(xs=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{o=a.lane,vo.lanes|=o,Lu|=o,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function Mo(e){var t=Eo(),n=t.queue;if(null===n)throw Error(i(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,o=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{o=e(o,s.action),s=s.next}while(s!==a);sr(o,t.memoizedState)||(xs=!0),t.memoizedState=o,null===t.baseQueue&&(t.baseState=o),n.lastRenderedState=o}return[o,r]}function No(){}function Ro(e,t){var n=vo,r=Eo(),a=t(),o=!sr(r.memoizedState,a);if(o&&(r.memoizedState=a,xs=!0),r=r.queue,jo(Oo.bind(null,n,r,e),[e]),r.getSnapshot!==t||o||null!==go&&1&go.memoizedState.tag){if(n.flags|=2048,Bo(9,Po.bind(null,n,r,a,t),void 0,null),null===Au)throw Error(i(349));0!==(30&po)||Do(n,t,a)}return a}function Do(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=vo.updateQueue)?(t={lastEffect:null,stores:null},vo.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Po(e,t,n,r){t.value=n,t.getSnapshot=r,Lo(t)&&Fo(e)}function Oo(e,t,n){return n((function(){Lo(t)&&Fo(e)}))}function Lo(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!sr(e,n)}catch(r){return!0}}function Fo(e){var t=Ai(e,1);null!==t&&nc(t,e,1,-1)}function zo(e){var t=To();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Io,lastRenderedState:e},t.queue=e,e=e.dispatch=ns.bind(null,vo,e),[t.memoizedState,e]}function Bo(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=vo.updateQueue)?(t={lastEffect:null,stores:null},vo.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Uo(){return Eo().memoizedState}function Vo(e,t,n,r){var a=To();vo.flags|=e,a.memoizedState=Bo(1|t,n,void 0,void 0===r?null:r)}function Wo(e,t,n,r){var a=Eo();r=void 0===r?null:r;var i=void 0;if(null!==mo){var o=mo.memoizedState;if(i=o.destroy,null!==r&&_o(r,o.deps))return void(a.memoizedState=Bo(t,n,i,r))}vo.flags|=e,a.memoizedState=Bo(1|t,n,i,r)}function Go(e,t){return Vo(8390656,8,e,t)}function jo(e,t){return Wo(2048,8,e,t)}function qo(e,t){return Wo(4,2,e,t)}function Ho(e,t){return Wo(4,4,e,t)}function Xo(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function Ko(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Wo(4,4,Xo.bind(null,t,e),n)}function Yo(){}function Qo(e,t){var n=Eo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&_o(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function Zo(e,t){var n=Eo();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&_o(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function Jo(e,t,n){return 0===(21&po)?(e.baseState&&(e.baseState=!1,xs=!0),e.memoizedState=n):(sr(n,t)||(n=vt(),vo.lanes|=n,Lu|=n,e.baseState=!0),t)}function $o(e,t){var n=bt;bt=0!==n&&4>n?n:4,e(!0);var r=fo.transition;fo.transition={};try{e(!1),t()}finally{bt=n,fo.transition=r}}function es(){return Eo().memoizedState}function ts(e,t,n){var r=tc(e);if(n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},rs(e))as(t,n);else if(null!==(n=Ii(e,t,n,r))){nc(n,e,r,ec()),is(n,t,r)}}function ns(e,t,n){var r=tc(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(rs(e))as(t,a);else{var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=i(o,n);if(a.hasEagerState=!0,a.eagerState=s,sr(s,o)){var u=t.interleaved;return null===u?(a.next=a,Ei(t)):(a.next=u.next,u.next=a),void(t.interleaved=a)}}catch(c){}null!==(n=Ii(e,t,a,r))&&(nc(n,e,r,a=ec()),is(n,t,r))}}function rs(e){var t=e.alternate;return e===vo||null!==t&&t===vo}function as(e,t){bo=yo=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function is(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,yt(e,n)}}var os={readContext:Ci,useCallback:wo,useContext:wo,useEffect:wo,useImperativeHandle:wo,useInsertionEffect:wo,useLayoutEffect:wo,useMemo:wo,useReducer:wo,useRef:wo,useState:wo,useDebugValue:wo,useDeferredValue:wo,useTransition:wo,useMutableSource:wo,useSyncExternalStore:wo,useId:wo,unstable_isNewReconciler:!1},ss={readContext:Ci,useCallback:function(e,t){return To().memoizedState=[e,void 0===t?null:t],e},useContext:Ci,useEffect:Go,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Vo(4194308,4,Xo.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Vo(4194308,4,e,t)},useInsertionEffect:function(e,t){return Vo(4,2,e,t)},useMemo:function(e,t){var n=To();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=To();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=ts.bind(null,vo,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},To().memoizedState=e},useState:zo,useDebugValue:Yo,useDeferredValue:function(e){return To().memoizedState=e},useTransition:function(){var e=zo(!1),t=e[0];return e=$o.bind(null,e[1]),To().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=vo,a=To();if(ai){if(void 0===n)throw Error(i(407));n=n()}else{if(n=t(),null===Au)throw Error(i(349));0!==(30&po)||Do(r,t,n)}a.memoizedState=n;var o={value:n,getSnapshot:t};return a.queue=o,Go(Oo.bind(null,r,o,e),[e]),r.flags|=2048,Bo(9,Po.bind(null,r,o,n,t),void 0,null),n},useId:function(){var e=To(),t=Au.identifierPrefix;if(ai){var n=Za;t=":"+t+"R"+(n=(Qa&~(1<<32-ot(Qa)-1)).toString(32)+n),0<(n=xo++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=ko++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},us={readContext:Ci,useCallback:Qo,useContext:Ci,useEffect:jo,useImperativeHandle:Ko,useInsertionEffect:qo,useLayoutEffect:Ho,useMemo:Zo,useReducer:Ao,useRef:Uo,useState:function(){return Ao(Io)},useDebugValue:Yo,useDeferredValue:function(e){return Jo(Eo(),mo.memoizedState,e)},useTransition:function(){return[Ao(Io)[0],Eo().memoizedState]},useMutableSource:No,useSyncExternalStore:Ro,useId:es,unstable_isNewReconciler:!1},cs={readContext:Ci,useCallback:Qo,useContext:Ci,useEffect:jo,useImperativeHandle:Ko,useInsertionEffect:qo,useLayoutEffect:Ho,useMemo:Zo,useReducer:Mo,useRef:Uo,useState:function(){return Mo(Io)},useDebugValue:Yo,useDeferredValue:function(e){var t=Eo();return null===mo?t.memoizedState=e:Jo(t,mo.memoizedState,e)},useTransition:function(){return[Mo(Io)[0],Eo().memoizedState]},useMutableSource:No,useSyncExternalStore:Ro,useId:es,unstable_isNewReconciler:!1};function ls(e,t){try{var n="",r=t;do{n+=V(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a,digest:null}}function hs(e,t,n){return{value:e,source:null,stack:null!=n?n:null,digest:null!=t?t:null}}function fs(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ds="function"===typeof WeakMap?WeakMap:Map;function ps(e,t,n){(n=Di(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){ju||(ju=!0,qu=r),fs(0,t)},n}function vs(e,t,n){(n=Di(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){fs(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){fs(0,t),"function"!==typeof r&&(null===Hu?Hu=new Set([this]):Hu.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function ms(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new ds;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Cc.bind(null,e,t,n),t.then(e,e))}function gs(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function ys(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=Di(-1,1)).tag=2,Pi(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}var bs=x.ReactCurrentOwner,xs=!1;function ks(e,t,n,r){t.child=null===e?Zi(t,null,n,r):Qi(t,e.child,n,r)}function ws(e,t,n,r,a){n=n.render;var i=t.ref;return Si(t,a),r=So(e,t,n,r,i,a),n=Co(),null===e||xs?(ai&&n&&ei(t),t.flags|=1,ks(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,js(e,t,a))}function _s(e,t,n,r,a){if(null===e){var i=n.type;return"function"!==typeof i||Rc(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=Pc(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Ss(e,t,i,r,a))}if(i=e.child,0===(e.lanes&a)){var o=i.memoizedProps;if((n=null!==(n=n.compare)?n:ur)(o,r)&&e.ref===t.ref)return js(e,t,a)}return t.flags|=1,(e=Dc(i,r)).ref=t.ref,e.return=t,t.child=e}function Ss(e,t,n,r,a){if(null!==e){var i=e.memoizedProps;if(ur(i,r)&&e.ref===t.ref){if(xs=!1,t.pendingProps=r=i,0===(e.lanes&a))return t.lanes=e.lanes,js(e,t,a);0!==(131072&e.flags)&&(xs=!0)}}return Es(e,t,n,r,a)}function Cs(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null,transitions:null},Ta(Du,Ru),Ru|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,Ta(Du,Ru),Ru|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},r=null!==i?i.baseLanes:n,Ta(Du,Ru),Ru|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,Ta(Du,Ru),Ru|=r;return ks(e,t,a,n),t.child}function Ts(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Es(e,t,n,r,a){var i=Ra(n)?Ma:Ia.current;return i=Na(t,i),Si(t,a),n=So(e,t,n,r,i,a),r=Co(),null===e||xs?(ai&&r&&ei(t),t.flags|=1,ks(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,js(e,t,a))}function Is(e,t,n,r,a){if(Ra(n)){var i=!0;La(t)}else i=!1;if(Si(t,a),null===t.stateNode)Gs(e,t),Gi(t,n,r),qi(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=Ci(c):c=Na(t,c=Ra(n)?Ma:Ia.current);var l=n.getDerivedStateFromProps,h="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==c)&&ji(t,o,r,c),Mi=!1;var f=t.memoizedState;o.state=f,Fi(t,r,o,a),u=t.memoizedState,s!==r||f!==u||Aa.current||Mi?("function"===typeof l&&(Ui(t,n,l,r),u=t.memoizedState),(s=Mi||Wi(t,n,s,r,f,u,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,Ri(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:mi(t.type,s),o.props=c,h=t.pendingProps,f=o.context,"object"===typeof(u=n.contextType)&&null!==u?u=Ci(u):u=Na(t,u=Ra(n)?Ma:Ia.current);var d=n.getDerivedStateFromProps;(l="function"===typeof d||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||f!==u)&&ji(t,o,r,u),Mi=!1,f=t.memoizedState,o.state=f,Fi(t,r,o,a);var p=t.memoizedState;s!==h||f!==p||Aa.current||Mi?("function"===typeof d&&(Ui(t,n,d,r),p=t.memoizedState),(c=Mi||Wi(t,n,c,r,f,p,u)||!1)?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=u,r=c):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return As(e,t,n,r,i,a)}function As(e,t,n,r,a,i){Ts(e,t);var o=0!==(128&t.flags);if(!r&&!o)return a&&Fa(t,n,!1),js(e,t,i);r=t.stateNode,bs.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=Qi(t,e.child,null,i),t.child=Qi(t,null,s,i)):ks(e,t,s,i),t.memoizedState=r.state,a&&Fa(t,n,!0),t.child}function Ms(e){var t=e.stateNode;t.pendingContext?Pa(0,t.pendingContext,t.pendingContext!==t.context):t.context&&Pa(0,t.context,!1),ro(e,t.containerInfo)}function Ns(e,t,n,r,a){return di(),pi(a),t.flags|=256,ks(e,t,n,r),t.child}var Rs,Ds,Ps,Os={dehydrated:null,treeContext:null,retryLane:0};function Ls(e){return{baseLanes:e,cachePool:null,transitions:null}}function Fs(e,t,n){var r,a=t.pendingProps,o=so.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&o)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(o|=1),Ta(so,1&o),null===e)return ci(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:"$!"===e.data?t.lanes=8:t.lanes=1073741824,null):(u=a.children,e=a.fallback,s?(a=t.mode,s=t.child,u={mode:"hidden",children:u},0===(1&a)&&null!==s?(s.childLanes=0,s.pendingProps=u):s=Lc(u,a,0,null),e=Oc(e,a,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ls(n),t.memoizedState=Os,e):zs(t,u));if(null!==(o=e.memoizedState)&&null!==(r=o.dehydrated))return function(e,t,n,r,a,o,s){if(n)return 256&t.flags?(t.flags&=-257,Bs(e,t,s,r=hs(Error(i(422))))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(o=r.fallback,a=t.mode,r=Lc({mode:"visible",children:r.children},a,0,null),(o=Oc(o,a,s,null)).flags|=2,r.return=t,o.return=t,r.sibling=o,t.child=r,0!==(1&t.mode)&&Qi(t,e.child,null,s),t.child.memoizedState=Ls(s),t.memoizedState=Os,o);if(0===(1&t.mode))return Bs(e,t,s,null);if("$!"===a.data){if(r=a.nextSibling&&a.nextSibling.dataset)var u=r.dgst;return r=u,Bs(e,t,s,r=hs(o=Error(i(419)),r,void 0))}if(u=0!==(s&e.childLanes),xs||u){if(null!==(r=Au)){switch(s&-s){case 4:a=2;break;case 16:a=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:a=32;break;case 536870912:a=268435456;break;default:a=0}0!==(a=0!==(a&(r.suspendedLanes|s))?0:a)&&a!==o.retryLane&&(o.retryLane=a,Ai(e,a),nc(r,e,a,-1))}return vc(),Bs(e,t,s,r=hs(Error(i(421))))}return"$?"===a.data?(t.flags|=128,t.child=e.child,t=Ec.bind(null,e),a._reactRetry=t,null):(e=o.treeContext,ri=ca(a.nextSibling),ni=t,ai=!0,ii=null,null!==e&&(Xa[Ka++]=Qa,Xa[Ka++]=Za,Xa[Ka++]=Ya,Qa=e.id,Za=e.overflow,Ya=t),(t=zs(t,r.children)).flags|=4096,t)}(e,t,u,a,r,o,n);if(s){s=a.fallback,u=t.mode,r=(o=e.child).sibling;var c={mode:"hidden",children:a.children};return 0===(1&u)&&t.child!==o?((a=t.child).childLanes=0,a.pendingProps=c,t.deletions=null):(a=Dc(o,c)).subtreeFlags=14680064&o.subtreeFlags,null!==r?s=Dc(r,s):(s=Oc(s,u,n,null)).flags|=2,s.return=t,a.return=t,a.sibling=s,t.child=a,a=s,s=t.child,u=null===(u=e.child.memoizedState)?Ls(n):{baseLanes:u.baseLanes|n,cachePool:null,transitions:u.transitions},s.memoizedState=u,s.childLanes=e.childLanes&~n,t.memoizedState=Os,a}return e=(s=e.child).sibling,a=Dc(s,{mode:"visible",children:a.children}),0===(1&t.mode)&&(a.lanes=n),a.return=t,a.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=a,t.memoizedState=null,a}function zs(e,t){return(t=Lc({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Bs(e,t,n,r){return null!==r&&pi(r),Qi(t,e.child,null,n),(e=zs(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function Us(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),_i(e.return,t,n)}function Vs(e,t,n,r,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function Ws(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(ks(e,t,r.children,n),0!==(2&(r=so.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&Us(e,n,t);else if(19===e.tag)Us(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(Ta(so,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===uo(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),Vs(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===uo(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}Vs(t,!0,n,null,i);break;case"together":Vs(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Gs(e,t){0===(1&t.mode)&&null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2)}function js(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),Lu|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(i(153));if(null!==t.child){for(n=Dc(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=Dc(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function qs(e,t){if(!ai)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Hs(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Xs(e,t,n){var r=t.pendingProps;switch(ti(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Hs(t),null;case 1:case 17:return Ra(t.type)&&Da(),Hs(t),null;case 3:return r=t.stateNode,ao(),Ca(Aa),Ca(Ia),lo(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(hi(t)?t.flags|=4:null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==ii&&(oc(ii),ii=null))),Hs(t),null;case 5:oo(t);var a=no(to.current);if(n=t.type,null!==e&&null!=t.stateNode)Ds(e,t,n,r),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(i(166));return Hs(t),null}if(e=no($i.current),hi(t)){r=t.stateNode,n=t.type;var o=t.memoizedProps;switch(r[fa]=t,r[da]=o,e=0!==(1&t.mode),n){case"dialog":Br("cancel",r),Br("close",r);break;case"iframe":case"object":case"embed":Br("load",r);break;case"video":case"audio":for(a=0;a<Or.length;a++)Br(Or[a],r);break;case"source":Br("error",r);break;case"img":case"image":case"link":Br("error",r),Br("load",r);break;case"details":Br("toggle",r);break;case"input":Q(r,o),Br("invalid",r);break;case"select":r._wrapperState={wasMultiple:!!o.multiple},Br("invalid",r);break;case"textarea":ae(r,o),Br("invalid",r)}for(var u in ye(n,o),a=null,o)if(o.hasOwnProperty(u)){var c=o[u];"children"===u?"string"===typeof c?r.textContent!==c&&(!0!==o.suppressHydrationWarning&&Jr(r.textContent,c,e),a=["children",c]):"number"===typeof c&&r.textContent!==""+c&&(!0!==o.suppressHydrationWarning&&Jr(r.textContent,c,e),a=["children",""+c]):s.hasOwnProperty(u)&&null!=c&&"onScroll"===u&&Br("scroll",r)}switch(n){case"input":H(r),$(r,o,!0);break;case"textarea":H(r),oe(r);break;case"select":case"option":break;default:"function"===typeof o.onClick&&(r.onclick=$r)}r=a,t.updateQueue=r,null!==r&&(t.flags|=4)}else{u=9===a.nodeType?a:a.ownerDocument,"http://www.w3.org/1999/xhtml"===e&&(e=se(n)),"http://www.w3.org/1999/xhtml"===e?"script"===n?((e=u.createElement("div")).innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):"string"===typeof r.is?e=u.createElement(n,{is:r.is}):(e=u.createElement(n),"select"===n&&(u=e,r.multiple?u.multiple=!0:r.size&&(u.size=r.size))):e=u.createElementNS(e,n),e[fa]=t,e[da]=r,Rs(e,t),t.stateNode=e;e:{switch(u=be(n,r),n){case"dialog":Br("cancel",e),Br("close",e),a=r;break;case"iframe":case"object":case"embed":Br("load",e),a=r;break;case"video":case"audio":for(a=0;a<Or.length;a++)Br(Or[a],e);a=r;break;case"source":Br("error",e),a=r;break;case"img":case"image":case"link":Br("error",e),Br("load",e),a=r;break;case"details":Br("toggle",e),a=r;break;case"input":Q(e,r),a=Y(e,r),Br("invalid",e);break;case"option":default:a=r;break;case"select":e._wrapperState={wasMultiple:!!r.multiple},a=F({},r,{value:void 0}),Br("invalid",e);break;case"textarea":ae(e,r),a=re(e,r),Br("invalid",e)}for(o in ye(n,a),c=a)if(c.hasOwnProperty(o)){var l=c[o];"style"===o?me(e,l):"dangerouslySetInnerHTML"===o?null!=(l=l?l.__html:void 0)&&he(e,l):"children"===o?"string"===typeof l?("textarea"!==n||""!==l)&&fe(e,l):"number"===typeof l&&fe(e,""+l):"suppressContentEditableWarning"!==o&&"suppressHydrationWarning"!==o&&"autoFocus"!==o&&(s.hasOwnProperty(o)?null!=l&&"onScroll"===o&&Br("scroll",e):null!=l&&b(e,o,l,u))}switch(n){case"input":H(e),$(e,r,!1);break;case"textarea":H(e),oe(e);break;case"option":null!=r.value&&e.setAttribute("value",""+j(r.value));break;case"select":e.multiple=!!r.multiple,null!=(o=r.value)?ne(e,!!r.multiple,o,!1):null!=r.defaultValue&&ne(e,!!r.multiple,r.defaultValue,!0);break;default:"function"===typeof a.onClick&&(e.onclick=$r)}switch(n){case"button":case"input":case"select":case"textarea":r=!!r.autoFocus;break e;case"img":r=!0;break e;default:r=!1}}r&&(t.flags|=4)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Hs(t),null;case 6:if(e&&null!=t.stateNode)Ps(0,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(i(166));if(n=no(to.current),no($i.current),hi(t)){if(r=t.stateNode,n=t.memoizedProps,r[fa]=t,(o=r.nodeValue!==n)&&null!==(e=ni))switch(e.tag){case 3:Jr(r.nodeValue,n,0!==(1&e.mode));break;case 5:!0!==e.memoizedProps.suppressHydrationWarning&&Jr(r.nodeValue,n,0!==(1&e.mode))}o&&(t.flags|=4)}else(r=(9===n.nodeType?n:n.ownerDocument).createTextNode(r))[fa]=t,t.stateNode=r}return Hs(t),null;case 13:if(Ca(so),r=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(ai&&null!==ri&&0!==(1&t.mode)&&0===(128&t.flags))fi(),di(),t.flags|=98560,o=!1;else if(o=hi(t),null!==r&&null!==r.dehydrated){if(null===e){if(!o)throw Error(i(318));if(!(o=null!==(o=t.memoizedState)?o.dehydrated:null))throw Error(i(317));o[fa]=t}else di(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;Hs(t),o=!1}else null!==ii&&(oc(ii),ii=null),o=!0;if(!o)return 65536&t.flags?t:null}return 0!==(128&t.flags)?(t.lanes=n,t):((r=null!==r)!==(null!==e&&null!==e.memoizedState)&&r&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&so.current)?0===Pu&&(Pu=3):vc())),null!==t.updateQueue&&(t.flags|=4),Hs(t),null);case 4:return ao(),null===e&&Wr(t.stateNode.containerInfo),Hs(t),null;case 10:return wi(t.type._context),Hs(t),null;case 19:if(Ca(so),null===(o=t.memoizedState))return Hs(t),null;if(r=0!==(128&t.flags),null===(u=o.rendering))if(r)qs(o,!1);else{if(0!==Pu||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(u=uo(e))){for(t.flags|=128,qs(o,!1),null!==(r=u.updateQueue)&&(t.updateQueue=r,t.flags|=4),t.subtreeFlags=0,r=n,n=t.child;null!==n;)e=r,(o=n).flags&=14680066,null===(u=o.alternate)?(o.childLanes=0,o.lanes=e,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=u.childLanes,o.lanes=u.lanes,o.child=u.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=u.memoizedProps,o.memoizedState=u.memoizedState,o.updateQueue=u.updateQueue,o.type=u.type,e=u.dependencies,o.dependencies=null===e?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return Ta(so,1&so.current|2),t.child}e=e.sibling}null!==o.tail&&Ze()>Wu&&(t.flags|=128,r=!0,qs(o,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=uo(u))){if(t.flags|=128,r=!0,null!==(n=e.updateQueue)&&(t.updateQueue=n,t.flags|=4),qs(o,!0),null===o.tail&&"hidden"===o.tailMode&&!u.alternate&&!ai)return Hs(t),null}else 2*Ze()-o.renderingStartTime>Wu&&1073741824!==n&&(t.flags|=128,r=!0,qs(o,!1),t.lanes=4194304);o.isBackwards?(u.sibling=t.child,t.child=u):(null!==(n=o.last)?n.sibling=u:t.child=u,o.last=u)}return null!==o.tail?(t=o.tail,o.rendering=t,o.tail=t.sibling,o.renderingStartTime=Ze(),t.sibling=null,n=so.current,Ta(so,r?1&n|2:1&n),t):(Hs(t),null);case 22:case 23:return hc(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Ru)&&(Hs(t),6&t.subtreeFlags&&(t.flags|=8192)):Hs(t),null;case 24:case 25:return null}throw Error(i(156,t.tag))}function Ks(e,t){switch(ti(t),t.tag){case 1:return Ra(t.type)&&Da(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ao(),Ca(Aa),Ca(Ia),lo(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return oo(t),null;case 13:if(Ca(so),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(i(340));di()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return Ca(so),null;case 4:return ao(),null;case 10:return wi(t.type._context),null;case 22:case 23:return hc(),null;default:return null}}Rs=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)e.appendChild(n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},Ds=function(e,t,n,r){var a=e.memoizedProps;if(a!==r){e=t.stateNode,no($i.current);var i,o=null;switch(n){case"input":a=Y(e,a),r=Y(e,r),o=[];break;case"select":a=F({},a,{value:void 0}),r=F({},r,{value:void 0}),o=[];break;case"textarea":a=re(e,a),r=re(e,r),o=[];break;default:"function"!==typeof a.onClick&&"function"===typeof r.onClick&&(e.onclick=$r)}for(l in ye(n,r),n=null,a)if(!r.hasOwnProperty(l)&&a.hasOwnProperty(l)&&null!=a[l])if("style"===l){var u=a[l];for(i in u)u.hasOwnProperty(i)&&(n||(n={}),n[i]="")}else"dangerouslySetInnerHTML"!==l&&"children"!==l&&"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&"autoFocus"!==l&&(s.hasOwnProperty(l)?o||(o=[]):(o=o||[]).push(l,null));for(l in r){var c=r[l];if(u=null!=a?a[l]:void 0,r.hasOwnProperty(l)&&c!==u&&(null!=c||null!=u))if("style"===l)if(u){for(i in u)!u.hasOwnProperty(i)||c&&c.hasOwnProperty(i)||(n||(n={}),n[i]="");for(i in c)c.hasOwnProperty(i)&&u[i]!==c[i]&&(n||(n={}),n[i]=c[i])}else n||(o||(o=[]),o.push(l,n)),n=c;else"dangerouslySetInnerHTML"===l?(c=c?c.__html:void 0,u=u?u.__html:void 0,null!=c&&u!==c&&(o=o||[]).push(l,c)):"children"===l?"string"!==typeof c&&"number"!==typeof c||(o=o||[]).push(l,""+c):"suppressContentEditableWarning"!==l&&"suppressHydrationWarning"!==l&&(s.hasOwnProperty(l)?(null!=c&&"onScroll"===l&&Br("scroll",e),o||u===c||(o=[])):(o=o||[]).push(l,c))}n&&(o=o||[]).push("style",n);var l=o;(t.updateQueue=l)&&(t.flags|=4)}},Ps=function(e,t,n,r){n!==r&&(t.flags|=4)};var Ys=!1,Qs=!1,Zs="function"===typeof WeakSet?WeakSet:Set,Js=null;function $s(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){Sc(e,t,r)}else n.current=null}function eu(e,t,n){try{n()}catch(r){Sc(e,t,r)}}var tu=!1;function nu(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,void 0!==i&&eu(t,n,i)}a=a.next}while(a!==r)}}function ru(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function au(e){var t=e.ref;if(null!==t){var n=e.stateNode;e.tag,e=n,"function"===typeof t?t(e):t.current=e}}function iu(e){var t=e.alternate;null!==t&&(e.alternate=null,iu(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&(delete t[fa],delete t[da],delete t[va],delete t[ma],delete t[ga])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function ou(e){return 5===e.tag||3===e.tag||4===e.tag}function su(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||ou(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function uu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?8===n.nodeType?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(8===n.nodeType?(t=n.parentNode).insertBefore(e,n):(t=n).appendChild(e),null!==(n=n._reactRootContainer)&&void 0!==n||null!==t.onclick||(t.onclick=$r));else if(4!==r&&null!==(e=e.child))for(uu(e,t,n),e=e.sibling;null!==e;)uu(e,t,n),e=e.sibling}function cu(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(4!==r&&null!==(e=e.child))for(cu(e,t,n),e=e.sibling;null!==e;)cu(e,t,n),e=e.sibling}var lu=null,hu=!1;function fu(e,t,n){for(n=n.child;null!==n;)du(e,t,n),n=n.sibling}function du(e,t,n){if(it&&"function"===typeof it.onCommitFiberUnmount)try{it.onCommitFiberUnmount(at,n)}catch(s){}switch(n.tag){case 5:Qs||$s(n,t);case 6:var r=lu,a=hu;lu=null,fu(e,t,n),hu=a,null!==(lu=r)&&(hu?(e=lu,n=n.stateNode,8===e.nodeType?e.parentNode.removeChild(n):e.removeChild(n)):lu.removeChild(n.stateNode));break;case 18:null!==lu&&(hu?(e=lu,n=n.stateNode,8===e.nodeType?ua(e.parentNode,n):1===e.nodeType&&ua(e,n),Wt(e)):ua(lu,n.stateNode));break;case 4:r=lu,a=hu,lu=n.stateNode.containerInfo,hu=!0,fu(e,t,n),lu=r,hu=a;break;case 0:case 11:case 14:case 15:if(!Qs&&(null!==(r=n.updateQueue)&&null!==(r=r.lastEffect))){a=r=r.next;do{var i=a,o=i.destroy;i=i.tag,void 0!==o&&(0!==(2&i)||0!==(4&i))&&eu(n,t,o),a=a.next}while(a!==r)}fu(e,t,n);break;case 1:if(!Qs&&($s(n,t),"function"===typeof(r=n.stateNode).componentWillUnmount))try{r.props=n.memoizedProps,r.state=n.memoizedState,r.componentWillUnmount()}catch(s){Sc(n,t,s)}fu(e,t,n);break;case 21:fu(e,t,n);break;case 22:1&n.mode?(Qs=(r=Qs)||null!==n.memoizedState,fu(e,t,n),Qs=r):fu(e,t,n);break;default:fu(e,t,n)}}function pu(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new Zs),t.forEach((function(t){var r=Ic.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function vu(e,t){var n=t.deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var o=e,s=t,u=s;e:for(;null!==u;){switch(u.tag){case 5:lu=u.stateNode,hu=!1;break e;case 3:case 4:lu=u.stateNode.containerInfo,hu=!0;break e}u=u.return}if(null===lu)throw Error(i(160));du(o,s,a),lu=null,hu=!1;var c=a.alternate;null!==c&&(c.return=null),a.return=null}catch(l){Sc(a,t,l)}}if(12854&t.subtreeFlags)for(t=t.child;null!==t;)mu(t,e),t=t.sibling}function mu(e,t){var n=e.alternate,r=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(vu(t,e),gu(e),4&r){try{nu(3,e,e.return),ru(3,e)}catch(m){Sc(e,e.return,m)}try{nu(5,e,e.return)}catch(m){Sc(e,e.return,m)}}break;case 1:vu(t,e),gu(e),512&r&&null!==n&&$s(n,n.return);break;case 5:if(vu(t,e),gu(e),512&r&&null!==n&&$s(n,n.return),32&e.flags){var a=e.stateNode;try{fe(a,"")}catch(m){Sc(e,e.return,m)}}if(4&r&&null!=(a=e.stateNode)){var o=e.memoizedProps,s=null!==n?n.memoizedProps:o,u=e.type,c=e.updateQueue;if(e.updateQueue=null,null!==c)try{"input"===u&&"radio"===o.type&&null!=o.name&&Z(a,o),be(u,s);var l=be(u,o);for(s=0;s<c.length;s+=2){var h=c[s],f=c[s+1];"style"===h?me(a,f):"dangerouslySetInnerHTML"===h?he(a,f):"children"===h?fe(a,f):b(a,h,f,l)}switch(u){case"input":J(a,o);break;case"textarea":ie(a,o);break;case"select":var d=a._wrapperState.wasMultiple;a._wrapperState.wasMultiple=!!o.multiple;var p=o.value;null!=p?ne(a,!!o.multiple,p,!1):d!==!!o.multiple&&(null!=o.defaultValue?ne(a,!!o.multiple,o.defaultValue,!0):ne(a,!!o.multiple,o.multiple?[]:"",!1))}a[da]=o}catch(m){Sc(e,e.return,m)}}break;case 6:if(vu(t,e),gu(e),4&r){if(null===e.stateNode)throw Error(i(162));a=e.stateNode,o=e.memoizedProps;try{a.nodeValue=o}catch(m){Sc(e,e.return,m)}}break;case 3:if(vu(t,e),gu(e),4&r&&null!==n&&n.memoizedState.isDehydrated)try{Wt(t.containerInfo)}catch(m){Sc(e,e.return,m)}break;case 4:default:vu(t,e),gu(e);break;case 13:vu(t,e),gu(e),8192&(a=e.child).flags&&(o=null!==a.memoizedState,a.stateNode.isHidden=o,!o||null!==a.alternate&&null!==a.alternate.memoizedState||(Vu=Ze())),4&r&&pu(e);break;case 22:if(h=null!==n&&null!==n.memoizedState,1&e.mode?(Qs=(l=Qs)||h,vu(t,e),Qs=l):vu(t,e),gu(e),8192&r){if(l=null!==e.memoizedState,(e.stateNode.isHidden=l)&&!h&&0!==(1&e.mode))for(Js=e,h=e.child;null!==h;){for(f=Js=h;null!==Js;){switch(p=(d=Js).child,d.tag){case 0:case 11:case 14:case 15:nu(4,d,d.return);break;case 1:$s(d,d.return);var v=d.stateNode;if("function"===typeof v.componentWillUnmount){r=d,n=d.return;try{t=r,v.props=t.memoizedProps,v.state=t.memoizedState,v.componentWillUnmount()}catch(m){Sc(r,n,m)}}break;case 5:$s(d,d.return);break;case 22:if(null!==d.memoizedState){ku(f);continue}}null!==p?(p.return=d,Js=p):ku(f)}h=h.sibling}e:for(h=null,f=e;;){if(5===f.tag){if(null===h){h=f;try{a=f.stateNode,l?"function"===typeof(o=a.style).setProperty?o.setProperty("display","none","important"):o.display="none":(u=f.stateNode,s=void 0!==(c=f.memoizedProps.style)&&null!==c&&c.hasOwnProperty("display")?c.display:null,u.style.display=ve("display",s))}catch(m){Sc(e,e.return,m)}}}else if(6===f.tag){if(null===h)try{f.stateNode.nodeValue=l?"":f.memoizedProps}catch(m){Sc(e,e.return,m)}}else if((22!==f.tag&&23!==f.tag||null===f.memoizedState||f===e)&&null!==f.child){f.child.return=f,f=f.child;continue}if(f===e)break e;for(;null===f.sibling;){if(null===f.return||f.return===e)break e;h===f&&(h=null),f=f.return}h===f&&(h=null),f.sibling.return=f.return,f=f.sibling}}break;case 19:vu(t,e),gu(e),4&r&&pu(e);case 21:}}function gu(e){var t=e.flags;if(2&t){try{e:{for(var n=e.return;null!==n;){if(ou(n)){var r=n;break e}n=n.return}throw Error(i(160))}switch(r.tag){case 5:var a=r.stateNode;32&r.flags&&(fe(a,""),r.flags&=-33),cu(e,su(e),a);break;case 3:case 4:var o=r.stateNode.containerInfo;uu(e,su(e),o);break;default:throw Error(i(161))}}catch(s){Sc(e,e.return,s)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function yu(e,t,n){Js=e,bu(e,t,n)}function bu(e,t,n){for(var r=0!==(1&e.mode);null!==Js;){var a=Js,i=a.child;if(22===a.tag&&r){var o=null!==a.memoizedState||Ys;if(!o){var s=a.alternate,u=null!==s&&null!==s.memoizedState||Qs;s=Ys;var c=Qs;if(Ys=o,(Qs=u)&&!c)for(Js=a;null!==Js;)u=(o=Js).child,22===o.tag&&null!==o.memoizedState?wu(a):null!==u?(u.return=o,Js=u):wu(a);for(;null!==i;)Js=i,bu(i,t,n),i=i.sibling;Js=a,Ys=s,Qs=c}xu(e)}else 0!==(8772&a.subtreeFlags)&&null!==i?(i.return=a,Js=i):xu(e)}}function xu(e){for(;null!==Js;){var t=Js;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:Qs||ru(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!Qs)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:mi(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var o=t.updateQueue;null!==o&&zi(t,o,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:case 1:n=t.child.stateNode}zi(t,s,n)}break;case 5:var u=t.stateNode;if(null===n&&4&t.flags){n=u;var c=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":c.autoFocus&&n.focus();break;case"img":c.src&&(n.src=c.src)}}break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:case 25:break;case 13:if(null===t.memoizedState){var l=t.alternate;if(null!==l){var h=l.memoizedState;if(null!==h){var f=h.dehydrated;null!==f&&Wt(f)}}}break;default:throw Error(i(163))}Qs||512&t.flags&&au(t)}catch(d){Sc(t,t.return,d)}}if(t===e){Js=null;break}if(null!==(n=t.sibling)){n.return=t.return,Js=n;break}Js=t.return}}function ku(e){for(;null!==Js;){var t=Js;if(t===e){Js=null;break}var n=t.sibling;if(null!==n){n.return=t.return,Js=n;break}Js=t.return}}function wu(e){for(;null!==Js;){var t=Js;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{ru(4,t)}catch(u){Sc(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(u){Sc(t,a,u)}}var i=t.return;try{au(t)}catch(u){Sc(t,i,u)}break;case 5:var o=t.return;try{au(t)}catch(u){Sc(t,o,u)}}}catch(u){Sc(t,t.return,u)}if(t===e){Js=null;break}var s=t.sibling;if(null!==s){s.return=t.return,Js=s;break}Js=t.return}}var _u,Su=Math.ceil,Cu=x.ReactCurrentDispatcher,Tu=x.ReactCurrentOwner,Eu=x.ReactCurrentBatchConfig,Iu=0,Au=null,Mu=null,Nu=0,Ru=0,Du=Sa(0),Pu=0,Ou=null,Lu=0,Fu=0,zu=0,Bu=null,Uu=null,Vu=0,Wu=1/0,Gu=null,ju=!1,qu=null,Hu=null,Xu=!1,Ku=null,Yu=0,Qu=0,Zu=null,Ju=-1,$u=0;function ec(){return 0!==(6&Iu)?Ze():-1!==Ju?Ju:Ju=Ze()}function tc(e){return 0===(1&e.mode)?1:0!==(2&Iu)&&0!==Nu?Nu&-Nu:null!==vi.transition?(0===$u&&($u=vt()),$u):0!==(e=bt)?e:e=void 0===(e=window.event)?16:Qt(e.type)}function nc(e,t,n,r){if(50<Qu)throw Qu=0,Zu=null,Error(i(185));gt(e,n,r),0!==(2&Iu)&&e===Au||(e===Au&&(0===(2&Iu)&&(Fu|=n),4===Pu&&sc(e,Nu)),rc(e,r),1===n&&0===Iu&&0===(1&t.mode)&&(Wu=Ze()+500,Ba&&Wa()))}function rc(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-ot(i),s=1<<o,u=a[o];-1===u?0!==(s&n)&&0===(s&r)||(a[o]=dt(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var r=ft(e,e===Au?Nu:0);if(0===r)null!==n&&Ke(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ke(n),1===t)0===e.tag?function(e){Ba=!0,Va(e)}(uc.bind(null,e)):Va(uc.bind(null,e)),oa((function(){0===(6&Iu)&&Wa()})),n=null;else{switch(xt(r)){case 1:n=$e;break;case 4:n=et;break;case 16:default:n=tt;break;case 536870912:n=rt}n=Ac(n,ac.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function ac(e,t){if(Ju=-1,$u=0,0!==(6&Iu))throw Error(i(327));var n=e.callbackNode;if(wc()&&e.callbackNode!==n)return null;var r=ft(e,e===Au?Nu:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=mc(e,r);else{t=r;var a=Iu;Iu|=2;var o=pc();for(Au===e&&Nu===t||(Gu=null,Wu=Ze()+500,fc(e,t));;)try{yc();break}catch(u){dc(e,u)}ki(),Cu.current=o,Iu=a,null!==Mu?t=0:(Au=null,Nu=0,t=Pu)}if(0!==t){if(2===t&&(0!==(a=pt(e))&&(r=a,t=ic(e,a))),1===t)throw n=Ou,fc(e,0),sc(e,r),rc(e,Ze()),n;if(6===t)sc(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!sr(i(),a))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=mc(e,r))&&(0!==(o=pt(e))&&(r=o,t=ic(e,o))),1===t))throw n=Ou,fc(e,0),sc(e,r),rc(e,Ze()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(i(345));case 2:case 5:kc(e,Uu,Gu);break;case 3:if(sc(e,r),(130023424&r)===r&&10<(t=Vu+500-Ze())){if(0!==ft(e,0))break;if(((a=e.suspendedLanes)&r)!==r){ec(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=ra(kc.bind(null,e,Uu,Gu),t);break}kc(e,Uu,Gu);break;case 4:if(sc(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-ot(r);o=1<<s,(s=t[s])>a&&(a=s),r&=~o}if(r=a,10<(r=(120>(r=Ze()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Su(r/1960))-r)){e.timeoutHandle=ra(kc.bind(null,e,Uu,Gu),r);break}kc(e,Uu,Gu);break;default:throw Error(i(329))}}}return rc(e,Ze()),e.callbackNode===n?ac.bind(null,e):null}function ic(e,t){var n=Bu;return e.current.memoizedState.isDehydrated&&(fc(e,t).flags|=256),2!==(e=mc(e,t))&&(t=Uu,Uu=n,null!==t&&oc(t)),e}function oc(e){null===Uu?Uu=e:Uu.push.apply(Uu,e)}function sc(e,t){for(t&=~zu,t&=~Fu,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-ot(t),r=1<<n;e[n]=-1,t&=~r}}function uc(e){if(0!==(6&Iu))throw Error(i(327));wc();var t=ft(e,0);if(0===(1&t))return rc(e,Ze()),null;var n=mc(e,t);if(0!==e.tag&&2===n){var r=pt(e);0!==r&&(t=r,n=ic(e,r))}if(1===n)throw n=Ou,fc(e,0),sc(e,t),rc(e,Ze()),n;if(6===n)throw Error(i(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,kc(e,Uu,Gu),rc(e,Ze()),null}function cc(e,t){var n=Iu;Iu|=1;try{return e(t)}finally{0===(Iu=n)&&(Wu=Ze()+500,Ba&&Wa())}}function lc(e){null!==Ku&&0===Ku.tag&&0===(6&Iu)&&wc();var t=Iu;Iu|=1;var n=Eu.transition,r=bt;try{if(Eu.transition=null,bt=1,e)return e()}finally{bt=r,Eu.transition=n,0===(6&(Iu=t))&&Wa()}}function hc(){Ru=Du.current,Ca(Du)}function fc(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(-1!==n&&(e.timeoutHandle=-1,aa(n)),null!==Mu)for(n=Mu.return;null!==n;){var r=n;switch(ti(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&Da();break;case 3:ao(),Ca(Aa),Ca(Ia),lo();break;case 5:oo(r);break;case 4:ao();break;case 13:case 19:Ca(so);break;case 10:wi(r.type._context);break;case 22:case 23:hc()}n=n.return}if(Au=e,Mu=e=Dc(e.current,null),Nu=Ru=t,Pu=0,Ou=null,zu=Fu=Lu=0,Uu=Bu=null,null!==Ti){for(t=0;t<Ti.length;t++)if(null!==(r=(n=Ti[t]).interleaved)){n.interleaved=null;var a=r.next,i=n.pending;if(null!==i){var o=i.next;i.next=a,r.next=o}n.pending=r}Ti=null}return e}function dc(e,t){for(;;){var n=Mu;try{if(ki(),ho.current=os,yo){for(var r=vo.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}yo=!1}if(po=0,go=mo=vo=null,bo=!1,xo=0,Tu.current=null,null===n||null===n.return){Pu=1,Ou=t,Mu=null;break}e:{var o=e,s=n.return,u=n,c=t;if(t=Nu,u.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var l=c,h=u,f=h.tag;if(0===(1&h.mode)&&(0===f||11===f||15===f)){var d=h.alternate;d?(h.updateQueue=d.updateQueue,h.memoizedState=d.memoizedState,h.lanes=d.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=gs(s);if(null!==p){p.flags&=-257,ys(p,s,u,0,t),1&p.mode&&ms(o,l,t),c=l;var v=(t=p).updateQueue;if(null===v){var m=new Set;m.add(c),t.updateQueue=m}else v.add(c);break e}if(0===(1&t)){ms(o,l,t),vc();break e}c=Error(i(426))}else if(ai&&1&u.mode){var g=gs(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),ys(g,s,u,0,t),pi(ls(c,u));break e}}o=c=ls(c,u),4!==Pu&&(Pu=2),null===Bu?Bu=[o]:Bu.push(o),o=s;do{switch(o.tag){case 3:o.flags|=65536,t&=-t,o.lanes|=t,Li(o,ps(0,c,t));break e;case 1:u=c;var y=o.type,b=o.stateNode;if(0===(128&o.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===Hu||!Hu.has(b)))){o.flags|=65536,t&=-t,o.lanes|=t,Li(o,vs(o,u,t));break e}}o=o.return}while(null!==o)}xc(n)}catch(x){t=x,Mu===n&&null!==n&&(Mu=n=n.return);continue}break}}function pc(){var e=Cu.current;return Cu.current=os,null===e?os:e}function vc(){0!==Pu&&3!==Pu&&2!==Pu||(Pu=4),null===Au||0===(268435455&Lu)&&0===(268435455&Fu)||sc(Au,Nu)}function mc(e,t){var n=Iu;Iu|=2;var r=pc();for(Au===e&&Nu===t||(Gu=null,fc(e,t));;)try{gc();break}catch(a){dc(e,a)}if(ki(),Iu=n,Cu.current=r,null!==Mu)throw Error(i(261));return Au=null,Nu=0,Pu}function gc(){for(;null!==Mu;)bc(Mu)}function yc(){for(;null!==Mu&&!Ye();)bc(Mu)}function bc(e){var t=_u(e.alternate,e,Ru);e.memoizedProps=e.pendingProps,null===t?xc(e):Mu=t,Tu.current=null}function xc(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Xs(n,t,Ru)))return void(Mu=n)}else{if(null!==(n=Ks(n,t)))return n.flags&=32767,void(Mu=n);if(null===e)return Pu=6,void(Mu=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Mu=t);Mu=t=e}while(null!==t);0===Pu&&(Pu=5)}function kc(e,t,n){var r=bt,a=Eu.transition;try{Eu.transition=null,bt=1,function(e,t,n,r){do{wc()}while(null!==Ku);if(0!==(6&Iu))throw Error(i(327));n=e.finishedWork;var a=e.finishedLanes;if(null===n)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(i(177));e.callbackNode=null,e.callbackPriority=0;var o=n.lanes|n.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-ot(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}(e,o),e===Au&&(Mu=Au=null,Nu=0),0===(2064&n.subtreeFlags)&&0===(2064&n.flags)||Xu||(Xu=!0,Ac(tt,(function(){return wc(),null}))),o=0!==(15990&n.flags),0!==(15990&n.subtreeFlags)||o){o=Eu.transition,Eu.transition=null;var s=bt;bt=1;var u=Iu;Iu|=4,Tu.current=null,function(e,t){if(ea=jt,dr(e=fr())){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{var r=(n=(n=e.ownerDocument)&&n.defaultView||window).getSelection&&n.getSelection();if(r&&0!==r.rangeCount){n=r.anchorNode;var a=r.anchorOffset,o=r.focusNode;r=r.focusOffset;try{n.nodeType,o.nodeType}catch(k){n=null;break e}var s=0,u=-1,c=-1,l=0,h=0,f=e,d=null;t:for(;;){for(var p;f!==n||0!==a&&3!==f.nodeType||(u=s+a),f!==o||0!==r&&3!==f.nodeType||(c=s+r),3===f.nodeType&&(s+=f.nodeValue.length),null!==(p=f.firstChild);)d=f,f=p;for(;;){if(f===e)break t;if(d===n&&++l===a&&(u=s),d===o&&++h===r&&(c=s),null!==(p=f.nextSibling))break;d=(f=d).parentNode}f=p}n=-1===u||-1===c?null:{start:u,end:c}}else n=null}n=n||{start:0,end:0}}else n=null;for(ta={focusedElem:e,selectionRange:n},jt=!1,Js=t;null!==Js;)if(e=(t=Js).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Js=e;else for(;null!==Js;){t=Js;try{var v=t.alternate;if(0!==(1024&t.flags))switch(t.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==v){var m=v.memoizedProps,g=v.memoizedState,y=t.stateNode,b=y.getSnapshotBeforeUpdate(t.elementType===t.type?m:mi(t.type,m),g);y.__reactInternalSnapshotBeforeUpdate=b}break;case 3:var x=t.stateNode.containerInfo;1===x.nodeType?x.textContent="":9===x.nodeType&&x.documentElement&&x.removeChild(x.documentElement);break;default:throw Error(i(163))}}catch(k){Sc(t,t.return,k)}if(null!==(e=t.sibling)){e.return=t.return,Js=e;break}Js=t.return}v=tu,tu=!1}(e,n),mu(n,e),pr(ta),jt=!!ea,ta=ea=null,e.current=n,yu(n,e,a),Qe(),Iu=u,bt=s,Eu.transition=o}else e.current=n;if(Xu&&(Xu=!1,Ku=e,Yu=a),0===(o=e.pendingLanes)&&(Hu=null),function(e){if(it&&"function"===typeof it.onCommitFiberRoot)try{it.onCommitFiberRoot(at,e,void 0,128===(128&e.current.flags))}catch(t){}}(n.stateNode),rc(e,Ze()),null!==t)for(r=e.onRecoverableError,n=0;n<t.length;n++)r((a=t[n]).value,{componentStack:a.stack,digest:a.digest});if(ju)throw ju=!1,e=qu,qu=null,e;0!==(1&Yu)&&0!==e.tag&&wc(),0!==(1&(o=e.pendingLanes))?e===Zu?Qu++:(Qu=0,Zu=e):Qu=0,Wa()}(e,t,n,r)}finally{Eu.transition=a,bt=r}return null}function wc(){if(null!==Ku){var e=xt(Yu),t=Eu.transition,n=bt;try{if(Eu.transition=null,bt=16>e?16:e,null===Ku)var r=!1;else{if(e=Ku,Ku=null,Yu=0,0!==(6&Iu))throw Error(i(331));var a=Iu;for(Iu|=4,Js=e.current;null!==Js;){var o=Js,s=o.child;if(0!==(16&Js.flags)){var u=o.deletions;if(null!==u){for(var c=0;c<u.length;c++){var l=u[c];for(Js=l;null!==Js;){var h=Js;switch(h.tag){case 0:case 11:case 15:nu(8,h,o)}var f=h.child;if(null!==f)f.return=h,Js=f;else for(;null!==Js;){var d=(h=Js).sibling,p=h.return;if(iu(h),h===l){Js=null;break}if(null!==d){d.return=p,Js=d;break}Js=p}}}var v=o.alternate;if(null!==v){var m=v.child;if(null!==m){v.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}Js=o}}if(0!==(2064&o.subtreeFlags)&&null!==s)s.return=o,Js=s;else e:for(;null!==Js;){if(0!==(2048&(o=Js).flags))switch(o.tag){case 0:case 11:case 15:nu(9,o,o.return)}var y=o.sibling;if(null!==y){y.return=o.return,Js=y;break e}Js=o.return}}var b=e.current;for(Js=b;null!==Js;){var x=(s=Js).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,Js=x;else e:for(s=b;null!==Js;){if(0!==(2048&(u=Js).flags))try{switch(u.tag){case 0:case 11:case 15:ru(9,u)}}catch(w){Sc(u,u.return,w)}if(u===s){Js=null;break e}var k=u.sibling;if(null!==k){k.return=u.return,Js=k;break e}Js=u.return}}if(Iu=a,Wa(),it&&"function"===typeof it.onPostCommitFiberRoot)try{it.onPostCommitFiberRoot(at,e)}catch(w){}r=!0}return r}finally{bt=n,Eu.transition=t}}return!1}function _c(e,t,n){e=Pi(e,t=ps(0,t=ls(n,t),1),1),t=ec(),null!==e&&(gt(e,1,t),rc(e,t))}function Sc(e,t,n){if(3===e.tag)_c(e,e,n);else for(;null!==t;){if(3===t.tag){_c(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===Hu||!Hu.has(r))){t=Pi(t,e=vs(t,e=ls(n,e),1),1),e=ec(),null!==t&&(gt(t,1,e),rc(t,e));break}}t=t.return}}function Cc(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ec(),e.pingedLanes|=e.suspendedLanes&n,Au===e&&(Nu&n)===n&&(4===Pu||3===Pu&&(130023424&Nu)===Nu&&500>Ze()-Vu?fc(e,0):zu|=n),rc(e,t)}function Tc(e,t){0===t&&(0===(1&e.mode)?t=1:(t=lt,0===(130023424&(lt<<=1))&&(lt=4194304)));var n=ec();null!==(e=Ai(e,t))&&(gt(e,t,n),rc(e,n))}function Ec(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Tc(e,n)}function Ic(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(i(314))}null!==r&&r.delete(t),Tc(e,n)}function Ac(e,t){return Xe(e,t)}function Mc(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nc(e,t,n,r){return new Mc(e,t,n,r)}function Rc(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Dc(e,t){var n=e.alternate;return null===n?((n=Nc(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Pc(e,t,n,r,a,o){var s=2;if(r=e,"function"===typeof e)Rc(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case _:return Oc(n.children,a,o,t);case S:s=8,a|=8;break;case C:return(e=Nc(12,n,t,2|a)).elementType=C,e.lanes=o,e;case A:return(e=Nc(13,n,t,a)).elementType=A,e.lanes=o,e;case M:return(e=Nc(19,n,t,a)).elementType=M,e.lanes=o,e;case D:return Lc(n,a,o,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case T:s=10;break e;case E:s=9;break e;case I:s=11;break e;case N:s=14;break e;case R:s=16,r=null;break e}throw Error(i(130,null==e?e:typeof e,""))}return(t=Nc(s,n,t,a)).elementType=e,t.type=r,t.lanes=o,t}function Oc(e,t,n,r){return(e=Nc(7,e,r,t)).lanes=n,e}function Lc(e,t,n,r){return(e=Nc(22,e,r,t)).elementType=D,e.lanes=n,e.stateNode={isHidden:!1},e}function Fc(e,t,n){return(e=Nc(6,e,null,t)).lanes=n,e}function zc(e,t,n){return(t=Nc(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Bc(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=mt(0),this.expirationTimes=mt(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=mt(0),this.identifierPrefix=r,this.onRecoverableError=a,this.mutableSourceEagerHydrationData=null}function Uc(e,t,n,r,a,i,o,s,u){return e=new Bc(e,t,n,s,u),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Nc(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ni(i),e}function Vc(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:w,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}}function Wc(e){if(!e)return Ea;e:{if(We(e=e._reactInternals)!==e||1!==e.tag)throw Error(i(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Ra(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(i(171))}if(1===e.tag){var n=e.type;if(Ra(n))return Oa(e,n,t)}return t}function Gc(e,t,n,r,a,i,o,s,u){return(e=Uc(n,r,!0,e,0,i,0,s,u)).context=Wc(null),n=e.current,(i=Di(r=ec(),a=tc(n))).callback=void 0!==t&&null!==t?t:null,Pi(n,i,a),e.current.lanes=a,gt(e,a,r),rc(e,r),e}function jc(e,t,n,r){var a=t.current,i=ec(),o=tc(a);return n=Wc(n),null===t.context?t.context=n:t.pendingContext=n,(t=Di(i,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),null!==(e=Pi(a,t,o))&&(nc(e,a,o,i),Oi(e,a,o)),o}function qc(e){return(e=e.current).child?(e.child.tag,e.child.stateNode):null}function Hc(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function Xc(e,t){Hc(e,t),(e=e.alternate)&&Hc(e,t)}_u=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||Aa.current)xs=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return xs=!1,function(e,t,n){switch(t.tag){case 3:Ms(t),di();break;case 5:io(t);break;case 1:Ra(t.type)&&La(t);break;case 4:ro(t,t.stateNode.containerInfo);break;case 10:var r=t.type._context,a=t.memoizedProps.value;Ta(gi,r._currentValue),r._currentValue=a;break;case 13:if(null!==(r=t.memoizedState))return null!==r.dehydrated?(Ta(so,1&so.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Fs(e,t,n):(Ta(so,1&so.current),null!==(e=js(e,t,n))?e.sibling:null);Ta(so,1&so.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return Ws(e,t,n);t.flags|=128}if(null!==(a=t.memoizedState)&&(a.rendering=null,a.tail=null,a.lastEffect=null),Ta(so,so.current),r)break;return null;case 22:case 23:return t.lanes=0,Cs(e,t,n)}return js(e,t,n)}(e,t,n);xs=0!==(131072&e.flags)}else xs=!1,ai&&0!==(1048576&t.flags)&&$a(t,Ha,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;Gs(e,t),e=t.pendingProps;var a=Na(t,Ia.current);Si(t,n),a=So(null,t,r,e,a,n);var o=Co();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Ra(r)?(o=!0,La(t)):o=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,Ni(t),a.updater=Vi,t.stateNode=a,a._reactInternals=t,qi(t,r,e,n),t=As(null,t,r,!0,o,n)):(t.tag=0,ai&&o&&ei(t),ks(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(Gs(e,t),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return Rc(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===I)return 11;if(e===N)return 14}return 2}(r),e=mi(r,e),a){case 0:t=Es(null,t,r,e,n);break e;case 1:t=Is(null,t,r,e,n);break e;case 11:t=ws(null,t,r,e,n);break e;case 14:t=_s(null,t,r,mi(r.type,e),n);break e}throw Error(i(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,Es(e,t,r,a=t.elementType===r?a:mi(r,a),n);case 1:return r=t.type,a=t.pendingProps,Is(e,t,r,a=t.elementType===r?a:mi(r,a),n);case 3:e:{if(Ms(t),null===e)throw Error(i(387));r=t.pendingProps,a=(o=t.memoizedState).element,Ri(e,t),Fi(t,r,null,n);var s=t.memoizedState;if(r=s.element,o.isDehydrated){if(o={element:r,isDehydrated:!1,cache:s.cache,pendingSuspenseBoundaries:s.pendingSuspenseBoundaries,transitions:s.transitions},t.updateQueue.baseState=o,t.memoizedState=o,256&t.flags){t=Ns(e,t,r,n,a=ls(Error(i(423)),t));break e}if(r!==a){t=Ns(e,t,r,n,a=ls(Error(i(424)),t));break e}for(ri=ca(t.stateNode.containerInfo.firstChild),ni=t,ai=!0,ii=null,n=Zi(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if(di(),r===a){t=js(e,t,n);break e}ks(e,t,r,n)}t=t.child}return t;case 5:return io(t),null===e&&ci(t),r=t.type,a=t.pendingProps,o=null!==e?e.memoizedProps:null,s=a.children,na(r,a)?s=null:null!==o&&na(r,o)&&(t.flags|=32),Ts(e,t),ks(e,t,s,n),t.child;case 6:return null===e&&ci(t),null;case 13:return Fs(e,t,n);case 4:return ro(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=Qi(t,null,r,n):ks(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,ws(e,t,r,a=t.elementType===r?a:mi(r,a),n);case 7:return ks(e,t,t.pendingProps,n),t.child;case 8:case 12:return ks(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,o=t.memoizedProps,s=a.value,Ta(gi,r._currentValue),r._currentValue=s,null!==o)if(sr(o.value,s)){if(o.children===a.children&&!Aa.current){t=js(e,t,n);break e}}else for(null!==(o=t.child)&&(o.return=t);null!==o;){var u=o.dependencies;if(null!==u){s=o.child;for(var c=u.firstContext;null!==c;){if(c.context===r){if(1===o.tag){(c=Di(-1,n&-n)).tag=2;var l=o.updateQueue;if(null!==l){var h=(l=l.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),l.pending=c}}o.lanes|=n,null!==(c=o.alternate)&&(c.lanes|=n),_i(o.return,n,t),u.lanes|=n;break}c=c.next}}else if(10===o.tag)s=o.type===t.type?null:o.child;else if(18===o.tag){if(null===(s=o.return))throw Error(i(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),_i(s,n,t),s=o.sibling}else s=o.child;if(null!==s)s.return=o;else for(s=o;null!==s;){if(s===t){s=null;break}if(null!==(o=s.sibling)){o.return=s.return,s=o;break}s=s.return}o=s}ks(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,Si(t,n),r=r(a=Ci(a)),t.flags|=1,ks(e,t,r,n),t.child;case 14:return a=mi(r=t.type,t.pendingProps),_s(e,t,r,a=mi(r.type,a),n);case 15:return Ss(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:mi(r,a),Gs(e,t),t.tag=1,Ra(r)?(e=!0,La(t)):e=!1,Si(t,n),Gi(t,r,a),qi(t,r,a,n),As(null,t,r,!0,e,n);case 19:return Ws(e,t,n);case 22:return Cs(e,t,n)}throw Error(i(156,t.tag))};var Kc="function"===typeof reportError?reportError:function(e){console.error(e)};function Yc(e){this._internalRoot=e}function Qc(e){this._internalRoot=e}function Zc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function Jc(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType&&(8!==e.nodeType||" react-mount-point-unstable "!==e.nodeValue))}function $c(){}function el(e,t,n,r,a){var i=n._reactRootContainer;if(i){var o=i;if("function"===typeof a){var s=a;a=function(){var e=qc(o);s.call(e)}}jc(t,o,e,a)}else o=function(e,t,n,r,a){if(a){if("function"===typeof r){var i=r;r=function(){var e=qc(o);i.call(e)}}var o=Gc(t,r,e,0,null,!1,0,"",$c);return e._reactRootContainer=o,e[pa]=o.current,Wr(8===e.nodeType?e.parentNode:e),lc(),o}for(;a=e.lastChild;)e.removeChild(a);if("function"===typeof r){var s=r;r=function(){var e=qc(u);s.call(e)}}var u=Uc(e,0,!1,null,0,!1,0,"",$c);return e._reactRootContainer=u,e[pa]=u.current,Wr(8===e.nodeType?e.parentNode:e),lc((function(){jc(t,u,n,r)})),u}(n,t,e,a,r);return qc(o)}Qc.prototype.render=Yc.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(i(409));jc(e,t,null,null)},Qc.prototype.unmount=Yc.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;lc((function(){jc(null,e,null,null)})),t[pa]=null}},Qc.prototype.unstable_scheduleHydration=function(e){if(e){var t=St();e={blockedOn:null,target:e,priority:t};for(var n=0;n<Dt.length&&0!==t&&t<Dt[n].priority;n++);Dt.splice(n,0,e),0===n&&Ft(e)}},kt=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=ht(t.pendingLanes);0!==n&&(yt(t,1|n),rc(t,Ze()),0===(6&Iu)&&(Wu=Ze()+500,Wa()))}break;case 13:lc((function(){var t=Ai(e,1);if(null!==t){var n=ec();nc(t,e,1,n)}})),Xc(e,1)}},wt=function(e){if(13===e.tag){var t=Ai(e,134217728);if(null!==t)nc(t,e,134217728,ec());Xc(e,134217728)}},_t=function(e){if(13===e.tag){var t=tc(e),n=Ai(e,t);if(null!==n)nc(n,e,t,ec());Xc(e,t)}},St=function(){return bt},Ct=function(e,t){var n=bt;try{return bt=e,t()}finally{bt=n}},we=function(e,t,n){switch(t){case"input":if(J(e,n),t=n.name,"radio"===n.type&&null!=t){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var r=n[t];if(r!==e&&r.form===e.form){var a=ka(r);if(!a)throw Error(i(90));X(r),J(r,a)}}}break;case"textarea":ie(e,n);break;case"select":null!=(t=n.value)&&ne(e,!!n.multiple,t,!1)}},Ie=cc,Ae=lc;var tl={usingClientEntryPoint:!1,Events:[ba,xa,ka,Te,Ee,cc]},nl={findFiberByHostInstance:ya,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},rl={bundleType:nl.bundleType,version:nl.version,rendererPackageName:nl.rendererPackageName,rendererConfig:nl.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:x.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return null===(e=qe(e))?null:e.stateNode},findFiberByHostInstance:nl.findFiberByHostInstance||function(){return null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var al=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!al.isDisabled&&al.supportsFiber)try{at=al.inject(rl),it=al}catch(le){}}t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=tl,t.createPortal=function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!Zc(t))throw Error(i(200));return Vc(e,t,null,n)},t.createRoot=function(e,t){if(!Zc(e))throw Error(i(299));var n=!1,r="",a=Kc;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(n=!0),void 0!==t.identifierPrefix&&(r=t.identifierPrefix),void 0!==t.onRecoverableError&&(a=t.onRecoverableError)),t=Uc(e,1,!1,null,0,n,0,r,a),e[pa]=t.current,Wr(8===e.nodeType?e.parentNode:e),new Yc(t)},t.findDOMNode=function(e){if(null==e)return null;if(1===e.nodeType)return e;var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(i(188));throw e=Object.keys(e).join(","),Error(i(268,e))}return e=null===(e=qe(t))?null:e.stateNode},t.flushSync=function(e){return lc(e)},t.hydrate=function(e,t,n){if(!Jc(t))throw Error(i(200));return el(null,e,t,!0,n)},t.hydrateRoot=function(e,t,n){if(!Zc(e))throw Error(i(405));var r=null!=n&&n.hydratedSources||null,a=!1,o="",s=Kc;if(null!==n&&void 0!==n&&(!0===n.unstable_strictMode&&(a=!0),void 0!==n.identifierPrefix&&(o=n.identifierPrefix),void 0!==n.onRecoverableError&&(s=n.onRecoverableError)),t=Gc(t,null,e,1,null!=n?n:null,a,0,o,s),e[pa]=t.current,Wr(e),r)for(e=0;e<r.length;e++)a=(a=(n=r[e])._getVersion)(n._source),null==t.mutableSourceEagerHydrationData?t.mutableSourceEagerHydrationData=[n,a]:t.mutableSourceEagerHydrationData.push(n,a);return new Qc(t)},t.render=function(e,t,n){if(!Jc(t))throw Error(i(200));return el(null,e,t,!1,n)},t.unmountComponentAtNode=function(e){if(!Jc(e))throw Error(i(40));return!!e._reactRootContainer&&(lc((function(){el(null,null,e,!1,(function(){e._reactRootContainer=null,e[pa]=null}))})),!0)},t.unstable_batchedUpdates=cc,t.unstable_renderSubtreeIntoContainer=function(e,t,n,r){if(!Jc(n))throw Error(i(200));if(null==e||void 0===e._reactInternals)throw Error(i(38));return el(e,t,n,!1,r)},t.version="18.2.0-next-9e3b772b8-20220608"},1250:function(e,t,n){"use strict";var r=n(4164);t.createRoot=r.createRoot,t.hydrateRoot=r.hydrateRoot},4164:function(e,t,n){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=n(4463)},67:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,u=e[s],c=s+1,l=e[c];if(0>i(u,n))c<a&&0>i(l,u)?(e[r]=l,e[c]=n,r=c):(e[r]=u,e[s]=n,r=s);else{if(!(c<a&&0>i(l,n)))break e;e[r]=l,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var c=[],l=[],h=1,f=null,d=3,p=!1,v=!1,m=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(l);null!==t;){if(null===t.callback)a(l);else{if(!(t.startTime<=e))break;a(l),t.sortIndex=t.expirationTime,n(c,t)}t=r(l)}}function k(e){if(m=!1,x(e),!v)if(null!==r(c))v=!0,D(w);else{var t=r(l);null!==t&&P(k,t.startTime-e)}}function w(e,n){v=!1,m&&(m=!1,y(T),T=-1),p=!0;var i=d;try{for(x(n),f=r(c);null!==f&&(!(f.expirationTime>n)||e&&!A());){var o=f.callback;if("function"===typeof o){f.callback=null,d=f.priorityLevel;var s=o(f.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?f.callback=s:f===r(c)&&a(c),x(n)}else a(c);f=r(c)}if(null!==f)var u=!0;else{var h=r(l);null!==h&&P(k,h.startTime-n),u=!1}return u}finally{f=null,d=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _,S=!1,C=null,T=-1,E=5,I=-1;function A(){return!(t.unstable_now()-I<E)}function M(){if(null!==C){var e=t.unstable_now();I=e;var n=!0;try{n=C(!0,e)}finally{n?_():(S=!1,C=null)}}else S=!1}if("function"===typeof b)_=function(){b(M)};else if("undefined"!==typeof MessageChannel){var N=new MessageChannel,R=N.port2;N.port1.onmessage=M,_=function(){R.postMessage(null)}}else _=function(){g(M,0)};function D(e){C=e,S||(S=!0,_())}function P(e,n){T=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||p||(v=!0,D(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},t.unstable_scheduleCallback=function(e,a,i){var o=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?o+i:o:i=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:a,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>o?(e.sortIndex=i,n(l,e),null===r(c)&&e===r(l)&&(m?(y(T),T=-1):m=!0,P(k,i-o))):(e.sortIndex=s,n(c,e),v||p||(v=!0,D(w))),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}}},5585:function(e,t,n){"use strict";e.exports=n(67)},1372:function(e,t){"use strict";var n="function"===typeof Symbol&&Symbol.for,r=n?Symbol.for("react.element"):60103,a=n?Symbol.for("react.portal"):60106,i=n?Symbol.for("react.fragment"):60107,o=n?Symbol.for("react.strict_mode"):60108,s=n?Symbol.for("react.profiler"):60114,u=n?Symbol.for("react.provider"):60109,c=n?Symbol.for("react.context"):60110,l=n?Symbol.for("react.async_mode"):60111,h=n?Symbol.for("react.concurrent_mode"):60111,f=n?Symbol.for("react.forward_ref"):60112,d=n?Symbol.for("react.suspense"):60113,p=n?Symbol.for("react.suspense_list"):60120,v=n?Symbol.for("react.memo"):60115,m=n?Symbol.for("react.lazy"):60116,g=n?Symbol.for("react.block"):60121,y=n?Symbol.for("react.fundamental"):60117,b=n?Symbol.for("react.responder"):60118,x=n?Symbol.for("react.scope"):60119;function k(e){if("object"===typeof e&&null!==e){var t=e.$$typeof;switch(t){case r:switch(e=e.type){case l:case h:case i:case s:case o:case d:return e;default:switch(e=e&&e.$$typeof){case c:case f:case m:case v:case u:return e;default:return t}}case a:return t}}}function w(e){return k(e)===h}t.AsyncMode=l,t.ConcurrentMode=h,t.ContextConsumer=c,t.ContextProvider=u,t.Element=r,t.ForwardRef=f,t.Fragment=i,t.Lazy=m,t.Memo=v,t.Portal=a,t.Profiler=s,t.StrictMode=o,t.Suspense=d,t.isAsyncMode=function(e){return w(e)||k(e)===l},t.isConcurrentMode=w,t.isContextConsumer=function(e){return k(e)===c},t.isContextProvider=function(e){return k(e)===u},t.isElement=function(e){return"object"===typeof e&&null!==e&&e.$$typeof===r},t.isForwardRef=function(e){return k(e)===f},t.isFragment=function(e){return k(e)===i},t.isLazy=function(e){return k(e)===m},t.isMemo=function(e){return k(e)===v},t.isPortal=function(e){return k(e)===a},t.isProfiler=function(e){return k(e)===s},t.isStrictMode=function(e){return k(e)===o},t.isSuspense=function(e){return k(e)===d},t.isValidElementType=function(e){return"string"===typeof e||"function"===typeof e||e===i||e===h||e===s||e===o||e===d||e===p||"object"===typeof e&&null!==e&&(e.$$typeof===m||e.$$typeof===v||e.$$typeof===u||e.$$typeof===c||e.$$typeof===f||e.$$typeof===y||e.$$typeof===b||e.$$typeof===x||e.$$typeof===g)},t.typeOf=k},7441:function(e,t,n){"use strict";e.exports=n(1372)},4976:function(e,t){"use strict";t.ConcurrentRoot=1,t.ContinuousEventPriority=4,t.DefaultEventPriority=16,t.DiscreteEventPriority=1},3721:function(e,t,n){e.exports=function(e){var t={},r=n(2791),a=n(5296),i=Object.assign;function o(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,u=Symbol.for("react.element"),c=Symbol.for("react.portal"),l=Symbol.for("react.fragment"),h=Symbol.for("react.strict_mode"),f=Symbol.for("react.profiler"),d=Symbol.for("react.provider"),p=Symbol.for("react.context"),v=Symbol.for("react.forward_ref"),m=Symbol.for("react.suspense"),g=Symbol.for("react.suspense_list"),y=Symbol.for("react.memo"),b=Symbol.for("react.lazy");Symbol.for("react.scope"),Symbol.for("react.debug_trace_mode");var x=Symbol.for("react.offscreen");Symbol.for("react.legacy_hidden"),Symbol.for("react.cache"),Symbol.for("react.tracing_marker");var k=Symbol.iterator;function w(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=k&&e[k]||e["@@iterator"])?e:null}function _(e){if(null==e)return null;if("function"===typeof e)return e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case l:return"Fragment";case c:return"Portal";case f:return"Profiler";case h:return"StrictMode";case m:return"Suspense";case g:return"SuspenseList"}if("object"===typeof e)switch(e.$$typeof){case p:return(e.displayName||"Context")+".Consumer";case d:return(e._context.displayName||"Context")+".Provider";case v:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case y:return null!==(t=e.displayName||null)?t:_(e.type)||"Memo";case b:t=e._payload,e=e._init;try{return _(e(t))}catch(n){}}return null}function S(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=(e=t.render).displayName||e.name||"",t.displayName||(""!==e?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return _(t);case 8:return t===h?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if("function"===typeof t)return t.displayName||t.name||null;if("string"===typeof t)return t}return null}function C(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(n=t.return),e=t.return}while(e)}return 3===t.tag?n:null}function T(e){if(C(e)!==e)throw Error(o(188))}function E(e){var t=e.alternate;if(!t){if(null===(t=C(e)))throw Error(o(188));return t!==e?null:e}for(var n=e,r=t;;){var a=n.return;if(null===a)break;var i=a.alternate;if(null===i){if(null!==(r=a.return)){n=r;continue}break}if(a.child===i.child){for(i=a.child;i;){if(i===n)return T(a),e;if(i===r)return T(a),t;i=i.sibling}throw Error(o(188))}if(n.return!==r.return)n=a,r=i;else{for(var s=!1,u=a.child;u;){if(u===n){s=!0,n=a,r=i;break}if(u===r){s=!0,r=a,n=i;break}u=u.sibling}if(!s){for(u=i.child;u;){if(u===n){s=!0,n=i,r=a;break}if(u===r){s=!0,r=i,n=a;break}u=u.sibling}if(!s)throw Error(o(189))}}if(n.alternate!==r)throw Error(o(190))}if(3!==n.tag)throw Error(o(188));return n.stateNode.current===n?e:t}function I(e){return null!==(e=E(e))?A(e):null}function A(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){var t=A(e);if(null!==t)return t;e=e.sibling}return null}function M(e){if(5===e.tag||6===e.tag)return e;for(e=e.child;null!==e;){if(4!==e.tag){var t=M(e);if(null!==t)return t}e=e.sibling}return null}var N,R=Array.isArray,D=e.getPublicInstance,P=e.getRootHostContext,O=e.getChildHostContext,L=e.prepareForCommit,F=e.resetAfterCommit,z=e.createInstance,B=e.appendInitialChild,U=e.finalizeInitialChildren,V=e.prepareUpdate,W=e.shouldSetTextContent,G=e.createTextInstance,j=e.scheduleTimeout,q=e.cancelTimeout,H=e.noTimeout,X=e.isPrimaryRenderer,K=e.supportsMutation,Y=e.supportsPersistence,Q=e.supportsHydration,Z=e.getInstanceFromNode,J=e.preparePortalMount,$=e.getCurrentEventPriority,ee=e.detachDeletedInstance,te=e.supportsMicrotasks,ne=e.scheduleMicrotask,re=e.supportsTestSelectors,ae=e.findFiberRoot,ie=e.getBoundingRect,oe=e.getTextContent,se=e.isHiddenSubtree,ue=e.matchAccessibilityRole,ce=e.setFocusIfFocusable,le=e.setupIntersectionObserver,he=e.appendChild,fe=e.appendChildToContainer,de=e.commitTextUpdate,pe=e.commitMount,ve=e.commitUpdate,me=e.insertBefore,ge=e.insertInContainerBefore,ye=e.removeChild,be=e.removeChildFromContainer,xe=e.resetTextContent,ke=e.hideInstance,we=e.hideTextInstance,_e=e.unhideInstance,Se=e.unhideTextInstance,Ce=e.clearContainer,Te=e.cloneInstance,Ee=e.createContainerChildSet,Ie=e.appendChildToContainerChildSet,Ae=e.finalizeContainerChildren,Me=e.replaceContainerChildren,Ne=e.cloneHiddenInstance,Re=e.cloneHiddenTextInstance,De=e.canHydrateInstance,Pe=e.canHydrateTextInstance,Oe=e.canHydrateSuspenseInstance,Le=e.isSuspenseInstancePending,Fe=e.isSuspenseInstanceFallback,ze=e.registerSuspenseInstanceRetry,Be=e.getNextHydratableSibling,Ue=e.getFirstHydratableChild,Ve=e.getFirstHydratableChildWithinContainer,We=e.getFirstHydratableChildWithinSuspenseInstance,Ge=e.hydrateInstance,je=e.hydrateTextInstance,qe=e.hydrateSuspenseInstance,He=e.getNextHydratableInstanceAfterSuspenseInstance,Xe=e.commitHydratedContainer,Ke=e.commitHydratedSuspenseInstance,Ye=e.clearSuspenseBoundary,Qe=e.clearSuspenseBoundaryFromContainer,Ze=e.shouldDeleteUnhydratedTailInstances,Je=e.didNotMatchHydratedContainerTextInstance,$e=e.didNotMatchHydratedTextInstance;function et(e){if(void 0===N)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);N=t&&t[1]||""}return"\n"+N+e}var tt=!1;function nt(e,t){if(!e||tt)return"";tt=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(t,[])}catch(c){var r=c}Reflect.construct(e,[],t)}else{try{t.call()}catch(c){r=c}e.call(t.prototype)}else{try{throw Error()}catch(c){r=c}e()}}catch(c){if(c&&r&&"string"===typeof c.stack){for(var a=c.stack.split("\n"),i=r.stack.split("\n"),o=a.length-1,s=i.length-1;1<=o&&0<=s&&a[o]!==i[s];)s--;for(;1<=o&&0<=s;o--,s--)if(a[o]!==i[s]){if(1!==o||1!==s)do{if(o--,0>--s||a[o]!==i[s]){var u="\n"+a[o].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=o&&0<=s);break}}}finally{tt=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?et(e):""}var rt=Object.prototype.hasOwnProperty,at=[],it=-1;function ot(e){return{current:e}}function st(e){0>it||(e.current=at[it],at[it]=null,it--)}function ut(e,t){it++,at[it]=e.current,e.current=t}var ct={},lt=ot(ct),ht=ot(!1),ft=ct;function dt(e,t){var n=e.type.contextTypes;if(!n)return ct;var r=e.stateNode;if(r&&r.__reactInternalMemoizedUnmaskedChildContext===t)return r.__reactInternalMemoizedMaskedChildContext;var a,i={};for(a in n)i[a]=t[a];return r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=i),i}function pt(e){return null!==(e=e.childContextTypes)&&void 0!==e}function vt(){st(ht),st(lt)}function mt(e,t,n){if(lt.current!==ct)throw Error(o(168));ut(lt,t),ut(ht,n)}function gt(e,t,n){var r=e.stateNode;if(t=t.childContextTypes,"function"!==typeof r.getChildContext)return n;for(var a in r=r.getChildContext())if(!(a in t))throw Error(o(108,S(e)||"Unknown",a));return i({},n,r)}function yt(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||ct,ft=lt.current,ut(lt,e),ut(ht,ht.current),!0}function bt(e,t,n){var r=e.stateNode;if(!r)throw Error(o(169));n?(e=gt(e,t,ft),r.__reactInternalMemoizedMergedChildContext=e,st(ht),st(lt),ut(lt,e)):st(ht),ut(ht,n)}var xt=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(kt(e)/wt|0)|0},kt=Math.log,wt=Math.LN2;var _t=64,St=4194304;function Ct(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return 4194240&e;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return 130023424&e;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Tt(e,t){var n=e.pendingLanes;if(0===n)return 0;var r=0,a=e.suspendedLanes,i=e.pingedLanes,o=268435455&n;if(0!==o){var s=o&~a;0!==s?r=Ct(s):0!==(i&=o)&&(r=Ct(i))}else 0!==(o=n&~a)?r=Ct(o):0!==i&&(r=Ct(i));if(0===r)return 0;if(0!==t&&t!==r&&0===(t&a)&&((a=r&-r)>=(i=t&-t)||16===a&&0!==(4194240&i)))return t;if(0!==(4&r)&&(r|=16&n),0!==(t=e.entangledLanes))for(e=e.entanglements,t&=r;0<t;)a=1<<(n=31-xt(t)),r|=e[n],t&=~a;return r}function Et(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function It(e){return 0!==(e=-1073741825&e.pendingLanes)?e:1073741824&e?1073741824:0}function At(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Mt(e,t,n){e.pendingLanes|=t,536870912!==t&&(e.suspendedLanes=0,e.pingedLanes=0),(e=e.eventTimes)[t=31-xt(t)]=n}function Nt(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var r=31-xt(n),a=1<<r;a&t|e[r]&t&&(e[r]|=t),n&=~a}}var Rt=0;function Dt(e){return 1<(e&=-e)?4<e?0!==(268435455&e)?16:536870912:4:1}var Pt=a.unstable_scheduleCallback,Ot=a.unstable_cancelCallback,Lt=a.unstable_shouldYield,Ft=a.unstable_requestPaint,zt=a.unstable_now,Bt=a.unstable_ImmediatePriority,Ut=a.unstable_UserBlockingPriority,Vt=a.unstable_NormalPriority,Wt=a.unstable_IdlePriority,Gt=null,jt=null;var qt="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t},Ht=null,Xt=!1,Kt=!1;function Yt(e){null===Ht?Ht=[e]:Ht.push(e)}function Qt(){if(!Kt&&null!==Ht){Kt=!0;var e=0,t=Rt;try{var n=Ht;for(Rt=1;e<n.length;e++){var r=n[e];do{r=r(!0)}while(null!==r)}Ht=null,Xt=!1}catch(a){throw null!==Ht&&(Ht=Ht.slice(e+1)),Pt(Bt,Qt),a}finally{Rt=t,Kt=!1}}return null}var Zt=s.ReactCurrentBatchConfig;function Jt(e,t){if(qt(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var n=Object.keys(e),r=Object.keys(t);if(n.length!==r.length)return!1;for(r=0;r<n.length;r++){var a=n[r];if(!rt.call(t,a)||!qt(e[a],t[a]))return!1}return!0}function $t(e){switch(e.tag){case 5:return et(e.type);case 16:return et("Lazy");case 13:return et("Suspense");case 19:return et("SuspenseList");case 0:case 2:case 15:return e=nt(e.type,!1);case 11:return e=nt(e.type.render,!1);case 1:return e=nt(e.type,!0);default:return""}}function en(e,t){if(e&&e.defaultProps){for(var n in t=i({},t),e=e.defaultProps)void 0===t[n]&&(t[n]=e[n]);return t}return t}var tn=ot(null),nn=null,rn=null,an=null;function on(){an=rn=nn=null}function sn(e,t,n){X?(ut(tn,t._currentValue),t._currentValue=n):(ut(tn,t._currentValue2),t._currentValue2=n)}function un(e){var t=tn.current;st(tn),X?e._currentValue=t:e._currentValue2=t}function cn(e,t,n){for(;null!==e;){var r=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==r&&(r.childLanes|=t)):null!==r&&(r.childLanes&t)!==t&&(r.childLanes|=t),e===n)break;e=e.return}}function ln(e,t){nn=e,an=rn=null,null!==(e=e.dependencies)&&null!==e.firstContext&&(0!==(e.lanes&t)&&(La=!0),e.firstContext=null)}function hn(e){var t=X?e._currentValue:e._currentValue2;if(an!==e)if(e={context:e,memoizedValue:t,next:null},null===rn){if(null===nn)throw Error(o(308));rn=e,nn.dependencies={lanes:0,firstContext:e}}else rn=rn.next=e;return t}var fn=null,dn=!1;function pn(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function vn(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function mn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function gn(e,t){var n=e.updateQueue;null!==n&&(n=n.shared,null!==Ki&&0!==(1&e.mode)&&0===(2&Xi)?(null===(e=n.interleaved)?(t.next=t,null===fn?fn=[n]:fn.push(n)):(t.next=e.next,e.next=t),n.interleaved=t):(null===(e=n.pending)?t.next=t:(t.next=e.next,e.next=t),n.pending=t))}function yn(e,t,n){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194240&n))){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Nt(e,n)}}function bn(e,t){var n=e.updateQueue,r=e.alternate;if(null!==r&&n===(r=r.updateQueue)){var a=null,i=null;if(null!==(n=n.firstBaseUpdate)){do{var o={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};null===i?a=i=o:i=i.next=o,n=n.next}while(null!==n);null===i?a=i=t:i=i.next=t}else a=i=t;return n={baseState:r.baseState,firstBaseUpdate:a,lastBaseUpdate:i,shared:r.shared,effects:r.effects},void(e.updateQueue=n)}null===(e=n.lastBaseUpdate)?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function xn(e,t,n,r){var a=e.updateQueue;dn=!1;var o=a.firstBaseUpdate,s=a.lastBaseUpdate,u=a.shared.pending;if(null!==u){a.shared.pending=null;var c=u,l=c.next;c.next=null,null===s?o=l:s.next=l,s=c;var h=e.alternate;null!==h&&((u=(h=h.updateQueue).lastBaseUpdate)!==s&&(null===u?h.firstBaseUpdate=l:u.next=l,h.lastBaseUpdate=c))}if(null!==o){var f=a.baseState;for(s=0,h=l=c=null,u=o;;){var d=u.lane,p=u.eventTime;if((r&d)===d){null!==h&&(h=h.next={eventTime:p,lane:0,tag:u.tag,payload:u.payload,callback:u.callback,next:null});e:{var v=e,m=u;switch(d=t,p=n,m.tag){case 1:if("function"===typeof(v=m.payload)){f=v.call(p,f,d);break e}f=v;break e;case 3:v.flags=-65537&v.flags|128;case 0:if(null===(d="function"===typeof(v=m.payload)?v.call(p,f,d):v)||void 0===d)break e;f=i({},f,d);break e;case 2:dn=!0}}null!==u.callback&&0!==u.lane&&(e.flags|=64,null===(d=a.effects)?a.effects=[u]:d.push(u))}else p={eventTime:p,lane:d,tag:u.tag,payload:u.payload,callback:u.callback,next:null},null===h?(l=h=p,c=f):h=h.next=p,s|=d;if(null===(u=u.next)){if(null===(u=a.shared.pending))break;u=(d=u).next,d.next=null,a.lastBaseUpdate=d,a.shared.pending=null}}if(null===h&&(c=f),a.baseState=c,a.firstBaseUpdate=l,a.lastBaseUpdate=h,null!==(t=a.shared.interleaved)){a=t;do{s|=a.lane,a=a.next}while(a!==t)}else null===o&&(a.shared.lanes=0);to|=s,e.lanes=s,e.memoizedState=f}}function kn(e,t,n){if(e=t.effects,t.effects=null,null!==e)for(t=0;t<e.length;t++){var r=e[t],a=r.callback;if(null!==a){if(r.callback=null,r=n,"function"!==typeof a)throw Error(o(191,a));a.call(r)}}}var wn=(new r.Component).refs;function _n(e,t,n,r){n=null===(n=n(r,t=e.memoizedState))||void 0===n?t:i({},t,n),e.memoizedState=n,0===e.lanes&&(e.updateQueue.baseState=n)}var Sn={isMounted:function(e){return!!(e=e._reactInternals)&&C(e)===e},enqueueSetState:function(e,t,n){e=e._reactInternals;var r=ko(),a=wo(e),i=mn(r,a);i.payload=t,void 0!==n&&null!==n&&(i.callback=n),gn(e,i),null!==(t=_o(e,a,r))&&yn(t,e,a)},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var r=ko(),a=wo(e),i=mn(r,a);i.tag=1,i.payload=t,void 0!==n&&null!==n&&(i.callback=n),gn(e,i),null!==(t=_o(e,a,r))&&yn(t,e,a)},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=ko(),r=wo(e),a=mn(n,r);a.tag=2,void 0!==t&&null!==t&&(a.callback=t),gn(e,a),null!==(t=_o(e,r,n))&&yn(t,e,r)}};function Cn(e,t,n,r,a,i,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(r,i,o):!t.prototype||!t.prototype.isPureReactComponent||(!Jt(n,r)||!Jt(a,i))}function Tn(e,t,n){var r=!1,a=ct,i=t.contextType;return"object"===typeof i&&null!==i?i=hn(i):(a=pt(t)?ft:lt.current,i=(r=null!==(r=t.contextTypes)&&void 0!==r)?dt(e,a):ct),t=new t(n,i),e.memoizedState=null!==t.state&&void 0!==t.state?t.state:null,t.updater=Sn,e.stateNode=t,t._reactInternals=e,r&&((e=e.stateNode).__reactInternalMemoizedUnmaskedChildContext=a,e.__reactInternalMemoizedMaskedChildContext=i),t}function En(e,t,n,r){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(n,r),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(n,r),t.state!==e&&Sn.enqueueReplaceState(t,t.state,null)}function In(e,t,n,r){var a=e.stateNode;a.props=n,a.state=e.memoizedState,a.refs=wn,pn(e);var i=t.contextType;"object"===typeof i&&null!==i?a.context=hn(i):(i=pt(t)?ft:lt.current,a.context=dt(e,i)),a.state=e.memoizedState,"function"===typeof(i=t.getDerivedStateFromProps)&&(_n(e,t,i,n),a.state=e.memoizedState),"function"===typeof t.getDerivedStateFromProps||"function"===typeof a.getSnapshotBeforeUpdate||"function"!==typeof a.UNSAFE_componentWillMount&&"function"!==typeof a.componentWillMount||(t=a.state,"function"===typeof a.componentWillMount&&a.componentWillMount(),"function"===typeof a.UNSAFE_componentWillMount&&a.UNSAFE_componentWillMount(),t!==a.state&&Sn.enqueueReplaceState(a,a.state,null),xn(e,n,a,r),a.state=e.memoizedState),"function"===typeof a.componentDidMount&&(e.flags|=4194308)}var An=[],Mn=0,Nn=null,Rn=0,Dn=[],Pn=0,On=null,Ln=1,Fn="";function zn(e,t){An[Mn++]=Rn,An[Mn++]=Nn,Nn=e,Rn=t}function Bn(e,t,n){Dn[Pn++]=Ln,Dn[Pn++]=Fn,Dn[Pn++]=On,On=e;var r=Ln;e=Fn;var a=32-xt(r)-1;r&=~(1<<a),n+=1;var i=32-xt(t)+a;if(30<i){var o=a-a%5;i=(r&(1<<o)-1).toString(32),r>>=o,a-=o,Ln=1<<32-xt(t)+a|n<<a|r,Fn=i+e}else Ln=1<<i|n<<a|r,Fn=e}function Un(e){null!==e.return&&(zn(e,1),Bn(e,1,0))}function Vn(e){for(;e===Nn;)Nn=An[--Mn],An[Mn]=null,Rn=An[--Mn],An[Mn]=null;for(;e===On;)On=Dn[--Pn],Dn[Pn]=null,Fn=Dn[--Pn],Dn[Pn]=null,Ln=Dn[--Pn],Dn[Pn]=null}var Wn=null,Gn=null,jn=!1,qn=!1,Hn=null;function Xn(e,t){var n=Jo(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,null===(t=e.deletions)?(e.deletions=[n],e.flags|=16):t.push(n)}function Kn(e,t){switch(e.tag){case 5:return null!==(t=De(t,e.type,e.pendingProps))&&(e.stateNode=t,Wn=e,Gn=Ue(t),!0);case 6:return null!==(t=Pe(t,e.pendingProps))&&(e.stateNode=t,Wn=e,Gn=null,!0);case 13:if(null!==(t=Oe(t))){var n=null!==On?{id:Ln,overflow:Fn}:null;return e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},(n=Jo(18,null,null,0)).stateNode=t,n.return=e,e.child=n,Wn=e,Gn=null,!0}return!1;default:return!1}}function Yn(e){return 0!==(1&e.mode)&&0===(128&e.flags)}function Qn(e){if(jn){var t=Gn;if(t){var n=t;if(!Kn(e,t)){if(Yn(e))throw Error(o(418));t=Be(n);var r=Wn;t&&Kn(e,t)?Xn(r,n):(e.flags=-4097&e.flags|2,jn=!1,Wn=e)}}else{if(Yn(e))throw Error(o(418));e.flags=-4097&e.flags|2,jn=!1,Wn=e}}}function Zn(e){for(e=e.return;null!==e&&5!==e.tag&&3!==e.tag&&13!==e.tag;)e=e.return;Wn=e}function Jn(e){if(!Q||e!==Wn)return!1;if(!jn)return Zn(e),jn=!0,!1;if(3!==e.tag&&(5!==e.tag||Ze(e.type)&&!W(e.type,e.memoizedProps))){var t=Gn;if(t){if(Yn(e)){for(e=Gn;e;)e=Be(e);throw Error(o(418))}for(;t;)Xn(e,t),t=Be(t)}}if(Zn(e),13===e.tag){if(!Q)throw Error(o(316));if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));Gn=He(e)}else Gn=Wn?Be(e.stateNode):null;return!0}function $n(){Q&&(Gn=Wn=null,qn=jn=!1)}function er(e){null===Hn?Hn=[e]:Hn.push(e)}function tr(e,t,n){if(null!==(e=n.ref)&&"function"!==typeof e&&"object"!==typeof e){if(n._owner){if(n=n._owner){if(1!==n.tag)throw Error(o(309));var r=n.stateNode}if(!r)throw Error(o(147,e));var a=r,i=""+e;return null!==t&&null!==t.ref&&"function"===typeof t.ref&&t.ref._stringRef===i?t.ref:(t=function(e){var t=a.refs;t===wn&&(t=a.refs={}),null===e?delete t[i]:t[i]=e},t._stringRef=i,t)}if("string"!==typeof e)throw Error(o(284));if(!n._owner)throw Error(o(290,e))}return e}function nr(e,t){throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function rr(e){return(0,e._init)(e._payload)}function ar(e){function t(t,n){if(e){var r=t.deletions;null===r?(t.deletions=[n],t.flags|=16):r.push(n)}}function n(n,r){if(!e)return null;for(;null!==r;)t(n,r),r=r.sibling;return null}function r(e,t){for(e=new Map;null!==t;)null!==t.key?e.set(t.key,t):e.set(t.index,t),t=t.sibling;return e}function a(e,t){return(e=es(e,t)).index=0,e.sibling=null,e}function i(t,n,r){return t.index=r,e?null!==(r=t.alternate)?(r=r.index)<n?(t.flags|=2,n):r:(t.flags|=2,n):(t.flags|=1048576,n)}function s(t){return e&&null===t.alternate&&(t.flags|=2),t}function h(e,t,n,r){return null===t||6!==t.tag?((t=as(n,e.mode,r)).return=e,t):((t=a(t,n)).return=e,t)}function f(e,t,n,r){var i=n.type;return i===l?p(e,t,n.props.children,r,n.key):null!==t&&(t.elementType===i||"object"===typeof i&&null!==i&&i.$$typeof===b&&rr(i)===t.type)?((r=a(t,n.props)).ref=tr(e,t,n),r.return=e,r):((r=ts(n.type,n.key,n.props,null,e.mode,r)).ref=tr(e,t,n),r.return=e,r)}function d(e,t,n,r){return null===t||4!==t.tag||t.stateNode.containerInfo!==n.containerInfo||t.stateNode.implementation!==n.implementation?((t=is(n,e.mode,r)).return=e,t):((t=a(t,n.children||[])).return=e,t)}function p(e,t,n,r,i){return null===t||7!==t.tag?((t=ns(n,e.mode,r,i)).return=e,t):((t=a(t,n)).return=e,t)}function v(e,t,n){if("string"===typeof t&&""!==t||"number"===typeof t)return(t=as(""+t,e.mode,n)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case u:return(n=ts(t.type,t.key,t.props,null,e.mode,n)).ref=tr(e,null,t),n.return=e,n;case c:return(t=is(t,e.mode,n)).return=e,t;case b:return v(e,(0,t._init)(t._payload),n)}if(R(t)||w(t))return(t=ns(t,e.mode,n,null)).return=e,t;nr(e,t)}return null}function m(e,t,n,r){var a=null!==t?t.key:null;if("string"===typeof n&&""!==n||"number"===typeof n)return null!==a?null:h(e,t,""+n,r);if("object"===typeof n&&null!==n){switch(n.$$typeof){case u:return n.key===a?f(e,t,n,r):null;case c:return n.key===a?d(e,t,n,r):null;case b:return m(e,t,(a=n._init)(n._payload),r)}if(R(n)||w(n))return null!==a?null:p(e,t,n,r,null);nr(e,n)}return null}function g(e,t,n,r,a){if("string"===typeof r&&""!==r||"number"===typeof r)return h(t,e=e.get(n)||null,""+r,a);if("object"===typeof r&&null!==r){switch(r.$$typeof){case u:return f(t,e=e.get(null===r.key?n:r.key)||null,r,a);case c:return d(t,e=e.get(null===r.key?n:r.key)||null,r,a);case b:return g(e,t,n,(0,r._init)(r._payload),a)}if(R(r)||w(r))return p(t,e=e.get(n)||null,r,a,null);nr(t,r)}return null}function y(a,o,s,u){for(var c=null,l=null,h=o,f=o=0,d=null;null!==h&&f<s.length;f++){h.index>f?(d=h,h=null):d=h.sibling;var p=m(a,h,s[f],u);if(null===p){null===h&&(h=d);break}e&&h&&null===p.alternate&&t(a,h),o=i(p,o,f),null===l?c=p:l.sibling=p,l=p,h=d}if(f===s.length)return n(a,h),jn&&zn(a,f),c;if(null===h){for(;f<s.length;f++)null!==(h=v(a,s[f],u))&&(o=i(h,o,f),null===l?c=h:l.sibling=h,l=h);return jn&&zn(a,f),c}for(h=r(a,h);f<s.length;f++)null!==(d=g(h,a,f,s[f],u))&&(e&&null!==d.alternate&&h.delete(null===d.key?f:d.key),o=i(d,o,f),null===l?c=d:l.sibling=d,l=d);return e&&h.forEach((function(e){return t(a,e)})),jn&&zn(a,f),c}function x(a,s,u,c){var l=w(u);if("function"!==typeof l)throw Error(o(150));if(null==(u=l.call(u)))throw Error(o(151));for(var h=l=null,f=s,d=s=0,p=null,y=u.next();null!==f&&!y.done;d++,y=u.next()){f.index>d?(p=f,f=null):p=f.sibling;var b=m(a,f,y.value,c);if(null===b){null===f&&(f=p);break}e&&f&&null===b.alternate&&t(a,f),s=i(b,s,d),null===h?l=b:h.sibling=b,h=b,f=p}if(y.done)return n(a,f),jn&&zn(a,d),l;if(null===f){for(;!y.done;d++,y=u.next())null!==(y=v(a,y.value,c))&&(s=i(y,s,d),null===h?l=y:h.sibling=y,h=y);return jn&&zn(a,d),l}for(f=r(a,f);!y.done;d++,y=u.next())null!==(y=g(f,a,d,y.value,c))&&(e&&null!==y.alternate&&f.delete(null===y.key?d:y.key),s=i(y,s,d),null===h?l=y:h.sibling=y,h=y);return e&&f.forEach((function(e){return t(a,e)})),jn&&zn(a,d),l}return function e(r,i,o,h){if("object"===typeof o&&null!==o&&o.type===l&&null===o.key&&(o=o.props.children),"object"===typeof o&&null!==o){switch(o.$$typeof){case u:e:{for(var f=o.key,d=i;null!==d;){if(d.key===f){if((f=o.type)===l){if(7===d.tag){n(r,d.sibling),(i=a(d,o.props.children)).return=r,r=i;break e}}else if(d.elementType===f||"object"===typeof f&&null!==f&&f.$$typeof===b&&rr(f)===d.type){n(r,d.sibling),(i=a(d,o.props)).ref=tr(r,d,o),i.return=r,r=i;break e}n(r,d);break}t(r,d),d=d.sibling}o.type===l?((i=ns(o.props.children,r.mode,h,o.key)).return=r,r=i):((h=ts(o.type,o.key,o.props,null,r.mode,h)).ref=tr(r,i,o),h.return=r,r=h)}return s(r);case c:e:{for(d=o.key;null!==i;){if(i.key===d){if(4===i.tag&&i.stateNode.containerInfo===o.containerInfo&&i.stateNode.implementation===o.implementation){n(r,i.sibling),(i=a(i,o.children||[])).return=r,r=i;break e}n(r,i);break}t(r,i),i=i.sibling}(i=is(o,r.mode,h)).return=r,r=i}return s(r);case b:return e(r,i,(d=o._init)(o._payload),h)}if(R(o))return y(r,i,o,h);if(w(o))return x(r,i,o,h);nr(r,o)}return"string"===typeof o&&""!==o||"number"===typeof o?(o=""+o,null!==i&&6===i.tag?(n(r,i.sibling),(i=a(i,o)).return=r,r=i):(n(r,i),(i=as(o,r.mode,h)).return=r,r=i),s(r)):n(r,i)}}var ir=ar(!0),or=ar(!1),sr={},ur=ot(sr),cr=ot(sr),lr=ot(sr);function hr(e){if(e===sr)throw Error(o(174));return e}function fr(e,t){ut(lr,t),ut(cr,e),ut(ur,sr),e=P(t),st(ur),ut(ur,e)}function dr(){st(ur),st(cr),st(lr)}function pr(e){var t=hr(lr.current),n=hr(ur.current);n!==(t=O(n,e.type,t))&&(ut(cr,e),ut(ur,t))}function vr(e){cr.current===e&&(st(ur),st(cr))}var mr=ot(0);function gr(e){for(var t=e;null!==t;){if(13===t.tag){var n=t.memoizedState;if(null!==n&&(null===(n=n.dehydrated)||Le(n)||Fe(n)))return t}else if(19===t.tag&&void 0!==t.memoizedProps.revealOrder){if(0!==(128&t.flags))return t}else if(null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var yr=[];function br(){for(var e=0;e<yr.length;e++){var t=yr[e];X?t._workInProgressVersionPrimary=null:t._workInProgressVersionSecondary=null}yr.length=0}var xr=s.ReactCurrentDispatcher,kr=s.ReactCurrentBatchConfig,wr=0,_r=null,Sr=null,Cr=null,Tr=!1,Er=!1,Ir=0,Ar=0;function Mr(){throw Error(o(321))}function Nr(e,t){if(null===t)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!qt(e[n],t[n]))return!1;return!0}function Rr(e,t,n,r,a,i){if(wr=i,_r=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,xr.current=null===e||null===e.memoizedState?pa:va,e=n(r,a),Er){i=0;do{if(Er=!1,Ir=0,25<=i)throw Error(o(301));i+=1,Cr=Sr=null,t.updateQueue=null,xr.current=ma,e=n(r,a)}while(Er)}if(xr.current=da,t=null!==Sr&&null!==Sr.next,wr=0,Cr=Sr=_r=null,Tr=!1,t)throw Error(o(300));return e}function Dr(){var e=0!==Ir;return Ir=0,e}function Pr(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Cr?_r.memoizedState=Cr=e:Cr=Cr.next=e,Cr}function Or(){if(null===Sr){var e=_r.alternate;e=null!==e?e.memoizedState:null}else e=Sr.next;var t=null===Cr?_r.memoizedState:Cr.next;if(null!==t)Cr=t,Sr=e;else{if(null===e)throw Error(o(310));e={memoizedState:(Sr=e).memoizedState,baseState:Sr.baseState,baseQueue:Sr.baseQueue,queue:Sr.queue,next:null},null===Cr?_r.memoizedState=Cr=e:Cr=Cr.next=e}return Cr}function Lr(e,t){return"function"===typeof t?t(e):t}function Fr(e){var t=Or(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=Sr,a=r.baseQueue,i=n.pending;if(null!==i){if(null!==a){var s=a.next;a.next=i.next,i.next=s}r.baseQueue=a=i,n.pending=null}if(null!==a){i=a.next,r=r.baseState;var u=s=null,c=null,l=i;do{var h=l.lane;if((wr&h)===h)null!==c&&(c=c.next={lane:0,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null}),r=l.hasEagerState?l.eagerState:e(r,l.action);else{var f={lane:h,action:l.action,hasEagerState:l.hasEagerState,eagerState:l.eagerState,next:null};null===c?(u=c=f,s=r):c=c.next=f,_r.lanes|=h,to|=h}l=l.next}while(null!==l&&l!==i);null===c?s=r:c.next=u,qt(r,t.memoizedState)||(La=!0),t.memoizedState=r,t.baseState=s,t.baseQueue=c,n.lastRenderedState=r}if(null!==(e=n.interleaved)){a=e;do{i=a.lane,_r.lanes|=i,to|=i,a=a.next}while(a!==e)}else null===a&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function zr(e){var t=Or(),n=t.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=e;var r=n.dispatch,a=n.pending,i=t.memoizedState;if(null!==a){n.pending=null;var s=a=a.next;do{i=e(i,s.action),s=s.next}while(s!==a);qt(i,t.memoizedState)||(La=!0),t.memoizedState=i,null===t.baseQueue&&(t.baseState=i),n.lastRenderedState=i}return[i,r]}function Br(){}function Ur(e,t){var n=_r,r=Or(),a=t(),i=!qt(r.memoizedState,a);if(i&&(r.memoizedState=a,La=!0),r=r.queue,Zr(Gr.bind(null,n,r,e),[e]),r.getSnapshot!==t||i||null!==Cr&&1&Cr.memoizedState.tag){if(n.flags|=2048,Hr(9,Wr.bind(null,n,r,a,t),void 0,null),null===Ki)throw Error(o(349));0!==(30&wr)||Vr(n,t,a)}return a}function Vr(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},null===(t=_r.updateQueue)?(t={lastEffect:null,stores:null},_r.updateQueue=t,t.stores=[e]):null===(n=t.stores)?t.stores=[e]:n.push(e)}function Wr(e,t,n,r){t.value=n,t.getSnapshot=r,jr(t)&&_o(e,1,-1)}function Gr(e,t,n){return n((function(){jr(t)&&_o(e,1,-1)}))}function jr(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!qt(e,n)}catch(r){return!0}}function qr(e){var t=Pr();return"function"===typeof e&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:Lr,lastRenderedState:e},t.queue=e,e=e.dispatch=ua.bind(null,_r,e),[t.memoizedState,e]}function Hr(e,t,n,r){return e={tag:e,create:t,destroy:n,deps:r,next:null},null===(t=_r.updateQueue)?(t={lastEffect:null,stores:null},_r.updateQueue=t,t.lastEffect=e.next=e):null===(n=t.lastEffect)?t.lastEffect=e.next=e:(r=n.next,n.next=e,e.next=r,t.lastEffect=e),e}function Xr(){return Or().memoizedState}function Kr(e,t,n,r){var a=Pr();_r.flags|=e,a.memoizedState=Hr(1|t,n,void 0,void 0===r?null:r)}function Yr(e,t,n,r){var a=Or();r=void 0===r?null:r;var i=void 0;if(null!==Sr){var o=Sr.memoizedState;if(i=o.destroy,null!==r&&Nr(r,o.deps))return void(a.memoizedState=Hr(t,n,i,r))}_r.flags|=e,a.memoizedState=Hr(1|t,n,i,r)}function Qr(e,t){return Kr(8390656,8,e,t)}function Zr(e,t){return Yr(2048,8,e,t)}function Jr(e,t){return Yr(4,2,e,t)}function $r(e,t){return Yr(4,4,e,t)}function ea(e,t){return"function"===typeof t?(e=e(),t(e),function(){t(null)}):null!==t&&void 0!==t?(e=e(),t.current=e,function(){t.current=null}):void 0}function ta(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Yr(4,4,ea.bind(null,t,e),n)}function na(){}function ra(e,t){var n=Or();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Nr(t,r[1])?r[0]:(n.memoizedState=[e,t],e)}function aa(e,t){var n=Or();t=void 0===t?null:t;var r=n.memoizedState;return null!==r&&null!==t&&Nr(t,r[1])?r[0]:(e=e(),n.memoizedState=[e,t],e)}function ia(e,t){var n=Rt;Rt=0!==n&&4>n?n:4,e(!0);var r=kr.transition;kr.transition={};try{e(!1),t()}finally{Rt=n,kr.transition=r}}function oa(){return Or().memoizedState}function sa(e,t,n){var r=wo(e);n={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null},ca(e)?la(t,n):(ha(e,t,n),null!==(e=_o(e,r,n=ko()))&&fa(e,t,r))}function ua(e,t,n){var r=wo(e),a={lane:r,action:n,hasEagerState:!1,eagerState:null,next:null};if(ca(e))la(t,a);else{ha(e,t,a);var i=e.alternate;if(0===e.lanes&&(null===i||0===i.lanes)&&null!==(i=t.lastRenderedReducer))try{var o=t.lastRenderedState,s=i(o,n);if(a.hasEagerState=!0,a.eagerState=s,qt(s,o))return}catch(u){}null!==(e=_o(e,r,n=ko()))&&fa(e,t,r)}}function ca(e){var t=e.alternate;return e===_r||null!==t&&t===_r}function la(e,t){Er=Tr=!0;var n=e.pending;null===n?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function ha(e,t,n){null!==Ki&&0!==(1&e.mode)&&0===(2&Xi)?(null===(e=t.interleaved)?(n.next=n,null===fn?fn=[t]:fn.push(t)):(n.next=e.next,e.next=n),t.interleaved=n):(null===(e=t.pending)?n.next=n:(n.next=e.next,e.next=n),t.pending=n)}function fa(e,t,n){if(0!==(4194240&n)){var r=t.lanes;n|=r&=e.pendingLanes,t.lanes=n,Nt(e,n)}}var da={readContext:hn,useCallback:Mr,useContext:Mr,useEffect:Mr,useImperativeHandle:Mr,useInsertionEffect:Mr,useLayoutEffect:Mr,useMemo:Mr,useReducer:Mr,useRef:Mr,useState:Mr,useDebugValue:Mr,useDeferredValue:Mr,useTransition:Mr,useMutableSource:Mr,useSyncExternalStore:Mr,useId:Mr,unstable_isNewReconciler:!1},pa={readContext:hn,useCallback:function(e,t){return Pr().memoizedState=[e,void 0===t?null:t],e},useContext:hn,useEffect:Qr,useImperativeHandle:function(e,t,n){return n=null!==n&&void 0!==n?n.concat([e]):null,Kr(4194308,4,ea.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Kr(4194308,4,e,t)},useInsertionEffect:function(e,t){return Kr(4,2,e,t)},useMemo:function(e,t){var n=Pr();return t=void 0===t?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var r=Pr();return t=void 0!==n?n(t):t,r.memoizedState=r.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},r.queue=e,e=e.dispatch=sa.bind(null,_r,e),[r.memoizedState,e]},useRef:function(e){return e={current:e},Pr().memoizedState=e},useState:qr,useDebugValue:na,useDeferredValue:function(e){var t=qr(e),n=t[0],r=t[1];return Qr((function(){var t=kr.transition;kr.transition={};try{r(e)}finally{kr.transition=t}}),[e]),n},useTransition:function(){var e=qr(!1),t=e[0];return e=ia.bind(null,e[1]),Pr().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var r=_r,a=Pr();if(jn){if(void 0===n)throw Error(o(407));n=n()}else{if(n=t(),null===Ki)throw Error(o(349));0!==(30&wr)||Vr(r,t,n)}a.memoizedState=n;var i={value:n,getSnapshot:t};return a.queue=i,Qr(Gr.bind(null,r,i,e),[e]),r.flags|=2048,Hr(9,Wr.bind(null,r,i,n,t),void 0,null),n},useId:function(){var e=Pr(),t=Ki.identifierPrefix;if(jn){var n=Fn;t=":"+t+"R"+(n=(Ln&~(1<<32-xt(Ln)-1)).toString(32)+n),0<(n=Ir++)&&(t+="H"+n.toString(32)),t+=":"}else t=":"+t+"r"+(n=Ar++).toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},va={readContext:hn,useCallback:ra,useContext:hn,useEffect:Zr,useImperativeHandle:ta,useInsertionEffect:Jr,useLayoutEffect:$r,useMemo:aa,useReducer:Fr,useRef:Xr,useState:function(){return Fr(Lr)},useDebugValue:na,useDeferredValue:function(e){var t=Fr(Lr),n=t[0],r=t[1];return Zr((function(){var t=kr.transition;kr.transition={};try{r(e)}finally{kr.transition=t}}),[e]),n},useTransition:function(){return[Fr(Lr)[0],Or().memoizedState]},useMutableSource:Br,useSyncExternalStore:Ur,useId:oa,unstable_isNewReconciler:!1},ma={readContext:hn,useCallback:ra,useContext:hn,useEffect:Zr,useImperativeHandle:ta,useInsertionEffect:Jr,useLayoutEffect:$r,useMemo:aa,useReducer:zr,useRef:Xr,useState:function(){return zr(Lr)},useDebugValue:na,useDeferredValue:function(e){var t=zr(Lr),n=t[0],r=t[1];return Zr((function(){var t=kr.transition;kr.transition={};try{r(e)}finally{kr.transition=t}}),[e]),n},useTransition:function(){return[zr(Lr)[0],Or().memoizedState]},useMutableSource:Br,useSyncExternalStore:Ur,useId:oa,unstable_isNewReconciler:!1};function ga(e,t){try{var n="",r=t;do{n+=$t(r),r=r.return}while(r);var a=n}catch(i){a="\nError generating stack: "+i.message+"\n"+i.stack}return{value:e,source:t,stack:a}}function ya(e,t){try{console.error(t.value)}catch(n){setTimeout((function(){throw n}))}}var ba,xa,ka,wa,_a="function"===typeof WeakMap?WeakMap:Map;function Sa(e,t,n){(n=mn(-1,n)).tag=3,n.payload={element:null};var r=t.value;return n.callback=function(){lo||(lo=!0,ho=r),ya(0,t)},n}function Ca(e,t,n){(n=mn(-1,n)).tag=3;var r=e.type.getDerivedStateFromError;if("function"===typeof r){var a=t.value;n.payload=function(){return r(a)},n.callback=function(){ya(0,t)}}var i=e.stateNode;return null!==i&&"function"===typeof i.componentDidCatch&&(n.callback=function(){ya(0,t),"function"!==typeof r&&(null===fo?fo=new Set([this]):fo.add(this));var e=t.stack;this.componentDidCatch(t.value,{componentStack:null!==e?e:""})}),n}function Ta(e,t,n){var r=e.pingCache;if(null===r){r=e.pingCache=new _a;var a=new Set;r.set(t,a)}else void 0===(a=r.get(t))&&(a=new Set,r.set(t,a));a.has(n)||(a.add(n),e=Ho.bind(null,e,t,n),t.then(e,e))}function Ea(e){do{var t;if((t=13===e.tag)&&(t=null===(t=e.memoizedState)||null!==t.dehydrated),t)return e;e=e.return}while(null!==e);return null}function Ia(e,t,n,r,a){return 0===(1&e.mode)?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,1===n.tag&&(null===n.alternate?n.tag=17:((t=mn(-1,1)).tag=2,gn(n,t))),n.lanes|=1),e):(e.flags|=65536,e.lanes=a,e)}function Aa(e){e.flags|=4}function Ma(e,t){if(null!==e&&e.child===t.child)return!0;if(0!==(16&t.flags))return!1;for(e=t.child;null!==e;){if(0!==(12854&e.flags)||0!==(12854&e.subtreeFlags))return!1;e=e.sibling}return!0}if(K)ba=function(e,t){for(var n=t.child;null!==n;){if(5===n.tag||6===n.tag)B(e,n.stateNode);else if(4!==n.tag&&null!==n.child){n.child.return=n,n=n.child;continue}if(n===t)break;for(;null===n.sibling;){if(null===n.return||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},xa=function(){},ka=function(e,t,n,r,a){if((e=e.memoizedProps)!==r){var i=t.stateNode,o=hr(ur.current);n=V(i,n,e,r,a,o),(t.updateQueue=n)&&Aa(t)}},wa=function(e,t,n,r){n!==r&&Aa(t)};else if(Y){ba=function(e,t,n,r){for(var a=t.child;null!==a;){if(5===a.tag){var i=a.stateNode;n&&r&&(i=Ne(i,a.type,a.memoizedProps,a)),B(e,i)}else if(6===a.tag)i=a.stateNode,n&&r&&(i=Re(i,a.memoizedProps,a)),B(e,i);else if(4!==a.tag)if(22===a.tag&&null!==a.memoizedState)null!==(i=a.child)&&(i.return=a),ba(e,a,!0,!0);else if(null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break;for(;null===a.sibling;){if(null===a.return||a.return===t)return;a=a.return}a.sibling.return=a.return,a=a.sibling}};var Na=function e(t,n,r,a){for(var i=n.child;null!==i;){if(5===i.tag){var o=i.stateNode;r&&a&&(o=Ne(o,i.type,i.memoizedProps,i)),Ie(t,o)}else if(6===i.tag)o=i.stateNode,r&&a&&(o=Re(o,i.memoizedProps,i)),Ie(t,o);else if(4!==i.tag)if(22===i.tag&&null!==i.memoizedState)null!==(o=i.child)&&(o.return=i),e(t,i,!0,!0);else if(null!==i.child){i.child.return=i,i=i.child;continue}if(i===n)break;for(;null===i.sibling;){if(null===i.return||i.return===n)return;i=i.return}i.sibling.return=i.return,i=i.sibling}};xa=function(e,t){var n=t.stateNode;if(!Ma(e,t)){e=n.containerInfo;var r=Ee(e);Na(r,t,!1,!1),n.pendingChildren=r,Aa(t),Ae(e,r)}},ka=function(e,t,n,r,a){var i=e.stateNode,o=e.memoizedProps;if((e=Ma(e,t))&&o===r)t.stateNode=i;else{var s=t.stateNode,u=hr(ur.current),c=null;o!==r&&(c=V(s,n,o,r,a,u)),e&&null===c?t.stateNode=i:(i=Te(i,c,n,o,r,t,e,s),U(i,n,r,a,u)&&Aa(t),t.stateNode=i,e?Aa(t):ba(i,t,!1,!1))}},wa=function(e,t,n,r){n!==r?(e=hr(lr.current),n=hr(ur.current),t.stateNode=G(r,e,n,t),Aa(t)):t.stateNode=e.stateNode}}else xa=function(){},ka=function(){},wa=function(){};function Ra(e,t){if(!jn)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;null!==t;)null!==t.alternate&&(n=t),t=t.sibling;null===n?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var r=null;null!==n;)null!==n.alternate&&(r=n),n=n.sibling;null===r?t||null===e.tail?e.tail=null:e.tail.sibling=null:r.sibling=null}}function Da(e){var t=null!==e.alternate&&e.alternate.child===e.child,n=0,r=0;if(t)for(var a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=14680064&a.subtreeFlags,r|=14680064&a.flags,a.return=e,a=a.sibling;else for(a=e.child;null!==a;)n|=a.lanes|a.childLanes,r|=a.subtreeFlags,r|=a.flags,a.return=e,a=a.sibling;return e.subtreeFlags|=r,e.childLanes=n,t}function Pa(e,t,n){var r=t.pendingProps;switch(Vn(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Da(t),null;case 1:case 17:return pt(t.type)&&vt(),Da(t),null;case 3:return r=t.stateNode,dr(),st(ht),st(lt),br(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(Jn(t)?Aa(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,null!==Hn&&(Io(Hn),Hn=null))),xa(e,t),Da(t),null;case 5:vr(t),n=hr(lr.current);var a=t.type;if(null!==e&&null!=t.stateNode)ka(e,t,a,r,n),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!r){if(null===t.stateNode)throw Error(o(166));return Da(t),null}if(e=hr(ur.current),Jn(t)){if(!Q)throw Error(o(175));e=Ge(t.stateNode,t.type,t.memoizedProps,n,e,t,!qn),t.updateQueue=e,null!==e&&Aa(t)}else{var i=z(a,r,n,e,t);ba(i,t,!1,!1),t.stateNode=i,U(i,a,r,n,e)&&Aa(t)}null!==t.ref&&(t.flags|=512,t.flags|=2097152)}return Da(t),null;case 6:if(e&&null!=t.stateNode)wa(e,t,e.memoizedProps,r);else{if("string"!==typeof r&&null===t.stateNode)throw Error(o(166));if(e=hr(lr.current),n=hr(ur.current),Jn(t)){if(!Q)throw Error(o(176));if(e=t.stateNode,r=t.memoizedProps,(n=je(e,r,t,!qn))&&null!==(a=Wn))switch(i=0!==(1&a.mode),a.tag){case 3:Je(a.stateNode.containerInfo,e,r,i);break;case 5:$e(a.type,a.memoizedProps,a.stateNode,e,r,i)}n&&Aa(t)}else t.stateNode=G(r,e,n,t)}return Da(t),null;case 13:if(st(mr),r=t.memoizedState,jn&&null!==Gn&&0!==(1&t.mode)&&0===(128&t.flags)){for(e=Gn;e;)e=Be(e);return $n(),t.flags|=98560,t}if(null!==r&&null!==r.dehydrated){if(r=Jn(t),null===e){if(!r)throw Error(o(318));if(!Q)throw Error(o(344));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(o(317));qe(e,t)}else $n(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;return Da(t),null}return null!==Hn&&(Io(Hn),Hn=null),0!==(128&t.flags)?(t.lanes=n,t):(r=null!==r,n=!1,null===e?Jn(t):n=null!==e.memoizedState,r&&!n&&(t.child.flags|=8192,0!==(1&t.mode)&&(null===e||0!==(1&mr.current)?0===$i&&($i=3):Lo())),null!==t.updateQueue&&(t.flags|=4),Da(t),null);case 4:return dr(),xa(e,t),null===e&&J(t.stateNode.containerInfo),Da(t),null;case 10:return un(t.type._context),Da(t),null;case 19:if(st(mr),null===(a=t.memoizedState))return Da(t),null;if(r=0!==(128&t.flags),null===(i=a.rendering))if(r)Ra(a,!1);else{if(0!==$i||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(i=gr(e))){for(t.flags|=128,Ra(a,!1),null!==(e=i.updateQueue)&&(t.updateQueue=e,t.flags|=4),t.subtreeFlags=0,e=n,r=t.child;null!==r;)a=e,(n=r).flags&=14680066,null===(i=n.alternate)?(n.childLanes=0,n.lanes=a,n.child=null,n.subtreeFlags=0,n.memoizedProps=null,n.memoizedState=null,n.updateQueue=null,n.dependencies=null,n.stateNode=null):(n.childLanes=i.childLanes,n.lanes=i.lanes,n.child=i.child,n.subtreeFlags=0,n.deletions=null,n.memoizedProps=i.memoizedProps,n.memoizedState=i.memoizedState,n.updateQueue=i.updateQueue,n.type=i.type,a=i.dependencies,n.dependencies=null===a?null:{lanes:a.lanes,firstContext:a.firstContext}),r=r.sibling;return ut(mr,1&mr.current|2),t.child}e=e.sibling}null!==a.tail&&zt()>so&&(t.flags|=128,r=!0,Ra(a,!1),t.lanes=4194304)}else{if(!r)if(null!==(e=gr(i))){if(t.flags|=128,r=!0,null!==(e=e.updateQueue)&&(t.updateQueue=e,t.flags|=4),Ra(a,!0),null===a.tail&&"hidden"===a.tailMode&&!i.alternate&&!jn)return Da(t),null}else 2*zt()-a.renderingStartTime>so&&1073741824!==n&&(t.flags|=128,r=!0,Ra(a,!1),t.lanes=4194304);a.isBackwards?(i.sibling=t.child,t.child=i):(null!==(e=a.last)?e.sibling=i:t.child=i,a.last=i)}return null!==a.tail?(t=a.tail,a.rendering=t,a.tail=t.sibling,a.renderingStartTime=zt(),t.sibling=null,e=mr.current,ut(mr,r?1&e|2:1&e),t):(Da(t),null);case 22:case 23:return Ro(),r=null!==t.memoizedState,null!==e&&null!==e.memoizedState!==r&&(t.flags|=8192),r&&0!==(1&t.mode)?0!==(1073741824&Zi)&&(Da(t),K&&6&t.subtreeFlags&&(t.flags|=8192)):Da(t),null;case 24:case 25:return null}throw Error(o(156,t.tag))}var Oa=s.ReactCurrentOwner,La=!1;function Fa(e,t,n,r){t.child=null===e?or(t,null,n,r):ir(t,e.child,n,r)}function za(e,t,n,r,a){n=n.render;var i=t.ref;return ln(t,a),r=Rr(e,t,n,r,i,a),n=Dr(),null===e||La?(jn&&n&&Un(t),t.flags|=1,Fa(e,t,r,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,ai(e,t,a))}function Ba(e,t,n,r,a){if(null===e){var i=n.type;return"function"!==typeof i||$o(i)||void 0!==i.defaultProps||null!==n.compare||void 0!==n.defaultProps?((e=ts(n.type,null,r,t,t.mode,a)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=i,Ua(e,t,i,r,a))}if(i=e.child,0===(e.lanes&a)){var o=i.memoizedProps;if((n=null!==(n=n.compare)?n:Jt)(o,r)&&e.ref===t.ref)return ai(e,t,a)}return t.flags|=1,(e=es(i,r)).ref=t.ref,e.return=t,t.child=e}function Ua(e,t,n,r,a){if(null!==e&&Jt(e.memoizedProps,r)&&e.ref===t.ref){if(La=!1,0===(e.lanes&a))return t.lanes=e.lanes,ai(e,t,a);0!==(131072&e.flags)&&(La=!0)}return Ga(e,t,n,r,a)}function Va(e,t,n){var r=t.pendingProps,a=r.children,i=null!==e?e.memoizedState:null;if("hidden"===r.mode)if(0===(1&t.mode))t.memoizedState={baseLanes:0,cachePool:null},ut(Ji,Zi),Zi|=n;else{if(0===(1073741824&n))return e=null!==i?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null},t.updateQueue=null,ut(Ji,Zi),Zi|=e,null;t.memoizedState={baseLanes:0,cachePool:null},r=null!==i?i.baseLanes:n,ut(Ji,Zi),Zi|=r}else null!==i?(r=i.baseLanes|n,t.memoizedState=null):r=n,ut(Ji,Zi),Zi|=r;return Fa(e,t,a,n),t.child}function Wa(e,t){var n=t.ref;(null===e&&null!==n||null!==e&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function Ga(e,t,n,r,a){var i=pt(n)?ft:lt.current;return i=dt(t,i),ln(t,a),n=Rr(e,t,n,r,i,a),r=Dr(),null===e||La?(jn&&r&&Un(t),t.flags|=1,Fa(e,t,n,a),t.child):(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~a,ai(e,t,a))}function ja(e,t,n,r,a){if(pt(n)){var i=!0;yt(t)}else i=!1;if(ln(t,a),null===t.stateNode)null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),Tn(t,n,r),In(t,n,r,a),r=!0;else if(null===e){var o=t.stateNode,s=t.memoizedProps;o.props=s;var u=o.context,c=n.contextType;"object"===typeof c&&null!==c?c=hn(c):c=dt(t,c=pt(n)?ft:lt.current);var l=n.getDerivedStateFromProps,h="function"===typeof l||"function"===typeof o.getSnapshotBeforeUpdate;h||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==r||u!==c)&&En(t,o,r,c),dn=!1;var f=t.memoizedState;o.state=f,xn(t,r,o,a),u=t.memoizedState,s!==r||f!==u||ht.current||dn?("function"===typeof l&&(_n(t,n,l,r),u=t.memoizedState),(s=dn||Cn(t,n,s,r,f,u,c))?(h||"function"!==typeof o.UNSAFE_componentWillMount&&"function"!==typeof o.componentWillMount||("function"===typeof o.componentWillMount&&o.componentWillMount(),"function"===typeof o.UNSAFE_componentWillMount&&o.UNSAFE_componentWillMount()),"function"===typeof o.componentDidMount&&(t.flags|=4194308)):("function"===typeof o.componentDidMount&&(t.flags|=4194308),t.memoizedProps=r,t.memoizedState=u),o.props=r,o.state=u,o.context=c,r=s):("function"===typeof o.componentDidMount&&(t.flags|=4194308),r=!1)}else{o=t.stateNode,vn(e,t),s=t.memoizedProps,c=t.type===t.elementType?s:en(t.type,s),o.props=c,h=t.pendingProps,f=o.context,"object"===typeof(u=n.contextType)&&null!==u?u=hn(u):u=dt(t,u=pt(n)?ft:lt.current);var d=n.getDerivedStateFromProps;(l="function"===typeof d||"function"===typeof o.getSnapshotBeforeUpdate)||"function"!==typeof o.UNSAFE_componentWillReceiveProps&&"function"!==typeof o.componentWillReceiveProps||(s!==h||f!==u)&&En(t,o,r,u),dn=!1,f=t.memoizedState,o.state=f,xn(t,r,o,a);var p=t.memoizedState;s!==h||f!==p||ht.current||dn?("function"===typeof d&&(_n(t,n,d,r),p=t.memoizedState),(c=dn||Cn(t,n,c,r,f,p,u)||!1)?(l||"function"!==typeof o.UNSAFE_componentWillUpdate&&"function"!==typeof o.componentWillUpdate||("function"===typeof o.componentWillUpdate&&o.componentWillUpdate(r,p,u),"function"===typeof o.UNSAFE_componentWillUpdate&&o.UNSAFE_componentWillUpdate(r,p,u)),"function"===typeof o.componentDidUpdate&&(t.flags|=4),"function"===typeof o.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),t.memoizedProps=r,t.memoizedState=p),o.props=r,o.state=p,o.context=u,r=c):("function"!==typeof o.componentDidUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=4),"function"!==typeof o.getSnapshotBeforeUpdate||s===e.memoizedProps&&f===e.memoizedState||(t.flags|=1024),r=!1)}return qa(e,t,n,r,i,a)}function qa(e,t,n,r,a,i){Wa(e,t);var o=0!==(128&t.flags);if(!r&&!o)return a&&bt(t,n,!1),ai(e,t,i);r=t.stateNode,Oa.current=t;var s=o&&"function"!==typeof n.getDerivedStateFromError?null:r.render();return t.flags|=1,null!==e&&o?(t.child=ir(t,e.child,null,i),t.child=ir(t,null,s,i)):Fa(e,t,s,i),t.memoizedState=r.state,a&&bt(t,n,!0),t.child}function Ha(e){var t=e.stateNode;t.pendingContext?mt(0,t.pendingContext,t.pendingContext!==t.context):t.context&&mt(0,t.context,!1),fr(e,t.containerInfo)}function Xa(e,t,n,r,a){return $n(),er(a),t.flags|=256,Fa(e,t,n,r),t.child}var Ka={dehydrated:null,treeContext:null,retryLane:0};function Ya(e){return{baseLanes:e,cachePool:null}}function Qa(e,t,n){var r,a=t.pendingProps,i=mr.current,s=!1,u=0!==(128&t.flags);if((r=u)||(r=(null===e||null!==e.memoizedState)&&0!==(2&i)),r?(s=!0,t.flags&=-129):null!==e&&null===e.memoizedState||(i|=1),ut(mr,1&i),null===e)return Qn(t),null!==(e=t.memoizedState)&&null!==(e=e.dehydrated)?(0===(1&t.mode)?t.lanes=1:Fe(e)?t.lanes=8:t.lanes=1073741824,null):(i=a.children,e=a.fallback,s?(a=t.mode,s=t.child,i={mode:"hidden",children:i},0===(1&a)&&null!==s?(s.childLanes=0,s.pendingProps=i):s=rs(i,a,0,null),e=ns(e,a,n,null),s.return=t,e.return=t,s.sibling=e,t.child=s,t.child.memoizedState=Ya(n),t.memoizedState=Ka,e):Za(t,i));if(null!==(i=e.memoizedState)){if(null!==(r=i.dehydrated)){if(u)return 256&t.flags?(t.flags&=-257,ei(e,t,n,Error(o(422)))):null!==t.memoizedState?(t.child=e.child,t.flags|=128,null):(s=a.fallback,i=t.mode,a=rs({mode:"visible",children:a.children},i,0,null),(s=ns(s,i,n,null)).flags|=2,a.return=t,s.return=t,a.sibling=s,t.child=a,0!==(1&t.mode)&&ir(t,e.child,null,n),t.child.memoizedState=Ya(n),t.memoizedState=Ka,s);if(0===(1&t.mode))t=ei(e,t,n,null);else if(Fe(r))t=ei(e,t,n,Error(o(419)));else if(a=0!==(n&e.childLanes),La||a){if(null!==(a=Ki)){switch(n&-n){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}0!==(a=0!==(s&(a.suspendedLanes|n))?0:s)&&a!==i.retryLane&&(i.retryLane=a,_o(e,a,-1))}Lo(),t=ei(e,t,n,Error(o(421)))}else Le(r)?(t.flags|=128,t.child=e.child,t=Ko.bind(null,e),ze(r,t),t=null):(n=i.treeContext,Q&&(Gn=We(r),Wn=t,jn=!0,Hn=null,qn=!1,null!==n&&(Dn[Pn++]=Ln,Dn[Pn++]=Fn,Dn[Pn++]=On,Ln=n.id,Fn=n.overflow,On=t)),(t=Za(t,t.pendingProps.children)).flags|=4096);return t}return s?(a=$a(e,t,a.children,a.fallback,n),s=t.child,i=e.child.memoizedState,s.memoizedState=null===i?Ya(n):{baseLanes:i.baseLanes|n,cachePool:null},s.childLanes=e.childLanes&~n,t.memoizedState=Ka,a):(n=Ja(e,t,a.children,n),t.memoizedState=null,n)}return s?(a=$a(e,t,a.children,a.fallback,n),s=t.child,i=e.child.memoizedState,s.memoizedState=null===i?Ya(n):{baseLanes:i.baseLanes|n,cachePool:null},s.childLanes=e.childLanes&~n,t.memoizedState=Ka,a):(n=Ja(e,t,a.children,n),t.memoizedState=null,n)}function Za(e,t){return(t=rs({mode:"visible",children:t},e.mode,0,null)).return=e,e.child=t}function Ja(e,t,n,r){var a=e.child;return e=a.sibling,n=es(a,{mode:"visible",children:n}),0===(1&t.mode)&&(n.lanes=r),n.return=t,n.sibling=null,null!==e&&(null===(r=t.deletions)?(t.deletions=[e],t.flags|=16):r.push(e)),t.child=n}function $a(e,t,n,r,a){var i=t.mode,o=(e=e.child).sibling,s={mode:"hidden",children:n};return 0===(1&i)&&t.child!==e?((n=t.child).childLanes=0,n.pendingProps=s,t.deletions=null):(n=es(e,s)).subtreeFlags=14680064&e.subtreeFlags,null!==o?r=es(o,r):(r=ns(r,i,a,null)).flags|=2,r.return=t,n.return=t,n.sibling=r,t.child=n,r}function ei(e,t,n,r){return null!==r&&er(r),ir(t,e.child,null,n),(e=Za(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function ti(e,t,n){e.lanes|=t;var r=e.alternate;null!==r&&(r.lanes|=t),cn(e.return,t,n)}function ni(e,t,n,r,a){var i=e.memoizedState;null===i?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:r,tail:n,tailMode:a}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=r,i.tail=n,i.tailMode=a)}function ri(e,t,n){var r=t.pendingProps,a=r.revealOrder,i=r.tail;if(Fa(e,t,r.children,n),0!==(2&(r=mr.current)))r=1&r|2,t.flags|=128;else{if(null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&ti(e,n,t);else if(19===e.tag)ti(e,n,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}r&=1}if(ut(mr,r),0===(1&t.mode))t.memoizedState=null;else switch(a){case"forwards":for(n=t.child,a=null;null!==n;)null!==(e=n.alternate)&&null===gr(e)&&(a=n),n=n.sibling;null===(n=a)?(a=t.child,t.child=null):(a=n.sibling,n.sibling=null),ni(t,!1,a,n,i);break;case"backwards":for(n=null,a=t.child,t.child=null;null!==a;){if(null!==(e=a.alternate)&&null===gr(e)){t.child=a;break}e=a.sibling,a.sibling=n,n=a,a=e}ni(t,!0,n,null,i);break;case"together":ni(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function ai(e,t,n){if(null!==e&&(t.dependencies=e.dependencies),to|=t.lanes,0===(n&t.childLanes))return null;if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(n=es(e=t.child,e.pendingProps),t.child=n,n.return=t;null!==e.sibling;)e=e.sibling,(n=n.sibling=es(e,e.pendingProps)).return=t;n.sibling=null}return t.child}function ii(e,t){switch(Vn(t),t.tag){case 1:return pt(t.type)&&vt(),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return dr(),st(ht),st(lt),br(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 5:return vr(t),null;case 13:if(st(mr),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));$n()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return st(mr),null;case 4:return dr(),null;case 10:return un(t.type._context),null;case 22:case 23:return Ro(),null;default:return null}}var oi=!1,si=!1,ui="function"===typeof WeakSet?WeakSet:Set,ci=null;function li(e,t){var n=e.ref;if(null!==n)if("function"===typeof n)try{n(null)}catch(r){qo(e,t,r)}else n.current=null}function hi(e,t,n){try{n()}catch(r){qo(e,t,r)}}var fi=!1;function di(e,t,n){var r=t.updateQueue;if(null!==(r=null!==r?r.lastEffect:null)){var a=r=r.next;do{if((a.tag&e)===e){var i=a.destroy;a.destroy=void 0,void 0!==i&&hi(t,n,i)}a=a.next}while(a!==r)}}function pi(e,t){if(null!==(t=null!==(t=t.updateQueue)?t.lastEffect:null)){var n=t=t.next;do{if((n.tag&e)===e){var r=n.create;n.destroy=r()}n=n.next}while(n!==t)}}function vi(e){var t=e.ref;if(null!==t){var n=e.stateNode;if(5===e.tag)e=D(n);else e=n;"function"===typeof t?t(e):t.current=e}}function mi(e,t,n){if(jt&&"function"===typeof jt.onCommitFiberUnmount)try{jt.onCommitFiberUnmount(Gt,t)}catch(o){}switch(t.tag){case 0:case 11:case 14:case 15:if(null!==(e=t.updateQueue)&&null!==(e=e.lastEffect)){var r=e=e.next;do{var a=r,i=a.destroy;a=a.tag,void 0!==i&&(0!==(2&a)||0!==(4&a))&&hi(t,n,i),r=r.next}while(r!==e)}break;case 1:if(li(t,n),"function"===typeof(e=t.stateNode).componentWillUnmount)try{e.props=t.memoizedProps,e.state=t.memoizedState,e.componentWillUnmount()}catch(o){qo(t,n,o)}break;case 5:li(t,n);break;case 4:K?Si(e,t,n):Y&&Y&&(t=t.stateNode.containerInfo,n=Ee(t),Me(t,n))}}function gi(e,t,n){for(var r=t;;)if(mi(e,r,n),null===r.child||K&&4===r.tag){if(r===t)break;for(;null===r.sibling;){if(null===r.return||r.return===t)return;r=r.return}r.sibling.return=r.return,r=r.sibling}else r.child.return=r,r=r.child}function yi(e){var t=e.alternate;null!==t&&(e.alternate=null,yi(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&ee(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function bi(e){return 5===e.tag||3===e.tag||4===e.tag}function xi(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||bi(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function ki(e){if(K){e:{for(var t=e.return;null!==t;){if(bi(t))break e;t=t.return}throw Error(o(160))}var n=t;switch(n.tag){case 5:t=n.stateNode,32&n.flags&&(xe(t),n.flags&=-33),_i(e,n=xi(e),t);break;case 3:case 4:t=n.stateNode.containerInfo,wi(e,n=xi(e),t);break;default:throw Error(o(161))}}}function wi(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?ge(n,e,t):fe(n,e);else if(4!==r&&null!==(e=e.child))for(wi(e,t,n),e=e.sibling;null!==e;)wi(e,t,n),e=e.sibling}function _i(e,t,n){var r=e.tag;if(5===r||6===r)e=e.stateNode,t?me(n,e,t):he(n,e);else if(4!==r&&null!==(e=e.child))for(_i(e,t,n),e=e.sibling;null!==e;)_i(e,t,n),e=e.sibling}function Si(e,t,n){for(var r,a,i=t,s=!1;;){if(!s){s=i.return;e:for(;;){if(null===s)throw Error(o(160));switch(r=s.stateNode,s.tag){case 5:a=!1;break e;case 3:case 4:r=r.containerInfo,a=!0;break e}s=s.return}s=!0}if(5===i.tag||6===i.tag)gi(e,i,n),a?be(r,i.stateNode):ye(r,i.stateNode);else if(18===i.tag)a?Qe(r,i.stateNode):Ye(r,i.stateNode);else if(4===i.tag){if(null!==i.child){r=i.stateNode.containerInfo,a=!0,i.child.return=i,i=i.child;continue}}else if(mi(e,i,n),null!==i.child){i.child.return=i,i=i.child;continue}if(i===t)break;for(;null===i.sibling;){if(null===i.return||i.return===t)return;4===(i=i.return).tag&&(s=!1)}i.sibling.return=i.return,i=i.sibling}}function Ci(e,t){if(K){switch(t.tag){case 0:case 11:case 14:case 15:return di(3,t,t.return),pi(3,t),void di(5,t,t.return);case 1:case 12:case 17:return;case 5:var n=t.stateNode;if(null!=n){var r=t.memoizedProps;e=null!==e?e.memoizedProps:r;var a=t.type,i=t.updateQueue;t.updateQueue=null,null!==i&&ve(n,i,a,e,r,t)}return;case 6:if(null===t.stateNode)throw Error(o(162));return n=t.memoizedProps,void de(t.stateNode,null!==e?e.memoizedProps:n,n);case 3:return void(Q&&null!==e&&e.memoizedState.isDehydrated&&Xe(t.stateNode.containerInfo));case 13:case 19:return void Ti(t)}throw Error(o(163))}switch(t.tag){case 0:case 11:case 14:case 15:return di(3,t,t.return),pi(3,t),void di(5,t,t.return);case 12:case 22:case 23:return;case 13:case 19:return void Ti(t);case 3:Q&&null!==e&&e.memoizedState.isDehydrated&&Xe(t.stateNode.containerInfo)}e:if(Y){switch(t.tag){case 1:case 5:case 6:break e;case 3:case 4:t=t.stateNode,Me(t.containerInfo,t.pendingChildren);break e}throw Error(o(163))}}function Ti(e){var t=e.updateQueue;if(null!==t){e.updateQueue=null;var n=e.stateNode;null===n&&(n=e.stateNode=new ui),t.forEach((function(t){var r=Yo.bind(null,e,t);n.has(t)||(n.add(t),t.then(r,r))}))}}function Ei(e,t,n){ci=e,Ii(e,t,n)}function Ii(e,t,n){for(var r=0!==(1&e.mode);null!==ci;){var a=ci,i=a.child;if(22===a.tag&&r){var o=null!==a.memoizedState||oi;if(!o){var s=a.alternate,u=null!==s&&null!==s.memoizedState||si;s=oi;var c=si;if(oi=o,(si=u)&&!c)for(ci=a;null!==ci;)u=(o=ci).child,22===o.tag&&null!==o.memoizedState?Ni(a):null!==u?(u.return=o,ci=u):Ni(a);for(;null!==i;)ci=i,Ii(i,t,n),i=i.sibling;ci=a,oi=s,si=c}Ai(e)}else 0!==(8772&a.subtreeFlags)&&null!==i?(i.return=a,ci=i):Ai(e)}}function Ai(e){for(;null!==ci;){var t=ci;if(0!==(8772&t.flags)){var n=t.alternate;try{if(0!==(8772&t.flags))switch(t.tag){case 0:case 11:case 15:si||pi(5,t);break;case 1:var r=t.stateNode;if(4&t.flags&&!si)if(null===n)r.componentDidMount();else{var a=t.elementType===t.type?n.memoizedProps:en(t.type,n.memoizedProps);r.componentDidUpdate(a,n.memoizedState,r.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;null!==i&&kn(t,i,r);break;case 3:var s=t.updateQueue;if(null!==s){if(n=null,null!==t.child)switch(t.child.tag){case 5:n=D(t.child.stateNode);break;case 1:n=t.child.stateNode}kn(t,s,n)}break;case 5:var u=t.stateNode;null===n&&4&t.flags&&pe(u,t.type,t.memoizedProps,t);break;case 6:case 4:case 12:case 19:case 17:case 21:case 22:case 23:break;case 13:if(Q&&null===t.memoizedState){var c=t.alternate;if(null!==c){var l=c.memoizedState;if(null!==l){var h=l.dehydrated;null!==h&&Ke(h)}}}break;default:throw Error(o(163))}si||512&t.flags&&vi(t)}catch(f){qo(t,t.return,f)}}if(t===e){ci=null;break}if(null!==(n=t.sibling)){n.return=t.return,ci=n;break}ci=t.return}}function Mi(e){for(;null!==ci;){var t=ci;if(t===e){ci=null;break}var n=t.sibling;if(null!==n){n.return=t.return,ci=n;break}ci=t.return}}function Ni(e){for(;null!==ci;){var t=ci;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{pi(4,t)}catch(u){qo(t,n,u)}break;case 1:var r=t.stateNode;if("function"===typeof r.componentDidMount){var a=t.return;try{r.componentDidMount()}catch(u){qo(t,a,u)}}var i=t.return;try{vi(t)}catch(u){qo(t,i,u)}break;case 5:var o=t.return;try{vi(t)}catch(u){qo(t,o,u)}}}catch(u){qo(t,t.return,u)}if(t===e){ci=null;break}var s=t.sibling;if(null!==s){s.return=t.return,ci=s;break}ci=t.return}}var Ri=0,Di=1,Pi=2,Oi=3,Li=4;if("function"===typeof Symbol&&Symbol.for){var Fi=Symbol.for;Ri=Fi("selector.component"),Di=Fi("selector.has_pseudo_class"),Pi=Fi("selector.role"),Oi=Fi("selector.test_id"),Li=Fi("selector.text")}function zi(e){var t=Z(e);if(null!=t){if("string"!==typeof t.memoizedProps["data-testname"])throw Error(o(364));return t}if(null===(e=ae(e)))throw Error(o(362));return e.stateNode.current}function Bi(e,t){switch(t.$$typeof){case Ri:if(e.type===t.value)return!0;break;case Di:e:{t=t.value,e=[e,0];for(var n=0;n<e.length;){var r=e[n++],a=e[n++],i=t[a];if(5!==r.tag||!se(r)){for(;null!=i&&Bi(r,i);)i=t[++a];if(a===t.length){t=!0;break e}for(r=r.child;null!==r;)e.push(r,a),r=r.sibling}}t=!1}return t;case Pi:if(5===e.tag&&ue(e.stateNode,t.value))return!0;break;case Li:if((5===e.tag||6===e.tag)&&(null!==(e=oe(e))&&0<=e.indexOf(t.value)))return!0;break;case Oi:if(5===e.tag&&("string"===typeof(e=e.memoizedProps["data-testname"])&&e.toLowerCase()===t.value.toLowerCase()))return!0;break;default:throw Error(o(365))}return!1}function Ui(e){switch(e.$$typeof){case Ri:return"<"+(_(e.value)||"Unknown")+">";case Di:return":has("+(Ui(e)||"")+")";case Pi:return'[role="'+e.value+'"]';case Li:return'"'+e.value+'"';case Oi:return'[data-testname="'+e.value+'"]';default:throw Error(o(365))}}function Vi(e,t){var n=[];e=[e,0];for(var r=0;r<e.length;){var a=e[r++],i=e[r++],o=t[i];if(5!==a.tag||!se(a)){for(;null!=o&&Bi(a,o);)o=t[++i];if(i===t.length)n.push(a);else for(a=a.child;null!==a;)e.push(a,i),a=a.sibling}}return n}function Wi(e,t){if(!re)throw Error(o(363));e=Vi(e=zi(e),t),t=[],e=Array.from(e);for(var n=0;n<e.length;){var r=e[n++];if(5===r.tag)se(r)||t.push(r.stateNode);else for(r=r.child;null!==r;)e.push(r),r=r.sibling}return t}var Gi=Math.ceil,ji=s.ReactCurrentDispatcher,qi=s.ReactCurrentOwner,Hi=s.ReactCurrentBatchConfig,Xi=0,Ki=null,Yi=null,Qi=0,Zi=0,Ji=ot(0),$i=0,eo=null,to=0,no=0,ro=0,ao=null,io=null,oo=0,so=1/0;function uo(){so=zt()+500}var co,lo=!1,ho=null,fo=null,po=!1,vo=null,mo=0,go=0,yo=null,bo=-1,xo=0;function ko(){return 0!==(6&Xi)?zt():-1!==bo?bo:bo=zt()}function wo(e){return 0===(1&e.mode)?1:0!==(2&Xi)&&0!==Qi?Qi&-Qi:null!==Zt.transition?(0===xo&&(e=_t,0===(4194240&(_t<<=1))&&(_t=64),xo=e),xo):0!==(e=Rt)?e:$()}function _o(e,t,n){if(50<go)throw go=0,yo=null,Error(o(185));var r=So(e,t);return null===r?null:(Mt(r,t,n),0!==(2&Xi)&&r===Ki||(r===Ki&&(0===(2&Xi)&&(no|=t),4===$i&&Ao(r,Qi)),Co(r,n),1===t&&0===Xi&&0===(1&e.mode)&&(uo(),Xt&&Qt())),r)}function So(e,t){e.lanes|=t;var n=e.alternate;for(null!==n&&(n.lanes|=t),n=e,e=e.return;null!==e;)e.childLanes|=t,null!==(n=e.alternate)&&(n.childLanes|=t),n=e,e=e.return;return 3===n.tag?n.stateNode:null}function Co(e,t){var n=e.callbackNode;!function(e,t){for(var n=e.suspendedLanes,r=e.pingedLanes,a=e.expirationTimes,i=e.pendingLanes;0<i;){var o=31-xt(i),s=1<<o,u=a[o];-1===u?0!==(s&n)&&0===(s&r)||(a[o]=Et(s,t)):u<=t&&(e.expiredLanes|=s),i&=~s}}(e,t);var r=Tt(e,e===Ki?Qi:0);if(0===r)null!==n&&Ot(n),e.callbackNode=null,e.callbackPriority=0;else if(t=r&-r,e.callbackPriority!==t){if(null!=n&&Ot(n),1===t)0===e.tag?function(e){Xt=!0,Yt(e)}(Mo.bind(null,e)):Yt(Mo.bind(null,e)),te?ne((function(){0===Xi&&Qt()})):Pt(Bt,Qt),n=null;else{switch(Dt(r)){case 1:n=Bt;break;case 4:n=Ut;break;case 16:default:n=Vt;break;case 536870912:n=Wt}n=Qo(n,To.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function To(e,t){if(bo=-1,xo=0,0!==(6&Xi))throw Error(o(327));var n=e.callbackNode;if(Go()&&e.callbackNode!==n)return null;var r=Tt(e,e===Ki?Qi:0);if(0===r)return null;if(0!==(30&r)||0!==(r&e.expiredLanes)||t)t=Fo(e,r);else{t=r;var a=Xi;Xi|=2;var i=Oo();for(Ki===e&&Qi===t||(uo(),Do(e,t));;)try{Bo();break}catch(u){Po(e,u)}on(),ji.current=i,Xi=a,null!==Yi?t=0:(Ki=null,Qi=0,t=$i)}if(0!==t){if(2===t&&(0!==(a=It(e))&&(r=a,t=Eo(e,a))),1===t)throw n=eo,Do(e,0),Ao(e,r),Co(e,zt()),n;if(6===t)Ao(e,r);else{if(a=e.current.alternate,0===(30&r)&&!function(e){for(var t=e;;){if(16384&t.flags){var n=t.updateQueue;if(null!==n&&null!==(n=n.stores))for(var r=0;r<n.length;r++){var a=n[r],i=a.getSnapshot;a=a.value;try{if(!qt(i(),a))return!1}catch(s){return!1}}}if(n=t.child,16384&t.subtreeFlags&&null!==n)n.return=t,t=n;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}(a)&&(2===(t=Fo(e,r))&&(0!==(i=It(e))&&(r=i,t=Eo(e,i))),1===t))throw n=eo,Do(e,0),Ao(e,r),Co(e,zt()),n;switch(e.finishedWork=a,e.finishedLanes=r,t){case 0:case 1:throw Error(o(345));case 2:case 5:Wo(e,io);break;case 3:if(Ao(e,r),(130023424&r)===r&&10<(t=oo+500-zt())){if(0!==Tt(e,0))break;if(((a=e.suspendedLanes)&r)!==r){ko(),e.pingedLanes|=e.suspendedLanes&a;break}e.timeoutHandle=j(Wo.bind(null,e,io),t);break}Wo(e,io);break;case 4:if(Ao(e,r),(4194240&r)===r)break;for(t=e.eventTimes,a=-1;0<r;){var s=31-xt(r);i=1<<s,(s=t[s])>a&&(a=s),r&=~i}if(r=a,10<(r=(120>(r=zt()-r)?120:480>r?480:1080>r?1080:1920>r?1920:3e3>r?3e3:4320>r?4320:1960*Gi(r/1960))-r)){e.timeoutHandle=j(Wo.bind(null,e,io),r);break}Wo(e,io);break;default:throw Error(o(329))}}}return Co(e,zt()),e.callbackNode===n?To.bind(null,e):null}function Eo(e,t){var n=ao;return e.current.memoizedState.isDehydrated&&(Do(e,t).flags|=256),2!==(e=Fo(e,t))&&(t=io,io=n,null!==t&&Io(t)),e}function Io(e){null===io?io=e:io.push.apply(io,e)}function Ao(e,t){for(t&=~ro,t&=~no,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-xt(t),r=1<<n;e[n]=-1,t&=~r}}function Mo(e){if(0!==(6&Xi))throw Error(o(327));Go();var t=Tt(e,0);if(0===(1&t))return Co(e,zt()),null;var n=Fo(e,t);if(0!==e.tag&&2===n){var r=It(e);0!==r&&(t=r,n=Eo(e,r))}if(1===n)throw n=eo,Do(e,0),Ao(e,t),Co(e,zt()),n;if(6===n)throw Error(o(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Wo(e,io),Co(e,zt()),null}function No(e){null!==vo&&0===vo.tag&&0===(6&Xi)&&Go();var t=Xi;Xi|=1;var n=Hi.transition,r=Rt;try{if(Hi.transition=null,Rt=1,e)return e()}finally{Rt=r,Hi.transition=n,0===(6&(Xi=t))&&Qt()}}function Ro(){Zi=Ji.current,st(Ji)}function Do(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==H&&(e.timeoutHandle=H,q(n)),null!==Yi)for(n=Yi.return;null!==n;){var r=n;switch(Vn(r),r.tag){case 1:null!==(r=r.type.childContextTypes)&&void 0!==r&&vt();break;case 3:dr(),st(ht),st(lt),br();break;case 5:vr(r);break;case 4:dr();break;case 13:case 19:st(mr);break;case 10:un(r.type._context);break;case 22:case 23:Ro()}n=n.return}if(Ki=e,Yi=e=es(e.current,null),Qi=Zi=t,$i=0,eo=null,ro=no=to=0,io=ao=null,null!==fn){for(t=0;t<fn.length;t++)if(null!==(r=(n=fn[t]).interleaved)){n.interleaved=null;var a=r.next,i=n.pending;if(null!==i){var o=i.next;i.next=a,r.next=o}n.pending=r}fn=null}return e}function Po(e,t){for(;;){var n=Yi;try{if(on(),xr.current=da,Tr){for(var r=_r.memoizedState;null!==r;){var a=r.queue;null!==a&&(a.pending=null),r=r.next}Tr=!1}if(wr=0,Cr=Sr=_r=null,Er=!1,Ir=0,qi.current=null,null===n||null===n.return){$i=1,eo=t,Yi=null;break}e:{var i=e,s=n.return,u=n,c=t;if(t=Qi,u.flags|=32768,null!==c&&"object"===typeof c&&"function"===typeof c.then){var l=c,h=u,f=h.tag;if(0===(1&h.mode)&&(0===f||11===f||15===f)){var d=h.alternate;d?(h.updateQueue=d.updateQueue,h.memoizedState=d.memoizedState,h.lanes=d.lanes):(h.updateQueue=null,h.memoizedState=null)}var p=Ea(s);if(null!==p){p.flags&=-257,Ia(p,s,u,0,t),1&p.mode&&Ta(i,l,t),c=l;var v=(t=p).updateQueue;if(null===v){var m=new Set;m.add(c),t.updateQueue=m}else v.add(c);break e}if(0===(1&t)){Ta(i,l,t),Lo();break e}c=Error(o(426))}else if(jn&&1&u.mode){var g=Ea(s);if(null!==g){0===(65536&g.flags)&&(g.flags|=256),Ia(g,s,u,0,t),er(c);break e}}i=c,4!==$i&&($i=2),null===ao?ao=[i]:ao.push(i),c=ga(c,u),u=s;do{switch(u.tag){case 3:u.flags|=65536,t&=-t,u.lanes|=t,bn(u,Sa(0,c,t));break e;case 1:i=c;var y=u.type,b=u.stateNode;if(0===(128&u.flags)&&("function"===typeof y.getDerivedStateFromError||null!==b&&"function"===typeof b.componentDidCatch&&(null===fo||!fo.has(b)))){u.flags|=65536,t&=-t,u.lanes|=t,bn(u,Ca(u,i,t));break e}}u=u.return}while(null!==u)}Vo(n)}catch(x){t=x,Yi===n&&null!==n&&(Yi=n=n.return);continue}break}}function Oo(){var e=ji.current;return ji.current=da,null===e?da:e}function Lo(){0!==$i&&3!==$i&&2!==$i||($i=4),null===Ki||0===(268435455&to)&&0===(268435455&no)||Ao(Ki,Qi)}function Fo(e,t){var n=Xi;Xi|=2;var r=Oo();for(Ki===e&&Qi===t||Do(e,t);;)try{zo();break}catch(a){Po(e,a)}if(on(),Xi=n,ji.current=r,null!==Yi)throw Error(o(261));return Ki=null,Qi=0,$i}function zo(){for(;null!==Yi;)Uo(Yi)}function Bo(){for(;null!==Yi&&!Lt();)Uo(Yi)}function Uo(e){var t=co(e.alternate,e,Zi);e.memoizedProps=e.pendingProps,null===t?Vo(e):Yi=t,qi.current=null}function Vo(e){var t=e;do{var n=t.alternate;if(e=t.return,0===(32768&t.flags)){if(null!==(n=Pa(n,t,Zi)))return void(Yi=n)}else{if(null!==(n=ii(n,t)))return n.flags&=32767,void(Yi=n);if(null===e)return $i=6,void(Yi=null);e.flags|=32768,e.subtreeFlags=0,e.deletions=null}if(null!==(t=t.sibling))return void(Yi=t);Yi=t=e}while(null!==t);0===$i&&($i=5)}function Wo(e,t){var n=Rt,r=Hi.transition;try{Hi.transition=null,Rt=1,function(e,t,n){do{Go()}while(null!==vo);if(0!==(6&Xi))throw Error(o(327));var r=e.finishedWork,a=e.finishedLanes;if(null===r)return null;if(e.finishedWork=null,e.finishedLanes=0,r===e.current)throw Error(o(177));e.callbackNode=null,e.callbackPriority=0;var i=r.lanes|r.childLanes;if(function(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var r=e.eventTimes;for(e=e.expirationTimes;0<n;){var a=31-xt(n),i=1<<a;t[a]=0,r[a]=-1,e[a]=-1,n&=~i}}(e,i),e===Ki&&(Yi=Ki=null,Qi=0),0===(2064&r.subtreeFlags)&&0===(2064&r.flags)||po||(po=!0,Qo(Vt,(function(){return Go(),null}))),i=0!==(15990&r.flags),0!==(15990&r.subtreeFlags)||i){i=Hi.transition,Hi.transition=null;var s=Rt;Rt=1;var u=Xi;Xi|=4,qi.current=null,function(e,t){for(L(e.containerInfo),ci=t;null!==ci;)if(t=(e=ci).child,0!==(1028&e.subtreeFlags)&&null!==t)t.return=e,ci=t;else for(;null!==ci;){e=ci;try{var n=e.alternate;if(0!==(1024&e.flags))switch(e.tag){case 0:case 11:case 15:case 5:case 6:case 4:case 17:break;case 1:if(null!==n){var r=n.memoizedProps,a=n.memoizedState,i=e.stateNode,s=i.getSnapshotBeforeUpdate(e.elementType===e.type?r:en(e.type,r),a);i.__reactInternalSnapshotBeforeUpdate=s}break;case 3:K&&Ce(e.stateNode.containerInfo);break;default:throw Error(o(163))}}catch(u){qo(e,e.return,u)}if(null!==(t=e.sibling)){t.return=e.return,ci=t;break}ci=e.return}n=fi,fi=!1}(e,r),function(e,t){for(ci=t;null!==ci;){var n=(t=ci).deletions;if(null!==n)for(var r=0;r<n.length;r++){var a=n[r];try{var i=e;K?Si(i,a,t):gi(i,a,t);var o=a.alternate;null!==o&&(o.return=null),a.return=null}catch(k){qo(a,t,k)}}if(n=t.child,0!==(12854&t.subtreeFlags)&&null!==n)n.return=t,ci=n;else for(;null!==ci;){t=ci;try{var s=t.flags;if(32&s&&K&&xe(t.stateNode),512&s){var u=t.alternate;if(null!==u){var c=u.ref;null!==c&&("function"===typeof c?c(null):c.current=null)}}if(8192&s)switch(t.tag){case 13:if(null!==t.memoizedState){var l=t.alternate;null!==l&&null!==l.memoizedState||(oo=zt())}break;case 22:var h=null!==t.memoizedState,f=t.alternate,d=null!==f&&null!==f.memoizedState;if(n=t,K)e:if(r=n,a=h,i=null,K)for(var p=r;;){if(5===p.tag){if(null===i){i=p;var v=p.stateNode;a?ke(v):_e(p.stateNode,p.memoizedProps)}}else if(6===p.tag){if(null===i){var m=p.stateNode;a?we(m):Se(m,p.memoizedProps)}}else if((22!==p.tag&&23!==p.tag||null===p.memoizedState||p===r)&&null!==p.child){p.child.return=p,p=p.child;continue}if(p===r)break;for(;null===p.sibling;){if(null===p.return||p.return===r)break e;i===p&&(i=null),p=p.return}i===p&&(i=null),p.sibling.return=p.return,p=p.sibling}if(h&&!d&&0!==(1&n.mode)){ci=n;for(var g=n.child;null!==g;){for(n=ci=g;null!==ci;){var y=(r=ci).child;switch(r.tag){case 0:case 11:case 14:case 15:di(4,r,r.return);break;case 1:li(r,r.return);var b=r.stateNode;if("function"===typeof b.componentWillUnmount){var x=r.return;try{b.props=r.memoizedProps,b.state=r.memoizedState,b.componentWillUnmount()}catch(k){qo(r,x,k)}}break;case 5:li(r,r.return);break;case 22:if(null!==r.memoizedState){Mi(n);continue}}null!==y?(y.return=r,ci=y):Mi(n)}g=g.sibling}}}switch(4102&s){case 2:ki(t),t.flags&=-3;break;case 6:ki(t),t.flags&=-3,Ci(t.alternate,t);break;case 4096:t.flags&=-4097;break;case 4100:t.flags&=-4097,Ci(t.alternate,t);break;case 4:Ci(t.alternate,t)}}catch(k){qo(t,t.return,k)}if(null!==(n=t.sibling)){n.return=t.return,ci=n;break}ci=t.return}}}(e,r),F(e.containerInfo),e.current=r,Ei(r,e,a),Ft(),Xi=u,Rt=s,Hi.transition=i}else e.current=r;if(po&&(po=!1,vo=e,mo=a),0===(i=e.pendingLanes)&&(fo=null),function(e){if(jt&&"function"===typeof jt.onCommitFiberRoot)try{jt.onCommitFiberRoot(Gt,e,void 0,128===(128&e.current.flags))}catch(t){}}(r.stateNode),Co(e,zt()),null!==t)for(n=e.onRecoverableError,r=0;r<t.length;r++)n(t[r]);if(lo)throw lo=!1,e=ho,ho=null,e;0!==(1&mo)&&0!==e.tag&&Go(),0!==(1&(i=e.pendingLanes))?e===yo?go++:(go=0,yo=e):go=0,Qt()}(e,t,n)}finally{Hi.transition=r,Rt=n}return null}function Go(){if(null!==vo){var e=Dt(mo),t=Hi.transition,n=Rt;try{if(Hi.transition=null,Rt=16>e?16:e,null===vo)var r=!1;else{if(e=vo,vo=null,mo=0,0!==(6&Xi))throw Error(o(331));var a=Xi;for(Xi|=4,ci=e.current;null!==ci;){var i=ci,s=i.child;if(0!==(16&ci.flags)){var u=i.deletions;if(null!==u){for(var c=0;c<u.length;c++){var l=u[c];for(ci=l;null!==ci;){var h=ci;switch(h.tag){case 0:case 11:case 15:di(8,h,i)}var f=h.child;if(null!==f)f.return=h,ci=f;else for(;null!==ci;){var d=(h=ci).sibling,p=h.return;if(yi(h),h===l){ci=null;break}if(null!==d){d.return=p,ci=d;break}ci=p}}}var v=i.alternate;if(null!==v){var m=v.child;if(null!==m){v.child=null;do{var g=m.sibling;m.sibling=null,m=g}while(null!==m)}}ci=i}}if(0!==(2064&i.subtreeFlags)&&null!==s)s.return=i,ci=s;else e:for(;null!==ci;){if(0!==(2048&(i=ci).flags))switch(i.tag){case 0:case 11:case 15:di(9,i,i.return)}var y=i.sibling;if(null!==y){y.return=i.return,ci=y;break e}ci=i.return}}var b=e.current;for(ci=b;null!==ci;){var x=(s=ci).child;if(0!==(2064&s.subtreeFlags)&&null!==x)x.return=s,ci=x;else e:for(s=b;null!==ci;){if(0!==(2048&(u=ci).flags))try{switch(u.tag){case 0:case 11:case 15:pi(9,u)}}catch(w){qo(u,u.return,w)}if(u===s){ci=null;break e}var k=u.sibling;if(null!==k){k.return=u.return,ci=k;break e}ci=u.return}}if(Xi=a,Qt(),jt&&"function"===typeof jt.onPostCommitFiberRoot)try{jt.onPostCommitFiberRoot(Gt,e)}catch(w){}r=!0}return r}finally{Rt=n,Hi.transition=t}}return!1}function jo(e,t,n){gn(e,t=Sa(0,t=ga(n,t),1)),t=ko(),null!==(e=So(e,1))&&(Mt(e,1,t),Co(e,t))}function qo(e,t,n){if(3===e.tag)jo(e,e,n);else for(;null!==t;){if(3===t.tag){jo(t,e,n);break}if(1===t.tag){var r=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof r.componentDidCatch&&(null===fo||!fo.has(r))){gn(t,e=Ca(t,e=ga(n,e),1)),e=ko(),null!==(t=So(t,1))&&(Mt(t,1,e),Co(t,e));break}}t=t.return}}function Ho(e,t,n){var r=e.pingCache;null!==r&&r.delete(t),t=ko(),e.pingedLanes|=e.suspendedLanes&n,Ki===e&&(Qi&n)===n&&(4===$i||3===$i&&(130023424&Qi)===Qi&&500>zt()-oo?Do(e,0):ro|=n),Co(e,t)}function Xo(e,t){0===t&&(0===(1&e.mode)?t=1:(t=St,0===(130023424&(St<<=1))&&(St=4194304)));var n=ko();null!==(e=So(e,t))&&(Mt(e,t,n),Co(e,n))}function Ko(e){var t=e.memoizedState,n=0;null!==t&&(n=t.retryLane),Xo(e,n)}function Yo(e,t){var n=0;switch(e.tag){case 13:var r=e.stateNode,a=e.memoizedState;null!==a&&(n=a.retryLane);break;case 19:r=e.stateNode;break;default:throw Error(o(314))}null!==r&&r.delete(t),Xo(e,n)}function Qo(e,t){return Pt(e,t)}function Zo(e,t,n,r){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=r,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Jo(e,t,n,r){return new Zo(e,t,n,r)}function $o(e){return!(!(e=e.prototype)||!e.isReactComponent)}function es(e,t){var n=e.alternate;return null===n?((n=Jo(e.tag,t,e.key,e.mode)).elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=14680064&e.flags,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function ts(e,t,n,r,a,i){var s=2;if(r=e,"function"===typeof e)$o(e)&&(s=1);else if("string"===typeof e)s=5;else e:switch(e){case l:return ns(n.children,a,i,t);case h:s=8,a|=8;break;case f:return(e=Jo(12,n,t,2|a)).elementType=f,e.lanes=i,e;case m:return(e=Jo(13,n,t,a)).elementType=m,e.lanes=i,e;case g:return(e=Jo(19,n,t,a)).elementType=g,e.lanes=i,e;case x:return rs(n,a,i,t);default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case d:s=10;break e;case p:s=9;break e;case v:s=11;break e;case y:s=14;break e;case b:s=16,r=null;break e}throw Error(o(130,null==e?e:typeof e,""))}return(t=Jo(s,n,t,a)).elementType=e,t.type=r,t.lanes=i,t}function ns(e,t,n,r){return(e=Jo(7,e,r,t)).lanes=n,e}function rs(e,t,n,r){return(e=Jo(22,e,r,t)).elementType=x,e.lanes=n,e.stateNode={},e}function as(e,t,n){return(e=Jo(6,e,null,t)).lanes=n,e}function is(e,t,n){return(t=Jo(4,null!==e.children?e.children:[],e.key,t)).lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function os(e,t,n,r,a){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=H,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=At(0),this.expirationTimes=At(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=At(0),this.identifierPrefix=r,this.onRecoverableError=a,Q&&(this.mutableSourceEagerHydrationData=null)}function ss(e,t,n,r,a,i,o,s,u){return e=new os(e,t,n,s,u),1===t?(t=1,!0===i&&(t|=8)):t=0,i=Jo(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:r,isDehydrated:n,cache:null,transitions:null},pn(i),e}function us(e){if(!e)return ct;e:{if(C(e=e._reactInternals)!==e||1!==e.tag)throw Error(o(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(pt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(null!==t);throw Error(o(171))}if(1===e.tag){var n=e.type;if(pt(n))return gt(e,n,t)}return t}function cs(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return null===(e=I(t))?null:e.stateNode}function ls(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var n=e.retryLane;e.retryLane=0!==n&&n<t?n:t}}function hs(e,t){ls(e,t),(e=e.alternate)&&ls(e,t)}function fs(e){return null===(e=I(e))?null:e.stateNode}function ds(){return null}return co=function(e,t,n){if(null!==e)if(e.memoizedProps!==t.pendingProps||ht.current)La=!0;else{if(0===(e.lanes&n)&&0===(128&t.flags))return La=!1,function(e,t,n){switch(t.tag){case 3:Ha(t),$n();break;case 5:pr(t);break;case 1:pt(t.type)&&yt(t);break;case 4:fr(t,t.stateNode.containerInfo);break;case 10:sn(0,t.type._context,t.memoizedProps.value);break;case 13:var r=t.memoizedState;if(null!==r)return null!==r.dehydrated?(ut(mr,1&mr.current),t.flags|=128,null):0!==(n&t.child.childLanes)?Qa(e,t,n):(ut(mr,1&mr.current),null!==(e=ai(e,t,n))?e.sibling:null);ut(mr,1&mr.current);break;case 19:if(r=0!==(n&t.childLanes),0!==(128&e.flags)){if(r)return ri(e,t,n);t.flags|=128}var a=t.memoizedState;if(null!==a&&(a.rendering=null,a.tail=null,a.lastEffect=null),ut(mr,mr.current),r)break;return null;case 22:case 23:return t.lanes=0,Va(e,t,n)}return ai(e,t,n)}(e,t,n);La=0!==(131072&e.flags)}else La=!1,jn&&0!==(1048576&t.flags)&&Bn(t,Rn,t.index);switch(t.lanes=0,t.tag){case 2:var r=t.type;null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps;var a=dt(t,lt.current);ln(t,n),a=Rr(null,t,r,e,a,n);var i=Dr();return t.flags|=1,"object"===typeof a&&null!==a&&"function"===typeof a.render&&void 0===a.$$typeof?(t.tag=1,t.memoizedState=null,t.updateQueue=null,pt(r)?(i=!0,yt(t)):i=!1,t.memoizedState=null!==a.state&&void 0!==a.state?a.state:null,pn(t),a.updater=Sn,t.stateNode=a,a._reactInternals=t,In(t,r,e,n),t=qa(null,t,r,!0,i,n)):(t.tag=0,jn&&i&&Un(t),Fa(null,t,a,n),t=t.child),t;case 16:r=t.elementType;e:{switch(null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),e=t.pendingProps,r=(a=r._init)(r._payload),t.type=r,a=t.tag=function(e){if("function"===typeof e)return $o(e)?1:0;if(void 0!==e&&null!==e){if((e=e.$$typeof)===v)return 11;if(e===y)return 14}return 2}(r),e=en(r,e),a){case 0:t=Ga(null,t,r,e,n);break e;case 1:t=ja(null,t,r,e,n);break e;case 11:t=za(null,t,r,e,n);break e;case 14:t=Ba(null,t,r,en(r.type,e),n);break e}throw Error(o(306,r,""))}return t;case 0:return r=t.type,a=t.pendingProps,Ga(e,t,r,a=t.elementType===r?a:en(r,a),n);case 1:return r=t.type,a=t.pendingProps,ja(e,t,r,a=t.elementType===r?a:en(r,a),n);case 3:e:{if(Ha(t),null===e)throw Error(o(387));r=t.pendingProps,a=(i=t.memoizedState).element,vn(e,t),xn(t,r,null,n);var s=t.memoizedState;if(r=s.element,Q&&i.isDehydrated){if(i={element:r,isDehydrated:!1,cache:s.cache,transitions:s.transitions},t.updateQueue.baseState=i,t.memoizedState=i,256&t.flags){t=Xa(e,t,r,n,a=Error(o(423)));break e}if(r!==a){t=Xa(e,t,r,n,a=Error(o(424)));break e}for(Q&&(Gn=Ve(t.stateNode.containerInfo),Wn=t,jn=!0,Hn=null,qn=!1),n=or(t,null,r,n),t.child=n;n;)n.flags=-3&n.flags|4096,n=n.sibling}else{if($n(),r===a){t=ai(e,t,n);break e}Fa(e,t,r,n)}t=t.child}return t;case 5:return pr(t),null===e&&Qn(t),r=t.type,a=t.pendingProps,i=null!==e?e.memoizedProps:null,s=a.children,W(r,a)?s=null:null!==i&&W(r,i)&&(t.flags|=32),Wa(e,t),Fa(e,t,s,n),t.child;case 6:return null===e&&Qn(t),null;case 13:return Qa(e,t,n);case 4:return fr(t,t.stateNode.containerInfo),r=t.pendingProps,null===e?t.child=ir(t,null,r,n):Fa(e,t,r,n),t.child;case 11:return r=t.type,a=t.pendingProps,za(e,t,r,a=t.elementType===r?a:en(r,a),n);case 7:return Fa(e,t,t.pendingProps,n),t.child;case 8:case 12:return Fa(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(r=t.type._context,a=t.pendingProps,i=t.memoizedProps,sn(0,r,s=a.value),null!==i)if(qt(i.value,s)){if(i.children===a.children&&!ht.current){t=ai(e,t,n);break e}}else for(null!==(i=t.child)&&(i.return=t);null!==i;){var u=i.dependencies;if(null!==u){s=i.child;for(var c=u.firstContext;null!==c;){if(c.context===r){if(1===i.tag){(c=mn(-1,n&-n)).tag=2;var l=i.updateQueue;if(null!==l){var h=(l=l.shared).pending;null===h?c.next=c:(c.next=h.next,h.next=c),l.pending=c}}i.lanes|=n,null!==(c=i.alternate)&&(c.lanes|=n),cn(i.return,n,t),u.lanes|=n;break}c=c.next}}else if(10===i.tag)s=i.type===t.type?null:i.child;else if(18===i.tag){if(null===(s=i.return))throw Error(o(341));s.lanes|=n,null!==(u=s.alternate)&&(u.lanes|=n),cn(s,n,t),s=i.sibling}else s=i.child;if(null!==s)s.return=i;else for(s=i;null!==s;){if(s===t){s=null;break}if(null!==(i=s.sibling)){i.return=s.return,s=i;break}s=s.return}i=s}Fa(e,t,a.children,n),t=t.child}return t;case 9:return a=t.type,r=t.pendingProps.children,ln(t,n),r=r(a=hn(a)),t.flags|=1,Fa(e,t,r,n),t.child;case 14:return a=en(r=t.type,t.pendingProps),Ba(e,t,r,a=en(r.type,a),n);case 15:return Ua(e,t,t.type,t.pendingProps,n);case 17:return r=t.type,a=t.pendingProps,a=t.elementType===r?a:en(r,a),null!==e&&(e.alternate=null,t.alternate=null,t.flags|=2),t.tag=1,pt(r)?(e=!0,yt(t)):e=!1,ln(t,n),Tn(t,r,a),In(t,r,a,n),qa(null,t,r,!0,e,n);case 19:return ri(e,t,n);case 22:return Va(e,t,n)}throw Error(o(156,t.tag))},t.attemptContinuousHydration=function(e){13===e.tag&&(_o(e,134217728,ko()),hs(e,134217728))},t.attemptHydrationAtCurrentPriority=function(e){if(13===e.tag){var t=ko(),n=wo(e);_o(e,n,t),hs(e,n)}},t.attemptSynchronousHydration=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=Ct(t.pendingLanes);0!==n&&(Nt(t,1|n),Co(t,zt()),0===(6&Xi)&&(uo(),Qt()))}break;case 13:var r=ko();No((function(){return _o(e,1,r)})),hs(e,1)}},t.batchedUpdates=function(e,t){var n=Xi;Xi|=1;try{return e(t)}finally{0===(Xi=n)&&(uo(),Xt&&Qt())}},t.createComponentSelector=function(e){return{$$typeof:Ri,value:e}},t.createContainer=function(e,t,n,r,a,i,o){return ss(e,t,!1,null,0,r,0,i,o)},t.createHasPseudoClassSelector=function(e){return{$$typeof:Di,value:e}},t.createHydrationContainer=function(e,t,n,r,a,i,o,s,u){return(e=ss(n,r,!0,e,0,i,0,s,u)).context=us(null),n=e.current,(i=mn(r=ko(),a=wo(n))).callback=void 0!==t&&null!==t?t:null,gn(n,i),e.current.lanes=a,Mt(e,a,r),Co(e,r),e},t.createPortal=function(e,t,n){var r=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:c,key:null==r?null:""+r,children:e,containerInfo:t,implementation:n}},t.createRoleSelector=function(e){return{$$typeof:Pi,value:e}},t.createTestNameSelector=function(e){return{$$typeof:Oi,value:e}},t.createTextSelector=function(e){return{$$typeof:Li,value:e}},t.deferredUpdates=function(e){var t=Rt,n=Hi.transition;try{return Hi.transition=null,Rt=16,e()}finally{Rt=t,Hi.transition=n}},t.discreteUpdates=function(e,t,n,r,a){var i=Rt,o=Hi.transition;try{return Hi.transition=null,Rt=1,e(t,n,r,a)}finally{Rt=i,Hi.transition=o,0===Xi&&uo()}},t.findAllNodes=Wi,t.findBoundingRects=function(e,t){if(!re)throw Error(o(363));t=Wi(e,t),e=[];for(var n=0;n<t.length;n++)e.push(ie(t[n]));for(t=e.length-1;0<t;t--)for(var r=(n=e[t]).x,a=r+n.width,i=n.y,s=i+n.height,u=t-1;0<=u;u--)if(t!==u){var c=e[u],l=c.x,h=l+c.width,f=c.y,d=f+c.height;if(r>=l&&i>=f&&a<=h&&s<=d){e.splice(t,1);break}if(!(r!==l||n.width!==c.width||d<i||f>s)){f>i&&(c.height+=f-i,c.y=i),d<s&&(c.height=s-f),e.splice(t,1);break}if(!(i!==f||n.height!==c.height||h<r||l>a)){l>r&&(c.width+=l-r,c.x=r),h<a&&(c.width=a-l),e.splice(t,1);break}}return e},t.findHostInstance=cs,t.findHostInstanceWithNoPortals=function(e){return null===(e=null!==(e=E(e))?M(e):null)?null:e.stateNode},t.findHostInstanceWithWarning=function(e){return cs(e)},t.flushControlled=function(e){var t=Xi;Xi|=1;var n=Hi.transition,r=Rt;try{Hi.transition=null,Rt=1,e()}finally{Rt=r,Hi.transition=n,0===(Xi=t)&&(uo(),Qt())}},t.flushPassiveEffects=Go,t.flushSync=No,t.focusWithin=function(e,t){if(!re)throw Error(o(363));for(t=Vi(e=zi(e),t),t=Array.from(t),e=0;e<t.length;){var n=t[e++];if(!se(n)){if(5===n.tag&&ce(n.stateNode))return!0;for(n=n.child;null!==n;)t.push(n),n=n.sibling}}return!1},t.getCurrentUpdatePriority=function(){return Rt},t.getFindAllNodesFailureDescription=function(e,t){if(!re)throw Error(o(363));var n=0,r=[];e=[zi(e),0];for(var a=0;a<e.length;){var i=e[a++],s=e[a++],u=t[s];if((5!==i.tag||!se(i))&&(Bi(i,u)&&(r.push(Ui(u)),++s>n&&(n=s)),s<t.length))for(i=i.child;null!==i;)e.push(i,s),i=i.sibling}if(n<t.length){for(e=[];n<t.length;n++)e.push(Ui(t[n]));return"findAllNodes was able to match part of the selector:\n  "+r.join(" > ")+"\n\nNo matching component was found for:\n  "+e.join(" > ")}return null},t.getPublicRootInstance=function(e){return(e=e.current).child?5===e.child.tag?D(e.child.stateNode):e.child.stateNode:null},t.injectIntoDevTools=function(e){if(e={bundleType:e.bundleType,version:e.version,rendererPackageName:e.rendererPackageName,rendererConfig:e.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:s.ReactCurrentDispatcher,findHostInstanceByFiber:fs,findFiberByHostInstance:e.findFiberByHostInstance||ds,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.0.0-fc46dba67-20220329"},"undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)e=!1;else{var t=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(t.isDisabled||!t.supportsFiber)e=!0;else{try{Gt=t.inject(e),jt=t}catch(n){}e=!!t.checkDCE}}return e},t.isAlreadyRendering=function(){return!1},t.observeVisibleRects=function(e,t,n,r){if(!re)throw Error(o(363));e=Wi(e,t);var a=le(e,n,r).disconnect;return{disconnect:function(){a()}}},t.registerMutableSourceForHydration=function(e,t){var n=t._getVersion;n=n(t._source),null==e.mutableSourceEagerHydrationData?e.mutableSourceEagerHydrationData=[t,n]:e.mutableSourceEagerHydrationData.push(t,n)},t.runWithPriority=function(e,t){var n=Rt;try{return Rt=e,t()}finally{Rt=n}},t.shouldError=function(){return null},t.shouldSuspend=function(){return!1},t.updateContainer=function(e,t,n,r){var a=t.current,i=ko(),o=wo(a);return n=us(n),null===t.context?t.context=n:t.pendingContext=n,(t=mn(i,o)).payload={element:e},null!==(r=void 0===r?null:r)&&(t.callback=r),gn(a,t),null!==(e=_o(a,o,i))&&yn(e,a,o),o},t}},4585:function(e,t,n){"use strict";e.exports=n(4976)},258:function(e,t,n){"use strict";e.exports=n(3721)},7211:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.isNative=void 0;var n="undefined"!==typeof window&&(window.SpeechRecognition||window.webkitSpeechRecognition||window.mozSpeechRecognition||window.msSpeechRecognition||window.oSpeechRecognition);t.isNative=function(e){return e===n};var r=n;t.default=r},4019:function(e,t,n){"use strict";var r=n(7061).default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,i=(a=n(7833))&&a.__esModule?a:{default:a},o=n(1081),s=n(7211);function u(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){u(i,r,a,o,s,"next",e)}function s(e){u(i,r,a,o,s,"throw",e)}o(void 0)}))}}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.recognition=null,this.pauseAfterDisconnect=!1,this.interimTranscript="",this.finalTranscript="",this.listening=!1,this.isMicrophoneAvailable=!0,this.subscribers={},this.onStopListening=function(){},this.previousResultWasFinalOnly=!1,this.resetTranscript=this.resetTranscript.bind(this),this.startListening=this.startListening.bind(this),this.stopListening=this.stopListening.bind(this),this.abortListening=this.abortListening.bind(this),this.setSpeechRecognition=this.setSpeechRecognition.bind(this),this.disableRecognition=this.disableRecognition.bind(this),this.setSpeechRecognition(t),(0,i.default)()&&(this.updateFinalTranscript=(0,o.debounce)(this.updateFinalTranscript,250,!0))}var t,n,a;return t=e,n=[{key:"setSpeechRecognition",value:function(e){var t=!!e&&((0,s.isNative)(e)||(0,o.browserSupportsPolyfills)());t&&(this.disableRecognition(),this.recognition=new e,this.recognition.continuous=!1,this.recognition.interimResults=!0,this.recognition.onresult=this.updateTranscript.bind(this),this.recognition.onend=this.onRecognitionDisconnect.bind(this),this.recognition.onerror=this.onError.bind(this)),this.emitBrowserSupportsSpeechRecognitionChange(t)}},{key:"subscribe",value:function(e,t){this.subscribers[e]=t}},{key:"unsubscribe",value:function(e){delete this.subscribers[e]}},{key:"emitListeningChange",value:function(e){var t=this;this.listening=e,Object.keys(this.subscribers).forEach((function(n){(0,t.subscribers[n].onListeningChange)(e)}))}},{key:"emitMicrophoneAvailabilityChange",value:function(e){var t=this;this.isMicrophoneAvailable=e,Object.keys(this.subscribers).forEach((function(n){(0,t.subscribers[n].onMicrophoneAvailabilityChange)(e)}))}},{key:"emitTranscriptChange",value:function(e,t){var n=this;Object.keys(this.subscribers).forEach((function(r){(0,n.subscribers[r].onTranscriptChange)(e,t)}))}},{key:"emitClearTranscript",value:function(){var e=this;Object.keys(this.subscribers).forEach((function(t){(0,e.subscribers[t].onClearTranscript)()}))}},{key:"emitBrowserSupportsSpeechRecognitionChange",value:function(e){var t=this;Object.keys(this.subscribers).forEach((function(n){var r=t.subscribers[n],a=r.onBrowserSupportsSpeechRecognitionChange,i=r.onBrowserSupportsContinuousListeningChange;a(e),i(e)}))}},{key:"disconnect",value:function(e){if(this.recognition&&this.listening)switch(e){case"ABORT":this.pauseAfterDisconnect=!0,this.abort();break;case"RESET":this.pauseAfterDisconnect=!1,this.abort();break;default:this.pauseAfterDisconnect=!0,this.stop()}}},{key:"disableRecognition",value:function(){this.recognition&&(this.recognition.onresult=function(){},this.recognition.onend=function(){},this.recognition.onerror=function(){},this.listening&&this.stopListening())}},{key:"onError",value:function(e){e&&e.error&&"not-allowed"===e.error&&(this.emitMicrophoneAvailabilityChange(!1),this.disableRecognition())}},{key:"onRecognitionDisconnect",value:function(){this.onStopListening(),this.listening=!1,this.pauseAfterDisconnect?this.emitListeningChange(!1):this.recognition&&(this.recognition.continuous?this.startListening({continuous:this.recognition.continuous}):this.emitListeningChange(!1)),this.pauseAfterDisconnect=!1}},{key:"updateTranscript",value:function(e){var t=e.results,n=e.resultIndex,r=void 0===n?t.length-1:n;this.interimTranscript="",this.finalTranscript="";for(var a=r;a<t.length;++a)t[a].isFinal&&(!(0,i.default)()||t[a][0].confidence>0)?this.updateFinalTranscript(t[a][0].transcript):this.interimTranscript=(0,o.concatTranscripts)(this.interimTranscript,t[a][0].transcript);var s=!1;""===this.interimTranscript&&""!==this.finalTranscript?(this.previousResultWasFinalOnly&&(s=!0),this.previousResultWasFinalOnly=!0):this.previousResultWasFinalOnly=!1,s||this.emitTranscriptChange(this.interimTranscript,this.finalTranscript)}},{key:"updateFinalTranscript",value:function(e){this.finalTranscript=(0,o.concatTranscripts)(this.finalTranscript,e)}},{key:"resetTranscript",value:function(){this.disconnect("RESET")}},{key:"startListening",value:function(){var e=c(r().mark((function e(){var t,n,a,i,o,s,u=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=u.length>0&&void 0!==u[0]?u[0]:{},n=t.continuous,a=void 0!==n&&n,i=t.language,this.recognition){e.next=3;break}return e.abrupt("return");case 3:if(o=a!==this.recognition.continuous,s=i&&i!==this.recognition.lang,!o&&!s){e.next=11;break}if(!this.listening){e.next=9;break}return e.next=9,this.stopListening();case 9:this.recognition.continuous=o?a:this.recognition.continuous,this.recognition.lang=s?i:this.recognition.lang;case 11:if(this.listening){e.next=22;break}return this.recognition.continuous||(this.resetTranscript(),this.emitClearTranscript()),e.prev=13,e.next=16,this.start();case 16:this.emitListeningChange(!0),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(13),e.t0 instanceof DOMException||this.emitMicrophoneAvailabilityChange(!1);case 22:case"end":return e.stop()}}),e,this,[[13,19]])})));return function(){return e.apply(this,arguments)}}()},{key:"abortListening",value:function(){var e=c(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.disconnect("ABORT"),this.emitListeningChange(!1),e.next=4,new Promise((function(e){t.onStopListening=e}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stopListening",value:function(){var e=c(r().mark((function e(){var t=this;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.disconnect("STOP"),this.emitListeningChange(!1),e.next=4,new Promise((function(e){t.onStopListening=e}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getRecognition",value:function(){return this.recognition}},{key:"start",value:function(){var e=c(r().mark((function e(){return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.recognition||this.listening){e.next=4;break}return e.next=3,this.recognition.start();case 3:this.listening=!0;case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"stop",value:function(){this.recognition&&this.listening&&(this.recognition.stop(),this.listening=!1)}},{key:"abort",value:function(){this.recognition&&this.listening&&(this.recognition.abort(),this.listening=!1)}}],n&&l(t.prototype,n),a&&l(t,a),e}();t.default=h},6212:function(e,t,n){"use strict";var r=n(7061).default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=t.useSpeechRecognition=void 0;var a=n(2791),i=n(1081),o=n(2550),s=n(5453),u=h(n(4019)),c=h(n(7833)),l=h(n(7211));function h(e){return e&&e.__esModule?e:{default:e}}function f(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function d(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){f(i,r,a,o,s,"next",e)}function s(e){f(i,r,a,o,s,"throw",e)}o(void 0)}))}}function p(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||g(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){return v="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){if("undefined"===typeof Symbol||!(Symbol.iterator in Object(e)))return;var n=[],r=!0,a=!1,i=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(u){a=!0,i=u}finally{try{r||null==s.return||s.return()}finally{if(a)throw i}}return n}(e,t)||g(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(e,t){if(e){if("string"===typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?y(e,t):void 0}}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var b,x=!!l.default,k=x&&!(0,c.default)();t.useSpeechRecognition=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.transcribing,n=void 0===t||t,r=e.clearTranscriptOnListen,u=void 0===r||r,c=e.commands,l=void 0===c?[]:c,h=(0,a.useState)(w.getRecognitionManager()),f=m(h,1),d=f[0],g=(0,a.useState)(x),y=m(g,2),b=y[0],_=y[1],S=(0,a.useState)(k),C=m(S,2),T=C[0],E=C[1],I=(0,a.useReducer)(s.transcriptReducer,{interimTranscript:d.interimTranscript,finalTranscript:""}),A=m(I,2),M=A[0],N=M.interimTranscript,R=M.finalTranscript,D=A[1],P=(0,a.useState)(d.listening),O=m(P,2),L=O[0],F=O[1],z=(0,a.useState)(d.isMicrophoneAvailable),B=m(z,2),U=B[0],V=B[1],W=(0,a.useRef)(l);W.current=l;var G=function(){D((0,o.clearTranscript)())},j=(0,a.useCallback)((function(){d.resetTranscript(),G()}),[d]),q=function(e,t,n){var r=("object"===v(e)?e.toString():e).replace(/[&/\\#,+()!$~%.'":*?<>{}]/g,"").replace(/  +/g," ").trim(),a=(0,i.compareTwoStringsUsingDiceCoefficient)(r,t);return a>=n?{command:e,commandWithoutSpecials:r,howSimilar:a,isFuzzyMatch:!0}:null},H=function(e,t){var n=(0,i.commandToRegExp)(e).exec(t);return n?{command:e,parameters:n.slice(1)}:null},X=(0,a.useCallback)((function(e,t){W.current.forEach((function(n){var r=n.command,a=n.callback,i=n.matchInterim,o=void 0!==i&&i,s=n.isFuzzyMatch,u=void 0!==s&&s,c=n.fuzzyMatchingThreshold,l=void 0===c?.8:c,h=n.bestMatchOnly,f=void 0!==h&&h,d=!t&&o?e.trim():t.trim(),v=(Array.isArray(r)?r:[r]).map((function(e){return u?q(e,d,l):H(e,d)})).filter((function(e){return e}));if(u&&f&&v.length>=2){v.sort((function(e,t){return t.howSimilar-e.howSimilar}));var m=v[0],g=m.command,y=m.commandWithoutSpecials,b=m.howSimilar;a(y,d,b,{command:g,resetTranscript:j})}else v.forEach((function(e){if(e.isFuzzyMatch){var t=e.command,n=e.commandWithoutSpecials,r=e.howSimilar;a(n,d,r,{command:t,resetTranscript:j})}else{var i=e.command,o=e.parameters;a.apply(void 0,p(o).concat([{command:i,resetTranscript:j}]))}}))}))}),[j]),K=(0,a.useCallback)((function(e,t){n&&D((0,o.appendTranscript)(e,t)),X(e,t)}),[X,n]),Y=(0,a.useCallback)((function(){u&&G()}),[u]);(0,a.useEffect)((function(){var e=w.counter;w.counter+=1;var t={onListeningChange:F,onMicrophoneAvailabilityChange:V,onTranscriptChange:K,onClearTranscript:Y,onBrowserSupportsSpeechRecognitionChange:_,onBrowserSupportsContinuousListeningChange:E};return d.subscribe(e,t),function(){d.unsubscribe(e)}}),[n,u,d,K,Y]);var Q=(0,i.concatTranscripts)(R,N);return{transcript:Q,interimTranscript:N,finalTranscript:R,listening:L,isMicrophoneAvailable:U,resetTranscript:j,browserSupportsSpeechRecognition:b,browserSupportsContinuousListening:T}};var w={counter:0,applyPolyfill:function(e){b?b.setSpeechRecognition(e):b=new u.default(e);var t=!!e&&(0,i.browserSupportsPolyfills)();x=t,k=t},getRecognitionManager:function(){return b||(b=new u.default(l.default)),b},getRecognition:function(){return w.getRecognitionManager().getRecognition()},startListening:function(){var e=d(r().mark((function e(){var t,n,a,i,o=arguments;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:{},n=t.continuous,a=t.language,i=w.getRecognitionManager(),e.next=4,i.startListening({continuous:n,language:a});case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),stopListening:function(){var e=d(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=w.getRecognitionManager(),e.next=3,t.stopListening();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),abortListening:function(){var e=d(r().mark((function e(){var t;return r().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=w.getRecognitionManager(),e.next=3,t.abortListening();case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),browserSupportsSpeechRecognition:function(){return x},browserSupportsContinuousListening:function(){return k}},_=w;t.default=_},2550:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appendTranscript=t.clearTranscript=void 0;var r=n(695);t.clearTranscript=function(){return{type:r.CLEAR_TRANSCRIPT}};t.appendTranscript=function(e,t){return{type:r.APPEND_TRANSCRIPT,payload:{interimTranscript:e,finalTranscript:t}}}},695:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.APPEND_TRANSCRIPT=t.CLEAR_TRANSCRIPT=void 0;t.CLEAR_TRANSCRIPT="CLEAR_TRANSCRIPT";t.APPEND_TRANSCRIPT="APPEND_TRANSCRIPT"},5801:function(e,t,n){"use strict";function r(e){return r="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}Object.defineProperty(t,"x6",{enumerable:!0,get:function(){return a.useSpeechRecognition}}),t.ZP=void 0;var a=function(e){if(e&&e.__esModule)return e;if(null===e||"object"!==r(e)&&"function"!==typeof e)return{default:e};var t=i();if(t&&t.has(e))return t.get(e);var n={},a=Object.defineProperty&&Object.getOwnPropertyDescriptor;for(var o in e)if(Object.prototype.hasOwnProperty.call(e,o)){var s=a?Object.getOwnPropertyDescriptor(e,o):null;s&&(s.get||s.set)?Object.defineProperty(n,o,s):n[o]=e[o]}n.default=e,t&&t.set(e,n);return n}(n(6212));function i(){if("function"!==typeof WeakMap)return null;var e=new WeakMap;return i=function(){return e},e}var o=a.default;t.ZP=o},7833:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;t.default=function(){return/(android)/i.test("undefined"!==typeof navigator?navigator.userAgent:"")}},5453:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.transcriptReducer=void 0;var r=n(695),a=n(1081);t.transcriptReducer=function(e,t){switch(t.type){case r.CLEAR_TRANSCRIPT:return{interimTranscript:"",finalTranscript:""};case r.APPEND_TRANSCRIPT:return{interimTranscript:t.payload.interimTranscript,finalTranscript:(0,a.concatTranscripts)(e.finalTranscript,t.payload.finalTranscript)};default:throw new Error}}},1081:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.browserSupportsPolyfills=t.compareTwoStringsUsingDiceCoefficient=t.commandToRegExp=t.concatTranscripts=t.debounce=void 0;t.debounce=function(e,t,n){var r;return function(){var a=this,i=arguments,o=function(){r=null,n||e.apply(a,i)},s=n&&!r;clearTimeout(r),r=setTimeout(o,t),s&&e.apply(a,i)}};t.concatTranscripts=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.map((function(e){return e.trim()})).join(" ").trim()};var n=/\s*\((.*?)\)\s*/g,r=/(\(\?:[^)]+\))\?/g,a=/(\(\?)?:\w+/g,i=/\*/g,o=/[-{}[\]+?.,\\^$|#]/g;t.commandToRegExp=function(e){return e instanceof RegExp?new RegExp(e.source,"i"):(e=e.replace(o,"\\$&").replace(n,"(?:$1)?").replace(a,(function(e,t){return t?e:"([^\\s]+)"})).replace(i,"(.*?)").replace(r,"\\s*$1?\\s*"),new RegExp("^"+e+"$","i"))};t.compareTwoStringsUsingDiceCoefficient=function(e,t){if(e=e.replace(/\s+/g,"").toLowerCase(),t=t.replace(/\s+/g,"").toLowerCase(),!e.length&&!t.length)return 1;if(!e.length||!t.length)return 0;if(e===t)return 1;if(1===e.length&&1===t.length)return 0;if(e.length<2||t.length<2)return 0;for(var n=new Map,r=0;r<e.length-1;r++){var a=e.substring(r,r+2),i=n.has(a)?n.get(a)+1:1;n.set(a,i)}for(var o=0,s=0;s<t.length-1;s++){var u=t.substring(s,s+2),c=n.has(u)?n.get(u):0;c>0&&(n.set(u,c-1),o++)}return 2*o/(e.length+t.length-2)};t.browserSupportsPolyfills=function(){return"undefined"!==typeof window&&void 0!==window.navigator&&void 0!==window.navigator.mediaDevices&&void 0!==window.navigator.mediaDevices.getUserMedia&&(void 0!==window.AudioContext||void 0!==window.webkitAudioContext)}},6374:function(e,t,n){"use strict";var r=n(2791),a=Symbol.for("react.element"),i=Symbol.for("react.fragment"),o=Object.prototype.hasOwnProperty,s=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,u={key:!0,ref:!0,__self:!0,__source:!0};function c(e,t,n){var r,i={},c=null,l=null;for(r in void 0!==n&&(c=""+n),void 0!==t.key&&(c=""+t.key),void 0!==t.ref&&(l=t.ref),t)o.call(t,r)&&!u.hasOwnProperty(r)&&(i[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===i[r]&&(i[r]=t[r]);return{$$typeof:a,type:e,key:c,ref:l,props:i,_owner:s.current}}t.Fragment=i,t.jsx=c,t.jsxs=c},9117:function(e,t){"use strict";var n=Symbol.for("react.element"),r=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),i=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),s=Symbol.for("react.provider"),u=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),l=Symbol.for("react.suspense"),h=Symbol.for("react.memo"),f=Symbol.for("react.lazy"),d=Symbol.iterator;var p={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},v=Object.assign,m={};function g(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}function y(){}function b(e,t,n){this.props=e,this.context=t,this.refs=m,this.updater=n||p}g.prototype.isReactComponent={},g.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},g.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},y.prototype=g.prototype;var x=b.prototype=new y;x.constructor=b,v(x,g.prototype),x.isPureReactComponent=!0;var k=Array.isArray,w=Object.prototype.hasOwnProperty,_={current:null},S={key:!0,ref:!0,__self:!0,__source:!0};function C(e,t,r){var a,i={},o=null,s=null;if(null!=t)for(a in void 0!==t.ref&&(s=t.ref),void 0!==t.key&&(o=""+t.key),t)w.call(t,a)&&!S.hasOwnProperty(a)&&(i[a]=t[a]);var u=arguments.length-2;if(1===u)i.children=r;else if(1<u){for(var c=Array(u),l=0;l<u;l++)c[l]=arguments[l+2];i.children=c}if(e&&e.defaultProps)for(a in u=e.defaultProps)void 0===i[a]&&(i[a]=u[a]);return{$$typeof:n,type:e,key:o,ref:s,props:i,_owner:_.current}}function T(e){return"object"===typeof e&&null!==e&&e.$$typeof===n}var E=/\/+/g;function I(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,(function(e){return t[e]}))}(""+e.key):t.toString(36)}function A(e,t,a,i,o){var s=typeof e;"undefined"!==s&&"boolean"!==s||(e=null);var u=!1;if(null===e)u=!0;else switch(s){case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case n:case r:u=!0}}if(u)return o=o(u=e),e=""===i?"."+I(u,0):i,k(o)?(a="",null!=e&&(a=e.replace(E,"$&/")+"/"),A(o,t,a,"",(function(e){return e}))):null!=o&&(T(o)&&(o=function(e,t){return{$$typeof:n,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(o,a+(!o.key||u&&u.key===o.key?"":(""+o.key).replace(E,"$&/")+"/")+e)),t.push(o)),1;if(u=0,i=""===i?".":i+":",k(e))for(var c=0;c<e.length;c++){var l=i+I(s=e[c],c);u+=A(s,t,a,l,o)}else if(l=function(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=d&&e[d]||e["@@iterator"])?e:null}(e),"function"===typeof l)for(e=l.call(e),c=0;!(s=e.next()).done;)u+=A(s=s.value,t,a,l=i+I(s,c++),o);else if("object"===s)throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.");return u}function M(e,t,n){if(null==e)return e;var r=[],a=0;return A(e,r,"","",(function(e){return t.call(n,e,a++)})),r}function N(e){if(-1===e._status){var t=e._result;(t=t()).then((function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)}),(function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)})),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var R={current:null},D={transition:null},P={ReactCurrentDispatcher:R,ReactCurrentBatchConfig:D,ReactCurrentOwner:_};t.Children={map:M,forEach:function(e,t,n){M(e,(function(){t.apply(this,arguments)}),n)},count:function(e){var t=0;return M(e,(function(){t++})),t},toArray:function(e){return M(e,(function(e){return e}))||[]},only:function(e){if(!T(e))throw Error("React.Children.only expected to receive a single React element child.");return e}},t.Component=g,t.Fragment=a,t.Profiler=o,t.PureComponent=b,t.StrictMode=i,t.Suspense=l,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=P,t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var a=v({},e.props),i=e.key,o=e.ref,s=e._owner;if(null!=t){if(void 0!==t.ref&&(o=t.ref,s=_.current),void 0!==t.key&&(i=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(c in t)w.call(t,c)&&!S.hasOwnProperty(c)&&(a[c]=void 0===t[c]&&void 0!==u?u[c]:t[c])}var c=arguments.length-2;if(1===c)a.children=r;else if(1<c){u=Array(c);for(var l=0;l<c;l++)u[l]=arguments[l+2];a.children=u}return{$$typeof:n,type:e.type,key:i,ref:o,props:a,_owner:s}},t.createContext=function(e){return(e={$$typeof:u,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null}).Provider={$$typeof:s,_context:e},e.Consumer=e},t.createElement=C,t.createFactory=function(e){var t=C.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=T,t.lazy=function(e){return{$$typeof:f,_payload:{_status:-1,_result:e},_init:N}},t.memo=function(e,t){return{$$typeof:h,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=D.transition;D.transition={};try{e()}finally{D.transition=t}},t.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")},t.useCallback=function(e,t){return R.current.useCallback(e,t)},t.useContext=function(e){return R.current.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e){return R.current.useDeferredValue(e)},t.useEffect=function(e,t){return R.current.useEffect(e,t)},t.useId=function(){return R.current.useId()},t.useImperativeHandle=function(e,t,n){return R.current.useImperativeHandle(e,t,n)},t.useInsertionEffect=function(e,t){return R.current.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return R.current.useLayoutEffect(e,t)},t.useMemo=function(e,t){return R.current.useMemo(e,t)},t.useReducer=function(e,t,n){return R.current.useReducer(e,t,n)},t.useRef=function(e){return R.current.useRef(e)},t.useState=function(e){return R.current.useState(e)},t.useSyncExternalStore=function(e,t,n){return R.current.useSyncExternalStore(e,t,n)},t.useTransition=function(){return R.current.useTransition()},t.version="18.2.0"},2791:function(e,t,n){"use strict";e.exports=n(9117)},184:function(e,t,n){"use strict";e.exports=n(6374)},6813:function(e,t){"use strict";function n(e,t){var n=e.length;e.push(t);e:for(;0<n;){var r=n-1>>>1,a=e[r];if(!(0<i(a,t)))break e;e[r]=t,e[n]=a,n=r}}function r(e){return 0===e.length?null:e[0]}function a(e){if(0===e.length)return null;var t=e[0],n=e.pop();if(n!==t){e[0]=n;e:for(var r=0,a=e.length,o=a>>>1;r<o;){var s=2*(r+1)-1,u=e[s],c=s+1,l=e[c];if(0>i(u,n))c<a&&0>i(l,u)?(e[r]=l,e[c]=n,r=c):(e[r]=u,e[s]=n,r=s);else{if(!(c<a&&0>i(l,n)))break e;e[r]=l,e[c]=n,r=c}}}return t}function i(e,t){var n=e.sortIndex-t.sortIndex;return 0!==n?n:e.id-t.id}if("object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var s=Date,u=s.now();t.unstable_now=function(){return s.now()-u}}var c=[],l=[],h=1,f=null,d=3,p=!1,v=!1,m=!1,g="function"===typeof setTimeout?setTimeout:null,y="function"===typeof clearTimeout?clearTimeout:null,b="undefined"!==typeof setImmediate?setImmediate:null;function x(e){for(var t=r(l);null!==t;){if(null===t.callback)a(l);else{if(!(t.startTime<=e))break;a(l),t.sortIndex=t.expirationTime,n(c,t)}t=r(l)}}function k(e){if(m=!1,x(e),!v)if(null!==r(c))v=!0,D(w);else{var t=r(l);null!==t&&P(k,t.startTime-e)}}function w(e,n){v=!1,m&&(m=!1,y(T),T=-1),p=!0;var i=d;try{for(x(n),f=r(c);null!==f&&(!(f.expirationTime>n)||e&&!A());){var o=f.callback;if("function"===typeof o){f.callback=null,d=f.priorityLevel;var s=o(f.expirationTime<=n);n=t.unstable_now(),"function"===typeof s?f.callback=s:f===r(c)&&a(c),x(n)}else a(c);f=r(c)}if(null!==f)var u=!0;else{var h=r(l);null!==h&&P(k,h.startTime-n),u=!1}return u}finally{f=null,d=i,p=!1}}"undefined"!==typeof navigator&&void 0!==navigator.scheduling&&void 0!==navigator.scheduling.isInputPending&&navigator.scheduling.isInputPending.bind(navigator.scheduling);var _,S=!1,C=null,T=-1,E=5,I=-1;function A(){return!(t.unstable_now()-I<E)}function M(){if(null!==C){var e=t.unstable_now();I=e;var n=!0;try{n=C(!0,e)}finally{n?_():(S=!1,C=null)}}else S=!1}if("function"===typeof b)_=function(){b(M)};else if("undefined"!==typeof MessageChannel){var N=new MessageChannel,R=N.port2;N.port1.onmessage=M,_=function(){R.postMessage(null)}}else _=function(){g(M,0)};function D(e){C=e,S||(S=!0,_())}function P(e,n){T=g((function(){e(t.unstable_now())}),n)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_continueExecution=function(){v||p||(v=!0,D(w))},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):E=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return d},t.unstable_getFirstCallbackNode=function(){return r(c)},t.unstable_next=function(e){switch(d){case 1:case 2:case 3:var t=3;break;default:t=d}var n=d;d=t;try{return e()}finally{d=n}},t.unstable_pauseExecution=function(){},t.unstable_requestPaint=function(){},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var n=d;d=e;try{return t()}finally{d=n}},t.unstable_scheduleCallback=function(e,a,i){var o=t.unstable_now();switch("object"===typeof i&&null!==i?i="number"===typeof(i=i.delay)&&0<i?o+i:o:i=o,e){case 1:var s=-1;break;case 2:s=250;break;case 5:s=1073741823;break;case 4:s=1e4;break;default:s=5e3}return e={id:h++,callback:a,priorityLevel:e,startTime:i,expirationTime:s=i+s,sortIndex:-1},i>o?(e.sortIndex=i,n(l,e),null===r(c)&&e===r(l)&&(m?(y(T),T=-1):m=!0,P(k,i-o))):(e.sortIndex=s,n(c,e),v||p||(v=!0,D(w))),e},t.unstable_shouldYield=A,t.unstable_wrapCallback=function(e){var t=d;return function(){var n=d;d=t;try{return e.apply(this,arguments)}finally{d=n}}}},5296:function(e,t,n){"use strict";e.exports=n(6813)},6699:function(e,t,n){var r=n(2501),a=n(9112),i=n(2132),o=n(890),s=n(4113),u=n(1725),c=n(3411);c.alea=r,c.xor128=a,c.xorwow=i,c.xorshift7=o,c.xor4096=s,c.tychei=u,e.exports=c},2501:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n=function(){var e=4022871197;return function(t){t=t.toString();for(var n=0;n<t.length;n++){var r=.02519603282416938*(e+=t.charCodeAt(n));r-=e=r>>>0,e=(r*=e)>>>0,e+=4294967296*(r-=e)}return 2.3283064365386963e-10*(e>>>0)}}();t.next=function(){var e=2091639*t.s0+2.3283064365386963e-10*t.c;return t.s0=t.s1,t.s1=t.s2,t.s2=e-(t.c=0|e)},t.c=1,t.s0=n(" "),t.s1=n(" "),t.s2=n(" "),t.s0-=n(e),t.s0<0&&(t.s0+=1),t.s1-=n(e),t.s1<0&&(t.s1+=1),t.s2-=n(e),t.s2<0&&(t.s2+=1),n=null}function s(e,t){return t.c=e.c,t.s0=e.s0,t.s1=e.s1,t.s2=e.s2,t}function u(e,t){var n=new o(e),r=t&&t.state,a=n.next;return a.int32=function(){return 4294967296*n.next()|0},a.double=function(){return a()+11102230246251565e-32*(2097152*a()|0)},a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.alea=u}(0,e=n.nmd(e),n.amdD)},1725:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.b,n=t.c,r=t.d,a=t.a;return e=e<<25^e>>>7^n,n=n-r|0,r=r<<24^r>>>8^a,a=a-e|0,t.b=e=e<<20^e>>>12^n,t.c=n=n-r|0,t.d=r<<16^n>>>16^a,t.a=a-e|0},t.a=0,t.b=0,t.c=-1640531527,t.d=1367130551,e===Math.floor(e)?(t.a=e/4294967296|0,t.b=0|e):n+=e;for(var r=0;r<n.length+20;r++)t.b^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.a=e.a,t.b=e.b,t.c=e.c,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.tychei=u}(0,e=n.nmd(e),n.amdD)},9112:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.x=0,t.y=0,t.z=0,t.w=0,t.next=function(){var e=t.x^t.x<<11;return t.x=t.y,t.y=t.z,t.z=t.w,t.w^=t.w>>>19^e^e>>>8},e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor128=u}(0,e=n.nmd(e),n.amdD)},4113:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.w,a=t.X,i=t.i;return t.w=r=r+1640531527|0,n=a[i+34&127],e=a[i=i+1&127],n^=n<<13,e^=e<<17,n^=n>>>15,e^=e>>>12,n=a[i]=n^e,t.i=i,n+(r^r>>>16)|0},function(e,t){var n,r,a,i,o,s=[],u=128;for(t===(0|t)?(r=t,t=null):(t+="\0",r=0,u=Math.max(u,t.length)),a=0,i=-32;i<u;++i)t&&(r^=t.charCodeAt((i+32)%t.length)),0===i&&(o=r),r^=r<<10,r^=r>>>15,r^=r<<4,r^=r>>>13,i>=0&&(o=o+1640531527|0,a=0==(n=s[127&i]^=r+o)?a+1:0);for(a>=128&&(s[127&(t&&t.length||0)]=-1),a=127,i=512;i>0;--i)r=s[a+34&127],n=s[a=a+1&127],r^=r<<13,n^=n<<17,r^=r>>>15,n^=n>>>12,s[a]=r^n;e.w=o,e.X=s,e.i=a}(t,e)}function s(e,t){return t.i=e.i,t.w=e.w,t.X=e.X.slice(),t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.X&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xor4096=u}(0,e=n.nmd(e),n.amdD)},890:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this;t.next=function(){var e,n,r=t.x,a=t.i;return e=r[a],n=(e^=e>>>7)^e<<24,n^=(e=r[a+1&7])^e>>>10,n^=(e=r[a+3&7])^e>>>3,n^=(e=r[a+4&7])^e<<7,e=r[a+7&7],n^=(e^=e<<13)^e<<9,r[a]=n,t.i=a+1&7,n},function(e,t){var n,r=[];if(t===(0|t))r[0]=t;else for(t=""+t,n=0;n<t.length;++n)r[7&n]=r[7&n]<<15^t.charCodeAt(n)+r[n+1&7]<<13;for(;r.length<8;)r.push(0);for(n=0;n<8&&0===r[n];++n);for(8==n?r[7]=-1:r[n],e.x=r,e.i=0,n=256;n>0;--n)e.next()}(t,e)}function s(e,t){return t.x=e.x.slice(),t.i=e.i,t}function u(e,t){null==e&&(e=+new Date);var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&(r.x&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorshift7=u}(0,e=n.nmd(e),n.amdD)},2132:function(e,t,n){var r;!function(e,a,i){function o(e){var t=this,n="";t.next=function(){var e=t.x^t.x>>>2;return t.x=t.y,t.y=t.z,t.z=t.w,t.w=t.v,(t.d=t.d+362437|0)+(t.v=t.v^t.v<<4^e^e<<1)|0},t.x=0,t.y=0,t.z=0,t.w=0,t.v=0,e===(0|e)?t.x=e:n+=e;for(var r=0;r<n.length+64;r++)t.x^=0|n.charCodeAt(r),r==n.length&&(t.d=t.x<<10^t.x>>>4),t.next()}function s(e,t){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t.v=e.v,t.d=e.d,t}function u(e,t){var n=new o(e),r=t&&t.state,a=function(){return(n.next()>>>0)/4294967296};return a.double=function(){do{var e=((n.next()>>>11)+(n.next()>>>0)/4294967296)/(1<<21)}while(0===e);return e},a.int32=n.next,a.quick=a,r&&("object"==typeof r&&s(r,n),a.state=function(){return s(n,{})}),a}a&&a.exports?a.exports=u:n.amdD&&n.amdO?void 0===(r=function(){return u}.call(t,n,t,a))||(a.exports=r):this.xorwow=u}(0,e=n.nmd(e),n.amdD)},3411:function(e,t,n){var r;!function(a,i){var o,s=this,u=256,c=i.pow(u,6),l=i.pow(2,52),h=2*l,f=255;function d(e,t,n){var r=[],f=g(m((t=1==t?{entropy:!0}:t||{}).entropy?[e,y(a)]:null==e?function(){try{var e;return o&&(e=o.randomBytes)?e=e(u):(e=new Uint8Array(u),(s.crypto||s.msCrypto).getRandomValues(e)),y(e)}catch(r){var t=s.navigator,n=t&&t.plugins;return[+new Date,s,n,s.screen,y(a)]}}():e,3),r),d=new p(r),b=function(){for(var e=d.g(6),t=c,n=0;e<l;)e=(e+n)*u,t*=u,n=d.g(1);for(;e>=h;)e/=2,t/=2,n>>>=1;return(e+n)/t};return b.int32=function(){return 0|d.g(4)},b.quick=function(){return d.g(4)/4294967296},b.double=b,g(y(d.S),a),(t.pass||n||function(e,t,n,r){return r&&(r.S&&v(r,d),e.state=function(){return v(d,{})}),n?(i.random=e,t):e})(b,f,"global"in t?t.global:this==i,t.state)}function p(e){var t,n=e.length,r=this,a=0,i=r.i=r.j=0,o=r.S=[];for(n||(e=[n++]);a<u;)o[a]=a++;for(a=0;a<u;a++)o[a]=o[i=f&i+e[a%n]+(t=o[a])],o[i]=t;(r.g=function(e){for(var t,n=0,a=r.i,i=r.j,o=r.S;e--;)t=o[a=f&a+1],n=n*u+o[f&(o[a]=o[i=f&i+t])+(o[i]=t)];return r.i=a,r.j=i,n})(u)}function v(e,t){return t.i=e.i,t.j=e.j,t.S=e.S.slice(),t}function m(e,t){var n,r=[],a=typeof e;if(t&&"object"==a)for(n in e)try{r.push(m(e[n],t-1))}catch(i){}return r.length?r:"string"==a?e:e+"\0"}function g(e,t){for(var n,r=e+"",a=0;a<r.length;)t[f&a]=f&(n^=19*t[f&a])+r.charCodeAt(a++);return y(t)}function y(e){return String.fromCharCode.apply(0,e)}if(i.seedrandom=d,g(i.random(),a),e.exports){e.exports=d;try{o=n(5042)}catch(b){}}else void 0===(r=function(){return d}.call(t,n,t,e))||(e.exports=r)}([],Math)},9613:function(e){e.exports=function(e,t,n,r){var a=n?n.call(r,e,t):void 0;if(void 0!==a)return!!a;if(e===t)return!0;if("object"!==typeof e||!e||"object"!==typeof t||!t)return!1;var i=Object.keys(e),o=Object.keys(t);if(i.length!==o.length)return!1;for(var s=Object.prototype.hasOwnProperty.bind(t),u=0;u<i.length;u++){var c=i[u];if(!s(c))return!1;var l=e[c],h=t[c];if(!1===(a=n?n.call(r,l,h,c):void 0)||void 0===a&&l!==h)return!1}return!0}},6105:function(e,t,n){var r=n(6690).default,a=n(9728).default;self,e.exports=function(e){var t={};function n(r){if(t[r])return t[r].exports;var a=t[r]={i:r,l:!1,exports:{}};return e[r].call(a.exports,a,a.exports,n),a.l=!0,a.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(r,a,function(t){return e[t]}.bind(null,a));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=4)}([function(e,t,n){"use strict";n.r(t),n.d(t,"SVGNS",(function(){return r})),n.d(t,"drawSVGPath",(function(){return a})),n.d(t,"drawSVGText",(function(){return i})),n.d(t,"createSVGGroupChild",(function(){return o})),n.d(t,"setFade",(function(){return s}));var r="http://www.w3.org/2000/svg";function a(e,t,n,a,i,o){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,u=document.createElementNS(r,"path");return u.setAttributeNS(null,"d",t),u.setAttributeNS(null,"transform","translate(".concat(n,", ").concat(a,") scale(").concat(i,", ").concat(o,")")),u.setAttributeNS(null,"opacity","".concat(s)),e.appendChild(u),u}function i(e,t,n,a,i){var o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1,u=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,c=document.createElementNS(r,"text");c.setAttributeNS(null,"font-family","Times"),c.setAttributeNS(null,"font-size",i),o&&c.setAttributeNS(null,"font-weight","bold"),c.setAttributeNS(null,"transform","translate(".concat(n,", ").concat(a,") scale(").concat(s,", ").concat(u,")"));var l=document.createTextNode(t);return c.appendChild(l),e.appendChild(c),c}function o(e,t){var n=document.createElementNS(r,"g");return n.setAttribute("data-id",t),e.appendChild(n),n}function s(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=e.querySelector("animate");if(!i){(i=document.createElementNS(r,"animate")).setAttributeNS(null,"attributeName","opacity"),i.setAttributeNS(null,"dur","4s"),i.setAttributeNS(null,"fill","freeze"),i.setAttributeNS(null,"keyTimes","0; 0.25; 0.5; 0.75; 1");var o=(n+3*a)/4;i.setAttributeNS(null,"values","".concat(n,"; ").concat(o,"; ").concat(a,"; ").concat(o,"; ").concat(n))}return t?i.setAttributeNS(null,"repeatCount","indefinite"):i.setAttributeNS(null,"repeatCount","1"),e.appendChild(i),e}},function(e,t,n){"use strict";n.r(t),n.d(t,"PATH_SCALE",(function(){return r})),n.d(t,"staffLinePath",(function(){return i})),n.d(t,"extraLinePath",(function(){return o})),n.d(t,"barPath",(function(){return s})),n.d(t,"stemPath",(function(){return u})),n.d(t,"singleFlagPath",(function(){return c})),n.d(t,"multiFlagPath",(function(){return l})),n.d(t,"tiePath",(function(){return h})),n.d(t,"dotPath",(function(){return f})),n.d(t,"NOTE_PATHS",(function(){return d})),n.d(t,"REST_PATHS",(function(){return p})),n.d(t,"CLEF_PATHS",(function(){return v})),n.d(t,"ACCIDENTAL_PATHS",(function(){return m}));var r=100,a="M 0,10 C 0,-15 35,-50 80,-50 110,-50 125,-35 125,-10 \n125,15 90,50 45,50 15,50 0,35 0,10 Z",i="m 0,0 h 100",o="m -25,0 h 175",s="m 0,-200 v 400",u="m 0,0 v 100 h 15 v -100 z",c="M0,0 h 12 c 7,100 175,156 62,314 79,-177 -49,\n-193 -61,-200 l -13,-5 z",l="m 0,0 h 10 c 6,72 173,64 84,227 44,-120 -44,\n-123 -94,-167 z",h="M 0,25 C 10,46 30,67 50,67 69,67 90,47 100,25 94,\n65 73,89 50,89 26,89 5,63 0,25 Z",f="M 5 -20 a 20 20 0 1 0 0.00001 0 z",d={4:{path:"m 0,0 c 0,-37 49,-51 79,-51 31,0 83,13 83,51 0,39 \n-55,51 -84,51 C 49,51 0,37 0,0 Z m 111,31 c 13,-19 0,-58 -22,-68 -33,-15 \n-53,10 -39,49 9,27 48,39 61,19 z",width:150,stemVSteps:0,stemAnchor:0,flags:0},2:{path:"m 0,10 c 0,-25 35,-60 80,-60 15,0 45,4 45,40 C 125,16 \n89,50 45,50 17,50 0,36 0,10 Z m 71,7 c 17,-11 45,-34 38,-45 -7,-10 -39,1 \n-57,12 -19,11 -42,31 -36,42 6,10 37,2 55,-9 z",width:125,stemVSteps:7,stemAnchor:-10,flags:0},1:{path:a,width:125,stemVSteps:7,stemAnchor:-10,flags:0},.5:{path:a,width:125,stemVSteps:7,stemAnchor:-10,flags:1},.25:{path:a,width:125,stemVSteps:9,stemAnchor:-10,flags:2},.125:{path:a,width:125,stemVSteps:11,stemAnchor:-10,flags:3},.0625:{path:a,width:125,stemVSteps:13,stemAnchor:-10,flags:4}},p={4:"m 0,-50 h 125 v -50 H 0 Z",2:"M 0,0 H 125 V -50 H 0 Z",1:"m 0,-25 c 39,-39 37,-75 8,-120 l 6,-5 61,103 C \n40,-13 31,4 73,71 l -5,5 C 14,52 16,125 67,144 l -4,6 C -37,102 -1,22 59,60 Z",.5:"m 52,-47 c 26,-2 42,-21 48,-42 l 12,4 L 64,83 52,79 \n88,-49 c 0,0 -17,22 -57,22 -16,0 -31,-13 -31,-27 0,-18 10,-31 27,-31 17,0 \n33,15 25,38 z",.25:"m 129,-191 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -20,69 \nc -7,18 -22,33 -45,35 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 15,27 \n31,27 40,0 57,-22 57,-22 l -36,128 12,4 77,-270 z",.125:"m 129,-191 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -20,69 \nc -7,18 -22,33 -45,35 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 15,27 \n31,27 40,0 57,-22 57,-22 L 68,20 C 61,37 46,51 24,52 32,29 16,14 -1,14 c \n-17,0 -27,13 -27,31 0,14 15,27 31,27 38,0 55,-20 57,-22 l -36,128 12,4 \n105,-369 z",.0625:"m 158,-292 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -17,61 \nv 0 c -6,21 -22,40 -48,42 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 \n15,27 31,27 40,0 57,-22 57,-22 l -20,69 c -7,18 -22,33 -45,35 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 L 68,20 C \n61,37 46,51 24,52 32,29 16,14 -1,14 c -17,0 -27,13 -27,31 0,14 15,27 31,27 \n38,0 55,-20 57,-22 l -36,128 12,4 134,-469 z"},v={50:{path:"m 101,-199 c -49,0 -100,28 -100,83 0,39 58,57 82,26 15,-20 \n-4,-47 -32,-47 -23,1 -25,0 -25,-8 0,-22 40,-46 71,-41 91,16 67,208 -105,302 \n75,-27 198,-94 211,-201 6,-66 -42,-114 -102,-114 z m 143,33 c -13,0 -23,11 \n-23,24 0,14 10,24 23,24 13,0 23,-11 23,-24 0,-13 -10,-24 -23,-24 z m 2,83 c \n-13,0 -23,11 -23,24 0,14 10,24 23,24 13,0 23,-11 23,-24 0,-13 -10,-24 -23,-24 \nz",upper:-4,lower:3},71:{path:"M 139,48 C 102,57 76,120 131,151 41,128 64,24 129,2 L \n117,-57 C -32,47 26,217 166,182 Z m 12,-1 27,131 C 242,153 216,46 151,47 \nZ m -35,-177 c 34,-23 82,-117 50,-140 -23,-17 -71,33 -50,140 z m -10,10 c \n-23,-77 -20,-200 48,-213 19,-4 89,171 -26,266 l 13,66 c 120,-6 137,155 \n39,191 l 12,58 c 30,131 -137,145 -138,47 0,-29 37,-59 63,-37 21,18 25,71 \n-25,70 32,42 103,0 91,-65 L 167,193 C 56,232 -112,63 106,-120 Z",upper:-7,lower:8}},m=[null,"m -49,-121 v 52 l -29,9 v -48 h -8 v 51 l -20,6 v 29 l \n20,-6 v 70 l -20,6 v 30 l 20,-6 v 51 h 8 V 69 l 30,-8 v 50 h 8 V 58 l 20,-6 \nV 23 l -20,6 v -71 l 20,-6 v -29 l -20,6 v -50 z m 1,82 v 71 l -29,9 v -71 z","M -106,-166 V 67 c 52,-42 85,-56 85,-94 0,-47 -46,-51 \n-73,-22 v -117 z m 31,120 c 20,0 42,46 -20,91 V -7 c 0,-28 10,-39 20,-39 z","m -81,-58 v -48 H -92 V 73 l 60,-13 v 50 h 11 V -72 Z m \n50,24 v 58 l -50,11 v -58 z"]},function(e,t,n){"use strict";n.r(t),n.d(t,"MIN_RESOLUTION",(function(){return r})),n.d(t,"STEM_WIDTH",(function(){return a})),n.d(t,"LINE_STROKE",(function(){return i})),n.d(t,"COMPACT_SPACING",(function(){return o}));var r=.0625,a=15,i=1,o=150},function(e,t,n){"use strict";n.r(t),n.d(t,"MAX_QUARTER_DIVISION",(function(){return h})),n.d(t,"ScrollType",(function(){return i})),n.d(t,"StaffSVGRender",(function(){return f}));var i,o=n(2),s=n(0),u=n(1),c=[{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[0,1,0,1,0,0,1,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,0,3,0,3,0,0,3,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,0,1,0,3,0,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,0,3,0,2,0,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,3,0,0,3,0,3,0,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,2,0,0,2,0,2,0,0,3]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-7],accidental:[3,0,3,0,3,0,0,3,0,3,0,0]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[0,1,0,1,0,3,0,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,0,3,0,3,0,2,0,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,0,1,0,3,0,3,0,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,0,3,0,2,0,2,0,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,3,0,0,3,0,3,0,3,0,0]}],l=[{accidental:1,pitches:[]},{accidental:2,pitches:[70,75,68,73,66]},{accidental:1,pitches:[78,73]},{accidental:2,pitches:[70,75,68]},{accidental:1,pitches:[78,73,80,75]},{accidental:2,pitches:[70]},{accidental:2,pitches:[70,75,68,73,66,71]},{accidental:1,pitches:[78]},{accidental:2,pitches:[70,75,68,73]},{accidental:1,pitches:[78,73,80]},{accidental:2,pitches:[70,75]},{accidental:1,pitches:[78,73,80,75,70]}],h=16;!function(e){e[e.PAGE=0]="PAGE",e[e.NOTE=1]="NOTE",e[e.BAR=2]="BAR"}(i||(i={}));var f=function(){function e(t,n,a){var s=this;r(this,e),this.handleScrollEvent=function(e){s.lastKnownScrollLeft=s.parentElement.scrollLeft,s.ticking||window.requestAnimationFrame((function(){s.changeAndDrawSignaturesIfNeeded(s.lastKnownScrollLeft),s.ticking=!1})),s.ticking=!0},this.scoreInfo=t,this.config={noteHeight:n.noteHeight||6,noteSpacing:n.noteSpacing||1,pixelsPerTimeStep:n.pixelsPerTimeStep||30,noteRGB:n.noteRGB||"8, 41, 64",activeNoteRGB:n.activeNoteRGB||"240, 84, 119"},this.div=a,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.key=n.defaultKey||0,this.scrollType=n.scrollType||i.PAGE,this.scale=this.config.noteHeight/u.PATH_SCALE,(void 0===n.pixelsPerTimeStep||n.pixelsPerTimeStep<=0)&&(this.config.pixelsPerTimeStep=0,this.config.noteSpacing=o.COMPACT_SPACING*this.scale),this.clear(),this.redraw()}return a(e,[{key:"clear",value:function(){for(;this.div.lastChild;)this.div.removeChild(this.div.lastChild);this.div.style.overflow="visible",this.div.style.position="relative",this.overlaySVG=document.createElementNS(s.SVGNS,"svg"),this.overlaySVG.style.position="absolute",this.div.appendChild(this.overlaySVG),this.overlayG=Object(s.createSVGGroupChild)(this.overlaySVG,"overlay"),this.signaturesBlinking=!1,this.signaturesQuarters=0,this.parentElement=document.createElement("div"),this.parentElement.style.overflow="auto",this.div.appendChild(this.parentElement),this.ticking=!1,this.lastKnownScrollLeft=0,this.parentElement.addEventListener("scroll",this.handleScrollEvent),this.staffSVG=document.createElementNS(s.SVGNS,"svg"),this.parentElement.appendChild(this.staffSVG),this.staffG=Object(s.createSVGGroupChild)(this.staffSVG,"staff"),this.linesG=Object(s.createSVGGroupChild)(this.staffSVG,"lines"),this.setStroke(this.linesG),this.staffG.appendChild(this.linesG),this.musicG=Object(s.createSVGGroupChild)(this.staffSVG,"music"),this.setFill(this.musicG),this.setStroke(this.musicG,0),this.staffG.appendChild(this.musicG),this.signaturesG=Object(s.createSVGGroupChild)(this.staffSVG,"signatures"),this.staffG.appendChild(this.signaturesG);var e=0,t=0;this.scoreInfo.notes.forEach((function(n){e+=n.pitch,++t}));var n=e/t;this.clef=n<60?50:71,this.signaturesList=[{x:0,q:0}],this.signatureCurrent=0,this.signatureNext=0,this.changeKeySignatureIfNeeded(0),this.changeTimeSignatureIfNeeded(0),this.vStepSize=this.config.noteHeight/2,this.hStepSize=this.config.pixelsPerTimeStep,this.staffOffset=0,this.height=0,this.width=0,this.musicBlockMap=new Map,this.playingNotes=[],this.lastBar=0,this.barAccidentals={},this.lastQ=-1}},{key:"isPaintingActiveNote",value:function(e,t){var n=e.start===t.start,r=e.start<=t.start&&e.start+e.length>=t.start+t.length;return n||r}},{key:"redraw",value:function(e,t){var n=this,r=-1,a=0===this.config.pixelsPerTimeStep;if(e){var o=[];this.playingNotes.forEach((function(t){n.isPaintingActiveNote(t,e)?o.push(t):n.highlightElement(n.getGroup(t),!1)})),this.playingNotes=o;var u=this.getGroup(e);if(u){this.playingNotes.push(e),this.highlightElement(u,!0),r=u.getBoundingClientRect().left-this.staffSVG.getBoundingClientRect().left;var c=e.start,l=u.getAttribute("data-is-bar-beginning");(this.scrollType!==i.BAR||l)&&this.scrollIntoViewIfNeeded(t,r),!a&&this.signaturesBlinking&&c>=this.signaturesQuarters&&(this.signaturesBlinking=!1,Object(s.setFade)(this.overlayG,this.signaturesBlinking))}}else{this.setDetails();var h=-1===this.lastQ,f=0,d=0;h?(d=this.drawSignatures(this.overlayG,f,!0,!0,!0),a&&(this.width=0,d+=this.config.noteSpacing),d+=this.drawRests(this.initialRest,f+d)):f=this.width,this.musicBlockMap.forEach((function(e,t){a||(f=n.quartersToTime(t)*n.hStepSize),t>n.lastQ?(d+=n.drawMusicBlock(e,f+d),n.lastQ=t):t===n.lastQ&&(d+=n.drawRests(e,f+d))}));var p=this.staffSVG.getBoundingClientRect(),v=this.musicG.getBoundingClientRect();if(this.updateVerticalBoundaries(v.top-p.top,v.bottom-p.top),a)this.width+=d;else{var m=this.musicBlockMap.get(this.lastQ),g=this.quartersToTime(this.lastQ+m.notes[0].length);this.width=g*this.config.pixelsPerTimeStep}this.staffSVG.setAttributeNS(null,"width","".concat(this.width)),this.redrawStaff(this.linesG,0,this.width)}return r}},{key:"drawMusicBlock",value:function(e,t){var n=this,r=e.notes[0].start,a=this.drawBarIfNeeded(r,t);a+=this.drawSignaturesIfNeeded(r,t+a);for(var i=0,c=4;c>=o.MIN_RESOLUTION&&!i;c/=2)c<=e.notes[0].length&&(i=c);if(0===i){var l=0===e.notes[0].length?"[infinite]":"".concat(4/e.notes[0].length);console.warn(" StaffRender ","background:orange; color:white","StaffRender does not handle notes shorther than "+"1/".concat(4/o.MIN_RESOLUTION,"th, and this score tries to draw a ")+"1/".concat(l,"th. Shortest possible note will be drawn instead.")),i=o.MIN_RESOLUTION}var h,f=u.NOTE_PATHS[i];if(f.stemAnchor&&(h=Object(s.createSVGGroupChild)(this.musicG,"stem")),e.notes.forEach((function(r){for(var o=r.vSteps*n.vStepSize,c=2*(r.vSteps>0?Math.floor(r.vSteps/2):Math.ceil(r.vSteps/2)),l=r.vSteps>0?-2:2,h=c;Math.abs(h)>4;h+=l)Object(s.drawSVGPath)(n.linesG,u.extraLinePath,t+a,h*n.vStepSize,n.scale,1);if(r.g=r.tiedFrom?r.tiedFrom.g:Object(s.createSVGGroupChild)(n.musicG,"".concat(r.start,"-").concat(r.pitch)),e.isBarBeginning&&r.g.setAttribute("data-is-bar-beginning","true"),r.tiedFrom){var d=t+a-r.tiedFrom.xHeadRight;Object(s.drawSVGPath)(r.g,u.tiePath,r.tiedFrom.xHeadRight,o,d/u.PATH_SCALE,n.scale*(r.vSteps<0?-1:1),r.opacity)}Object(s.drawSVGPath)(r.g,f.path,t+a,o,n.scale,n.scale,r.opacity),r.xHeadRight=t+a+f.width*n.scale,1.5*i<=r.length&&Object(s.drawSVGPath)(r.g,u.dotPath,t+a+f.width*n.scale+n.vStepSize/2,o-n.vStepSize/2,n.scale,n.scale,r.opacity),0!==r.accidental&&Object(s.drawSVGPath)(r.g,u.ACCIDENTAL_PATHS[r.accidental],t+a,o,n.scale,n.scale,r.opacity)})),f.stemAnchor){var d,p,v=t+a,m=f.stemAnchor*this.scale,g=e.minVStep+e.maxVStep<0,y=f.flags>2?2*(f.flags-2):0;if(g?(d=e.maxVStep*this.vStepSize-m,p=(e.minVStep+7+y)*this.vStepSize):(v+=(f.width-o.STEM_WIDTH)*this.scale,d=e.minVStep*this.vStepSize+m,p=(e.maxVStep-7-y)*this.vStepSize),Object(s.drawSVGPath)(h,u.stemPath,v,d,this.scale,(p-d)/u.PATH_SCALE),1===f.flags)Object(s.drawSVGPath)(h,u.singleFlagPath,v,p,this.scale,this.scale*(g?-1:1),1);else if(f.flags>1)for(var b=0;b<f.flags;++b)Object(s.drawSVGPath)(h,u.multiFlagPath,v,p,this.scale,this.scale*(g?-1:1),1),p+=(g?-2:2)*this.vStepSize}return 0===this.config.pixelsPerTimeStep&&(a+=f.width*this.scale,h&&(a+=h.getBoundingClientRect().width),a+=this.config.noteSpacing),a+=this.drawRests(e,t+a)}},{key:"drawBarIfNeeded",value:function(e,t){var n=0,r=this.lastBar+this.getBarLength();return 0!==e&&e>=r&&(this.config.pixelsPerTimeStep>0?t-=this.config.noteSpacing:n=this.config.noteSpacing,Object(s.drawSVGPath)(this.linesG,u.barPath,t,0,1,this.scale),this.lastBar=r),n}},{key:"drawRests",value:function(e,t){var n=0,r=e.restToNextLength;if(r){this.config.pixelsPerTimeStep>0&&(t+=this.quartersToTime(e.notes[0].length)*this.hStepSize);var a,i=e.notes[0].start+e.notes[0].length,c=0,l=this.lastBar+this.getBarLength()-i;for(r>l&&(c=r-l,r=l),a=4;a>this.getBarLength()&&a>=o.MIN_RESOLUTION;a/=2);for(var h=a;(r||c)&&h>=o.MIN_RESOLUTION;){if(h<=r){n+=this.drawBarIfNeeded(i,t+n),n+=this.drawSignaturesIfNeeded(i,t+n);var f=Object(s.drawSVGPath)(this.musicG,u.REST_PATHS[h],t+n,0,this.scale,this.scale);this.config.pixelsPerTimeStep>0?t+=this.quartersToTime(h)*this.hStepSize:(n+=f.getBoundingClientRect().width,n+=this.config.noteSpacing),i+=h,r-=h}if(c&&r<=0){var d=this.getBarLength();for(c>d?(r=d,c-=d):(r=c,c=0),a=4;a>this.getBarLength()&&a>=o.MIN_RESOLUTION;a/=2);h=a}r<h&&(h/=2)}}return n}},{key:"redrawStaff",value:function(e,t,n){var r=e.querySelector('g[data-id="staff-five-lines"]');if(r)r.setAttributeNS(null,"transform","scale(".concat(n/u.PATH_SCALE,", 1)"));else{r=Object(s.createSVGGroupChild)(e,"staff-five-lines");for(var a=0,i=-4;i<=4;i+=2)Object(s.drawSVGPath)(r,u.staffLinePath,t,a+i*this.vStepSize,n/u.PATH_SCALE,1)}return r}},{key:"clearSignatureOverlay",value:function(){for(;this.overlayG.lastChild;)this.overlayG.removeChild(this.overlayG.lastChild)}},{key:"drawSignaturesIfNeeded",value:function(e,t){var n=0,r=this.changeKeySignatureIfNeeded(e),a=this.changeTimeSignatureIfNeeded(e);if(r||a){var i=o.COMPACT_SPACING*this.scale*(this.config.pixelsPerTimeStep>0?3:2);this.signaturesList.push({x:t-i,q:e}),null===this.signatureNext&&(this.signatureNext=t);var u=e>0?Object(s.createSVGGroupChild)(this.signaturesG,"signatures"):this.overlayG;n+=this.drawSignatures(u,t+n,!1,r,a)}return 0===this.config.pixelsPerTimeStep?n:0}},{key:"drawSignatures",value:function(e,t,n,r,a){var i,c=this,h=o.COMPACT_SPACING*this.scale,f=h,d=e===this.overlayG||this.config.pixelsPerTimeStep>0;if(d){(i=document.createElementNS(s.SVGNS,"rect")).setAttributeNS(null,"x","".concat(t)),i.setAttributeNS(null,"y","0"),i.setAttributeNS(null,"width","1"),i.setAttributeNS(null,"height","1"),i.setAttribute("data-id","background"),e.appendChild(i);var p=document.defaultView.getComputedStyle(this.div.parentElement);i.setAttributeNS(null,"fill",p.getPropertyValue("background-color"))}if(n){var v=Object(s.drawSVGPath)(e,u.CLEF_PATHS[this.clef].path,t+f,0,this.scale,this.scale);this.setFill(v),f+=3*h}if(r){var m=l[this.key].accidental,g=71===this.clef?0:14;l[this.key].pitches.forEach((function(n){var r=c.getPitchDetails(n).vSteps,a=Object(s.drawSVGPath)(e,u.ACCIDENTAL_PATHS[m],t+f,(g+r)*c.vStepSize,c.scale,c.scale);c.setFill(a),f+=a.getBoundingClientRect().width}))}if(a){var y=Object(s.createSVGGroupChild)(e,"time-key"),b="".concat(2.85*this.config.noteHeight,"px");Object(s.drawSVGText)(y,"".concat(this.timeSignatureNumerator),t+f,-.5,b,!0),Object(s.drawSVGText)(y,"".concat(this.timeSignatureDenominator),t+f,4*this.vStepSize-.5,b,!0),this.setFill(y),f+=y.getBoundingClientRect().width+h}var x=this.redrawStaff(e,t,f);this.setStroke(x);var k=this.div.getBoundingClientRect(),w=e.getBoundingClientRect();if(this.updateVerticalBoundaries(w.top-k.top,w.bottom-k.top),d&&(i.setAttributeNS(null,"y","".concat(-this.staffOffset)),i.setAttributeNS(null,"height","".concat(this.height)),i.setAttributeNS(null,"width","".concat(f))),e===this.overlayG){this.overlaySVG.setAttributeNS(null,"width","".concat(f+5));for(var _=0;_<5;++_){var S=Object(s.drawSVGPath)(e,u.stemPath,f+_,_*_-this.staffOffset,1/o.STEM_WIDTH,(this.height-2*_*_)/u.PATH_SCALE,(_-5)*(_-5)*2/u.PATH_SCALE);this.setFill(S)}}if(this.config.pixelsPerTimeStep>0){var C=0===this.signaturesQuarters;return C&&(this.signaturesQuarters=this.timeToQuarters(f/this.hStepSize)),(C||t>0)&&(this.signaturesBlinking=!0,Object(s.setFade)(e,this.signaturesBlinking)),0}return f}},{key:"changeKeySignatureIfNeeded",value:function(e){if(this.scoreInfo.keySignatures){for(var t=this.key,n=0;n<this.scoreInfo.keySignatures.length&&this.scoreInfo.keySignatures[n].start<=e;++n)t=this.scoreInfo.keySignatures[n].key;if(t!==this.key)return this.key=t,!0}return!1}},{key:"changeTimeSignatureIfNeeded",value:function(e){if(this.scoreInfo.timeSignatures){for(var t=this.timeSignatureNumerator,n=this.timeSignatureDenominator,r=0;r<this.scoreInfo.timeSignatures.length&&this.scoreInfo.timeSignatures[r].start<=e;++r)t=this.scoreInfo.timeSignatures[r].numerator,n=this.scoreInfo.timeSignatures[r].denominator;if(t!==this.timeSignatureNumerator||n!==this.timeSignatureDenominator)return this.timeSignatureNumerator=t,this.timeSignatureDenominator=n,!0}return!1}},{key:"changeAndDrawSignaturesIfNeeded",value:function(e){var t;if(e<this.signatureCurrent||null!==this.signatureNext&&this.signatureNext<=e){t=this.signaturesList[0].q,this.signatureNext=null;for(var n=0;n<this.signaturesList.length;++n){if(e<this.signaturesList[n].x){this.signatureNext=this.signaturesList[n].x;break}this.signatureCurrent=this.signaturesList[n].x,t=this.signaturesList[n].q}}if(void 0!==t){var r=this.key,a=this.timeSignatureNumerator,i=this.timeSignatureDenominator;this.changeKeySignatureIfNeeded(t),this.changeTimeSignatureIfNeeded(t),this.clearSignatureOverlay(),this.drawSignatures(this.overlayG,0,!0,!0,!0),this.key=r,this.timeSignatureNumerator=a,this.timeSignatureDenominator=i}this.config.pixelsPerTimeStep>0&&0===e&&(this.signatureNext=0,this.signaturesBlinking=!0,Object(s.setFade)(this.overlayG,this.signaturesBlinking))}},{key:"getBarLength",value:function(){return 4*this.timeSignatureNumerator/this.timeSignatureDenominator}},{key:"scrollIntoViewIfNeeded",value:function(e,t){if(e)if(this.scrollType===i.PAGE){var n=this.parentElement.getBoundingClientRect().width;t>this.parentElement.scrollLeft+n&&(this.parentElement.scrollLeft=t-20)}else{var r=this.parentElement.getBoundingClientRect().width;this.parentElement.scrollLeft=t-.5*r}}},{key:"updateVerticalBoundaries",value:function(e,t){var n=0;if(e<0){this.staffOffset-=e;var r="translate(0, ".concat(this.staffOffset,")");this.overlayG.setAttributeNS(null,"transform",r),this.staffG.setAttributeNS(null,"transform",r),n=this.height-e}if((n=Math.max(n,t-e))>this.height){this.height=n,this.overlaySVG.setAttributeNS(null,"height","".concat(this.height)),this.staffSVG.setAttributeNS(null,"height","".concat(this.height));for(var a=this.div.querySelectorAll('rect[data-id="background"]'),i=0;i<a.length;++i){var o=a[i];o.setAttributeNS(null,"y","".concat(-this.staffOffset)),o.setAttributeNS(null,"height","".concat(this.height))}}}},{key:"setFill",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.setAttributeNS(null,"fill",this.getColor(t))}},{key:"setStroke",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.LINE_STROKE,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.setAttributeNS(null,"stroke",this.getColor(n)),e.setAttributeNS(null,"stroke-width","".concat(t))}},{key:"getColor",value:function(e){return"rgb(".concat(e?this.config.activeNoteRGB:this.config.noteRGB,")")}},{key:"getOpacity",value:function(e){return e?e/127*.8+.2:1}},{key:"getGroup",value:function(e){var t=e.start,n=e.pitch;return this.staffSVG.querySelector('g[data-id="'.concat(t,"-").concat(n,'"]'))}},{key:"highlightElement",value:function(e,t){e.setAttribute("fill",this.getColor(t)),e.setAttribute("stroke",this.getColor(t))}},{key:"getBarBeginnings",value:function(){var e=new Set,t=0;this.scoreInfo.notes.forEach((function(e){e.start+e.length>t&&(t=e.start+e.length)}));var n=this.scoreInfo.timeSignatures?this.scoreInfo.timeSignatures.slice(0):[{start:0,numerator:4,denominator:4}];n.sort((function(e,t){return e.start-t.start}));for(var r=0,a=0;a<n.length;++a)for(var i=a===n.length-1?t:n[a].start,o=4*n[a].numerator/n[a].denominator;r<i;r+=o)e.add(r);return e}},{key:"quartersToTime",value:function(e){return e/this.scoreInfo.tempos[0].qpm*60}},{key:"timeToQuarters",value:function(e){return e*this.scoreInfo.tempos[0].qpm/60}},{key:"setDetails",value:function(){var e=this,t=new Map,n=this.getBarBeginnings(),r=new Set(n);this.scoreInfo.notes.slice().sort((function(e,t){return e.start-t.start})).forEach((function(n){var a=e.getQNote(n);r.add(a.start),r.add(a.start+a.length),t.has(a.start)?t.get(a.start).push(a):t.set(a.start,[a])})),Array.from(r).sort((function(e,t){return e-t})).forEach((function(n){var r=[];t.forEach((function(t){t.forEach((function(t){var a=e.splitQNote(t,n);a&&r.push(a)}))})),r.forEach((function(e){t.has(e.start)?t.get(e.start).push(e):t.set(e.start,[e])}))})),t=new Map(Array.from(t).sort((function(e,t){return e[0]-t[0]})));var a=this.key,i=null,o=0,s=n[Symbol.iterator](),u=s.next();t.forEach((function(t,n){var r={maxVStep:Number.MAX_SAFE_INTEGER,minVStep:Number.MIN_SAFE_INTEGER,restToNextLength:0,isBarBeginning:!1,notes:[]};e.changeKeySignatureIfNeeded(n);var a=u.value+e.getBarLength();!u.done&&n>=a&&(u=s.next(),e.barAccidentals={},r.isBarBeginning=!0),t.forEach((function(t){e.analyzePitch(t,n),r.minVStep=Math.max(t.vSteps,r.minVStep),r.maxVStep=Math.min(t.vSteps,r.maxVStep),r.notes.push(t)})),i&&(i.restToNextLength=n-o),e.musicBlockMap.set(n,r),i=r,o=n+r.notes[0].length})),this.initialRest={maxVStep:0,minVStep:0,restToNextLength:this.musicBlockMap.values().next().value.notes[0].start,isBarBeginning:!0,notes:[{start:0,length:0,vSteps:0,accidental:0,opacity:0,pitch:0,xHeadRight:0}]},this.key=a}},{key:"getQNote",value:function(e){return{start:e.start,length:e.length,vSteps:0,accidental:0,opacity:this.getOpacity(e.intensity),pitch:e.pitch,xHeadRight:0}}},{key:"splitQNote",value:function(e,t){var n=e.start+e.length-t;return t>e.start&&n>0?(e.length-=n,{start:t,length:n,vSteps:e.vSteps,accidental:e.accidental,opacity:e.opacity,pitch:e.pitch,xHeadRight:0,tiedFrom:e}):null}},{key:"analyzePitch",value:function(e,t){var n=this.getPitchDetails(e.pitch);n.vSteps in this.barAccidentals?n.accidental===this.barAccidentals[n.vSteps]?n.accidental=0:(3===this.barAccidentals[n.vSteps]?n.accidental=n.keyAccidental:0===n.accidental&&(n.accidental=3),this.barAccidentals[n.vSteps]=n.accidental):(e.tiedFrom&&(n.accidental=0),this.barAccidentals[n.vSteps]=n.accidental),e.vSteps=n.vSteps,e.accidental=n.accidental}},{key:"getPitchDetails",value:function(e){var t=e-60,n=Math.floor(t/12),r=t-12*n,a=c[this.key].steps[r],i=71===this.clef?6:-6,o=1===l[this.key].accidental?69+(r+3)%12:64+(r+8)%12;return{vSteps:i-7*n+a,accidental:c[this.key].accidental[r],keyAccidental:l[this.key].pitches.indexOf(o)>-1?l[this.key].accidental:0}}}]),e}()},function(e,t,n){"use strict";n.r(t);var r=n(3);n.d(t,"MAX_QUARTER_DIVISION",(function(){return r.MAX_QUARTER_DIVISION})),n.d(t,"ScrollType",(function(){return r.ScrollType})),n.d(t,"StaffSVGRender",(function(){return r.StaffSVGRender}))}])},4008:function(e,t,n){"use strict";var r=n(5844),a=n(8287),i=n(9778).lW;n.g.__TYPEDARRAY_POOL||(n.g.__TYPEDARRAY_POOL={UINT8:a([32,0]),UINT16:a([32,0]),UINT32:a([32,0]),BIGUINT64:a([32,0]),INT8:a([32,0]),INT16:a([32,0]),INT32:a([32,0]),BIGINT64:a([32,0]),FLOAT:a([32,0]),DOUBLE:a([32,0]),DATA:a([32,0]),UINT8C:a([32,0]),BUFFER:a([32,0])});var o="undefined"!==typeof Uint8ClampedArray,s="undefined"!==typeof BigUint64Array,u="undefined"!==typeof BigInt64Array,c=n.g.__TYPEDARRAY_POOL;c.UINT8C||(c.UINT8C=a([32,0])),c.BIGUINT64||(c.BIGUINT64=a([32,0])),c.BIGINT64||(c.BIGINT64=a([32,0])),c.BUFFER||(c.BUFFER=a([32,0]));var l=c.DATA,h=c.BUFFER;function f(e){if(e){var t=e.length||e.byteLength,n=r.log2(t);l[n].push(e)}}function d(e){e=r.nextPow2(e);var t=r.log2(e),n=l[t];return n.length>0?n.pop():new ArrayBuffer(e)}function p(e){return new Uint8Array(d(e),0,e)}function v(e){return new Uint16Array(d(2*e),0,e)}function m(e){return new Uint32Array(d(4*e),0,e)}function g(e){return new Int8Array(d(e),0,e)}function y(e){return new Int16Array(d(2*e),0,e)}function b(e){return new Int32Array(d(4*e),0,e)}function x(e){return new Float32Array(d(4*e),0,e)}function k(e){return new Float64Array(d(8*e),0,e)}function w(e){return o?new Uint8ClampedArray(d(e),0,e):p(e)}function _(e){return s?new BigUint64Array(d(8*e),0,e):null}function S(e){return u?new BigInt64Array(d(8*e),0,e):null}function C(e){return new DataView(d(e),0,e)}function T(e){e=r.nextPow2(e);var t=r.log2(e),n=h[t];return n.length>0?n.pop():new i(e)}t.free=function(e){if(i.isBuffer(e))h[r.log2(e.length)].push(e);else{if("[object ArrayBuffer]"!==Object.prototype.toString.call(e)&&(e=e.buffer),!e)return;var t=e.length||e.byteLength,n=0|r.log2(t);l[n].push(e)}},t.freeUint8=t.freeUint16=t.freeUint32=t.freeBigUint64=t.freeInt8=t.freeInt16=t.freeInt32=t.freeBigInt64=t.freeFloat32=t.freeFloat=t.freeFloat64=t.freeDouble=t.freeUint8Clamped=t.freeDataView=function(e){f(e.buffer)},t.freeArrayBuffer=f,t.freeBuffer=function(e){h[r.log2(e.length)].push(e)},t.malloc=function(e,t){if(void 0===t||"arraybuffer"===t)return d(e);switch(t){case"uint8":return p(e);case"uint16":return v(e);case"uint32":return m(e);case"int8":return g(e);case"int16":return y(e);case"int32":return b(e);case"float":case"float32":return x(e);case"double":case"float64":return k(e);case"uint8_clamped":return w(e);case"bigint64":return S(e);case"biguint64":return _(e);case"buffer":return T(e);case"data":case"dataview":return C(e);default:return null}return null},t.mallocArrayBuffer=d,t.mallocUint8=p,t.mallocUint16=v,t.mallocUint32=m,t.mallocInt8=g,t.mallocInt16=y,t.mallocInt32=b,t.mallocFloat32=t.mallocFloat=x,t.mallocFloat64=t.mallocDouble=k,t.mallocUint8Clamped=w,t.mallocBigUint64=_,t.mallocBigInt64=S,t.mallocDataView=C,t.mallocBuffer=T,t.clearCache=function(){for(var e=0;e<32;++e)c.UINT8[e].length=0,c.UINT16[e].length=0,c.UINT32[e].length=0,c.INT8[e].length=0,c.INT16[e].length=0,c.INT32[e].length=0,c.FLOAT[e].length=0,c.DOUBLE[e].length=0,c.BIGUINT64[e].length=0,c.BIGINT64[e].length=0,c.UINT8C[e].length=0,l[e].length=0,h[e].length=0}},8871:function(e){"use strict";e.exports=function(e,t,n){return 0===e.length?e:t?(n||e.sort(t),function(e,t){for(var n=1,r=e.length,a=e[0],i=e[0],o=1;o<r;++o)if(i=a,t(a=e[o],i)){if(o===n){n++;continue}e[n++]=a}return e.length=n,e}(e,t)):(n||e.sort(),function(e){for(var t=1,n=e.length,r=e[0],a=e[0],i=1;i<n;++i,a=r)if(a=r,(r=e[i])!==a){if(i===t){t++;continue}e[t++]=r}return e.length=t,e}(e))}},911:function(){},8489:function(){},5410:function(){},8628:function(){},5755:function(){},7004:function(){},6759:function(){},549:function(){},5042:function(){},6690:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},9728:function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},7061:function(e,t,n){var r=n(8698).default;function a(){"use strict";e.exports=a=function(){return t},e.exports.__esModule=!0,e.exports.default=e.exports;var t={},n=Object.prototype,i=n.hasOwnProperty,o="function"==typeof Symbol?Symbol:{},s=o.iterator||"@@iterator",u=o.asyncIterator||"@@asyncIterator",c=o.toStringTag||"@@toStringTag";function l(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{l({},"")}catch(A){l=function(e,t,n){return e[t]=n}}function h(e,t,n,r){var a=t&&t.prototype instanceof p?t:p,i=Object.create(a.prototype),o=new T(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return I()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=_(o,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=f(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),i}function f(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(A){return{type:"throw",arg:A}}}t.wrap=h;var d={};function p(){}function v(){}function m(){}var g={};l(g,s,(function(){return this}));var y=Object.getPrototypeOf,b=y&&y(y(E([])));b&&b!==n&&i.call(b,s)&&(g=b);var x=m.prototype=p.prototype=Object.create(g);function k(e){["next","throw","return"].forEach((function(t){l(e,t,(function(e){return this._invoke(t,e)}))}))}function w(e,t){function n(a,o,s,u){var c=f(e[a],e,o);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==r(h)&&i.call(h,"__await")?t.resolve(h.__await).then((function(e){n("next",e,s,u)}),(function(e){n("throw",e,s,u)})):t.resolve(h).then((function(e){l.value=e,s(l)}),(function(e){return n("throw",e,s,u)}))}u(c.arg)}var a;this._invoke=function(e,r){function i(){return new t((function(t,a){n(e,r,t,a)}))}return a=a?a.then(i,i):i()}}function _(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,_(e,t),"throw"===t.method))return d;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return d}var r=f(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,d;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,d):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,d)}function S(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function C(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function T(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(S,this),this.reset(!0)}function E(e){if(e){var t=e[s];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,r=function t(){for(;++n<e.length;)if(i.call(e,n))return t.value=e[n],t.done=!1,t;return t.value=void 0,t.done=!0,t};return r.next=r}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=m,l(x,"constructor",m),l(m,"constructor",v),v.displayName=l(m,c,"GeneratorFunction"),t.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===v||"GeneratorFunction"===(t.displayName||t.name))},t.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,m):(e.__proto__=m,l(e,c,"GeneratorFunction")),e.prototype=Object.create(x),e},t.awrap=function(e){return{__await:e}},k(w.prototype),l(w.prototype,u,(function(){return this})),t.AsyncIterator=w,t.async=function(e,n,r,a,i){void 0===i&&(i=Promise);var o=new w(h(e,n,r,a),i);return t.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(x),l(x,c,"Generator"),l(x,s,(function(){return this})),l(x,"toString",(function(){return"[object Generator]"})),t.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},t.values=E,T.prototype={constructor:T,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!e)for(var t in this)"t"===t.charAt(0)&&i.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function n(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r],o=a.completion;if("root"===a.tryLoc)return n("end");if(a.tryLoc<=this.prev){var s=i.call(a,"catchLoc"),u=i.call(a,"finallyLoc");if(s&&u){if(this.prev<a.catchLoc)return n(a.catchLoc,!0);if(this.prev<a.finallyLoc)return n(a.finallyLoc)}else if(s){if(this.prev<a.catchLoc)return n(a.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<a.finallyLoc)return n(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&i.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var a=r;break}}a&&("break"===e||"continue"===e)&&a.tryLoc<=t&&t<=a.finallyLoc&&(a=null);var o=a?a.completion:{};return o.type=e,o.arg=t,a?(this.method="next",this.next=a.finallyLoc,d):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),d},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),C(n),d}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;C(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:E(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},t}e.exports=a,e.exports.__esModule=!0,e.exports.default=e.exports},8698:function(e){function t(n){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},6801:function(e){e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r},e.exports.__esModule=!0,e.exports.default=e.exports},409:function(e){e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},8860:function(e){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},9450:function(e){function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}e.exports=function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},1940:function(e){e.exports=function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(u){s=!0,a=u}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}},e.exports.__esModule=!0,e.exports.default=e.exports},8517:function(e){e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},5463:function(e,t,n){var r=n(409),a=n(1940),i=n(6874),o=n(8517);e.exports=function(e,t){return r(e)||a(e,t)||i(e,t)||o()},e.exports.__esModule=!0,e.exports.default=e.exports},6874:function(e,t,n){var r=n(6801);e.exports=function(e,t){if(e){if("string"===typeof e)return r(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports}},__webpack_module_cache__={};function __webpack_require__(e){var t=__webpack_module_cache__[e];if(void 0!==t)return t.exports;var n=__webpack_module_cache__[e]={id:e,loaded:!1,exports:{}};return __webpack_modules__[e].call(n.exports,n,n.exports,__webpack_require__),n.loaded=!0,n.exports}__webpack_require__.amdD=function(){throw new Error("define cannot be used indirect")},__webpack_require__.amdO={},__webpack_require__.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return __webpack_require__.d(t,{a:t}),t},function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};__webpack_require__.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"===typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"===typeof n.then)return n}var a=Object.create(null);__webpack_require__.r(a);var i={};e=e||[null,t({}),t([]),t(t)];for(var o=2&r&&n;"object"==typeof o&&!~e.indexOf(o);o=t(o))Object.getOwnPropertyNames(o).forEach((function(e){i[e]=function(){return n[e]}}));return i.default=function(){return n},__webpack_require__.d(a,i),a}}(),__webpack_require__.d=function(e,t){for(var n in t)__webpack_require__.o(t,n)&&!__webpack_require__.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},__webpack_require__.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),__webpack_require__.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},__webpack_require__.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},__webpack_require__.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e},__webpack_require__.p="/off-line/";var __webpack_exports__={};!function(){"use strict";var e={};__webpack_require__.r(e),__webpack_require__.d(e,{browserFiles:function(){return Vv},browserHTTPRequest:function(){return $v},concatenateArrayBuffers:function(){return Wp},copyModel:function(){return Tv},decodeWeights:function(){return Lp},encodeWeights:function(){return Pp},fromMemory:function(){return nm},getLoadHandlers:function(){return Qp},getModelArtifactsInfoForJSON:function(){return jp},getSaveHandlers:function(){return Yp},http:function(){return Jv},isHTTPScheme:function(){return Qv},listModels:function(){return wv},loadWeights:function(){return qv},moveModel:function(){return Iv},registerLoadRouter:function(){return Kp},registerSaveRouter:function(){return Xp},removeModel:function(){return Sv},weightsLoaderFactory:function(){return Xv},withSaveHandler:function(){return rm}});var t={};__webpack_require__.r(t),__webpack_require__.d(t,{assert:function(){return U8},assertContextRunning:function(){return W8},assertRange:function(){return V8},log:function(){return q8},setLogger:function(){return j8},warn:function(){return H8}});var n={};__webpack_require__.r(n);var r={};__webpack_require__.r(r),__webpack_require__.d(r,{AMOscillator:function(){return nee},AMSynth:function(){return Pee},Abs:function(){return yee},Add:function(){return cee},AmplitudeEnvelope:function(){return Nee},Analyser:function(){return pne},AudioToGain:function(){return eee},AutoFilter:function(){return Nte},AutoPanner:function(){return Dte},AutoWah:function(){return Ote},BaseContext:function(){return D7},BiquadFilter:function(){return Oee},BitCrusher:function(){return Fte},Buffer:function(){return Kne},BufferSource:function(){return Qne},Buffers:function(){return Yne},Channel:function(){return wne},Chebyshev:function(){return Bte},Chorus:function(){return jte},Clock:function(){return C9},Compressor:function(){return Ine},Context:function(){return P7},Convolver:function(){return Pne},CrossFade:function(){return Ite},DCMeter:function(){return yne},Delay:function(){return T9},Destination:function(){return Bne},Distortion:function(){return qte},Draw:function(){return jne},DuoSynth:function(){return Bee},EQ3:function(){return Dne},Emitter:function(){return R7},Envelope:function(){return Eee},FFT:function(){return gne},FMOscillator:function(){return ree},FMSynth:function(){return Uee},FatOscillator:function(){return iee},FeedbackCombFilter:function(){return Qee},FeedbackDelay:function(){return Xte},Filter:function(){return Lee},Follower:function(){return Pte},Freeverb:function(){return Jte},Frequency:function(){return s9},FrequencyClass:function(){return a9},FrequencyEnvelope:function(){return Fee},FrequencyShifter:function(){return Yte},Gain:function(){return g9},GainToAudio:function(){return bee},Gate:function(){return Ane},GrainPlayer:function(){return gee},GreaterThan:function(){return _ee},GreaterThanZero:function(){return wee},IntervalTimeline:function(){return P9},JCReverb:function(){return nne},LFO:function(){return fee},Limiter:function(){return Mne},Listener:function(){return Wne},Loop:function(){return rte},LowpassCombFilter:function(){return Jee},Master:function(){return Une},MembraneSynth:function(){return Gee},Merge:function(){return Vte},MetalSynth:function(){return Wee},Meter:function(){return mne},MidSideCompressor:function(){return Nne},MidSideMerge:function(){return cne},MidSideSplit:function(){return une},Midi:function(){return M9},MidiClass:function(){return A9},Mono:function(){return _ne},MonoSynth:function(){return zee},MultibandCompressor:function(){return Rne},MultibandSplit:function(){return Sne},Multiply:function(){return tee},Negate:function(){return xee},Noise:function(){return j9},NoiseSynth:function(){return jee},Offline:function(){return E9},OfflineContext:function(){return U7},OmniOscillator:function(){return uee},OnePoleFilter:function(){return Zee},Oscillator:function(){return Z9},PWMOscillator:function(){return oee},PanVol:function(){return kne},Panner:function(){return Rte},Panner3D:function(){return Tne},Param:function(){return f9},Part:function(){return ate},Pattern:function(){return Tte},Phaser:function(){return one},PingPongDelay:function(){return ane},PitchShift:function(){return ine},Player:function(){return vee},Players:function(){return mee},PluckSynth:function(){return $ee},PolySynth:function(){return ete},Pow:function(){return See},PulseOscillator:function(){return aee},Recorder:function(){return Ene},Reverb:function(){return sne},Sampler:function(){return tte},Scale:function(){return lee},ScaleExp:function(){return Cee},Sequence:function(){return Ete},Signal:function(){return x9},Solo:function(){return xne},Split:function(){return Ute},StateTimeline:function(){return h9},StereoWidener:function(){return hne},Subtract:function(){return kee},SyncedSignal:function(){return Tee},Synth:function(){return Ree},Ticks:function(){return R9},TicksClass:function(){return N9},Time:function(){return r9},TimeClass:function(){return n9},Timeline:function(){return T7},ToneAudioBuffer:function(){return B7},ToneAudioBuffers:function(){return I9},ToneAudioNode:function(){return d9},ToneBufferSource:function(){return G9},ToneEvent:function(){return nte},ToneOscillatorNode:function(){return Q9},Transport:function(){return Fne},TransportTime:function(){return c9},TransportTimeClass:function(){return u9},Tremolo:function(){return fne},Unit:function(){return n},UserMedia:function(){return K9},Vibrato:function(){return dne},Volume:function(){return L9},WaveShaper:function(){return $9},Waveform:function(){return bne},Zero:function(){return hee},connect:function(){return v9},connectSeries:function(){return p9},connectSignal:function(){return k9},context:function(){return Hne},dbToGain:function(){return K7},debug:function(){return t},defaultArg:function(){return g7},disconnect:function(){return m9},ftom:function(){return J7},gainToDb:function(){return Y7},getContext:function(){return G7},getDestination:function(){return Vne},getDraw:function(){return qne},getListener:function(){return Gne},getTransport:function(){return zne},immediate:function(){return Lne},intervalToFrequencyRatio:function(){return Q7},isArray:function(){return $8},isBoolean:function(){return J8},isDefined:function(){return K8},isFunction:function(){return Y8},isNote:function(){return t7},isNumber:function(){return Q8},isObject:function(){return Z8},isString:function(){return e7},isUndef:function(){return X8},loaded:function(){return Xne},mtof:function(){return e9},now:function(){return One},optionsFromArguments:function(){return m7},setContext:function(){return j7},start:function(){return q7},supported:function(){return B8},version:function(){return Q2}});var a={};__webpack_require__.r(a),__webpack_require__.d(a,{ACESFilmicToneMapping:function(){return Hye},AddEquation:function(){return vye},AddOperation:function(){return Vye},AdditiveAnimationBlendMode:function(){return yxe},AdditiveBlending:function(){return hye},AlphaFormat:function(){return Sbe},AlwaysDepth:function(){return Rye},AlwaysStencilFunc:function(){return Hxe},AmbientLight:function(){return MMe},AmbientLightProbe:function(){return HMe},AnimationClip:function(){return eMe},AnimationLoader:function(){return cMe},AnimationMixer:function(){return _Ne},AnimationObjectGroup:function(){return xNe},AnimationUtils:function(){return VAe},ArcCurve:function(){return cIe},ArrayCamera:function(){return VTe},ArrowHelper:function(){return fRe},Audio:function(){return aNe},AudioAnalyser:function(){return lNe},AudioContext:function(){return GMe},AudioListener:function(){return rNe},AudioLoader:function(){return jMe},AxesHelper:function(){return dRe},BackSide:function(){return iye},BasicDepthPacking:function(){return Sxe},BasicShadowMap:function(){return eye},Bone:function(){return IEe},BooleanKeyframeTrack:function(){return XAe},Box2:function(){return DNe},Box3:function(){return Jke},Box3Helper:function(){return cRe},BoxBufferGeometry:function(){return J_e},BoxGeometry:function(){return J_e},BoxHelper:function(){return uRe},BufferAttribute:function(){return p_e},BufferGeometry:function(){return R_e},BufferGeometryLoader:function(){return FMe},ByteType:function(){return pbe},Cache:function(){return rMe},Camera:function(){return rSe},CameraHelper:function(){return rRe},CanvasTexture:function(){return oIe},CapsuleBufferGeometry:function(){return MIe},CapsuleGeometry:function(){return MIe},CatmullRomCurve3:function(){return vIe},CineonToneMapping:function(){return qye},CircleBufferGeometry:function(){return NIe},CircleGeometry:function(){return NIe},ClampToEdgeWrapping:function(){return tbe},Clock:function(){return ZMe},Color:function(){return Oke},ColorKeyframeTrack:function(){return KAe},ColorManagement:function(){return Eke},CompressedTexture:function(){return iIe},CompressedTextureLoader:function(){return lMe},ConeBufferGeometry:function(){return DIe},ConeGeometry:function(){return DIe},CubeCamera:function(){return oSe},CubeReflectionMapping:function(){return Yye},CubeRefractionMapping:function(){return Qye},CubeTexture:function(){return sSe},CubeTextureLoader:function(){return fMe},CubeUVReflectionMapping:function(){return $ye},CubicBezierCurve:function(){return bIe},CubicBezierCurve3:function(){return xIe},CubicInterpolant:function(){return GAe},CullFaceBack:function(){return Zge},CullFaceFront:function(){return Jge},CullFaceFrontBack:function(){return $ge},CullFaceNone:function(){return Qge},Curve:function(){return sIe},CurvePath:function(){return EIe},CustomBlending:function(){return pye},CustomToneMapping:function(){return Xye},CylinderBufferGeometry:function(){return RIe},CylinderGeometry:function(){return RIe},Cylindrical:function(){return NNe},Data3DTexture:function(){return qke},DataArrayTexture:function(){return Gke},DataTexture:function(){return AEe},DataTexture2DArray:function(){return NRe},DataTexture3D:function(){return RRe},DataTextureLoader:function(){return dMe},DataUtils:function(){return SRe},DecrementStencilOp:function(){return Oxe},DecrementWrapStencilOp:function(){return Fxe},DefaultLoadingManager:function(){return iMe},DepthFormat:function(){return Abe},DepthStencilFormat:function(){return Mbe},DepthTexture:function(){return qTe},DirectionalLight:function(){return AMe},DirectionalLightHelper:function(){return eRe},DiscreteInterpolant:function(){return qAe},DodecahedronBufferGeometry:function(){return OIe},DodecahedronGeometry:function(){return OIe},DoubleSide:function(){return oye},DstAlphaFactor:function(){return Tye},DstColorFactor:function(){return Iye},DynamicCopyUsage:function(){return eke},DynamicDrawUsage:function(){return Kxe},DynamicReadUsage:function(){return Zxe},EdgesGeometry:function(){return UIe},EllipseCurve:function(){return uIe},EqualDepth:function(){return Oye},EqualStencilFunc:function(){return Vxe},EquirectangularReflectionMapping:function(){return Zye},EquirectangularRefractionMapping:function(){return Jye},Euler:function(){return Lwe},EventDispatcher:function(){return ike},ExtrudeBufferGeometry:function(){return gAe},ExtrudeGeometry:function(){return gAe},FileLoader:function(){return uMe},FlatShading:function(){return sye},Float16BufferAttribute:function(){return w_e},Float32BufferAttribute:function(){return __e},Float64BufferAttribute:function(){return S_e},FloatType:function(){return bbe},Fog:function(){return $Te},FogExp2:function(){return JTe},Font:function(){return IRe},FontLoader:function(){return ERe},FramebufferTexture:function(){return aIe},FrontSide:function(){return aye},Frustum:function(){return vSe},GLBufferAttribute:function(){return TNe},GLSL1:function(){return nke},GLSL3:function(){return rke},GreaterDepth:function(){return Fye},GreaterEqualDepth:function(){return Lye},GreaterEqualStencilFunc:function(){return qxe},GreaterStencilFunc:function(){return Gxe},GridHelper:function(){return YNe},Group:function(){return WTe},HalfFloatType:function(){return xbe},HemisphereLight:function(){return mMe},HemisphereLightHelper:function(){return KNe},HemisphereLightProbe:function(){return qMe},IcosahedronBufferGeometry:function(){return bAe},IcosahedronGeometry:function(){return bAe},ImageBitmapLoader:function(){return WMe},ImageLoader:function(){return hMe},ImageUtils:function(){return Lke},ImmediateRenderObject:function(){return ARe},IncrementStencilOp:function(){return Pxe},IncrementWrapStencilOp:function(){return Lxe},InstancedBufferAttribute:function(){return DEe},InstancedBufferGeometry:function(){return LMe},InstancedInterleavedBuffer:function(){return CNe},InstancedMesh:function(){return zEe},Int16BufferAttribute:function(){return y_e},Int32BufferAttribute:function(){return x_e},Int8BufferAttribute:function(){return v_e},IntType:function(){return gbe},InterleavedBuffer:function(){return tEe},InterleavedBufferAttribute:function(){return rEe},Interpolant:function(){return WAe},InterpolateDiscrete:function(){return hxe},InterpolateLinear:function(){return fxe},InterpolateSmooth:function(){return dxe},InvertStencilOp:function(){return zxe},KeepStencilOp:function(){return Rxe},KeyframeTrack:function(){return HAe},LOD:function(){return kEe},LatheBufferGeometry:function(){return AIe},LatheGeometry:function(){return AIe},Layers:function(){return Fwe},LessDepth:function(){return Dye},LessEqualDepth:function(){return Pye},LessEqualStencilFunc:function(){return Wxe},LessStencilFunc:function(){return Uxe},Light:function(){return vMe},LightProbe:function(){return DMe},Line:function(){return qEe},Line3:function(){return LNe},LineBasicMaterial:function(){return BEe},LineCurve:function(){return kIe},LineCurve3:function(){return wIe},LineDashedMaterial:function(){return UAe},LineLoop:function(){return YEe},LineSegments:function(){return KEe},LinearEncoding:function(){return wxe},LinearFilter:function(){return ube},LinearInterpolant:function(){return jAe},LinearMipMapLinearFilter:function(){return fbe},LinearMipMapNearestFilter:function(){return lbe},LinearMipmapLinearFilter:function(){return hbe},LinearMipmapNearestFilter:function(){return cbe},LinearSRGBColorSpace:function(){return Mxe},LinearToneMapping:function(){return Gye},Loader:function(){return oMe},LoaderUtils:function(){return OMe},LoadingManager:function(){return aMe},LoopOnce:function(){return uxe},LoopPingPong:function(){return lxe},LoopRepeat:function(){return cxe},LuminanceAlphaFormat:function(){return Ibe},LuminanceFormat:function(){return Ebe},MOUSE:function(){return Kge},Material:function(){return l_e},MaterialLoader:function(){return PMe},MathUtils:function(){return gke},Matrix3:function(){return bke},Matrix4:function(){return Twe},MaxEquation:function(){return bye},Mesh:function(){return Q_e},MeshBasicMaterial:function(){return h_e},MeshDepthMaterial:function(){return OTe},MeshDistanceMaterial:function(){return LTe},MeshLambertMaterial:function(){return zAe},MeshMatcapMaterial:function(){return BAe},MeshNormalMaterial:function(){return FAe},MeshPhongMaterial:function(){return OAe},MeshPhysicalMaterial:function(){return PAe},MeshStandardMaterial:function(){return DAe},MeshToonMaterial:function(){return LAe},MinEquation:function(){return yye},MirroredRepeatWrapping:function(){return nbe},MixOperation:function(){return Uye},MultiplyBlending:function(){return dye},MultiplyOperation:function(){return Bye},NearestFilter:function(){return rbe},NearestMipMapLinearFilter:function(){return sbe},NearestMipMapNearestFilter:function(){return ibe},NearestMipmapLinearFilter:function(){return obe},NearestMipmapNearestFilter:function(){return abe},NeverDepth:function(){return Nye},NeverStencilFunc:function(){return Bxe},NoBlending:function(){return cye},NoColorSpace:function(){return Ixe},NoToneMapping:function(){return Wye},NormalAnimationBlendMode:function(){return gxe},NormalBlending:function(){return lye},NotEqualDepth:function(){return zye},NotEqualStencilFunc:function(){return jxe},NumberKeyframeTrack:function(){return YAe},Object3D:function(){return Zwe},ObjectLoader:function(){return zMe},ObjectSpaceNormalMap:function(){return Exe},OctahedronBufferGeometry:function(){return xAe},OctahedronGeometry:function(){return xAe},OneFactor:function(){return kye},OneMinusDstAlphaFactor:function(){return Eye},OneMinusDstColorFactor:function(){return Aye},OneMinusSrcAlphaFactor:function(){return Cye},OneMinusSrcColorFactor:function(){return _ye},OrthographicCamera:function(){return ISe},PCFShadowMap:function(){return tye},PCFSoftShadowMap:function(){return nye},PMREMGenerator:function(){return FSe},ParametricGeometry:function(){return CRe},Path:function(){return IIe},PerspectiveCamera:function(){return aSe},Plane:function(){return fSe},PlaneBufferGeometry:function(){return ySe},PlaneGeometry:function(){return ySe},PlaneHelper:function(){return lRe},PointLight:function(){return EMe},PointLightHelper:function(){return jNe},Points:function(){return tIe},PointsMaterial:function(){return QEe},PolarGridHelper:function(){return QNe},PolyhedronBufferGeometry:function(){return PIe},PolyhedronGeometry:function(){return PIe},PositionalAudio:function(){return cNe},PropertyBinding:function(){return bNe},PropertyMixer:function(){return hNe},QuadraticBezierCurve:function(){return _Ie},QuadraticBezierCurve3:function(){return SIe},Quaternion:function(){return Kke},QuaternionKeyframeTrack:function(){return ZAe},QuaternionLinearInterpolant:function(){return QAe},REVISION:function(){return Xge},RGBADepthPacking:function(){return Cxe},RGBAFormat:function(){return Tbe},RGBAIntegerFormat:function(){return Obe},RGBA_ASTC_10x10_Format:function(){return axe},RGBA_ASTC_10x5_Format:function(){return txe},RGBA_ASTC_10x6_Format:function(){return nxe},RGBA_ASTC_10x8_Format:function(){return rxe},RGBA_ASTC_12x10_Format:function(){return ixe},RGBA_ASTC_12x12_Format:function(){return oxe},RGBA_ASTC_4x4_Format:function(){return Xbe},RGBA_ASTC_5x4_Format:function(){return Kbe},RGBA_ASTC_5x5_Format:function(){return Ybe},RGBA_ASTC_6x5_Format:function(){return Qbe},RGBA_ASTC_6x6_Format:function(){return Zbe},RGBA_ASTC_8x5_Format:function(){return Jbe},RGBA_ASTC_8x6_Format:function(){return $be},RGBA_ASTC_8x8_Format:function(){return exe},RGBA_BPTC_Format:function(){return sxe},RGBA_ETC2_EAC_Format:function(){return Hbe},RGBA_PVRTC_2BPPV1_Format:function(){return Gbe},RGBA_PVRTC_4BPPV1_Format:function(){return Wbe},RGBA_S3TC_DXT1_Format:function(){return Fbe},RGBA_S3TC_DXT3_Format:function(){return zbe},RGBA_S3TC_DXT5_Format:function(){return Bbe},RGBFormat:function(){return Cbe},RGB_ETC1_Format:function(){return jbe},RGB_ETC2_Format:function(){return qbe},RGB_PVRTC_2BPPV1_Format:function(){return Vbe},RGB_PVRTC_4BPPV1_Format:function(){return Ube},RGB_S3TC_DXT1_Format:function(){return Lbe},RGFormat:function(){return Dbe},RGIntegerFormat:function(){return Pbe},RawShaderMaterial:function(){return RAe},Ray:function(){return Cwe},Raycaster:function(){return ENe},RectAreaLight:function(){return NMe},RedFormat:function(){return Nbe},RedIntegerFormat:function(){return Rbe},ReinhardToneMapping:function(){return jye},RepeatWrapping:function(){return ebe},ReplaceStencilOp:function(){return Dxe},ReverseSubtractEquation:function(){return gye},RingBufferGeometry:function(){return kAe},RingGeometry:function(){return kAe},SRGBColorSpace:function(){return Axe},Scene:function(){return eEe},ShaderChunk:function(){return bSe},ShaderLib:function(){return kSe},ShaderMaterial:function(){return nSe},ShadowMaterial:function(){return NAe},Shape:function(){return VIe},ShapeBufferGeometry:function(){return wAe},ShapeGeometry:function(){return wAe},ShapePath:function(){return pRe},ShapeUtils:function(){return pAe},ShortType:function(){return vbe},Skeleton:function(){return REe},SkeletonHelper:function(){return WNe},SkinnedMesh:function(){return EEe},SmoothShading:function(){return uye},Source:function(){return Fke},Sphere:function(){return gwe},SphereBufferGeometry:function(){return _Ae},SphereGeometry:function(){return _Ae},Spherical:function(){return MNe},SphericalHarmonics3:function(){return RMe},SplineCurve:function(){return CIe},SpotLight:function(){return wMe},SpotLightHelper:function(){return zNe},Sprite:function(){return gEe},SpriteMaterial:function(){return aEe},SrcAlphaFactor:function(){return Sye},SrcAlphaSaturateFactor:function(){return Mye},SrcColorFactor:function(){return wye},StaticCopyUsage:function(){return $xe},StaticDrawUsage:function(){return Xxe},StaticReadUsage:function(){return Qxe},StereoCamera:function(){return QMe},StreamCopyUsage:function(){return tke},StreamDrawUsage:function(){return Yxe},StreamReadUsage:function(){return Jxe},StringKeyframeTrack:function(){return JAe},SubtractEquation:function(){return mye},SubtractiveBlending:function(){return fye},TOUCH:function(){return Yge},TangentSpaceNormalMap:function(){return Txe},TetrahedronBufferGeometry:function(){return SAe},TetrahedronGeometry:function(){return SAe},TextGeometry:function(){return TRe},Texture:function(){return Uke},TextureLoader:function(){return pMe},TorusBufferGeometry:function(){return CAe},TorusGeometry:function(){return CAe},TorusKnotBufferGeometry:function(){return TAe},TorusKnotGeometry:function(){return TAe},Triangle:function(){return u_e},TriangleFanDrawMode:function(){return kxe},TriangleStripDrawMode:function(){return xxe},TrianglesDrawMode:function(){return bxe},TubeBufferGeometry:function(){return EAe},TubeGeometry:function(){return EAe},UVMapping:function(){return Kye},Uint16BufferAttribute:function(){return b_e},Uint32BufferAttribute:function(){return k_e},Uint8BufferAttribute:function(){return m_e},Uint8ClampedBufferAttribute:function(){return g_e},Uniform:function(){return SNe},UniformsLib:function(){return xSe},UniformsUtils:function(){return tSe},UnsignedByteType:function(){return dbe},UnsignedInt248Type:function(){return _be},UnsignedIntType:function(){return ybe},UnsignedShort4444Type:function(){return kbe},UnsignedShort5551Type:function(){return wbe},UnsignedShortType:function(){return mbe},VSMShadowMap:function(){return rye},Vector2:function(){return yke},Vector3:function(){return Yke},Vector4:function(){return Vke},VectorKeyframeTrack:function(){return $Ae},VideoTexture:function(){return rIe},WebGL1Renderer:function(){return QTe},WebGL3DRenderTarget:function(){return Hke},WebGLArrayRenderTarget:function(){return jke},WebGLCubeRenderTarget:function(){return uSe},WebGLMultipleRenderTargets:function(){return Xke},WebGLMultisampleRenderTarget:function(){return MRe},WebGLRenderTarget:function(){return Wke},WebGLRenderer:function(){return YTe},WebGLUtils:function(){return UTe},WireframeGeometry:function(){return IAe},WrapAroundEnding:function(){return mxe},ZeroCurvatureEnding:function(){return pxe},ZeroFactor:function(){return xye},ZeroSlopeEnding:function(){return vxe},ZeroStencilOp:function(){return Nxe},_SRGBAFormat:function(){return ake},sRGBEncoding:function(){return _xe}});var i=__webpack_require__(2791),o=__webpack_require__.t(i,2),s=__webpack_require__(1250);function u(e){if(Array.isArray(e))return e}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function l(e,t){if(e){if("string"===typeof e)return c(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function h(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){return u(e)||function(e,t){var n=null==e?null:"undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,i=[],o=!0,s=!1;try{for(n=n.call(e);!(o=(r=n.next()).done)&&(i.push(r.value),!t||i.length!==t);o=!0);}catch(u){s=!0,a=u}finally{try{o||null==n.return||n.return()}finally{if(s)throw a}}return i}}(e,t)||l(e,t)||h()}var d=__webpack_require__(7441),p=__webpack_require__(9613),v=__webpack_require__.n(p);var m=function(e){function t(e,r,u,c,f){for(var d,p,v,m,x,w=0,_=0,S=0,C=0,T=0,R=0,P=v=d=0,L=0,F=0,z=0,B=0,U=u.length,V=U-1,W="",G="",j="",q="";L<U;){if(p=u.charCodeAt(L),L===V&&0!==_+C+S+w&&(0!==_&&(p=47===_?10:47),C=S=w=0,U++,V++),0===_+C+S+w){if(L===V&&(0<F&&(W=W.replace(h,"")),0<W.trim().length)){switch(p){case 32:case 9:case 59:case 13:case 10:break;default:W+=u.charAt(L)}p=59}switch(p){case 123:for(d=(W=W.trim()).charCodeAt(0),v=1,B=++L;L<U;){switch(p=u.charCodeAt(L)){case 123:v++;break;case 125:v--;break;case 47:switch(p=u.charCodeAt(L+1)){case 42:case 47:e:{for(P=L+1;P<V;++P)switch(u.charCodeAt(P)){case 47:if(42===p&&42===u.charCodeAt(P-1)&&L+2!==P){L=P+1;break e}break;case 10:if(47===p){L=P+1;break e}}L=P}}break;case 91:p++;case 40:p++;case 34:case 39:for(;L++<V&&u.charCodeAt(L)!==p;);}if(0===v)break;L++}if(v=u.substring(B,L),0===d&&(d=(W=W.replace(l,"").trim()).charCodeAt(0)),64===d){switch(0<F&&(W=W.replace(h,"")),p=W.charCodeAt(1)){case 100:case 109:case 115:case 45:F=r;break;default:F=N}if(B=(v=t(r,F,v,p,f+1)).length,0<D&&(x=s(3,v,F=n(N,W,z),r,I,E,B,p,f,c),W=F.join(""),void 0!==x&&0===(B=(v=x.trim()).length)&&(p=0,v="")),0<B)switch(p){case 115:W=W.replace(k,o);case 100:case 109:case 45:v=W+"{"+v+"}";break;case 107:v=(W=W.replace(g,"$1 $2"))+"{"+v+"}",v=1===M||2===M&&i("@"+v,3)?"@-webkit-"+v+"@"+v:"@"+v;break;default:v=W+v,112===c&&(G+=v,v="")}else v=""}else v=t(r,n(r,W,z),v,c,f+1);j+=v,v=z=F=P=d=0,W="",p=u.charCodeAt(++L);break;case 125:case 59:if(1<(B=(W=(0<F?W.replace(h,""):W).trim()).length))switch(0===P&&(d=W.charCodeAt(0),45===d||96<d&&123>d)&&(B=(W=W.replace(" ",":")).length),0<D&&void 0!==(x=s(1,W,r,e,I,E,G.length,c,f,c))&&0===(B=(W=x.trim()).length)&&(W="\0\0"),d=W.charCodeAt(0),p=W.charCodeAt(1),d){case 0:break;case 64:if(105===p||99===p){q+=W+u.charAt(L);break}default:58!==W.charCodeAt(B-1)&&(G+=a(W,d,p,W.charCodeAt(2)))}z=F=P=d=0,W="",p=u.charCodeAt(++L)}}switch(p){case 13:case 10:47===_?_=0:0===1+d&&107!==c&&0<W.length&&(F=1,W+="\0"),0<D*O&&s(0,W,r,e,I,E,G.length,c,f,c),E=1,I++;break;case 59:case 125:if(0===_+C+S+w){E++;break}default:switch(E++,m=u.charAt(L),p){case 9:case 32:if(0===C+w+_)switch(T){case 44:case 58:case 9:case 32:m="";break;default:32!==p&&(m=" ")}break;case 0:m="\\0";break;case 12:m="\\f";break;case 11:m="\\v";break;case 38:0===C+_+w&&(F=z=1,m="\f"+m);break;case 108:if(0===C+_+w+A&&0<P)switch(L-P){case 2:112===T&&58===u.charCodeAt(L-3)&&(A=T);case 8:111===R&&(A=R)}break;case 58:0===C+_+w&&(P=L);break;case 44:0===_+S+C+w&&(F=1,m+="\r");break;case 34:case 39:0===_&&(C=C===p?0:0===C?p:C);break;case 91:0===C+_+S&&w++;break;case 93:0===C+_+S&&w--;break;case 41:0===C+_+w&&S--;break;case 40:if(0===C+_+w){if(0===d)if(2*T+3*R===533);else d=1;S++}break;case 64:0===_+S+C+w+P+v&&(v=1);break;case 42:case 47:if(!(0<C+w+S))switch(_){case 0:switch(2*p+3*u.charCodeAt(L+1)){case 235:_=47;break;case 220:B=L,_=42}break;case 42:47===p&&42===T&&B+2!==L&&(33===u.charCodeAt(B+2)&&(G+=u.substring(B,L+1)),m="",_=0)}}0===_&&(W+=m)}R=T,T=p,L++}if(0<(B=G.length)){if(F=r,0<D&&(void 0!==(x=s(2,G,F,e,I,E,B,c,f,c))&&0===(G=x).length))return q+G+j;if(G=F.join(",")+"{"+G+"}",0!==M*A){switch(2!==M||i(G,2)||(A=0),A){case 111:G=G.replace(b,":-moz-$1")+G;break;case 112:G=G.replace(y,"::-webkit-input-$1")+G.replace(y,"::-moz-$1")+G.replace(y,":-ms-input-$1")+G}A=0}}return q+G+j}function n(e,t,n){var a=t.trim().split(v);t=a;var i=a.length,o=e.length;switch(o){case 0:case 1:var s=0;for(e=0===o?"":e[0]+" ";s<i;++s)t[s]=r(e,t[s],n).trim();break;default:var u=s=0;for(t=[];s<i;++s)for(var c=0;c<o;++c)t[u++]=r(e[c]+" ",a[s],n).trim()}return t}function r(e,t,n){var r=t.charCodeAt(0);switch(33>r&&(r=(t=t.trim()).charCodeAt(0)),r){case 38:return t.replace(m,"$1"+e.trim());case 58:return e.trim()+t.replace(m,"$1"+e.trim());default:if(0<1*n&&0<t.indexOf("\f"))return t.replace(m,(58===e.charCodeAt(0)?"":"$1")+e.trim())}return e+t}function a(e,t,n,r){var o=e+";",s=2*t+3*n+4*r;if(944===s){e=o.indexOf(":",9)+1;var u=o.substring(e,o.length-1).trim();return u=o.substring(0,e).trim()+u+";",1===M||2===M&&i(u,1)?"-webkit-"+u+u:u}if(0===M||2===M&&!i(o,1))return o;switch(s){case 1015:return 97===o.charCodeAt(10)?"-webkit-"+o+o:o;case 951:return 116===o.charCodeAt(3)?"-webkit-"+o+o:o;case 963:return 110===o.charCodeAt(5)?"-webkit-"+o+o:o;case 1009:if(100!==o.charCodeAt(4))break;case 969:case 942:return"-webkit-"+o+o;case 978:return"-webkit-"+o+"-moz-"+o+o;case 1019:case 983:return"-webkit-"+o+"-moz-"+o+"-ms-"+o+o;case 883:if(45===o.charCodeAt(8))return"-webkit-"+o+o;if(0<o.indexOf("image-set(",11))return o.replace(T,"$1-webkit-$2")+o;break;case 932:if(45===o.charCodeAt(4))switch(o.charCodeAt(5)){case 103:return"-webkit-box-"+o.replace("-grow","")+"-webkit-"+o+"-ms-"+o.replace("grow","positive")+o;case 115:return"-webkit-"+o+"-ms-"+o.replace("shrink","negative")+o;case 98:return"-webkit-"+o+"-ms-"+o.replace("basis","preferred-size")+o}return"-webkit-"+o+"-ms-"+o+o;case 964:return"-webkit-"+o+"-ms-flex-"+o+o;case 1023:if(99!==o.charCodeAt(8))break;return"-webkit-box-pack"+(u=o.substring(o.indexOf(":",15)).replace("flex-","").replace("space-between","justify"))+"-webkit-"+o+"-ms-flex-pack"+u+o;case 1005:return d.test(o)?o.replace(f,":-webkit-")+o.replace(f,":-moz-")+o:o;case 1e3:switch(t=(u=o.substring(13).trim()).indexOf("-")+1,u.charCodeAt(0)+u.charCodeAt(t)){case 226:u=o.replace(x,"tb");break;case 232:u=o.replace(x,"tb-rl");break;case 220:u=o.replace(x,"lr");break;default:return o}return"-webkit-"+o+"-ms-"+u+o;case 1017:if(-1===o.indexOf("sticky",9))break;case 975:switch(t=(o=e).length-10,s=(u=(33===o.charCodeAt(t)?o.substring(0,t):o).substring(e.indexOf(":",7)+1).trim()).charCodeAt(0)+(0|u.charCodeAt(7))){case 203:if(111>u.charCodeAt(8))break;case 115:o=o.replace(u,"-webkit-"+u)+";"+o;break;case 207:case 102:o=o.replace(u,"-webkit-"+(102<s?"inline-":"")+"box")+";"+o.replace(u,"-webkit-"+u)+";"+o.replace(u,"-ms-"+u+"box")+";"+o}return o+";";case 938:if(45===o.charCodeAt(5))switch(o.charCodeAt(6)){case 105:return u=o.replace("-items",""),"-webkit-"+o+"-webkit-box-"+u+"-ms-flex-"+u+o;case 115:return"-webkit-"+o+"-ms-flex-item-"+o.replace(_,"")+o;default:return"-webkit-"+o+"-ms-flex-line-pack"+o.replace("align-content","").replace(_,"")+o}break;case 973:case 989:if(45!==o.charCodeAt(3)||122===o.charCodeAt(4))break;case 931:case 953:if(!0===C.test(e))return 115===(u=e.substring(e.indexOf(":")+1)).charCodeAt(0)?a(e.replace("stretch","fill-available"),t,n,r).replace(":fill-available",":stretch"):o.replace(u,"-webkit-"+u)+o.replace(u,"-moz-"+u.replace("fill-",""))+o;break;case 962:if(o="-webkit-"+o+(102===o.charCodeAt(5)?"-ms-"+o:"")+o,211===n+r&&105===o.charCodeAt(13)&&0<o.indexOf("transform",10))return o.substring(0,o.indexOf(";",27)+1).replace(p,"$1-webkit-$2")+o}return o}function i(e,t){var n=e.indexOf(1===t?":":"{"),r=e.substring(0,3!==t?n:10);return n=e.substring(n+1,e.length-1),P(2!==t?r:r.replace(S,"$1"),n,t)}function o(e,t){var n=a(t,t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2));return n!==t+";"?n.replace(w," or ($1)").substring(4):"("+t+")"}function s(e,t,n,r,a,i,o,s,u,l){for(var h,f=0,d=t;f<D;++f)switch(h=R[f].call(c,e,d,n,r,a,i,o,s,u,l)){case void 0:case!1:case!0:case null:break;default:d=h}if(d!==t)return d}function u(e){return void 0!==(e=e.prefix)&&(P=null,e?"function"!==typeof e?M=1:(M=2,P=e):M=0),u}function c(e,n){var r=e;if(33>r.charCodeAt(0)&&(r=r.trim()),r=[r],0<D){var a=s(-1,n,r,r,I,E,0,0,0,0);void 0!==a&&"string"===typeof a&&(n=a)}var i=t(N,r,n,0,0);return 0<D&&(void 0!==(a=s(-2,i,r,r,I,E,i.length,0,0,0))&&(i=a)),"",A=0,E=I=1,i}var l=/^\0+/g,h=/[\0\r\f]/g,f=/: */g,d=/zoo|gra/,p=/([,: ])(transform)/g,v=/,\r+?/g,m=/([\t\r\n ])*\f?&/g,g=/@(k\w+)\s*(\S*)\s*/,y=/::(place)/g,b=/:(read-only)/g,x=/[svh]\w+-[tblr]{2}/,k=/\(\s*(.*)\s*\)/g,w=/([\s\S]*?);/g,_=/-self|flex-/g,S=/[^]*?(:[rp][el]a[\w-]+)[^]*/,C=/stretch|:\s*\w+\-(?:conte|avail)/,T=/([^-])(image-set\()/,E=1,I=1,A=0,M=1,N=[],R=[],D=0,P=null,O=0;return c.use=function e(t){switch(t){case void 0:case null:D=R.length=0;break;default:if("function"===typeof t)R[D++]=t;else if("object"===typeof t)for(var n=0,r=t.length;n<r;++n)e(t[n]);else O=0|!!t}return e},c.set=u,void 0!==e&&u(e),c},g={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1};var y=function(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}},b=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,x=y((function(e){return b.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91})),k=__webpack_require__(2110),w=__webpack_require__.n(k);function _(){return(_=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}var S=function(e,t){for(var n=[e[0]],r=0,a=t.length;r<a;r+=1)n.push(t[r],e[r+1]);return n},C=function(e){return null!==e&&"object"==typeof e&&"[object Object]"===(e.toString?e.toString():Object.prototype.toString.call(e))&&!(0,d.typeOf)(e)},T=Object.freeze([]),E=Object.freeze({});function I(e){return"function"==typeof e}function A(e){return e.displayName||e.name||"Component"}function M(e){return e&&"string"==typeof e.styledComponentId}var N="undefined"!=typeof process&&({NODE_ENV:"production",PUBLIC_URL:"/off-line",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_ATTR||{NODE_ENV:"production",PUBLIC_URL:"/off-line",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_ATTR)||"data-styled",R="undefined"!=typeof window&&"HTMLElement"in window,D=Boolean("boolean"==typeof SC_DISABLE_SPEEDY?SC_DISABLE_SPEEDY:"undefined"!=typeof process&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"/off-line",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY&&""!=={NODE_ENV:"production",PUBLIC_URL:"/off-line",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY?"false"!=={NODE_ENV:"production",PUBLIC_URL:"/off-line",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY&&{NODE_ENV:"production",PUBLIC_URL:"/off-line",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_SC_DISABLE_SPEEDY:"undefined"!=typeof process&&void 0!=={NODE_ENV:"production",PUBLIC_URL:"/off-line",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY&&""!=={NODE_ENV:"production",PUBLIC_URL:"/off-line",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY&&("false"!=={NODE_ENV:"production",PUBLIC_URL:"/off-line",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY&&{NODE_ENV:"production",PUBLIC_URL:"/off-line",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.SC_DISABLE_SPEEDY));function P(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];throw new Error("An error occurred. See https://git.io/JUIaE#"+e+" for more information."+(n.length>0?" Args: "+n.join(", "):""))}var O=function(){function e(e){this.groupSizes=new Uint32Array(512),this.length=512,this.tag=e}var t=e.prototype;return t.indexOfGroup=function(e){for(var t=0,n=0;n<e;n++)t+=this.groupSizes[n];return t},t.insertRules=function(e,t){if(e>=this.groupSizes.length){for(var n=this.groupSizes,r=n.length,a=r;e>=a;)(a<<=1)<0&&P(16,""+e);this.groupSizes=new Uint32Array(a),this.groupSizes.set(n),this.length=a;for(var i=r;i<a;i++)this.groupSizes[i]=0}for(var o=this.indexOfGroup(e+1),s=0,u=t.length;s<u;s++)this.tag.insertRule(o,t[s])&&(this.groupSizes[e]++,o++)},t.clearGroup=function(e){if(e<this.length){var t=this.groupSizes[e],n=this.indexOfGroup(e),r=n+t;this.groupSizes[e]=0;for(var a=n;a<r;a++)this.tag.deleteRule(n)}},t.getGroup=function(e){var t="";if(e>=this.length||0===this.groupSizes[e])return t;for(var n=this.groupSizes[e],r=this.indexOfGroup(e),a=r+n,i=r;i<a;i++)t+=this.tag.getRule(i)+"/*!sc*/\n";return t},e}(),L=new Map,F=new Map,z=1,B=function(e){if(L.has(e))return L.get(e);for(;F.has(z);)z++;var t=z++;return L.set(e,t),F.set(t,e),t},U=function(e){return F.get(e)},V=function(e,t){t>=z&&(z=t+1),L.set(e,t),F.set(t,e)},W="style["+N+'][data-styled-version="5.3.5"]',G=new RegExp("^"+N+'\\.g(\\d+)\\[id="([\\w\\d-]+)"\\].*?"([^"]*)'),j=function(e,t,n){for(var r,a=n.split(","),i=0,o=a.length;i<o;i++)(r=a[i])&&e.registerName(t,r)},q=function(e,t){for(var n=(t.textContent||"").split("/*!sc*/\n"),r=[],a=0,i=n.length;a<i;a++){var o=n[a].trim();if(o){var s=o.match(G);if(s){var u=0|parseInt(s[1],10),c=s[2];0!==u&&(V(c,u),j(e,c,s[3]),e.getTag().insertRules(u,r)),r.length=0}else r.push(o)}}},H=function(){return"undefined"!=typeof window&&void 0!==window.__webpack_nonce__?window.__webpack_nonce__:null},X=function(e){var t=document.head,n=e||t,r=document.createElement("style"),a=function(e){for(var t=e.childNodes,n=t.length;n>=0;n--){var r=t[n];if(r&&1===r.nodeType&&r.hasAttribute(N))return r}}(n),i=void 0!==a?a.nextSibling:null;r.setAttribute(N,"active"),r.setAttribute("data-styled-version","5.3.5");var o=H();return o&&r.setAttribute("nonce",o),n.insertBefore(r,i),r},K=function(){function e(e){var t=this.element=X(e);t.appendChild(document.createTextNode("")),this.sheet=function(e){if(e.sheet)return e.sheet;for(var t=document.styleSheets,n=0,r=t.length;n<r;n++){var a=t[n];if(a.ownerNode===e)return a}P(17)}(t),this.length=0}var t=e.prototype;return t.insertRule=function(e,t){try{return this.sheet.insertRule(t,e),this.length++,!0}catch(e){return!1}},t.deleteRule=function(e){this.sheet.deleteRule(e),this.length--},t.getRule=function(e){var t=this.sheet.cssRules[e];return void 0!==t&&"string"==typeof t.cssText?t.cssText:""},e}(),Y=function(){function e(e){var t=this.element=X(e);this.nodes=t.childNodes,this.length=0}var t=e.prototype;return t.insertRule=function(e,t){if(e<=this.length&&e>=0){var n=document.createTextNode(t),r=this.nodes[e];return this.element.insertBefore(n,r||null),this.length++,!0}return!1},t.deleteRule=function(e){this.element.removeChild(this.nodes[e]),this.length--},t.getRule=function(e){return e<this.length?this.nodes[e].textContent:""},e}(),Q=function(){function e(e){this.rules=[],this.length=0}var t=e.prototype;return t.insertRule=function(e,t){return e<=this.length&&(this.rules.splice(e,0,t),this.length++,!0)},t.deleteRule=function(e){this.rules.splice(e,1),this.length--},t.getRule=function(e){return e<this.length?this.rules[e]:""},e}(),Z=R,J={isServer:!R,useCSSOMInjection:!D},$=function(){function e(e,t,n){void 0===e&&(e=E),void 0===t&&(t={}),this.options=_({},J,{},e),this.gs=t,this.names=new Map(n),this.server=!!e.isServer,!this.server&&R&&Z&&(Z=!1,function(e){for(var t=document.querySelectorAll(W),n=0,r=t.length;n<r;n++){var a=t[n];a&&"active"!==a.getAttribute(N)&&(q(e,a),a.parentNode&&a.parentNode.removeChild(a))}}(this))}e.registerId=function(e){return B(e)};var t=e.prototype;return t.reconstructWithOptions=function(t,n){return void 0===n&&(n=!0),new e(_({},this.options,{},t),this.gs,n&&this.names||void 0)},t.allocateGSInstance=function(e){return this.gs[e]=(this.gs[e]||0)+1},t.getTag=function(){return this.tag||(this.tag=(n=(t=this.options).isServer,r=t.useCSSOMInjection,a=t.target,e=n?new Q(a):r?new K(a):new Y(a),new O(e)));var e,t,n,r,a},t.hasNameForId=function(e,t){return this.names.has(e)&&this.names.get(e).has(t)},t.registerName=function(e,t){if(B(e),this.names.has(e))this.names.get(e).add(t);else{var n=new Set;n.add(t),this.names.set(e,n)}},t.insertRules=function(e,t,n){this.registerName(e,t),this.getTag().insertRules(B(e),n)},t.clearNames=function(e){this.names.has(e)&&this.names.get(e).clear()},t.clearRules=function(e){this.getTag().clearGroup(B(e)),this.clearNames(e)},t.clearTag=function(){this.tag=void 0},t.toString=function(){return function(e){for(var t=e.getTag(),n=t.length,r="",a=0;a<n;a++){var i=U(a);if(void 0!==i){var o=e.names.get(i),s=t.getGroup(a);if(o&&s&&o.size){var u=N+".g"+a+'[id="'+i+'"]',c="";void 0!==o&&o.forEach((function(e){e.length>0&&(c+=e+",")})),r+=""+s+u+'{content:"'+c+'"}/*!sc*/\n'}}}return r}(this)},e}(),ee=/(a)(d)/gi,te=function(e){return String.fromCharCode(e+(e>25?39:97))};function ne(e){var t,n="";for(t=Math.abs(e);t>52;t=t/52|0)n=te(t%52)+n;return(te(t%52)+n).replace(ee,"$1-$2")}var re=function(e,t){for(var n=t.length;n;)e=33*e^t.charCodeAt(--n);return e},ae=function(e){return re(5381,e)};function ie(e){for(var t=0;t<e.length;t+=1){var n=e[t];if(I(n)&&!M(n))return!1}return!0}var oe=ae("5.3.5"),se=function(){function e(e,t,n){this.rules=e,this.staticRulesId="",this.isStatic=(void 0===n||n.isStatic)&&ie(e),this.componentId=t,this.baseHash=re(oe,t),this.baseStyle=n,$.registerId(t)}return e.prototype.generateAndInjectStyles=function(e,t,n){var r=this.componentId,a=[];if(this.baseStyle&&a.push(this.baseStyle.generateAndInjectStyles(e,t,n)),this.isStatic&&!n.hash)if(this.staticRulesId&&t.hasNameForId(r,this.staticRulesId))a.push(this.staticRulesId);else{var i=Ce(this.rules,e,t,n).join(""),o=ne(re(this.baseHash,i)>>>0);if(!t.hasNameForId(r,o)){var s=n(i,"."+o,void 0,r);t.insertRules(r,o,s)}a.push(o),this.staticRulesId=o}else{for(var u=this.rules.length,c=re(this.baseHash,n.hash),l="",h=0;h<u;h++){var f=this.rules[h];if("string"==typeof f)l+=f;else if(f){var d=Ce(f,e,t,n),p=Array.isArray(d)?d.join(""):d;c=re(c,p+h),l+=p}}if(l){var v=ne(c>>>0);if(!t.hasNameForId(r,v)){var m=n(l,"."+v,void 0,r);t.insertRules(r,v,m)}a.push(v)}}return a.join(" ")},e}(),ue=/^\s*\/\/.*$/gm,ce=[":","[",".","#"];function le(e){var t,n,r,a,i=void 0===e?E:e,o=i.options,s=void 0===o?E:o,u=i.plugins,c=void 0===u?T:u,l=new m(s),h=[],f=function(e){function t(t){if(t)try{e(t+"}")}catch(e){}}return function(n,r,a,i,o,s,u,c,l,h){switch(n){case 1:if(0===l&&64===r.charCodeAt(0))return e(r+";"),"";break;case 2:if(0===c)return r+"/*|*/";break;case 3:switch(c){case 102:case 112:return e(a[0]+r),"";default:return r+(0===h?"/*|*/":"")}case-2:r.split("/*|*/}").forEach(t)}}}((function(e){h.push(e)})),d=function(e,r,i){return 0===r&&-1!==ce.indexOf(i[n.length])||i.match(a)?e:"."+t};function p(e,i,o,s){void 0===s&&(s="&");var u=e.replace(ue,""),c=i&&o?o+" "+i+" { "+u+" }":u;return t=s,n=i,r=new RegExp("\\"+n+"\\b","g"),a=new RegExp("(\\"+n+"\\b){2,}"),l(o||!i?"":i,c)}return l.use([].concat(c,[function(e,t,a){2===e&&a.length&&a[0].lastIndexOf(n)>0&&(a[0]=a[0].replace(r,d))},f,function(e){if(-2===e){var t=h;return h=[],t}}])),p.hash=c.length?c.reduce((function(e,t){return t.name||P(15),re(e,t.name)}),5381).toString():"",p}var he=i.createContext(),fe=(he.Consumer,i.createContext()),de=(fe.Consumer,new $),pe=le();function ve(){return(0,i.useContext)(he)||de}function me(){return(0,i.useContext)(fe)||pe}function ge(e){var t=(0,i.useState)(e.stylisPlugins),n=t[0],r=t[1],a=ve(),o=(0,i.useMemo)((function(){var t=a;return e.sheet?t=e.sheet:e.target&&(t=t.reconstructWithOptions({target:e.target},!1)),e.disableCSSOMInjection&&(t=t.reconstructWithOptions({useCSSOMInjection:!1})),t}),[e.disableCSSOMInjection,e.sheet,e.target]),s=(0,i.useMemo)((function(){return le({options:{prefix:!e.disableVendorPrefixes},plugins:n})}),[e.disableVendorPrefixes,n]);return(0,i.useEffect)((function(){v()(n,e.stylisPlugins)||r(e.stylisPlugins)}),[e.stylisPlugins]),i.createElement(he.Provider,{value:o},i.createElement(fe.Provider,{value:s},e.children))}var ye=function(){function e(e,t){var n=this;this.inject=function(e,t){void 0===t&&(t=pe);var r=n.name+t.hash;e.hasNameForId(n.id,r)||e.insertRules(n.id,r,t(n.rules,r,"@keyframes"))},this.toString=function(){return P(12,String(n.name))},this.name=e,this.id="sc-keyframes-"+e,this.rules=t}return e.prototype.getName=function(e){return void 0===e&&(e=pe),this.name+e.hash},e}(),be=/([A-Z])/,xe=/([A-Z])/g,ke=/^ms-/,we=function(e){return"-"+e.toLowerCase()};function _e(e){return be.test(e)?e.replace(xe,we).replace(ke,"-ms-"):e}var Se=function(e){return null==e||!1===e||""===e};function Ce(e,t,n,r){if(Array.isArray(e)){for(var a,i=[],o=0,s=e.length;o<s;o+=1)""!==(a=Ce(e[o],t,n,r))&&(Array.isArray(a)?i.push.apply(i,a):i.push(a));return i}return Se(e)?"":M(e)?"."+e.styledComponentId:I(e)?"function"!=typeof(u=e)||u.prototype&&u.prototype.isReactComponent||!t?e:Ce(e(t),t,n,r):e instanceof ye?n?(e.inject(n,r),e.getName(r)):e:C(e)?function e(t,n){var r,a,i=[];for(var o in t)t.hasOwnProperty(o)&&!Se(t[o])&&(Array.isArray(t[o])&&t[o].isCss||I(t[o])?i.push(_e(o)+":",t[o],";"):C(t[o])?i.push.apply(i,e(t[o],o)):i.push(_e(o)+": "+(r=o,(null==(a=t[o])||"boolean"==typeof a||""===a?"":"number"!=typeof a||0===a||r in g?String(a).trim():a+"px")+";")));return n?[n+" {"].concat(i,["}"]):i}(e):e.toString();var u}var Te=function(e){return Array.isArray(e)&&(e.isCss=!0),e};function Ee(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];return I(e)||C(e)?Te(Ce(S(T,[e].concat(n)))):0===n.length&&1===e.length&&"string"==typeof e[0]?e:Te(Ce(S(e,n)))}new Set;var Ie=function(e,t,n){return void 0===n&&(n=E),e.theme!==n.theme&&e.theme||t||n.theme},Ae=/[!"#$%&'()*+,./:;<=>?@[\\\]^`{|}~-]+/g,Me=/(^-|-$)/g;function Ne(e){return e.replace(Ae,"-").replace(Me,"")}var Re=function(e){return ne(ae(e)>>>0)};function De(e){return"string"==typeof e&&!0}var Pe=function(e){return"function"==typeof e||"object"==typeof e&&null!==e&&!Array.isArray(e)},Oe=function(e){return"__proto__"!==e&&"constructor"!==e&&"prototype"!==e};function Le(e,t,n){var r=e[n];Pe(t)&&Pe(r)?Fe(r,t):e[n]=t}function Fe(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];for(var a=0,i=n;a<i.length;a++){var o=i[a];if(Pe(o))for(var s in o)Oe(s)&&Le(e,o[s],s)}return e}var ze=i.createContext();ze.Consumer;function Be(e){var t=(0,i.useContext)(ze),n=(0,i.useMemo)((function(){return function(e,t){return e?I(e)?e(t):Array.isArray(e)||"object"!=typeof e?P(8):t?_({},t,{},e):e:P(14)}(e.theme,t)}),[e.theme,t]);return e.children?i.createElement(ze.Provider,{value:n},e.children):null}var Ue={};function Ve(e,t,n){var r=M(e),a=!De(e),o=t.attrs,s=void 0===o?T:o,u=t.componentId,c=void 0===u?function(e,t){var n="string"!=typeof e?"sc":Ne(e);Ue[n]=(Ue[n]||0)+1;var r=n+"-"+Re("5.3.5"+n+Ue[n]);return t?t+"-"+r:r}(t.displayName,t.parentComponentId):u,l=t.displayName,h=void 0===l?function(e){return De(e)?"styled."+e:"Styled("+A(e)+")"}(e):l,f=t.displayName&&t.componentId?Ne(t.displayName)+"-"+t.componentId:t.componentId||c,d=r&&e.attrs?Array.prototype.concat(e.attrs,s).filter(Boolean):s,p=t.shouldForwardProp;r&&e.shouldForwardProp&&(p=t.shouldForwardProp?function(n,r,a){return e.shouldForwardProp(n,r,a)&&t.shouldForwardProp(n,r,a)}:e.shouldForwardProp);var v,m=new se(n,f,r?e.componentStyle:void 0),g=m.isStatic&&0===s.length,y=function(e,t){return function(e,t,n,r){var a=e.attrs,o=e.componentStyle,s=e.defaultProps,u=e.foldedComponentIds,c=e.shouldForwardProp,l=e.styledComponentId,h=e.target,f=function(e,t,n){void 0===e&&(e=E);var r=_({},t,{theme:e}),a={};return n.forEach((function(e){var t,n,i,o=e;for(t in I(o)&&(o=o(r)),o)r[t]=a[t]="className"===t?(n=a[t],i=o[t],n&&i?n+" "+i:n||i):o[t]})),[r,a]}(Ie(t,(0,i.useContext)(ze),s)||E,t,a),d=f[0],p=f[1],v=function(e,t,n,r){var a=ve(),i=me();return t?e.generateAndInjectStyles(E,a,i):e.generateAndInjectStyles(n,a,i)}(o,r,d),m=n,g=p.$as||t.$as||p.as||t.as||h,y=De(g),b=p!==t?_({},t,{},p):t,k={};for(var w in b)"$"!==w[0]&&"as"!==w&&("forwardedAs"===w?k.as=b[w]:(c?c(w,x,g):!y||x(w))&&(k[w]=b[w]));return t.style&&p.style!==t.style&&(k.style=_({},t.style,{},p.style)),k.className=Array.prototype.concat(u,l,v!==l?v:null,t.className,p.className).filter(Boolean).join(" "),k.ref=m,(0,i.createElement)(g,k)}(v,e,t,g)};return y.displayName=h,(v=i.forwardRef(y)).attrs=d,v.componentStyle=m,v.displayName=h,v.shouldForwardProp=p,v.foldedComponentIds=r?Array.prototype.concat(e.foldedComponentIds,e.styledComponentId):T,v.styledComponentId=f,v.target=r?e.target:e,v.withComponent=function(e){var r=t.componentId,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(t,["componentId"]),i=r&&r+"-"+(De(e)?e:Ne(A(e)));return Ve(e,_({},a,{attrs:d,componentId:i}),n)},Object.defineProperty(v,"defaultProps",{get:function(){return this._foldedDefaultProps},set:function(t){this._foldedDefaultProps=r?Fe({},e.defaultProps,t):t}}),v.toString=function(){return"."+v.styledComponentId},a&&w()(v,e,{attrs:!0,componentStyle:!0,displayName:!0,foldedComponentIds:!0,shouldForwardProp:!0,styledComponentId:!0,target:!0,withComponent:!0}),v}var We=function(e){return function e(t,n,r){if(void 0===r&&(r=E),!(0,d.isValidElementType)(n))return P(1,String(n));var a=function(){return t(n,r,Ee.apply(void 0,arguments))};return a.withConfig=function(a){return e(t,n,_({},r,{},a))},a.attrs=function(a){return e(t,n,_({},r,{attrs:Array.prototype.concat(r.attrs,a).filter(Boolean)}))},a}(Ve,e)};["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","marker","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","textPath","tspan"].forEach((function(e){We[e]=We(e)}));!function(){function e(e,t){this.rules=e,this.componentId=t,this.isStatic=ie(e),$.registerId(this.componentId+1)}var t=e.prototype;t.createStyles=function(e,t,n,r){var a=r(Ce(this.rules,t,n,r).join(""),""),i=this.componentId+e;n.insertRules(i,i,a)},t.removeStyles=function(e,t){t.clearRules(this.componentId+e)},t.renderStyles=function(e,t,n,r){e>2&&$.registerId(this.componentId+e),this.removeStyles(e,n),this.createStyles(e,t,n,r)}}();!function(){function e(){var e=this;this._emitSheetCSS=function(){var t=e.instance.toString();if(!t)return"";var n=H();return"<style "+[n&&'nonce="'+n+'"',N+'="true"','data-styled-version="5.3.5"'].filter(Boolean).join(" ")+">"+t+"</style>"},this.getStyleTags=function(){return e.sealed?P(2):e._emitSheetCSS()},this.getStyleElement=function(){var t;if(e.sealed)return P(2);var n=((t={})[N]="",t["data-styled-version"]="5.3.5",t.dangerouslySetInnerHTML={__html:e.instance.toString()},t),r=H();return r&&(n.nonce=r),[i.createElement("style",_({},n,{key:"sc-0-0"}))]},this.seal=function(){e.sealed=!0},this.instance=new $({isServer:!0}),this.sealed=!1}var t=e.prototype;t.collectStyles=function(e){return this.sealed?P(2):i.createElement(ge,{sheet:this.instance},e)},t.interleaveWithNodeStream=function(e){return P(3)}}();var Ge,je=We;function qe(){var e=f((0,i.useState)(window.innerWidth),2),t=e[0],n=e[1],r=f((0,i.useState)(window.innerHeight),2),a=r[0],o=r[1];return(0,i.useEffect)((function(){var e=function(){n(window.innerWidth),o(window.innerHeight)};return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[]),[t,a]}function He(){return He=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},He.apply(this,arguments)}!function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"}(Ge||(Ge={}));var Xe=function(e){return e};var Ke="beforeunload",Ye="popstate";function Qe(e){e.preventDefault(),e.returnValue=""}function Ze(){var e=[];return{get length(){return e.length},push:function(t){return e.push(t),function(){e=e.filter((function(e){return e!==t}))}},call:function(t){e.forEach((function(e){return e&&e(t)}))}}}function Je(){return Math.random().toString(36).substr(2,8)}function $e(e){var t=e.pathname,n=void 0===t?"/":t,r=e.search,a=void 0===r?"":r,i=e.hash,o=void 0===i?"":i;return a&&"?"!==a&&(n+="?"===a.charAt(0)?a:"?"+a),o&&"#"!==o&&(n+="#"===o.charAt(0)?o:"#"+o),n}function et(e){var t={};if(e){var n=e.indexOf("#");n>=0&&(t.hash=e.substr(n),e=e.substr(0,n));var r=e.indexOf("?");r>=0&&(t.search=e.substr(r),e=e.substr(0,r)),e&&(t.pathname=e)}return t}var tt=(0,i.createContext)(null);var nt=(0,i.createContext)(null);var rt=(0,i.createContext)({outlet:null,matches:[]});function at(e,t){if(!e)throw new Error(t)}function it(e,t,n){void 0===n&&(n="/");var r=ft(("string"===typeof t?et(t):t).pathname||"/",n);if(null==r)return null;var a=ot(e);!function(e){e.sort((function(e,t){return e.score!==t.score?t.score-e.score:function(e,t){var n=e.length===t.length&&e.slice(0,-1).every((function(e,n){return e===t[n]}));return n?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map((function(e){return e.childrenIndex})),t.routesMeta.map((function(e){return e.childrenIndex})))}))}(a);for(var i=null,o=0;null==i&&o<a.length;++o)i=lt(a[o],r);return i}function ot(e,t,n,r){return void 0===t&&(t=[]),void 0===n&&(n=[]),void 0===r&&(r=""),e.forEach((function(e,a){var i={relativePath:e.path||"",caseSensitive:!0===e.caseSensitive,childrenIndex:a,route:e};i.relativePath.startsWith("/")&&(i.relativePath.startsWith(r)||at(!1),i.relativePath=i.relativePath.slice(r.length));var o=dt([r,i.relativePath]),s=n.concat(i);e.children&&e.children.length>0&&(!0===e.index&&at(!1),ot(e.children,t,s,o)),(null!=e.path||e.index)&&t.push({path:o,score:ct(o,e.index),routesMeta:s})})),t}var st=/^:\w+$/,ut=function(e){return"*"===e};function ct(e,t){var n=e.split("/"),r=n.length;return n.some(ut)&&(r+=-2),t&&(r+=2),n.filter((function(e){return!ut(e)})).reduce((function(e,t){return e+(st.test(t)?3:""===t?1:10)}),r)}function lt(e,t){for(var n=e.routesMeta,r={},a="/",i=[],o=0;o<n.length;++o){var s=n[o],u=o===n.length-1,c="/"===a?t:t.slice(a.length)||"/",l=ht({path:s.relativePath,caseSensitive:s.caseSensitive,end:u},c);if(!l)return null;Object.assign(r,l.params);var h=s.route;i.push({params:r,pathname:dt([a,l.pathname]),pathnameBase:pt(dt([a,l.pathnameBase])),route:h}),"/"!==l.pathnameBase&&(a=dt([a,l.pathnameBase]))}return i}function ht(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});var n=function(e,t,n){void 0===t&&(t=!1);void 0===n&&(n=!0);var r=[],a="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^$?{}|()[\]]/g,"\\$&").replace(/:(\w+)/g,(function(e,t){return r.push(t),"([^\\/]+)"}));e.endsWith("*")?(r.push("*"),a+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):a+=n?"\\/*$":"(?:(?=[.~-]|%[0-9A-F]{2})|\\b|\\/|$)";return[new RegExp(a,t?void 0:"i"),r]}(e.path,e.caseSensitive,e.end),r=f(n,2),a=r[0],i=r[1],o=t.match(a);if(!o)return null;var s=o[0],u=s.replace(/(.)\/+$/,"$1"),c=o.slice(1),l=i.reduce((function(e,t,n){if("*"===t){var r=c[n]||"";u=s.slice(0,s.length-r.length).replace(/(.)\/+$/,"$1")}return e[t]=function(e,t){try{return decodeURIComponent(e)}catch(n){return e}}(c[n]||""),e}),{});return{params:l,pathname:s,pathnameBase:u,pattern:e}}function ft(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;var n=e.charAt(t.length);return n&&"/"!==n?null:e.slice(t.length)||"/"}var dt=function(e){return e.join("/").replace(/\/\/+/g,"/")},pt=function(e){return e.replace(/\/+$/,"").replace(/^\/*/,"/")};function vt(){return null!=(0,i.useContext)(nt)}function mt(){return vt()||at(!1),(0,i.useContext)(nt).location}function gt(e,t){return void 0===t&&(t=[]),null==e?null:e.reduceRight((function(n,r,a){return(0,i.createElement)(rt.Provider,{children:void 0!==r.route.element?r.route.element:n,value:{outlet:n,matches:t.concat(e.slice(0,a+1))}})}),null)}function yt(e){at(!1)}function bt(e){var t=e.basename,n=void 0===t?"/":t,r=e.children,a=void 0===r?null:r,o=e.location,s=e.navigationType,u=void 0===s?Ge.Pop:s,c=e.navigator,l=e.static,h=void 0!==l&&l;vt()&&at(!1);var f=pt(n),d=(0,i.useMemo)((function(){return{basename:f,navigator:c,static:h}}),[f,c,h]);"string"===typeof o&&(o=et(o));var p=o,v=p.pathname,m=void 0===v?"/":v,g=p.search,y=void 0===g?"":g,b=p.hash,x=void 0===b?"":b,k=p.state,w=void 0===k?null:k,_=p.key,S=void 0===_?"default":_,C=(0,i.useMemo)((function(){var e=ft(m,f);return null==e?null:{pathname:e,search:y,hash:x,state:w,key:S}}),[f,m,y,x,w,S]);return null==C?null:(0,i.createElement)(tt.Provider,{value:d},(0,i.createElement)(nt.Provider,{children:a,value:{location:C,navigationType:u}}))}function xt(e){var t=e.children,n=e.location;return function(e,t){vt()||at(!1);var n,r=(0,i.useContext)(rt).matches,a=r[r.length-1],o=a?a.params:{},s=(a&&a.pathname,a?a.pathnameBase:"/"),u=(a&&a.route,mt());if(t){var c,l="string"===typeof t?et(t):t;"/"===s||(null==(c=l.pathname)?void 0:c.startsWith(s))||at(!1),n=l}else n=u;var h=n.pathname||"/",f=it(e,{pathname:"/"===s?h:h.slice(s.length)||"/"});return gt(f&&f.map((function(e){return Object.assign({},e,{params:Object.assign({},o,e.params),pathname:dt([s,e.pathname]),pathnameBase:"/"===e.pathnameBase?s:dt([s,e.pathnameBase])})})),r)}(kt(t),n)}function kt(e){var t=[];return i.Children.forEach(e,(function(e){if((0,i.isValidElement)(e))if(e.type!==i.Fragment){e.type!==yt&&at(!1);var n={caseSensitive:e.props.caseSensitive,element:e.props.element,index:e.props.index,path:e.props.path};e.props.children&&(n.children=kt(e.props.children)),t.push(n)}else t.push.apply(t,kt(e.props.children))})),t}function wt(e){var t=e.basename,n=e.children,r=e.window,a=(0,i.useRef)();null==a.current&&(a.current=function(e){void 0===e&&(e={});var t=e.window,n=void 0===t?document.defaultView:t,r=n.history;function a(){var e=n.location,t=e.pathname,a=e.search,i=e.hash,o=r.state||{};return[o.idx,Xe({pathname:t,search:a,hash:i,state:o.usr||null,key:o.key||"default"})]}var i=null;n.addEventListener(Ye,(function(){if(i)h.call(i),i=null;else{var e=Ge.Pop,t=a(),n=t[0],r=t[1];if(h.length){if(null!=n){var o=u-n;o&&(i={action:e,location:r,retry:function(){g(-1*o)}},g(o))}}else m(e)}}));var o=Ge.Pop,s=a(),u=s[0],c=s[1],l=Ze(),h=Ze();function f(e){return"string"===typeof e?e:$e(e)}function d(e,t){return void 0===t&&(t=null),Xe(He({pathname:c.pathname,hash:"",search:""},"string"===typeof e?et(e):e,{state:t,key:Je()}))}function p(e,t){return[{usr:e.state,key:e.key,idx:t},f(e)]}function v(e,t,n){return!h.length||(h.call({action:e,location:t,retry:n}),!1)}function m(e){o=e;var t=a();u=t[0],c=t[1],l.call({action:o,location:c})}function g(e){r.go(e)}null==u&&(u=0,r.replaceState(He({},r.state,{idx:u}),""));var y={get action(){return o},get location(){return c},createHref:f,push:function e(t,a){var i=Ge.Push,o=d(t,a);if(v(i,o,(function(){e(t,a)}))){var s=p(o,u+1),c=s[0],l=s[1];try{r.pushState(c,"",l)}catch(h){n.location.assign(l)}m(i)}},replace:function e(t,n){var a=Ge.Replace,i=d(t,n);if(v(a,i,(function(){e(t,n)}))){var o=p(i,u),s=o[0],c=o[1];r.replaceState(s,"",c),m(a)}},go:g,back:function(){g(-1)},forward:function(){g(1)},listen:function(e){return l.push(e)},block:function(e){var t=h.push(e);return 1===h.length&&n.addEventListener(Ke,Qe),function(){t(),h.length||n.removeEventListener(Ke,Qe)}}};return y}({window:r}));var o=a.current,s=f((0,i.useState)({action:o.action,location:o.location}),2),u=s[0],c=s[1];return(0,i.useLayoutEffect)((function(){return o.listen(c)}),[o]),(0,i.createElement)(bt,{basename:t,children:n,location:u.location,navigationType:u.action,navigator:o})}var _t,St;function Ct(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function Tt(e){return function(e){if(Array.isArray(e))return c(e)}(e)||Ct(e)||l(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Et(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var It,At,Mt,Nt,Rt,Dt=Ee(_t||(_t=Et(["\n  display: flex;\n  justify-content: center;\n  align-items: center;\n"]))),Pt=Ee(St||(St=Et(["\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: ","px;\n  height: ","px;\n"])),(function(e){return e.theme.windowWidth}),(function(e){return e.theme.windowHeight})),Ot=je.div(It||(It=Et(["\n  position: relative;\n  background: black;\n  color: white;\n  width: ","px;\n  height: ","px;\n  ",";\n"])),(function(e){return e.theme.windowWidth}),(function(e){return e.theme.windowHeight}),Dt),Lt=je.div(At||(At=Et(["\n  ",";\n"])),Dt),Ft=je.div(Mt||(Mt=Et(["\n  ",";\n  position: absolute;\n  top: ","px;\n  left: ","px;\n  transform: translate(-50%, -50%);\n  ","\n  transition: all .5s;\n  ",";\n"])),Dt,(function(e){return e.top}),(function(e){return e.left}),(function(e){return e.visibility?"opacity: 1;":"opacity: 0;"}),(function(e){return e.horizontalOrVertical&&"flex-direction: column"})),zt=je.img(Nt||(Nt=Et(["\n  width: 3rem;\n  height: 3rem;\n  padding: 0 1rem;\n  cursor: pointer;\n"]))),Bt=je.div(Rt||(Rt=Et(["\n  pointer-events: none;\n  font-size: 0.7rem;\n  padding: 0.1rem;\n  text-shadow: ",";\n"])),(function(e){return e.raiting&&"0 0 .2rem white, 0 0 .5rem white, 0 0 .7rem white, 0 0 1rem white"}));var Ut=__webpack_require__.p+"static/media/star-fill.2fcec2f29c837b88a3b1f25468c5e500.svg";var Vt=__webpack_require__.p+"static/media/star.f4323ed779592b668663ec8f1d82c65d.svg",Wt=__webpack_require__(184),Gt=function(e,t){return Math.random()*(t-e)+e};function jt(e){var t=e.keyword,n=e.visibility,r=e.raiting,a=e.top,o=e.left,s=Math.random()<.5,u=(0,i.useMemo)((function(){return Gt(0,360)}),[]),c=(0,i.useMemo)((function(){return"hsl(".concat(u,", 100%, 80%)")}),[]),l=(0,i.useMemo)((function(){return"hsl(".concat(u,", 100%, 10%)")}),[]);return(0,Wt.jsx)(Ft,{visibility:n,top:a,left:o,horizontalOrVertical:s,children:new Array(5).fill(0).map((function(e,n){return(0,Wt.jsx)(Bt,{raiting:r>n,style:{color:r>n?c:l},children:t},n)}))})}var qt=["GOOD","REVISIT","REVIEW","RECOMMENDED","EXCELENT","AWESOME","AMAZING","GREAT","EXCELLENT","SUPERB","BEST","POOR","BAD","TERRIBLE","AWFUL","CRAP","SUCK","SOSO","BEAUTIFUL","FANTASTIC","OK","NOT BAD","ASTONISHIING"];var Ht,Xt,Kt=function(){var e=f((0,i.useState)(0),2),t=e[0],n=e[1],r=f((0,i.useState)(new Array(qt.length).fill(0)),2),a=r[0],o=r[1],s=f(qe(),2),u=s[0],c=s[1],l=(0,i.useRef)(null);return(0,i.useEffect)((function(){if(l.current)return function(){return clearInterval(l.current)}}),[l,t]),(0,Wt.jsxs)(Ot,{children:[(0,Wt.jsx)(Lt,{children:new Array(5).fill(0).map((function(e,r){return(0,Wt.jsx)(zt,{src:t>r?Ut:Vt,onClick:function(){n(r+1),o(new Array(qt.length).fill(0)),l.current=setInterval((function(){o((function(e){var t=Tt(e);return t[Math.floor(Gt(0,qt.length))]=1,t}))}),1500/(t+1))}},r)}))}),qt.map((function(e,n){return(0,Wt.jsx)(jt,{keyword:e,visibility:a[n],raiting:t,top:Gt(0,c),left:Gt(0,u)},n)}))]})},Yt=je.div(Ht||(Ht=Et(["\n  ",";\n  ",";\n\n  font-family: StardosStencil;\n  background: hsl(235, 50%, 7%);\n"])),Dt,Pt),Qt=je.div(Xt||(Xt=Et(["\n  font-size: ","px;\n  color: hsl(235, 100%, ","%);\n"])),(function(e){return.1*e.theme.windowWidth}),(function(e){return e.lightness})),Zt=__webpack_require__.p+"static/media/UnAmoreCosiGrande.132c956d448b3c00143d.mp3";var Jt,$t,en,tn,nn,rn,an,on,sn,un=function(){var e=(0,i.useRef)(),t=f((0,i.useState)(20),2),n=t[0],r=t[1],a=f((0,i.useState)(85),2),o=a[0],s=a[1];(0,i.useEffect)((function(){if(e.current)return document.addEventListener("click",l),function(){return document.removeEventListener("click",l)}}),[e]);var u=(0,i.useRef)(),c=(0,i.useRef)();function l(){!function(e){var t=new(window.AudioContext||window.webkitAudioContext);h.current=t.createAnalyser(),h.current.fftSize=512;var n=t.createMediaElementSource(e);d.current=new Uint8Array(h.current.frequencyBinCount),n.connect(h.current),n.connect(t.destination)}(e.current),e.current.play(),u.current=Date.now(),c.current=Date.now(),v()}var h=(0,i.useRef)(),d=(0,i.useRef)(),p=(0,i.useRef)();function v(){if(p.current=requestAnimationFrame(v),u.current=Date.now(),u.current-c.current>70){c.current=u.current,h.current.getByteFrequencyData(d.current);for(var e=0,t=0;t<d.current.length;t++)e+=d.current[t];var n=e/d.current.length;r(20+Math.pow(n,1.8)),s(85+5*Math.floor(n/256*11))}}return(0,i.useEffect)((function(){if(p.current)return function(){return cancelAnimationFrame(p.current)}}),[p]),(0,Wt.jsxs)(Yt,{children:[(0,Wt.jsxs)(Qt,{lightness:o,children:["5 X 2 X 2 = ",n.toFixed(0)]}),(0,Wt.jsx)("audio",{crossOrigin:"anonymous",loop:!0,ref:e,src:Zt,title:"Un Amore Cosi Grande"})]})},cn=(je.div(Jt||(Jt=Et(["\n  font-family: StardosStencil;\n  ",";\n  ",";\n  background: hsl(216, 55%, 95%);\n\n  flex-direction: ",";\n"])),Dt,Pt,(function(e){return e.theme.windowWidth>768?"row":"column"})),je.div($t||($t=Et(["\n  font-size: 2rem;\n  line-height: 2.5rem;\n  margin: 2rem;\n"]))),je.div(en||(en=Et(["\n  ",";\n  flex-direction: column;\n"])),Dt),je.div(tn||(tn=Et(["\n  display: flex;\n  flex-direction: column;\n  margin: 0.8rem 0;\n"]))),je.label(nn||(nn=Et(["\n  font-size: 1.2rem;\n  margin-bottom: 0.4rem;\n"]))),Ee(rn||(rn=Et(["\n  outline: 0;\n  border: none;\n  border-radius: 0.3rem;\n  font-size: 1.5rem;\n  font-weight: 400;\n\n  width: ","px;\n  padding: 0.3rem 0.7rem;\n"])),(function(e){var t=e.theme;return Math.min(.7*t.windowWidth,500)}))),ln=(je.input(an||(an=Et(["\n  ",";\n"])),cn),je.div(on||(on=Et(["\n  background: hsl(176, 71%, 64%);\n"]))),je.div(sn||(sn=Et(["\n  ",";\n  ",";\n  font-family: StardosStencil;\n  background: hsl(216, 55%, 95%);\n\n  font-size: 4rem;\n  cursor: pointer;\n"])),Dt,Pt));var hn,fn,dn,pn,vn,mn,gn,yn,bn,xn,kn=function(e){var t=e.goNextStep;return(0,Wt.jsx)(ln,{onClick:t,children:"Register"})},wn=je.div(hn||(hn=Et(["\n  ",";\n  position: absolute;\n  width: ","px;\n  min-height: ","px;\n\n  overflow-y: scroll;\n\n  font-family: StardosStencil;\n\n  flex-direction: column;\n"])),Dt,(function(e){return e.theme.windowWidth}),(function(e){return e.theme.windowHeight})),_n=je.div(fn||(fn=Et(["\n  ",";\n  background: hsl(216, 55%, 95%);\n  z-index: -1;\n  position: fixed;\n  top: 0;\n  left: 0;\n"])),Pt),Sn=(je.div(dn||(dn=Et(["\n  font-size: 2rem;\n  line-height: 2.5rem;\n  margin-top: 2rem;\n"]))),je.div(pn||(pn=Et(["\n  ",";\n  margin: 2rem 0;\n  flex-direction: column;\n"])),Dt)),Cn=je.div(vn||(vn=Et(["\n  display: flex;\n  flex-direction: column;\n  margin: 0.8rem 0;\n"]))),Tn=je.label(mn||(mn=Et(["\n  font-size: 1.2rem;\n  margin-bottom: 0.4rem;\n  max-width: ","px;\n"])),(function(e){var t=e.theme;return Math.min(.7*t.windowWidth,500)})),En=je.div(gn||(gn=Et(["\n  margin: 0.3rem 0;\n  font-size: 0.8rem;\n  color: red;\n"]))),In=Ee(yn||(yn=Et(["\n  outline: 0;\n  border: 1px solid transparent;\n  border-radius: 0.3rem;\n  font-size: 1.5rem;\n  font-weight: 400;\n\n  width: ","px;\n  padding: 0.3rem 0.7rem;\n"])),(function(e){var t=e.theme;return Math.min(.7*t.windowWidth,500)})),An=je.input(bn||(bn=Et(["\n  ",";\n\n  ",";\n  transition: all 0.2s;\n\n  animation: appear 0.3s;\n\n  @keyframes appear {\n    from {\n      opacity: 0;\n    }\n    to {\n      opacity: 1;\n    }\n  }\n"])),In,(function(e){return e.wrong&&"border: 1px solid red"})),Mn=je.div(xn||(xn=Et(["\n  margin: 2rem 0;\n  margin-bottom: 4rem;\n  font-size: 1.5rem;\n  padding: 0.5rem 1rem;\n  border-radius: 0.5rem;\n  box-shadow: 0 0.1rem 0.5rem rgba(0, 0, 0, 0.2);\n  background: ",";\n  cursor: ",";\n"])),(function(e){return e.buttonActivated?"hsl(216, 55%, 85%)":"hsl(216, 10%, 85%)"}),(function(e){return e.buttonActivated?"pointer":"not-allowed"}));var Nn=function(e){var t=e.returnPreviousStep,n=f((0,i.useState)(3),2),r=n[0],a=(n[1],f((0,i.useState)(""),2)),o=a[0],s=a[1],u=f((0,i.useState)(""),2),c=u[0],l=u[1],h=f((0,i.useState)([""]),2),d=h[0],p=h[1],v=f((0,i.useState)(0),2),m=v[0],g=v[1],y=f((0,i.useState)(!1),2),b=y[0],x=y[1];(0,i.useEffect)((function(){d[m-1]===c&&""!==c&&m>=1&&(p((function(e){return[].concat(Tt(e),[""])})),g((function(e){return e+1})),m===r?d.every((function(e){return e===c}))&&x(!0):m!==r&&x(!1))}),[m,d,c]);var k=(0,i.useRef)();return(0,i.useEffect)((function(){return k.current&&clearTimeout(k.current),k.current=setTimeout((function(){s(""),l(""),p([""]),g(0),x(!1),t()}),3e4),function(){return clearTimeout(k.current)}}),[d]),(0,Wt.jsxs)(wn,{children:[(0,Wt.jsx)(_n,{}),(0,Wt.jsxs)(Sn,{children:[(0,Wt.jsxs)(Cn,{children:[(0,Wt.jsx)(Tn,{children:"Username"}),(0,Wt.jsx)(An,{type:"text",value:o,onChange:function(e){return s(e.target.value)}})]}),(0,Wt.jsxs)(Cn,{children:[(0,Wt.jsx)(Tn,{children:"Password"}),(0,Wt.jsx)(An,{type:"password",value:c,onChange:function(e){return l(e.target.value)},wrong:""!==c&&!/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}$/.test(c),onBlur:function(){0===m&&g(1)},onCopy:function(e){return e.preventDefault()}}),""!==c&&!/^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}$/.test(c)&&(0,Wt.jsx)(En,{children:"Requires at least one lowercase letter, one capital letter and one digit."})]}),new Array(m).fill(0).map((function(e,t){return(0,Wt.jsxs)(Cn,{children:[(0,Wt.jsxs)(Tn,{children:["Confirm the ".repeat(t),"Confirm Password"]}),(0,Wt.jsx)(An,{type:"password",value:d[t],onChange:function(e){return p((function(n){var r=Tt(n);return r[t]=e.target.value,r}))},wrong:""!==d[t]&&d[t]!==c,onBlur:function(){d[t]===c&&m===t+1&&(p((function(e){return[].concat(Tt(e),[""])})),g(t+2),m===r&&x(!0))},onPaste:function(e){return e.preventDefault()}})]},t)}))]}),(0,Wt.jsx)(Mn,{buttonActivated:b,onClick:function(){b&&(alert("Congratulations! You have successfully registered!"),t())},children:"Register"})]})};var Rn,Dn,Pn,On,Ln,Fn,zn,Bn,Un=function(){var e=f((0,i.useState)("lobby"),2),t=e[0],n=e[1];return(0,Wt.jsxs)(Wt.Fragment,{children:["lobby"===t&&(0,Wt.jsx)(kn,{goNextStep:function(){return n("floors")}}),"floors"===t&&(0,Wt.jsx)(Nn,{returnPreviousStep:function(){return n("lobby")}})]})},Vn=je.div(Rn||(Rn=Et(["\n  ",";\n  position: relative;\n  ",";\n  background: hsl(41, 24%, 97%);\n  flex-direction: column;\n"])),Pt,Dt),Wn=je.div(Dn||(Dn=Et(["\n  position: absolute;\n  top: 0;\n  width: 100%;\n  height: 95px;\n  background: hsl(41, 27%, 70%);\n  ",";\n  font-size: 30px;\n  font-weight: bold;\n  color: #333;\n"])),Dt),Gn=je.div(Pn||(Pn=Et(["\n  ",";\n  width: 80%;\n  font-size: 25px;\n  font-weight: bold;\n  margin-bottom: ","px;\n  color: #333;\n"])),Dt,(function(e){return.15*e.theme.windowHeight})),jn=je.div(On||(On=Et(["\n  ",";\n  width: 100%;\n"])),Dt),qn=je.div(Ln||(Ln=Et(["\n  font-weight: bold;\n  margin: 0 80px;\n"]))),Hn=je.div(Fn||(Fn=Et(["\n  ",";\n  width: ","px;\n  height: ","px;\n  position: relative;\n"])),Dt,(function(e){var t=e.theme;return t.windowWidth>768?768*.7:.7*t.windowWidth}),(function(e){return.2*e.theme.windowHeight})),Xn=je.div(zn||(zn=Et(["\n  position: absolute;\n  width: ","px;\n  height: ","px;\n\n  font-size: 35px;\n  font-weight: 600;\n  word-break: keep-all;\n  text-align: center;\n\n  ","\n  transition: all 0.4s;\n"])),(function(e){var t=e.theme;return t.windowWidth>768?768*.7:.7*t.windowWidth}),(function(e){return.2*e.theme.windowHeight}),(function(e){return e.instructionNumber===e.idx?"opacity: 1; transform: rotateY(0);":"opacity: 0; transform: rotateY(90deg);"})),Kn=je.div(Bn||(Bn=Et(["\n  position: absolute;\n  bottom: 0;\n  width: 100%;\n  height: 95px;\n  background: hsl(41, 27%, 57%);\n  ",";\n  color: #eee;\n  font-size: 20px;\n"])),Dt),Yn=["\uc815\ub9ac\uc815\ub3c8\uc740 \uc798 \ub418\uc5b4 \uc788\ub294\uac00?","\uccad\uc18c\uc0c1\ud0dc\ub294 \uc591\ud638\ud55c\uac00?","\uc704\ud5d8\ubb3c\uc740 \uc5c6\ub294\uac00?","\uc0ac\uc5c5\uacc4\ud68d \ub4f1 \uc8fc\uad00\uc801 \ud3c9\uac00\uc5d0\uc11c \uc810\uc218\ub97c \uc798 \ubc1b\uc558\ub294\uac00?","\uac1c\uc778\uc0ac\ubb3c\uc740 \ubc29\uc9c0\ub418\uc5b4 \uc788\ub294\uc9c0 \uc54a\ub294\uac00?","\uc0ac\ubb3c\uc740 \uc815\ub9ac\uc815\ub3c8\uc774 \ub418\uc5b4 \uc788\ub294\uac00?","\uc758\uc790 \uc9d1\uae30 \ud589\uac70 \ub9e4\ub300\ub4f1 \ubd88\ud544\uc694\ud55c \uc9d1\uae30\ub294 \uc54a\ub294\uac00?","\uce74\ud53c\ucea3\uc740 \uc548\ub155\ud55c\uac00?","\uc18c\ud654\uae30\ub294 \ube44\uce58\ub418\uc5b4 \uc788\ub294\uac00?","\ud65c\uc8fc\ub85c \ubc29\ud5a5\uc740 \uc798 \ud2c0\uc5b4\uc838 \uc788\ub294\uac00?","\ucc9c\uc7a5\uacfc \uc548\uc804\uac70\ub9ac\ub294 60cm\ub294 \uc720\uc9c0\ud558\uace0 \uc788\ub294\uac00?","\ucd9c\uc555\ubb38\uc2dc\uac74 \uc7a5\uce58\ub294 \uc774\uc0c1 \uc5c6\ub294\uac00?","\uc62c\ub9ac\ube0c \ud5c9\uc2ac\ub9ac\ub97c \uc798 \ub530\ub77c\uac00\uace0 \uc788\ub294\uac00?","KEY\ub294 \uc0ac\ubb34\uc2e4\uc5d0\uc11c \uad00\ub9ac\ub77c\uace0 \uc788\ub294\uac00?","\ubc14\uc0c1\ub79c\ud134\uc740 \ube44\uce58\ub418\uc5b4 \uc788\ub294\uac00?","\uc8fc\ucc28\uc7a5\uc740 \uc801\ub2f9\ud788 \ub09c\uc7a1\ud55c\uac00?","\uc0ac\ubb3c\uc740 \uc815\ub9ac\uc815\ub3c8\uc774 \ub418\uc5b4 \uc788\ub294\uac00?","\ucc3d\uace0 \ub0b4 \ubd80\ucc29\ubb3c\uc740 \uc774\uc0c1\uc5c6\ub294\uac00?","\ud1f4\uc7a5 \ud6c4 \uc18c\ub4f1\uc740 \uc2e4\uc2dc\ud558\uace0 \uc788\ub294\uac00?","\ud1b5\ub85c\uc5d0 BOX\ub098 \ud589\uac70\uac00 \ubc29\uce58\ub418\uc5b4 \ud1b5\ud589\uc5d0 \ubd88\ud3b8\ud558\uc9c0 \uc54a\ub294\uac00?","\uc624\uc9c1 \uc774\uacf3\uc5d0\uc11c\ub9cc \ub9cc\ub0a0 \uc218 \uc788\ub294 \ub3c5\ucc3d\uc801\uc778 \ub9db\uc758 \ud5a5\uc5f0\uc744 \ub290\uaef4\ubcf4\uc138\uc694.","\uc2dc\uc124\ubb3c\uc740 \uc774\uc0c1 \uc5c6\ub294\uac00?"],Qn=["\ucc3d\uace0\ub0b4 \ucde8\uc2dd\ud589 \uae08\uc9c0","\uc815\ub9ac\uc815\ub3c8 \uc2b5\uad00\ud654","\uc704\ud5d8\ud55c \ubcf4\uad00 \ubc0f \ubc29\uce58 \uae08\uc9c0","\uc624\ub298\uc744 \uc0c8\ub86d\uac8c, \ub0b4\uc77c\uc744 \uc774\ub86d\uac8c"];function Zn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Jn(e,t,n){return t&&Zn(e.prototype,t),n&&Zn(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function $n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function er(e,t){return er=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},er(e,t)}function tr(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&er(e,t)}function nr(e){return nr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},nr(e)}function rr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function ar(e){return ar="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ar(e)}function ir(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function or(e,t){if(t&&("object"===ar(t)||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return ir(e)}function sr(e){var t=rr();return function(){var n,r=nr(e);if(t){var a=nr(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return or(this,n)}}function ur(e,t,n){return ur=rr()?Reflect.construct.bind():function(e,t,n){var r=[null];r.push.apply(r,t);var a=new(Function.bind.apply(e,r));return n&&er(a,n.prototype),a},ur.apply(null,arguments)}function cr(e){var t="function"===typeof Map?new Map:void 0;return cr=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return ur(e,arguments,nr(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),er(r,e)},cr(e)}var lr=Tr(),hr=function(e){return wr(e,lr)},fr=Tr();hr.write=function(e){return wr(e,fr)};var dr=Tr();hr.onStart=function(e){return wr(e,dr)};var pr=Tr();hr.onFrame=function(e){return wr(e,pr)};var vr=Tr();hr.onFinish=function(e){return wr(e,vr)};var mr=[];hr.setTimeout=function(e,t){var n=hr.now()+t,r={time:n,handler:e,cancel:function e(){var t=mr.findIndex((function(t){return t.cancel==e}));~t&&mr.splice(t,1),xr-=~t?1:0}};return mr.splice(gr(n),0,r),xr+=1,_r(),r};var gr=function(e){return~(~mr.findIndex((function(t){return t.time>e}))||~mr.length)};hr.cancel=function(e){dr.delete(e),pr.delete(e),vr.delete(e),lr.delete(e),fr.delete(e)},hr.sync=function(e){kr=!0,hr.batchedUpdates(e),kr=!1},hr.throttle=function(e){var t;function n(){try{e.apply(void 0,Tt(t))}finally{t=null}}function r(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];t=r,hr.onStart(n)}return r.handler=e,r.cancel=function(){dr.delete(n),t=null},r};var yr="undefined"!=typeof window?window.requestAnimationFrame:function(){};hr.use=function(e){return yr=e},hr.now="undefined"!=typeof performance?function(){return performance.now()}:Date.now,hr.batchedUpdates=function(e){return e()},hr.catch=console.error,hr.frameLoop="always",hr.advance=function(){"demand"!==hr.frameLoop?console.warn("Cannot call the manual advancement of rafz whilst frameLoop is not set as demand"):Cr()};var br=-1,xr=0,kr=!1;function wr(e,t){kr?(t.delete(e),e(0)):(t.add(e),_r())}function _r(){br<0&&(br=0,"demand"!==hr.frameLoop&&yr(Sr))}function Sr(){~br&&(yr(Sr),hr.batchedUpdates(Cr))}function Cr(){var e=br;br=hr.now();var t=gr(br);t&&(Er(mr.splice(0,t),(function(e){return e.handler()})),xr-=t),xr?(dr.flush(),lr.flush(e?Math.min(64,br-e):16.667),pr.flush(),fr.flush(),vr.flush()):br=-1}function Tr(){var e=new Set,t=e;return{add:function(n){xr+=t!=e||e.has(n)?0:1,e.add(n)},delete:function(n){return xr-=t==e&&e.has(n)?1:0,e.delete(n)},flush:function(n){t.size&&(e=new Set,xr-=t.size,Er(t,(function(t){return t(n)&&e.add(t)})),xr+=e.size,t=e)}}}function Er(e,t){e.forEach((function(e){try{t(e)}catch(n){hr.catch(n)}}))}var Ir={arr:Array.isArray,obj:function(e){return!!e&&"Object"===e.constructor.name},fun:function(e){return"function"===typeof e},str:function(e){return"string"===typeof e},num:function(e){return"number"===typeof e},und:function(e){return void 0===e}};var Ar=function(e,t){return e.forEach(t)};function Mr(e,t,n){if(Ir.arr(e))for(var r=0;r<e.length;r++)t.call(n,e[r],"".concat(r));else for(var a in e)e.hasOwnProperty(a)&&t.call(n,e[a],a)}var Nr=function(e){return Ir.und(e)?[]:Ir.arr(e)?e:[e]};var Rr,Dr,Pr=function(){return"undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)},Or=null,Lr=!1,Fr=function(){},zr=function(e){e.to&&(Dr=e.to),e.now&&(hr.now=e.now),void 0!==e.colors&&(Or=e.colors),null!=e.skipAnimation&&(Lr=e.skipAnimation),e.createStringInterpolator&&(Rr=e.createStringInterpolator),e.requestAnimationFrame&&hr.use(e.requestAnimationFrame),e.batchedUpdates&&(hr.batchedUpdates=e.batchedUpdates),e.willAdvance&&(Fr=e.willAdvance),e.frameLoop&&(hr.frameLoop=e.frameLoop)},Br=Object.freeze({__proto__:null,get createStringInterpolator(){return Rr},get to(){return Dr},get colors(){return Or},get skipAnimation(){return Lr},get willAdvance(){return Fr},assign:zr}),Ur=new Set,Vr=[],Wr=[],Gr=0,jr={get idle(){return!Ur.size&&!Vr.length},start:function(e){Gr>e.priority?(Ur.add(e),hr.onStart(qr)):(Hr(e),hr(Kr))},advance:Kr,sort:function(e){if(Gr)hr.onFrame((function(){return jr.sort(e)}));else{var t=Vr.indexOf(e);~t&&(Vr.splice(t,1),Xr(e))}},clear:function(){Vr=[],Ur.clear()}};function qr(){Ur.forEach(Hr),Ur.clear(),hr(Kr)}function Hr(e){Vr.includes(e)||Xr(e)}function Xr(e){Vr.splice(function(e,t){var n=e.findIndex(t);return n<0?e.length:n}(Vr,(function(t){return t.priority>e.priority})),0,e)}function Kr(e){for(var t=Wr,n=0;n<Vr.length;n++){var r=Vr[n];Gr=r.priority,r.idle||(Fr(r),r.advance(e),r.idle||t.push(r))}return Gr=0,(Wr=Vr).length=0,(Vr=t).length>0}var Yr="[-+]?\\d*\\.?\\d+",Qr=Yr+"%";function Zr(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return"\\(\\s*("+t.join(")\\s*,\\s*(")+")\\s*\\)"}var Jr=new RegExp("rgb"+Zr(Yr,Yr,Yr)),$r=new RegExp("rgba"+Zr(Yr,Yr,Yr,Yr)),ea=new RegExp("hsl"+Zr(Yr,Qr,Qr)),ta=new RegExp("hsla"+Zr(Yr,Qr,Qr,Yr)),na=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,ra=/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})$/,aa=/^#([0-9a-fA-F]{6})$/,ia=/^#([0-9a-fA-F]{8})$/;function oa(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+(t-e)*(2/3-n)*6:e}function sa(e,t,n){var r=n<.5?n*(1+t):n+t-n*t,a=2*n-r,i=oa(a,r,e+1/3),o=oa(a,r,e),s=oa(a,r,e-1/3);return Math.round(255*i)<<24|Math.round(255*o)<<16|Math.round(255*s)<<8}function ua(e){var t=parseInt(e,10);return t<0?0:t>255?255:t}function ca(e){return(parseFloat(e)%360+360)%360/360}function la(e){var t=parseFloat(e);return t<0?0:t>1?255:Math.round(255*t)}function ha(e){var t=parseFloat(e);return t<0?0:t>100?1:t/100}function fa(e){var t=function(e){var t;return"number"===typeof e?e>>>0===e&&e>=0&&e<=4294967295?e:null:(t=aa.exec(e))?parseInt(t[1]+"ff",16)>>>0:Or&&void 0!==Or[e]?Or[e]:(t=Jr.exec(e))?(ua(t[1])<<24|ua(t[2])<<16|ua(t[3])<<8|255)>>>0:(t=$r.exec(e))?(ua(t[1])<<24|ua(t[2])<<16|ua(t[3])<<8|la(t[4]))>>>0:(t=na.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+"ff",16)>>>0:(t=ia.exec(e))?parseInt(t[1],16)>>>0:(t=ra.exec(e))?parseInt(t[1]+t[1]+t[2]+t[2]+t[3]+t[3]+t[4]+t[4],16)>>>0:(t=ea.exec(e))?(255|sa(ca(t[1]),ha(t[2]),ha(t[3])))>>>0:(t=ta.exec(e))?(sa(ca(t[1]),ha(t[2]),ha(t[3]))|la(t[4]))>>>0:null}(e);if(null===t)return e;var n=(16711680&(t=t||0))>>>16,r=(65280&t)>>>8,a=(255&t)/255;return"rgba(".concat((4278190080&t)>>>24,", ").concat(n,", ").concat(r,", ").concat(a,")")}var da=function e(t,n,r){if(Ir.fun(t))return t;if(Ir.arr(t))return e({range:t,output:n,extrapolate:r});if(Ir.str(t.output[0]))return Rr(t);var a=t,i=a.output,o=a.range||[0,1],s=a.extrapolateLeft||a.extrapolate||"extend",u=a.extrapolateRight||a.extrapolate||"extend",c=a.easing||function(e){return e};return function(e){var t=function(e,t){for(var n=1;n<t.length-1&&!(t[n]>=e);++n);return n-1}(e,o);return function(e,t,n,r,a,i,o,s,u){var c=u?u(e):e;if(c<t){if("identity"===o)return c;"clamp"===o&&(c=t)}if(c>n){if("identity"===s)return c;"clamp"===s&&(c=n)}if(r===a)return r;if(t===n)return e<=t?r:a;t===-1/0?c=-c:n===1/0?c-=t:c=(c-t)/(n-t);c=i(c),r===-1/0?c=-c:a===1/0?c+=r:c=c*(a-r)+r;return c}(e,o[t],o[t+1],i[t],i[t+1],c,s,u,a.map)}};function pa(){return pa=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},pa.apply(this,arguments)}var va=Symbol.for("FluidValue.get"),ma=Symbol.for("FluidValue.observers"),ga=function(e){return Boolean(e&&e[va])},ya=function(e){return e&&e[va]?e[va]():e};function ba(e,t){var n=e[ma];n&&n.forEach((function(e){!function(e,t){e.eventObserved?e.eventObserved(t):e(t)}(e,t)}))}var xa=Jn((function e(t){if($n(this,e),this[va]=void 0,this[ma]=void 0,!t&&!(t=this.get))throw Error("Unknown getter");ka(this,t)})),ka=function(e,t){return Ca(e,va,t)};function wa(e,t){if(e[va]){var n=e[ma];n||Ca(e,ma,n=new Set),n.has(t)||(n.add(t),e.observerAdded&&e.observerAdded(n.size,t))}return t}function _a(e,t){var n=e[ma];if(n&&n.has(t)){var r=n.size-1;r?n.delete(t):e[ma]=null,e.observerRemoved&&e.observerRemoved(r,t)}}var Sa,Ca=function(e,t,n){return Object.defineProperty(e,t,{value:n,writable:!0,configurable:!0})},Ta=/[+\-]?(?:0|[1-9]\d*)(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,Ea=/(#(?:[0-9a-f]{2}){2,4}|(#[0-9a-f]{3})|(rgb|hsl)a?\((-?\d+%?[,\s]+){2,3}\s*[\d\.]+%?\))/gi,Ia=new RegExp("(".concat(Ta.source,")(%|[a-z]+)"),"i"),Aa=/rgba\(([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+), ([0-9\.-]+)\)/gi,Ma=/var\((--[a-zA-Z0-9-_]+),? ?([a-zA-Z0-9 ()%#.,-]+)?\)/,Na=function e(t){var n=f(Ra(t),2),r=n[0],a=n[1];if(!r||Pr())return t;var i=window.getComputedStyle(document.documentElement).getPropertyValue(r);if(i)return i.trim();if(a&&a.startsWith("--")){var o=window.getComputedStyle(document.documentElement).getPropertyValue(a);return o||t}return a&&Ma.test(a)?e(a):a||t},Ra=function(e){var t=Ma.exec(e);if(!t)return[,];var n=f(t,3);return[n[1],n[2]]},Da=function(e,t,n,r,a){return"rgba(".concat(Math.round(t),", ").concat(Math.round(n),", ").concat(Math.round(r),", ").concat(a,")")},Pa=function(e){Sa||(Sa=Or?new RegExp("(".concat(Object.keys(Or).join("|"),")(?!\\w)"),"g"):/^\b$/);var t=e.output.map((function(e){return ya(e).replace(Ma,Na).replace(Ea,fa).replace(Sa,fa)})),n=t.map((function(e){return e.match(Ta).map(Number)})),r=n[0].map((function(e,t){return n.map((function(e){if(!(t in e))throw Error('The arity of each "output" value must be equal');return e[t]}))})),a=r.map((function(t){return da(pa({},e,{output:t}))}));return function(e){var n,r=!Ia.test(t[0])&&(null==(n=t.find((function(e){return Ia.test(e)})))?void 0:n.replace(Ta,"")),i=0;return t[0].replace(Ta,(function(){return"".concat(a[i++](e)).concat(r||"")})).replace(Aa,Da)}},Oa="react-spring: ",La=function(e){var t=e,n=!1;if("function"!=typeof t)throw new TypeError("".concat(Oa,"once requires a function parameter"));return function(){n||(t.apply(void 0,arguments),n=!0)}},Fa=La(console.warn);function za(){Fa("".concat(Oa,'The "interpolate" function is deprecated in v9 (use "to" instead)'))}La(console.warn);function Ba(e){return Ir.str(e)&&("#"==e[0]||/\d/.test(e)||!Pr()&&Ma.test(e)||e in(Or||{}))}var Ua=Pr()?i.useEffect:i.useLayoutEffect;function Va(){var e=(0,i.useState)()[1],t=function(){var e=(0,i.useRef)(!1);return Ua((function(){return e.current=!0,function(){e.current=!1}}),[]),e}();return function(){t.current&&e(Math.random())}}var Wa=[];function Ga(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=nr(e)););return e}function ja(){return ja="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=Ga(e,t);if(r){var a=Object.getOwnPropertyDescriptor(r,t);return a.get?a.get.call(arguments.length<3?e:n):a.value}},ja.apply(this,arguments)}var qa=Symbol.for("Animated:node"),Ha=function(e){return e&&e[qa]},Xa=function(e,t){return n=e,r=qa,a=t,Object.defineProperty(n,r,{value:a,writable:!0,configurable:!0});var n,r,a},Ka=function(e){return e&&e[qa]&&e[qa].getPayload()},Ya=function(){function e(){$n(this,e),this.payload=void 0,Xa(this,this)}return Jn(e,[{key:"getPayload",value:function(){return this.payload||[]}}]),e}(),Qa=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).done=!0,r.elapsedTime=void 0,r.lastPosition=void 0,r.lastVelocity=void 0,r.v0=void 0,r.durationProgress=0,r._value=e,Ir.num(r._value)&&(r.lastPosition=r._value),r}return Jn(n,[{key:"getPayload",value:function(){return[this]}},{key:"getValue",value:function(){return this._value}},{key:"setValue",value:function(e,t){return Ir.num(e)&&(this.lastPosition=e,t&&(e=Math.round(e/t)*t,this.done&&(this.lastPosition=e))),this._value!==e&&(this._value=e,!0)}},{key:"reset",value:function(){var e=this.done;this.done=!1,Ir.num(this._value)&&(this.elapsedTime=0,this.durationProgress=0,this.lastPosition=this._value,e&&(this.lastVelocity=null),this.v0=null)}}],[{key:"create",value:function(e){return new n(e)}}]),n}(Ya),Za=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,0))._string=null,r._toString=void 0,r._toString=da({output:[e,e]}),r}return Jn(n,[{key:"getValue",value:function(){var e=this._string;return null==e?this._string=this._toString(this._value):e}},{key:"setValue",value:function(e){if(Ir.str(e)){if(e==this._string)return!1;this._string=e,this._value=1}else{if(!ja(nr(n.prototype),"setValue",this).call(this,e))return!1;this._string=null}return!0}},{key:"reset",value:function(e){e&&(this._toString=da({output:[this.getValue(),e]})),this._value=0,ja(nr(n.prototype),"reset",this).call(this)}}],[{key:"create",value:function(e){return new n(e)}}]),n}(Qa),Ja={dependencies:null},$a=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).source=e,r.setValue(e),r}return Jn(n,[{key:"getValue",value:function(e){var t={};return Mr(this.source,(function(n,r){var a;(a=n)&&a[qa]===a?t[r]=n.getValue(e):ga(n)?t[r]=ya(n):e||(t[r]=n)})),t}},{key:"setValue",value:function(e){this.source=e,this.payload=this._makePayload(e)}},{key:"reset",value:function(){this.payload&&Ar(this.payload,(function(e){return e.reset()}))}},{key:"_makePayload",value:function(e){if(e){var t=new Set;return Mr(e,this._addToPayload,t),Array.from(t)}}},{key:"_addToPayload",value:function(e){var t=this;Ja.dependencies&&ga(e)&&Ja.dependencies.add(e);var n=Ka(e);n&&Ar(n,(function(e){return t.add(e)}))}}]),n}(Ya),ei=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"getValue",value:function(){return this.source.map((function(e){return e.getValue()}))}},{key:"setValue",value:function(e){var t=this.getPayload();return e.length==t.length?t.map((function(t,n){return t.setValue(e[n])})).some(Boolean):(ja(nr(n.prototype),"setValue",this).call(this,e.map(ti)),!0)}}],[{key:"create",value:function(e){return new n(e)}}]),n}($a);function ti(e){return(Ba(e)?Za:Qa).create(e)}function ni(){return ni=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},ni.apply(this,arguments)}var ri=function(e,t){var n=!Ir.fun(e)||e.prototype&&e.prototype.isReactComponent;return(0,i.forwardRef)((function(r,a){var o,s=(0,i.useRef)(null),u=n&&(0,i.useCallback)((function(e){s.current=function(e,t){e&&(Ir.fun(e)?e(t):e.current=t);return t}(a,e)}),[a]),c=function(e,t){var n=new Set;Ja.dependencies=n,e.style&&(e=ni({},e,{style:t.createAnimatedStyle(e.style)}));return e=new $a(e),Ja.dependencies=null,[e,n]}(r,t),l=f(c,2),h=l[0],d=l[1],p=Va(),v=function(){var e=s.current;n&&!e||!1===(!!e&&t.applyAnimatedValues(e,h.getValue(!0)))&&p()},m=new ai(v,d),g=(0,i.useRef)();Ua((function(){return g.current=m,Ar(d,(function(e){return wa(e,m)})),function(){g.current&&(Ar(g.current.deps,(function(e){return _a(e,g.current)})),hr.cancel(g.current.update))}})),(0,i.useEffect)(v,[]),o=function(){return function(){var e=g.current;Ar(e.deps,(function(t){return _a(t,e)}))}},(0,i.useEffect)(o,Wa);var y=t.getComponentProps(h.getValue());return i.createElement(e,ni({},y,{ref:u}))}))},ai=function(){function e(t,n){$n(this,e),this.update=t,this.deps=n}return Jn(e,[{key:"eventObserved",value:function(e){"change"==e.type&&hr.write(this.update)}}]),e}();var ii=Symbol.for("AnimatedComponent"),oi=function(e){return Ir.str(e)?e:e&&Ir.str(e.displayName)?e.displayName:Ir.fun(e)&&e.name||null};function si(){return si=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},si.apply(this,arguments)}var ui=1.70158,ci=1.525*ui,li=ui+1,hi=2*Math.PI/3,fi=2*Math.PI/4.5,di=function(e){var t=7.5625,n=2.75;return e<1/n?t*e*e:e<2/n?t*(e-=1.5/n)*e+.75:e<2.5/n?t*(e-=2.25/n)*e+.9375:t*(e-=2.625/n)*e+.984375},pi={linear:function(e){return e},easeInQuad:function(e){return e*e},easeOutQuad:function(e){return 1-(1-e)*(1-e)},easeInOutQuad:function(e){return e<.5?2*e*e:1-Math.pow(-2*e+2,2)/2},easeInCubic:function(e){return e*e*e},easeOutCubic:function(e){return 1-Math.pow(1-e,3)},easeInOutCubic:function(e){return e<.5?4*e*e*e:1-Math.pow(-2*e+2,3)/2},easeInQuart:function(e){return e*e*e*e},easeOutQuart:function(e){return 1-Math.pow(1-e,4)},easeInOutQuart:function(e){return e<.5?8*e*e*e*e:1-Math.pow(-2*e+2,4)/2},easeInQuint:function(e){return e*e*e*e*e},easeOutQuint:function(e){return 1-Math.pow(1-e,5)},easeInOutQuint:function(e){return e<.5?16*e*e*e*e*e:1-Math.pow(-2*e+2,5)/2},easeInSine:function(e){return 1-Math.cos(e*Math.PI/2)},easeOutSine:function(e){return Math.sin(e*Math.PI/2)},easeInOutSine:function(e){return-(Math.cos(Math.PI*e)-1)/2},easeInExpo:function(e){return 0===e?0:Math.pow(2,10*e-10)},easeOutExpo:function(e){return 1===e?1:1-Math.pow(2,-10*e)},easeInOutExpo:function(e){return 0===e?0:1===e?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2},easeInCirc:function(e){return 1-Math.sqrt(1-Math.pow(e,2))},easeOutCirc:function(e){return Math.sqrt(1-Math.pow(e-1,2))},easeInOutCirc:function(e){return e<.5?(1-Math.sqrt(1-Math.pow(2*e,2)))/2:(Math.sqrt(1-Math.pow(-2*e+2,2))+1)/2},easeInBack:function(e){return li*e*e*e-ui*e*e},easeOutBack:function(e){return 1+li*Math.pow(e-1,3)+ui*Math.pow(e-1,2)},easeInOutBack:function(e){return e<.5?Math.pow(2*e,2)*(7.189819*e-ci)/2:(Math.pow(2*e-2,2)*((ci+1)*(2*e-2)+ci)+2)/2},easeInElastic:function(e){return 0===e?0:1===e?1:-Math.pow(2,10*e-10)*Math.sin((10*e-10.75)*hi)},easeOutElastic:function(e){return 0===e?0:1===e?1:Math.pow(2,-10*e)*Math.sin((10*e-.75)*hi)+1},easeInOutElastic:function(e){return 0===e?0:1===e?1:e<.5?-Math.pow(2,20*e-10)*Math.sin((20*e-11.125)*fi)/2:Math.pow(2,-20*e+10)*Math.sin((20*e-11.125)*fi)/2+1},easeInBounce:function(e){return 1-di(1-e)},easeOutBounce:di,easeInOutBounce:function(e){return e<.5?(1-di(1-2*e))/2:(1+di(2*e-1))/2}};si({},{tension:170,friction:26},{mass:1,damping:1,easing:pi.linear,clamp:!1});Error,Error;var vi=function(e){return e instanceof gi},mi=1,gi=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).id=mi++,e.key=void 0,e._priority=0,e}return Jn(n,[{key:"priority",get:function(){return this._priority},set:function(e){this._priority!=e&&(this._priority=e,this._onPriorityChange(e))}},{key:"get",value:function(){var e=Ha(this);return e&&e.getValue()}},{key:"to",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Br.to(this,t)}},{key:"interpolate",value:function(){za();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Br.to(this,t)}},{key:"toJSON",value:function(){return this.get()}},{key:"observerAdded",value:function(e){1==e&&this._attach()}},{key:"observerRemoved",value:function(e){0==e&&this._detach()}},{key:"_attach",value:function(){}},{key:"_detach",value:function(){}},{key:"_onChange",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];ba(this,{type:"change",parent:this,value:e,idle:t})}},{key:"_onPriorityChange",value:function(e){this.idle||jr.sort(this),ba(this,{type:"priority",parent:this,priority:e})}}]),n}(xa);Symbol.for("SpringPhase");function yi(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}var bi,xi,ki=["children"],wi=function(e){var t=e.children,n=yi(e,ki),r=(0,i.useContext)(_i),a=n.pause||!!r.pause,o=n.immediate||!!r.immediate;n=function(e,t){var n=f((0,i.useState)((function(){return{inputs:t,result:e()}})),1)[0],r=(0,i.useRef)(),a=r.current,o=a;if(o){var s=Boolean(t&&o.inputs&&function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}(t,o.inputs));s||(o={inputs:t,result:e()})}else o=n;return(0,i.useEffect)((function(){r.current=o,a==n&&(n.inputs=n.result=void 0)}),[o]),o.result}((function(){return{pause:a,immediate:o}}),[a,o]);var s=_i.Provider;return i.createElement(s,{value:n},t)},_i=(bi=wi,xi={},Object.assign(bi,i.createContext(xi)),bi.Provider._context=bi,bi.Consumer._context=bi,bi);wi.Provider=_i.Provider,wi.Consumer=_i.Consumer;var Si;!function(e){e.MOUNT="mount",e.ENTER="enter",e.UPDATE="update",e.LEAVE="leave"}(Si||(Si={}));var Ci=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;$n(this,n),(a=t.call(this)).key=void 0,a.idle=!0,a.calc=void 0,a._active=new Set,a.source=e,a.calc=da.apply(void 0,Tt(r));var i=a._get(),o=function(e){var t=Ha(e);return t?t.constructor:Ir.arr(e)?ei:Ba(e)?Za:Qa}(i);return Xa(ir(a),o.create(i)),a}return Jn(n,[{key:"advance",value:function(e){var t=this._get();(function(e,t){if(Ir.arr(e)){if(!Ir.arr(t)||e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}return e===t})(t,this.get())||(Ha(this).setValue(t),this._onChange(t,this.idle)),!this.idle&&Ei(this._active)&&Ii(this)}},{key:"_get",value:function(){var e=Ir.arr(this.source)?this.source.map(ya):Nr(ya(this.source));return this.calc.apply(this,Tt(e))}},{key:"_start",value:function(){var e=this;this.idle&&!Ei(this._active)&&(this.idle=!1,Ar(Ka(this),(function(e){e.done=!1})),Br.skipAnimation?(hr.batchedUpdates((function(){return e.advance()})),Ii(this)):jr.start(this))}},{key:"_attach",value:function(){var e=this,t=1;Ar(Nr(this.source),(function(n){ga(n)&&wa(n,e),vi(n)&&(n.idle||e._active.add(n),t=Math.max(t,n.priority+1))})),this.priority=t,this._start()}},{key:"_detach",value:function(){var e=this;Ar(Nr(this.source),(function(t){ga(t)&&_a(t,e)})),this._active.clear(),Ii(this)}},{key:"eventObserved",value:function(e){"change"==e.type?e.idle?this.advance():(this._active.add(e.parent),this._start()):"idle"==e.type?this._active.delete(e.parent):"priority"==e.type&&(this.priority=Nr(this.source).reduce((function(e,t){return Math.max(e,(vi(t)?t.priority:0)+1)}),0))}}]),n}(gi);function Ti(e){return!1!==e.idle}function Ei(e){return!e.size||Array.from(e).every(Ti)}function Ii(e){e.idle||(e.idle=!0,Ar(Ka(e),(function(e){e.done=!0})),ba(e,{type:"idle",parent:e}))}Br.assign({createStringInterpolator:Pa,to:function(e,t){return new Ci(e,t)}});jr.advance;var Ai=__webpack_require__(4164);function Mi(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}var Ni=["style","children","scrollTop","scrollLeft"],Ri=/^--/;function Di(e,t){return null==t||"boolean"===typeof t||""===t?"":"number"!==typeof t||0===t||Ri.test(e)||Oi.hasOwnProperty(e)&&Oi[e]?(""+t).trim():t+"px"}var Pi={};var Oi={animationIterationCount:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Li=["Webkit","Ms","Moz","O"];Oi=Object.keys(Oi).reduce((function(e,t){return Li.forEach((function(n){return e[function(e,t){return e+t.charAt(0).toUpperCase()+t.substring(1)}(n,t)]=e[t]})),e}),Oi);var Fi=["x","y","z"],zi=/^(matrix|translate|scale|rotate|skew)/,Bi=/^(translate)/,Ui=/^(rotate|skew)/,Vi=function(e,t){return Ir.num(e)&&0!==e?e+t:e},Wi=function e(t,n){return Ir.arr(t)?t.every((function(t){return e(t,n)})):Ir.num(t)?t===n:parseFloat(t)===n},Gi=function(e){tr(n,e);var t=sr(n);function n(e){$n(this,n);var r=e.x,a=e.y,i=e.z,o=Mi(e,Fi),s=[],u=[];return(r||a||i)&&(s.push([r||0,a||0,i||0]),u.push((function(e){return["translate3d(".concat(e.map((function(e){return Vi(e,"px")})).join(","),")"),Wi(e,0)]}))),Mr(o,(function(e,t){if("transform"===t)s.push([e||""]),u.push((function(e){return[e,""===e]}));else if(zi.test(t)){if(delete o[t],Ir.und(e))return;var n=Bi.test(t)?"px":Ui.test(t)?"deg":"";s.push(Nr(e)),u.push("rotate3d"===t?function(e){var t=f(e,4),r=t[0],a=t[1],i=t[2],o=t[3];return["rotate3d(".concat(r,",").concat(a,",").concat(i,",").concat(Vi(o,n),")"),Wi(o,0)]}:function(e){return["".concat(t,"(").concat(e.map((function(e){return Vi(e,n)})).join(","),")"),Wi(e,t.startsWith("scale")?1:0)]})}})),s.length&&(o.transform=new ji(s,u)),t.call(this,o)}return Jn(n)}($a),ji=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this))._value=null,a.inputs=e,a.transforms=r,a}return Jn(n,[{key:"get",value:function(){return this._value||(this._value=this._get())}},{key:"_get",value:function(){var e=this,t="",n=!0;return Ar(this.inputs,(function(r,a){var i=ya(r[0]),o=f(e.transforms[a](Ir.arr(i)?i:r.map(ya)),2),s=o[0],u=o[1];t+=" "+s,n=n&&u})),n?"none":t}},{key:"observerAdded",value:function(e){var t=this;1==e&&Ar(this.inputs,(function(e){return Ar(e,(function(e){return ga(e)&&wa(e,t)}))}))}},{key:"observerRemoved",value:function(e){var t=this;0==e&&Ar(this.inputs,(function(e){return Ar(e,(function(e){return ga(e)&&_a(e,t)}))}))}},{key:"eventObserved",value:function(e){"change"==e.type&&(this._value=null),ba(this,e)}}]),n}(xa),qi=["scrollTop","scrollLeft"];Br.assign({batchedUpdates:Ai.unstable_batchedUpdates,createStringInterpolator:Pa,colors:{transparent:0,aliceblue:4042850303,antiquewhite:4209760255,aqua:16777215,aquamarine:2147472639,azure:4043309055,beige:4126530815,bisque:4293182719,black:255,blanchedalmond:4293643775,blue:65535,blueviolet:2318131967,brown:2771004159,burlywood:3736635391,burntsienna:3934150143,cadetblue:1604231423,chartreuse:2147418367,chocolate:3530104575,coral:4286533887,cornflowerblue:1687547391,cornsilk:4294499583,crimson:3692313855,cyan:16777215,darkblue:35839,darkcyan:9145343,darkgoldenrod:3095792639,darkgray:2846468607,darkgreen:6553855,darkgrey:2846468607,darkkhaki:3182914559,darkmagenta:2332068863,darkolivegreen:1433087999,darkorange:4287365375,darkorchid:2570243327,darkred:2332033279,darksalmon:3918953215,darkseagreen:2411499519,darkslateblue:1211993087,darkslategray:793726975,darkslategrey:793726975,darkturquoise:13554175,darkviolet:2483082239,deeppink:4279538687,deepskyblue:12582911,dimgray:1768516095,dimgrey:1768516095,dodgerblue:512819199,firebrick:2988581631,floralwhite:4294635775,forestgreen:579543807,fuchsia:4278255615,gainsboro:3705462015,ghostwhite:4177068031,gold:4292280575,goldenrod:3668254975,gray:2155905279,green:8388863,greenyellow:2919182335,grey:2155905279,honeydew:4043305215,hotpink:4285117695,indianred:3445382399,indigo:1258324735,ivory:4294963455,khaki:4041641215,lavender:3873897215,lavenderblush:4293981695,lawngreen:2096890111,lemonchiffon:4294626815,lightblue:2916673279,lightcoral:4034953471,lightcyan:3774873599,lightgoldenrodyellow:4210742015,lightgray:3553874943,lightgreen:2431553791,lightgrey:3553874943,lightpink:4290167295,lightsalmon:4288707327,lightseagreen:548580095,lightskyblue:2278488831,lightslategray:2005441023,lightslategrey:2005441023,lightsteelblue:2965692159,lightyellow:4294959359,lime:16711935,limegreen:852308735,linen:4210091775,magenta:4278255615,maroon:2147483903,mediumaquamarine:1724754687,mediumblue:52735,mediumorchid:3126187007,mediumpurple:2473647103,mediumseagreen:1018393087,mediumslateblue:2070474495,mediumspringgreen:16423679,mediumturquoise:1221709055,mediumvioletred:3340076543,midnightblue:421097727,mintcream:4127193855,mistyrose:4293190143,moccasin:4293178879,navajowhite:4292783615,navy:33023,oldlace:4260751103,olive:2155872511,olivedrab:1804477439,orange:4289003775,orangered:4282712319,orchid:3664828159,palegoldenrod:4008225535,palegreen:2566625535,paleturquoise:2951671551,palevioletred:3681588223,papayawhip:4293907967,peachpuff:4292524543,peru:3448061951,pink:4290825215,plum:3718307327,powderblue:2967529215,purple:2147516671,rebeccapurple:1714657791,red:4278190335,rosybrown:3163525119,royalblue:1097458175,saddlebrown:2336560127,salmon:4202722047,sandybrown:4104413439,seagreen:780883967,seashell:4294307583,sienna:2689740287,silver:3233857791,skyblue:2278484991,slateblue:1784335871,slategray:1887473919,slategrey:1887473919,snow:4294638335,springgreen:16744447,steelblue:1182971135,tan:3535047935,teal:8421631,thistle:3636451583,tomato:4284696575,turquoise:1088475391,violet:4001558271,wheat:4125012991,white:4294967295,whitesmoke:4126537215,yellow:4294902015,yellowgreen:2597139199}});var Hi=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.applyAnimatedValues,r=void 0===n?function(){return!1}:n,a=t.createAnimatedStyle,i=void 0===a?function(e){return new $a(e)}:a,o=t.getComponentProps,s=void 0===o?function(e){return e}:o,u={applyAnimatedValues:r,createAnimatedStyle:i,getComponentProps:s},c=function e(t){var n=oi(t)||"Anonymous";return(t=Ir.str(t)?e[t]||(e[t]=ri(t,u)):t[ii]||(t[ii]=ri(t,u))).displayName="Animated(".concat(n,")"),t};return Mr(e,(function(t,n){Ir.arr(e)&&(n=oi(t)),c[n]=c(t)})),{animated:c}}(["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"],{applyAnimatedValues:function(e,t){if(!e.nodeType||!e.setAttribute)return!1;var n="filter"===e.nodeName||e.parentNode&&"filter"===e.parentNode.nodeName,r=t,a=r.style,i=r.children,o=r.scrollTop,s=r.scrollLeft,u=Mi(r,Ni),c=Object.values(u),l=Object.keys(u).map((function(t){return n||e.hasAttribute(t)?t:Pi[t]||(Pi[t]=t.replace(/([A-Z])/g,(function(e){return"-"+e.toLowerCase()})))}));for(var h in void 0!==i&&(e.textContent=i),a)if(a.hasOwnProperty(h)){var f=Di(h,a[h]);Ri.test(h)?e.style.setProperty(h,f):e.style[h]=f}l.forEach((function(t,n){e.setAttribute(t,c[n])})),void 0!==o&&(e.scrollTop=o),void 0!==s&&(e.scrollLeft=s)},createAnimatedStyle:function(e){return new Gi(e)},getComponentProps:function(e){return Mi(e,qi)}});Hi.animated;var Xi,Ki,Yi=function(){var e=f((0,i.useState)(0),2),t=e[0],n=e[1],r=f((0,i.useState)(0),2),a=r[0],o=r[1];return(0,i.useEffect)((function(){var e=setInterval((function(){o((function(e){return(e+1)%Qn.length}))}),3e3);return function(){return clearInterval(e)}}),[]),(0,Wt.jsxs)(Vn,{children:[(0,Wt.jsx)(Wn,{children:"\ucc3d\uace0 \uc548\uc804\uad00\ub9ac \uc218\uce59"}),(0,Wt.jsxs)(Gn,{children:[(0,Wt.jsx)(qn,{onClick:function(){return n((function(e){return 0===e?Yn.length-1:(e-1)%Yn.length}))},children:"<"}),"".concat(t+1,"/").concat(Yn.length),(0,Wt.jsxs)(qn,{onClick:function(){return n((function(e){return(e+1)%Yn.length}))},children:[" ",">"]})]}),(0,Wt.jsx)(jn,{children:(0,Wt.jsx)(Hn,{children:Yn.map((function(e,n){return(0,Wt.jsx)(Xn,{idx:n,instructionNumber:t,children:e},n)}))})}),(0,Wt.jsx)(Kn,{children:Qn[a]})]})},Qi=je.div(Xi||(Xi=Et(["\n  ",";\n  ",";\n  position: relative;\n"])),Dt,Pt),Zi=je.input(Ki||(Ki=Et(["\n  cursor: pointer;\n  top: ","px;\n  left: ","px;\n  position: absolute;\n  width: 3rem;\n  height: 2rem;\n  transform: translate(-50%, -50%);\n"])),(function(e){return e.y}),(function(e){return e.x}));var Ji,$i,eo,to=function(){var e=f(qe(),2),t=e[0],n=e[1],r=(0,i.useMemo)((function(){return Math.ceil(t/40)}),[t]),a=(0,i.useMemo)((function(){return Math.ceil(n/40)}),[n]),o=(0,i.useMemo)((function(){return new Array(r*a).fill(0).map((function(e,t){return{x:t%r*40,y:40*Math.floor(t/r)}}))}),[t,n]),s=f((0,i.useState)(!1),2),u=s[0],c=s[1],l=f((0,i.useState)(-11),2),h=l[0],d=l[1],p=f((0,i.useState)([]),2),v=p[0],m=p[1];return(0,i.useEffect)((function(){u&&d((function(e){return e+1}))}),[u]),(0,i.useEffect)((function(){m((function(e){for(var t=r*a,n=[],i=0;i<t;i++)Math.random()<Math.exp(-h)/Math.pow(1+Math.exp(-h),2)&&n.push(i);return[].concat(Tt(e),n)}))}),[h,r,a]),console.log(v),(0,Wt.jsx)(Qi,{children:o.map((function(e,t){return(0,Wt.jsx)(Zi,{type:"checkbox",x:e.x,y:e.y,checked:!v.includes(t)&&u,onChange:function(){return v.includes(t)?alert("We want Freedom, not a selection!"):c((function(e){return!e}))}},t)}))})},no=je.div(Ji||(Ji=Et(["\n  ",";\n  ",";\n  position: relative;\n  background: hsl(239, 81%, 7%);\n"])),Dt,Pt),ro=je.input($i||($i=Et(["\n  width: 20rem;\n  transform: rotate(90deg);\n  z-index: 2;\n"]))),ao=je.div.attrs((function(e){return{style:{top:e.top+"px",left:e.left+"px",opacity:e.show?1:0,transform:"translate(-50%, -50%) rotate(".concat(e.rotation,"deg)"),fontSize:e.size+"rem",color:e.color}}}))(eo||(eo=Et(["\n  position: absolute;\n  transition: all 0.4s;\n  pointer-events: none;\n"]))),io=function(e,t){return Math.random()*(t-e)+e};var oo,so=function(){var e=f((0,i.useState)(0),2),t=e[0],n=e[1],r=f(qe(),2),a=r[0],o=r[1],s=(0,i.useMemo)((function(){return(new Date).getMinutes()%60+20}),[]),u=(0,i.useMemo)((function(){for(var e=[],t=0;t<400;t++)e.push({x:io(0,a),y:io(0,o),show:io(io(s-2,s),io(s,s+2)),size:io(.8,io(.8,io(1,5))),color:"hsl(".concat(io(197,360),", 80%, 91%)")});return e}),[a,o,s]);return(0,Wt.jsxs)(no,{children:[(0,Wt.jsx)(ro,{type:"range",value:t,onChange:function(e){return n(e.target.value)},min:"0",max:"100"}),u.map((function(e,n){return(0,Wt.jsx)(ao,{left:e.x,top:e.y,show:e.show<t,rotation:io(0,720),color:e.color,size:e.size,children:"+"},n)}))]})},uo=je.div(oo||(oo=Et(["\n  ",";\n  ",";\n\n  transform: ",";\n  transition: transform 0.03s ease-in-out;\n\n  background: black;\n  color: white;\n"])),Dt,Pt,(function(e){var t=e.pos;return"translate(".concat(t.x,"px, ").concat(t.y,"px)")})),co=function(e,t){return Math.random()*(t-e)+e};var lo,ho=function(){var e=f((0,i.useState)({x:0,y:0}),2),t=e[0],n=e[1];function r(){navigator.vibrate([500,250,500,250,500,250,500,250,500,250,500]);var e=new Array(100).fill(0).map((function(e,t){return{pos:{x:co(-2,2),y:co(-2,2)},time:15*t}}));e.map((function(e){var t=e.pos,r=e.time;console.log(t,r),setTimeout((function(){n(t)}),r)}))}return(0,i.useEffect)((function(){return document.addEventListener("click",r),function(){return document.removeEventListener("click",r)}}),[]),(0,Wt.jsx)(uo,{pos:t,children:"."})},fo=je.div(lo||(lo=Et(["\n  ",";\n  ",";\n  font-size: 1.5rem;\n  text-align: center;\n  flex-direction: column;\n\n  h1 {\n    margin: 0;\n  }\n"])),Dt,Pt),po=["annuale","biennale","triennale","quadriennale","quinquennale","sessennale","settennale","ottennale","nonennale","decennale","non decennale","duodecennio","tredecennio","quattuordecennale","quinto centenario","sexdecennial","settdecennale","ottdecennale","novdecennio","vigennale","un vigennio","duo vigennio","tre vigennio","quattro vigennio","cinque vigennio","sei vigennio","sette vigennio","otto vigennio","nove vigennio","dieci vigennio","undici vigennio","dodici vigennio","tredici vigennio","quattordici vigennio","quindici vigennio","sedici vigennio","diciassette vigennio","diciotto vigennio","diciannove vigennio","ventigennio","ventuno vigennio","ventidue vigennio","ventitre vigennio","ventiquattro vigennio","venticinque vigennio","ventisei vigennio","ventisette vigennio","ventotto vigennio","ventinove vigennio","trentigennio","trentuno vigennio","trentidue vigennio","trentitre vigennio","trentiquattro vigennio","trenticinque vigennio","trentisei vigennio","trentisette vigennio","trentotto vigennio","trentinove vigennio","quattraginta vigennio","quattragintuno vigennio","quattragintadue vigennio","quattragintatre vigennio","quattragintaquattro vigennio","quattragintacinque vigennio","quattragintasei vigennio","quattragintasette vigennio","quattragintotto vigennio","quattragintanove vigennio","quinquaginta vigennio","quinquagintuno vigennio","quinquagintadue vigennio","quinquagintatre vigennio","quinquagintaquattro vigennio","quinquagintacinque vigennio","quinquagintasei vigennio","quinquagintasette vigennio","quinquagintotto vigennio","quinquagintanove vigennio","sexaginta vigennio","sexagintuno vigennio","PLURIDECENNALE"];var vo,mo,go,yo,bo=function(){var e=f((0,i.useState)(0),2),t=e[0],n=e[1];function r(e){if(e>69)return n(0),void r(1);console.log(e);var t=setTimeout((function(){n(e),r(e+1)}),3e3/e);return function(){return clearTimeout(t)}}return(0,i.useEffect)((function(){r(1)}),[]),(0,Wt.jsxs)(fo,{style:{background:"hsl(".concat(53*t%360,", 75%, 50%)"),color:"hsl(".concat((53*t+180)%360,", 75%, 50%)")},children:[(0,Wt.jsx)("h3",{children:"Welcome to"}),(0,Wt.jsxs)("h1",{children:["2022 ",t>=69?"PLURIDECENNALE":po[t]]})]})},xo=je.div(vo||(vo=Et(["\n  ",";\n  ",";\n"])),Dt,Pt),ko=je.div(mo||(mo=Et(["\n  height: 100%;\n  width: ","px;\n  background: hsl(85, 100%, 70%);\n  color: hsl(265, 100%, 70%);\n  display: block;\n\n  ",";\n  font-size: 5rem;\n  font-weight: bold;\n"])),(function(e){return.5*e.theme.windowWidth}),Dt),wo=je.div(go||(go=Et(["\n  height: 100%;\n  width: ","px;\n  background: hsl(265, 100%, 70%);\n  color: hsl(85, 100%, 70%);\n\n  display: grid;\n  grid-template-columns: repeat(2, ","px);\n  grid-template-rows: repeat(3, 33.33333%);\n"])),(function(e){return.5*e.theme.windowWidth}),(function(e){return.25*e.theme.windowWidth})),_o=je.div(yo||(yo=Et(["\n  width: 100%;\n  height: 100%;\n"])));function So(e,t,n){var r=(0,i.useRef)(null),a=(0,i.useRef)(e);return(0,i.useEffect)((function(){a.current=e}),[e]),(0,i.useEffect)((function(){return function e(){var i=function(e,t){return Math.floor(Math.random()*(t-e+1))+e}(t,n);r.current=setTimeout((function(){a.current(),e()}),i)}(),function(){clearTimeout(r.current)}}),[t,n]),(0,i.useCallback)((function(){return clearTimeout(r.current)}),[r])}var Co,To,Eo,Io,Ao=function(){var e=f((0,i.useState)(64),2),t=e[0],n=e[1],r=f((0,i.useState)(t),2),a=r[0],o=r[1];return So((function(){return n(function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}(64,127))}),2e3,5e3),(0,i.useEffect)((function(){if(t!==a){var e=setInterval((function(){o((function(e){return e+(t>e?1:-1)}))}),300/Math.abs(t-a));return function(){return clearInterval(e)}}}),[t,a]),(0,Wt.jsxs)(xo,{children:[(0,Wt.jsx)(ko,{children:a}),(0,Wt.jsx)(wo,{children:new Array(6).fill(0).map((function(e,t){return(0,Wt.jsx)(_o,{style:{background:Math.floor(a/Math.pow(2,t))%2===0?"transparent":"hsl(85, 100%, 70%)"}},t)}))})]})},Mo=je.div(Co||(Co=Et(["\n  ",";\n  ",";\n  flex-direction: column;\n  background: #955813;\n"])),Dt,Pt),No=je.div(To||(To=Et(["\n  display: grid;\n  grid-template-columns: repeat(4, 5rem);\n  grid-template-rows: repeat(4, 5rem);\n  transition: all 0.5s;\n"]))),Ro=je.div(Eo||(Eo=Et(["\n  ",";\n  width: 4rem;\n  height: 4rem;\n  border-radius: 50%;\n  background: white;\n  cursor: pointer;\n  font-size: 5rem;\n  font-weight: bold;\n  transform: rotate(3deg);\n"])),Dt),Do=je.div(Io||(Io=Et(["\n  margin-top: 3rem;\n  color: white;\n  height: 3rem;\n  transform: rotateY(180deg);\n"])));var Po,Oo,Lo,Fo,zo=function(){var e=["What is this artwork?","This artwork questions.","What does this questions?","This artwork questions the validity.","Which kind of validity?","Of everything, basically","Can you be more specific?","Well, look at these holes","You mean these sixteen holes?","Yes, exactly","Well, I don't really get it.","Well, then you had understood perfectly.","What had I understood?","You just said that you don't get it, didn't you.","Yes I did","Well I'm so tired today. Let me explain you tomorrow"],t=f((0,i.useState)(new Array(16).fill("")),2),n=t[0],r=t[1],a=f((0,i.useState)(-1),2),o=a[0],s=a[1];return console.log(o),(0,Wt.jsxs)(Mo,{children:[(0,Wt.jsx)(No,{children:new Array(16).fill(0).map((function(t,a){return(0,Wt.jsx)(Ro,{onClick:function(){return function(t){""===n[t]&&s((function(t){return(t+1)%e.length})),r((function(e){var n=Tt(e);return""===n[t]?n[t]=Math.random()<.1?"!":"?":(s(-1),n[t]=""),n}))}(a)},children:n[a]},a)}))}),(0,Wt.jsx)(Do,{children:-1===o?" ":e[o]})]})},Bo=je.div(Po||(Po=Et(["\n  ",";\n  ",";\n  position: relative;\n  background: rgb(253, 218, 22);\n  font-family: Frutiger;\n  font-weight: bold;\n\n  img {\n    position: absolute;\n    width: 3rem;\n    height: auto;\n    opacity: 0.5;\n  }\n"])),Pt,Dt),Uo=je.div(Oo||(Oo=Et(["\n  display: grid;\n  grid-template-columns: repeat(20, 3.2rem);\n  grid-template-rows: repeat(20, 1rem);\n"]))),Vo=je.div(Lo||(Lo=Et(["\n  ",";\n  width: 100%;\n  height: 100%;\n"])),Dt),Wo=je.div(Fo||(Fo=Et(["\n  ",";\n  text-align: center;\n  font-size: 0.5rem;\n  width: 100%;\n  height: 100%;\n  ","\n  ","\n"])),Dt,(function(e){return 2===e.step&&"background: rgb(255, 255, 250);"}),(function(e){return 3===e.step&&"background: rgb(218, 41, 28); color: white;"}));var Go=__webpack_require__.p+"static/media/plane.a44859e1c1caf23ce95738f3c7a90383.svg",jo=function(e,t){return Math.random()*(t-e)+e};function qo(e){var t=e.item,n=e.triggerFly,r=f((0,i.useState)(0),2),a=r[0],o=r[1];return(0,i.useEffect)((function(){var e=setInterval((function(){r()}),1e3*(t.idle+t.step1+t.step2+t.step3+t.step4)),r=function(){o(0),setTimeout((function(){o(1)}),1e3*t.idle),setTimeout((function(){o(2)}),1e3*(t.idle+t.step1)),setTimeout((function(){o(3)}),1e3*(t.idle+t.step1+t.step2)),setTimeout((function(){o(4),n()}),1e3*(t.idle+t.step1+t.step2+t.step3))};return function(){return clearInterval(e)}}),[t]),(0,Wt.jsx)(Vo,{children:(0,Wt.jsx)(Wo,{step:a,children:["","Go To Gate","Boarding","Last Call","Gate Closure"][a]})})}var Ho,Xo=function(){var e=(0,i.useMemo)((function(){for(var e=[],t=0;t<400;t++){var n=jo(.6,2);e.push({idle:n*jo(5,25),step1:n*jo(5,20),step2:n*jo(5,jo(5,15)),step3:n*jo(1,jo(1,5)),step4:n*jo(3,15),initialDelay:jo(0,10)})}return e}),[]),t=(0,i.useRef)();function n(){if(t&&t.current){var e=document.createElement("img");e.src=Go,t.current.append(e);var n,r={duration:jo(600,900),iterations:1};Math.random()<.5?(e.style.top=jo(105,115)+"vh",e.style.left=jo(-5,-15)+"vh",n=[{transform:"translate(0, 0)"},{transform:"translate(120vw,-120vh)"}]):(e.style.top=jo(-15,-5)+"vh",e.style.left=jo(-5,-15)+"vh",n=[{transform:"translate(0, 0)"},{transform:"translate(120vw,120vh)"}]),e.animate(n,r),setTimeout((function(){e.remove()}),1e3)}}return(0,Wt.jsx)(Bo,{ref:t,children:(0,Wt.jsx)(Uo,{children:e.map((function(e,t){return(0,Wt.jsx)(qo,{item:e,triggerFly:n},t)}))})})},Ko=je.div(Ho||(Ho=Et(["\n  ",";\n  ",";\n  background: rgb(5, 6, 48);\n  color: white;\n\n  font-size: 20rem;\n  font-weight: bold;\n"])),Dt,Pt);var Yo,Qo,Zo,Jo,$o=function(){var e=f((0,i.useState)(5),2),t=e[0],n=e[1];return(0,i.useEffect)((function(){var e=setInterval((function(){n((function(e){return e<-2?5:e-1}))}),1e3);return function(){return clearInterval(e)}}),[]),(0,i.useEffect)((function(){!function(e){if(e>0){var t=window.speechSynthesis,n=new SpeechSynthesisUtterance("".concat(e," ").concat(e>=2?"seconds":"second"));n.pitch=1,n.rate=1.5,t.speak(n)}}(t)}),[t]),(0,Wt.jsx)(Ko,{children:t>0?t:""})};function es(){es=function(){return e};var e={},t=Object.prototype,n=t.hasOwnProperty,r="function"==typeof Symbol?Symbol:{},a=r.iterator||"@@iterator",i=r.asyncIterator||"@@asyncIterator",o=r.toStringTag||"@@toStringTag";function s(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{s({},"")}catch(T){s=function(e,t,n){return e[t]=n}}function u(e,t,n,r){var a=t&&t.prototype instanceof h?t:h,i=Object.create(a.prototype),o=new _(r||[]);return i._invoke=function(e,t,n){var r="suspendedStart";return function(a,i){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===a)throw i;return C()}for(n.method=a,n.arg=i;;){var o=n.delegate;if(o){var s=x(o,n);if(s){if(s===l)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=c(e,t,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===l)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}(e,n,o),i}function c(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(T){return{type:"throw",arg:T}}}e.wrap=u;var l={};function h(){}function f(){}function d(){}var p={};s(p,a,(function(){return this}));var v=Object.getPrototypeOf,m=v&&v(v(S([])));m&&m!==t&&n.call(m,a)&&(p=m);var g=d.prototype=h.prototype=Object.create(p);function y(e){["next","throw","return"].forEach((function(t){s(e,t,(function(e){return this._invoke(t,e)}))}))}function b(e,t){function r(a,i,o,s){var u=c(e[a],e,i);if("throw"!==u.type){var l=u.arg,h=l.value;return h&&"object"==ar(h)&&n.call(h,"__await")?t.resolve(h.__await).then((function(e){r("next",e,o,s)}),(function(e){r("throw",e,o,s)})):t.resolve(h).then((function(e){l.value=e,o(l)}),(function(e){return r("throw",e,o,s)}))}s(u.arg)}var a;this._invoke=function(e,n){function i(){return new t((function(t,a){r(e,n,t,a)}))}return a=a?a.then(i,i):i()}}function x(e,t){var n=e.iterator[t.method];if(void 0===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=void 0,x(e,t),"throw"===t.method))return l;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return l}var r=c(n,e.iterator,t.arg);if("throw"===r.type)return t.method="throw",t.arg=r.arg,t.delegate=null,l;var a=r.arg;return a?a.done?(t[e.resultName]=a.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=void 0),t.delegate=null,l):a:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,l)}function k(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function w(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(k,this),this.reset(!0)}function S(e){if(e){var t=e[a];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var r=-1,i=function t(){for(;++r<e.length;)if(n.call(e,r))return t.value=e[r],t.done=!1,t;return t.value=void 0,t.done=!0,t};return i.next=i}}return{next:C}}function C(){return{value:void 0,done:!0}}return f.prototype=d,s(g,"constructor",d),s(d,"constructor",f),f.displayName=s(d,o,"GeneratorFunction"),e.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===f||"GeneratorFunction"===(t.displayName||t.name))},e.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,d):(e.__proto__=d,s(e,o,"GeneratorFunction")),e.prototype=Object.create(g),e},e.awrap=function(e){return{__await:e}},y(b.prototype),s(b.prototype,i,(function(){return this})),e.AsyncIterator=b,e.async=function(t,n,r,a,i){void 0===i&&(i=Promise);var o=new b(u(t,n,r,a),i);return e.isGeneratorFunction(n)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},y(g),s(g,o,"Generator"),s(g,a,(function(){return this})),s(g,"toString",(function(){return"[object Generator]"})),e.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var r=t.pop();if(r in e)return n.value=r,n.done=!1,n}return n.done=!0,n}},e.values=S,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(w),!e)for(var t in this)"t"===t.charAt(0)&&n.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=void 0)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function r(n,r){return o.type="throw",o.arg=e,t.next=n,r&&(t.method="next",t.arg=void 0),!!r}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],o=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a.tryLoc<=this.prev&&n.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=e,o.arg=t,i?(this.method="next",this.next=i.finallyLoc,l):this.complete(o)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),l},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),w(n),l}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if("throw"===r.type){var a=r.arg;w(n)}return a}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,n){return this.delegate={iterator:S(e),resultName:t,nextLoc:n},"next"===this.method&&(this.arg=void 0),l}},e}function ts(e,t,n,r,a,i,o){try{var s=e[i](o),u=s.value}catch(c){return void n(c)}s.done?t(u):Promise.resolve(u).then(r,a)}function ns(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){ts(i,r,a,o,s,"next",e)}function s(e){ts(i,r,a,o,s,"throw",e)}o(void 0)}))}}var rs=je.div(Yo||(Yo=Et(["\n  ",";\n  ",";\n  flex-direction: column;\n  background: #002fa7;\n"])),Dt,Pt),as=je.div(Qo||(Qo=Et(["\n  width: 70%;\n  text-align: center;\n  opacity: 1;\n\n  color: white;\n  font-size: 2rem;\n  text-transform: uppercase;\n"]))),is=je.div(Zo||(Zo=Et(["\n  width: 70%;\n  font-size: 1.5rem;\n  height: 6rem;\n  margin-top: 3rem;\n  text-align: center;\n  opacity: 1;\n  text-transform: lowercase;\n  color: white;\n"]))),os=je.video(Jo||(Jo=Et(["\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  opacity: 0.3;\n  color: transparent;\n  filter: blur(20px) brightness(3);\n"]))),ss=__webpack_require__(5801),us=function(){return us=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var a in t=arguments[n])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e},us.apply(this,arguments)};function cs(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n}function ls(e,t,n){if(n||2===arguments.length)for(var r,a=0,i=t.length;a<i;a++)!r&&a in t||(r||(r=Array.prototype.slice.call(t,0,a)),r[a]=t[a]);return e.concat(r||Array.prototype.slice.call(t))}function hs(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}var fs=function(e){var t=Object.create(null);return function(n){return void 0===t[n]&&(t[n]=e(n)),t[n]}},ds=/^((children|dangerouslySetInnerHTML|key|ref|autoFocus|defaultValue|defaultChecked|innerHTML|suppressContentEditableWarning|suppressHydrationWarning|valueLink|abbr|accept|acceptCharset|accessKey|action|allow|allowUserMedia|allowPaymentRequest|allowFullScreen|allowTransparency|alt|async|autoComplete|autoPlay|capture|cellPadding|cellSpacing|challenge|charSet|checked|cite|classID|className|cols|colSpan|content|contentEditable|contextMenu|controls|controlsList|coords|crossOrigin|data|dateTime|decoding|default|defer|dir|disabled|disablePictureInPicture|download|draggable|encType|enterKeyHint|form|formAction|formEncType|formMethod|formNoValidate|formTarget|frameBorder|headers|height|hidden|high|href|hrefLang|htmlFor|httpEquiv|id|inputMode|integrity|is|keyParams|keyType|kind|label|lang|list|loading|loop|low|marginHeight|marginWidth|max|maxLength|media|mediaGroup|method|min|minLength|multiple|muted|name|nonce|noValidate|open|optimum|pattern|placeholder|playsInline|poster|preload|profile|radioGroup|readOnly|referrerPolicy|rel|required|reversed|role|rows|rowSpan|sandbox|scope|scoped|scrolling|seamless|selected|shape|size|sizes|slot|span|spellCheck|src|srcDoc|srcLang|srcSet|start|step|style|summary|tabIndex|target|title|translate|type|useMap|value|width|wmode|wrap|about|datatype|inlist|prefix|property|resource|typeof|vocab|autoCapitalize|autoCorrect|autoSave|color|incremental|fallback|inert|itemProp|itemScope|itemType|itemID|itemRef|on|option|results|security|unselectable|accentHeight|accumulate|additive|alignmentBaseline|allowReorder|alphabetic|amplitude|arabicForm|ascent|attributeName|attributeType|autoReverse|azimuth|baseFrequency|baselineShift|baseProfile|bbox|begin|bias|by|calcMode|capHeight|clip|clipPathUnits|clipPath|clipRule|colorInterpolation|colorInterpolationFilters|colorProfile|colorRendering|contentScriptType|contentStyleType|cursor|cx|cy|d|decelerate|descent|diffuseConstant|direction|display|divisor|dominantBaseline|dur|dx|dy|edgeMode|elevation|enableBackground|end|exponent|externalResourcesRequired|fill|fillOpacity|fillRule|filter|filterRes|filterUnits|floodColor|floodOpacity|focusable|fontFamily|fontSize|fontSizeAdjust|fontStretch|fontStyle|fontVariant|fontWeight|format|from|fr|fx|fy|g1|g2|glyphName|glyphOrientationHorizontal|glyphOrientationVertical|glyphRef|gradientTransform|gradientUnits|hanging|horizAdvX|horizOriginX|ideographic|imageRendering|in|in2|intercept|k|k1|k2|k3|k4|kernelMatrix|kernelUnitLength|kerning|keyPoints|keySplines|keyTimes|lengthAdjust|letterSpacing|lightingColor|limitingConeAngle|local|markerEnd|markerMid|markerStart|markerHeight|markerUnits|markerWidth|mask|maskContentUnits|maskUnits|mathematical|mode|numOctaves|offset|opacity|operator|order|orient|orientation|origin|overflow|overlinePosition|overlineThickness|panose1|paintOrder|pathLength|patternContentUnits|patternTransform|patternUnits|pointerEvents|points|pointsAtX|pointsAtY|pointsAtZ|preserveAlpha|preserveAspectRatio|primitiveUnits|r|radius|refX|refY|renderingIntent|repeatCount|repeatDur|requiredExtensions|requiredFeatures|restart|result|rotate|rx|ry|scale|seed|shapeRendering|slope|spacing|specularConstant|specularExponent|speed|spreadMethod|startOffset|stdDeviation|stemh|stemv|stitchTiles|stopColor|stopOpacity|strikethroughPosition|strikethroughThickness|string|stroke|strokeDasharray|strokeDashoffset|strokeLinecap|strokeLinejoin|strokeMiterlimit|strokeOpacity|strokeWidth|surfaceScale|systemLanguage|tableValues|targetX|targetY|textAnchor|textDecoration|textRendering|textLength|to|transform|u1|u2|underlinePosition|underlineThickness|unicode|unicodeBidi|unicodeRange|unitsPerEm|vAlphabetic|vHanging|vIdeographic|vMathematical|values|vectorEffect|version|vertAdvY|vertOriginX|vertOriginY|viewBox|viewTarget|visibility|widths|wordSpacing|writingMode|x|xHeight|x1|x2|xChannelSelector|xlinkActuate|xlinkArcrole|xlinkHref|xlinkRole|xlinkShow|xlinkTitle|xlinkType|xmlBase|xmlns|xmlnsXlink|xmlLang|xmlSpace|y|y1|y2|yChannelSelector|z|zoomAndPan|for|class|autofocus)|(([Dd][Aa][Tt][Aa]|[Aa][Rr][Ii][Aa]|x)-.*))$/,ps=fs((function(e){return ds.test(e)||111===e.charCodeAt(0)&&110===e.charCodeAt(1)&&e.charCodeAt(2)<91}));var vs=function(){function e(e){var t=this;this._insertTag=function(e){var n;n=0===t.tags.length?t.insertionPoint?t.insertionPoint.nextSibling:t.prepend?t.container.firstChild:t.before:t.tags[t.tags.length-1].nextSibling,t.container.insertBefore(e,n),t.tags.push(e)},this.isSpeedy=void 0===e.speedy||e.speedy,this.tags=[],this.ctr=0,this.nonce=e.nonce,this.key=e.key,this.container=e.container,this.prepend=e.prepend,this.insertionPoint=e.insertionPoint,this.before=null}var t=e.prototype;return t.hydrate=function(e){e.forEach(this._insertTag)},t.insert=function(e){this.ctr%(this.isSpeedy?65e3:1)===0&&this._insertTag(function(e){var t=document.createElement("style");return t.setAttribute("data-emotion",e.key),void 0!==e.nonce&&t.setAttribute("nonce",e.nonce),t.appendChild(document.createTextNode("")),t.setAttribute("data-s",""),t}(this));var t=this.tags[this.tags.length-1];if(this.isSpeedy){var n=function(e){if(e.sheet)return e.sheet;for(var t=0;t<document.styleSheets.length;t++)if(document.styleSheets[t].ownerNode===e)return document.styleSheets[t]}(t);try{n.insertRule(e,n.cssRules.length)}catch(r){0}}else t.appendChild(document.createTextNode(e));this.ctr++},t.flush=function(){this.tags.forEach((function(e){return e.parentNode&&e.parentNode.removeChild(e)})),this.tags=[],this.ctr=0},e}(),ms=Math.abs,gs=String.fromCharCode,ys=Object.assign;function bs(e){return e.trim()}function xs(e,t,n){return e.replace(t,n)}function ks(e,t){return e.indexOf(t)}function ws(e,t){return 0|e.charCodeAt(t)}function _s(e,t,n){return e.slice(t,n)}function Ss(e){return e.length}function Cs(e){return e.length}function Ts(e,t){return t.push(e),e}var Es=1,Is=1,As=0,Ms=0,Ns=0,Rs="";function Ds(e,t,n,r,a,i,o){return{value:e,root:t,parent:n,type:r,props:a,children:i,line:Es,column:Is,length:o,return:""}}function Ps(e,t){return ys(Ds("",null,null,"",null,null,0),e,{length:-e.length},t)}function Os(){return Ns=Ms>0?ws(Rs,--Ms):0,Is--,10===Ns&&(Is=1,Es--),Ns}function Ls(){return Ns=Ms<As?ws(Rs,Ms++):0,Is++,10===Ns&&(Is=1,Es++),Ns}function Fs(){return ws(Rs,Ms)}function zs(){return Ms}function Bs(e,t){return _s(Rs,e,t)}function Us(e){switch(e){case 0:case 9:case 10:case 13:case 32:return 5;case 33:case 43:case 44:case 47:case 62:case 64:case 126:case 59:case 123:case 125:return 4;case 58:return 3;case 34:case 39:case 40:case 91:return 2;case 41:case 93:return 1}return 0}function Vs(e){return Es=Is=1,As=Ss(Rs=e),Ms=0,[]}function Ws(e){return Rs="",e}function Gs(e){return bs(Bs(Ms-1,Hs(91===e?e+2:40===e?e+1:e)))}function js(e){for(;(Ns=Fs())&&Ns<33;)Ls();return Us(e)>2||Us(Ns)>3?"":" "}function qs(e,t){for(;--t&&Ls()&&!(Ns<48||Ns>102||Ns>57&&Ns<65||Ns>70&&Ns<97););return Bs(e,zs()+(t<6&&32==Fs()&&32==Ls()))}function Hs(e){for(;Ls();)switch(Ns){case e:return Ms;case 34:case 39:34!==e&&39!==e&&Hs(Ns);break;case 40:41===e&&Hs(e);break;case 92:Ls()}return Ms}function Xs(e,t){for(;Ls()&&e+Ns!==57&&(e+Ns!==84||47!==Fs()););return"/*"+Bs(t,Ms-1)+"*"+gs(47===e?e:Ls())}function Ks(e){for(;!Us(Fs());)Ls();return Bs(e,Ms)}var Ys="-ms-",Qs="-moz-",Zs="-webkit-",Js="comm",$s="rule",eu="decl",tu="@keyframes";function nu(e,t){for(var n="",r=Cs(e),a=0;a<r;a++)n+=t(e[a],a,e,t)||"";return n}function ru(e,t,n,r){switch(e.type){case"@import":case eu:return e.return=e.return||e.value;case Js:return"";case tu:return e.return=e.value+"{"+nu(e.children,r)+"}";case $s:e.value=e.props.join(",")}return Ss(n=nu(e.children,r))?e.return=e.value+"{"+n+"}":""}function au(e){return Ws(iu("",null,null,null,[""],e=Vs(e),0,[0],e))}function iu(e,t,n,r,a,i,o,s,u){for(var c=0,l=0,h=o,f=0,d=0,p=0,v=1,m=1,g=1,y=0,b="",x=a,k=i,w=r,_=b;m;)switch(p=y,y=Ls()){case 40:if(108!=p&&58==ws(_,h-1)){-1!=ks(_+=xs(Gs(y),"&","&\f"),"&\f")&&(g=-1);break}case 34:case 39:case 91:_+=Gs(y);break;case 9:case 10:case 13:case 32:_+=js(p);break;case 92:_+=qs(zs()-1,7);continue;case 47:switch(Fs()){case 42:case 47:Ts(su(Xs(Ls(),zs()),t,n),u);break;default:_+="/"}break;case 123*v:s[c++]=Ss(_)*g;case 125*v:case 59:case 0:switch(y){case 0:case 125:m=0;case 59+l:d>0&&Ss(_)-h&&Ts(d>32?uu(_+";",r,n,h-1):uu(xs(_," ","")+";",r,n,h-2),u);break;case 59:_+=";";default:if(Ts(w=ou(_,t,n,c,l,a,s,b,x=[],k=[],h),i),123===y)if(0===l)iu(_,t,w,w,x,i,h,s,k);else switch(99===f&&110===ws(_,3)?100:f){case 100:case 109:case 115:iu(e,w,w,r&&Ts(ou(e,w,w,0,0,a,s,b,a,x=[],h),k),a,k,h,s,r?x:k);break;default:iu(_,w,w,w,[""],k,0,s,k)}}c=l=d=0,v=g=1,b=_="",h=o;break;case 58:h=1+Ss(_),d=p;default:if(v<1)if(123==y)--v;else if(125==y&&0==v++&&125==Os())continue;switch(_+=gs(y),y*v){case 38:g=l>0?1:(_+="\f",-1);break;case 44:s[c++]=(Ss(_)-1)*g,g=1;break;case 64:45===Fs()&&(_+=Gs(Ls())),f=Fs(),l=h=Ss(b=_+=Ks(zs())),y++;break;case 45:45===p&&2==Ss(_)&&(v=0)}}return i}function ou(e,t,n,r,a,i,o,s,u,c,l){for(var h=a-1,f=0===a?i:[""],d=Cs(f),p=0,v=0,m=0;p<r;++p)for(var g=0,y=_s(e,h+1,h=ms(v=o[p])),b=e;g<d;++g)(b=bs(v>0?f[g]+" "+y:xs(y,/&\f/g,f[g])))&&(u[m++]=b);return Ds(e,t,n,0===a?$s:s,u,c,l)}function su(e,t,n){return Ds(e,t,n,Js,gs(Ns),_s(e,2,-2),0)}function uu(e,t,n,r){return Ds(e,t,n,eu,_s(e,0,r),_s(e,r+1,-1),r)}var cu=function(e,t,n){for(var r=0,a=0;r=a,a=Fs(),38===r&&12===a&&(t[n]=1),!Us(a);)Ls();return Bs(e,Ms)},lu=function(e,t){return Ws(function(e,t){var n=-1,r=44;do{switch(Us(r)){case 0:38===r&&12===Fs()&&(t[n]=1),e[n]+=cu(Ms-1,t,n);break;case 2:e[n]+=Gs(r);break;case 4:if(44===r){e[++n]=58===Fs()?"&\f":"",t[n]=e[n].length;break}default:e[n]+=gs(r)}}while(r=Ls());return e}(Vs(e),t))},hu=new WeakMap,fu=function(e){if("rule"===e.type&&e.parent&&!(e.length<1)){for(var t=e.value,n=e.parent,r=e.column===n.column&&e.line===n.line;"rule"!==n.type;)if(!(n=n.parent))return;if((1!==e.props.length||58===t.charCodeAt(0)||hu.get(n))&&!r){hu.set(e,!0);for(var a=[],i=lu(t,a),o=n.props,s=0,u=0;s<i.length;s++)for(var c=0;c<o.length;c++,u++)e.props[u]=a[s]?i[s].replace(/&\f/g,o[c]):o[c]+" "+i[s]}}},du=function(e){if("decl"===e.type){var t=e.value;108===t.charCodeAt(0)&&98===t.charCodeAt(2)&&(e.return="",e.value="")}};function pu(e,t){switch(function(e,t){return 45^ws(e,0)?(((t<<2^ws(e,0))<<2^ws(e,1))<<2^ws(e,2))<<2^ws(e,3):0}(e,t)){case 5103:return"-webkit-print-"+e+e;case 5737:case 4201:case 3177:case 3433:case 1641:case 4457:case 2921:case 5572:case 6356:case 5844:case 3191:case 6645:case 3005:case 6391:case 5879:case 5623:case 6135:case 4599:case 4855:case 4215:case 6389:case 5109:case 5365:case 5621:case 3829:return Zs+e+e;case 5349:case 4246:case 4810:case 6968:case 2756:return Zs+e+Qs+e+Ys+e+e;case 6828:case 4268:return Zs+e+Ys+e+e;case 6165:return Zs+e+Ys+"flex-"+e+e;case 5187:return Zs+e+xs(e,/(\w+).+(:[^]+)/,"-webkit-box-$1$2-ms-flex-$1$2")+e;case 5443:return Zs+e+Ys+"flex-item-"+xs(e,/flex-|-self/,"")+e;case 4675:return Zs+e+Ys+"flex-line-pack"+xs(e,/align-content|flex-|-self/,"")+e;case 5548:return Zs+e+Ys+xs(e,"shrink","negative")+e;case 5292:return Zs+e+Ys+xs(e,"basis","preferred-size")+e;case 6060:return"-webkit-box-"+xs(e,"-grow","")+Zs+e+Ys+xs(e,"grow","positive")+e;case 4554:return Zs+xs(e,/([^-])(transform)/g,"$1-webkit-$2")+e;case 6187:return xs(xs(xs(e,/(zoom-|grab)/,"-webkit-$1"),/(image-set)/,"-webkit-$1"),e,"")+e;case 5495:case 3959:return xs(e,/(image-set\([^]*)/,"-webkit-$1$`$1");case 4968:return xs(xs(e,/(.+:)(flex-)?(.*)/,"-webkit-box-pack:$3-ms-flex-pack:$3"),/s.+-b[^;]+/,"justify")+Zs+e+e;case 4095:case 3583:case 4068:case 2532:return xs(e,/(.+)-inline(.+)/,"-webkit-$1$2")+e;case 8116:case 7059:case 5753:case 5535:case 5445:case 5701:case 4933:case 4677:case 5533:case 5789:case 5021:case 4765:if(Ss(e)-1-t>6)switch(ws(e,t+1)){case 109:if(45!==ws(e,t+4))break;case 102:return xs(e,/(.+:)(.+)-([^]+)/,"$1-webkit-$2-$3$1-moz-"+(108==ws(e,t+3)?"$3":"$2-$3"))+e;case 115:return~ks(e,"stretch")?pu(xs(e,"stretch","fill-available"),t)+e:e}break;case 4949:if(115!==ws(e,t+1))break;case 6444:switch(ws(e,Ss(e)-3-(~ks(e,"!important")&&10))){case 107:return xs(e,":",":-webkit-")+e;case 101:return xs(e,/(.+:)([^;!]+)(;|!.+)?/,"$1-webkit-"+(45===ws(e,14)?"inline-":"")+"box$3$1"+"-webkit-$2$3$1"+"-ms-$2box$3")+e}break;case 5936:switch(ws(e,t+11)){case 114:return Zs+e+Ys+xs(e,/[svh]\w+-[tblr]{2}/,"tb")+e;case 108:return Zs+e+Ys+xs(e,/[svh]\w+-[tblr]{2}/,"tb-rl")+e;case 45:return Zs+e+Ys+xs(e,/[svh]\w+-[tblr]{2}/,"lr")+e}return Zs+e+Ys+e+e}return e}var vu=[function(e,t,n,r){if(e.length>-1&&!e.return)switch(e.type){case eu:e.return=pu(e.value,e.length);break;case tu:return nu([Ps(e,{value:xs(e.value,"@","@-webkit-")})],r);case $s:if(e.length)return function(e,t){return e.map(t).join("")}(e.props,(function(t){switch(function(e,t){return(e=t.exec(e))?e[0]:e}(t,/(::plac\w+|:read-\w+)/)){case":read-only":case":read-write":return nu([Ps(e,{props:[xs(t,/:(read-\w+)/,":-moz-$1")]})],r);case"::placeholder":return nu([Ps(e,{props:[xs(t,/:(plac\w+)/,":-webkit-input-$1")]}),Ps(e,{props:[xs(t,/:(plac\w+)/,":-moz-$1")]}),Ps(e,{props:[xs(t,/:(plac\w+)/,"-ms-input-$1")]})],r)}return""}))}}],mu=function(e){var t=e.key;if("css"===t){var n=document.querySelectorAll("style[data-emotion]:not([data-s])");Array.prototype.forEach.call(n,(function(e){-1!==e.getAttribute("data-emotion").indexOf(" ")&&(document.head.appendChild(e),e.setAttribute("data-s",""))}))}var r=e.stylisPlugins||vu;var a,i,o={},s=[];a=e.container||document.head,Array.prototype.forEach.call(document.querySelectorAll('style[data-emotion^="'+t+' "]'),(function(e){for(var t=e.getAttribute("data-emotion").split(" "),n=1;n<t.length;n++)o[t[n]]=!0;s.push(e)}));var u,c,l=[ru,(c=function(e){u.insert(e)},function(e){e.root||(e=e.return)&&c(e)})],h=function(e){var t=Cs(e);return function(n,r,a,i){for(var o="",s=0;s<t;s++)o+=e[s](n,r,a,i)||"";return o}}([fu,du].concat(r,l));i=function(e,t,n,r){u=n,nu(au(e?e+"{"+t.styles+"}":t.styles),h),r&&(f.inserted[t.name]=!0)};var f={key:t,sheet:new vs({key:t,container:a,nonce:e.nonce,speedy:e.speedy,prepend:e.prepend,insertionPoint:e.insertionPoint}),nonce:e.nonce,inserted:o,registered:{},insert:i};return f.sheet.hydrate(s),f};var gu=function(e){for(var t,n=0,r=0,a=e.length;a>=4;++r,a-=4)t=1540483477*(65535&(t=255&e.charCodeAt(r)|(255&e.charCodeAt(++r))<<8|(255&e.charCodeAt(++r))<<16|(255&e.charCodeAt(++r))<<24))+(59797*(t>>>16)<<16),n=1540483477*(65535&(t^=t>>>24))+(59797*(t>>>16)<<16)^1540483477*(65535&n)+(59797*(n>>>16)<<16);switch(a){case 3:n^=(255&e.charCodeAt(r+2))<<16;case 2:n^=(255&e.charCodeAt(r+1))<<8;case 1:n=1540483477*(65535&(n^=255&e.charCodeAt(r)))+(59797*(n>>>16)<<16)}return(((n=1540483477*(65535&(n^=n>>>13))+(59797*(n>>>16)<<16))^n>>>15)>>>0).toString(36)},yu={animationIterationCount:1,borderImageOutset:1,borderImageSlice:1,borderImageWidth:1,boxFlex:1,boxFlexGroup:1,boxOrdinalGroup:1,columnCount:1,columns:1,flex:1,flexGrow:1,flexPositive:1,flexShrink:1,flexNegative:1,flexOrder:1,gridRow:1,gridRowEnd:1,gridRowSpan:1,gridRowStart:1,gridColumn:1,gridColumnEnd:1,gridColumnSpan:1,gridColumnStart:1,msGridRow:1,msGridRowSpan:1,msGridColumn:1,msGridColumnSpan:1,fontWeight:1,lineHeight:1,opacity:1,order:1,orphans:1,tabSize:1,widows:1,zIndex:1,zoom:1,WebkitLineClamp:1,fillOpacity:1,floodOpacity:1,stopOpacity:1,strokeDasharray:1,strokeDashoffset:1,strokeMiterlimit:1,strokeOpacity:1,strokeWidth:1},bu=/[A-Z]|^ms/g,xu=/_EMO_([^_]+?)_([^]*?)_EMO_/g,ku=function(e){return 45===e.charCodeAt(1)},wu=function(e){return null!=e&&"boolean"!==typeof e},_u=fs((function(e){return ku(e)?e:e.replace(bu,"-$&").toLowerCase()})),Su=function(e,t){switch(e){case"animation":case"animationName":if("string"===typeof t)return t.replace(xu,(function(e,t,n){return Tu={name:t,styles:n,next:Tu},t}))}return 1===yu[e]||ku(e)||"number"!==typeof t||0===t?t:t+"px"};function Cu(e,t,n){if(null==n)return"";if(void 0!==n.__emotion_styles)return n;switch(typeof n){case"boolean":return"";case"object":if(1===n.anim)return Tu={name:n.name,styles:n.styles,next:Tu},n.name;if(void 0!==n.styles){var r=n.next;if(void 0!==r)for(;void 0!==r;)Tu={name:r.name,styles:r.styles,next:Tu},r=r.next;return n.styles+";"}return function(e,t,n){var r="";if(Array.isArray(n))for(var a=0;a<n.length;a++)r+=Cu(e,t,n[a])+";";else for(var i in n){var o=n[i];if("object"!==typeof o)null!=t&&void 0!==t[o]?r+=i+"{"+t[o]+"}":wu(o)&&(r+=_u(i)+":"+Su(i,o)+";");else if(!Array.isArray(o)||"string"!==typeof o[0]||null!=t&&void 0!==t[o[0]]){var s=Cu(e,t,o);switch(i){case"animation":case"animationName":r+=_u(i)+":"+s+";";break;default:r+=i+"{"+s+"}"}}else for(var u=0;u<o.length;u++)wu(o[u])&&(r+=_u(i)+":"+Su(i,o[u])+";")}return r}(e,t,n);case"function":if(void 0!==e){var a=Tu,i=n(e);return Tu=a,Cu(e,t,i)}}if(null==t)return n;var o=t[n];return void 0!==o?o:n}var Tu,Eu=/label:\s*([^\s;\n{]+)\s*(;|$)/g;var Iu=function(e,t,n){if(1===e.length&&"object"===typeof e[0]&&null!==e[0]&&void 0!==e[0].styles)return e[0];var r=!0,a="";Tu=void 0;var i=e[0];null==i||void 0===i.raw?(r=!1,a+=Cu(n,t,i)):a+=i[0];for(var o=1;o<e.length;o++)a+=Cu(n,t,e[o]),r&&(a+=i[o]);Eu.lastIndex=0;for(var s,u="";null!==(s=Eu.exec(a));)u+="-"+s[1];return{name:gu(a)+u,styles:a,next:Tu}},Au=!!o.useInsertionEffect&&o.useInsertionEffect,Mu=Au||function(e){return e()},Nu=(Au||i.useLayoutEffect,(0,i.createContext)("undefined"!==typeof HTMLElement?mu({key:"css"}):null));Nu.Provider;var Ru=function(e){return(0,i.forwardRef)((function(t,n){var r=(0,i.useContext)(Nu);return e(t,r,n)}))},Du=(0,i.createContext)({});function Pu(e,t,n){var r="";return n.split(" ").forEach((function(n){void 0!==e[n]?t.push(e[n]+";"):r+=n+" "})),r}var Ou=function(e,t,n){var r=e.key+"-"+t.name;!1===n&&void 0===e.registered[r]&&(e.registered[r]=t.styles)},Lu=function(e,t,n){Ou(e,t,n);var r=e.key+"-"+t.name;if(void 0===e.inserted[t.name]){var a=t;do{e.insert(t===a?"."+r:"",a,e.sheet,!0);a=a.next}while(void 0!==a)}},Fu=ps,zu=function(e){return"theme"!==e},Bu=function(e){return"string"===typeof e&&e.charCodeAt(0)>96?Fu:zu},Uu=function(e,t,n){var r;if(t){var a=t.shouldForwardProp;r=e.__emotion_forwardProp&&a?function(t){return e.__emotion_forwardProp(t)&&a(t)}:a}return"function"!==typeof r&&n&&(r=e.__emotion_forwardProp),r},Vu=function(e){var t=e.cache,n=e.serialized,r=e.isStringTag;Ou(t,n,r);Mu((function(){return Lu(t,n,r)}));return null},Wu=function e(t,n){var r,a,o=t.__emotion_real===t,s=o&&t.__emotion_base||t;void 0!==n&&(r=n.label,a=n.target);var u=Uu(t,n,o),c=u||Bu(s),l=!c("as");return function(){var h=arguments,f=o&&void 0!==t.__emotion_styles?t.__emotion_styles.slice(0):[];if(void 0!==r&&f.push("label:"+r+";"),null==h[0]||void 0===h[0].raw)f.push.apply(f,h);else{0,f.push(h[0][0]);for(var d=h.length,p=1;p<d;p++)f.push(h[p],h[0][p])}var v=Ru((function(e,t,n){var r=l&&e.as||s,o="",h=[],d=e;if(null==e.theme){for(var p in d={},e)d[p]=e[p];d.theme=(0,i.useContext)(Du)}"string"===typeof e.className?o=Pu(t.registered,h,e.className):null!=e.className&&(o=e.className+" ");var v=Iu(f.concat(h),t.registered,d);o+=t.key+"-"+v.name,void 0!==a&&(o+=" "+a);var m=l&&void 0===u?Bu(r):c,g={};for(var y in e)l&&"as"===y||m(y)&&(g[y]=e[y]);return g.className=o,g.ref=n,(0,i.createElement)(i.Fragment,null,(0,i.createElement)(Vu,{cache:t,serialized:v,isStringTag:"string"===typeof r}),(0,i.createElement)(r,g))}));return v.displayName=void 0!==r?r:"Styled("+("string"===typeof s?s:s.displayName||s.name||"Component")+")",v.defaultProps=t.defaultProps,v.__emotion_real=v,v.__emotion_base=s,v.__emotion_styles=f,v.__emotion_forwardProp=u,Object.defineProperty(v,"toString",{value:function(){return"."+a}}),v.withComponent=function(t,r){return e(t,He({},n,r,{shouldForwardProp:Uu(v,r,!0)})).apply(void 0,f)},v}},Gu=Wu.bind();["a","abbr","address","area","article","aside","audio","b","base","bdi","bdo","big","blockquote","body","br","button","canvas","caption","cite","code","col","colgroup","data","datalist","dd","del","details","dfn","dialog","div","dl","dt","em","embed","fieldset","figcaption","figure","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","iframe","img","input","ins","kbd","keygen","label","legend","li","link","main","map","mark","marquee","menu","menuitem","meta","meter","nav","noscript","object","ol","optgroup","option","output","p","param","picture","pre","progress","q","rp","rt","ruby","s","samp","script","section","select","small","source","span","strong","style","sub","summary","sup","table","tbody","td","textarea","tfoot","th","thead","time","title","tr","track","u","ul","var","video","wbr","circle","clipPath","defs","ellipse","foreignObject","g","image","line","linearGradient","mask","path","pattern","polygon","polyline","radialGradient","rect","stop","svg","text","tspan"].forEach((function(e){Gu[e]=Gu(e)}));var ju=Gu;function qu(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return Iu(t)}var Hu,Xu,Ku,Yu=function(e){if(Number.isInteger(2*e))return 4*e;var t=Math.floor(e),n=e-t;return 4*(n<.75&&n>.25?t+.5:Math.round(e))},Qu=function(e){return"number"===typeof e[1]},Zu=["mt","mb","ml","mr","my","mx"],Ju=function(e){return Zu.reduce((function(t,n){var r;return us(us({},t),((r={})[n]=e[n],r))}),{})},$u=function(e){var t=e.mx,n=e.my,r=e.mt,a=void 0===r?n:r,i=e.mb,o=void 0===i?n:i,s=e.ml,u=void 0===s?t:s,c=e.mr,l=void 0===c?t:c,h=Object.entries({top:a,bottom:o,left:u,right:l});return qu(Hu||(Hu=hs(["\n    ","\n  "],["\n    ","\n  "])),h.filter(Qu).map((function(e){var t=e[0],n=e[1];return"margin-".concat(t,": ").concat(Yu(n),"px;")})).join(""))},ec=function(e){return qu(Ku||(Ku=hs(["\n  ",";\n  ",";\n"],["\n  ",";\n  ",";\n"])),$u(e),function(e){var t=e.px,n=e.py,r=e.pt,a=void 0===r?n:r,i=e.pb,o=void 0===i?n:i,s=e.pl,u=void 0===s?t:s,c=e.pr,l=void 0===c?t:c,h=Object.entries({top:a,bottom:o,left:u,right:l});return qu(Xu||(Xu=hs(["\n    ","\n  "],["\n    ","\n  "])),h.filter(Qu).map((function(e){var t=e[0],n=e[1];return"padding-".concat(t,": ").concat(Yu(n),"px;")})).join(""))}(e))};var tc,nc,rc,ac={"2xs":.625,xs:.75,sm:.875,base:1,lg:1.125,xl:1.25,"2xl":1.5,"3xl":1.75,"4xl":2,"5xl":2.5,"6xl":3,"7xl":3.5,"8xl":4},ic={extraBold:800,bold:700,regular:400},oc=ju.p(nc||(nc=hs(["\n  ",";\n  line-height: 1.5;\n"],["\n  ",";\n  line-height: 1.5;\n"])),(function(e){return qu(tc||(tc=hs(["\n    font-size: ",";\n    font-weight: ",";\n    color: ",";\n    text-align: ",";\n    ",";\n  "],["\n    font-size: ",";\n    font-weight: ",";\n    color: ",";\n    text-align: ",";\n    ",";\n  "])),void 0!==e.size?"".concat("string"===typeof e.size?ac[e.size]:e.size,"rem"):"",e.weight&&ic[e.weight],e.color,e.textAlign,ec(e))})),sc=ju.svg(rc||(rc=hs(["\n  ","\n"],["\n  ","\n"])),$u),uc=i.memo((function(e){var t=e.size,n=void 0===t?18:t,r=e.fillColor,a=void 0===r?"#9DAAB7":r,i=e.suffixForId,o=cs(e,["size","fillColor","suffixForId"]),s=null!==i&&void 0!==i?i:String(Math.random().toString(36).slice(2,11));return(0,Wt.jsxs)(sc,us({},Ju(o),o,{width:n,height:n,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 32 32"},{children:[(0,Wt.jsx)("defs",{children:(0,Wt.jsx)("path",{d:"M26.227.002l.148.015a1.416 1.416 0 011.147 1.031 1.414 1.414 0 01-.366 1.366L15.784 13.786l11.373 11.373a1.413 1.413 0 01-.858 2.406l-.142.007v-.003c-.375.001-.735-.148-1-.414l-11.372-11.37-11.37 11.372a1.41 1.41 0 01-.86.407l-.14.006a1.414 1.414 0 01-1-2.414l11.37-11.371L.415 2.417a1.414 1.414 0 011-2.414l.136.007c.315.03.623.166.864.407l11.369 11.369L25.156.414a1.414 1.414 0 011.071-.412z",id:"close_svg__a__".concat(s)})}),(0,Wt.jsxs)("g",us({transform:"translate(2 2)",fill:"none",fillRule:"evenodd"},{children:[(0,Wt.jsx)("mask",us({id:"close_svg__b__".concat(s),fill:"#fff"},{children:(0,Wt.jsx)("use",{xlinkHref:"#close_svg__a__".concat(s)})})),(0,Wt.jsx)("g",us({mask:"url(#close_svg__b__".concat(s,")")},{children:(0,Wt.jsx)("path",{fill:a,d:"M-2-2h32v32H-2z"})}))]}))]}))})),cc=i.memo((function(e){var t=e.size,n=void 0===t?18:t,r=e.fillColor,a=void 0===r?"#9DAAB7":r,i=e.suffixForId,o=cs(e,["size","fillColor","suffixForId"]),s=null!==i&&void 0!==i?i:String(Math.random().toString(36).slice(2,11));return(0,Wt.jsxs)(sc,us({},Ju(o),o,{width:n,height:n,xmlns:"http://www.w3.org/2000/svg",xmlnsXlink:"http://www.w3.org/1999/xlink",viewBox:"0 0 32 32"},{children:[(0,Wt.jsx)("defs",{children:(0,Wt.jsx)("path",{d:"M25.888 6.288a14.132 14.132 0 01-1.766 17.842 14.1 14.1 0 01-10 4.135A14.132 14.132 0 1125.888 6.288zm-4.91 2.705a1.414 1.414 0 00-2 0L12.39 15.58l-3.17-2.89a1.414 1.414 0 10-1.905 2.09l4.167 3.8a.609.609 0 00.04.033l.035.03c.026.021.053.041.082.06l.028.02a.966.966 0 00.085.05l.048.026a.912.912 0 00.08.036l.034.015a1.343 1.343 0 00.337.087l.042.003.092.005.037.002.012.001c.376.001.737-.147 1.002-.413l7.541-7.542a1.414 1.414 0 000-2z",id:"check_circle_fill_svg__a__".concat(s)})}),(0,Wt.jsxs)("g",us({transform:"translate(2 2)",fill:"none",fillRule:"evenodd"},{children:[(0,Wt.jsx)("mask",us({id:"check_circle_fill_svg__b__".concat(s),fill:"#fff"},{children:(0,Wt.jsx)("use",{xlinkHref:"#check_circle_fill_svg__a__".concat(s)})})),(0,Wt.jsx)("g",us({mask:"url(#check_circle_fill_svg__b__".concat(s,")")},{children:(0,Wt.jsx)("path",{fill:a,d:"M-2-2h32v32H-2z"})}))]}))]}))})),lc="#eff8eb",hc="#67c23a",fc="#f7d7de",dc="#d83a5e",pc="#fff1cd",vc="#ffba00",mc="#ebf6fe",gc="#8bc9fe",yc="#40a6fd",bc=hc,xc=dc,kc=vc,wc="#f7f7f7",_c="#e1e1e1",Sc="#b5b5b5";function Cc(e,t){if(void 0===e.inserted[t.name])return e.insert("",t,e.sheet,!0)}function Tc(e,t,n){var r=[],a=Pu(e,r,n);return r.length<2?n:a+t(r)}var Ec=function e(t){for(var n="",r=0;r<t.length;r++){var a=t[r];if(null!=a){var i=void 0;switch(typeof a){case"boolean":break;case"object":if(Array.isArray(a))i=e(a);else for(var o in i="",a)a[o]&&o&&(i&&(i+=" "),i+=o);break;default:i=a}i&&(n&&(n+=" "),n+=i)}}return n},Ic=function(e){var t=mu(e);t.sheet.speedy=function(e){this.isSpeedy=e},t.compat=!0;var n=function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=Iu(n,t.registered,void 0);return Lu(t,a,!1),t.key+"-"+a.name};return{css:n,cx:function(){for(var e=arguments.length,r=new Array(e),a=0;a<e;a++)r[a]=arguments[a];return Tc(t.registered,n,Ec(r))},injectGlobal:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=Iu(n,t.registered);Cc(t,a)},keyframes:function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var a=Iu(n,t.registered),i="animation-"+a.name;return Cc(t,{name:a.name,styles:"@keyframes "+i+"{"+a.styles+"}"}),i},hydrate:function(e){e.forEach((function(e){t.inserted[e]=!0}))},flush:function(){t.registered={},t.inserted={},t.sheet.flush()},sheet:t.sheet,cache:t,getRegisteredStyles:Pu.bind(null,t.registered),merge:Tc.bind(null,t.registered,n)}},Ac=Ic({key:"css"}),Mc=(Ac.flush,Ac.hydrate,Ac.cx,Ac.merge,Ac.getRegisteredStyles,Ac.injectGlobal,Ac.keyframes,Ac.css),Nc=(Ac.sheet,Ac.cache,function(){function e(e){this.setToastItems=function(){},e&&(this.setToastItems=e)}return e.prototype.addToastItem=function(e){var t=e.type,n=e.message,r=e.role;this.setToastItems((function(e){return ls([{id:"_"+String(Math.random().toString(36).slice(2,11)),type:t,message:n,role:r}],e,!0)}))},e.prototype.removeToastItem=function(e){this.setToastItems((function(t){return t.filter((function(t){return t.id!==e}))}))},e.prototype.success=function(e,t){void 0===t&&(t="status"),this.addToastItem({type:"success",message:e,role:t})},e.prototype.info=function(e,t){void 0===t&&(t="status"),this.addToastItem({type:"info",message:e,role:t})},e.prototype.danger=function(e,t){void 0===t&&(t="alert"),this.addToastItem({type:"danger",message:e,role:t})},e.prototype.warning=function(e,t){void 0===t&&(t="alert"),this.addToastItem({type:"warning",message:e,role:t})},e.prototype.white=function(e,t){void 0===t&&(t="status"),this.addToastItem({type:"white",message:e,role:t})},e}());var Rc,Dc,Pc,Oc,Lc,Fc=350,zc=function(e){var t=e.toastItem,n=e.onRemoveToastItem,r=e.onEmitElementHeight,a=e.offsetY,o=e.duration,s=e.position,u=(0,i.useMemo)((function(){return o+Fc}),[o]),c=(0,i.useMemo)((function(){return"success"===(e=t.type)?{borderColor:bc,backgroundColor:lc,textColor:bc,iconColor:bc}:"info"===e?{borderColor:gc,backgroundColor:mc,textColor:yc,iconColor:yc}:"danger"===e?{borderColor:xc,backgroundColor:fc,textColor:xc,iconColor:xc}:"warning"===e?{borderColor:kc,backgroundColor:pc,textColor:kc,iconColor:kc}:{borderColor:_c,backgroundColor:wc,textColor:"#222222",iconColor:Sc};var e}),[t]),l=(0,i.useRef)(null),h=function(e){l.current&&(l.current.style.opacity="".concat(e))};return(0,i.useEffect)((function(){h(1);var e=setTimeout((function(){n(t.id)}),u),r=setTimeout((function(){h(0)}),u-Fc);return function(){clearTimeout(e),clearTimeout(r)}}),[t,n,u]),(0,i.useEffect)((function(){l.current&&r(t.id,l.current.clientHeight)}),[t,r]),(0,Wt.jsxs)(Bc,us({ref:l,role:t.role,className:Mc(Rc||(Rc=hs(["\n        position: absolute;\n        top: ",";\n        bottom: ",";\n        left: 50%;\n        transform: translate(-50%, ","px);\n        opacity: 0;\n        transition: transform ","ms, opacity ","ms;\n        border-color: ",";\n        background-color: ",";\n      "],["\n        position: absolute;\n        top: ",";\n        bottom: ",";\n        left: 50%;\n        transform: translate(-50%, ","px);\n        opacity: 0;\n        transition: transform ","ms, opacity ","ms;\n        border-color: ",";\n        background-color: ",";\n      "])),"top"===s&&0,"bottom"===s&&0,"top"===s?a:-a,Fc,Fc,c.borderColor,c.backgroundColor)},{children:[(0,Wt.jsx)(cc,{size:28,fillColor:c.iconColor}),(0,Wt.jsx)(Uc,us({color:c.textColor},{children:t.message})),(0,Wt.jsx)(Vc,us({onClick:function(){return n(t.id)}},{children:(0,Wt.jsx)(uc,{size:18,fillColor:c.iconColor})}))]}))},Bc=ju.div(Dc||(Dc=hs(["\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n\n  width: 37.5rem;\n  max-width: 100%;\n  padding: ","px;\n  box-sizing: border-box;\n\n  border-radius: 4px;\n  border-width: 1px;\n  border-style: solid;\n\n  pointer-events: auto;\n  box-shadow: 0 2px 6px 0 rgba(209, 209, 209, 0.3);\n"],["\n  display: flex;\n  justify-content: space-between;\n  align-items: flex-start;\n\n  width: 37.5rem;\n  max-width: 100%;\n  padding: ","px;\n  box-sizing: border-box;\n\n  border-radius: 4px;\n  border-width: 1px;\n  border-style: solid;\n\n  pointer-events: auto;\n  box-shadow: 0 2px 6px 0 rgba(209, 209, 209, 0.3);\n"])),Yu(4)),Uc=ju((function(e){var t=e.tag,n=void 0===t?"p":t,r=cs(e,["tag"]);return(0,Wt.jsx)(oc,us({as:n},r,{children:r.children}))}))(Pc||(Pc=hs(["\n  width: 100%;\n  min-height: ","px;\n  display: flex;\n  align-items: center;\n  margin: 0;\n  padding: 0 ","px;\n"],["\n  width: 100%;\n  min-height: ","px;\n  display: flex;\n  align-items: center;\n  margin: 0;\n  padding: 0 ","px;\n"])),28,Yu(2)),Vc=ju.button(Oc||(Oc=hs(["\n  border: none;\n  background: none;\n\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  cursor: pointer;\n\n  height: ","px;\n  padding: 0;\n"],["\n  border: none;\n  background: none;\n\n  display: flex;\n  justify-content: center;\n  align-items: center;\n  cursor: pointer;\n\n  height: ","px;\n  padding: 0;\n"])),28),Wc=new Nc(null),Gc=function(e){var t=e.duration,n=void 0===t?3e3:t,r=e.zIndex,a=void 0===r?1300:r,o=e.gap,s=void 0===o?8:o,u=e.position,c=void 0===u?"top":u,l=cs(e,["duration","zIndex","gap","position"]),h=(0,i.useState)([]),f=h[0],d=h[1],p=(0,i.useState)([]),v=p[0],m=p[1];(0,i.useEffect)((function(){Wc=new Nc(d)}),[]);var g=(0,i.useCallback)((function(e){Wc.removeToastItem(e),y(e)}),[]),y=function(e){m((function(t){return t.filter((function(t){return t.id!==e}))}))},b=(0,i.useCallback)((function(e,t){m((function(n){return ls([{id:e,height:t}],n,!0)}))}),[]),x=function(e){return v.slice(0,e).reduce((function(e,t){return e+t.height+s}),0)};return(0,Wt.jsx)(jc,us({zIndex:a},Ju(l),{children:f.map((function(e,t){return(0,Wt.jsx)(zc,{toastItem:e,onRemoveToastItem:g,onEmitElementHeight:b,offsetY:x(t),duration:n,position:c},e.id)}))}))},jc=ju.div(Lc||(Lc=hs(["\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  ",";\n  z-index: ",";\n  pointer-events: none;\n"],["\n  position: fixed;\n  top: 0;\n  bottom: 0;\n  left: 0;\n  right: 0;\n  ",";\n  z-index: ",";\n  pointer-events: none;\n"])),$u,(function(e){return e.zIndex})),qc=["What is your first reaction to the work?","What does it make you feel or think like that?","What is it made of?","Why has the artist chosen those materials?","Does the size of the work affect your experience?","Where is the artist from and where did they live?","How has this influenced them?","What do you think the work is about?","Why don't you take a photograph of this list, so you can refer to it when you look at the art?"];var Hc,Xc,Kc,Yc,Qc=function(){var e=f((0,i.useState)(!1),2),t=e[0],n=e[1],r=f((0,i.useState)(0),2),a=r[0],o=r[1],s=f((0,i.useState)(!1),2),u=s[0],c=s[1];function l(){return l=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=window.speechSynthesis,(r=new SpeechSynthesisUtterance(t)).pitch=1,r.rate=1,n.speak(r),r.addEventListener("end",(function(){console.log("61"),c(!0)}));case 6:case"end":return e.stop()}}),e)}))),l.apply(this,arguments)}(0,i.useEffect)((function(){if(t&&a<qc.length&&(!function(e){l.apply(this,arguments)}(qc[a]),_()),a===qc.length){var e=setTimeout((function(){n(!1),o(0),c(!1)}),1e4);return function(){return clearTimeout(e)}}}),[a,t]);var h=(0,i.useRef)(null),d=f((0,i.useState)(!1),2),p=d[0],v=d[1],m=f(qe(),2),g=m[0],y=m[1];function b(){return b=ns(es().mark((function e(){var t,n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==h.current){e.next=2;break}return e.abrupt("return");case 2:return(t=h.current).width=g,t.height=y,n={audio:!1,video:{facingMode:"user"}},e.next=8,navigator.mediaDevices.getUserMedia(n);case 8:return r=e.sent,t.srcObject=r,e.next=12,new Promise((function(e){t.onloadedmetadata=function(){e(t)}}));case 12:t.play(),t.addEventListener("canplay",(function(){t.play()}),!1),v(!0);case 15:case"end":return e.stop()}}),e)}))),b.apply(this,arguments)}(0,i.useEffect)((function(){h&&h.current&&!p&&g&&y&&function(){b.apply(this,arguments)}()}),[p,h,g,y]);var x=(0,ss.x6)(),k=x.transcript,w=x.listening,_=x.resetTranscript;return x.browserSupportsSpeechRecognition,(0,i.useEffect)((function(){ss.ZP.startListening();var e=setTimeout((function(){ss.ZP.stopListening()}),100);return function(){return clearTimeout(e)}}),[]),(0,i.useEffect)((function(){u&&ss.ZP.startListening({continuous:!0})}),[u]),(0,i.useEffect)((function(){if(u&&k&&k.length>3){var e=setTimeout((function(){c(!1),o((function(e){return e+1})),ss.ZP.stopListening()}),2e3);return function(){return clearTimeout(e)}}}),[w,k]),(0,i.useEffect)((function(){if(0===k.length&&t&&a<qc.length){var e=setTimeout((function(){Wc.info("Speak out your response!")}),5500);return function(){return clearTimeout(e)}}}),[k,t,a]),(0,Wt.jsxs)(rs,{onClick:function(){return n(!0)},children:[(0,Wt.jsx)(os,{ref:h}),(0,Wt.jsxs)(as,{children:[" ",t?a<qc.length?qc[a]:"The End":"CLICK TO START"]}),(0,Wt.jsx)(is,{children:u&&k||""}),(0,Wt.jsx)(Gc,{duration:5e3})]})},Zc=je.div(Hc||(Hc=Et(["\n  ",";\n  flex-direction: column;\n  ",";\n  background: linear-gradient(#249f8c 0%, #9d9013 100%);\n  font-family: Times New Roman;\n"])),Dt,Pt),Jc=Ee(Xc||(Xc=Et(["\n  outline: 0;\n  border: none;\n  border-radius: 0.3rem;\n  font-size: 1.5rem;\n  font-weight: 400;\n\n  width: ","px;\n  padding: 0.3rem 0.7rem;\n  color: white;\n"])),(function(e){var t=e.theme;return Math.min(.7*t.windowWidth,500)})),$c=je.input(Kc||(Kc=Et(["\n  ",";\n  background: transparent;\n  text-align: center;\n  border-bottom: 1px solid #fff;\n  transition: all 0.2s;\n  border-radius: 0;\n"])),Jc),el=je.div(Yc||(Yc=Et(["\n  color: white;\n  font-size: 1.2rem;\n  font-wieight: 400;\n  height: 1.4rem;\n  max-width: 100%;\n  ",";\n  text-align: center;\n"])),Dt);var tl,nl=function(){var e=f((0,i.useState)(""),2),t=e[0],n=e[1],r=f((0,i.useState)(["","","","","","","","","","","","","",""]),2),a=r[0],o=r[1],s=f((0,i.useState)(""),2),u=s[0],c=s[1];return(0,Wt.jsxs)(Zc,{children:[a.map((function(e,t){return(0,Wt.jsx)(el,{children:e},t)})),(0,Wt.jsx)($c,{placeholder:"Please type in English",value:u,onChange:function(e){var r=e.target.value;if(r.length>t.length){n((function(e){return e+r[r.length-1]}));var a=r[r.length-1];if(a.charCodeAt(0)<65||a.charCodeAt(0)>122)return c((function(e){return e+a})),void o((function(e){return Tt(e).map((function(e){return e+a}))}));var i=(a.charCodeAt(0)-65+1)%52+65;c((function(e){return e+String.fromCharCode(i)})),o((function(e){return Tt(e).map((function(e,t){return e+String.fromCharCode((a.charCodeAt(0)-65+t+7)%52+65)}))}))}else n((function(e){return e.slice(0,-1)})),c((function(e){return e.slice(0,-1)})),o((function(e){return Tt(e).map((function(e){return e.slice(0,-1)}))}))}}),a.reverse().map((function(e,t){return(0,Wt.jsx)(el,{children:e},t)}))]})},rl=je.div(tl||(tl=Et(["\n  ",";\n  ",";\n"])),Dt,Pt);function al(e,t){var n="undefined"!==typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=l(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,s=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return o=e.done,e},e:function(e){s=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(s)throw i}}}}var il=function(){function e(t,n){$n(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return Jn(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),ol=function(){function e(){$n(this,e)}return Jn(e,[{key:"decComplexRef",value:function(e){}},{key:"time",value:function(e){return sl("time")}},{key:"read",value:function(e){return sl("read")}},{key:"readSync",value:function(e){return sl("readSync")}},{key:"numDataIds",value:function(){return sl("numDataIds")}},{key:"disposeData",value:function(e){return sl("disposeData")}},{key:"write",value:function(e,t,n){return sl("write")}},{key:"move",value:function(e,t,n,r){return sl("move")}},{key:"memory",value:function(){return sl("memory")}},{key:"floatPrecision",value:function(){return sl("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"batchMatMul",value:function(e,t,n,r){return sl("batchMatMul")}},{key:"fusedBatchMatMul",value:function(e){e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights;return sl("fusedBatchMatMul")}},{key:"slice",value:function(e,t,n){return sl("slice")}},{key:"stridedSlice",value:function(e,t,n,r){return sl("stridedSlice")}},{key:"unstack",value:function(e,t){return sl("unstack")}},{key:"reverse",value:function(e,t){return sl("reverse")}},{key:"concat",value:function(e,t){return sl("concat")}},{key:"neg",value:function(e){return sl("neg")}},{key:"add",value:function(e,t){return sl("add")}},{key:"addN",value:function(e){return sl("addN")}},{key:"subtract",value:function(e,t){return sl("subtract")}},{key:"multiply",value:function(e,t){return sl("multiply")}},{key:"realDivide",value:function(e,t){return sl("realDivide")}},{key:"floorDiv",value:function(e,t){return sl("floorDiv")}},{key:"sum",value:function(e,t){return sl("sum")}},{key:"prod",value:function(e,t){return sl("prod")}},{key:"unsortedSegmentSum",value:function(e,t,n){return sl("unsortedSegmentSum")}},{key:"argMin",value:function(e,t){return sl("argMin")}},{key:"argMax",value:function(e,t){return sl("argMax")}},{key:"equal",value:function(e,t){return sl("equal")}},{key:"notEqual",value:function(e,t){return sl("notEqual")}},{key:"less",value:function(e,t){return sl("less")}},{key:"lessEqual",value:function(e,t){return sl("lessEqual")}},{key:"greater",value:function(e,t){return sl("greater")}},{key:"greaterEqual",value:function(e,t){return sl("greaterEqual")}},{key:"logicalNot",value:function(e){return sl("logicalNot")}},{key:"logicalAnd",value:function(e,t){return sl("logicalAnd")}},{key:"logicalOr",value:function(e,t){return sl("logicalOr")}},{key:"where",value:function(e){return sl("where")}},{key:"select",value:function(e,t,n){return sl("select")}},{key:"topk",value:function(e,t,n){return sl("topk")}},{key:"min",value:function(e,t){return sl("min")}},{key:"minimum",value:function(e,t){return sl("minimum")}},{key:"mod",value:function(e,t){return sl("mod")}},{key:"max",value:function(e,t){return sl("max")}},{key:"maximum",value:function(e,t){return sl("maximum")}},{key:"all",value:function(e,t){return sl("all")}},{key:"any",value:function(e,t){return sl("any")}},{key:"squaredDifference",value:function(e,t){return sl("squaredDifference")}},{key:"ceil",value:function(e){return sl("ceil")}},{key:"floor",value:function(e){return sl("floor")}},{key:"round",value:function(e){return sl("round")}},{key:"sign",value:function(e){return sl("sign")}},{key:"isNaN",value:function(e){return sl("isNaN")}},{key:"isInf",value:function(e){return sl("isInf")}},{key:"isFinite",value:function(e){return sl("isFinite")}},{key:"pow",value:function(e,t){return sl("pow")}},{key:"exp",value:function(e){return sl("exp")}},{key:"expm1",value:function(e){return sl("expm1")}},{key:"softmax",value:function(e,t){return sl("softmax")}},{key:"log",value:function(e){return sl("log")}},{key:"log1p",value:function(e){return sl("log1p")}},{key:"sqrt",value:function(e){return sl("sqrt")}},{key:"rsqrt",value:function(e){return sl("rsqrt")}},{key:"square",value:function(e){return sl("square")}},{key:"reciprocal",value:function(e){return sl("reciprocal")}},{key:"relu",value:function(e){return sl("relu")}},{key:"relu6",value:function(e){return sl("relu6")}},{key:"prelu",value:function(e,t){return sl("prelu")}},{key:"elu",value:function(e){return sl("elu")}},{key:"eluDer",value:function(e,t){return sl("eluDer")}},{key:"selu",value:function(e){return sl("selu")}},{key:"int",value:function(e){return sl("int")}},{key:"clip",value:function(e,t,n){return sl("clip")}},{key:"abs",value:function(e){return sl("abs")}},{key:"complexAbs",value:function(e){return sl("complexAbs")}},{key:"sigmoid",value:function(e){return sl("sigmoid")}},{key:"softplus",value:function(e){return sl("softplus")}},{key:"sin",value:function(e){return sl("sin")}},{key:"cos",value:function(e){return sl("cos")}},{key:"tan",value:function(e){return sl("tan")}},{key:"asin",value:function(e){return sl("asin")}},{key:"acos",value:function(e){return sl("acos")}},{key:"atan",value:function(e){return sl("atan")}},{key:"atan2",value:function(e,t){return sl("atan2")}},{key:"sinh",value:function(e){return sl("sinh")}},{key:"cosh",value:function(e){return sl("cosh")}},{key:"tanh",value:function(e){return sl("tanh")}},{key:"asinh",value:function(e){return sl("asinh")}},{key:"acosh",value:function(e){return sl("acosh")}},{key:"atanh",value:function(e){return sl("atanh")}},{key:"erf",value:function(e){return sl("erf")}},{key:"step",value:function(e,t){return sl("step")}},{key:"fusedConv2d",value:function(e){e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights;return sl("fusedConv2d")}},{key:"conv2d",value:function(e,t,n){return sl("conv2d")}},{key:"conv2dDerInput",value:function(e,t,n){return sl("conv2dDerInput")}},{key:"conv2dDerFilter",value:function(e,t,n){return sl("conv2dDerFilter")}},{key:"fusedDepthwiseConv2D",value:function(e){e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights;return sl("fusedDepthwiseConv2D")}},{key:"depthwiseConv2D",value:function(e,t,n){return sl("depthwiseConv2D")}},{key:"depthwiseConv2DDerInput",value:function(e,t,n){return sl("depthwiseConv2DDerInput")}},{key:"depthwiseConv2DDerFilter",value:function(e,t,n){return sl("depthwiseConv2DDerFilter")}},{key:"conv3d",value:function(e,t,n){return sl("conv3d")}},{key:"conv3dDerInput",value:function(e,t,n){return sl("conv3dDerInput")}},{key:"conv3dDerFilter",value:function(e,t,n){return sl("conv3dDerFilter")}},{key:"maxPool",value:function(e,t){return sl("maxPool")}},{key:"maxPoolBackprop",value:function(e,t,n,r){return sl("maxPoolBackprop")}},{key:"avgPool",value:function(e,t){return sl("avgPool")}},{key:"avgPoolBackprop",value:function(e,t,n){return sl("avgPoolBackprop")}},{key:"avgPool3d",value:function(e,t){return sl("avgPool3d")}},{key:"avgPool3dBackprop",value:function(e,t,n){return sl("avgPool3dBackprop")}},{key:"maxPool3d",value:function(e,t){return sl("maxPool3d")}},{key:"maxPool3dBackprop",value:function(e,t,n,r){return sl("maxPool3dBackprop")}},{key:"reshape",value:function(e,t){return sl("reshape")}},{key:"cast",value:function(e,t){return sl("cast")}},{key:"tile",value:function(e,t){return sl("tile")}},{key:"pad",value:function(e,t,n){return sl("pad")}},{key:"transpose",value:function(e,t){return sl("transpose")}},{key:"gather",value:function(e,t,n){return sl("gather")}},{key:"gatherND",value:function(e,t){return sl("gatherND")}},{key:"scatterND",value:function(e,t,n){return sl("scatterND")}},{key:"batchToSpaceND",value:function(e,t,n){return sl("batchToSpaceND")}},{key:"spaceToBatchND",value:function(e,t,n){return sl("spaceToBatchND")}},{key:"resizeBilinear",value:function(e,t,n,r,a){return sl("resizeBilinear")}},{key:"resizeBilinearBackprop",value:function(e,t,n){return sl("resizeBilinearBackprop")}},{key:"resizeNearestNeighbor",value:function(e,t,n,r,a){return sl("resizeNearestNeighbor")}},{key:"resizeNearestNeighborBackprop",value:function(e,t,n){return sl("resizeNearestNeighborBackprop")}},{key:"batchNorm",value:function(e,t,n,r,a,i){return sl("batchNorm")}},{key:"localResponseNormalization4D",value:function(e,t,n,r,a){return sl("localResponseNormalization4D")}},{key:"LRNGrad",value:function(e,t,n,r,a,i,o){return sl("LRNGrad")}},{key:"multinomial",value:function(e,t,n,r){return sl("multinomial")}},{key:"oneHot",value:function(e,t,n,r){return sl("oneHot")}},{key:"cumsum",value:function(e,t,n,r){return sl("cumsum")}},{key:"nonMaxSuppression",value:function(e,t,n,r,a){return sl("nonMaxSuppression")}},{key:"fft",value:function(e){return sl("fft")}},{key:"ifft",value:function(e){return sl("ifft")}},{key:"complex",value:function(e,t){return sl("complex")}},{key:"real",value:function(e){return sl("real")}},{key:"imag",value:function(e){return sl("imag")}},{key:"cropAndResize",value:function(e,t,n,r,a,i){return sl("cropAndResize")}},{key:"depthToSpace",value:function(e,t,n){return sl("depthToSpace")}},{key:"split",value:function(e,t,n){return sl("split")}},{key:"sparseToDense",value:function(e,t,n,r){return sl("sparseToDense")}},{key:"diag",value:function(e){return sl("diag")}},{key:"fill",value:function(e,t,n){return sl("fill")}},{key:"onesLike",value:function(e){return sl("onesLike")}},{key:"zerosLike",value:function(e){return sl("zerosLike")}},{key:"linspace",value:function(e,t,n){return sl("linspace")}},{key:"dispose",value:function(){return sl("dispose")}}]),e}();function sl(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function ul(e){for(var t=e.length,n=0,r=0;t>0;)r=Math.random()*t|0,n=e[--t],e[t]=e[r],e[r]=n}function cl(e,t,n){return Math.max(e,Math.min(t,n))}function ll(e){return e%2===0?e:e+1}function hl(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function fl(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function dl(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";fl(gl(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function pl(e){fl(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function vl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||El(e)&&!n)for(var r=0;r<e.length;++r)vl(e[r],t,n);else t.push(e);return t}function ml(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function gl(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function yl(e){return e%1===0}function bl(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function xl(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function kl(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0;return new Promise((function(r,a){var i=0;!function o(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?a():setTimeout(o,s)}}()}))}function wl(e,t){var n=t.length;return e=null==e?t.map((function(e,t){return t})):[].concat(e),fl(e.every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)})),fl(e.every((function(e){return yl(e)})),(function(){return"All values in axis param must be integers but "+"got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function _l(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:wl(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function Sl(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function Cl(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function Tl(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function El(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function Il(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function Al(e){return"string"===typeof e||e instanceof String}function Ml(e){return"number"===typeof e}function Nl(e){return Array.isArray(e)?Nl(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":Ml(e)?"float32":Al(e)?"string":"boolean"===typeof e?"bool":"float32"}function Rl(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Dl(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function Pl(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Ol(e,t,n){var r=new Array;if(1===t.length)for(var a=t[0],i=0;i<a;i++)r[i]=n[e+i];else for(var o=t[0],s=t.slice(1),u=s.reduce((function(e,t){return e*t})),c=0;c<o;c++)r[c]=Ol(e+c*u,s,n);return r}function Ll(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length,"."));return Ol(0,e,t)}function Fl(e,t){for(var n=zl(e,t),r=0;r<n.length;r++)n[r]=1;return n}function zl(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function Bl(e){e.forEach((function(t){fl(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"].")}))}))}function Ul(e){return e&&e.then&&"function"===typeof e.then}var Vl="tfjsflags",Wl=function(){function e(t){$n(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return Jn(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(t,".")),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=2;break}return e.abrupt("return",this.flags[t]);case 2:return e.next=4,this.evaluateFlag(t);case 4:return this.flags[t]=e.sent,e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Ul(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!==typeof this.global&&"undefined"!==typeof this.global.location&&"undefined"!==typeof this.global.location.search){var t=function(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return Gl(t,r[0],r[1]),r.join("=")})),t}(this.global.location.search);if(Vl in t)t.tfjsflags.split(",").forEach((function(t){var n=f(t.split(":"),2),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if("".concat(+t)===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(r,a)}))}}}]),e}();function Gl(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function jl(){return Hl}var ql,Hl=null;function Xl(){if(null==ql){var e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof __webpack_require__.g)e=__webpack_require__.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}ql=e}return ql}function Kl(e,t){var n=function(){var e=Xl();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var Yl="Abs",Ql="Acos",Zl="Acosh",Jl="Add",$l="AddN",eh="All",th="Any",nh="ArgMax",rh="ArgMin",ah="Asin",ih="Asinh",oh="Atan",sh="Atanh",uh="Atan2",ch="AvgPool",lh="AvgPoolGrad",hh="AvgPool3D",fh="AvgPool3DGrad",dh="BatchMatMul",ph="BatchToSpaceND",vh="Cast",mh="Ceil",gh="ClipByValue",yh="Complex",bh="ComplexAbs",xh="Concat",kh="Conv2D",wh="Conv2DBackpropFilter",_h="Conv2DBackpropInput",Sh="Conv3D",Ch="Conv3DBackpropFilterV2",Th="Conv3DBackpropInputV2",Eh="Cos",Ih="Cosh",Ah="Cumsum",Mh="CropAndResize",Nh="DepthToSpace",Rh="DepthwiseConv2dNative",Dh="DepthwiseConv2dNativeBackpropFilter",Ph="DepthwiseConv2dNativeBackpropInput",Oh="Dilation2D",Lh="RealDiv",Fh="Elu",zh="EluGrad",Bh="Erf",Uh="Equal",Vh="Exp",Wh="ExpandDims",Gh="Expm1",jh="Fill",qh="FlipLeftRight",Hh="Floor",Xh="FloorDiv",Kh="FusedBatchNorm",Yh="GatherV2",Qh="Greater",Zh="GreaterEqual",Jh="Identity",$h="IFFT",ef="Imag",tf="IsFinite",nf="IsInf",rf="IsNan",af="LeakyRelu",of="Less",sf="LessEqual",uf="LinSpace",cf="Log",lf="Log1p",hf="LogicalAnd",ff="LogicalNot",df="LogicalOr",pf="LRN",vf="LRNGrad",mf="Max",gf="Maximum",yf="MaxPool",bf="MaxPoolGrad",xf="MaxPool3D",kf="MaxPool3DGrad",wf="Mean",_f="Min",Sf="Minimum",Cf="MirrorPad",Tf="Mod",Ef="Multinomial",If="Multiply",Af="Neg",Mf="NotEqual",Nf="NonMaxSuppressionV3",Rf="NonMaxSuppressionV4",Df="NonMaxSuppressionV5",Pf="OnesLike",Of="OneHot",Lf="Pack",Ff="PadV2",zf="Pow",Bf="Prelu",Uf="Prod",Vf="Range",Wf="Real",Gf="Reciprocal",jf="Relu",qf="Reshape",Hf="ResizeNearestNeighbor",Xf="ResizeNearestNeighborGrad",Kf="ResizeBilinear",Yf="ResizeBilinearGrad",Qf="Relu6",Zf="Reverse",Jf="Round",$f="Rsqrt",ed="Select",td="Selu",nd="Slice",rd="Sin",ad="Sinh",id="Sign",od="Sigmoid",sd="Softplus",ud="Sqrt",cd="Sum",ld="SpaceToBatchND",hd="SplitV",fd="Softmax",dd="SquaredDifference",pd="Square",vd="Sub",md="StridedSlice",gd="Tan",yd="Tanh",bd="Tile",xd="TopK",kd="Transpose",wd="Unique",_d="Unpack",Sd="UnsortedSegmentSum",Cd="ZerosLike",Td="Step",Ed="RotateWithOffset",Id="_FusedMatMul",Ad="FusedConv2D",Md="FusedDepthwiseConv2D",Nd=Kl("kernelRegistry",(function(){return new Map})),Rd=Kl("gradRegistry",(function(){return new Map}));function Dd(e){return Rd.get(e)}function Pd(e){for(var t=Nd.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=f(i,2),s=o[0],u=o[1];f(s.split("_"),1)[0]===e&&n.push(u)}return n}function Od(e){var t=e.kernelName,n=e.backendName,r=Fd(t,n);Nd.has(r)&&console.warn("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),Nd.set(r,e)}function Ld(e){var t=e.kernelName;Rd.has(t)&&jl().getBool("DEBUG")&&console.warn("Overriding the gradient for '".concat(t,"'")),Rd.set(t,e)}function Fd(e,t){return"".concat(t,"_").concat(e)}var zd=function(){function e(t,n){$n(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new Bd)}return Jn(e,[{key:"profileKernel",value:function(e,t,n){var r,a=this.backendTimer.time((function(){r=n()}));if(jl().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var i=function(t){var n=r[t];n.data().then((function(t){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(t,n.dtype,e)}))},o=0;o<r.length;o++)i(o);return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var Bd=function(){function e(){$n(this,e)}return Jn(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"===typeof r?xl("".concat(r,"ms"),9):r.error,s=xl(e,25),u=t.rank,c=t.size,l=xl(t.shape.toString(),14),h="";for(var f in a){var d=a[f];if(null!=d){var p=d.shape||t.shape,v=p.length;h+="".concat(f,": ").concat(v,"D ").concat(v>0?p:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(h,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();function Ud(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],h=!1,f=0;f<t.length;f++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),h=!0,a[s.id]=!0;break}if(h)break}}var d={};d[n.id]=!0;for(var p={},v=e.length-1;v>=0;v--)for(var m=e[v],g=m.inputs,y=0;y<m.outputs.length;y++)if(d[m.outputs[y].id]){for(var b in g)d[g[b].id]=!0,p[m.id]=!0;break}for(var x=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&p[w.id]){var _={};for(var S in w.inputs){var C=w.inputs[S];r[C.id]&&(_[S]=C)}var T=Object.assign({},w);T.inputs=_,T.outputs=w.outputs,x.push(T)}}return x}function Vd(e,t,n,r){for(var a=function(a){var i=t[a],o=[];if(i.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(i.kernelName,"."));var s=i.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(s),"."));var a=n((function(){return s[t]()}));if("float32"!==a.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(a.dtype,"'"));var o=i.inputs[t];if(!gl(a.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(a.shape,"', which does not match ")+"the shape of the input '".concat(o.shape,"'"));if(null==e[o.id])e[o.id]=a;else{var u=e[o.id];e[o.id]=r(u,a),u.dispose()}};for(var c in i.inputs)u(c)},i=t.length-1;i>=0;i--)a(i)}function Wd(e,t,n,r){var a=Pl(t),i=function(e,t,n,r){var a=ml(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?Hd(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,h=0;h<i;h++)o[h]=Math.max(o[h],Gd(u[l+h],0,n).length);return o}(e,t,n,a),o=t.length,s=qd(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function Gd(e,t,n){return xl(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ")+"".concat(parseFloat(e[1].toFixed(7)),"j"):Al(e)?"'".concat(e,"'"):"bool"===n?jd(e):parseFloat(e.toFixed(7)).toString(),t)}function jd(e){return 0===e?"false":"true"}function qd(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u){if("complex64"===n){var c=Hd(e);return[Gd(c[0],0,n)]}return"bool"===n?[jd(e[0])]:[e[0].toString()]}if(1===u){if(s>20){var l=3*o,h=Array.from(e.slice(0,l)),f=Array.from(e.slice((s-3)*o,s*o));return"complex64"===n&&(h=Hd(h),f=Hd(f)),["["+h.map((function(e,t){return Gd(e,a[t],n)})).join(", ")+", ..., "+f.map((function(e,t){return Gd(e,a[s-3+t],n)})).join(", ")+"]"]}var d="complex64"===n?Hd(e):Array.from(e);return["["+d.map((function(e,t){return Gd(e,a[t],n)})).join(", ")+"]"]}var p=t.slice(1),v=r.slice(1),m=r[0]*o,g=[];if(s>20){for(var y=0;y<3;y++){var b=y*m,x=b+m;g.push.apply(g,Tt(qd(e.slice(b,x),p,n,v,a,!1)))}g.push("...");for(var k=s-3;k<s;k++){var w=k*m,_=w+m;g.push.apply(g,Tt(qd(e.slice(w,_),p,n,v,a,k===s-1)))}}else for(var S=0;S<s;S++){var C=S*m,T=C+m;g.push.apply(g,Tt(qd(e.slice(C,T),p,n,v,a,S===s-1)))}var E=2===u?",":"";g[0]="["+g[0]+E;for(var I=1;I<g.length-1;I++)g[I]=" "+g[I]+E;for(var A=",\n",M=2;M<u;M++)A+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":A),g}function Hd(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}function Xd(e,t){return"string"===t?Qd(e):Kd([e],t)}function Kd(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=vl(e)),jl().getBool("DEBUG")&&function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function Yd(){return jl().platform.now()}function Qd(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",jl().platform.encode(e,t)}function Zd(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",jl().platform.decode(e,t)}var Jd=function(){function e(t,n,r){var a=this;if($n(this,e),this.dtype=n,this.shape=t.slice(),this.size=ml(t),null!=r){var i=r.length;fl(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||Cl(n,this.size),this.strides=Pl(t)}return Jn(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),fl(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return $d().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),$d=null,ep=null;var tp=function(){function e(t,n,r,a){$n(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=ml(t),this.strides=Pl(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Jn(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",ep.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return ep.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Ll(this.shape,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return Ll(this.shape,this.dataSync())}},{key:"data",value:function(){var e=ns(es().mark((function e(){var t,n;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=$d().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return Zd(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataSync",value:function(){this.throwIfDisposed();var e=$d().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return Zd(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,$d().read(this.dataId);case 3:if(t=e.sent,"string"!==this.dtype){e.next=8;break}return e.abrupt("return",t);case 8:return e.abrupt("return",new Uint8Array(t.buffer));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||($d().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return ep.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),ep.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.dataSync();return Wd(t,this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),ep.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),$d().makeVariable(this,e,t,n)}}]),e}();Object.defineProperty(tp,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}});var np,rp,ap,ip,op,sp=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i){var o;return $n(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return Jn(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!gl(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));$d().disposeTensor(this),this.dataId=e.dataId,$d().incRef(this,null)}},{key:"dispose",value:function(){$d().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(tp);Object.defineProperty(sp,Symbol.hasInstance,{value:function(e){return e instanceof tp&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(np||(np={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(rp||(rp={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(ap||(ap={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(ip||(ip={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(op||(op={}));var up={float32:ip,int32:rp,bool:ap,complex64:op};function cp(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return up[e][t]}function lp(e){return cp(e,"int32")}function hp(e,t){if(e.dtype===t.dtype)return[e,t];var n=cp(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function fp(e,t){return t.some((function(t){return t.id===e.id}))}function dp(e){var t=[];return pp(e,t,new Set),t}function pp(e,t,n){if(null!=e)if(e instanceof tp)t.push(e);else if(r=e,Array.isArray(r)||"object"===typeof r){var r,a=e;for(var i in a){var o=a[i];n.has(o)||(n.add(o),pp(o,t,n))}}}var vp=function(){function e(){$n(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return Jn(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),mp=function(){function e(t){$n(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new vp}return Jn(e,[{key:"ready",value:function(){var e=ns(es().mark((function e(){var t,n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=18;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=15;break}return e.next=14,this.setBackend(r);case 14:return e.abrupt("return");case 15:n++,e.next=6;break;case 18:throw new Error("Could not initialize any backends, all backend initializations failed.");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(console.warn("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=16;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=12;break}return e.next=9,r;case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=r;case 13:if(e.t0){e.next=16;break}return e.abrupt("return",!1);case 16:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new zd(this.backendInstance),e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;Pd(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;Pd(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof ol||"function"!==typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend ".concat(e," failed")),console.warn(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch(o){return console.warn("Initialization of backend ".concat(e," failed")),console.warn(o.stack||o.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(a){throw t(),a}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t="float32",n={x:e},r={dtype:t};return bp.runKernelFunc((function(n){return n.cast(e,t)}),n,null,vh,r)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n,r,a){return this.runKernelFunc(null,t,null,e,n,r,a)}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e,t,n,r,a,i,o){var s,u=this,c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var h,f=this.state.numBytes,d=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var p,v,m=function(e,t){var n=Fd(e,t);return Nd.get(n)}(r,this.backendName);if(null!=m)h=function(){var e=u.backend.numDataIds();p=m.kernelFunc({inputs:t,attrs:a,backend:u.backend});var n=Array.isArray(p)?p:[p];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){if(null!=e.rank)return e;var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)}));if(l){var h=u.getTensorsForGradient(r,t,s);if(null==h){null==o&&(o=[]);var f=s.filter((function(e,t){return o[t]}));h=(i||[]).slice().concat(f)}c=u.saveTensorsForBackwardMode(h)}return s};else{if(null==e)throw new Error("Error running ".concat(r,": Neither modular kernel nor forward func passed"));var g=function(e){l&&(c=e.map((function(e){return u.keep(u.clone(e))})))};h=function(){var t=u.backend.numDataIds();p=u.tidy((function(){return e(u.backend,g)}));var n=Array.isArray(p)?p:[p];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){u.ENV.getBool("DEBUG")||u.state.profiling?(v=u.profiler.profileKernel(r,t,(function(){return h()})),u.ENV.getBool("DEBUG")&&u.profiler.logKernelProfile(v),s=v.outputs):s=h()})),l&&this.addTapeNode(r,t,s,n,c,a),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return null!=t[e]?t[e].shape:null})),outputShapes:s.map((function(e){return e.shape})),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(p)?s:s[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=Dd(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(fl(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return null}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&Al(e[0])&&(a=e.map((function(e){return Qd(e)})));var i=r.write(a,t,n),o=new tp(t,n,i,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=function(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a=new tp(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,r),a}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new sp(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"incRef",value:function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*Il(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof sp||this.track(e)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):(t.backend.decComplexRef(e.dataId),this.state.tensorInfo.get(e.dataId).refCount--)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=6,t();case 6:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Tt(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=al(this.state.activeProfile.kernels),e.prev=12,a.s();case 14:if((i=a.n()).done){e.next=24;break}return o=i.value,e.next=18,o.kernelTimeMs;case 18:return o.kernelTimeMs=e.sent,e.next=21,o.extraInfo;case 21:o.extraInfo=e.sent;case 22:e.next=14;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(12),a.e(e.t0);case 29:return e.prev=29,a.f(),e.finish(29);case 32:return e.abrupt("return",this.state.activeProfile);case 33:case"end":return e.stop()}}),e,this,[[12,26,29,32]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=Dd(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=zl(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=dp(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(fl(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));fl(i instanceof tp,(function(){return"The result y returned by f() must be a tensor."}));var o=Ud(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?gp(i.shape):n,Vd(e,o,(function(e){return r.tidy(e)}),xp);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=al(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch(r){n.e(r)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return fl(Rl(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;fl(r.every((function(e){return e instanceof tp})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};return r.forEach((function(e,t){o[t]=e})),t.runKernelFunc((function(t,n){return fl((i=e.apply(void 0,[].concat(r,[n]))).value instanceof tp,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),fl(Rl(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value}),o,(function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];fl(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),fl(a.every((function(e){return e instanceof tp})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"time",value:function(){var e=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=Yd(),e.next=3,this.backend.time(t);case 3:return(r=e.sent).wallMs=Yd()-n,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new vp,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function gp(e){var t=Fl(ml(e),"float32");return bp.makeTensor(t,e,"float32")}function yp(){var e=Xl();if(null==e._tfengine){var t=new Wl(e);e._tfengine=new mp(t)}return function(e){Hl=e}(e._tfengine.ENV),$d=function(){return e._tfengine},e._tfengine}mp.nextTensorId=0,mp.nextVariableId=0;var bp=yp();function xp(e,t){var n={a:e,b:t};return bp.runKernel(Jl,n)}function kp(){if("undefined"!==typeof navigator&&null!=navigator){var e=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(e.substr(0,4))}return!1}function wp(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}var _p=jl();function Sp(e,t){var n=e;if(El(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||El(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&jl().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Cp(e,r,[]),r}function Cp(e,t,n){if(n=n||[],Array.isArray(e)||El(e)){fl(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements")})),fl(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)Cp(e[a],r,n.concat(a))}else fl(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements")}))}function Tp(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function Ep(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof tp)return Tp(r,e.dtype,t,n),e;var a=Nl(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),Tp(r,a,t,n),null==e||!El(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Sp(e,a);El(e)||Array.isArray(e)||(e=[e]);var s=!0,u="string"!==a?Kd(e,a):vl(e,[],s);return bp.makeTensor(u,o,a)}function Ip(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=e;return a.map((function(e,a){return Ep(e,"".concat(t,"[").concat(a,"]"),n,r)}))}_p.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),_p.registerFlag("IS_BROWSER",(function(){return wp()})),_p.registerFlag("IS_NODE",(function(){return"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node})),_p.registerFlag("IS_CHROME",(function(){return"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),_p.registerFlag("PROD",(function(){return!1})),_p.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return _p.getBool("DEBUG")})),_p.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),_p.registerFlag("IS_TEST",(function(){return!1})),_p.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0}));function Ap(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var a=function(){bp.startScope(n);try{var e=r.apply(void 0,arguments);return Ul(e)&&console.error("Cannot return a Promise inside of tidy."),bp.endScope(e),e}catch(t){throw bp.endScope(null),t}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var Mp=Ap({complex_:function(e,t){var n=Ep(e,"real","complex"),r=Ep(t,"imag","complex");dl(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:n,imag:r};return bp.runKernel(yh,a)}});function Np(e,t,n,r){if(null==r&&(r=Nl(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!El(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Bl(t);var a=ml(t),i=ml(n);fl(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==ml(t.slice(o));fl(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). ")}))}}return El(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?Kd(e,r):vl(e,[],!0),bp.makeTensor(e,t,r)}function Rp(e,t,n){return Np(e,t,Sp(e,n),n)}var Dp={float32:4,float16:2,int32:4,uint16:2,uint8:1,bool:1,complex64:8};function Pp(e,t){return Op.apply(this,arguments)}function Op(){return Op=ns(es().mark((function e(t,n){var r,a,i,o,s,u;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r=[],a=[],i=Array.isArray(t)?t.map((function(e){return e.name})):Object.keys(t),o=function(e){var o=i[e],s=Array.isArray(t)?t[e].tensor:t[o];if("float32"!==s.dtype&&"int32"!==s.dtype&&"bool"!==s.dtype&&"string"!==s.dtype&&"complex64"!==s.dtype)throw new Error("Unsupported dtype in weight '".concat(o,"': ").concat(s.dtype));var u={name:o,shape:s.shape,dtype:s.dtype};if("string"===s.dtype){var c=new Promise(function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,u,c;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.bytes();case 2:for(n=e.sent,r=n.reduce((function(e,t){return e+t.length}),0)+4*n.length,a=new Uint8Array(r),i=0,o=0;o<n.length;o++)u=n[o],c=new Uint8Array(new Uint32Array([u.length]).buffer),a.set(c,i),i+=4,a.set(u,i),i+=u.length;t(a);case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}());a.push(c)}else a.push(s.data());null!=n&&(u.group=n),r.push(u)},s=0;s<i.length;++s)o(s);return e.next=7,Promise.all(a);case 7:return u=e.sent,e.abrupt("return",{data:Fp(u),specs:r});case 9:case"end":return e.stop()}}),e)}))),Op.apply(this,arguments)}function Lp(e,t){var n,r,a={},i=0,o=al(t);try{for(o.s();!(r=o.n()).done;){var s=r.value,u=s.name,c=s.dtype,l=s.shape,h=ml(l),f=void 0;if("quantization"in s){var d=s.quantization;if("uint8"===d.dtype||"uint16"===d.dtype){if(!("min"in d)||!("scale"in d))throw new Error("Weight ".concat(s.name," with quantization ").concat(d.dtype," ")+"doesn't have corresponding metadata min and scale.")}else{if("float16"!==d.dtype)throw new Error("Weight ".concat(s.name," has unknown ")+"quantization dtype ".concat(d.dtype,". ")+"Supported quantization dtypes are: 'uint8', 'uint16', and 'float16'.");if("float32"!==c)throw new Error("Weight ".concat(s.name," is quantized with ").concat(d.dtype," ")+"which only supports weights of type float32 not ".concat(c,"."))}var p=Dp[d.dtype],v=e.slice(i,i+h*p),m="uint8"===d.dtype?new Uint8Array(v):new Uint16Array(v);if("float32"===c)if("uint8"===d.dtype||"uint16"===d.dtype){f=new Float32Array(m.length);for(var g=0;g<m.length;g++){var y=m[g];f[g]=y*d.scale+d.min}}else{if("float16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," ")+"for weight type float32.");void 0===n&&(n=qp()),f=n(m)}else{if("int32"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));if("uint8"!==d.dtype&&"uint16"!==d.dtype)throw new Error("Unsupported quantization type ".concat(d.dtype," ")+"for weight type int32.");f=new Int32Array(m.length);for(var b=0;b<m.length;b++){var x=m[b];f[b]=Math.round(x*d.scale+d.min)}}i+=h*p}else if("string"===c){var k=ml(s.shape);f=[];for(var w=0;w<k;w++){var _=new Uint32Array(e.slice(i,i+4))[0];i+=4;var S=new Uint8Array(e.slice(i,i+_));f.push(S),i+=_}}else{var C=Dp[c],T=e.slice(i,i+h*C);if("float32"===c)f=new Float32Array(T);else if("int32"===c)f=new Int32Array(T);else if("bool"===c)f=new Uint8Array(T);else{if("complex64"!==c)throw new Error("Unsupported dtype in weight '".concat(u,"': ").concat(c));f=new Float32Array(T);for(var E=new Float32Array(f.length/2),I=new Float32Array(f.length/2),A=0;A<E.length;A++)E[A]=f[2*A],I[A]=f[2*A+1];var M=Rp(E,l,"float32"),N=Rp(I,l,"float32");a[u]=Mp(M,N),M.dispose(),N.dispose()}i+=h*C}"complex64"!==c&&(a[u]=Rp(f,l,c))}}catch(R){o.e(R)}finally{o.f()}return a}function Fp(e){if(null===e)throw new Error("Invalid input value: ".concat(JSON.stringify(e)));var t=0,n=[];e.forEach((function(e){if(t+=e.byteLength,n.push(e.byteLength===e.buffer.byteLength?e:new e.constructor(e)),!(e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array))throw new Error("Unsupported TypedArray subtype: ".concat(e.constructor.name))}));var r=new Uint8Array(t),a=0;return n.forEach((function(e){r.set(new Uint8Array(e.buffer),a),a+=e.byteLength})),r.buffer}var zp="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function Bp(e){return zp?Buffer.byteLength(e):new Blob([e]).size}function Up(e){if(zp)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function Vp(e){if(zp){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function Wp(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function Gp(e){for(e=e.trim();e.endsWith("/");)e=e.slice(0,e.length-1);var t=e.split("/");return t[t.length-1]}function jp(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:Bp(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:Bp(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}function qp(){var e=function(){var e=function(e){for(var t=e<<13,n=0;0===(8388608&t);)n-=8388608,t<<=1;return(t&=-8388609)|n+947912704},t=new Uint32Array(2048);t[0]=0;for(var n=1;n<1024;n++)t[n]=e(n);for(var r=1024;r<2048;r++)t[r]=939524096+(r-1024<<13);return t}(),t=function(){var e=new Uint32Array(64);e[0]=0,e[31]=1199570944,e[32]=2147483648,e[63]=3347054592;for(var t=1;t<31;t++)e[t]=t<<23;for(var n=33;n<63;n++)e[n]=2147483648+(n-32<<23);return e}(),n=function(){for(var e=new Uint32Array(64),t=0;t<64;t++)e[t]=1024;return e[0]=e[32]=0,e}();return function(r){for(var a=new ArrayBuffer(4*r.length),i=new Uint32Array(a),o=0;o<r.length;o++){var s=r[o],u=e[n[s>>10]+(1023&s)]+t[s>>10];i[o]=u}return new Float32Array(a)}}var Hp=function(){function e(){$n(this,e),this.saveRouters=[],this.loadRouters=[]}return Jn(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),Xp=function(e){return Hp.registerSaveRouter(e)},Kp=function(e){return Hp.registerLoadRouter(e)},Yp=function(e){return Hp.getSaveHandlers(e)},Qp=function(e,t){return Hp.getLoadHandlers(e,t)},Zp="tensorflowjs",Jp="models_store",$p="model_info_store";function ev(){if(!jl().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function tv(e){var t=e.result;t.createObjectStore(Jp,{keyPath:"modelPath"}),t.createObjectStore($p,{keyPath:"modelPath"})}var nv=function(){function e(t){if($n(this,e),this.indexedDB=ev(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return Jn(e,[{key:"save",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(Zp,1);a.onupgradeneeded=function(){return tv(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(Jp,"readonly"),s=o.objectStore(Jp).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=jp(t),l=i.transaction($p,"readwrite"),h=l.objectStore($p),f=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});f.onsuccess=function(){var a=(u=i.transaction(Jp,"readwrite")).objectStore(Jp).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(h=l.objectStore($p)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},f.onerror=function(e){return i.close(),r(f.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();nv.URL_SCHEME="indexeddb://";var rv=function(e){return jl().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(nv.URL_SCHEME)?(t=e.slice(nv.URL_SCHEME.length),new nv(t)):null;var t};Hp.registerSaveRouter(rv),Hp.registerLoadRouter(rv);var av=function(){function e(){$n(this,e),this.indexedDB=ev()}return Jn(e,[{key:"listModels",value:function(){var e=ns(es().mark((function e(){var t=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(Zp,1);r.onupgradeneeded=function(){return tv(r)},r.onsuccess=function(){var t=r.result,a=t.transaction($p,"readonly"),i=a.objectStore($p).getAll();i.onsuccess=function(){var t,n={},r=al(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch(o){r.e(o)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=ns(es().mark((function e(t){var n=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(r=t).startsWith(nv.URL_SCHEME)?r.slice(nv.URL_SCHEME.length):r,e.abrupt("return",new Promise((function(e,r){var a=n.indexedDB.open(Zp,1);a.onupgradeneeded=function(){return tv(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction($p,"readwrite"),s=o.objectStore($p),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' ")+"in IndexedDB."));var a=s.delete(t),o=function(){var a=(n=i.transaction(Jp,"readwrite")).objectStore(Jp).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}})));case 2:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),iv="/",ov="tensorflowjs_models",sv="info",uv="model_topology",cv="weight_specs",lv="weight_data",hv="model_metadata";function fv(e){return{info:[ov,e,sv].join(iv),topology:[ov,e,uv].join(iv),weightSpecs:[ov,e,cv].join(iv),weightData:[ov,e,lv].join(iv),modelMetadata:[ov,e,hv].join(iv)}}function dv(e){var t=e.split(iv);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(iv)}var pv=function(){function e(t){if($n(this,e),!jl().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=fv(this.modelPath)}return Jn(e,[{key:"save",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=4;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 4:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=jp(t),e.prev=7,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,Up(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy},null!=t.signature&&(i.signature=t.signature),null!=t.userDefinedMetadata&&(i.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(i.modelInitializer=t.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),e.abrupt("return",{modelArtifactsInfo:a});case 20:throw e.prev=20,e.t0=e.catch(7),this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."));case 28:case"end":return e.stop()}}),e,this,[[7,20]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=ns(es().mark((function e(){var t,n,r,a,i,o,s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=9;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");case 9:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=13;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");case 13:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=19;break}throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));case 19:return n.weightData=Vp(s),e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();pv.URL_SCHEME="localstorage://";var vv=function(e){return jl().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(pv.URL_SCHEME)?(t=e.slice(pv.URL_SCHEME.length),new pv(t)):null;var t};Hp.registerSaveRouter(vv),Hp.registerLoadRouter(vv);var mv=function(){function e(){$n(this,e),fl(jl().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),fl("undefined"===typeof window||"undefined"!==typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return Jn(e,[{key:"listModels",value:function(){var e=ns(es().mark((function e(){var t,n,r,a,i,o;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=ov+iv,r=iv+sv,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=dv(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(a=t).startsWith(pv.URL_SCHEME)?a.slice(pv.URL_SCHEME.length):a,n=fv(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),e.abrupt("return",r);case 10:case"end":return e.stop()}var a}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),gv="://",yv=function(){function e(){$n(this,e),this.managers={}}return Jn(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){fl(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(gv)&&(t=t.slice(0,t.indexOf(gv))),fl(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();fl(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}},{key:"getSchemes",value:function(){return Object.keys(this.getInstance().managers)}}]),e}();function bv(e){if(-1===e.indexOf(gv))throw new Error("The url string provided does not contain a scheme. Supported schemes are: "+"".concat(yv.getSchemes().join(",")));return{scheme:e.split(gv)[0],path:e.split(gv)[1]}}function xv(e,t){return kv.apply(this,arguments)}function kv(){return kv=ns(es().mark((function e(t,n){var r,a,i,o,s,u,c,l,h,f,d=arguments;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=d.length>2&&void 0!==d[2]&&d[2],fl(t!==n,(function(){return"Old path and new path are the same: '".concat(t,"'")})),fl((a=Hp.getLoadHandlers(t)).length>0,(function(){return"Copying failed because no load handler is found for source URL ".concat(t,".")})),fl(a.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"load handlers for source URL ".concat(t,".")})),i=a[0],fl((o=Hp.getSaveHandlers(n)).length>0,(function(){return"Copying failed because no save handler is found for destination "+"URL ".concat(n,".")})),fl(o.length<2,(function(){return"Copying failed because more than one (".concat(a.length,") ")+"save handlers for destination URL ".concat(n,".")})),s=o[0],u=bv(t).scheme,c=bv(t).path,l=u===bv(t).scheme,e.next=15,i.load();case 15:if(h=e.sent,!r||!l){e.next=19;break}return e.next=19,yv.getManager(u).removeModel(c);case 19:return e.next=21,s.save(h);case 21:if(f=e.sent,!r||l){e.next=25;break}return e.next=25,yv.getManager(u).removeModel(c);case 25:return e.abrupt("return",f.modelArtifactsInfo);case 26:case"end":return e.stop()}}),e)}))),kv.apply(this,arguments)}function wv(){return _v.apply(this,arguments)}function _v(){return(_v=ns(es().mark((function e(){var t,n,r,a,i,o,s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=yv.getSchemes(),n={},r=al(t),e.prev=3,r.s();case 5:if((a=r.n()).done){e.next=13;break}return i=a.value,e.next=9,yv.getManager(i).listModels();case 9:for(s in o=e.sent)n[i+gv+s]=o[s];case 11:e.next=5;break;case 13:e.next=18;break;case 15:e.prev=15,e.t0=e.catch(3),r.e(e.t0);case 18:return e.prev=18,r.f(),e.finish(18);case 21:return e.abrupt("return",n);case 22:case"end":return e.stop()}}),e,null,[[3,15,18,21]])})))).apply(this,arguments)}function Sv(e){return Cv.apply(this,arguments)}function Cv(){return(Cv=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=bv(t),r=yv.getManager(n.scheme),e.abrupt("return",r.removeModel(n.path));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tv(e,t){return Ev.apply(this,arguments)}function Ev(){return(Ev=ns(es().mark((function e(t,n){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!1,e.abrupt("return",xv(t,n,false));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Iv(e,t){return Av.apply(this,arguments)}function Av(){return(Av=ns(es().mark((function e(t,n){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return!0,e.abrupt("return",xv(t,n,true));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Mv=function(){function e(){$n(this,e)}return Jn(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}}]),e}();if(jl().get("IS_BROWSER")){jl().setPlatform("browser",new Mv);try{yv.registerManager(pv.URL_SCHEME,new mv)}catch($Pe){}try{yv.registerManager(nv.URL_SCHEME,new av)}catch($Pe){}}var Nv,Rv=function(){return __webpack_require__(5755)};var Dv=function(){function e(){$n(this,e),this.util=__webpack_require__(7004),this.textEncoder=new this.util.TextEncoder}return Jn(e,[{key:"fetch",value:function(e,t){return null!=jl().global.fetch?jl().global.fetch(e,t):(null==Nv&&(Nv=Rv()),Nv(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),e}();function Pv(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",Bl(e),new Jd(e,t,n)}jl().get("IS_NODE")&&jl().setPlatform("node",new Dv);var Ov=Ap({cast_:function(e,t){var n=Ep(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return bp.runKernel(vh,r,a)}});var Lv=Ap({clone_:function(e){var t={x:Ep(e,"x","clone","string_or_numeric")};return bp.runKernel(Jh,t)}});yp();var Fv={buffer:Pv,cast:Ov,clone:Lv,print:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};!function(e){ep=e}(Fv);function zv(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var Bv=function(){function e(t){if($n(this,e),!jl().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return Jn(e,[{key:"save",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=7;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 7:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},null!=t.signature&&(a.signature=t.signature),null!=t.userDefinedMetadata&&(a.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(a.modelInitializer=t.modelInitializer),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=i,e.next=18,zv((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 18:if(null==t.weightData){e.next=24;break}return(s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,e.next=24,zv((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 24:return e.abrupt("return",{modelArtifactsInfo:jp(t)});case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();Bv.URL_SCHEME="downloads://";var Uv=function(){function e(t){if($n(this,e),null==t||t.length<1)throw new Error("When calling browserFiles, at least 1 file is required, "+"but received ".concat(t));this.files=t}return Jn(e,[{key:"load",value:function(){var e=ns(es().mark((function e(){var t,n,r=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.files[0],n=this.files.slice(1),e.abrupt("return",new Promise((function(e,a){var i=new FileReader;i.onload=function(i){var o=JSON.parse(i.target.result),s=o.modelTopology;if(null!=s){0===n.length&&e({modelTopology:s});var u=o.weightsManifest;if(null!=u){var c;try{c=r.checkManifestAndWeightFiles(u,n)}catch($Pe){return void a($Pe)}var l=[],h=[],f=[];u.forEach((function(e){e.paths.forEach((function(e){h.push(e),f.push(null)})),l.push.apply(l,Tt(e.weights))})),u.forEach((function(t){t.paths.forEach((function(t){var n=new FileReader;n.onload=function(n){var r=n.target.result,a=h.indexOf(t);if(f[a]=r,-1===f.indexOf(null)){var i={modelTopology:s,weightSpecs:l,weightData:Wp(f),format:o.format,generatedBy:o.generatedBy,convertedBy:o.convertedBy};null!=o.signature&&(i.signature=o.signature),null!=o.userDefinedMetadata&&(i.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(i.modelInitializer=o.modelInitializer),e(i)}},n.onerror=function(e){return a("Failed to weights data from file of path '".concat(t,"'."))},n.readAsArrayBuffer(c[t])}))}))}else a(new Error("weightManifest field is missing from file ".concat(t.name)))}else a(new Error("modelTopology field is missing from file ".concat(t.name)))},i.onerror=function(e){return a("Failed to read model topology and weights manifest JSON "+"from file '".concat(t.name,"'. BrowserFiles supports loading ")+"Keras-style tf.Model artifacts only.")},i.readAsText(t)})));case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"checkManifestAndWeightFiles",value:function(e,t){var n,r=[],a=t.map((function(e){return Gp(e.name)})),i={},o=al(e);try{for(o.s();!(n=o.n()).done;){n.value.paths.forEach((function(e){var n=Gp(e);if(-1!==r.indexOf(n))throw new Error("Duplicate file basename found in weights manifest: "+"'".concat(n,"'"));if(r.push(n),-1===a.indexOf(n))throw new Error("Weight file with basename '".concat(n,"' is not provided."));i[e]=t[a.indexOf(n)]}))}}catch($Pe){o.e($Pe)}finally{o.f()}if(r.length!==t.length)throw new Error("Mismatch in the number of files in weights manifest "+"(".concat(r.length,") and the number of weight files provided ")+"(".concat(t.length,")."));return i}}]),e}();function Vv(e){return new Uv(e)}function Wv(e,t,n,r){!function(e){fl(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){fl(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)})),fl(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)})),fl(t>=e,(function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function Gv(e,t){return jv.apply(this,arguments)}function jv(){return(jv=ns(es().mark((function e(t,n){var r,a,i,o,s,u,c,l,h;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?jl().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,Wv(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0,u=s.map((function(e){return e.arrayBuffer()})),c=.5,l=1,null!=n.onProgress){e.next=24;break}return e.next=21,Promise.all(u);case 21:e.t1=e.sent,e.next=27;break;case 24:return e.next=26,Wv(u,n.onProgress,c,l);case 26:e.t1=e.sent;case 27:return h=e.t1,e.abrupt("return",h);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qv(e){return Hv.apply(this,arguments)}function Hv(){return Hv=ns(es().mark((function e(t){var n,r,a,i,o=arguments;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=o.length>1&&void 0!==o[1]?o[1]:"",r=o.length>2?o[2]:void 0,a=o.length>3?o[3]:void 0,i=Xv((function(e){return Gv(e,{requestInit:a})})),e.abrupt("return",i(t,n,r));case 6:case"end":return e.stop()}}),e)}))),Hv.apply(this,arguments)}function Xv(e){return function(){var t=ns(es().mark((function t(n){var r,a,i,o,s,u,c,l,h,f,d,p,v=arguments;return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=v.length>1&&void 0!==v[1]?v[1]:"",a=v.length>2?v[2]:void 0,i=n.map((function(){return!1})),o={},s=null!=a?a.map((function(){return!1})):[],u=[],n.forEach((function(e,t){var n=0;e.weights.forEach((function(e){var r="quantization"in e?e.quantization.dtype:e.dtype,c=Dp[r]*ml(e.shape),l=function(){i[t]=!0,null==o[t]&&(o[t]=[]),o[t].push({manifestEntry:e,groupOffset:n,sizeBytes:c})};null!=a?a.forEach((function(t,n){t===e.name&&(l(),s[n]=!0)})):l(),u.push(e.name),n+=c}))})),s.every((function(e){return e}))){t.next=10;break}throw c=a.filter((function(e,t){return!s[t]})),new Error("Could not find weights in manifest with names: "+"".concat(c.join(", "),". \n")+"Manifest JSON has weights with names: "+"".concat(u.join(", "),"."));case 10:return l=i.reduce((function(e,t,n){return t&&e.push(n),e}),[]),h=[],l.forEach((function(e){n[e].paths.forEach((function(e){var t=r+(r.endsWith("/")?"":"/")+e;h.push(t)}))})),t.next=15,e(h);case 15:return f=t.sent,d={},p=0,l.forEach((function(e){for(var t=n[e].paths.length,r=0,a=0;a<t;a++)r+=f[p+a].byteLength;for(var i=new ArrayBuffer(r),s=new Uint8Array(i),u=0,c=0;c<t;c++){var l=new Uint8Array(f[p+c]);s.set(l,u),u+=l.byteLength}o[e].forEach((function(e){var t=Lp(i.slice(e.groupOffset,e.groupOffset+e.sizeBytes),[e.manifestEntry]);for(var n in t)d[n]=t[n]})),p+=t})),t.abrupt("return",d);case 20:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()}Hp.registerSaveRouter((function(e){return jl().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(Bv.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new Bv(e)}(e.slice(Bv.URL_SCHEME.length)):null}));var Kv=function(){function e(t,n){if($n(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(fl("function"===typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=jl().platform.fetch,fl(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&fl(2===t.length,(function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return Jn(e,[{key:"save",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},null!=t.signature&&(a.signature=t.signature),null!=t.userDefinedMetadata&&(a.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(a.modelInitializer=t.modelInitializer),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=13,this.fetch(this.path,n);case 13:if(!(i=e.sent).ok){e.next=18;break}return e.abrupt("return",{modelArtifactsInfo:jp(t),responses:[i]});case 18:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."));case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=ns(es().mark((function e(){var t,n,r,a,i,o,s,u,c,l,h,d,p,v,m,g;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(t.status,". Please verify this URL points to ")+"the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 16:if(a=n.modelTopology,i=n.weightsManifest,o=n.generatedBy,s=n.convertedBy,u=n.format,c=n.signature,l=n.userDefinedMetadata,null!=a||null!=i){e.next=25;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");case 25:if(null==i){e.next=32;break}return e.next=28,this.loadWeights(i);case 28:p=e.sent,v=f(p,2),h=v[0],d=v[1];case 32:return m={modelTopology:a,weightSpecs:h,weightData:d,generatedBy:o,convertedBy:s,format:u},null!=c&&(m.signature=c),null!=l&&(m.userDefinedMetadata=l),(g=n.modelInitializer)&&(m.modelInitializer=g),e.abrupt("return",m);case 38:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,s,u,c,l,h,d,p,v,m,g,y,b,x,k;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=Yv(n),a=f(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=[],c=al(t);try{for(c.s();!(l=c.n()).done;)h=l.value,u.push.apply(u,Tt(h.weights))}catch($Pe){c.e($Pe)}finally{c.f()}d=[],p=[],v=al(t);try{for(v.s();!(m=v.n()).done;){g=m.value,y=al(g.paths);try{for(y.s();!(b=y.n()).done;)x=b.value,null!=this.weightUrlConverter?p.push(this.weightUrlConverter(x)):d.push(s+x+o)}catch($Pe){y.e($Pe)}finally{y.f()}}}catch($Pe){v.e($Pe)}finally{v.f()}if(!this.weightUrlConverter){e.next=19;break}return e.t0=d.push,e.t1=d,e.t2=Tt,e.next=16,Promise.all(p);case 16:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 19:return e.next=21,Gv(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 21:return k=e.sent,e.abrupt("return",[u,Wp(k)]);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Yv(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function Qv(e){return null!=e.match(Kv.URL_SCHEME_REGEX)}Kv.URL_SCHEME_REGEX=/^https?:\/\//;var Zv=function(e,t){if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return Qv(e)})):Qv(e))?Jv(e,t):null};function Jv(e,t){return new Kv(e,t)}function $v(e,t){return Jv(e,t)}Hp.registerSaveRouter(Zv),Hp.registerLoadRouter(Zv);var em=function(){function e(t){$n(this,e),this.modelArtifacts=t}return Jn(e,[{key:"load",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.modelArtifacts);case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}(),tm=function(){function e(t){$n(this,e),this.saveHandler=t}return Jn(e,[{key:"save",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.saveHandler(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function nm(e,t,n,r){if(1===arguments.length){var a=null!=e.modelTopology||null!=e.weightSpecs;return a?new em(e):(console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new em({modelTopology:e}))}return console.warn("Please call tf.io.fromMemory() with only one argument. The argument should be of type ModelArtifacts. The multi-argument signature of tf.io.fromMemory() has been deprecated and will be removed in a future release."),new em({modelTopology:e,weightSpecs:t,weightData:n,trainingConfig:r})}function rm(e){return new tm(e)}function am(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function im(e,t,n){return n<=e?n:n-(t-1)}function om(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function sm(e,t,n,r,a,i,o,s,u){var c=e.length,l=new Array(c),h=new Array(c),f=new Array(c);if(t.length&&n>0){var d=t[0],p=n+1;l=function(e,t,n,r,a){for(var i=Tt(a),o=om(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=im(t,n,s),c=r[u];e&1<<u&&(c=0),i[s]=c}return i}(o,d,p,r,e),h=function(e,t,n,r,a){for(var i=Tt(a),o=om(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=im(t,n,s),c=r[u];e&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var h=a[l];i[l]<0&&(i[l]+=h),i[l]=cl(0,i[l],a[l])}return i}(s,d,p,a,e),f=function(e,t,n,r){for(var a=Tt(e),i=a.length;i<r.length;i++)a.push(1);for(var o=0;o<n;o++)0===o?a[t]=1:(a.splice(t,0,1),a.pop());return a}(i,d,p,e)}else for(var v=0;v<c;v++)l[v]=cm(o,r,i,e,v,u),h[v]=lm(s,a,i,e,v,u),f[v]=um(i,v,u);return{begin:l,end:h,strides:f}}function um(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function cm(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=cl(0,o,u-1)}function lm(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=s>0?cl(0,o,u):cl(-1,o,u-1)}function hm(e,t,n){var r,a,i=e.shape.length;return(r="number"===typeof t?[t].concat(Tt(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){fl(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"===typeof n?[n].concat(Tt(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(fl(-1===t,(function(){return"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function fm(e,t,n,r,a,i,o,s,u){var c=t.slice(),l=n.slice(),h=r;null==r&&(h=new Array(c.length));var f=am(o);if(f.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==o&&0!==s)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==o&&0!==u)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");var d=e.length-c.length,p=am(s),v=e.slice();p.forEach((function(e){c[e]=0,l[e]=1,v.splice(e,0,1)}));var m=sm(v,f,d,c,l,h,a,i,o),g=m.begin,y=m.end,b=m.strides;c=g,l=y,h=b;var x=am(u);x.forEach((function(e){l[e]=c[e]+1,h[e]=1}));var k=function(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}(c,l,h),w=k.filter((function(e,t){return-1===x.indexOf(t)})),_=h.every((function(e){return 1===e}));return{nonStrided:_,$begin:c,$end:l,$strides:h,size:k,newShape:v,outShape:w}}var dm=function(){function e(){$n(this,e)}return Jn(e,[{key:"getClassName",value:function(){return this.constructor.className}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),e}(),pm=function(){function e(){$n(this,e),this.classNameMap={}}return Jn(e,null,[{key:"getMap",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"register",value:function(t){e.getMap().classNameMap[t.className]=[t,t.fromConfig]}}]),e}();function vm(e){fl(null!=e.className,(function(){return"Class being registered does not have the static className property defined."})),fl("string"===typeof e.className,(function(){return"className is required to be a string, but got type "+typeof e.className})),fl(e.className.length>0,(function(){return"Class being registered has an empty-string as its className, which is disallowed."})),pm.register(e)}function mm(e){jl().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function gm(){return bp}function ym(){return bp.memory()}function bm(e,t){return bp.tidy(e,t)}function xm(e){dp(e).forEach((function(e){return e.dispose()}))}function km(e){return bp.keep(e)}function wm(e){return bp.customGrad(e)}function _m(e,t){if((El(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&El(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Np(e,[],[],t)}var Sm=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"minimize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this.computeGradients(e,n),a=r.value,i=r.grads;if(null!=n){var o=n.map((function(e){return{name:e.name,tensor:i[e.name]}}));this.applyGradients(o)}else this.applyGradients(i);return xm(i),t?a:(a.dispose(),null)}},{key:"iterations",get:function(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}},{key:"incrementIterations",value:function(){this.iterations_=this.iterations+1}},{key:"computeGradients",value:function(e,t){return function(e,t){fl(Rl(e),(function(){return"The f passed in variableGrads(f) must be a function"})),fl(null==t||Array.isArray(t)&&t.every((function(e){return e instanceof sp})),(function(){return"The varList passed in variableGrads(f, varList) must be an array of variables"}));var n=null!=t;if(!n)for(var r in t=[],bp.registeredVariables)t.push(bp.registeredVariables[r]);var a=n?t.filter((function(e){return!e.trainable})):null,i=t.length;t=t.filter((function(e){return e.trainable})),fl(t.length>0,(function(){return"variableGrads() expects at least one of the input variables to "+"be trainable, but none of the ".concat(i," variables is ")+"trainable."}));var o=bp.gradients(e,t,null,!0),s=o.value,u=o.grads;fl(u.some((function(e){return null!=e})),(function(){return"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize()."})),fl(0===s.rank,(function(){return"The f passed in variableGrads(f) must return a scalar, but it "+"returned a rank-".concat(s.rank," tensor")}));var c={};return t.forEach((function(e,t){null!=u[t]&&(c[e.name]=u[t])})),null!=a&&a.forEach((function(e){return c[e.name]=null})),{value:s,grads:c}}(e,t)}},{key:"dispose",value:function(){null!=this.iterations_&&xm(this.iterations_)}},{key:"saveIterations",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null==this.iterations_&&(this.iterations_=0),e.abrupt("return",{name:"iter",tensor:_m(this.iterations_,"int32")});case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getWeights",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for this optimizer yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for this optimizer class "+"".concat(this.getClassName()));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"extractIterations",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t[0].tensor.data();case 2:return this.iterations_=e.sent[0],e.abrupt("return",t.slice(1));case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(dm);Object.defineProperty(Sm,Symbol.hasInstance,{value:function(e){return null!=e.minimize&&null!=e.computeGradients&&null!=e.applyGradients}});var Cm=Ap({abs_:function(e){var t=Ep(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return bp.runKernel(bh,n)}var r={x:t};return bp.runKernel(Yl,r)}});var Tm=Ap({add_:function(e,t){var n=Ep(e,"a","add"),r=Ep(t,"b","add"),a=f(hp(n,r),2),i={a:n=a[0],b:r=a[1]};return bp.runKernel(Jl,i)}});var Em=Ap({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ep(e,"x","all","bool"),a={x:r},i={axis:t,keepDims:n};return bp.runKernel(eh,a,i)}});var Im=Ap({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ep(e,"x","any","bool"),a={x:r},i={axis:t,keepDims:n};return bp.runKernel(th,a,i)}});var Am=Ap({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ep(e,"x","argMax"),r={x:n},a={axis:t};return bp.runKernel(nh,r,a)}});function Mm(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=Om(t),c=f(u,2),l=c[0],h=c[1];if("channelsLast"===s)o=[l,h,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));o=[l,h,e[1],e[1]]}return Rm(e,o,n,r,a,i,!1,s)}function Nm(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=Lm(t),l=f(c,3),h=l[0],d=l[1],p=l[2];if("NDHWC"===u)s="channelsLast",o=[h,d,p,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat ".concat(u));s="channelsFirst",o=[h,d,p,e[1],e[1]]}return Dm(e,o,n,r,a,!1,s,i)}function Rm(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,h=-1;if("channelsLast"===s){var d=f(e,4);u=d[0],c=d[1],l=d[2],h=d[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var p=f(e,4);u=p[0],h=p[1],c=p[2],l=p[3]}var v,m=f(t,4),g=m[0],y=m[1],b=m[3],x=Om(n),k=f(x,2),w=k[0],_=k[1],S=Om(r),C=f(S,2),T=C[0],E=C[1],I=Fm(g,T),A=Fm(y,E),M=zm(a,c,l,w,_,I,A,i,s),N=M.padInfo,R=M.outHeight,D=M.outWidth,P=o?b*h:b;return"channelsFirst"===s?v=[u,P,R,D]:"channelsLast"===s&&(v=[u,R,D,P]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:h,outHeight:R,outWidth:D,outChannels:P,padInfo:N,strideHeight:w,strideWidth:_,filterHeight:g,filterWidth:y,effectiveFilterHeight:I,effectiveFilterWidth:A,dilationHeight:T,dilationWidth:E,inShape:e,outShape:v,filterShape:t}}function Dm(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,l=-1,h=-1,d=-1;if("channelsLast"===o){var p=f(e,5);u=p[0],c=p[1],l=p[2],h=p[3],d=p[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));var v=f(e,5);u=v[0],d=v[1],c=v[2],l=v[3],h=v[4]}var m,g=f(t,5),y=g[0],b=g[1],x=g[2],k=g[4],w=Lm(n),_=f(w,3),S=_[0],C=_[1],T=_[2],E=Lm(r),I=f(E,3),A=I[0],M=I[1],N=I[2],R=Fm(y,A),D=Fm(b,M),P=Fm(x,N),O=Bm(a,c,l,h,S,C,T,R,D,P,s),L=O.padInfo,F=O.outDepth,z=O.outHeight,B=O.outWidth,U=i?k*d:k;return"channelsFirst"===o?m=[u,U,F,z,B]:"channelsLast"===o&&(m=[u,F,z,B,U]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:h,inChannels:d,outDepth:F,outHeight:z,outWidth:B,outChannels:U,padInfo:L,strideDepth:S,strideHeight:C,strideWidth:T,filterDepth:y,filterHeight:b,filterWidth:x,effectiveFilterDepth:R,effectiveFilterHeight:D,effectiveFilterWidth:P,dilationDepth:A,dilationHeight:M,dilationWidth:N,inShape:e,outShape:m,filterShape:t}}function Pm(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=Fm(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function Om(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Lm(e){return"number"===typeof e?[e,e,e]:e}function Fm(e,t){return t<=1?e:e+(e-1)*(t-1)}function zm(e,t,n,r,a,i,o,s,u){var c,l,h;if("number"===typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,a){null==r&&(r=Pm(e,t,n));var i=e[0],o=e[1];return[Um((i-t+2*r)/n+1,a),Um((o-t+2*r)/n+1,a)]}([t,n],i,r,e,s);l=f[0],h=f[1]}else if("same"===e){l=Math.ceil(t/r),h=Math.ceil(n/a);var d=Math.max(0,(l-1)*r+i-t),p=Math.max(0,(h-1)*a+o-n),v=Math.floor(d/2),m=d-v,g=Math.floor(p/2);c={top:v,bottom:m,left:g,right:p-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),h=Math.ceil((n-o+1)/a);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],x="channelsLast"===u?e[2][0]:e[3][0],k="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:x,right:k,type:0===y&&0===b&&0===x&&0===k?"VALID":"EXPLICIT"},l=Um((t-i+y+b)/r+1,s),h=Um((n-o+x+k)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:h}}function Bm(e,t,n,r,a,i,o,s,u,c,l){var h,f,d,p;if("number"===typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var v=function(e,t,n,r,a,i){null==a&&(a=Pm(e,t,r));var o=e[0],s=e[1],u=e[2];return[Um((o-t+2*a)/r+1,i),Um((s-t+2*a)/r+1,i),Um((u-t+2*a)/r+1,i),n]}([t,n,r,1],s,1,a,e,l);f=v[0],d=v[1],p=v[2]}else if("same"===e){var m=((f=Math.ceil(t/a))-1)*a+s-t,g=((d=Math.ceil(n/i))-1)*i+u-n,y=((p=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(m/2),x=m-b,k=Math.floor(g/2),w=g-k,_=Math.floor(y/2);h={top:k,bottom:w,left:_,right:y-_,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/a),d=Math.ceil((n-u+1)/i),p=Math.ceil((r-c+1)/o)}return{padInfo:h,outDepth:f,outHeight:d,outWidth:p}}function Um(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function Vm(e){var t=f(Om(e),3),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function Wm(e,t){return Vm(e)||Vm(t)}function Gm(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}var jm=Ap({reshape_:function(e,t){var n={x:Ep(e,"x","reshape","string_or_numeric")},r={shape:t};return bp.runKernel(qf,n,r)}});var qm=Ap({avgPool_:function(e,t,n,r,a){var i=Ep(e,"x","avgPool","float32");fl(Wm(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=jm(i,[1,i.shape[0],i.shape[1],i.shape[2]])),fl(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),null!=a&&fl(yl(r),(function(){return"Error in avgPool: pad must be an integer when using, "+"dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=bp.runKernel(ch,u,c);return l=Ov(l,i.dtype),s?jm(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Hm=Ap({avgPool3d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=arguments.length>6?arguments[6]:void 0;null==o?o=[1,1,1]:mm("dilations is deprecated, this field will be gone in v3.0.0.");var s=Ep(e,"x","avgPool3d","float32"),u=s,c=!1;4===s.rank&&(c=!0,u=jm(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),fl(5===u.rank,(function(){return"Error in avgPool3d: x must be rank 5 but got rank ".concat(u.rank,".")})),fl("NDHWC"===i,(function(){return"Error in avgPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),fl(Wm(n,o),(function(){return"Error in avgPool3d: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(o,"'")})),null!=a&&fl(yl(r),(function(){return"Error in avgPool3d: pad must be an integer when using, "+"dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var l={x:u},h={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i,dilations:o},f=bp.runKernel(hh,l,h);return f=Ov(f,u.dtype),c?jm(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});var Xm=Ap({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;fl(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Ip(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return Lv(n[0]);var r=n,a={axis:t};return bp.runKernel(xh,r,a)}});var Km=Ap({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Ep(e,"a","matMul"),i=Ep(t,"b","matMul"),o=hp(a,i),s=f(o,2),u={a:a=s[0],b:i=s[1]},c={transposeA:n,transposeB:r};return bp.runKernel(dh,u,c)}});var Ym=Ap({mul_:function(e,t){var n=Ep(e,"a","mul"),r=Ep(t,"b","mul"),a=f(hp(n,r),2),i={a:n=a[0],b:r=a[1]};return bp.runKernel(If,i)}});var Qm=Ap({sigmoid_:function(e){var t={x:Ep(e,"x","sigmoid")};return bp.runKernel(od,t)}});var Zm=Ap({slice_:function(e,t,n){var r=Ep(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return bp.runKernel(nd,a,i)}});var Jm=Ap({tanh_:function(e){var t={x:Ep(e,"x","tanh")};return bp.runKernel(yd,t)}});var $m=Ap({basicLSTMCell_:function(e,t,n,r,a,i){var o=Ep(e,"forgetBias","basicLSTMCell"),s=Ep(t,"lstmKernel","basicLSTMCell"),u=Ep(n,"lstmBias","basicLSTMCell"),c=Ep(r,"data","basicLSTMCell"),l=Ep(a,"c","basicLSTMCell"),h=Ep(i,"h","basicLSTMCell"),f=Xm([c,h],1),d=Km(f,s),p=Tm(d,u),v=p.shape[0],m=p.shape[1]/4,g=[v,m],y=Zm(p,[0,0],g),b=Zm(p,[0,m],g),x=Zm(p,[0,2*m],g),k=Zm(p,[0,3*m],g),w=Tm(Ym(Qm(y),Jm(b)),Ym(l,Qm(Tm(o,x))));return[w,Ym(Jm(w),Qm(k))]}});var eg=Ap({batchToSpaceND_:function(e,t,n){var r=Ep(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));fl(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),fl(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),fl(r.shape[0]%a===0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(a)}));var i={x:r},o={blockShape:t,crops:n};return bp.runKernel(ph,i,o)}});var tg=Ap({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=Ep(e,"x","batchNorm"),c=Ep(t,"mean","batchNorm"),l=Ep(n,"variance","batchNorm");null!=a&&(o=Ep(a,"scale","batchNorm")),null!=r&&(s=Ep(r,"offset","batchNorm")),fl(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),fl(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),fl(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var h=function(e){return 0===e.rank||1===e.rank?jm(e,[1,1,1,e.size]):2===e.rank?jm(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?jm(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}(u),f={x:h,scale:o,offset:s,mean:c,variance:l},d={varianceEpsilon:i},p=bp.runKernel(Kh,f,d);return jm(p,u.shape)}});var ng=Ap({batchNorm2d_:function(e,t,n,r,a,i){var o,s,u=Ep(e,"x","batchNorm"),c=Ep(t,"mean","batchNorm"),l=Ep(n,"variance","batchNorm");return null!=a&&(o=Ep(a,"scale","batchNorm")),null!=r&&(s=Ep(r,"offset","batchNorm")),fl(2===u.rank,(function(){return"Error in batchNorm2D: x must be rank 2 but got rank "+"".concat(u.rank,".")})),fl(2===c.rank||1===c.rank,(function(){return"Error in batchNorm2D: mean must be rank 2 or rank 1 but "+"got rank ".concat(c.rank,".")})),fl(2===l.rank||1===l.rank,(function(){return"Error in batchNorm2D: variance must be rank 2 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&fl(2===o.rank||1===o.rank,(function(){return"Error in batchNorm2D: scale must be rank 2 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&fl(2===s.rank||1===s.rank,(function(){return"Error in batchNorm2D: offset must be rank 2 or rank 1 "+"but got rank ".concat(s.rank,".")})),tg(u,c,l,s,o,i)}});var rg=Ap({batchNorm3d_:function(e,t,n,r,a,i){var o,s,u=Ep(e,"x","batchNorm"),c=Ep(t,"mean","batchNorm"),l=Ep(n,"variance","batchNorm");return null!=a&&(o=Ep(a,"scale","batchNorm")),null!=r&&(s=Ep(r,"offset","batchNorm")),fl(3===u.rank,(function(){return"Error in batchNorm3D: x must be rank 3 but got rank "+"".concat(u.rank,".")})),fl(3===c.rank||1===c.rank,(function(){return"Error in batchNorm3D: mean must be rank 3 or rank 1 but "+"got rank ".concat(c.rank,".")})),fl(3===l.rank||1===l.rank,(function(){return"Error in batchNorm3D: variance must be rank 3 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&fl(3===o.rank||1===o.rank,(function(){return"Error in batchNorm3D: scale must be rank 3 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&fl(3===s.rank||1===s.rank,(function(){return"Error in batchNorm3D: offset must be rank 3 or rank 1 "+"but got rank ".concat(s.rank,".")})),tg(u,c,l,s,o,i)}});var ag=Ap({batchNorm4d_:function(e,t,n,r,a,i){var o,s,u=Ep(e,"x","batchNorm"),c=Ep(t,"mean","batchNorm"),l=Ep(n,"variance","batchNorm");return null!=a&&(o=Ep(a,"scale","batchNorm")),null!=r&&(s=Ep(r,"offset","batchNorm")),fl(4===u.rank,(function(){return"Error in batchNorm4D: x must be rank 4 but got rank "+"".concat(u.rank,".")})),fl(4===c.rank||1===c.rank,(function(){return"Error in batchNorm4D: mean must be rank 4 or rank 1 but "+"got rank ".concat(c.rank,".")})),fl(4===l.rank||1===l.rank,(function(){return"Error in batchNorm4D: variance must be rank 4 or rank 1 "+"but got rank ".concat(l.rank,".")})),null!=o&&fl(4===o.rank||1===o.rank,(function(){return"Error in batchNorm4D: scale must be rank 4 or rank 1 "+"but got rank ".concat(o.rank,".")})),null!=s&&fl(4===s.rank||1===s.rank,(function(){return"Error in batchNorm4D: offset must be rank 4 or rank 1 "+"but got rank ".concat(s.rank,".")})),tg(u,c,l,s,o,i)}});var ig=Ap({clipByValue_:function(e,t,n){var r=Ep(e,"x","clipByValue");fl(t<=n,(function(){return"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")}));var a={x:r},i={clipValueMin:t,clipValueMax:n};return bp.runKernel(gh,a,i)}});var og=Ap({concat1d_:function(e){return Xm(e,0)}});var sg=Ap({concat2d_:function(e,t){return Xm(e,t)}});var ug=Ap({concat3d_:function(e,t){return Xm(e,t)}});var cg=Ap({concat4d_:function(e,t){return Xm(e,t)}});var lg=Ap({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=Ep(e,"x","conv2d"),u=Ep(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=jm(s,[1,s.shape[0],s.shape[1],s.shape[2]])),fl(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),fl(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")})),null!=o&&fl(yl(r),(function(){return"Error in conv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")}));var h="NHWC"===a?c.shape[3]:c.shape[1];fl(h===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(h,") must match ")+"input depth for filter ".concat(u.shape[2],".")})),fl(Wm(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")}));var f={x:c,filter:u},d={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=bp.runKernel(kh,f,d);return l?jm(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var hg=Ap({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=Ep(e,"x","conv1d"),u=Ep(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=jm(s,[1,s.shape[0],s.shape[1]])),fl(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),fl(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")})),null!=o&&fl(yl(r),(function(){return"Error in conv1d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")})),fl(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")})),fl(Wm(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(i,"'")})),fl("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var h=jm(u,[1,u.shape[0],u.shape[1],u.shape[2]]),f=jm(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=[1,n],p=[1,i],v="NHWC",m=lg(f,h,d,r,v,p,o);return jm(m,l?[m.shape[2],m.shape[3]]:[m.shape[0],m.shape[2],m.shape[3]])}});var fg=Ap({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;fl(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=jm(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),fl(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")})),fl(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)})),fl(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank)}));var l="NHWC"===i?s[3]:s[1],h="NHWC"===i?u.shape[3]:u.shape[1];fl(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(n.shape[2],".")})),fl(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(h,") must ")+"match output depth for filter ".concat(n.shape[3],".")})),null!=o&&fl(yl(a),(function(){return"Error in conv2dDerInput: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(a,".")}));var f={dy:u,filter:n},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},p=bp.runKernel(_h,f,d);return c?jm(p,[p.shape[1],p.shape[2],p.shape[3]]):p}});var dg=Ap({conv2dTranspose_:function(e,t,n,r,a,i){var o=Ep(e,"x","conv2dTranspose"),s=Ep(t,"filter","conv2dTranspose");return fg(n,o,s,r,a,"NHWC",i)}});var pg=Ap({conv3d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NDHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=Ep(e,"x","conv3d"),s=Ep(t,"filter","conv3d"),u=o,c=!1;4===o.rank&&(c=!0,u=jm(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),fl(5===u.rank,(function(){return"Error in conv3d: input must be rank 5, but got rank ".concat(u.rank,".")})),fl(5===s.rank,(function(){return"Error in conv3d: filter must be rank 5, but got rank "+"".concat(s.rank,".")})),fl(u.shape[4]===s.shape[3],(function(){return"Error in conv3d: depth of input (".concat(u.shape[4],") must match ")+"input depth for filter ".concat(s.shape[3],".")})),fl(Wm(n,i),(function(){return"Error in conv3D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")})),fl("NDHWC"===a,(function(){return"Error in conv3d: got dataFormat of ".concat(a," but only NDHWC is currently supported.")}));var l={x:u,filter:s},h={strides:n,pad:r,dataFormat:a,dilations:i},f=bp.runKernel(Sh,l,h);return c?jm(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});var vg=Ap({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=Ep(e,"x","depthwiseConv2d"),u=Ep(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=jm(s,[1,s.shape[0],s.shape[1],s.shape[2]])),fl(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")})),fl(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")})),fl(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(c.shape[3],") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")})),null!=o&&fl(yl(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")}));var h={x:c,filter:u},f={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},d=bp.runKernel(Rh,h,f);return l?jm(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});var mg=Ap({floorDiv_:function(e,t){var n=Ep(e,"a","floorDiv"),r=Ep(t,"b","floorDiv"),a=f(hp(n,r),2),i={a:n=a[0],b:r=a[1]};return bp.runKernel(Xh,i)}});var gg=Ap({div_:function(e,t){var n=Ep(e,"a","div"),r=Ep(t,"b","div"),a=f(hp(n,r),2);if(n=a[0],r=a[1],"int32"===n.dtype&&"int32"===r.dtype)return mg(n,r);var i={a:n,b:r};return bp.runKernel(Lh,i,{})}});var yg=Ap({elu_:function(e){var t={x:Ep(e,"x","elu")};return bp.runKernel(Fh,t)}});function bg(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function xg(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(s)}n.unshift(i)}}return n}var kg=Ap({equal_:function(e,t){var n=Ep(e,"a","equal"),r=Ep(t,"b","equal"),a=f(hp(n,r),2);n=a[0],r=a[1],xg(n.shape,r.shape);var i={a:n,b:r};return bp.runKernel(Uh,i)}});var wg=Ap({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ep(e,"x","expandDims","string_or_numeric");fl(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return bp.runKernel(Wh,r,a)}});var _g=Ap({tile_:function(e,t){var n=Ep(e,"x","tile","string_or_numeric");fl(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,".")}));var r={x:n},a={reps:t};return bp.runKernel(bd,r,a)}});var Sg=Ap({eye_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";null==t&&(t=e);for(var a=Pv([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=jm(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return _g(wg(s,0),[n[0],1,1]);if(2===n.length)return _g(wg(wg(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return _g(wg(wg(wg(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});function Cg(e,t,n){var r={shape:e,value:t,dtype:n};return bp.runKernel(jh,{},r)}var Tg=Ap({floor_:function(e){var t={x:Ep(e,"x","floor")};return bp.runKernel(Hh,t)}});var Eg=Ap({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=Ep(e,"x","gather"),i=Ep(t,"indices","gather","int32"),o={x:a,indices:i},s={axis:n,batchDims:r};return bp.runKernel(Yh,o,s)}});var Ig=Ap({greater_:function(e,t){var n=Ep(e,"a","greater"),r=Ep(t,"b","greater"),a=f(hp(n,r),2);n=a[0],r=a[1],xg(n.shape,r.shape);var i={a:n,b:r};return bp.runKernel(Qh,i)}});var Ag=Ap({greaterEqual_:function(e,t){var n=Ep(e,"a","greaterEqual"),r=Ep(t,"b","greaterEqual"),a=f(hp(n,r),2);n=a[0],r=a[1],xg(n.shape,r.shape);var i={a:n,b:r};return bp.runKernel(Zh,i)}});var Mg=Ap({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n=Ep(e,"x","leakyRelu"),r={x:n},a={alpha:t};return bp.runKernel(af,r,a)}});function Ng(e,t,n){if(n<=0)throw new Error("The number of values should be positive.");var r={start:e,stop:t,num:n};return bp.runKernel(uf,{},r)}var Rg=Ap({log_:function(e){var t={x:Ep(e,"x","log")};return bp.runKernel(cf,t)}});var Dg=Ap({exp_:function(e){var t={x:Ep(e,"x","exp")};return bp.runKernel(Vh,t)}});var Pg=Ap({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ep(e,"x","max"),a={x:r},i={reductionIndices:t,keepDims:n};return bp.runKernel(mf,a,i)}});var Og=Ap({sub_:function(e,t){var n=Ep(e,"a","sub"),r=Ep(t,"b","sub"),a=f(hp(n,r),2),i={a:n=a[0],b:r=a[1]};return bp.runKernel(vd,i)}});var Lg=Ap({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ep(e,"x","sum");"bool"===r.dtype&&(r=Ov(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return bp.runKernel(cd,a,i)}});var Fg=Ap({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Ep(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));var r=wm((function(e,n){var r=Pg(e,t,!0),a=Og(e,r),i=Og(Ov(a,"float32"),Rg(Lg(Dg(a),t,!0)));n([i]);return{value:i,gradFunc:function(e,n){var r=f(n,1)[0],a=Dg(r);return Og(e,Ym(Lg(e,t,!0),a))}}}));return r(n)}});var zg=Ap({logicalAnd_:function(e,t){var n=Ep(e,"a","logicalAnd","bool"),r=Ep(t,"b","logicalAnd","bool");xg(n.shape,r.shape);var a={a:n,b:r};return bp.runKernel(hf,a)}});var Bg=Ap({maxPool_:function(e,t,n,r,a){var i=Ep(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=jm(i,[1,i.shape[0],i.shape[1],i.shape[2]])),fl(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),fl(Wm(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")})),null!=a&&fl(yl(r),(function(){return"Error in maxPool: pad must be an integer when using, "+"dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=bp.runKernel(yf,u,c);return s?jm(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});var Ug=Ap({maxPool3d_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[1,1,1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NDHWC",o=arguments.length>6?arguments[6]:void 0;null==o?o=[1,1,1]:mm("dilations is deprecated, this field will be gone in v3.0.0.");var s=Ep(e,"x","maxPool3d"),u=s,c=!1;4===s.rank&&(c=!0,u=jm(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]])),fl(5===u.rank,(function(){return"Error in maxPool3d: x must be rank 5 but got rank ".concat(u.rank,".")})),fl("NDHWC"===i,(function(){return"Error in maxPool3d: Only NDHWC is currently supported, "+"but got dataFormat of ".concat(i)})),fl(Wm(n,o),(function(){return"Error in maxPool3d: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(o,"'")})),null!=a&&fl(yl(r),(function(){return"Error in maxPool3d: pad must be an integer when using, "+"dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var l={x:u},h={filterSize:t,strides:n,pad:r,dimRoundingMode:a,dataFormat:i,dilations:o},f=bp.runKernel(xf,l,h);return c?jm(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}});var Vg=Ap({maximum_:function(e,t){var n=Ep(e,"a","maximum"),r=Ep(t,"b","maximum"),a=f(hp(n,r),2);n=a[0],r=a[1],"bool"===n.dtype&&(n=Ov(n,"int32"),r=Ov(r,"int32")),xg(n.shape,r.shape);var i={a:n,b:r};return bp.runKernel(gf,i)}});var Wg=Ap({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ep(e,"x","mean"),a={x:r},i={axis:t,keepDims:n};return bp.runKernel(wf,a,i)}});var Gg=Ap({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ep(e,"x","min"),a={x:r},i={axis:t,keepDims:n};return bp.runKernel(_f,a,i)}});var jg=Ap({minimum_:function(e,t){var n=Ep(e,"a","minimum"),r=Ep(t,"b","minimum"),a=f(hp(n,r),2);n=a[0],r=a[1],"bool"===n.dtype&&(n=Ov(n,"int32"),r=Ov(r,"int32")),xg(n.shape,r.shape);var i={a:n,b:r};return bp.runKernel(Sf,i)}});function qg(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Hg(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}function Xg(e,t){return function(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}(e,t.map((function(e){return 1})),t)}function Kg(e,t,n){fl(qg(t,n),(function(){return"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input.")}))}function Yg(e,t){if(qg(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function Qg(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function Zg(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var Jg=Ap({square_:function(e){var t=Ep(e,"x","square");return bp.runKernel("Square",{x:t},{})}});var $g=Ap({moments_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=wl(t,(e=Ep(e,"x","moments")).shape),a=Wg(e,r,n),i=a.shape;n||(i=Xg(a.shape,r));var o=Jg(Og(Ov(e,"float32"),jm(a,i))),s=Wg(o,r,n);return{mean:a,variance:s}}});var ey=Ap({multiRNNCell_:function(e,t,n,r){for(var a=Ep(t,"data","multiRNNCell"),i=Ip(n,"c","multiRNNCell"),o=Ip(r,"h","multiRNNCell"),s=a,u=[],c=0;c<e.length;c++){var l=e[c](s,i[c],o[c]);u.push(l[0]),u.push(l[1]),s=l[1]}for(var h=[],f=[],d=0;d<u.length;d+=2)h.push(u[d]),f.push(u[d+1]);return[h,f]}});var ty=Ap({multinomial_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Ep(e,"logits","multinomial"),i=a.size,o=a.rank;if(i<2)throw new Error("Error in multinomial: you need at least 2 outcomes, but got "+"".concat(i,"."));if(o>2)throw new Error("Rank of probabilities must be 1 or 2, but is ".concat(o));n=n||Math.random();var s=1===o?jm(a,[1,-1]):a,u={logits:s},c={numSamples:t,seed:n,normalized:r},l=bp.runKernel(Ef,u,c);return 1===o?jm(l,[l.size]):l}});var ny=Ap({neg_:function(e){var t={x:Ep(e,"x","neg")};return bp.runKernel(Af,t)}});var ry=Ap({notEqual_:function(e,t){var n=Ep(e,"a","notEqual"),r=Ep(t,"b","notEqual"),a=f(hp(n,r),2);n=a[0],r=a[1],xg(n.shape,r.shape);var i={a:n,b:r};return bp.runKernel(Mf,i)}});var ay=Ap({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var a=Ep(e,"indices","oneHot","int32"),i={indices:a},o={depth:t,onValue:n,offValue:r};return bp.runKernel(Of,i,o)}});function iy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=iy(e,"float32"),r=iy(e,"float32");return Mp(n,r)}var a=zl(ml(e),t);return bp.makeTensor(a,e,t)}function oy(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=oy(e,"float32"),r=iy(e,"float32");return Mp(n,r)}var a=Fl(ml(e),t);return bp.makeTensor(a,e,t)}var sy=Ap({onesLike_:function(e){var t={x:Ep(e,"x","onesLike")};return bp.runKernel(Pf,t)}});var uy=Ap({outerProduct_:function(e,t){var n=Ep(e,"v1","outerProduct"),r=Ep(t,"v2","outerProduct");fl(1===n.rank&&1===r.rank,(function(){return"Error in outerProduct: inputs must be rank 1, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=jm(n,[-1,1]),i=jm(r,[1,-1]);return Km(a,i)}});var cy=Ap({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Ep(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},i={x:r};return bp.runKernel(Ff,i,a)}});var ly=Ap({prelu_:function(e,t){var n={x:Ep(e,"x","prelu"),alpha:Ep(t,"alpha","prelu")};return bp.runKernel(Bf,n)}}),hy=__webpack_require__(6699),fy=function(){function e(t,n,r,a,i){$n(this,e),this.mean=t,this.stdDev=n,this.dtype=r,this.nextVal=NaN,this.truncated=a,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);var o=i||Math.random();this.random=hy.alea(o.toString())}return Jn(e,[{key:"nextValue",value:function(){if(!isNaN(this.nextVal)){var e=this.nextVal;return this.nextVal=NaN,e}for(var t,n,r=!1;!r;){var a=void 0,i=void 0,o=void 0;do{o=(a=2*this.random()-1)*a+(i=2*this.random()-1)*i}while(o>=1||0===o);var s=Math.sqrt(-2*Math.log(o)/o);t=this.mean+this.stdDev*a*s,n=this.mean+this.stdDev*i*s,this.truncated&&!this.isValidTruncated(t)||(r=!0)}return this.truncated&&!this.isValidTruncated(n)||(this.nextVal=this.convertValue(n)),this.convertValue(t)}},{key:"convertValue",value:function(e){return null==this.dtype||"float32"===this.dtype?e:Math.round(e)}},{key:"isValidTruncated",value:function(e){return e<=this.upper&&e>=this.lower}}]),e}(),dy=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,a=arguments.length>2?arguments[2]:void 0,i=arguments.length>3?arguments[3]:void 0;if($n(this,e),this.canReturnFloat=function(){return null==t.dtype||"float32"===t.dtype},this.min=n,this.range=r-n,this.dtype=a,null==i&&(i=Math.random()),"number"===typeof i&&(i=i.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error("The difference between ".concat(n," - ").concat(r," <= 1 and dtype is not float"));this.random=hy.alea(i)}return Jn(e,[{key:"convertValue",value:function(e){return this.canReturnFloat()?e:Math.round(e)}},{key:"nextValue",value:function(){return this.convertValue(this.min+this.range*this.random())}}]),e}();var py=Ap({randomNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type ".concat(r));for(var i=new fy(t,n,r,!1,a),o=Pv(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var vy=Ap({randomUniform_:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32",a=arguments.length>4?arguments[4]:void 0,i=Pv(e,r),o=new dy(t,n,null,a),s=0;s<i.values.length;s++)i.values[s]=o.nextValue();return i.toTensor()}});var my=Ap({relu_:function(e){var t={x:Ep(e,"x","relu")};return bp.runKernel(jf,t)}});var gy=Ap({reverse_:function(e,t){var n={x:Ep(e,"x","reverse")},r={dims:t};return bp.runKernel(Zf,n,r)}});var yy=Ap({rsqrt_:function(e){var t={x:Ep(e,"x","rsqrt")};return bp.runKernel($f,t)}});var by=Ap({selu_:function(e){var t={x:Ep(e,"x","selu")};return bp.runKernel(td,t)}});var xy=Ap({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=Ep(e,"x","separableConv2d"),u=Ep(t,"depthwiseFilter","separableConv2d"),c=Ep(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=jm(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");fl(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")})),fl(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),fl(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),fl(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")})),fl(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")}));var f=u.shape[2],d=u.shape[3];fl(c.shape[2]===f*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(f*d,", ")+"but got ".concat(c.shape[2],".")}));var p=vg(l,u,r,a,o,i),v=1,m=lg(p,c,v,"valid",o);return h?jm(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});var ky=Ap({slice1d_:function(e,t,n){var r=Ep(e,"x","slice1d");return fl(1===r.rank,(function(){return"slice1d expects a rank-1 tensor, but got a rank-".concat(r.rank," tensor")})),Zm(r,[t],[n])}});var wy=Ap({slice2d_:function(e,t,n){var r=Ep(e,"x","slice2d");return fl(2===r.rank,(function(){return"slice2d expects a rank-2 tensor, but got a rank-".concat(r.rank," tensor")})),Zm(r,t,n)}});var _y=Ap({slice3d_:function(e,t,n){var r=Ep(e,"x","slice3d");return fl(3===r.rank,(function(){return"slice3d expects a rank-3 tensor, but got a rank-".concat(r.rank," tensor")})),Zm(r,t,n)}});var Sy=Ap({slice4d_:function(e,t,n){var r=Ep(e,"x","slice4d");return fl(4===r.rank,(function(){return"slice4d expects a rank-4 tensor, but got a rank-".concat(r.rank," tensor")})),Zm(r,t,n)}});var Cy=Ap({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=Ep(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return bp.runKernel(fd,r,a)}});var Ty=Ap({softplus_:function(e){var t={x:Ep(e,"x","softplus")};return bp.runKernel(sd,t)}});var Ey=Ap({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Ep(e,"x","split"),a={x:r},i={numOrSizeSplits:t,axis:n};return bp.runKernel(hd,a,i)}});var Iy=Ap({sqrt_:function(e){var t={x:Ep(e,"x","sqrt")};return bp.runKernel(ud,t)}});var Ay=Ap({squeeze_:function(e,t){var n=Ep(e,"x","squeeze");return jm(n,_l(n.shape,t).newShape)}});var My=Ap({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ip(e,"tensors","stack","string_or_numeric");fl(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&fl(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return bp.runKernel(Lf,r,a)}});function Ny(e,t){pl(e);var n=Sp(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Np(e,null,n,t)}var Ry=Ap({truncatedNormal_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;if(null!=r&&"bool"===r)throw new Error("Unsupported data type $ { dtype }");for(var i=new fy(t,n,r,!0,a),o=Pv(e,r),s=0;s<o.values.length;s++)o.values[s]=i.nextValue();return o.toTensor()}});var Dy=Ap({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ep(e,"x","unstack","string_or_numeric");fl(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return bp.runKernel(_d,r,a)}});function Py(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;return bp.makeVariable(e,t,n,r)}var Oy=Ap({broadcastTo_:function(e,t){var n=Ep(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!==0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=jm(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));var u=o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));if(0===u.length)return Lv(n);var c={x:n},l={reps:o};return bp.runKernel(bd,c,l)}});var Ly=Ap({where_:function(e,t,n){var r=Ep(t,"a","where"),a=Ep(n,"b","where"),i=Ep(e,"condition","where","bool"),o=xg(r.shape,a.shape),s=Oy(r,o),u=Oy(a,o);1===i.rank&&fl(i.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})),1!==i.rank&&dl(i.shape,u.shape,"Error in where: ");var c={condition:i,t:s,e:u};return bp.runKernel(ed,c)}});var Fy=Ap({zerosLike_:function(e){var t={x:Ep(e,"x","zerosLike")};return bp.runKernel(Cd,t)}});var zy=Ap({mod_:function(e,t){var n=Ep(e,"a","mod"),r=Ep(t,"b","mod"),a=f(hp(n,r),2),i={a:n=a[0],b:r=a[1]};return bp.runKernel(Tf,i)}});var By=Ap({pow_:function(e,t){var n=Ep(e,"base","pow"),r=Ep(t,"exp","pow"),a=f(hp(n,r),2),i={a:n=a[0],b:r=a[1]};return bp.runKernel(zf,i)}});var Uy=Ap({squaredDifference_:function(e,t){var n=Ep(e,"a","squaredDifference"),r=Ep(t,"b","squaredDifference"),a=f(hp(n,r),2);n=a[0],r=a[1],xg(n.shape,r.shape);var i={a:n,b:r};return bp.runKernel(dd,i,{})}});var Vy=Ap({addStrict_:function(e,t){mm("strict variants of ops have been deprecated and will be removed in future");var n=Ep(e,"a","addStrict"),r=Ep(t,"b","addStrict");return dl(n.shape,r.shape,"Error in addStrict: "),Tm(n,r)}}),Wy=Ap({divStrict_:function(e,t){mm("strict variants of ops have been deprecated and will be removed in future");var n=Ep(e,"a","div"),r=Ep(t,"b","div");return dl(n.shape,r.shape,"Error in divideStrict: "),gg(n,r)}}),Gy=Ap({maximumStrict_:function(e,t){mm("strict variants of ops have been deprecated and will be removed in future");var n=Ep(e,"a","maximumStrict"),r=Ep(t,"b","maximumStrict");return dl(n.shape,r.shape,"Error in maximumStrict: "),Vg(n,r)}}),jy=Ap({minimumStrict_:function(e,t){mm("strict variants of ops have been deprecated and will be removed in future");var n=Ep(e,"a","minimumStrict"),r=Ep(t,"b","minimumStrict");return dl(n.shape,r.shape,"Error in minimumStrict: "),jg(n,r)}}),qy=Ap({modStrict_:function(e,t){mm("strict variants of ops have been deprecated and will be removed in future");var n=Ep(e,"a","modStrict"),r=Ep(t,"b","modStrict");return dl(n.shape,r.shape,"Error in modStrict: "),zy(n,r)}}),Hy=Ap({mulStrict_:function(e,t){mm("strict variants of ops have been deprecated and will be removed in future");var n=Ep(e,"a","mul"),r=Ep(t,"b","mul");return dl(n.shape,r.shape,"Error in multiplyStrict: "),Ym(n,r)}}),Xy=Ap({powStrict_:function(e,t){return mm("strict variants of ops have been deprecated and will be removed in future"),dl(e.shape,t.shape,"Error in powStrict: "),By(e,t)}}),Ky=Ap({squaredDifferenceStrict_:function(e,t){mm("strict variants of ops have been deprecated and will be removed in future");var n=Ep(e,"a","squaredDifferenceStrict"),r=Ep(t,"b","squaredDifferenceStrict");return dl(n.shape,r.shape,"Error in squaredDifferenceStrict: "),Uy(n,r)}}),Yy=Ap({subStrict_:function(e,t){mm("strict variants of ops have been deprecated and will be removed in future");var n=Ep(e,"a","subStrict"),r=Ep(t,"b","subStrict");return dl(n.shape,r.shape,"Error in subStrict: "),Og(n,r)}});var Qy=Ap({transpose_:function(e,t){var n=Ep(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),fl(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(t,".")})),t.forEach((function(e){fl(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(t)}))})),n.rank<=1)return n.clone();var r={x:n},a={perm:t};return bp.runKernel(kd,r,a)}});var Zy=Ap({dropout_:function(e,t,n,r){var a=Ep(e,"x","dropout");if(fl("float32"===a.dtype,(function(){return"x has to be a floating point tensor since it's going to be "+"scaled, but got a ".concat(a.dtype," tensor instead.")})),fl(t>=0&&t<1,(function(){return"rate must be a float in the range [0, 1), but got ".concat(t,".")})),0===t)return e instanceof tp?a.clone():a;var i=function(e,t){if(null==t)return e.shape.slice();if(gl(e.shape,t))return t;if(e.shape.length===t.length){for(var n=[],r=0;r<e.shape.length;r++)null==t[r]&&null!=e.shape[r]?n.push(e.shape[r]):n.push(t[r]);return n}return t}(a,n),o=1-t,s=gg(Tg(Tm(vy(i,0,1,"float32",r),o)),o);return Ym(a,s)}});var Jy=Ap({imag_:function(e){var t={input:Ep(e,"input","imag")};return bp.runKernel(ef,t)}});var $y=Ap({real_:function(e){var t={input:Ep(e,"input","real")};return bp.runKernel(Wf,t)}});var eb=Ap({fft_:function(e){fl("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return bp.runKernel("FFT",t)}});var tb=Ap({rfft_:function(e,t){fl("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=Zm(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=Xm([e,iy(s)],e.shape.length-1),r=t}else n=e;var u=Fy(n),c=jm(Mp(n,u),[a,r]),l=eb(c),h=Math.floor(r/2)+1,f=$y(l),d=Jy(l),p=Ey(f,[h,r-h],f.shape.length-1),v=Ey(d,[h,r-h],d.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=h,jm(Mp(p[0],v[0]),m)}});var nb=Ap({ifft_:function(e){fl("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return bp.runKernel($h,t)}});var rb=Ap({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=jm(e,[r,n]);t=nb(a)}else{var i=[r,2*(n-1)],o=jm($y(e),[r,n]),s=jm(Jy(e),[r,n]),u=gy(Zm(o,[0,1],[r,n-2]),1),c=Ym(gy(Zm(s,[0,1],[r,n-2]),1),_m(-1)),l=Xm([o,u],1),h=Xm([s,c],1),f=jm(Mp(l,h),[i[0],i[1]]);t=nb(f)}if(t=$y(t),3===e.rank&&0!==e.shape[0]){var d=t,p=e.shape[0];t=jm(t,[p,t.shape[0]/p,t.shape[1]]),d.dispose()}return t}});var ab=Ap({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=jm(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=jm(t,[1,t.shape[0],t.shape[1],t.shape[2]])),fl(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")})),fl(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")})),fl(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,".")}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];fl(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(n[2],".")})),fl(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(n[3],").")})),null!=o&&fl(yl(a),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(a,".")}));var h={x:s,dy:u},f={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return bp.runKernel(wh,h,f)}});var ib=Ap({relu6_:function(e){var t={x:Ep(e,"x","relu6")};return bp.runKernel(Qf,t)}});var ob=Ap({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ep(e,"x","step"),r={x:n},a={alpha:t};return bp.runKernel(Td,r,a)}});function sb(e,t,n){if(null==n||"linear"===n)return e;if("relu"===n)return Ym(e,ob(t));throw new Error("Cannot compute gradient for fused activation ".concat(n,"."))}function ub(e,t){var n=t,r=bg(e.shape,t.shape);return r.length>0&&(n=Lg(n,r)),jm(n,e.shape)}function cb(e,t,n,r){if("linear"===t)return e;if("relu"===t)return my(e);if("elu"===t)return yg(e);if("relu6"===t)return ib(e);if("prelu"===t)return ly(e,n);if("leakyrelu"===t)return Mg(e,r);throw new Error("Unknown fused activation ".concat(t,"."))}var lb=function(e,t){return!(e>0)||"linear"===t};var hb=Ap({fusedConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,h=e.activation,d=void 0===h?"linear":h,p=e.preluActivationWeights,v=e.leakyreluAlpha;if(d=d||"linear",!1===lb(bp.state.gradientDepth,d)){var m=lg(t,n,r,a,o,u,c);return null!=l&&(m=Tm(m,l)),cb(m,d,p,v)}var g=Ep(t,"x","conv2d"),y=Ep(n,"filter","conv2d"),b=g,x=!1;3===g.rank&&(x=!0,b=jm(g,[1,g.shape[0],g.shape[1],g.shape[2]])),fl(4===b.rank,(function(){return"Error in fused conv2d: input must be rank 4, but got rank "+"".concat(b.rank,".")})),fl(4===y.rank,(function(){return"Error in fused conv2d: filter must be rank 4, but got rank "+"".concat(y.rank,".")})),null!=c&&fl(yl(a),(function(){return"Error in fused conv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(c," but got pad ").concat(a,".")})),fl(b.shape[3]===y.shape[2],(function(){return"Error in conv2d: depth of input (".concat(b.shape[3],") must match ")+"input depth for filter ".concat(y.shape[2],".")})),fl(Wm(r,u),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(r," and dilations '").concat(u,"'")})),fl("NHWC"===o,(function(){return"Error in conv2d: got dataFormat of ".concat(o," but only NHWC is currently supported.")}));var k,w,_=Rm(b.shape,y.shape,r,u,a,c);null!=l&&(k=f(hp(k=Ep(l,"bias","fused conv2d"),g),1)[0],xg(_.outShape,k.shape)),null!=p&&(w=Ep(p,"prelu weights","fused conv2d"));var S=function(e,t){var n=f(t,4),i=n[0],o=n[1],s=n[2],c=n[3],l=sb(e,s,d);fl(Vm(u),(function(){return"Error in gradient of fused conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(u,"'")}));var h=[fg(o.shape,l,i,r,a),ab(o,l,i.shape,r,a)];if(null!=c){var p=ub(c,l);h.push(p)}return h},C={x:b,filter:y,bias:k,preluActivationWeights:w},T={strides:r,pad:a,dataFormat:o,dilations:u,dimRoundingMode:c,activation:d,leakyreluAlpha:v};if(null==l){var E=wm((function(e,t,n){var r=bp.runKernel(Ad,C,T);return n([t,e,r]),x&&(r=jm(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:S}}));return E(b,y)}var I=wm((function(e,t,n,r){var a=bp.runKernel(Ad,C,T);return r([t,e,a,n]),x&&(a=jm(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:S}}));return I(b,y,k)}});var fb=Ap({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=jm(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=jm(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return bp.runKernel(Dh,c,l)}});var db=Ap({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=jm(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},h=bp.runKernel(Ph,c,l);return u?jm(h,[h.shape[1],h.shape[2],h.shape[3]]):h}});Ap({fusedDepthwiseConv2d_:function(e){var t=e.x,n=e.filter,r=e.strides,a=e.pad,i=e.dataFormat,o=void 0===i?"NHWC":i,s=e.dilations,u=void 0===s?[1,1]:s,c=e.dimRoundingMode,l=e.bias,h=e.activation,d=void 0===h?"linear":h,p=e.preluActivationWeights,v=e.leakyreluAlpha;if(!1===lb(bp.state.gradientDepth,d)){var m=vg(t,n,r,a,o,u,c);return null!=l&&(m=Tm(m,l)),cb(m,d,p,v)}var g=Ep(t,"x","depthwiseConv2d"),y=Ep(n,"filter","depthwiseConv2d"),b=g,x=!1;3===g.rank&&(x=!0,b=jm(g,[1,g.shape[0],g.shape[1],g.shape[2]])),fl(4===b.rank,(function(){return"Error in fused depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(b.rank,".")})),fl(4===y.rank,(function(){return"Error in fused depthwiseConv2d: filter must be rank 4, "+"but got rank ".concat(y.rank,".")})),fl(b.shape[3]===y.shape[2],(function(){return"Error in fused depthwiseConv2d: number of input channels "+"(".concat(b.shape[3],") must match the inChannels dimension in ")+"filter ".concat(y.shape[2],".")})),null==u&&(u=[1,1]),fl(Wm(r,u),(function(){return"Error in fused depthwiseConv2d: Either strides or dilations must "+"be 1. Got strides ".concat(r," and dilations '").concat(u,"'")})),null!=c&&fl(yl(a),(function(){return"Error in fused depthwiseConv2d: pad must be an integer when "+"using dimRoundingMode ".concat(c," but got pad ").concat(a,".")}));var k,w,_=Rm(b.shape,y.shape,r,u,a,c,!0);if(null!=l){var S=f(hp(k=Ep(l,"bias","fused conv2d"),g),1);k=S[0],xg(_.outShape,k.shape)}null!=p&&(w=Ep(p,"prelu weights","fused depthwiseConv2d"));var C=function(e,t){fl(Vm(u),(function(){return"Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(u,"'")}));var n=f(t,4),i=n[0],o=n[1],s=n[2],l=n[3],h=sb(e,s,d),p=db(o.shape,h,i,r,a,u,c),v=fb(o,h,i.shape,r,a,u,c);return null!=l?[p,v,ub(k,h)]:[p,v]},T={x:b,filter:y,bias:k,preluActivationWeights:w},E={strides:r,pad:a,dataFormat:o,dilations:u,dimRoundingMode:c,activation:d,leakyreluAlpha:v};if(null==l){var I=wm((function(e,t,n){var r=bp.runKernel(Md,T,E);return n([t,e,r]),x&&(r=jm(r,[r.shape[1],r.shape[2],r.shape[3]])),{value:r,gradFunc:C}}));return I(b,y)}var A=wm((function(e,t,n,r){var a=bp.runKernel(Md,T,E);return r([t,e,a,n]),x&&(a=jm(a,[a.shape[1],a.shape[2],a.shape[3]])),{value:a,gradFunc:C}}));return A(b,y,k)}});var pb=Ap({fusedMatMul_:function(e){var t=e.a,n=e.b,r=e.transposeA,a=void 0!==r&&r,i=e.transposeB,o=void 0!==i&&i,s=e.bias,u=e.activation,c=void 0===u?"linear":u,l=e.preluActivationWeights,h=e.leakyreluAlpha;if(!1===lb(bp.state.gradientDepth,c)){var d=Km(t,n,a,o);return null!=s&&(d=Tm(d,s)),cb(d,c,l,h)}var p=Ep(t,"a","fused matMul"),v=Ep(n,"b","fused matMul"),m=f(hp(p,v),2);p=m[0],v=m[1];var g=a?p.shape[p.rank-2]:p.shape[p.rank-1],y=o?v.shape[v.rank-1]:v.shape[v.rank-2],b=a?p.shape[p.rank-1]:p.shape[p.rank-2],x=o?v.shape[v.rank-2]:v.shape[v.rank-1],k=p.shape.slice(0,-2),w=v.shape.slice(0,-2),_=ml(k),S=ml(w);fl(p.rank>=2&&v.rank>=2&&p.rank===v.rank,(function(){return"Error in fused matMul: inputs must have the same rank of at "+"least 2, got ranks ".concat(p.rank," and ").concat(v.rank,".")})),fl(gl(k,w),(function(){return"Error in fused matMul: outer dimensions (".concat(k,") and (")+"".concat(w,") of Tensors with shapes ").concat(p.shape," and ")+"".concat(v.shape," must match.")})),fl(g===y,(function(){return"Error in fused matMul: inner shapes (".concat(g,") and (")+"".concat(y,") of Tensors with shapes ").concat(p.shape," and ")+"".concat(v.shape," and transposeA=").concat(a)+" and transposeB=".concat(o," must match.")}));var C,T,E=p.shape.slice(0,-2).concat([b,x]),I=jm(p,a?[_,g,b]:[_,b,g]),A=jm(v,o?[S,x,y]:[S,y,x]);null!=s&&(C=f(hp(C=Ep(s,"bias","fused matMul"),p),1)[0],xg(E,C.shape)),null!=l&&(T=Ep(l,"prelu weights","fused matMul"));var M=function(e,t){var n,r,i=f(t,4),u=i[0],l=i[1],h=i[2],d=i[3],p=sb(jm(e,h.shape),h,c);return a||o?!a&&o?(n=Km(p,l,!1,!1),r=Km(p,u,!0,!1)):a&&!o?(n=Km(l,p,!1,!0),r=Km(u,p,!1,!1)):(n=Km(l,p,!0,!0),r=Km(p,u,!0,!0)):(n=Km(p,l,!1,!0),r=Km(u,p,!0,!1)),null!=s?[n,r,ub(d,p)]:[n,r]},N={a:I,b:A,bias:C,preluActivationWeights:T},R={transposeA:a,transposeB:o,activation:c,leakyreluAlpha:h};if(null==s){var D=wm((function(e,t,n){var r=bp.runKernel(Id,N,R);return n([e,t,r]),{value:jm(r,E),gradFunc:M}}));return D(I,A)}var P=wm((function(e,t,n,r){var a=bp.runKernel(Id,N,R);return r([e,t,a,n]),{value:jm(a,E),gradFunc:M}}));return P(I,A,C)}});function vb(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function mb(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return Ny(a,"float32")}Ap({hammingWindow_:function(e){return mb(e,.54,.46)}});var gb=Ap({hannWindow_:function(e){return mb(e,.5,.5)}});function yb(e,t,n){if(pl(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Sp(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Np(e,t,r,n)}var bb=Ap({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(Zm(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=Xm([Zm(e,i,t-s),Cg([s],a)]);o.push(u),i+=n}return 0===o.length?yb([],[0,t]):jm(Xm(o),[o.length,t])}});Ap({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:gb;null==r&&(r=vb(t));for(var i=bb(e,t,n),o=Ym(i,a(t)),s=[],u=0;u<i.shape[0];u++)s.push(tb(Zm(o,[u,0],[1,t]),r));return Xm(s)}});Ap({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Ep(e,"image","cropAndResize"),s=Ep(t,"boxes","cropAndResize","float32"),u=Ep(n,"boxInd","cropAndResize","int32"),c=s.shape[0];fl(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),fl(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")})),fl(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")})),fl(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")})),fl(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),fl("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:o,boxes:s,boxInd:u},h={method:a,extrapolationValue:i,cropSize:r},f=bp.runKernel(Mh,l,h);return f}});Ap({flipLeftRight_:function(e){var t=Ep(e,"image","flipLeftRight","float32");fl(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,".")}));var n={image:t};return bp.runKernel(qh,n,{})}});Ap({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=Ep(e,"image","rotateWithOffset","float32");fl(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r},s=bp.runKernel(Ed,i,o);return s}});function xb(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),fl(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),fl(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),fl(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),fl(1===t.rank,(function(){return"scores must be a 1D tensor"})),fl(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(t.shape[0])})),fl(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}Ap({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=Ep(e,"boxes","nonMaxSuppression"),o=Ep(t,"scores","nonMaxSuppression"),s=xb(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return bp.runKernel(Nf,{boxes:i,scores:o},u)}});function kb(e,t,n){var r=function(e,t,n){return function(e,t,n){var r=0,a=e.length,i=0,o=!1;for(;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||wb)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function wb(e,t){return e>t?1:e<t?-1:0}function _b(e,t,n,r,a){return Tb(e,t,n,r,a,0)}function Sb(e,t,n,r,a,i){return Tb(e,t,n,r,a,0,!1,i,!0)}function Cb(e,t,n,r,a,i){return Tb(e,t,n,r,a,i,!0)}function Tb(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(Ab);for(var h=i>0?-.5/i:0,f=[],d=[];f.length<n&&c.length>0;){var p=c.pop(),v=p.score,m=p.boxIndex,g=p.suppressBeginIndex;if(v<a)break;for(var y=!1,b=f.length-1;b>=g;--b){var x=Eb(e,m,f[b]);if(x>=r){y=!0;break}if(p.score=p.score*Ib(r,h,x),p.score<=a)break}p.suppressBeginIndex=f.length,y||(p.score===v?(f.push(m),d.push(p.score)):p.score>a&&kb(c,p,Ab))}var k=f.length,w=n-k;s&&w>0&&(f.push.apply(f,Tt(new Array(w).fill(0))),d.push.apply(d,Tt(new Array(w).fill(0))));var _={selectedIndices:f};return o&&(_.selectedScores=d),u&&(_.validOutputs=k),_}function Eb(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),f=Math.max(a[1],a[3]),d=(s-i)*(u-o),p=(h-c)*(f-l);if(d<=0||p<=0)return 0;var v=Math.max(i,c),m=Math.max(o,l),g=Math.min(s,h),y=Math.min(u,f),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(d+p-b)}function Ib(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Ab(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}Ap({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Ep(e,"boxes","nonMaxSuppression"),s=Ep(t,"scores","nonMaxSuppression"),u=xb(o,s,n,r,a,i),c={boxes:o,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},h=bp.runKernel(Df,c,l);return{selectedIndices:h[0],selectedScores:h[1]}}});Ap({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Ep(e,"boxes","nonMaxSuppression"),s=Ep(t,"scores","nonMaxSuppression"),u=xb(o,s,n,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,h=u.scoreThreshold,f={boxes:o,scores:s},d={maxOutputSize:c,iouThreshold:l,scoreThreshold:h,padToMaxOutputSize:i},p=bp.runKernel(Rf,f,d);return{selectedIndices:p[0],validOutputs:p[1]}}});function Mb(e){return u(e)||Ct(e)||l(e)||h()}var Nb=Ap({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Ep(e,"images","resizeBilinear");fl(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),fl(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")})),fl(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=jm(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Mb(t);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=bp.runKernel(Kf,s,u);return o?jm(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var Rb=Ap({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Ep(e,"images","resizeNearestNeighbor");fl(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),fl(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")})),fl("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),fl(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=jm(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Mb(t);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=bp.runKernel(Hf,s,u);return o?jm(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var Db=Ap({lessEqual_:function(e,t){var n=Ep(e,"a","lessEqual"),r=Ep(t,"b","lessEqual"),a=f(hp(n,r),2);n=a[0],r=a[1],xg(n.shape,r.shape);var i={a:n,b:r};return bp.runKernel(sf,i)}});function Pb(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return bp.runKernel(Vf,{},a)}var Ob=Ap({bandPart_:function(e,t,n){fl(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),fl(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=Ep(e,"a","bandPart");fl(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,i=f(r.shape.slice(-2),2),o=i[0],s=i[1];if(!(t<=o))throw new Error("bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(o,")."));if(!(n<=s))throw new Error("bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(s,")."));t<0&&(t=o),n<0&&(n=s);var u=jm(Pb(0,o,1,"int32"),[-1,1]),c=Pb(0,s,1,"int32"),l=Og(u,c),h=zg(Db(l,_m(+t,"int32")),Ag(l,_m(-n,"int32"))),d=iy([o,s],r.dtype);return jm(My(Dy(jm(r,[-1,o,s])).map((function(e){return Ly(h,e,d)}))),a)}});function Lb(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return Cm(e);if(1!==e.rank&&null===n)return Lb(jm(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return Lg(Cm(e),n);if(t===1/0)return Pg(Cm(e),n);if(t===-1/0)return Gg(Cm(e),n);if("euclidean"===t||2===t)return Iy(Lg(By(Cm(e),_m(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return Pg(Lg(Cm(e),n[0]),n[1]-1);if(t===1/0)return Pg(Lg(Cm(e),n[1]),n[0]);if(t===-1/0)return Gg(Lg(Cm(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return Iy(Lg(Jg(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var Fb=Ap({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Lb(e=Ep(e,"x","norm"),t,n),i=a.shape;if(r){var o=wl(n,e.shape);i=Xg(a.shape,o)}return jm(a,i)}});var zb=Ap({gramSchmidt_:function(e){var t;Array.isArray(e)?function(){t=!1,fl(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){fl(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}():(t=!0,e=Ey(e,e.shape[0],0).map((function(e){return Ay(e,[0])}))),fl(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],").")}));for(var n=[],r=e,a=function(e){n.push(bp.tidy((function(){var t=r[e];if(e>0)for(var a=0;a<e;++a){var i=Ym(Lg(Ym(n[a],t)),n[a]);t=Og(t,i)}return gg(t,Fb(t,"euclidean"))})))},i=0;i<e.length;++i)a(i);return t?My(n,0):n}});function Bb(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return bp.tidy((function(){fl(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=Sg(n),i=Lv(e),o=yb([[1]],[1,1]),s=Lv(o),u=n>=r?r:n,c=function(e){var t=i,u=s,c=a,l=f(bp.tidy((function(){var t=Zm(i,[e,e],[n-e,1]),u=Fb(t),c=Zm(i,[e,e],[1,1]),l=Ly(Ig(c,0),yb([[-1]]),yb([[1]])),h=Og(c,Ym(l,u)),f=gg(t,h);s=1===f.shape[0]?Lv(o):Xm([o,Zm(f,[1,0],[f.shape[0]-1,f.shape[1]])],0);var d=ny(gg(Km(l,h),u)),p=Zm(i,[e,0],[n-e,r]),v=Ym(d,s),m=Qy(s);if(0===e)i=Og(p,Km(v,Km(m,p)));else{var g=Og(p,Km(v,Km(m,p)));i=Xm([Zm(i,[0,0],[e,r]),g],0)}var y=Qy(v),b=Zm(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=Og(b,Km(Km(b,s),y));else{var x=Og(b,Km(Km(b,s),y));a=Xm([Zm(a,[0,0],[n,e]),x],1)}return[s,i,a]})),3);s=l[0],i=l[1],a=l[2],xm([t,u,c])},l=0;l<u;++l)c(l);return!t&&n>r&&(a=Zm(a,[0,0],[n,r]),i=Zm(i,[0,0],[r,r])),[a,i]}))}var Ub,Vb=Ap({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(fl(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return Bb(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=Dy(jm(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];r.forEach((function(e){var n=f(Bb(e,t),2),r=n[0],o=n[1];a.push(r),i.push(o)}));var o=jm(My(a,0),e.shape),s=jm(My(i,0),e.shape);return[o,s]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(Ub||(Ub={}));var Wb=Ap({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Ub.SUM_BY_NONZERO_WEIGHTS,r=Ep(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=Ep(t,"weights","computeWeightedLoss"));var i=null==a?r:Ym(r,a);if(n===Ub.NONE)return i;if(n===Ub.SUM)return Lg(i);if(n===Ub.MEAN){if(null==a)return Wg(i);var o=r.size/a.size,s=gg(Lg(i),Lg(a));return o>1?gg(s,_m(o)):s}if(n===Ub.SUM_BY_NONZERO_WEIGHTS){if(null==a)return gg(Lg(i),_m(r.size));var u=Ym(a,oy(r.shape)),c=Ov(Lg(ry(u,_m(0))),"float32");return gg(Lg(i),c)}throw Error("Unknown reduction: ".concat(n))}});Ap({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ub.SUM_BY_NONZERO_WEIGHTS,a=Ep(e,"labels","absoluteDifference"),i=Ep(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=Ep(n,"weights","absoluteDifference")),dl(a.shape,i.shape,"Error in absoluteDifference: ");var s=Cm(Og(a,i));return Wb(s,o,r)}});Ap({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ub.SUM_BY_NONZERO_WEIGHTS,i=Ep(e,"labels","cosineDistance"),o=Ep(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Ep(r,"weights","cosineDistance")),dl(i.shape,o.shape,"Error in cosineDistance: ");var u=_m(1),c=Og(u,Lg(Ym(i,o),n,!0));return Wb(c,s,a)}});Ap({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ub.SUM_BY_NONZERO_WEIGHTS,a=Ep(e,"labels","hingeLoss"),i=Ep(t,"predictions","hingeLoss"),o=null;null!=n&&(o=Ep(n,"weights","hingeLoss")),dl(a.shape,i.shape,"Error in hingeLoss: ");var s=_m(1);a=Og(Ym(_m(2),a),s);var u=my(Og(s,Ym(a,i)));return Wb(u,o,r)}});Ap({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ub.SUM_BY_NONZERO_WEIGHTS,i=Ep(e,"labels","huberLoss"),o=Ep(t,"predictions","huberLoss"),s=null;null!=n&&(s=Ep(n,"weights","huberLoss")),dl(i.shape,o.shape,"Error in huberLoss: ");var u=_m(r),c=Cm(Og(o,i)),l=jg(c,u),h=Og(c,l),f=Tm(Ym(_m(.5),Jg(l)),Ym(u,h));return Wb(f,s,a)}});Ap({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ub.SUM_BY_NONZERO_WEIGHTS,i=Ep(e,"labels","logLoss"),o=Ep(t,"predictions","logLoss"),s=null;null!=n&&(s=Ep(n,"weights","logLoss")),dl(i.shape,o.shape,"Error in logLoss: ");var u=_m(1),c=_m(r),l=ny(Ym(i,Rg(Tm(o,c)))),h=Ym(Og(u,i),Rg(Tm(Og(u,o),c))),f=Og(l,h);return Wb(f,s,a)}});Ap({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ub.SUM_BY_NONZERO_WEIGHTS,a=Ep(e,"labels","meanSquaredError"),i=Ep(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=Ep(n,"weights","meanSquaredError")),dl(a.shape,i.shape,"Error in meanSquaredError: ");var s=Uy(a,i);return Wb(s,o,r)}});var Gb=Ap({log1p_:function(e){var t={x:Ep(e,"x","log1p")};return bp.runKernel(lf,t)}});function jb(e,t){var n=Ep(e,"labels","sigmoidCrossEntropyWithLogits"),r=Ep(t,"logits","sigmoidCrossEntropyWithLogits");dl(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=my(r),i=Ym(r,n),o=Gb(Dg(ny(Cm(r))));return Tm(Og(a,i),o)}Ap({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ub.SUM_BY_NONZERO_WEIGHTS,i=Ep(e,"multiClassLabels","sigmoidCrossEntropy"),o=Ep(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Ep(n,"weights","sigmoidCrossEntropy")),dl(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=_m(r),c=_m(1),l=_m(.5);i=Tm(Ym(i,Og(c,u)),Ym(l,u))}var h=jb(i,o);return Wb(h,s,a)}});var qb=Ap({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ep(e,"x","logSumExp"),a=wl(t,r.shape),i=Pg(r,a,!0),o=Og(r,i),s=Dg(o),u=Lg(s,a),c=Rg(u),l=Tm(jm(i,c.shape),c);if(n){var h=Xg(l.shape,a);return jm(l,h)}return l}});function Hb(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(t.rank," ")+"and dim was ".concat(n));var r=wm((function(e,t,r){var a=qb(t,[n],!0),i=Og(Ov(t,"float32"),a);r([e,i]);var o=ny(Ym(i,e));return{value:Lg(o,[n]),gradFunc:function(e,t){var r=f(t,2),a=r[0],i=r[1],o=Xg(e.shape,[n]);return[Ym(jm(e,o),Og(Ov(a,"float32"),Dg(i))),Ym(jm(e,o),Og(Dg(i),Ov(a,"float32")))]}}}));return r(e,t)}Ap({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Ub.SUM_BY_NONZERO_WEIGHTS,i=Ep(e,"onehotLabels","softmaxCrossEntropy"),o=Ep(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Ep(n,"weights","softmaxCrossEntropy")),dl(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=_m(r),c=_m(1),l=_m(i.shape[1]);i=Tm(Ym(i,Og(c,u)),gg(u,l))}var h=Hb(i,o);return Wb(h,s,a)}});var Xb={bandPart:Ob,gramSchmidt:zb,qr:Vb},Kb=function(e){tr(n,e);var t=sr(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return $n(this,n),(a=t.call(this)).learningRate=e,a.rho=r,a.epsilon=i,a.accumulatedGrads=[],a.accumulatedUpdates=[],null==i&&(a.epsilon=bp.backend.epsilon()),a}return Jn(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=bp.registeredVariables[n];null==t.accumulatedGrads[r]&&(t.accumulatedGrads[r]={originalName:"".concat(n,"/accum_grad"),variable:bm((function(){return Fy(a).variable(false)}))}),null==t.accumulatedUpdates[r]&&(t.accumulatedUpdates[r]={originalName:"".concat(n,"/accum_var"),variable:bm((function(){return Fy(a).variable(false)}))});var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable,s=t.accumulatedUpdates[r].variable;bm((function(){var e=Tm(Ym(o,t.rho),Ym(Jg(i),1-t.rho)),n=Ym(gg(Iy(Tm(s,t.epsilon)),Iy(Tm(o,t.epsilon))),i),r=Tm(Ym(s,t.rho),Ym(Jg(n),1-t.rho));o.assign(e),s.assign(r);var u=Tm(Ym(n,-t.learningRate),a);a.assign(u)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedUpdates&&(xm(this.accumulatedGrads.map((function(e){return e.variable}))),xm(this.accumulatedUpdates.map((function(e){return e.variable}))))}},{key:"getWeights",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Tt(this.accumulatedGrads),Tt(this.accumulatedUpdates)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=ns(es().mark((function e(t){var n;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=t.length/2,!1,this.accumulatedGrads=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedUpdates=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.rho,t.epsilon)}}]),n}(Sm);Kb.className="Adadelta",vm(Kb);var Yb=function(e){tr(n,e);var t=sr(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return $n(this,n),(r=t.call(this)).learningRate=e,r.initialAccumulatorValue=a,r.accumulatedGrads=[],r}return Jn(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=bp.registeredVariables[n];if(null==t.accumulatedGrads[r]){t.accumulatedGrads[r]={originalName:"".concat(n,"/accumulator"),variable:bm((function(){return Cg(a.shape,t.initialAccumulatorValue).variable(false)}))}}var i=Array.isArray(e)?e[r].tensor:e[n];if(null!=i){var o=t.accumulatedGrads[r].variable;bm((function(){var e=Tm(o,Jg(i));o.assign(e);var n=Tm(Ym(gg(i,Iy(Tm(e,bp.backend.epsilon()))),-t.learningRate),a);a.assign(n)}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedGrads&&xm(this.accumulatedGrads.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulatedGrads.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulatedGrads=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.initialAccumulatorValue)}}]),n}(Sm);Yb.className="Adagrad",vm(Yb);var Qb=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return $n(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.accumulatedFirstMoment=[],i.accumulatedSecondMoment=[],bm((function(){i.accBeta1=_m(r).variable(),i.accBeta2=_m(a).variable()})),null==o&&(i.epsilon=bp.backend.epsilon()),i}return Jn(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);bm((function(){var r=Og(1,t.accBeta1),a=Og(1,t.accBeta2);n.forEach((function(n,i){var o=bp.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:bm((function(){return Fy(o).variable(false)}))}),null==t.accumulatedSecondMoment[i]&&(t.accumulatedSecondMoment[i]={originalName:"".concat(n,"/v"),variable:bm((function(){return Fy(o).variable(false)}))});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedSecondMoment[i].variable,l=Tm(Ym(u,t.beta1),Ym(s,1-t.beta1)),h=Tm(Ym(c,t.beta2),Ym(Jg(s),1-t.beta2)),f=gg(l,r),d=gg(h,a);u.assign(l),c.assign(h);var p=Tm(Ym(gg(f,Tm(Iy(d),t.epsilon)),-t.learningRate),o);o.assign(p)}})),t.accBeta1.assign(Ym(t.accBeta1,t.beta1)),t.accBeta2.assign(Ym(t.accBeta2,t.beta2))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&xm(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedSecondMoment&&xm(this.accumulatedSecondMoment.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Tt(this.accumulatedFirstMoment),Tt(this.accumulatedSecondMoment)),e.next=3,this.saveIterations();case 3:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=ns(es().mark((function e(t){var n,r=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,bm((function(){r.accBeta1.assign(By(r.beta1,r.iterations_+1)),r.accBeta2.assign(By(r.beta2,r.iterations_+1))})),n=t.length/2,!1,this.accumulatedFirstMoment=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}})),this.accumulatedSecondMoment=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon)}}]),n}(Sm);Qb.className="Adam",vm(Qb);var Zb=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return $n(this,n),(i=t.call(this)).learningRate=e,i.beta1=r,i.beta2=a,i.epsilon=o,i.decay=s,i.accumulatedFirstMoment=[],i.accumulatedWeightedInfNorm=[],bm((function(){i.iteration=_m(0).variable(),i.accBeta1=_m(r).variable()})),null==o&&(i.epsilon=bp.backend.epsilon()),i}return Jn(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);bm((function(){var r=Og(1,t.accBeta1),a=gg(-t.learningRate,Tm(Ym(t.iteration,t.decay),1));n.forEach((function(n,i){var o=bp.registeredVariables[n];null==t.accumulatedFirstMoment[i]&&(t.accumulatedFirstMoment[i]={originalName:"".concat(n,"/m"),variable:Fy(o).variable(false)}),null==t.accumulatedWeightedInfNorm[i]&&(t.accumulatedWeightedInfNorm[i]={originalName:"".concat(n,"/v"),variable:Fy(o).variable(false)});var s=Array.isArray(e)?e[i].tensor:e[n];if(null!=s){var u=t.accumulatedFirstMoment[i].variable,c=t.accumulatedWeightedInfNorm[i].variable,l=Tm(Ym(u,t.beta1),Ym(s,1-t.beta1)),h=Ym(c,t.beta2),f=Cm(s),d=Vg(h,f);u.assign(l),c.assign(d);var p=Tm(Ym(gg(a,r),gg(l,Tm(d,t.epsilon))),o);o.assign(p)}})),t.iteration.assign(Tm(t.iteration,1)),t.accBeta1.assign(Ym(t.accBeta1,t.beta1))})),this.incrementIterations()}},{key:"dispose",value:function(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&xm(this.accumulatedFirstMoment.map((function(e){return e.variable}))),null!=this.accumulatedWeightedInfNorm&&xm(this.accumulatedWeightedInfNorm.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("getWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:throw new Error("setWeights() is not implemented for Adamax yet.");case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.beta1,t.beta2,t.epsilon,t.decay)}}]),n}(Sm);Zb.className="Adamax",vm(Zb);var Jb=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).learningRate=e,r.setLearningRate(e),r}return Jn(n,[{key:"applyGradients",value:function(e){var t=this,n=Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e);n.forEach((function(n,r){var a=Array.isArray(e)?e[r].tensor:e[n];if(null!=a){var i=bp.registeredVariables[n];bm((function(){var e=Tm(Ym(t.c,a),i);i.assign(e)}))}})),this.incrementIterations()}},{key:"setLearningRate",value:function(e){this.learningRate=e,null!=this.c&&this.c.dispose(),this.c=km(_m(-e))}},{key:"dispose",value:function(){this.c.dispose()}},{key:"getWeights",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0]);case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:if(0===(t=e.sent).length){e.next=5;break}throw new Error("SGD optimizer does not have settable weights.");case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate)}}]),n}(Sm);Jb.className="SGD",vm(Jb);var $b=function(e){tr(n,e);var t=sr(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return $n(this,n),(a=t.call(this,e)).learningRate=e,a.momentum=r,a.useNesterov=i,a.accumulations=[],a.m=_m(a.momentum),a}return Jn(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=bp.registeredVariables[n];if(null==t.accumulations[r]){t.accumulations[r]={originalName:"".concat(n,"/momentum"),variable:bm((function(){return Fy(a).variable(false)}))}}var i=t.accumulations[r].variable,o=Array.isArray(e)?e[r].tensor:e[n];null!=o&&bm((function(){var e,n=Tm(Ym(t.m,i),o);e=t.useNesterov?Tm(Ym(t.c,Tm(o,Ym(n,t.m))),a):Tm(Ym(t.c,n),a),i.assign(n),a.assign(e)}))})),this.incrementIterations()}},{key:"dispose",value:function(){this.m.dispose(),null!=this.accumulations&&xm(this.accumulations.map((function(e){return e.variable})))}},{key:"setMomentum",value:function(e){this.momentum=e}},{key:"getWeights",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.saveIterations();case 2:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(this.accumulations.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,!1,this.accumulations=t.map((function(e){return{originalName:e.name,variable:e.tensor.variable(false)}}));case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.momentum,t.useNesterov)}}]),n}(Jb);$b.className="Momentum",vm($b);var ex=function(e){tr(n,e);var t=sr(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if($n(this,n),(r=t.call(this)).learningRate=e,r.decay=a,r.momentum=i,r.epsilon=o,r.accumulatedMeanSquares=[],r.accumulatedMoments=[],r.accumulatedMeanGrads=[],r.centered=s,null==o&&(r.epsilon=bp.backend.epsilon()),null==e)throw new Error("learningRate for RMSPropOptimizer must be defined.");return r}return Jn(n,[{key:"applyGradients",value:function(e){var t=this;(Array.isArray(e)?e.map((function(e){return e.name})):Object.keys(e)).forEach((function(n,r){var a=bp.registeredVariables[n],i=!1;null==t.accumulatedMeanSquares[r]&&(t.accumulatedMeanSquares[r]={originalName:"".concat(n,"/rms"),variable:bm((function(){return Fy(a).variable(i)}))}),null==t.accumulatedMoments[r]&&(t.accumulatedMoments[r]={originalName:"".concat(n,"/momentum"),variable:bm((function(){return Fy(a).variable(i)}))}),null==t.accumulatedMeanGrads[r]&&t.centered&&(t.accumulatedMeanGrads[r]={originalName:"".concat(n,"/mg"),variable:bm((function(){return Fy(a).variable(i)}))});var o=Array.isArray(e)?e[r].tensor:e[n];if(null!=o){var s=t.accumulatedMeanSquares[r].variable,u=t.accumulatedMoments[r].variable;bm((function(){var e=Tm(Ym(s,t.decay),Ym(Jg(o),1-t.decay));if(t.centered){var n=t.accumulatedMeanGrads[r].variable,i=Tm(Ym(n,t.decay),Ym(o,1-t.decay)),c=gg(Ym(o,t.learningRate),Iy(Og(e,Tm(Jg(i),t.epsilon)))),l=Tm(Ym(u,t.momentum),c);s.assign(e),n.assign(i),u.assign(l);var h=Og(a,l);a.assign(h)}else{var f=Tm(Ym(s,t.decay),Ym(Jg(o),1-t.decay)),d=Tm(Ym(u,t.momentum),gg(Ym(o,t.learningRate),Iy(Tm(f,t.epsilon))));s.assign(f),u.assign(d);var p=Og(a,d);a.assign(p)}}))}})),this.incrementIterations()}},{key:"dispose",value:function(){null!=this.accumulatedMeanSquares&&xm(this.accumulatedMeanSquares.map((function(e){return e.variable}))),null!=this.accumulatedMeanGrads&&this.centered&&xm(this.accumulatedMeanGrads.map((function(e){return e.variable}))),null!=this.accumulatedMoments&&xm(this.accumulatedMoments.map((function(e){return e.variable})))}},{key:"getWeights",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[].concat(Tt(this.accumulatedMeanSquares),Tt(this.accumulatedMoments)),this.centered&&t.push.apply(t,Tt(this.accumulatedMeanGrads)),e.next=4,this.saveIterations();case 4:return e.t0=e.sent,e.abrupt("return",[e.t0].concat(t.map((function(e){return{name:e.originalName,tensor:e.variable}}))));case 6:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"setWeights",value:function(){var e=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.extractIterations(t);case 2:t=e.sent,n=this.centered?t.length/3:t.length/2,r=!1,this.accumulatedMeanSquares=t.slice(0,n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.accumulatedMoments=t.slice(n,2*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})),this.centered&&(this.accumulatedMeanGrads=t.slice(2*n,3*n).map((function(e){return{originalName:e.name,variable:e.tensor.variable(r)}})));case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getConfig",value:function(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}}],[{key:"fromConfig",value:function(e,t){return new e(t.learningRate,t.decay,t.momentum,t.epsilon,t.centered)}}]),n}(Sm);ex.className="RMSProp",vm(ex);var tx=function(){function e(){$n(this,e)}return Jn(e,null,[{key:"sgd",value:function(e){return new Jb(e)}},{key:"momentum",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new $b(e,t,n)}},{key:"rmsprop",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];return new ex(e,t,n,r,a)}},{key:"adam",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Qb(e,t,n,r)}},{key:"adadelta",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.001,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.95,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return new Kb(e,t,n)}},{key:"adamax",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.002,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.9,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.999,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return new Zb(e,t,n,r,a)}},{key:"adagrad",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1;return new Yb(e,t)}}]),e}(),nx={sgd:tx.sgd,momentum:tx.momentum,adadelta:tx.adadelta,adagrad:tx.adagrad,rmsprop:tx.rmsprop,adamax:tx.adamax,adam:tx.adam},rx="undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof setImmediate?setImmediate:function(e){return e()};function ax(){return new Promise((function(e){return rx((function(){return e()}))}))}function ix(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function ox(e){return e<=30?e:Dl(e,Math.floor(Math.sqrt(e)))}function sx(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function ux(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var i=[],o=[],s=1;s<e;++s)s>=2*t+1||s%2===1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function cx(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function lx(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:ml(t.shape)/u,sliceSize:o,strides:[].concat(Tt(Pl(n.slice(0,a))),[1]),outputSize:ml(n)}}var hx=1.7580993408473768,fx=1.0507009873554805;function dx(){var e;jl().getBool("IS_TEST")||(e=console).warn.apply(e,arguments)}function px(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}var vx={kernelName:Yl,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return Ym(e,ob(Ov(n,"float32"),-1))}}}},mx={kernelName:Ql,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){var t=Jg(Ov(n,"float32")),r=Iy(Og(_m(1),t));return ny(gg(e,r))}}}},gx={kernelName:Zl,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){var t=Iy(Og(Jg(Ov(n,"float32")),1));return gg(e,t)}}}},yx={kernelName:Jl,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=xg(r.shape,a.shape);return{a:function(){var t=e,n=bg(r.shape,i);return n.length>0&&(t=Lg(t,n)),jm(t,r.shape)},b:function(){var t=e,n=bg(a.shape,i);return n.length>0&&(t=Lg(t,n)),jm(t,a.shape)}}}},bx={kernelName:$l,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},xx={kernelName:nh,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return Fy(n)}}}},kx={kernelName:rh,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return Fy(n)}}}},wx={kernelName:ah,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return gg(e,Iy(Og(_m(1),Jg(Ov(n,"float32")))))}}}},_x={kernelName:ih,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){var t=Iy(Tm(_m(1),Jg(Ov(n,"float32"))));return gg(e,t)}}}},Sx={kernelName:uh,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=xg(r.shape,a.shape);return{a:function(){var t=Tm(Jg(r),Jg(a)),n=Ym(e,gg(a,t)),o=bg(r.shape,i);return o.length>0&&(n=Lg(n,o)),jm(n,r.shape)},b:function(){var t=Tm(Jg(r),Jg(a)),n=ny(Ym(e,gg(r,t))),o=bg(a.shape,i);return o.length>0&&(n=Lg(n,o)),jm(n,a.shape)}}}},Cx={kernelName:oh,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return gg(e,Tm(Jg(Ov(n,"float32")),1))}}}},Tx={kernelName:sh,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return gg(e,Og(_m(1),Jg(Ov(n,"float32"))))}}}};var Ex=Ap({avgPool3dGrad_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1,1],i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=Ep(e,"dy","avgPool3dGrad"),u=Ep(t,"input","avgPool3dGrad"),c=s,l=u,h=!1;4===u.rank&&(h=!0,c=jm(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),l=jm(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),fl(5===c.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(c.rank,".")})),fl(5===l.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(l.rank,".")})),fl(Wm(r,a),(function(){return"Error in avgPool3dGrad: Either strides or dilations "+"must be 1. Got strides ".concat(r," and dilations '").concat(a,"'")})),null!=o&&fl(yl(i),(function(){return"Error in avgPool3dGrad: pad must be an integer when "+"using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")}));var f={dy:c,input:l},d={filterSize:n,strides:r,dilations:a,pad:i,dimRoundingMode:o},p=bp.runKernel(fh,f,d);return h?jm(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),Ix={kernelName:hh,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.filterSize,i=n.strides,o=n.dilations,s=n.pad,u=n.dimRoundingMode,c=null==o?[1,1,1]:o;return{x:function(){return Ex(e,r,a,i,c,s,u)}}}};var Ax=Ap({avgPoolGrad_:function(e,t,n,r,a){var i=Ep(e,"dy","avgPoolGrad"),o=Ep(t,"input","avgPoolGrad");fl(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=jm(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=jm(i,[1,i.shape[0],i.shape[1],i.shape[2]])),fl(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")})),fl(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")}));var l={dy:u,input:s},h={filterSize:n,strides:r,pad:a},f=bp.runKernel(lh,l,h);return c?jm(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),Mx={kernelName:ch,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return Ax(e,r,a,i,o)}}}},Nx={kernelName:dh,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return Km(e,i,!1,!1)},b:function(){return Km(e,a,!0,!1)}}:o&&!s?{a:function(){return Km(i,e,!1,!0)},b:function(){return Km(a,e,!1,!1)}}:{a:function(){return Km(i,e,!0,!0)},b:function(){return Km(e,a,!0,!0)}}:{a:function(){return Km(e,i,!1,!0)},b:function(){return Km(a,e,!0,!1)}}}};var Rx=Ap({spaceToBatchND_:function(e,t,n){var r=Ep(e,"x","spaceToBatchND");fl(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),fl(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),fl(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},i={blockShape:t,paddings:n};return bp.runKernel(ld,a,i)}}),Dx={kernelName:ph,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return Rx(e,r,a)}}}},Px={kernelName:"BroadcastTo",gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return Lg(e,u,!0)}}}},Ox={kernelName:vh,gradFunc:function(e){return{x:function(){return e.clone()}}}},Lx={kernelName:mh,gradFunc:function(e){return{x:function(){return Fy(e)}}}},Fx={kernelName:gh,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return Ly(zg(Ag(r,a),Db(r,i)),e,Fy(e))}}}},zx={kernelName:bh,inputsToSave:["x"],gradFunc:vx.gradFunc},Bx={kernelName:xh,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=wl(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return Ey(e,i,a).map((function(e){return function(){return e}}))}},Ux={kernelName:kh,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return fl(Vm(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return fg(a.shape,e,i,s,u,c)},filter:function(){return ab(a,e,i.shape,s,u,c)}}}},Vx={kernelName:_h,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return lg(e,i,o,s,u,1,c)},filter:function(){return ab(e,a,i.shape,o,s,u,c)}}}};var Wx=Ap({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=jm(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=jm(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),fl(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")})),fl(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")})),fl(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")})),fl(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")})),fl(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return bp.runKernel(Ch,s,u)}});var Gx=Ap({conv3DBackpropInput_:function(e,t,n,r,a){fl(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=jm(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];fl(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")})),fl(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)})),fl(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)})),fl(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(n.shape[3],".")})),fl(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(n.shape[4],".")}));var l={dy:o,filter:n},h={pad:a,strides:r,inputShape:i},f=bp.runKernel(Th,l,h);return s?jm(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),jx={kernelName:Sh,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;fl(Vm(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=f(t,2),s=o[0],u=o[1];return{x:function(){return Gx(s.shape,e,u,a,i)},filter:function(){return Wx(s,e,u.shape,a,i)}}}};var qx=Ap({sin_:function(e){var t={x:Ep(e,"x","sin")};return bp.runKernel(rd,t)}}),Hx={kernelName:Eh,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return Ym(ny(qx(Ov(n,"float32"))),e)}}}};var Xx=Ap({sinh_:function(e){var t={x:Ep(e,"x","sinh")};return bp.runKernel(ad,t)}}),Kx={kernelName:Ih,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return Ym(Xx(Ov(n,"float32")),e)}}}};var Yx=Ap({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Ep(e,"x","cumsum"),i={x:a},o={axis:t,exclusive:n,reverse:r};return bp.runKernel(Ah,i,o)}}),Qx={kernelName:Ah,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=Yg([a],r.rank),n=Yx(e,a,i,!o);return null!=t&&(n=Qy(n,t)),n}}}},Zx={kernelName:Rh,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;fl(Vm(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")}));var u=f(t,2),c=u[0],l=u[1];return fl(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")})),fl(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")})),fl(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")})),fl(Wm(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")})),null!=o&&fl(yl(i),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(i,".")})),{x:function(){return db(c.shape,e,l,a,i,r,o)},filter:function(){return fb(c,e,l.shape,a,i,r,o)}}}},Jx={kernelName:Oh,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return bp.runKernel("Dilation2DBackpropInput",o,n)},filter:function(){return bp.runKernel("Dilation2DBackpropFilter",s,n)}}}},$x={kernelName:Fh,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:f(t,1)[0]};return{x:function(){return bp.runKernel(zh,n)}}}},ek={kernelName:Bh,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0],r=Ym(Dg(ny(Jg(n))),2/Math.sqrt(Math.PI));return{x:function(){return Ym(e,r)}}}},tk={kernelName:Vh,outputsToSave:[!0],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return Ym(e,n)}}}},nk={kernelName:Wh,inputsToSave:["input"],gradFunc:function(e,t){var n=f(t,1)[0];return{input:function(){return jm(e,n.shape)}}}},rk={kernelName:Gh,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return Ym(e,Dg(n))}}}},ak={kernelName:Hh,gradFunc:function(e){return{x:function(){return Fy(e)}}}},ik={kernelName:Xh,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=xg(r.shape,a.shape);return{a:function(){var t=gg(e,Ov(a,"float32")),n=bg(r.shape,i);return n.length>0?jm(Lg(t,n),r.shape):t},b:function(){var t=Ym(e,Ov(r,"float32")),n=bg(a.shape,i);n.length>0&&(t=jm(Lg(t,n),a.shape));var o=Jg(a);return ny(gg(t,Ov(o,"float32")))}}}},ok={kernelName:Kh,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=f(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?_m(1):u,l=bg(o.shape,i.shape),h=[];if(1===o.rank){for(var d=0;d<i.shape.length-1;++d)h.push(i.shape[d]);h.push(1)}var p=Og(i,o),v=Ym(e,c),m=yy(Tm(s,_m(r))),g=Ym(Ym(Ym(m,m),m),_m(-.5));return{x:function(){return 1===o.rank?jm(Ym(Ym(e,_g(jm(m,[1,1,1,o.shape[0]]),h)),c),i.shape):jm(Ym(Ym(e,m),c),i.shape)},mean:function(){var e=Ym(Ym(m,_m(-1)),v);return 1===o.rank&&(e=Lg(e,l)),jm(e,o.shape)},variance:function(){var e=Ym(Ym(g,p),v);return 1===o.rank&&(e=Lg(e,l)),jm(e,o.shape)},scale:function(){var t=Ym(p,m),n=Ym(e,t);return 1===o.rank&&(n=Lg(n,l)),jm(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=Lg(t,l)),jm(t,o.shape)}}}};var sk=Ap({unsortedSegmentSum_:function(e,t,n){var r=Ep(e,"x","unsortedSegmentSum"),a=Ep(t,"segmentIds","unsortedSegmentSum","int32");fl(yl(n),(function(){return"numSegments must be of dtype int"}));var i={x:r,segmentIds:a},o={numSegments:n};return bp.runKernel(Sd,i,o)}}),uk={kernelName:Yh,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o=n.axis,s=wl(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,h=ck(0,u),f=ck(u+1,u+1+l),d=lk([r,[n],c]),p=jm(e,d),v=jm(i,[n]),m=lk([[u],h,f]),g=Qy(p,m),y=sk(g,v,a.shape[s]),b=Qg(m);return y=Qy(y,b)},indices:function(){return i}}}};function ck(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function lk(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var hk={kernelName:Zh,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1];return{a:function(){return Fy(r)},b:function(){return Fy(a)}}}},fk={kernelName:Jh,gradFunc:function(e){return{x:function(){return Ov(e,"float32")}}}},dk={kernelName:tf,gradFunc:function(e){return{x:function(){return Fy(e)}}}},pk={kernelName:nf,gradFunc:function(e){return{x:function(){return Fy(e)}}}},vk={kernelName:rf,gradFunc:function(e){return{x:function(){return Fy(e)}}}},mk={kernelName:af,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.alpha,i=Ig(r,0);return{x:function(){return Ly(i,e,Ym(e,a))}}}},gk={kernelName:lf,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return gg(e,Tm(n,1))}}}},yk={kernelName:cf,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return gg(e,Ov(n,"float32"))}}}},bk={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.axis;return{logits:function(){var t=Dg(r);return Og(e,Ym(Lg(e,a,!0),t))}}}};var xk=Ap({localResponseNormalizationBackprop_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5,s={x:e,y:t,dy:n},u={depthRadius:r,bias:a,alpha:i,beta:o};return bp.runKernel(vf,s,u)}}),kk={kernelName:pf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return xk(a,i,e,o,s,u,c)}}}};function wk(e,t,n,r){return t.rank<n.rank&&(t=jm(t,Xg(t.shape,r))),e.rank<n.rank&&(e=jm(e,Xg(e.shape,r))),{x:function(){return Ym(e,Ov(kg(n,t),e.dtype))}}}var _k={kernelName:mf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=wk(e,t[1],a,wl(r,a.shape));return{x:function(){return i.x()}}}};var Sk=Ap({less_:function(e,t){var n=Ep(e,"a","less"),r=Ep(t,"b","less"),a=f(hp(n,r),2);n=a[0],r=a[1],xg(n.shape,r.shape);var i={a:n,b:r};return bp.runKernel(of,i)}}),Ck={kernelName:gf,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1];return{a:function(){return Ym(e,Ov(Ag(r,a),"float32"))},b:function(){return Ym(e,Ov(Sk(r,a),"float32"))}}}};var Tk=Ap({maxPool3dGrad_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,u=Ep(e,"dy","maxPool3dGrad"),c=Ep(t,"input","maxPool3dGrad"),l=Ep(n,"output","maxPool3dGrad"),h=u,f=c,d=l,p=!1;4===c.rank&&(p=!0,h=jm(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),f=jm(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),d=jm(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),fl(5===h.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(h.rank,".")})),fl(5===f.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(f.rank,".")})),fl(5===d.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(d.rank,".")})),fl(Wm(a,i),(function(){return"Error in maxPool3dGrad: Either strides or dilations "+"must be 1. Got strides ".concat(a," and dilations '").concat(i,"'")})),null!=s&&fl(yl(o),(function(){return"Error in maxPool3dGrad: pad must be an integer when "+"using, dimRoundingMode ".concat(s," but got pad ").concat(o,".")}));var v={dy:h,input:f,output:d},m={filterSize:r,strides:a,dilations:i,pad:o,dimRoundingMode:s},g=bp.runKernel(kf,v,m);return p?jm(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}}),Ek={kernelName:xf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.dilations,c=n.pad,l=n.dimRoundingMode,h=null==u?[1,1,1]:u;return{x:function(){return Tk(e,a,i,o,s,h,c,l)}}}};var Ik=Ap({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=Ep(e,"dy","maxPoolGrad"),u=Ep(t,"input","maxPoolGrad"),c=Ep(n,"output","maxPoolGrad");fl(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")})),fl(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")})),fl(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")})),null!=o&&fl(yl(i),(function(){return"Error in maxPoolGrad: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(i,".")}));var l={dy:s,input:u,output:c},h={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return bp.runKernel(bf,l,h)}}),Ak={kernelName:yf,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return Ik(e,a,i,o,s,u)}}}},Mk={kernelName:wf,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=wl(n.axis,r.shape),i=ml(Hg(r.shape,a)[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=jm(e,t);return gg(Ym(n,oy(r.shape,"float32")),i)}}}},Nk={kernelName:_f,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=f(t,2),i=a[0],o=wk(e,a[1],i,wl(r,i.shape));return{x:function(){return o.x()}}}},Rk={kernelName:Sf,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1];return{a:function(){return Ym(e,Ov(Db(r,a),"float32"))},b:function(){return Ym(e,Ov(Ig(r,a),"float32"))}}}},Dk={kernelName:Cf,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Zm(e,a,r.shape)}}}},Pk={kernelName:Tf,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=xg(r.shape,a.shape);return{a:function(){var t=bg(r.shape,i);return t.length>0?jm(Lg(e,t),r.shape):e},b:function(){var t=Ym(e,ny(Tg(gg(r,a)))),n=bg(a.shape,i);return n.length>0?jm(Lg(t,n),a.shape):t}}}},Ok={kernelName:If,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=xg(r.shape,a.shape);return{a:function(){var t=Ym(e,Ov(a,"float32")),n=bg(r.shape,i);return n.length>0?jm(Lg(t,n),r.shape):t},b:function(){var t=Ym(e,Ov(r,"float32")),n=bg(a.shape,i);return n.length>0?jm(Lg(t,n),a.shape):t}}}},Lk={kernelName:Af,gradFunc:function(e){return{x:function(){return ny(e)}}}},Fk={kernelName:Of,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return iy(n.shape,"float32")}}}},zk={kernelName:Pf,gradFunc:function(e){return{x:function(){return Fy(e)}}}},Bk={kernelName:Lf,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return Dy(e,r).map((function(e){return function(){return e}}))}},Uk={kernelName:Ff,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return Zm(e,a,r.shape)}}}},Vk={kernelName:zf,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=f(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=xg(o.shape,s.shape);return{a:function(){var t=Ov(s,"float32"),n=Ym(e,Ym(t,By(o,Og(t,_m(1))))),r=bg(o.shape,u);return r.length>0&&(n=Lg(n,r)),jm(n,o.shape)},b:function(){var t=Ig(o,0),n=Ly(t,Rg(o),Fy(o)),r=Ym(e,Ym(i,n)),a=bg(s.shape,u);return a.length>0&&(r=Lg(r,a)),jm(r,s.shape)}}}},Wk={kernelName:Bf,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=Ig(r,0);return{x:function(){return Ly(i,e,Ym(e,a))},alpha:function(){var t=Ly(i,Fy(e),Ym(e,r)),n=bg(a.shape,e.shape);return n.length>0&&(t=Lg(t,n)),jm(t,a.shape)}}}},Gk={kernelName:Lh,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=xg(r.shape,a.shape);return{a:function(){var t=gg(e,Ov(a,"float32")),n=bg(r.shape,i);return n.length>0?jm(Lg(t,n),r.shape):t},b:function(){var t=Ym(e,Ov(r,"float32")),n=bg(a.shape,i);n.length>0&&(t=jm(Lg(t,n),a.shape));var o=Jg(a);return ny(gg(t,Ov(o,"float32")))}}}},jk={kernelName:Gf,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return gg(e,ny(Jg(n)))}}}},qk={kernelName:Qf,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0],r=Ym(Db(n,6),ob(n));return{x:function(){return Ym(e,Ov(r,"float32"))}}}},Hk={kernelName:jf,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return Ym(e,Ov(ob(n),"float32"))}}}},Xk={kernelName:qf,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return jm(e,n.shape)}}}},Kk={kernelName:Kf,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:f(t,1)[0]};return{images:function(){return bp.runKernel(Yf,r,n)}}}},Yk={kernelName:Hf,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:f(t,1)[0]};return{images:function(){return bp.runKernel(Xf,r,n)}}}},Qk={kernelName:Zf,gradFunc:function(e,t,n){var r=wl(n.dims,e.shape);return{x:function(){return gy(e,r)}}}},Zk={kernelName:Jf,gradFunc:function(e){return{x:function(){return Fy(e)}}}},Jk={kernelName:$f,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return ny(gg(e,Ym(By(n,1.5),2)))}}}};var $k=Ap({logicalNot_:function(e){var t={x:Ep(e,"x","logicalNot","bool")};return bp.runKernel(ff,t)}}),ew={kernelName:ed,inputsToSave:["condition"],gradFunc:function(e,t){var n=f(t,1)[0];return{condition:function(){return Ov(Fy(n),"float32")},t:function(){return Ym(e,Ov(n,e.dtype))},e:function(){return Ym(e,Ov($k(n),e.dtype))}}}},tw={kernelName:td,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){var t=Ig(n,_m(0)),r=_m(hx),a=_m(fx),i=Ym(e,a),o=Ym(Ym(e,r),Dg(Ov(n,"float32")));return Ly(t,i,o)}}}},nw={kernelName:od,outputsToSave:[!0],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return Ym(e,Ym(n,Og(_m(1),n)))}}}},rw={kernelName:id,gradFunc:function(e){return{x:function(){return Fy(e)}}}};var aw=Ap({cos_:function(e){var t={x:Ep(e,"x","cos")};return bp.runKernel(Eh,t)}}),iw={kernelName:rd,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return Ym(aw(Ov(n,"float32")),e)}}}};var ow=Ap({cosh_:function(e){var t={x:Ep(e,"x","cosh")};return bp.runKernel(Ih,t)}}),sw={kernelName:ad,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return Ym(ow(Ov(n,"float32")),e)}}}},uw={kernelName:nd,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=f(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=f(hm(r,a,i),2),u=s[0],c=s[1],l=[],h=0;h<e.rank;h++)l.push([u[h],o[h]-u[h]-c[h]]);return{x:function(){return cy(e,l)}}}},cw={kernelName:sd,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return Ym(e,Qm(n))}}}},lw={kernelName:ld,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return eg(e,r,a)}}}},hw={kernelName:hd,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return Xm(e,r)}}}},fw={kernelName:ud,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return gg(e,Ym(Iy(Ov(n,"float32")),2))}}}},dw={kernelName:pd,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return Ym(e,Ym(Ov(n,"float32"),2))}}}},pw={kernelName:dd,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=_m(2);return{a:function(){return Ym(e,Ym(i,Og(r,a)))},b:function(){return Ym(e,Ym(i,Og(a,r)))}}}},vw={kernelName:vd,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=xg(r.shape,a.shape);return{a:function(){var t=e,n=bg(r.shape,i);return n.length>0&&(t=Lg(t,n)),jm(t,r.shape)},b:function(){var t=e,n=bg(a.shape,i);return n.length>0&&(t=Lg(t,n)),jm(ny(t),a.shape)}}}},mw={kernelName:cd,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=r.shape.slice();wl(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=jm(e,a),o=Ym(i,oy(r.shape,"float32"));return{x:function(){return o}}}},gw={kernelName:gd,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return gg(e,Jg(aw(n)))}}}},yw={kernelName:bd,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.reps;return{x:function(){var t=Fy(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=Tm(t,Zm(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=Tm(t,Zm(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=Tm(t,Zm(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var h=0;h<a[1];++h)for(var f=0;f<a[2];++f)for(var d=0;d<a[3];++d)t=Tm(t,Zm(e,[l*r.shape[0],h*r.shape[1],f*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},bw={kernelName:Sd,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return function(e,t){for(var n=Vg(t,Fy(t)),r=Eg(e,n),a=Ag(t,_m(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=wg(a,o+1);a=zg(a,oy(r.shape,"bool"));var s=Fy(r);return Ly(a,r,s)}(e,n)}}}};for(var xw=0,kw=[vx,mx,gx,yx,bx,xx,kx,wx,_x,Sx,Cx,Tx,Ix,Mx,Nx,Dx,Px,Ox,Lx,Fx,zx,Bx,Vx,Ux,jx,Hx,Kx,Qx,Zx,Jx,Gk,$x,ek,tk,nk,rk,ik,ak,ok,uk,hk,fk,dk,pk,vk,mk,gk,yk,bk,kk,_k,_k,Ck,Ek,Ak,Mk,Nk,Rk,Dk,Pk,Ok,Lk,Fk,zk,Bk,Uk,Uk,Vk,Wk,jk,qk,Hk,Xk,Kk,Yk,Qk,Zk,Jk,ew,tw,nw,rw,iw,sw,uw,{kernelName:fd,outputsToSave:[!0],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.dim,i=Ym(e,r);return{logits:function(){return Og(i,Ym(Lg(i,[a],true),r))}}}},cw,lw,lw,hw,hw,fw,pw,dw,{kernelName:Td,gradFunc:function(e){return{x:function(){return Fy(e)}}}},vw,mw,gw,{kernelName:yd,outputsToSave:[!0],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return Ym(Og(_m(1),Jg(n)),e)}}}},yw,{kernelName:kd,gradFunc:function(e,t,n){var r=Qg(n.perm);return{x:function(){return Qy(e,r)}}}},{kernelName:_d,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return My(e,r)}}}},bw,{kernelName:Cd,gradFunc:function(e){return{x:function(){return Fy(e)}}}}];xw<kw.length;xw++){Ld(kw[xw])}tp.prototype.abs=function(){return this.throwIfDisposed(),Cm(this)};var ww=Ap({acos_:function(e){var t={x:Ep(e,"x","acos")};return bp.runKernel(Ql,t)}});tp.prototype.acos=function(){return this.throwIfDisposed(),ww(this)};var _w=Ap({acosh_:function(e){var t={x:Ep(e,"x","acosh")};return bp.runKernel(Zl,t)}});tp.prototype.acosh=function(){return this.throwIfDisposed(),_w(this)},tp.prototype.addStrict=function(e){return this.throwIfDisposed(),Vy(this,e)},tp.prototype.add=function(e){return this.throwIfDisposed(),Tm(this,e)},tp.prototype.all=function(e,t){return this.throwIfDisposed(),Em(this,e,t)},tp.prototype.any=function(e,t){return this.throwIfDisposed(),Im(this,e,t)},tp.prototype.argMax=function(e){return this.throwIfDisposed(),Am(this,e)};var Sw=Ap({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ep(e,"x","argMin"),r={x:n},a={axis:t};return bp.runKernel(rh,r,a)}});tp.prototype.argMin=function(e){return this.throwIfDisposed(),Sw(this,e)},tp.prototype.asScalar=function(){return this.throwIfDisposed(),fl(1===this.size,(function(){return"The array must have only 1 element."})),jm(this,[])},tp.prototype.asType=function(e){return this.throwIfDisposed(),Ov(this,e)},tp.prototype.as1D=function(){return this.throwIfDisposed(),jm(this,[this.size])},tp.prototype.as2D=function(e,t){return this.throwIfDisposed(),jm(this,[e,t])},tp.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),jm(this,[e,t,n])},tp.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),jm(this,[e,t,n,r])},tp.prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),jm(this,[e,t,n,r,a])};var Cw=Ap({asin_:function(e){var t={x:Ep(e,"x","asin")};return bp.runKernel(ah,t)}});tp.prototype.asin=function(){return this.throwIfDisposed(),Cw(this)};var Tw=Ap({asinh_:function(e){var t={x:Ep(e,"x","asinh")};return bp.runKernel(ih,t)}});tp.prototype.asinh=function(){return this.throwIfDisposed(),Tw(this)};var Ew=Ap({atan_:function(e){var t={x:Ep(e,"x","atan")};return bp.runKernel(oh,t)}});tp.prototype.atan=function(){return this.throwIfDisposed(),Ew(this)};var Iw=Ap({atan2_:function(e,t){var n=Ep(e,"a","atan2"),r=Ep(t,"b","atan2"),a=f(hp(n,r),2),i={a:n=a[0],b:r=a[1]};return bp.runKernel(uh,i)}});tp.prototype.atan2=function(e){return this.throwIfDisposed(),Iw(this,e)};var Aw=Ap({atanh_:function(e){var t={x:Ep(e,"x","atanh")};return bp.runKernel(sh,t)}});tp.prototype.atanh=function(){return this.throwIfDisposed(),Aw(this)},tp.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),qm(this,e,t,n,r)},tp.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),eg(this,e,t)},tp.prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),tg(this,e,t,n,r,a)},tp.prototype.broadcastTo=function(e){return this.throwIfDisposed(),Oy(this,e)},tp.prototype.cast=function(e){return this.throwIfDisposed(),Ov(this,e)};var Mw=Ap({ceil_:function(e){var t={x:Ep(e,"x","ceil")};return bp.runKernel(mh,t)}});tp.prototype.ceil=function(){return this.throwIfDisposed(),Mw(this)},tp.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),ig(this,e,t)},tp.prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof tp&&(e=[e]),Xm([this].concat(Tt(e)),t)},tp.prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),hg(this,e,t,n,r,a,i)},tp.prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),dg(this,e,t,n,r,a)},tp.prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),lg(this,e,t,n,r,a,i)},tp.prototype.cos=function(){return this.throwIfDisposed(),aw(this)},tp.prototype.cosh=function(){return this.throwIfDisposed(),ow(this)},tp.prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),Yx(this,e,t,n)};var Nw=Ap({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=Ep(e,"x","depthToSpace"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];fl(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),fl(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),fl(o%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}));var s={x:r},u={blockSize:t,dataFormat:n};return bp.runKernel(Nh,s,u)}});tp.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),Nw(this,e,t)},tp.prototype.depthwiseConv2D=function(e,t,n,r,a,i){return mm("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),vg(this,e,t,n,r,a,i)},tp.prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),vg(this,e,t,n,r,a,i)};var Rw=Ap({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=Ep(e,"x","dilation2d"),s=Ep(t,"filter","dilation2d");fl(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")})),fl(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")})),fl("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)}));var u=o,c=!1;3===o.rank&&(u=jm(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0);var l={x:u,filter:s},h={strides:n,pad:r,dilations:a},f=bp.runKernel(Oh,l,h);return c?jm(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});tp.prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),Rw(this,e,t,n,r,a)};var Dw=Ap({divNoNan_:function(e,t){var n=Ep(e,"a","div"),r=Ep(t,"b","div"),a=f(hp(n,r),2);n=a[0],r=a[1];var i=gg(n,r),o=Fy(i),s=kg(r,o);return Ly(s,o,i)}});tp.prototype.divNoNan=function(e){return this.throwIfDisposed(),Dw(this,e)},tp.prototype.divStrict=function(e){return this.throwIfDisposed(),Wy(this,e)},tp.prototype.div=function(e){return this.throwIfDisposed(),gg(this,e)};var Pw=Ap({dot_:function(e,t){var n=Ep(e,"t1","dot"),r=Ep(t,"t2","dot");fl((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(fl(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=jm(n,[1,-1]),s=jm(r,[-1,1]),u=Km(o,s);return jm(u,[])}if(1===n.rank&&2===r.rank){var c=jm(n,[1,-1]),l=jm(r,[r.shape[0],r.shape[1]]),h=Km(c,l);return jm(h,[h.size])}if(2===n.rank&&1===r.rank){var f=jm(r,[-1,1]),d=Km(n,f);return jm(d,[d.size])}var p=jm(r,[r.shape[0],r.shape[1]]);return Km(n,p)}});tp.prototype.dot=function(e){return this.throwIfDisposed(),Pw(this,e)},tp.prototype.elu=function(){return this.throwIfDisposed(),yg(this)};var Ow=Ap({equalStrict_:function(e,t){mm("strict variants of ops have been deprecated and will be removed in future");var n=Ep(e,"a","equalStrict"),r=Ep(t,"b","equalStrict");return dl(n.shape,r.shape,"Error in equalStrict: "),kg(n,r)}}),Lw=Ap({greaterEqualStrict_:function(e,t){mm("strict variants of ops have been deprecated and will be removed in future");var n=Ep(e,"a","greaterEqualStrict"),r=Ep(t,"b","greaterEqualStrict");return dl(n.shape,r.shape,"Error in greaterEqualStrict: "),Ag(n,r)}}),Fw=Ap({greaterStrict_:function(e,t){mm("strict variants of ops have been deprecated and will be removed in future");var n=Ep(e,"a","greaterStrict"),r=Ep(t,"b","greaterStrict");return dl(n.shape,r.shape,"Error in greaterStrict: "),Ig(n,r)}}),zw=Ap({lessEqualStrict_:function(e,t){mm("strict variants of ops have been deprecated and will be removed in future");var n=Ep(e,"a","lessEqualStrict"),r=Ep(t,"b","lessEqualStrict");return dl(n.shape,r.shape,"Error in lessEqualStrict: "),Db(n,r)}}),Bw=Ap({lessStrict_:function(e,t){mm("strict variants of ops have been deprecated and will be removed in future");var n=Ep(e,"a","lessStrict"),r=Ep(t,"b","lessStrict");return dl(n.shape,r.shape,"Error in lessStrict: "),Sk(n,r)}}),Uw=Ap({notEqualStrict_:function(e,t){mm("strict variants of ops have been deprecated and will be removed in future");var n=Ep(e,"a","notEqualStrict"),r=Ep(t,"b","notEqualStrict");return dl(n.shape,r.shape,"Error in notEqualStrict: "),ry(n,r)}});tp.prototype.equalStrict=function(e){return this.throwIfDisposed(),Ow(this,e)},tp.prototype.equal=function(e){return this.throwIfDisposed(),kg(this,e)};var Vw=Ap({erf_:function(e){var t=Ep(e,"x","erf");fl("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=Ov(t,"float32"));var n={x:t};return bp.runKernel(Bh,n)}});tp.prototype.erf=function(){return this.throwIfDisposed(),Vw(this)},tp.prototype.exp=function(){return this.throwIfDisposed(),Dg(this)},tp.prototype.expandDims=function(e){return this.throwIfDisposed(),wg(this,e)};var Ww=Ap({expm1_:function(e){var t={x:Ep(e,"x","expm1")};return bp.runKernel(Gh,t)}});tp.prototype.expm1=function(){return this.throwIfDisposed(),Ww(this)},tp.prototype.fft=function(){return this.throwIfDisposed(),eb(this)},tp.prototype.flatten=function(){return this.throwIfDisposed(),jm(this,[this.size])},tp.prototype.floor=function(){return this.throwIfDisposed(),Tg(this)},tp.prototype.floorDiv=function(e){return this.throwIfDisposed(),mg(this,e)},tp.prototype.gather=function(e,t){return this.throwIfDisposed(),Eg(this,e,t)},tp.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),Lw(this,e)},tp.prototype.greaterEqual=function(e){return this.throwIfDisposed(),Ag(this,e)},tp.prototype.greaterStrict=function(e){return this.throwIfDisposed(),Fw(this,e)},tp.prototype.greater=function(e){return this.throwIfDisposed(),Ig(this,e)},tp.prototype.ifft=function(){return this.throwIfDisposed(),nb(this)},tp.prototype.irfft=function(){return this.throwIfDisposed(),rb(this)};var Gw=Ap({isFinite_:function(e){var t={x:Ep(e,"x","isFinite")};return bp.runKernel(tf,t)}});tp.prototype.isFinite=function(){return this.throwIfDisposed(),Gw(this)};var jw=Ap({isInf_:function(e){var t={x:Ep(e,"x","isInf")};return bp.runKernel(nf,t)}});tp.prototype.isInf=function(){return this.throwIfDisposed(),jw(this)};var qw=Ap({isNaN_:function(e){var t={x:Ep(e,"x","isNaN")};return bp.runKernel(rf,t)}});tp.prototype.isNaN=function(){return this.throwIfDisposed(),qw(this)},tp.prototype.leakyRelu=function(e){return this.throwIfDisposed(),Mg(this,e)},tp.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),zw(this,e)},tp.prototype.lessEqual=function(e){return this.throwIfDisposed(),Db(this,e)},tp.prototype.lessStrict=function(e){return this.throwIfDisposed(),Bw(this,e)},tp.prototype.less=function(e){return this.throwIfDisposed(),Sk(this,e)};var Hw=Ap({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=Ep(e,"x","localResponseNormalization");fl(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),fl(yl(t),(function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=jm(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:t,bias:n,alpha:r,beta:a},l=bp.runKernel(pf,u,c);return s?jm(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});tp.prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),Hw(this,e,t,n,r)};var Xw=Ap({logSigmoid_:function(e){var t=Ep(e,"x","logSigmoid"),n=wm((function(e){return{value:ny(Ty(ny(e))),gradFunc:function(t){return Ym(t,Qm(ny(e)))}}}));return n(t)}});tp.prototype.logSigmoid=function(){return this.throwIfDisposed(),Xw(this)},tp.prototype.logSoftmax=function(e){return this.throwIfDisposed(),Fg(this,e)},tp.prototype.logSumExp=function(e,t){return this.throwIfDisposed(),qb(this,e,t)},tp.prototype.log=function(){return this.throwIfDisposed(),Rg(this)},tp.prototype.log1p=function(){return this.throwIfDisposed(),Gb(this)},tp.prototype.logicalAnd=function(e){return this.throwIfDisposed(),zg(this,e)},tp.prototype.logicalNot=function(){return this.throwIfDisposed(),$k(this)};var Kw=Ap({logicalOr_:function(e,t){var n=Ep(e,"a","logicalOr","bool"),r=Ep(t,"b","logicalOr","bool");xg(n.shape,r.shape);var a={a:n,b:r};return bp.runKernel(df,a)}});tp.prototype.logicalOr=function(e){return this.throwIfDisposed(),Kw(this,e)};var Yw=Ap({logicalXor_:function(e,t){var n=Ep(e,"a","logicalXor","bool"),r=Ep(t,"b","logicalXor","bool");return xg(n.shape,r.shape),zg(Kw(e,t),$k(zg(e,t)))}});tp.prototype.logicalXor=function(e){return this.throwIfDisposed(),Yw(this,e)},tp.prototype.matMul=function(e,t,n){return this.throwIfDisposed(),Km(this,e,t,n)},tp.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),Bg(this,e,t,n,r)},tp.prototype.max=function(e,t){return this.throwIfDisposed(),Pg(this,e,t)},tp.prototype.maximumStrict=function(e){return this.throwIfDisposed(),Gy(this,e)},tp.prototype.maximum=function(e){return this.throwIfDisposed(),Vg(this,e)},tp.prototype.mean=function(e,t){return this.throwIfDisposed(),Wg(this,e,t)},tp.prototype.min=function(e,t){return this.throwIfDisposed(),Gg(this,e,t)},tp.prototype.minimumStrict=function(e){return this.throwIfDisposed(),jy(this,e)},tp.prototype.minimum=function(e){return this.throwIfDisposed(),jg(this,e)};var Qw=Ap({mirrorPad_:function(e,t,n){fl("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,".")}));var r=Ep(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");fl(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){fl(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),fl(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal ")+"to ".concat(r.shape[e]-a," or less than 0 for input of ")+"shape ".concat(r.shape)}))},o=0;o<r.rank;o++)i(o);var s={paddings:t,mode:n},u={x:r};return bp.runKernel(Cf,u,s)}});tp.prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),Qw(this,e,t)},tp.prototype.modStrict=function(e){return this.throwIfDisposed(),qy(this,e)},tp.prototype.mod=function(e){return this.throwIfDisposed(),zy(this,e)},tp.prototype.mulStrict=function(e){return this.throwIfDisposed(),Hy(this,e)},tp.prototype.mul=function(e){return this.throwIfDisposed(),Ym(this,e)},tp.prototype.neg=function(){return this.throwIfDisposed(),ny(this)},tp.prototype.norm=function(e,t,n){return this.throwIfDisposed(),Fb(this,e,t,n)},tp.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),Uw(this,e)},tp.prototype.notEqual=function(e){return this.throwIfDisposed(),ry(this,e)},tp.prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),ay(this,e,t,n)},tp.prototype.onesLike=function(){return this.throwIfDisposed(),sy(this)},tp.prototype.pad=function(e,t){return this.throwIfDisposed(),cy(this,e,t)};var Zw=Ap({pool_:function(e,t,n,r,a,i){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var o=Ep(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=jm(o,[1,o.shape[0],o.shape[1],o.shape[2]])),fl(Wm(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")}));var c,l=Mm(s.shape,t,i,a,r),h=[l.dilationHeight,l.dilationWidth];c="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})),r=n.map((function(e){return e-1})),a=r.map((function(e){return Math.floor(e/2)})),i=r.map((function(e,t){return e-a[t]}));return r.map((function(e,t){return[a[t],i[t]]}))}([l.filterHeight,l.filterWidth],h):[[0,0],[0,0]];var d=1===h[0]&&1===h[1],p=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([l.inHeight,l.inWidth],h,c),v=f(p,2),m=v[0],g=v[1],y=d?r:"valid",b=d?s:Rx(s,h,m),x=("avg"===n?function(){return qm(b,t,i,y)}:function(){return Bg(b,t,i,y)})(),k=d?x:eg(x,h,g);return u?jm(k,[k.shape[1],k.shape[2],k.shape[3]]):k}});tp.prototype.pool=function(e,t,n,r,a){return this.throwIfDisposed(),Zw(this,e,t,n,r,a)},tp.prototype.powStrict=function(e){return this.throwIfDisposed(),Xy(this,e)},tp.prototype.pow=function(e){return this.throwIfDisposed(),By(this,e)},tp.prototype.prelu=function(e){return this.throwIfDisposed(),ly(this,e)};var Jw=Ap({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Ep(e,"x","prod");"bool"===r.dtype&&(r=Ov(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return bp.runKernel(Uf,a,i)}});tp.prototype.prod=function(e,t){return this.throwIfDisposed(),Jw(this,e,t)};var $w=Ap({reciprocal_:function(e){var t={x:Ep(e,"x","reciprocal")};return bp.runKernel(Gf,t)}});tp.prototype.reciprocal=function(){return this.throwIfDisposed(),$w(this)},tp.prototype.relu=function(){return this.throwIfDisposed(),my(this)},tp.prototype.relu6=function(){return this.throwIfDisposed(),ib(this)},tp.prototype.reshapeAs=function(e){return this.throwIfDisposed(),jm(this,e.shape)},tp.prototype.reshape=function(e){return this.throwIfDisposed(),jm(this,e)},tp.prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),Nb(this,e,t,n)},tp.prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),Rb(this,e,t,n)},tp.prototype.reverse=function(e){return this.throwIfDisposed(),gy(this,e)},tp.prototype.rfft=function(){return this.throwIfDisposed(),tb(this)};var e_=Ap({round_:function(e){var t={x:Ep(e,"x","round")};return bp.runKernel(Jf,t)}});tp.prototype.round=function(){return this.throwIfDisposed(),e_(this)},tp.prototype.rsqrt=function(){return this.throwIfDisposed(),yy(this)},tp.prototype.selu=function(){return this.throwIfDisposed(),by(this)},tp.prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),xy(this,e,t,n,r,a,i)},tp.prototype.sigmoid=function(){return this.throwIfDisposed(),Qm(this)};var t_=Ap({sign_:function(e){var t={x:Ep(e,"x","sign")};return bp.runKernel(id,t)}});tp.prototype.sign=function(){return this.throwIfDisposed(),t_(this)},tp.prototype.sin=function(){return this.throwIfDisposed(),qx(this)},tp.prototype.sinh=function(){return this.throwIfDisposed(),Xx(this)},tp.prototype.slice=function(e,t){return this.throwIfDisposed(),Zm(this,e,t)},tp.prototype.softmax=function(e){return this.throwIfDisposed(),Cy(this,e)},tp.prototype.softplus=function(){return this.throwIfDisposed(),Ty(this)},tp.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),Rx(this,e,t)},tp.prototype.split=function(e,t){return this.throwIfDisposed(),Ey(this,e,t)},tp.prototype.sqrt=function(){return this.throwIfDisposed(),Iy(this)},tp.prototype.square=function(){return this.throwIfDisposed(),Jg(this)},tp.prototype.squaredDifference=function(e){return this.throwIfDisposed(),Uy(this,e)},tp.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),Ky(this,e)},tp.prototype.squeeze=function(e){return this.throwIfDisposed(),Ay(this,e)},tp.prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof tp?[this,e]:[this].concat(Tt(e));return My(n,t)},tp.prototype.step=function(e){return this.throwIfDisposed(),ob(this,e)};var n_=Ap({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=Ep(e,"x","stridedSlice"),l={x:c},h={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return bp.runKernel(md,l,h)}});tp.prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),n_(this,e,t,n,r,a,i,o,s)},tp.prototype.subStrict=function(e){return this.throwIfDisposed(),Yy(this,e)},tp.prototype.sub=function(e){return this.throwIfDisposed(),Og(this,e)},tp.prototype.sum=function(e,t){return this.throwIfDisposed(),Lg(this,e,t)};var r_=Ap({tan_:function(e){var t={x:Ep(e,"x","tan")};return bp.runKernel(gd,t)}});tp.prototype.tan=function(){return this.throwIfDisposed(),r_(this)},tp.prototype.tanh=function(){return this.throwIfDisposed(),Jm(this)},tp.prototype.tile=function(e){return this.throwIfDisposed(),_g(this,e)},tp.prototype.toBool=function(){return this.throwIfDisposed(),Ov(this,"bool")},tp.prototype.toFloat=function(){return this.throwIfDisposed(),Ov(this,"float32")},tp.prototype.toInt=function(){return this.throwIfDisposed(),Ov(this,"int32")};var a_=Ap({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Ep(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(t));var i={x:r},o={k:t,sorted:n},s=bp.runKernel(xd,i,o),u=f(s,2),c=u[0],l=u[1];return{values:c,indices:l}}});tp.prototype.topk=function(e,t){return this.throwIfDisposed(),a_(this,e,t)},tp.prototype.transpose=function(e){return this.throwIfDisposed(),Qy(this,e)};var i_,o_=Ap({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Ep(e,"x","unique","string_or_numeric");fl(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=bp.runKernel(wd,r,a),o=f(i,2),s=o[0],u=o[1];return{values:s,indices:u}}});function s_(){return null==i_&&(i_=bp.backend.epsilon()),i_}tp.prototype.unique=function(e){return this.throwIfDisposed(),o_(this,e)},tp.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),sk(this,e,t)},tp.prototype.unstack=function(e){return this.throwIfDisposed(),Dy(this,e)},tp.prototype.where=function(e,t){return this.throwIfDisposed(),Ly(e,this,t)},tp.prototype.zerosLike=function(){return this.throwIfDisposed(),Fy(this)};var u_=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,e),Object.setPrototypeOf(ir(r),n.prototype),r}return Jn(n)}(cr(Error)),c_=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,e),Object.setPrototypeOf(ir(r),n.prototype),r}return Jn(n)}(cr(Error)),l_=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,e),Object.setPrototypeOf(ir(r),n.prototype),r}return Jn(n)}(cr(Error)),h_=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,e),Object.setPrototypeOf(ir(r),n.prototype),r}return Jn(n)}(cr(Error)),f_=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,e),Object.setPrototypeOf(ir(r),n.prototype),r}return Jn(n)}(cr(Error));Error;function d_(e,t){if(Array.isArray(e)){for(var n=[],r=0;r<t;r++)n=n.concat(e);return n}var a=new Array(t);return a.fill(e),a}function p_(e,t){if(!e)throw new f_(t)}function v_(e,t){var n,r=0,a=al(e);try{for(a.s();!(n=a.n()).done;){n.value===t&&r++}}catch($Pe){a.e($Pe)}finally{a.f()}return r}function m_(e){return 1===e.length?e[0]:e}function g_(e){return Array.isArray(e)?e:[e]}function y_(e){var t=e.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2").replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==t[0]?t:"private"+t}function b_(e){return e.length<=1||-1===e.indexOf("_")?e:e.replace(/[_]+(\w|$)/g,(function(e,t){return t.toUpperCase()}))}var x_={};function k_(e){if(null===e||void 0===e)return null;var t={};return t.className=e.getClassName(),t.config=e.getConfig(),t}function w_(e){if(null!=e&&"object"===typeof e)if(Array.isArray(e))e.forEach((function(e){return w_(e)}));else for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t],a=e[r];null!=a&&"object"===typeof a&&(Array.isArray(a)||"ndarray"!==a.type||"number"!==typeof a.value?w_(a):e[r]=a.value)}}function __(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"object",a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if("string"===typeof e){var i,o=e;if(o in n)i=n[o];else if(o in x_)i=x_[o];else if(null==(i=t[o]))throw new l_("Unknown ".concat(r,": ").concat(e,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");return i}var s=e;if(null==s.className||null==s.config)throw new l_("".concat(r,": Improper config format: ")+"".concat(JSON.stringify(s),".\n")+"'className' and 'config' must set.");var u,c,l=s.className;if(l in n){var h=f(n[l],2);u=h[0],c=h[1]}else if(l in x_){var d=f(x_.className,2);u=d[0],c=d[1]}else if(l in t){var p=f(t[l],2);u=p[0],c=p[1]}if(null==u)throw new l_("Unknown ".concat(r,": ").concat(l,". ")+"This may be due to one of the following reasons:\n"+"1. The ".concat(r," is defined in Python, in which ")+"case it needs to be ported to TensorFlow.js or your JavaScript code.\n"+"2. The custom ".concat(r," is defined in JavaScript, ")+"but is not registered properly with tf.serialization.registerClass().");if(null!=c){for(var v={},m=0,g=Object.keys(x_);m<g.length;m++){var y=g[m];v[y]=x_[y]}for(var b=0,x=Object.keys(n);b<x.length;b++){var k=x[b];v[k]=n[k]}var w=s.config;w.customObjects=v;for(var _=Object.assign({},x_),S=0,C=Object.keys(n);S<C.length;S++){var T=C[S];x_[T]=n[T]}w_(s.config);var E=c(u,s.config,n,a);return x_=Object.assign({},_),E}for(var I=Object.assign({},x_),A=0,M=Object.keys(n);A<M.length;A++){var N=M[A];x_[N]=n[N]}var R=new u(s.config);return x_=Object.assign({},I),R}function S_(e,t){return-1*function(e,t){return e<t?-1:e>t?1:0}(e,t)}function C_(e){if(null==e)return e;var t,n=[],r=al(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;-1===n.indexOf(a)&&n.push(a)}}catch($Pe){r.e($Pe)}finally{r.f()}return n}function T_(e){if(null==e)throw new l_("Invalid value in obj: ".concat(JSON.stringify(e)));for(var t in e)if(e.hasOwnProperty(t))return!1;return!0}function E_(e,t,n){if(null!=n&&e.indexOf(n)<0)throw new l_("".concat(n," is not a valid ").concat(t,".  Valid values are ").concat(e," or null/undefined."))}function I_(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;return p_(n>=0),p_(r>=n),Array.isArray(e)&&e.length>=n&&e.length<=r&&e.every((function(e){return typeof e===t}))}function A_(e,t){Array.isArray(e)?(fl(e.length>0,(function(){return"".concat(t," is unexpectedly an empty array.")})),e.forEach((function(e,n){return A_(e,"element ".concat(n+1," of ").concat(t))}))):fl(Number.isInteger(e)&&e>0,(function(){return"Expected ".concat(t," to be a positive integer, but got ")+"".concat(M_(e),".")}))}function M_(e){return null===e?"null":Array.isArray(e)?"["+e.map((function(e){return M_(e)})).join(",")+"]":"string"===typeof e?'"'.concat(e,'"'):"".concat(e)}function N_(e){return"relu"===e?"relu":"linear"===e?"linear":"elu"===e?"elu":null}function R_(e,t){return bm((function(){return Iy(Lg(Ym(e,e),t,!0))}))}var D_=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"getConfig",value:function(){return{}}}]),n}(dm),P_=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).defaultMaxValue=2,r.defaultAxis=0,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Jn(n,[{key:"apply",value:function(e){var t=this;return bm((function(){var n=R_(e,t.axis),r=ig(n,0,t.maxValue);return Ym(e,gg(r,Tm(s_(),n)))}))}},{key:"getConfig",value:function(){return{maxValue:this.maxValue,axis:this.axis}}}]),n}(D_);P_.className="MaxNorm",vm(P_);var O_=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).defaultAxis=0,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Jn(n,[{key:"apply",value:function(e){var t=this;return bm((function(){return gg(e,Tm(s_(),R_(e,t.axis)))}))}},{key:"getConfig",value:function(){return{axis:this.axis}}}]),n}(D_);O_.className="UnitNorm",vm(O_);var L_=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e){return my(e)}}]),n}(D_);L_.className="NonNeg",vm(L_);var F_=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).defaultMinValue=0,r.defaultMaxValue=1,r.defaultRate=1,r.defaultAxis=0,r.minValue=null!=e.minValue?e.minValue:r.defaultMinValue,r.maxValue=null!=e.maxValue?e.maxValue:r.defaultMaxValue,r.rate=null!=e.rate?e.rate:r.defaultRate,r.axis=null!=e.axis?e.axis:r.defaultAxis,r}return Jn(n,[{key:"apply",value:function(e){var t=this;return bm((function(){var n=R_(e,t.axis),r=Tm(Ym(t.rate,ig(n,t.minValue,t.maxValue)),Ym(1-t.rate,n));return Ym(e,gg(r,Tm(s_(),n)))}))}},{key:"getConfig",value:function(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}]),n}(D_);F_.className="MinMaxNorm",vm(F_);var z_={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function B_(e){return k_(e)}function U_(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return __(e,pm.getMap().classNameMap,t,"constraint")}function V_(e){return null==e?null:"string"===typeof e?U_({className:e in z_?z_[e]:e,config:{}}):e instanceof D_?e:U_(e)}var W_=["channelsFirst","channelsLast"],G_=["nearest","bilinear"],j_=["valid","same","causal"],q_=["max","avg"],H_=["sum","mul","concat","ave"],X_=new Map;function K_(e){E_(W_,"DataFormat",e)}function Y_(e){E_(j_,"PaddingMode",e)}function Q_(e){E_(q_,"PoolMode",e)}var Z_=[];function J_(e,t){Z_.push(e);try{var n=t();return Z_.pop(),n}catch(r){throw Z_.pop(),r}}function $_(e){if(!nS(e))throw new Error("Not a valid tensor name: '"+e+"'");return(0===Z_.length?"":Z_.join("/")+"/")+e}function eS(e){if(!nS(e))throw new Error("Not a valid tensor name: '"+e+"'");X_.has(e)||X_.set(e,0);var t=X_.get(e);if(X_.set(e,X_.get(e)+1),t>0){var n="".concat(e,"_").concat(t);return X_.set(n,1),n}return e}var tS=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function nS(e){return!!e.match(tS)}function rS(e){return e===parseInt(e.toString(),10)}function aS(e,t,n){null==t&&(t=0),null==n&&(n=e.length);for(var r=1,a=t;a<n;++a)r*=e[a];return r}function iS(e){return Ny(e=Array.isArray(e)?new Float32Array(e):e)}function oS(e){return Gg(iS(e)).dataSync()[0]}function sS(e){return Pg(iS(e)).dataSync()[0]}function uS(e,t){if(t<e)throw new l_("end (".concat(t,") < begin (").concat(e,") is forbidden."));for(var n=[],r=e;r<t;++r)n.push(r);return n}function cS(e,t){return e.asType(t)}function lS(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=e.shape.slice();return t<0&&(t=n.length+t+1),n.splice(t,0,1),e.reshape(n)}function hS(e){var t=[aS(e.shape)];return e.reshape(t)}function fS(e,t,n){return bm((function(){switch(e.rank){case 1:return ky(e,t,n);case 2:return wy(e,[t,0],[n,e.shape[1]]);case 3:return _y(e,[t,0,0],[n,e.shape[1],e.shape[2]]);case 4:return Sy(e,[t,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3]]);case 5:return Zm(e,[t,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4]]);case 6:return Zm(e,[t,0,0,0,0,0],[n,e.shape[1],e.shape[2],e.shape[3],e.shape[4],e.shape[5]]);default:throw new l_("sliceAlongFirstAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function dS(e,t,n){return bm((function(){switch(e.rank){case 1:return ky(e,t,n);case 2:return wy(e,[0,t],[e.shape[0],n]);case 3:return _y(e,[0,0,t],[e.shape[0],e.shape[1],n]);case 4:return Sy(e,[0,0,0,t],[e.shape[0],e.shape[1],e.shape[2],n]);default:throw new l_("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function pS(e,t,n,r){return bm((function(){switch(e.rank){case 1:return ky(e,t,n);case 2:switch(r){case 1:return fS(e,t,n);case 2:return dS(e,t,n);default:throw new l_("The axis is not within the rank of the tensor "+"".concat(r))}case 3:switch(r){case 1:return fS(e,t,n);case 2:return _y(e,[0,t,0],[e.shape[0],n,e.shape[2]]);case 3:return dS(e,t,n);default:throw new l_("The axis is not within the rank of the tensor "+"".concat(r))}case 4:switch(r){case 1:return fS(e,t,n);case 2:return Sy(e,[0,t,0,0],[e.shape[0],n,e.shape[2],e.shape[3]]);case 3:return Sy(e,[0,0,t,0],[e.shape[0],e.shape[1],n,e.shape[3]]);case 4:return dS(e,t,n);default:throw new l_("The axis is not within the rank of the tensor "+"".concat(r))}default:throw new l_("sliceAlongLastAxis() received an unsupported tensor rank: "+"".concat(e.rank))}}))}function vS(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return n<0&&(n=0!==(t=e[0].rank)?t:0),n===e[0].rank&&(n=-1),Xm(e,n)}function mS(e,t){switch(e.rank){case 1:return og([e,t]);case 2:return sg([e,t],0);case 3:return ug([e,t],0);case 4:return cg([e,t],0);default:throw new l_("concatAlongFirstAxis() received an unsupported "+"tensor rank: ".concat(e.rank))}}function gS(e,t){if(Array.isArray(t)||(t=[t]),e.rank!==t.length)throw new l_("The length of input n (".concat(t.length,") does not match ")+"the number of dimensions in input x (".concat(e.rank,")"));return _g(e,t)}function yS(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3?arguments[3]:void 0,a=arguments.length>4?arguments[4]:void 0;return py(e,t,n,r,a)}function bS(e,t,n,r){if(e.rank<2||t.rank<2)throw new h_("dot requires both inputs to be rank >= 2"+" but got x shape = ".concat(e.shape," and y shape = ").concat(t.shape));if(t.rank>=3&&e.shape.slice(-1)[0]!==t.shape.slice(-2)[0])throw new h_("If rank y >= 3, then the second last dim"+" of y must equal the last dim of x but got x shape = ".concat(e.shape," and ")+" y shape = ".concat(t.shape));if(2===e.rank&&2===t.rank){return pb({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?wS(e.rank,r,"channelsLast"):null,activation:n})}var a=e.shape.slice(),i=a.pop();e=e.reshape([-1,i]);var o=t.shape.slice(),s=o.pop(),u=o.pop(),c=[].concat(Tt(o),[s]),l=Array.from({length:t.rank},(function(e,n){return 0===n?t.rank-2:n<=t.rank-2?n-1:n}));t=t.transpose(l).reshape([u,-1]);var h=[].concat(Tt(a),Tt(c));return pb({a:e,b:t,transposeA:!1,transposeB:!1,bias:r?wS(e.rank,r,"channelsLast"):null,activation:n}).reshape(h)}function xS(e,t,n){return bm((function(){return t=Array.isArray(t)?Ny(t,"int32"):t.toInt(),Eg(e,t,n)}))}function kS(e){return Ym(e,e)}function wS(e,t,n){var r=t.shape;if(1!==t.rank&&t.rank!==e)throw new l_("Unexpected bias dimensions: ".concat(t.rank)+"; expected it to be 1 or ".concat(e));if(5===e){if("channelsFirst"===n)return 1===r.length?t.reshape([1,r[0],1,1,1]):t.reshape([1,r[3],r[0],r[1],r[2]]);if("channelsLast"===n)return 1===r.length?t.reshape([1,1,1,1,r[0]]):t.reshape([1].concat(r))}else if(4===e){if("channelsFirst"===n)return 1===r.length?t.reshape([1,r[0],1,1]):t.reshape([1,r[2],r[0],r[1]]);if("channelsLast"===n)return 1===r.length?t.reshape([1,1,1,r[0]]):t.reshape([1].concat(r))}else if(3===e){if("channelsFirst"===n)return 1===r.length?t.reshape([1,r[0],1]):t.reshape([1,r[1],r[0]]);if("channelsLast"===n)return 1===r.length?t.reshape([1,1,r[0]]):t.reshape([1].concat(r))}else if(e<3)return t;throw new l_("Unsupported input rank by biasAdd: ".concat(t.rank))}function _S(e,t,n){return bm((function(){return null==n&&(n="channelsLast"),K_(n),e.add(wS(e.rank,t,n))}))}function SS(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(1!==t)throw new h_("Support for alpha values other than 1 (".concat(t,") is not implemented ")+"yet.");return yg(e)}function CS(e,t,n,r){return bm((function(){return Zy(e,t,n,r)}))}function TS(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n?e():t()}var ES=["fanIn","fanOut","fanAvg"],IS=["normal","uniform","truncatedNormal"];var AS=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"fromConfigUsesCustomObjects",value:function(){return!1}},{key:"getConfig",value:function(){return{}}}]),n}(dm),MS=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e,t){return iy(e,t)}}]),n}(AS);MS.className="Zeros",vm(MS);var NS=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e,t){return oy(e,t)}}]),n}(AS);NS.className="Ones",vm(NS);var RS=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),r=t.call(this),"object"!==typeof e)throw new l_("Expected argument of type ConstantConfig but got ".concat(e));if(void 0===e.value)throw new l_("config must have value set but got ".concat(e));return r.value=e.value,r}return Jn(n,[{key:"apply",value:function(e,t){var n=this;return bm((function(){return Ym(_m(n.value),oy(e,t))}))}},{key:"getConfig",value:function(){return{value:this.value}}}]),n}(AS);RS.className="Constant",vm(RS);var DS=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).DEFAULT_MINVAL=-.05,r.DEFAULT_MAXVAL=.05,r.minval=e.minval||r.DEFAULT_MINVAL,r.maxval=e.maxval||r.DEFAULT_MAXVAL,r.seed=e.seed,r}return Jn(n,[{key:"apply",value:function(e,t){return vy(e,this.minval,this.maxval,t)}},{key:"getConfig",value:function(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}]),n}(AS);DS.className="RandomUniform",vm(DS);var PS=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return Jn(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new h_("randomNormal does not support dType ".concat(t,"."));return yS(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(AS);PS.className="RandomNormal",vm(PS);var OS=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).DEFAULT_MEAN=0,r.DEFAULT_STDDEV=.05,r.mean=e.mean||r.DEFAULT_MEAN,r.stddev=e.stddev||r.DEFAULT_STDDEV,r.seed=e.seed,r}return Jn(n,[{key:"apply",value:function(e,t){if("float32"!==(t=t||"float32")&&"int32"!==t)throw new h_("truncatedNormal does not support dType ".concat(t,"."));return Ry(e,this.mean,this.stddev,t,this.seed)}},{key:"getConfig",value:function(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}]),n}(AS);OS.className="TruncatedNormal",vm(OS);var LS=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).gain=null!=e.gain?e.gain:1,r}return Jn(n,[{key:"apply",value:function(e,t){var n=this;return bm((function(){if(2!==e.length||e[0]!==e[1])throw new l_("Identity matrix initializer can only be used for 2D square matrices.");return Ym(n.gain,Sg(e[0]))}))}},{key:"getConfig",value:function(){return{gain:this.gain}}}]),n}(AS);LS.className="Identity",vm(LS);var FS=function(e){tr(n,e);var t=sr(n);function n(e){var r,a;if($n(this,n),r=t.call(this),e.scale<0)throw new l_("scale must be a positive float. Got: ".concat(e.scale));return r.scale=null==e.scale?1:e.scale,r.mode=null==e.mode?"fanIn":e.mode,a=r.mode,E_(ES,"FanMode",a),r.distribution=null==e.distribution?"normal":e.distribution,function(e){E_(IS,"Distribution",e)}(r.distribution),r.seed=e.seed,r}return Jn(n,[{key:"apply",value:function(e,t){var n=function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"channelsLast";if(K_(r),2===e.length)t=e[0],n=e[1];else if(-1!==[3,4,5].indexOf(e.length)){if("channelsFirst"===r){var a=aS(e,2);t=e[1]*a,n=e[0]*a}else if("channelsLast"===r){var i=aS(e,0,e.length-2);t=e[e.length-2]*i,n=e[e.length-1]*i}}else{var o=aS(e);t=Math.sqrt(o),n=Math.sqrt(o)}return[t,n]}(e),r=n[0],a=n[1],i=this.scale;if("fanIn"===this.mode?i/=Math.max(1,r):"fanOut"===this.mode?i/=Math.max(1,a):i/=Math.max(1,(r+a)/2),"normal"===this.distribution){var o=Math.sqrt(i);if("float32"!==(t=t||"float32")&&"int32"!==t)throw new h_("".concat(this.getClassName()," does not support dType ").concat(t,"."));return Ry(e,0,o,t,this.seed)}var s=Math.sqrt(3*i);return vy(e,-s,s,t)}},{key:"getConfig",value:function(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}]),n}(AS);FS.className="VarianceScaling",vm(FS);var zS=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"uniform",seed:null==e?null:e.seed})}return Jn(n,[{key:"getClassName",value:function(){return FS.className}}]),n}(FS);zS.className="GlorotUniform",vm(zS);var BS=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,{scale:1,mode:"fanAvg",distribution:"normal",seed:null==e?null:e.seed})}return Jn(n,[{key:"getClassName",value:function(){return FS.className}}]),n}(FS);BS.className="GlorotNormal",vm(BS);var US=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return Jn(n,[{key:"getClassName",value:function(){return FS.className}}]),n}(FS);US.className="HeNormal",vm(US);var VS=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,{scale:2,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return Jn(n,[{key:"getClassName",value:function(){return FS.className}}]),n}(FS);VS.className="HeUniform",vm(VS);var WS=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"normal",seed:null==e?null:e.seed})}return Jn(n,[{key:"getClassName",value:function(){return FS.className}}]),n}(FS);WS.className="LeCunNormal",vm(WS);var GS=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,{scale:1,mode:"fanIn",distribution:"uniform",seed:null==e?null:e.seed})}return Jn(n,[{key:"getClassName",value:function(){return FS.className}}]),n}(FS);GS.className="LeCunNormal",vm(GS);var jS=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),(r=t.call(this)).DEFAULT_GAIN=1,r.gain=null==e.gain?r.DEFAULT_GAIN:e.gain,r.seed=e.seed,null!=r.seed)throw new h_("Random seed is not implemented for Orthogonal Initializer yet.");return r}return Jn(n,[{key:"apply",value:function(e,t){var n=this;return bm((function(){if(e.length<2)throw new h_("Shape must be at least 2D.");e[0]*e[1]>2e3&&console.warn("Orthogonal initializer is being called on a matrix with more "+"than 2000 (".concat(e[0]*e[1],") elements: ")+"Slowness may result.");var t=yS(e[0]>e[1]?[e[1],e[0]]:e,0,1,"float32"),r=Xb.gramSchmidt(t);return e[0]>e[1]&&(r=r.transpose()),Ym(n.gain,r)}))}},{key:"getConfig",value:function(){return{gain:this.gain,seed:this.seed}}}]),n}(AS);jS.className="Orthogonal",vm(jS);var qS={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function HS(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return __(e,pm.getMap().classNameMap,t,"initializer")}function XS(e){return k_(e)}function KS(e){if("string"===typeof e){var t=e in qS?qS[e]:e;if("GlorotNormal"===t)return new BS;if("GlorotUniform"===t)return new zS;if("HeNormal"===t)return new US;if("HeUniform"===t)return new VS;if("LeCunNormal"===t)return new WS;if("LeCunUniform"===t)return new GS;var n={};return n.className=t,n.config={},HS(n)}return e instanceof AS?e:HS(e)}var YS=0;function QS(){return YS++}var ZS={};function JS(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return e in ZS||(ZS[e]=0),ZS[e]+=1,e+ZS[e].toString()}function $S(e){return Array.isArray(e)&&Array.isArray(e[0])}function eC(e){return 0===e.length?[]:Array.isArray(e[0])?e:[e]}function tC(e){var t;if(Array.isArray(e)){if(1!==e.length)throw new l_("Expected Tensor length to be 1; got ".concat(e.length));t=e[0]}else t=e;return t}function nC(e){if(Array.isArray(e)&&Array.isArray(e[0])){if(1===e.length)return e[0];throw new l_("Expected exactly 1 Shape; got ".concat(e.length))}return e}function rC(e){var t,n=0,r=al(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;0===a.shape.length?n+=1:n+=a.shape.reduce((function(e,t){return e*t}))}}catch($Pe){r.e($Pe)}finally{r.f()}return n}var aC="Variable",iC=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:aC,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null;$n(this,e),this.dtype=null==n?"float32":n,this.shape=t.shape,this.id=QS(),r=null==r?aC:r,this.originalName=$_(r),this.name=eS(this.originalName),this.trainable_=a,this.constraint=i,this.val=Py(t,this.trainable_,this.name,this.dtype)}return Jn(e,[{key:"read",value:function(){return this.assertNotDisposed(),this.val}},{key:"write",value:function(e){return this.assertNotDisposed(),function(e,t){if(e.shape.toString()!==t.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(e.shape)+" vs. "+JSON.stringify(t.shape))}(this.val,e),this.val.id!==e.id&&(this.val.assign(e),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}},{key:"dispose",value:function(){this.assertNotDisposed(),this.val.dispose()}},{key:"assertNotDisposed",value:function(){if(this.val.isDisposed)throw new Error("LayersVariable ".concat(this.name," is already disposed."))}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.trainable_=e,this.val.trainable=e}}]),e}();function oC(e){return e.map((function(e){return e.read()}))}function sC(e){e.forEach((function(e){e[0].write(e[1])}))}var uC=Jn((function e(t){$n(this,e),this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}})),cC=Jn((function e(t,n,r,a,i,o,s){$n(this,e),this.dtype=t,this.shape=n,this.sourceLayer=r,this.inputs=a,this.callArgs=i,this.outputTensorIndex=s,this.id=QS(),null!=o&&(this.originalName=$_(o),this.name=eS(this.originalName)),this.rank=n.length})),lC=0,hC=function(){function e(t,n){$n(this,e),this.callArgs=n,this.id=lC++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;var r,a=al(t.inboundLayers);try{for(a.s();!(r=a.n()).done;){var i=r.value;null!=i&&i.outboundNodes.push(this)}}catch($Pe){a.e($Pe)}finally{a.f()}t.outboundLayer.inboundNodes.push(this)}return Jn(e,[{key:"getConfig",value:function(){var e,t=[],n=al(this.inboundLayers);try{for(n.s();!(e=n.n()).done;){var r=e.value;null!=r?t.push(r.name):t.push(null)}}catch($Pe){n.e($Pe)}finally{n.f()}return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}]),e}(),fC=0,dC=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};$n(this,n),(e=t.call(this))._callHook=null,e._addedWeightNames=[],e._stateful=!1,e.id=fC++,e.activityRegularizer=null,e.inputSpec=null,e.supportsMasking=!1,e._trainableWeights=[],e._nonTrainableWeights=[],e._losses=[],e._updates=[],e._built=!1,e.inboundNodes=[],e.outboundNodes=[];var a=r.name;if(!a){var i=e.getClassName();a=y_(i)+"_"+JS(i)}if(e.name=a,e.trainable_=null==r.trainable||r.trainable,null!=r.inputShape||null!=r.batchInputShape){var o;if(null!=r.batchInputShape)o=r.batchInputShape;else if(null!=r.inputShape){var s=null;null!=r.batchSize&&(s=r.batchSize),o=[s].concat(r.inputShape)}e.batchInputShape=o;var u=r.dtype;null==u&&(u=r.inputDType),null==u&&(u="float32"),e.dtype=u}return null!=r.weights?e.initialWeights=r.weights:e.initialWeights=null,e._refCount=null,e.fastWeightInitDuringBuild=!1,e}return Jn(n,[{key:"getNodeAtIndex",value:function(e,t){if(0===this.inboundNodes.length)throw new c_("The layer has never been called "+"and thus has no defined ".concat(t,"."));if(this.inboundNodes.length<=e)throw new l_("Asked to get ".concat(t," at node ").concat(e,", ")+"but the layer has only ".concat(this.inboundNodes.length," inbound nodes."));return this.inboundNodes[e]}},{key:"getInputAt",value:function(e){return m_(this.getNodeAtIndex(e,"input").inputTensors)}},{key:"getOutputAt",value:function(e){return m_(this.getNodeAtIndex(e,"output").outputTensors)}},{key:"input",get:function(){if(this.inboundNodes.length>1)throw new u_("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use `getInputAt(nodeIndex)` instead.');if(0===this.inboundNodes.length)throw new u_("Layer ".concat(this.name)+" is not connected, no input to return.");return m_(this.getNodeAtIndex(0,"input").inputTensors)}},{key:"output",get:function(){if(0===this.inboundNodes.length)throw new u_("Layer ".concat(this.name)+" has no inbound nodes.");if(this.inboundNodes.length>1)throw new u_("Layer ".concat(this.name)+' has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use `getOutputAt(nodeIndex)` instead.');return m_(this.getNodeAtIndex(0,"output").outputTensors)}},{key:"losses",get:function(){return this._losses}},{key:"calculateLosses",value:function(){return this.losses.map((function(e){return e()}))}},{key:"updates",get:function(){return this._updates}},{key:"built",get:function(){return this._built},set:function(e){this._built=e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this._trainableWeights.forEach((function(t){return t.trainable=e})),this.trainable_=e}},{key:"trainableWeights",get:function(){return this.trainable_?this._trainableWeights.filter((function(e){return e.trainable})):[]},set:function(e){this._trainableWeights=e}},{key:"nonTrainableWeights",get:function(){return this.trainable?this._trainableWeights.filter((function(e){return!e.trainable})).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)},set:function(e){this._nonTrainableWeights=e}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"stateful",get:function(){return this._stateful}},{key:"resetStates",value:function(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}},{key:"assertInputCompatibility",value:function(e){if(e=g_(e),null!=this.inputSpec&&0!==this.inputSpec.length){var t=g_(this.inputSpec);if(e.length!==t.length)throw new l_("Layer ".concat(this.name," expects ").concat(t.length," inputs, ")+"but it received ".concat(e.length," input tensors. ")+"Input received: ".concat(e));for(var n=0;n<e.length;n++){var r=e[n],a=t[n];if(null!=a){var i=r.rank;if(null!=a.ndim&&i!==a.ndim)throw new l_("Input ".concat(n," is incompatible with layer ").concat(this.name,": ")+"expected ndim=".concat(a.ndim,", found ndim=").concat(i));if(null!=a.maxNDim&&i>a.maxNDim)throw new l_("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected max_ndim=".concat(a.maxNDim,", found ndim=").concat(i));if(null!=a.minNDim&&i<a.minNDim)throw new l_("Input ".concat(n," is incompatible with layer ").concat(this.name)+": expected min_ndim=".concat(a.minNDim,", found ndim=").concat(i,"."));if(null!=a.dtype&&r.dtype!==a.dtype)throw new l_("Input ".concat(n," is incompatible with layer ").concat(this.name," ")+": expected dtype=".concat(a.dtype,", found dtype=").concat(r.dtype,"."));if(a.axes){var o=r.shape;for(var s in a.axes){var u=Number(s),c=a.axes[s],l=u>=0?o[u]:o[o.length+u];if(null!=c&&-1===[c,null].indexOf(l))throw new l_("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected axis ").concat(u," of input shape to ")+"have value ".concat(c," but got shape ").concat(o,"."))}}if(null!=a.shape)for(var h=0;h<a.shape.length;++h){var f=a.shape[h],d=r.shape[h];if(null!=f&&null!=d&&f!==d)throw new l_("Input ".concat(n," is incompatible with layer ")+"".concat(this.name,": expected shape=").concat(a.shape,", ")+"found shape=".concat(r.shape,"."))}}}}}},{key:"call",value:function(e,t){return e}},{key:"invokeCallHook",value:function(e,t){null!=this._callHook&&this._callHook(e,t)}},{key:"setCallHook",value:function(e){this._callHook=e}},{key:"clearCallHook",value:function(){this._callHook=null}},{key:"apply",value:function(e,t){var n=this;t=t||{},this.assertNotDisposed();var r,a=g_(e),i=!0,o=al(a);try{for(o.s();!(r=o.n()).done;){if(!(r.value instanceof cC)){i=!1;break}}}catch($Pe){o.e($Pe)}finally{o.f()}var s,u=!0,c=al(a);try{for(c.s();!(s=c.n()).done;){if(s.value instanceof cC){u=!1;break}}}catch($Pe){c.e($Pe)}finally{c.f()}if(i===u)throw new l_("Arguments to apply() must be all SymbolicTensors or all Tensors");return J_(this.name,(function(){if(!n.built){n.assertInputCompatibility(e);var r,i=[],o=al(g_(e));try{for(o.s();!(r=o.n()).done;){var s=r.value;i.push(s.shape)}}catch($Pe){o.e($Pe)}finally{o.f()}n.build(m_(i)),n.built=!0,n.initialWeights&&n.setWeights(n.initialWeights),null===n._refCount&&u&&(n._refCount=1)}if(n.assertInputCompatibility(e),u){var c,l=n.call(e,t),h=[],f=al(g_(l));try{for(f.s();!(c=f.n()).done;){var d=c.value;-1!==a.indexOf(d)&&(d=d.clone()),h.push(d)}}catch($Pe){f.e($Pe)}finally{f.f()}if(l=m_(h),null!=n.activityRegularizer)throw new h_("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return l}var p,v=function(e){e=g_(e);var t,n=[],r=al(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;n.push(a.shape)}}catch($Pe){r.e($Pe)}finally{r.f()}return m_(n)}(e),m=n.computeOutputShape(v),g="float32";if(n.warnOnIncompatibleInputShape(Array.isArray(e)?v[0]:v),p=null!=m&&m.length>0&&Array.isArray(m[0])?m.map((function(r,a){return new cC(g,r,n,g_(e),t,n.name,a)})):new cC(g,m,n,g_(e),t,n.name),n.addInboundNode(e,p,null,null,v,m,t),n._refCount++,null!=n.activityRegularizer)throw new h_("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return p}))}},{key:"warnOnIncompatibleInputShape",value:function(e){if(null!=this.batchInputShape)if(e.length!==this.batchInputShape.length)console.warn("The rank of the input tensor provided (shape: "+"".concat(JSON.stringify(e),") does not match that of the ")+"batchInputShape (".concat(JSON.stringify(this.batchInputShape),") ")+"of the layer ".concat(this.name));else{var t=!1;this.batchInputShape.forEach((function(n,r){null!=n&&null!=e[r]&&e[r]!==n&&(t=!0)})),t&&console.warn("The shape of the input tensor "+"(".concat(JSON.stringify(e),") does not ")+"match the expectation of layer ".concat(this.name,": ")+"".concat(JSON.stringify(this.batchInputShape)))}}},{key:"outputShape",get:function(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new u_("The layer ".concat(this.name," has never been called and thus has no ")+"defined output shape.");var e,t=[],n=al(this.inboundNodes);try{for(n.s();!(e=n.n()).done;){var r=e.value,a=JSON.stringify(r.outputShapes);-1===t.indexOf(a)&&t.push(a)}}catch($Pe){n.e($Pe)}finally{n.f()}if(1===t.length){var i=this.inboundNodes[0].outputShapes;return Array.isArray(i)&&Array.isArray(i[0])&&1===i.length?i[0]:i}throw new u_("The layer ".concat(this.name," has multiple inbound nodes with different ")+'output shapes. Hence the notion of "output shape" is ill-defined for the layer.')}},{key:"countParams",value:function(){if(!this.built)throw new c_("You tried to call countParams() on ".concat(this.name,", ")+"but the layer is not built yet. Build it first by calling build(batchInputShape).");return rC(this.weights)}},{key:"build",value:function(e){this.built=!0}},{key:"getWeights",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return oC(e?this.trainableWeights:this.weights)}},{key:"setWeights",value:function(e){var t=this;bm((function(){var n=t.weights;if(n.length!==e.length)throw new l_('You called setWeights(weights) on layer "'.concat(t.name,'" ')+"with a weight list of length ".concat(e.length,", ")+"but the layer was expecting ".concat(n.length," weights. ")+"Provided weights: ".concat(e,"..."));if(0!==n.length){for(var r=[],a=oC(n),i=0;i<a.length;++i){var o=a[i],s=n[i],u=e[i];if(!gl(o.shape,u.shape))throw new l_("Layer weight shape ".concat(o.shape," ")+"not compatible with provided weight shape ".concat(u.shape));r.push([s,u])}sC(r)}}))}},{key:"addWeight",value:function(e,t,n,r,a,i,o){if(-1!==this._addedWeightNames.indexOf(e))throw new l_("Duplicate weight name ".concat(e," for layer ").concat(this.name));this._addedWeightNames.push(e),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(r=KS("zeros"));var s=r.apply(t,n),u=new iC(s,n,e,i,o);return s.dispose(),null!=a&&this.addLoss((function(){return a.apply(u.read())})),null==i&&(i=!0),i?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}},{key:"setFastWeightInitDuringBuild",value:function(e){this.fastWeightInitDuringBuild=e}},{key:"addLoss",value:function(e){var t;null==e||Array.isArray(e)&&0===e.length||(e=g_(e),void 0!==this._losses&&null!==this._losses&&(t=this.losses).push.apply(t,Tt(e)))}},{key:"computeOutputShape",value:function(e){return e}},{key:"computeMask",value:function(e,t){var n=this;if(!this.supportsMasking){if(null!=t){if(!Array.isArray(t))throw new TypeError("Layer ".concat(this.name," does not support masking, ")+"but was passed an inputMask.");t.forEach((function(e){if(null!=e)throw new TypeError("Layer ".concat(n.name," does not support masking, ")+"but was passed an inputMask.")}))}return null}return t}},{key:"addInboundNode",value:function(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,s=g_(e);t=g_(t),n=g_(n),r=g_(r),a=eC(a),i=eC(i);var u,c=[],l=[],h=[],f=al(s);try{for(f.s();!(u=f.n()).done;){var d=u.value;c.push(d.sourceLayer),l.push(d.nodeIndex),h.push(d.tensorIndex)}}catch($Pe){f.e($Pe)}finally{f.f()}new hC({outboundLayer:this,inboundLayers:c,nodeIndices:l,tensorIndices:h,inputTensors:s,outputTensors:t,inputMasks:n,outputMasks:r,inputShapes:a,outputShapes:i},o);for(var p=0;p<t.length;p++)t[p].sourceLayer=this,t[p].nodeIndex=this.inboundNodes.length-1,t[p].tensorIndex=p}},{key:"getConfig",value:function(){var e={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(e.batchInputShape=this.batchInputShape),null!=this.dtype&&(e.dtype=this.dtype),e}},{key:"disposeWeights",value:function(){return this.weights.forEach((function(e){return e.dispose()})),this.weights.length}},{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Layer '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){if(!this.built)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been ")+"built yet.");if(null===this._refCount)throw new Error("Cannot dispose Layer ".concat(this.name," because it has not been used ")+"yet.");this.assertNotDisposed();var e=0;return 0===--this._refCount&&(e=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:e}}}],[{key:"nodeKey",value:function(e,t){return e.name+"_ib-"+t.toString()}}]),n}(dm);function pC(e,t,n){if((null==t||null!=n&&n>0)&&(t=e.sourceLayer,n=e.nodeIndex),0===t.inboundNodes.length)return[e];var r=t.inboundNodes[n];if(0===r.inboundLayers.length)return r.inputTensors;for(var a=[],i=0;i<r.inboundLayers.length;i++){var o,s=al(pC(r.inputTensors[i],r.inboundLayers[i],r.nodeIndices[i]));try{for(s.s();!(o=s.n()).done;){var u=o.value;-1===a.indexOf(u)&&a.push(u)}}catch($Pe){s.e($Pe)}finally{s.f()}}return a}var vC,mC=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),r=t.call(this,{dtype:e.dtype,name:null!=e.name?e.name:JS("input").toString()}),null==e.batchSize&&(e.batchSize=null),null==e.sparse&&(e.sparse=!1),r.trainable=!1,r.built=!0,r.sparse=e.sparse,null!=e.inputShape&&null!=e.batchInputShape)throw new l_("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");var a=e.batchInputShape;if(null==a){if(null==e.inputShape)throw new l_("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");a=[e.batchSize].concat(e.inputShape)}else if(null!=e.batchSize)throw new l_("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");var i=e.dtype||"float32";r.batchInputShape=a,r.dtype=i,r.inputSpec=[{shape:a}];var o=new cC(r.dtype,r.batchInputShape,ir(r),[],{},r.name);return o.nodeIndex=0,o.tensorIndex=0,new hC({outboundLayer:ir(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[o],outputTensors:[o],inputMasks:[null],outputMasks:[null],inputShapes:[a],outputShapes:[a]}),r}return Jn(n,[{key:"apply",value:function(e,t){throw new l_("Cannot pass any input to an "+"InputLayer's apply() method. InputLayer name: ".concat(this.name))}},{key:"dispose",value:function(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}},{key:"getConfig",value:function(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}]),n}(dC);function gC(e){return yC.apply(this,arguments)}function yC(){return yC=ns(es().mark((function e(t){var n,r,a,i,o,s,u,c;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t){e.next=2;break}return e.abrupt("return");case 2:for(i in n=[],r=[],a=[],t)"number"!==typeof(o=t[i])&&(s=o,n.push(s.data()),r.push(i),a.push(s));if(!(n.length>0)){e.next=12;break}return e.next=9,Promise.all(n);case 9:for(u=e.sent,c=0;c<u.length;++c)t[r[c]]=u[c][0];xm(a);case 12:case"end":return e.stop()}}),e)}))),yC.apply(this,arguments)}function bC(e){if(null!=e)for(var t in e){var n=e[t];"number"!==typeof n&&n.dispose()}}mC.className="InputLayer",vm(mC),function(e){e[e.SILENT=0]="SILENT",e[e.VERBOSE=1]="VERBOSE"}(vC||(vC={}));var xC=function(){function e(){$n(this,e),this.validationData=null}return Jn(e,[{key:"setParams",value:function(e){this.params=e}},{key:"onEpochBegin",value:function(){var e=ns(es().mark((function e(t,n){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=ns(es().mark((function e(t,n){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=ns(es().mark((function e(t,n){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=ns(es().mark((function e(t,n){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"setModel",value:function(e){}}]),e}(),kC=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;$n(this,e),null==t&&(t=[]),this.callbacks=t,this.queueLength=n}return Jn(e,[{key:"append",value:function(e){this.callbacks.push(e)}},{key:"setParams",value:function(e){var t,n=al(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setParams(e)}}catch($Pe){n.e($Pe)}finally{n.f()}}},{key:"setModel",value:function(e){var t,n=al(this.callbacks);try{for(n.s();!(t=n.n()).done;){t.value.setModel(e)}}catch($Pe){n.e($Pe)}finally{n.f()}}},{key:"onEpochBegin",value:function(){var e=ns(es().mark((function e(t,n){var r,a,i;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=al(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=ns(es().mark((function e(t,n){var r,a,i;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=al(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onEpochEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=ns(es().mark((function e(t,n){var r,a,i;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=al(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchBegin(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=ns(es().mark((function e(t,n){var r,a,i;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==n&&(n={}),r=al(this.callbacks),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=10;break}return i=a.value,e.next=8,i.onBatchEnd(t,n);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),r.e(e.t0);case 15:return e.prev=15,r.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=ns(es().mark((function e(t){var n,r,a;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=al(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainBegin(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=ns(es().mark((function e(t){var n,r,a;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null==t&&(t={}),n=al(this.callbacks),e.prev=2,n.s();case 4:if((r=n.n()).done){e.next=10;break}return a=r.value,e.next=8,a.onTrainEnd(t);case 8:e.next=4;break;case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(2),n.e(e.t0);case 15:return e.prev=15,n.f(),e.finish(15);case 18:case"end":return e.stop()}}),e,this,[[2,12,15,18]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),wC=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.call(this)}return Jn(n,[{key:"onEpochBegin",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.seen=0,this.totals={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=ns(es().mark((function e(t,n){var r,a,i,o=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(i in null==n&&(n={}),r=null==n.size?0:n.size,this.seen+=r,a=function(e){var t=n[e];if("number"===typeof t)o.totals.hasOwnProperty(e)||(o.totals[e]=0),o.totals[e]=o.totals[e]+t*r;else{var a;e in o.totals?a=o.totals[e]:o.totals[e]=0;var i=bm((function(){return Tm(o.totals[e],Ym(t,r))}));o.totals[e]=i,null!=a&&a.dispose()}},n)a(i);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=ns(es().mark((function e(t,n){var r,a,i,o=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n){e.next=19;break}r=al(this.params.metrics),e.prev=2,i=function(){var e=a.value;if(null==o.totals[e])return"continue";"number"===typeof o.totals[e]?n[e]=o.totals[e]/o.seen:bm((function(){var t=Ym(gg(1,o.seen),o.totals[e]);n[e]=t,o.totals[e].dispose(),km(n[e])}))},r.s();case 5:if((a=r.n()).done){e.next=11;break}if("continue"!==i()){e.next=9;break}return e.abrupt("continue",9);case 9:e.next=5;break;case 11:e.next=16;break;case 13:e.prev=13,e.t0=e.catch(2),r.e(e.t0);case 16:return e.prev=16,r.f(),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[2,13,16,19]])})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(xC),_C=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"onTrainBegin",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.epoch=[],this.history={};case 2:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=ns(es().mark((function e(t,n){var r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(r in null==n&&(n={}),this.epoch.push(t),n)null==this.history[r]&&(this.history[r]=[]),this.history[r].push(n[r]);case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"syncData",value:function(){var e=ns(es().mark((function e(){var t,n,r,a,i,o,s,u,c;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(a in t=[],n=[],r=[],this.history)for(i=this.history[a],o=0;o<i.length;++o)"number"!==typeof i[o]&&(s=i[o],t.push(s.data()),n.push(a),r.push(o));return e.next=6,Promise.all(t);case 6:for(u=e.sent,c=0;c<u.length;++c)this.history[n[c]][r[c]].dispose(),this.history[n[c]][r[c]]=u[c][0];case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(xC),SC=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;if($n(this,n),(a=t.call(this)).currentEpoch=0,a.yieldEvery=r||"auto","auto"===a.yieldEvery&&(a.yieldEvery=125),"never"===a.yieldEvery&&null!=e.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");return Ml(a.yieldEvery)&&(a.maybeWait=function(e,t){var n,r=Yd();return function(){var a=Yd();return a-r<t?n:(r=a,n=e.apply(void 0,arguments))}}(a.maybeWait.bind(ir(a)),a.yieldEvery)),a.trainBegin=e.onTrainBegin,a.trainEnd=e.onTrainEnd,a.epochBegin=e.onEpochBegin,a.epochEnd=e.onEpochEnd,a.batchBegin=e.onBatchBegin,a.batchEnd=e.onBatchEnd,a.yield=e.onYield,a}return Jn(n,[{key:"maybeWait",value:function(){var e=ns(es().mark((function e(t,n,r){var a;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=[],null==this.yield){e.next=5;break}return e.next=4,gC(r);case 4:a.push(this.yield(t,n,r));case 5:return a.push(ax()),e.next=8,Promise.all(a);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"onEpochBegin",value:function(){var e=ns(es().mark((function e(t,n){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.currentEpoch=t,null==this.epochBegin){e.next=6;break}return e.next=4,gC(n);case 4:return e.next=6,this.epochBegin(t,n);case 6:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onEpochEnd",value:function(){var e=ns(es().mark((function e(t,n){var r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.epochEnd){e.next=5;break}return e.next=4,gC(n);case 4:r.push(this.epochEnd(t,n));case 5:return"epoch"===this.yieldEvery&&r.push(ax()),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchBegin",value:function(){var e=ns(es().mark((function e(t,n){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.batchBegin){e.next=5;break}return e.next=3,gC(n);case 3:return e.next=5,this.batchBegin(t,n);case 5:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onBatchEnd",value:function(){var e=ns(es().mark((function e(t,n){var r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],null==this.batchEnd){e.next=5;break}return e.next=4,gC(n);case 4:r.push(this.batchEnd(t,n));case 5:return"batch"===this.yieldEvery?r.push(ax()):Ml(this.yieldEvery)&&r.push(this.maybeWait(this.currentEpoch,t,n)),e.next=8,Promise.all(r);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"onTrainBegin",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainBegin){e.next=5;break}return e.next=3,gC(t);case 3:return e.next=5,this.trainBegin(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"onTrainEnd",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.trainEnd){e.next=5;break}return e.next=3,gC(t);case 3:return e.next=5,this.trainEnd(t);case 5:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(xC);function CC(e,t){return null==e&&(e={}),e instanceof xC?[e]:Array.isArray(e)&&e[0]instanceof xC?e:g_(e).map((function(e){return new SC(e,t)}))}var TC=function(){function e(){$n(this,e)}return Jn(e,null,[{key:"registerCallbackConstructor",value:function(t,n){fl(t>=0&&Number.isInteger(t),(function(){return"Verbosity level is expected to be an integer >= 0, "+"but got ".concat(t)})),e.checkForDuplicate(n),null==e.constructors[t]&&(e.constructors[t]=[]),e.constructors[t].push(n)}},{key:"checkForDuplicate",value:function(t){for(var n in e.constructors){e.constructors[+n].forEach((function(e){if(e===t)throw new l_("Duplicate callback constructor.")}))}}},{key:"clear",value:function(){e.constructors={}}},{key:"createCallbacks",value:function(t){var n=[];for(var r in e.constructors){var a=+r;t>=a&&n.push.apply(n,Tt(e.constructors[a]))}return n.map((function(e){return new e}))}}]),e}();function EC(e,t,n,r,a,i,o,s,u){var c=new _C,l=[new wC].concat(Tt(TC.createCallbacks(t)));null!=e&&l.push.apply(l,Tt(e)),l.push(c);var h=new kC(l);return h.setParams({epochs:n,initialEpoch:r,samples:a,steps:i,batchSize:o,verbose:t,doValidation:s,metrics:u}),{callbackList:h,history:c}}function IC(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return __(e,pm.getMap().classNameMap,t,"layer",n)}function AC(e,t){return bm((function(){"float32"!==e.dtype&&(e=e.asType("float32"));var n=Lg(kS(e),t,!0),r=Cg(n.shape,s_()),a=Iy(Vg(n,r));return gg(e,a)}))}function MC(e,t){return bm((function(){return Wg(kS(Og(t,e)),-1)}))}function NC(e,t){return bm((function(){return Wg(Cm(Og(t,e)),-1)}))}function RC(e,t){return bm((function(){var n=Og(e,t),r=ig(Cm(e),s_(),Number.MAX_VALUE),a=Cm(gg(n,r));return Ym(100,Wg(a,-1))}))}function DC(e,t){return bm((function(){var n=ig(t,s_(),Number.MAX_VALUE),r=Rg(Tm(1,n)),a=ig(e,s_(),Number.MAX_VALUE),i=Rg(Tm(1,a));return Wg(kS(Og(r,i)),-1)}))}function PC(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return bm((function(){if(n)t=Cy(t);else{var r=Lg(t,t.shape.length-1,!0);t=gg(t,r)}return t=ig(t,s_(),1-s_()),ny(Lg(Ym(e.toFloat(),Rg(t)),t.shape.length-1))}))}function OC(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return bm((function(){var r=Tg(hS(e)).toInt(),a=(t=ig(t,s_(),1-s_())).shape;return PC(ay(r,a[a.length-1]).reshape(a),t,n)}))}function LC(e,t){return bm((function(){var n;return n=ig(t,s_(),1-s_()),n=Rg(gg(n,Og(1,n))),Wg(function(e,t){if(!gl(e.shape,t.shape))throw new l_("logits and labels must have the same shape, but got shapes "+"".concat(JSON.stringify(e.shape)," and ").concat(JSON.stringify(t.shape)));return bm((function(){var n=t.relu(),r=t.abs().neg();return n.sub(t.mul(e)).add(r.exp().log1p())}))}(e,n),-1)}))}function FC(e,t){return bm((function(){var n=ig(e,s_(),1),r=ig(t,s_(),1);return Lg(Ym(e,Rg(gg(n,r))),-1)}))}function zC(e,t){return bm((function(){var n=AC(e,-1),r=AC(t,-1),a=Ym(n,r);return ny(Lg(a,-1))}))}TC.constructors={};var BC={meanSquaredError:MC,meanAbsoluteError:NC,meanAbsolutePercentageError:RC,meanSquaredLogarithmicError:DC,squaredHinge:function(e,t){return bm((function(){var n=Vg(0,Og(1,Ym(e,t)));return Wg(kS(n),-1)}))},hinge:function(e,t){return bm((function(){var n=Vg(0,Og(1,Ym(e,t)));return Wg(n,-1)}))},categoricalHinge:function(e,t){return bm((function(){var n=Lg(Ym(e,t),-1),r=Pg(Ym(Og(1,e),t),-1);return Vg(0,Tm(1,Og(r,n)))}))},logcosh:function(e,t){return bm((function(){var n=Math.log(2),r=Og(t,e),a=Og(Tm(r,Ty(Ym(-2,r))),n);return Wg(a,-1)}))},categoricalCrossentropy:PC,sparseCategoricalCrossentropy:OC,binaryCrossentropy:LC,kullbackLeiblerDivergence:FC,poisson:function(e,t){return bm((function(){var n=Rg(Tm(s_(),t));return Wg(Og(t,Ym(e,n)),-1)}))},cosineProximity:zC};function UC(e){if("string"===typeof e){if(e in BC)return BC[e];var t="Unknown loss ".concat(e);throw e.toLowerCase().includes("softmaxcrossentropy")&&(t="Unknown loss ".concat(e,". ")+'Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy'),new l_(t)}return e}function VC(e,t){return bm((function(){var n=Ym(.5,sy(t)),r=cS(Ig(t,n),e.dtype);return Wg(kg(e,r),-1)}))}function WC(e,t){return bm((function(){return cS(kg(Am(e,-1),Am(t,-1)),"float32")}))}function GC(e,t){return bm((function(){return zg(e.equal(1),t.equal(1)).sum().cast("float32")}))}function jC(e,t){return LC(e,t)}function qC(e,t){return e.rank===t.rank&&(e=e.squeeze([e.rank-1])),(t=t.argMax(-1)).dtype!==e.dtype&&(t=t.asType(e.dtype)),kg(e,t).asType("float32")}var HC=PC,XC=OC,KC={binaryAccuracy:VC,categoricalAccuracy:WC,precision:function(e,t){return bm((function(){var n=GC(e,t),r=function(e,t){return bm((function(){return zg(e.equal(0),t.equal(1)).sum().cast("float32")}))}(e,t),a=n.add(r);return Ly(Ig(a,0),n.div(a),0).cast("float32")}))},categoricalCrossentropy:HC,sparseCategoricalCrossentropy:XC,mse:MC,MSE:MC,mae:NC,MAE:NC,mape:RC,MAPE:RC,cosine:zC};function YC(e){if("string"===typeof e&&e in KC)return KC[e];if("string"!==typeof e&&null!=e)return e;throw new l_("Unknown metric ".concat(e))}function QC(e){if(p_(null!==e,"Unknown LossOrMetricFn ".concat(e)),"string"===typeof e)return e;for(var t,n=0,r=Object.keys(BC);n<r.length;n++){var a=r[n];if(BC[a]===e){t=a;break}}if(void 0!==t)return t;for(var i=0,o=Object.keys(KC);i<o.length;i++){var s=o[i];if(KC[s]===e){t=s;break}}return void 0!==t?t:e.name}var ZC=1048576;function JC(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==e||"object"!==typeof e||Object.getPrototypeOf(e)!==Object.prototype||!$C(e))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){var r=JSON.stringify(e);r.length>ZC&&console.warn('User-defined metadata of model "'.concat(t,'" is too large in ')+"size (length=".concat(r.length," when serialized). It is not ")+"recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= "+"".concat(ZC,"."))}}function $C(e){if(null===e)return!0;if("object"===typeof e){if(Object.getPrototypeOf(e)===Object.prototype){for(var t=0,n=Object.keys(e);t<n.length;t++){var r=n[t];if("string"!==typeof r)return!1;if(!$C(e[r]))return!1}return!0}if(Array.isArray(e)){var a,i=al(e);try{for(i.s();!(a=i.n()).done;){if(!$C(a.value))return!1}}catch($Pe){i.e($Pe)}finally{i.f()}return!0}return!1}var o=typeof e;return"string"===o||"number"===o||"boolean"===o}function eT(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:console.log,i=nT(e),o=["Layer (type)","Output shape","Param #"];if(i?(t=t||65,n=n||[.45,.85,1]):(t=t||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map((function(e){return Math.floor(t*e)}))),!i)for(var s in o.push("Receives inputs"),r=[],e.nodesByDepth){var u;(u=r).push.apply(u,Tt(e.nodesByDepth[s]))}a("_".repeat(t)),rT(o,n,a),a("=".repeat(t));for(var c=e.layers,l=0;l<c.length;++l)i?aT(c[l],n,a):iT(c[l],n,r,a),a((l===c.length-1?"=":"_").repeat(t));e.checkTrainableWeightsConsistency();var h=tT(e),f=rC(e.nonTrainableWeights);a("Total params: ".concat(h+f)),a("Trainable params: ".concat(h)),a("Non-trainable params: ".concat(f)),a("_".repeat(t))}function tT(e){return null!=e.collectedTrainableWeights?rC(e.collectedTrainableWeights):rC(e.trainableWeights)}function nT(e){var t=!0,n=[],r=[];for(var a in e.nodesByDepth)n.push(e.nodesByDepth[a]);for(var i=0,o=n;i<o.length;i++){var s=o[i];if(s.length>1||1===s.length&&s[0].inboundLayers.length>1){t=!1;break}r.push.apply(r,Tt(s))}if(t){var u,c=al(e.layers);try{for(c.s();!(u=c.n()).done;){var l,h=u.value,f=!1,d=al(h.inboundNodes);try{for(d.s();!(l=d.n()).done;){var p=l.value;if(-1!==r.indexOf(p)){if(f){t=!1;break}f=!0}}}catch($Pe){d.e($Pe)}finally{d.f()}if(!t)break}}catch($Pe){c.e($Pe)}finally{c.f()}}return t}function rT(e,t){for(var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log,r="",a=0;a<e.length;++a)a>0&&(r=r.slice(0,r.length-1)+" "),r=(r+=e[a]).slice(0,t[a]),r+=" ".repeat(t[a]-r.length);n(r)}function aT(e,t,n){var r;try{r=JSON.stringify(e.outputShape)}catch($Pe){r="multiple"}var a=e.name,i=e.getClassName();rT(["".concat(a," (").concat(i,")"),r,e.countParams().toString()],t,n)}function iT(e,t,n,r){var a;try{a=JSON.stringify(e.outputShape)}catch($Pe){a="multiple"}var i,o=[],s=al(e.inboundNodes);try{for(s.s();!(i=s.n()).done;){var u=i.value;if(!(null!=n&&n.length>0&&-1===n.indexOf(u)))for(var c=0;c<u.inboundLayers.length;++c){var l=u.inboundLayers[c].name,h=u.nodeIndices[c],f=u.tensorIndices[c];o.push("".concat(l,"[").concat(h,"][").concat(f,"]"))}}}catch($Pe){s.e($Pe)}finally{s.f()}var d=e.name,p=e.getClassName(),v=0===o.length?"":o[0];rT(["".concat(d," (").concat(p,")"),a,e.countParams().toString(),v],t,r);for(var m=1;m<o.length;++m)rT(["","","",o[m]],t,r)}function oT(e,t,n){return("inboundNodes"===e||"outputLayers"===e||"inputLayers"===e)&&0===t&&"string"===typeof n}function sT(e,t){if(null===e)return null;if("string"===typeof e)return b_(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];oT(t,a,i)?n.push(i):n.push(sT(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c];if("name"===c&&"string"===typeof l)o[c]=l;else{var h=b_(c);o[h]=sT(l,h)}}return o}function uT(e,t){if(null===e||void 0===e)return null;if("string"===typeof e)return y_(e);if("number"===typeof e||"boolean"===typeof e)return e;if(e instanceof Array){for(var n=[],r=e.length,a=0;a<r;++a){var i=e[a];oT(t,a,i)?n.push(i):n.push(uT(i,t))}return n}for(var o={},s=0,u=Object.keys(e);s<u.length;s++){var c=u[s],l=e[c],h=y_(c);o[h]="name"!==c&&"className"!==c||"string"!==typeof l?uT(l,c):l}return o}var cT="2.8.6";var lT=function(){function e(t){if($n(this,e),this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof e)for(var n in t.id2Value)this.id2Value[n]=t.id2Value[n],n in t.id2Mask&&(this.id2Mask[n]=t.id2Mask[n]);else{if(null==t)return;var r,a=al(t);try{for(a.s();!(r=a.n()).done;){var i=r.value;this.add(i.key,i.value)}}catch($Pe){a.e($Pe)}finally{a.f()}}}return Jn(e,[{key:"add",value:function(e,t,n){if(null!=this.id2Value[e.id])throw new l_("Duplicate key: name=".concat(e.name,", id=").concat(e.id));return this.id2Value[e.id]=function(e,t){if(null==e.dtype||e.dtype===t.dtype)return t;try{return Ov(t,e.dtype)}catch($Pe){throw new l_("The dtype of the feed (".concat(t.dtype,") can not be cast to the dtype ")+"of the key '".concat(e.name,"' (").concat(e.dtype,")."))}}(e,t),this.name2Id[e.name]=e.id,null!=n&&(this.id2Mask[e.id]=n),this}},{key:"addFeed",value:function(e){this.add(e.key,e.value)}},{key:"hasKey",value:function(e){return null!=this.id2Value[e.id]}},{key:"names",value:function(){return Object.keys(this.name2Id)}},{key:"getValue",value:function(e){if(e instanceof cC){if(null==this.id2Value[e.id])throw new l_("Nonexistent key: ".concat(e.name));return this.id2Value[e.id]}var t=this.name2Id[e];if(null==t)throw new l_("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Value[t]}},{key:"getMask",value:function(e){if(e instanceof cC){if(null==this.id2Value[e.id])throw new l_("Nonexistent key: ".concat(e.name));return this.id2Mask[e.id]}var t=this.name2Id[e];if(null==t)throw new l_("Feed dict has no SymbolicTensor name: ".concat(e));return this.id2Mask[t]}},{key:"disposeMasks",value:function(){null!=this.id2Mask&&xm(this.id2Mask)}}]),e}(),hT={},fT={};function dT(e,t,n,r){var a,i=null!=n&&n.training,o=Array.isArray(e),s=o?e:[e],u=s.map((function(e){return e.name})),c=[],l=t.names(),h=al(u);try{for(h.s();!(a=h.n()).done;){var f=a.value;-1!==l.indexOf(f)?c.push(t.getValue(f)):c.push(null)}}catch($Pe){h.e($Pe)}finally{h.f()}null!=r&&(r.maxNumTensors=-1/0,r.minNumTensors=1/0);var d,p,v=u.join(",")+"|"+t.names().join(",");if(null==hT[v]){var m=function(e,t){fl(null!=e&&e.length>0,(function(){return"Expected at least one fetch, got none"}));var n=[],r={};if(1===e.length){var a=vT(e[0],t);n=a.sorted,r=a.recipientMap}else{var i,o=new Set,s=al(e);try{for(s.s();!(i=s.n()).done;){var u,c=vT(i.value,t),l=c.sorted,h=c.recipientMap,f=al(l);try{for(f.s();!(u=f.n()).done;){var d=u.value;o.has(d.name)||(n.push(d),o.add(d.name))}}catch($Pe){f.e($Pe)}finally{f.f()}var p=function(e){null==r[e]&&(r[e]=new Set),h[e].forEach((function(t){return r[e].add(t)}))};for(var v in h)p(v)}}catch($Pe){s.e($Pe)}finally{s.f()}}return{sorted:n,recipientCounts:pT(r)}}(s,t);d=m.sorted,p=m.recipientCounts,hT[v]=d,fT[v]=p}d=hT[v],p={},i||Object.assign(p,fT[v]);for(var g=new lT(t),y=0;y<d.length;++y){if(null!=r){var b=ym().numTensors;b>r.maxNumTensors&&(r.maxNumTensors=b),b<r.minNumTensors&&(r.minNumTensors=b)}var x=d[y],k=x.sourceLayer;if(!(k instanceof mC)){var w,_=[],S=[],C=[],T=!1,E=al(x.inputs);try{for(E.s();!(w=E.n()).done;){var I=w.value,A=g.getValue(I),M=g.getMask(I);_.push(A),S.push(M),null!=M&&(T=!0),i||(p[I.name]--,0!==p[I.name]||t.hasKey(I)||-1!==u.indexOf(I.name)||A.isDisposed||!0===I.sourceLayer.stateful||C.push(A))}}catch($Pe){E.e($Pe)}finally{E.f()}T&&((n=n||{}).mask=S[0]);var N=g_(k.apply(_,n)),R=null;k.supportsMasking&&(R=k.computeMask(_,S));for(var D=mT(x),P=Array.isArray(D)?D:[D],O=0;O<P.length;++O){g.hasKey(P[O])||g.add(P[O],N[O],Array.isArray(R)?R[0]:R);var L=u.indexOf(P[O].name);-1!==L&&(c[L]=N[O])}i||xm(C)}}return g.disposeMasks(),o?c:c[0]}function pT(e){var t={};for(var n in e)t[n]=e[n].size;return t}function vT(e,t){var n,r=new Set,a=[],i={},o=al(t.names());try{for(o.s();!(n=o.n()).done;){var s=n.value;r.add(s)}}catch($Pe){o.e($Pe)}finally{o.f()}var u=[],c=[];for(u.push(e);u.length>0;){var l=u[u.length-1];if(r.has(l.name))u.pop();else{var h=c[c.length-1]===u.length-1;if(0===l.inputs.length||h)u.pop(),a.push(l),r.add(l.name),h&&c.pop();else{c.push(u.length-1);var f,d=al(l.inputs);try{for(d.s();!(f=d.n()).done;){var p=f.value;null==i[p.name]&&(i[p.name]=new Set),i[p.name].add(l.name),r.has(p.name)||u.push(p)}}catch($Pe){d.e($Pe)}finally{d.f()}}}}return{sorted:a,recipientMap:i}}function mT(e){var t;if(1===e.sourceLayer.inboundNodes.length)t=e.sourceLayer.output;else{for(var n=null,r=0;r<e.sourceLayer.inboundNodes.length;++r){var a,i=al(e.sourceLayer.inboundNodes[r].outputTensors);try{for(i.s();!(a=i.n()).done;){if(a.value.id===e.id){n=r;break}}}catch($Pe){i.e($Pe)}finally{i.f()}}t=e.sourceLayer.getOutputAt(n)}return t}var gT=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),(r=t.call(this,{})).containerNodes=new Set,r.name=e.name,null==r.name){var a=r.getClassName().toLowerCase();r.name=JS(a)}if(r.supportsMasking=!1,r.trainable_=!0,Array.isArray(e.inputs)?r.inputs=e.inputs.slice():r.inputs=[e.inputs],Array.isArray(e.outputs)?r.outputs=e.outputs.slice():r.outputs=[e.outputs],C_(r.inputs).length!==r.inputs.length)throw new l_("The list of inputs passed to the model is redundant. All inputs should only appear once. Found: "+"".concat(r.inputs.map((function(e){return e.name}))));C_(r.outputs).length!==r.outputs.length&&console.warn("The list of outputs passed to the model is redundant. All outputs should only appear once. Found: "+"".concat(r.outputs.map((function(e){return e.name})))),r.inputLayers=[],r.inputLayersNodeIndices=[],r.inputLayersTensorIndices=[],r.outputLayers=[],r.outputLayersNodeIndices=[],r.outputLayersTensorIndices=[],r.layers=[],r.internalContainerRefs=[];var i,o=al(r.outputs);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=s.sourceLayer,c=s.nodeIndex,l=s.tensorIndex;r.outputLayers.push(u),r.outputLayersNodeIndices.push(c),r.outputLayersTensorIndices.push(l)}}catch($Pe){o.e($Pe)}finally{o.f()}var h,f=al(r.inputs);try{for(f.s();!(h=f.n()).done;){var d=h.value,p=d.sourceLayer,v=d.nodeIndex,m=d.tensorIndex;p_(0===v,"input layer has >1 nodes"),p_(0===m,"input layer has >1 tensors"),r.inputLayers.push(p),r.inputLayersNodeIndices.push(v),r.inputLayersTensorIndices.push(m)}}catch($Pe){f.e($Pe)}finally{f.f()}r.inputNames=[],r.outputNames=[],r.feedInputShapes=[],r.feedInputNames=[],r.feedOutputNames=[];for(var g=0;g<r.inputLayers.length;g++){var y=r.inputLayers[g];if(!(y instanceof mC))throw new TypeError("Input layers to a LayersModel must be InputLayer objects. "+"Received inputs: ".concat(e.inputs,". ")+"Input ".concat(g," (0-based) originates ")+"from layer type ".concat(y.getClassName(),"."));r.inputNames.push(y.name),r.feedInputShapes.push(y.batchInputShape),r.feedInputNames.push(y.name)}var b,x=al(r.outputLayers);try{for(x.s();!(b=x.n()).done;){var k=b.value;r.outputNames.push(k.name)}}catch($Pe){x.e($Pe)}finally{x.f()}r.internalInputShapes=r.inputs.map((function(e){return e.shape})),r.internalOutputShapes=r.outputs.map((function(e){return e.shape}));var w,_={},S={},C={},T={},E={},I=[],A=function e(t,a,i,o,s,u){null!=o&&null!=s&&null!=u||(o=t.sourceLayer,s=t.nodeIndex,u=t.tensorIndex);var c=o.inboundNodes[s];if(-1!==i.indexOf(c))throw new c_("The tensor ".concat(t.name,' at layer "').concat(o.name,'" ')+"is part of a cycle.");if(-1===a.indexOf(c)){r.containerNodes.add(n.nodeKey(o,s)),o.id in E||(E[o.id]=Object.keys(E).length),-1===i.indexOf(c)&&i.push(c);for(var l=c.inboundLayers.length,h=0;h<l;h++){e(c.inputTensors[h],a,i,c.inboundLayers[h],c.nodeIndices[h],c.tensorIndices[h])}for(a.push(c);i.indexOf(c)>=0;)i.splice(i.indexOf(c),1);I.push(c)}},M=[],N=[],R=al(r.outputs);try{for(R.s();!(w=R.n()).done;){A(w.value,M,N)}}catch($Pe){R.e($Pe)}finally{R.f()}var D,P=al(I.slice().reverse());try{for(P.s();!(D=P.n()).done;){var O=D.value;S[O.id]=O,O.id in _||(_[O.id]=0);var L=_[O.id],F=null==C[O.outboundLayer.id]?0:C[O.outboundLayer.id];L=Math.max(L,F),C[O.outboundLayer.id]=L,T[O.outboundLayer.id]=O.outboundLayer,_[O.id]=L;for(var z=0;z<O.inboundLayers.length;z++){var B=O.inboundLayers[z],U=O.nodeIndices[z],V=B.inboundNodes[U],W=null==_[V.id]?0:_[V.id];_[V.id]=Math.max(L+1,W),S[V.id]=V}}}catch($Pe){P.e($Pe)}finally{P.f()}var G={};for(var j in _){var q=_[j];q in G||(G[q]=[]),G[q].push(S[j])}var H={};for(var X in C){var K=C[X];K in H||(H[K]=[]),H[K].push(T[X])}var Y=Object.keys(H).map((function(e){return parseInt(e,10)})).sort(S_);r.layers=[];var Q,Z=al(Y);try{for(Z.s();!(Q=Z.n()).done;){var J=H[Q.value];J.sort((function(e,t){var n=E[e.id],r=E[t.id];return n<r?-1:n>r?1:0}));var $,ee=al(J);try{for(ee.s();!($=ee.n()).done;){var te=$.value;te instanceof n&&r.internalContainerRefs.push(te),r.layers.push(te)}}catch($Pe){ee.e($Pe)}finally{ee.f()}}}catch($Pe){Z.e($Pe)}finally{Z.f()}r.layersByDepth=H,Y=Object.keys(G).map((function(e){return parseInt(e,10)})).sort(S_);var ne,re=r.inputs.slice(),ae=[],ie=al(Y);try{for(ie.s();!(ne=ie.n()).done;){var oe,se=al(G[ne.value]);try{for(se.s();!(oe=se.n()).done;){var ue=oe.value,ce=ue.outboundLayer;if(null!=ce){var le,he=al(ue.inputTensors);try{for(he.s();!(le=he.n()).done;){var fe=le.value;if(-1===re.indexOf(fe))throw new c_("Graph disconnected: cannot obtain value for tensor ".concat(fe)+' at layer "'.concat(ce.name,'". ')+"The following previous layers were accessed without "+"issue: ".concat(ae))}}catch($Pe){he.e($Pe)}finally{he.f()}var de,pe=al(ue.outputTensors);try{for(pe.s();!(de=pe.n()).done;){var ve=de.value;re.push(ve)}}catch($Pe){pe.e($Pe)}finally{pe.f()}ae.push(ce.name)}}}catch($Pe){se.e($Pe)}finally{se.f()}}}catch($Pe){ie.e($Pe)}finally{ie.f()}r.nodesByDepth=G;var me,ge=r.layers.map((function(e){return e.name})),ye=al(ge);try{var be=function(){var e=me.value,t=ge.filter((function(t){return t===e})).length;if(1!==t)throw new c_('The name "'.concat(e,'" is used ').concat(t," times ")+"in the model. All layer names should be unique. Layer names: "+JSON.stringify(ge))};for(ye.s();!(me=ye.n()).done;)be()}catch($Pe){ye.e($Pe)}finally{ye.f()}return r.outboundNodes=[],r.inboundNodes=[],new hC({outboundLayer:ir(r),inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:r.inputs,outputTensors:r.outputs,inputMasks:r.inputs.map((function(e){return null})),outputMasks:r.outputs.map((function(e){return null})),inputShapes:r.inputs.map((function(e){return e.shape})),outputShapes:r.outputs.map((function(e){return e.shape}))}),r.built=!0,r._refCount=1,r}return Jn(n,[{key:"assertNotDisposed",value:function(){if(0===this._refCount)throw new Error("Container '".concat(this.name,"' is already disposed."))}},{key:"dispose",value:function(){this.assertNotDisposed();var e={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){var t,n=al(this.layers);try{for(n.s();!(t=n.n()).done;){var r=t.value;e.numDisposedVariables+=r.dispose().numDisposedVariables}}catch($Pe){n.e($Pe)}finally{n.f()}var a,i=al(this.internalContainerRefs);try{for(i.s();!(a=i.n()).done;){var o=a.value;e.numDisposedVariables+=o.dispose().numDisposedVariables}}catch($Pe){i.e($Pe)}finally{i.f()}}return e.refCountAfterDispose=this._refCount,e}},{key:"trainable",get:function(){return this.trainable_},set:function(e){this.layers.forEach((function(t){t._trainableWeights.forEach((function(t){return t.trainable=e}))})),this.trainable_=e}},{key:"trainableWeights",get:function(){if(this._trainableWeights.length>0)throw new l_("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];var e,t=[],n=al(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t=t.concat(r.trainableWeights)}}catch($Pe){n.e($Pe)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=al(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Tt(r.nonTrainableWeights))}}catch($Pe){n.e($Pe)}finally{n.f()}if(!this.trainable){var a,i=[],o=al(this.layers);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,Tt(s.trainableWeights))}}catch($Pe){o.e($Pe)}finally{o.f()}return i.concat(t)}return t}},{key:"weights",get:function(){return this.trainableWeights.concat(this.nonTrainableWeights)}},{key:"loadWeights",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r={},a=0,i=al(this.layers);try{for(i.s();!(t=i.n()).done;){var o,s=t.value,u=al(s.weights);try{for(u.s();!(o=u.n()).done;){var c=o.value;if(null!=r[c.originalName])throw new l_("Duplicate weight name: ".concat(c.originalName));r[c.originalName]=c,a++}}catch($Pe){u.e($Pe)}finally{u.f()}}}catch($Pe){i.e($Pe)}finally{i.f()}var l=[];for(var h in e){var f=h;if(null==r[h]){var d=h.split("/"),p=d.slice(0,-2).concat([d[d.length-1]]);f=p.join("/")}if(null!=r[f])l.push([r[f],e[h]]);else if(n)throw new l_("Provided weight data has no target variable: ".concat(h));delete r[f]}if(n){var v=[];for(var m in r)v.push(m);if(v.length>0)throw new l_("".concat(v.length," of ").concat(a," weights are not set: ")+"".concat(v))}sC(l)}},{key:"updatedConfig",value:function(){var e=this.getConfig(),t={};return t.className=this.getClassName(),t.config=e,t.kerasVersion="tfjs-layers ".concat(cT),t.backend="TensorFlow.js",t}},{key:"toJSON",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=uT(this.updatedConfig());return t?JSON.stringify(n):n}},{key:"call",value:function(e,t){var n=this;return bm((function(){e=g_(e);for(var r=new lT,a=0;a<n.inputs.length;++a)r.add(n.inputs[a],e[a]);return dT(n.outputs,r,t)}))}},{key:"computeMask",value:function(e,t){var n=this;return bm((function(){var r;return e=g_(e),r=null==t?d_(null,e.length):g_(t),n.runInternalGraph(e,r)[1]}))}},{key:"computeOutputShape",value:function(e){var t=eC(e);if(t.length!==this.inputLayers.length)throw new l_("Invalid inputShape argument ".concat(e,": ")+"model has ".concat(this.inputLayers.length," tensor inputs."));for(var n={},r=0;r<t.length;r++){var a=this.inputLayers[r],i=t[r];n[a.name+"_0_0"]=i}var o=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(S_);if(o.length>1){var s,u=al(o);try{for(u.s();!(s=u.n()).done;){var c,l=s.value,h=al(this.nodesByDepth[l]);try{for(h.s();!(c=h.n()).done;){var f=c.value,d=f.outboundLayer;if(-1===this.inputLayers.map((function(e){return e.id})).indexOf(d.id)){for(var p=[],v=0;v<f.inboundLayers.length;v++){var m=f.inboundLayers[v],g=f.nodeIndices[v],y=f.tensorIndices[v],b=n["".concat(m.name,"_").concat(g,"_").concat(y)];p.push(b)}for(var x=eC(d.computeOutputShape(m_(p))),k=d.inboundNodes.indexOf(f),w=0;w<x.length;w++){n["".concat(d.name,"_").concat(k,"_").concat(w)]=x[w]}}}}catch($Pe){h.e($Pe)}finally{h.f()}}}catch($Pe){u.e($Pe)}finally{u.f()}}for(var _=[],S=[],C=0;C<this.outputLayers.length;C++){var T=this.outputLayers[C],E=this.outputLayersNodeIndices[C],I=this.outputLayersTensorIndices[C],A="".concat(T.name,"_").concat(E,"_").concat(I);S.push(A)}for(var M=0;M<S.length;M++){var N=S[M];p_(N in n),_.push(n[N])}return m_(_)}},{key:"runInternalGraph",value:function(e,t){null==t&&(t=d_(null,e.length));for(var n={},r=0;r<this.inputs.length;++r){var a=this.inputs[r],i=e[r],o=t[r];n[a.id]=[i,o]}var s,u=Object.keys(this.nodesByDepth).map((function(e){return parseInt(e,10)})).sort(S_),c=al(u);try{for(c.s();!(s=c.n()).done;){var l,h=s.value,d=al(this.nodesByDepth[h]);try{for(d.s();!(l=d.n()).done;){var p,v=l.value,m=v.outboundLayer,g=v.inputTensors,y=v.outputTensors,b=new Array,x=al(g);try{for(x.s();!(p=x.n()).done;){var k=p.value;k.id in n&&b.push(n[k.id])}}catch($Pe){x.e($Pe)}finally{x.f()}if(b.length===g.length){var w={},_=void 0,S=void 0,C=void 0,T=void 0;if(null!=v.callArgs&&(w=v.callArgs),1===b.length){var E=f(b[0],2),I=E[0],A=E[1];null==w.mask&&(w.mask=A),C=g_(m.call(I,w)),T=g_(m.computeMask(I,A)),_=[I],S=[A]}else _=b.map((function(e){return e[0]})),S=b.map((function(e){return e[1]})),null==w.mask&&(w.mask=S),C=g_(m.call(_,w)),T=g_(m.computeMask(_,S));if(m.activityRegularizer)throw new h_("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(var M=0;M<y.length;++M){var N=y[M],R=C[M],D=T[M];n[N.id]=[R,D]}}}}catch($Pe){d.e($Pe)}finally{d.f()}}}catch($Pe){c.e($Pe)}finally{c.f()}var P,O=[],L=[],F=[],z=al(this.outputs);try{for(z.s();!(P=z.n()).done;){var B=P.value;p_(B.id in n,"Could not compute output ".concat(B.name," : ").concat(B.id));var U=f(n[B.id],2),V=U[0],W=U[1];F.push(V.shape),O.push(V),L.push(W)}}catch($Pe){z.e($Pe)}finally{z.f()}return[O,L,F]}},{key:"buildNodeConversionMap",value:function(e){var t,r,a={},i=al(this.layers);try{for(i.s();!(r=i.n()).done;){var o=r.value;t=o instanceof n?1:0;for(var s=0;s<o.inboundNodes.length;s++){var u=n.nodeKey(o,s);this.containerNodes.has(u)&&(a[u]=t,t+=1)}}}catch($Pe){i.e($Pe)}finally{i.f()}return a}},{key:"getLayer",value:function(e,t){if(null!=t){if(this.layers.length<=t)throw new l_("Was asked to retrieve layer at index ".concat(t,", but model only ")+"has ".concat(this.layers.length," layer(s)."));return this.layers[t]}if(null==e)throw new l_("Provide either a layer name or layer index");var n,r=al(this.layers);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.name===e)return a}}catch($Pe){r.e($Pe)}finally{r.f()}throw new l_("No such layer: ".concat(e))}},{key:"calculateLosses",value:function(){var e=this;return bm((function(){var t,r=[],a=al(e.layers);try{for(a.s();!(t=a.n()).done;)for(var i=t.value,o=0;o<i.inboundNodes.length;++o){var s=n.nodeKey(i,o);e.containerNodes.has(s)&&r.push.apply(r,Tt(i.calculateLosses()))}}catch($Pe){a.e($Pe)}finally{a.f()}return r}))}},{key:"getConfig",value:function(){var e,t={name:this.name},r=this.buildNodeConversionMap(this.layers),a=[],i=al(this.layers);try{for(i.s();!(e=i.n()).done;){for(var o=e.value,s=o.getClassName(),u=o.getConfig(),c=[],l=0;l<o.inboundNodes.length;l++){var h=o.inboundNodes[l],f=n.nodeKey(o,l),d={};if(this.containerNodes.has(f)){if(h.callArgs)try{JSON.stringify(h.callArgs),d=h.callArgs}catch($Pe){console.warn("Layer ".concat(o.name," was passed ")+"non-serializable keyword arguments: "+"".concat(h.callArgs,". They will not be included ")+"in the serialized model (and thus will be missing at deserialization time)."),d={}}if(h.inboundLayers.length>0){for(var p=[],v=0;v<h.inboundLayers.length;v++){var m=h.inboundLayers[v],g=h.nodeIndices[v],y=h.tensorIndices[v],b=r[n.nodeKey(m,g)];null==b&&(b=0),p.push([m.name,b,y,d])}c.push(p)}}}var x={};x.name=o.name,x.className=s,x.config=u,x.inboundNodes=c,a.push(x)}}catch($Pe){i.e($Pe)}finally{i.f()}t.layers=a;for(var k=[],w=0;w<this.inputLayers.length;w++){var _=this.inputLayers[w],S=this.inputLayersNodeIndices[w],C=n.nodeKey(_,S);if(this.containerNodes.has(C)){var T=r[C];null!==T&&void 0!==T||(T=0);var E=this.inputLayersTensorIndices[w];k.push([_.name,T,E])}}t.inputLayers=k;for(var I=[],A=0;A<this.outputLayers.length;A++){var M=this.outputLayers[A],N=this.outputLayersNodeIndices[A],R=n.nodeKey(M,N);if(this.containerNodes.has(R)){var D=r[R];null!==D&&void 0!==D||(D=0);var P=this.outputLayersTensorIndices[A];I.push([M.name,D,P])}}return t.outputLayers=I,t}},{key:"stateful",get:function(){if(this._stateful)throw new l_("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");var e,t=al(this.layers);try{for(t.s();!(e=t.n()).done;){if(e.value.stateful)return!0}}catch($Pe){t.e($Pe)}finally{t.f()}return!1}},{key:"resetStates",value:function(){var e=this;bm((function(){e.layers.forEach((function(e){e.stateful&&e.resetStates()}))}))}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],r={},a={};function i(e,t){e.name in a?a[e.name].push(t):a[e.name]=[t]}function o(e,t){var n,a,o=[],s=al(t);try{for(s.s();!(a=s.n()).done;){var u=a.value,c=u[0],l=u[1],h=u[2];if(n=null==u[3]?{}:u[3],!(c in r))return void i(e,t);var f=r[c];if(f.inboundNodes.length<=l)return void i(e,t);var d=f.inboundNodes[l];o.push(d.outputTensors[h])}}catch($Pe){s.e($Pe)}finally{s.f()}o.length>0&&e.apply(m_(o),n)}function s(e){var a=e.name,o=IC(e,null!=t.customObjects?t.customObjects:{});o.setFastWeightInitDuringBuild(n),r[a]=o,e.inboundNodes.forEach((function(e){if(!(e instanceof Array))throw new l_("Corrupted configuration, expected array for nodeData: ".concat(e));i(o,e)}))}var u,c=t.name,l=t.layers,h=al(l);try{for(h.s();!(u=h.n()).done;){var f=u.value;s(f)}}catch($Pe){h.e($Pe)}finally{h.f()}for(;!T_(a);){var d,p=al(l);try{for(p.s();!(d=p.n()).done;){var v=d.value,m=r[v.name];if(m.name in a){var g=a[m.name];delete a[m.name];var y,b=al(g);try{for(b.s();!(y=b.n()).done;){var x=y.value;o(m,x)}}catch($Pe){b.e($Pe)}finally{b.f()}}}}catch($Pe){p.e($Pe)}finally{p.f()}}var k,w=[],_=[],S=t.inputLayers,C=al(S);try{for(C.s();!(k=C.n()).done;){var T=k.value,E=T[0],I=T[1],A=T[2];p_(E in r);var M=r[E],N=M.inboundNodes[I].outputTensors;w.push(N[A])}}catch($Pe){C.e($Pe)}finally{C.f()}var R,D=t.outputLayers,P=al(D);try{for(P.s();!(R=P.n()).done;){var O=R.value,L=O[0],F=O[1],z=O[2];p_(L in r);var B=r[L],U=B.inboundNodes[F].outputTensors;_.push(U[z])}}catch($Pe){P.e($Pe)}finally{P.f()}return new e({inputs:w,outputs:_,name:c})}}]),n}(dC);function yT(e,t,n){var r=t.length;if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return null}));if(1===r)return Array.isArray(e)&&1===e.length?e:"object"===typeof e&&t[0]in e?[e[t[0]]]:[e];if(Array.isArray(e)){if(e.length!==r)throw new Error("Provided ".concat(n," is an array of ").concat(e.length," ")+"element(s), but the model has ".concat(r," outputs. ")+"Make sure a set of weights is provided for each model output.");return e}if("object"===typeof e&&Object.keys(e).length>0&&"object"===typeof e[Object.keys(e)[0]]){var a=[];return t.forEach((function(t){t in e?a.push(e[t]):a.push(null)})),a}throw new Error("The model has multiple (".concat(r,") outputs, ")+"so ".concat(n," must be either an array with ")+"".concat(r," elements or an object with ").concat(t," keys. ")+"Provided ".concat(n," not understood: ").concat(JSON.stringify(e)))}function bT(e,t){return yT(e,t,"classWeight")}function xT(e,t,n,r){return kT.apply(this,arguments)}function kT(){return kT=ns(es().mark((function e(t,n,r,a){var i,o,s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&null==a){e.next=2;break}throw new Error("Support sampleWeight is not implemented yet");case 2:if(null==r){e.next=15;break}return i=bm((function(){if(1===t.shape.length)return t.clone();if(2===t.shape.length){if(t.shape[1]>1){return t.argMax(1)}if(1===t.shape[1])return t.reshape([t.shape[0]]);throw new Error("Encountered unexpected last-dimension size (".concat(t.shape[1],") ")+"during handling of class weights. The size is expected to be >= 1.")}throw new Error("Unexpected rank of target (y) tensor (".concat(t.rank,") during ")+"handling of class weights. The rank is expected to be 1 or 2.")})),e.t0=Array,e.next=7,i.data();case 7:return e.t1=e.sent,o=e.t0.from.call(e.t0,e.t1),xm(i),s=[],o.forEach((function(e){if(null==r[e])throw new Error("classWeight must contain all classes in the training data. "+"The class ".concat(e," exists in the data but not in ")+"classWeight");s.push(r[e])})),e.abrupt("return",Ny(s,"float32"));case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e)}))),kT.apply(this,arguments)}function wT(e,t){return Ym(e,t)}function _T(e,t){var n,r,a=t;n=a.xs,r=a.ys,fl(null!=n&&null!=r,(function(){return"A Dataset iterator for fitDataset() is expected to generate objects of the form `{xs: xVal, ys: yVal}`, where the two values may be `tf.Tensor`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates "+"".concat(t)}));var i=ST("input",e.inputNames,n),o=ST("output",e.outputNames,r),s=i[0].shape[0];fl(i.length===e.inputs.length,(function(){return"LayersModel has ".concat(e.inputs.length," inputs, but the dataset ")+"provides ".concat(i.length," inputs.  (Expected input keys: ")+"".concat(JSON.stringify(e.inputNames),")")})),fl(o.length===e.outputs.length,(function(){return"LayersModel has ".concat(e.outputs.length," outputs, but the dataset ")+"provides ".concat(o.length," outputs.  (Expected output keys: ")+"".concat(JSON.stringify(e.outputNames),")")}));for(var u=function(t){fl(i[t].shape[0]===s,(function(){return"Batch size mismatch: input "+"".concat(e.inputNames[t]," has ").concat(i[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},c=0;c<i.length;c++)u(c);for(var l=function(t){fl(o[t].shape[0]===s,(function(){return"Batch size mismatch: output "+"".concat(e.outputNames[t]," has ").concat(o[t].shape[0],"; ")+"expected  ".concat(s," based on input ").concat(e.inputNames[0],".")}))},h=0;h<o.length;h++)l(h);return{xs:i,ys:o}}function ST(e,t,n){if(n instanceof tp)return[n];if(Array.isArray(n))return fl(n.length===t.length,(function(){return"Received an array of ".concat(n.length," Tensors, but expected ").concat(t.length," to match the ").concat(e," keys ").concat(t,".")})),n;var r,a=[],i=al(t);try{for(i.s();!(r=i.n()).done;){var o=r.value;if(null==n[o])throw new l_("The feature data generated by the dataset lacks the required "+"".concat(e," key '").concat(o,"'."));a.push(n[o])}}catch($Pe){i.e($Pe)}finally{i.f()}return a}function CT(e){if(3===e.length)throw new h_("Validation with sample weights is not implemented yet.");return{xs:e[0],ys:e[1]}}function TT(e,t,n){return ET.apply(this,arguments)}function ET(){return ET=ns(es().mark((function e(t,n,r){var a,i,o,s,u,c,l,h,f,d,p,v,m,g,y,b,x,k,w,_,S,C,T,E,I,A,M,N,R,D,P,O,L;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=r.batchesPerEpoch,fl(null!=t.optimizer,(function(){return"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig)."})),fl(null!=r,(function(){return"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call."})),fl(null!=r.epochs&&r.epochs>0&&Number.isInteger(r.epochs),(function(){return"For fitDataset(), config.epochs is expected to be a positive "+"integer, but got ".concat(r.epochs)})),fl(!a||r.batchesPerEpoch>0&&Number.isInteger(r.batchesPerEpoch),(function(){return"For fitDataset(), config.batchesPerEpoch is expected to be a "+"positive integer if specified, but got ".concat(r.batchesPerEpoch)})),fl(null==r.validationSplit,(function(){return"`validationSplit` is not supported by `fitDataset()`. Use validationData instead."})),!t.isTraining){e.next=8;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 8:return t.isTraining=!0,e.prev=9,(i=null!=r.validationData)&&(AT(r.validationData)?fl(null==r.validationBatches||r.validationBatches>0&&Number.isInteger(r.validationBatches),(function(){return"For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, "+"but got ".concat(r.validationBatches)})):(u=CT(r.validationData),o=u.xs,s=u.ys)),c=t.makeTrainFunction(),l=t.getDedupedMetricsNames(),h=i?l.slice().concat(l.map((function(e){return"val_"+e}))):l.slice(),f=CC(r.callbacks,r.yieldEvery),d=null==r.verbose?1:r.verbose,p=EC(f,d,r.epochs,null,null,IT(n,r),null,i,h),v=p.callbackList,m=p.history,v.setModel(t),t.history=m,e.next=22,v.onTrainBegin();case 22:return t.stopTraining_=!1,g=null==r.initialEpoch?0:r.initialEpoch,e.next=26,n.iterator();case 26:y=e.sent;case 27:if(!(g<r.epochs)){e.next=98;break}return b={},e.next=31,v.onEpochBegin(g);case 31:if(x=0,k=0,a){e.next=37;break}return e.next=36,n.iterator();case 36:y=e.sent;case 37:if(a&&!(x<r.batchesPerEpoch)){e.next=91;break}return e.next=40,y.next();case 40:if(w=e.sent,!a||!w.done){e.next=44;break}return console.warn("You provided `batchesPerEpoch` as "+"".concat(r.batchesPerEpoch,", ")+"but your dataset iterator ran out of data after "+"".concat(x," batches; ")+"interrupting training. Make sure that your dataset can generate at least `batchesPerEpoch * epochs` batches (in this case, "+"".concat(r.batchesPerEpoch*r.epochs," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("break",91);case 44:if(null==w.value){e.next=73;break}return _=_T(t,w.value),S=_.xs,C=_.ys,(T={}).batch=k,T.size=S[0].shape[0],e.next=51,v.onBatchBegin(k,T);case 51:if(E=[],null==r.classWeight){e.next=64;break}I=bT(r.classWeight,t.outputNames),A=0;case 55:if(!(A<I.length)){e.next=64;break}return e.t0=E,e.next=59,xT(C[A],null,I[A]);case 59:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 61:++A,e.next=55;break;case 64:for(M=S.concat(C).concat(E),N=c(M),xm(M),R=0;R<l.length;++R)D=l[R],P=N[R],T[D]=P,km(P);return e.next=70,v.onBatchEnd(k,T);case 70:bC(T),k++,x++;case 73:if(!(a?x>=r.batchesPerEpoch:w.done)){e.next=87;break}if(!i){e.next=86;break}if(O=void 0,!AT(r.validationData)){e.next=84;break}return e.t2=g_,e.next=80,t.evaluateDataset(r.validationData,{batches:r.validationBatches});case 80:e.t3=e.sent,O=(0,e.t2)(e.t3),e.next=85;break;case 84:O=g_(t.evaluate(o,s,{batchSize:null==r.validationBatchSize?32:r.validationBatchSize,verbose:0}));case 85:for(L=0;L<t.metricsNames.length;++L)b["val_".concat(t.metricsNames[L])]=O[L];case 86:return e.abrupt("break",91);case 87:if(!t.stopTraining_){e.next=89;break}return e.abrupt("break",91);case 89:e.next=37;break;case 91:return e.next=93,v.onEpochEnd(g,b);case 93:if(g++,!t.stopTraining_){e.next=96;break}return e.abrupt("break",98);case 96:e.next=27;break;case 98:return e.next=100,v.onTrainEnd();case 100:return e.next=102,t.history.syncData();case 102:return e.abrupt("return",t.history);case 103:return e.prev=103,t.isTraining=!1,e.finish(103);case 106:case"end":return e.stop()}}),e,null,[[9,,103,106]])}))),ET.apply(this,arguments)}function IT(e,t){var n=null;return null!=t.batchesPerEpoch?n=t.batchesPerEpoch:Number.isFinite(e.size)&&(n=e.size),n}function AT(e){return"function"===typeof e.iterator}function MT(e){return"function"===typeof e.next}function NT(e,t,n){return RT.apply(this,arguments)}function RT(){return RT=ns(es().mark((function e(t,n,r){var a,i,o,s,u,c,l,h,f;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=null!=(r=r||{}).batches,i=t.testFunction,o=[],!(r.verbose>0)){e.next=6;break}throw new h_("Verbose mode is not implemented yet.");case 6:if(fl(!a||r.batches>0&&Number.isInteger(r.batches),(function(){return"Test loop expects `batches` to be a positive integer, but "+"received ".concat(JSON.stringify(r.batches))})),!MT(n)){e.next=11;break}e.t0=n,e.next=14;break;case 11:return e.next=13,n.iterator();case 13:e.t0=e.sent;case 14:s=e.t0,u=0,c=0,l=es().mark((function e(){var n;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,s.next();case 2:if(n=e.sent,o=bm((function(){return n.value&&function(){var e=_T(t,n.value),r=e.xs,a=e.ys,s=r.concat(a),l=bm((function(){return i(s)}));if(xm(s),0===c)for(var h=0;h<l.length;++h)o.push(_m(0));for(var f=s[0].shape[0],d=function(e){var t=l[e],n=o[e];o[e]=bm((function(){return Tm(o[e],Ym(f,t))})),c>0&&xm(n)},p=0;p<l.length;++p)d(p);xm(l),u+=f,++c}(),o})),!n.done){e.next=7;break}return a&&console.warn("Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least `batches` "+"batches (in this case, ".concat(r.batches," batches). ")+"You may need to use the repeat() function when building your dataset."),e.abrupt("return","break");case 7:case"end":return e.stop()}}),e)}));case 18:if(a&&!(c<r.batches)){e.next=25;break}return e.delegateYield(l(),"t1",20);case 20:if("break"!==e.t1){e.next=23;break}return e.abrupt("break",25);case 23:e.next=18;break;case 25:for(h=0;h<o.length;++h)f=o[h],o[h]=gg(o[h],u),xm(f);return e.abrupt("return",m_(o));case 27:case"end":return e.stop()}}),e)}))),RT.apply(this,arguments)}function DT(e){fl(e>0&&Number.isInteger(e),(function(){return"batchSize is required to be a positive integer, but got ".concat(e)}))}function PT(e,t,n){return null==e?[null]:Array.isArray(e)?e.map((function(e){return fS(e,t,n-t)})):fS(e,t,n-t)}function OT(e,t){return bm((function(){return null==e?null:Array.isArray(e)?e.map((function(e){return OT(e,t)})):xS(e,"int32"===t.dtype?t:t.toInt())}))}function LT(e,t){for(var n=[],r=0,a=null;r<e;)(a=r+t)>=e&&(a=e),n.push([r,a]),r=a;return n}function FT(e,t,n,r,a,i,o,s,u,c,l,h,f,d,p){return zT.apply(this,arguments)}function zT(){return zT=ns(es().mark((function e(t,n,r,a,i,o,s,u,c,l,h,f,d,p,v){var m,g,y,b,x,k,w,_;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==i&&(i=32),null==o&&(o=1),null==h&&(h=!0),null==d&&(d=0),m=!1,null!=c&&null!=l&&(m=!0),null==v){e.next=10;break}if(m=!0,null!=p){e.next=10;break}throw new l_("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");case 10:return null!=(g=t.checkNumSamples(r,i,p,"steps_per_epoch"))&&(y=uS(0,g)),null==s&&(s=1),b=EC(u,s,o,d,g,p,i,m,f),x=b.callbackList,k=b.history,x.setModel(t),t.history=k,e.next=18,x.onTrainBegin();case 18:t.stopTraining_=!1,w=es().mark((function e(o){var s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.onEpochBegin(o);case 2:if(s={},null==p){e.next=7;break}throw new h_("stepsPerEpoch mode is not implemented yet.");case 7:return e.delegateYield(es().mark((function e(){var o,u,f,d;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("batch"!==h){e.next=4;break}throw new h_("batch shuffling is not implemneted yet");case 4:h&&ul(y);case 5:o=Ny(y),u=LT(g,i),f=es().mark((function e(h){var f;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f={},e.next=3,x.onBatchBegin(h,f);case 3:return bm((function(){var e=u[h][0],d=u[h][1],p=fS(o,e,d-e);f.batch=h,f.size=d-e;for(var v=OT(r,p),g=n(v),y=0;y<a.length;++y){var b=a[y],x=g[y];f[b]=x,km(x)}if(h===u.length-1&&m)for(var k=t.testLoop(c,l,i),w=0;w<a.length;++w){var _=a[w],S=k[w];km(S),s["val_"+_]=S}})),e.next=6,x.onBatchEnd(h,f);case 6:if(bC(f),!t.stopTraining_){e.next=9;break}return e.abrupt("return","break");case 9:case"end":return e.stop()}}),e)})),d=0;case 9:if(!(d<u.length)){e.next=17;break}return e.delegateYield(f(d),"t0",11);case 11:if("break"!==e.t0){e.next=14;break}return e.abrupt("break",17);case 14:++d,e.next=9;break;case 17:o.dispose();case 18:case"end":return e.stop()}}),e)}))(),"t0",8);case 8:return e.next=10,x.onEpochEnd(o,s);case 10:if(!t.stopTraining_){e.next=12;break}return e.abrupt("return","break");case 12:case"end":return e.stop()}}),e)})),_=d;case 21:if(!(_<o)){e.next=29;break}return e.delegateYield(w(_),"t0",23);case 23:if("break"!==e.t0){e.next=26;break}return e.abrupt("break",29);case 26:++_,e.next=21;break;case 29:return e.next=31,x.onTrainEnd();case 31:return e.next=33,t.history.syncData();case 33:return e.abrupt("return",t.history);case 34:case"end":return e.stop()}}),e)}))),zT.apply(this,arguments)}function BT(e,t,n){return UT.apply(this,arguments)}function UT(){return UT=ns(es().mark((function e(t,n,r){var a,i,o,s,u,c,l,h,f,d,p,v,m,g,y,b,x,k,w,_,S,C,T,E,I=arguments;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=I.length>3&&void 0!==I[3]?I[3]:{},!t.isTraining){e.next=3;break}throw new Error("Cannot start training because another fit() call is ongoing.");case 3:return t.isTraining=!0,e.prev=4,DT(f=null==a.batchSize?32:a.batchSize),d=!1,e.next=10,t.standardizeUserData(n,r,a.sampleWeight,a.classWeight,d,f);case 10:if(p=e.sent,i=p[0],o=p[1],h=p[2],v=!1,!(null!=a.validationData&&a.validationData.length>0)){e.next=36;break}if(v=!0,2!==a.validationData.length){e.next=22;break}s=a.validationData[0],u=a.validationData[1],e.next=27;break;case 22:if(3!==a.validationData.length){e.next=26;break}throw new h_("validationData including sample weights is not supported yet.");case 26:throw new l_("When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; "+"".concat(a.validationData," is invalid."));case 27:return g=!0,e.next=30,t.standardizeUserData(s,u,null,null,g,f);case 30:y=e.sent,c=y[0],l=y[1],m=c.concat(l),e.next=37;break;case 36:null!=a.validationSplit&&a.validationSplit>0&&a.validationSplit<1?(v=!0,b=Math.floor(i[0].shape[0]*(1-a.validationSplit)),x=i[0].shape[0],c=PT(i,b,x),i=PT(i,0,b),l=PT(o,b,x),o=PT(o,0,b),m=c.concat(l)):null!=a.validationSteps&&(v=!0);case 37:return k=i.concat(o).concat(h),t.checkTrainableWeightsConsistency(),w=t.makeTrainFunction(),_=t.getDedupedMetricsNames(),v?(t.makeTestFunction(),S=t.testFunction,C=_.slice().concat(_.map((function(e){return"val_"+e})))):(S=null,m=[],C=_.slice()),T=CC(a.callbacks,a.yieldEvery),e.next=45,FT(t,w,k,_,f,a.epochs,a.verbose,T,S,m,a.shuffle,C,a.initialEpoch,null,null);case 45:return E=e.sent,e.abrupt("return",E);case 47:return e.prev=47,t.isTraining=!1,WT(i,n),WT(o,r),WT(c,s),WT(l,u),null!=h&&xm(h),e.finish(47);case 55:case"end":return e.stop()}}),e,null,[[4,,47,55]])}))),UT.apply(this,arguments)}function VT(e){var t=[];e instanceof tp&&(e=[e]);for(var n=0;n<e.length;++n){var r=e[n];if(1===r.rank)t.push(lS(r,1));else{if(0===r.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");t.push(r)}}return t}function WT(e,t){if(null!=e){var n=[];if(t instanceof tp)n.push(t.id);else if(Array.isArray(t))t.forEach((function(e){return n.push(e.id)}));else if(null!=t)for(var r in t){var a=t[r];n.push(a.id)}var i=[];if(e instanceof tp)-1===n.indexOf(e.id)&&i.push(e);else if(Array.isArray(e))e.forEach((function(e){-1===n.indexOf(e.id)&&i.push(e)}));else if(null!=e)for(var o in e){var s=e[o];-1===n.indexOf(s.id)&&i.push(s)}i.forEach((function(e){e.isDisposed||e.dispose()}))}}function GT(e){return Array.isArray(e)}function jT(e){return!function(e){return e instanceof tp}(e)&&!GT(e)}function qT(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(null==t||0===t.length){if(null!=e){var o=!1;if(GT(e)&&e.length>0)o=!0;else if(jT(e)){for(var s in e)if(e.hasOwnProperty(s)){o=!0;break}}else o=!0;if(o)throw new l_("Error when checking model ".concat(i," expected no data, ")+"but got ".concat(e))}return[]}if(null==e)return t.map((function(e){return null}));if(jT(e)){r=[];var u,c=al(t);try{for(c.s();!(u=c.n()).done;){var l=u.value;if(null==e[l])throw new l_('No data provided for "'.concat(l,'". Need data for each key in: ')+"".concat(t));r.push(e[l])}}catch($Pe){c.e($Pe)}finally{c.f()}}else if(GT(e)){if(e.length!==t.length)throw new l_("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"model expected. Expected to see ".concat(t.length," Tensor(s), but ")+"instead got the following list of Tensor(s): ".concat(e));r=e}else{if(t.length>1)throw new l_("The model ".concat(i," expects ").concat(t.length," Tensor(s), ")+"but only received one Tensor. Found: Tensor with shape ".concat(e.shape));r=[e]}if(r=VT(r),null!=n)for(var h=0;h<t.length;++h)if(null!=n[h]){var f=r[h];if(f.shape.length!==n[h].length)throw new l_("Error when checking ".concat(i,": expected ").concat(t[h]," ")+"to have ".concat(n[h].length," dimension(s). but got array with ")+"shape ".concat(f.shape));for(var d=0;d<n[h].length;++d)if(0!==d||a){var p=f.shape[d],v=n[h][d];if(null!=v&&v>=0&&p!==v)throw new l_("Error when checking ".concat(i,": expected ").concat(t[h]," ")+"to have shape [".concat(n[h],"], but got array with shape ")+"[".concat(f.shape,"]."))}}return r}function HT(e,t,n){var r=C_(e.map((function(e){return e.shape[0]})));r.sort();var a=C_(t.map((function(e){return e.shape[0]})));if(a.sort(),r.length>1)throw new l_("All input Tensors (x) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(e.map((function(e){return e.shape})))));if(a.length>1)throw new l_("All target Tensors (y) should have the same number of samples. Got array shapes: "+"".concat(JSON.stringify(t.map((function(e){return e.shape})))));if(r.length>0&&a.length>0&&!gl(r,a))throw new l_("Input Tensors should have the same number of samples as target "+"Tensors. Found ".concat(r[0]," input sample(s) and ").concat(a[0]," target ")+"sample(s).")}function XT(e,t,n){for(var r=[MC,LC,PC],a=0;a<e.length;++a){var i=e[a],o=t[a],s=n[a];if(null!=o){if(o===PC&&1===i.shape[i.shape.length-1])throw new l_("You are passing a target array of shape ".concat(i.shape," while using ")+"a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].");if(-1!==r.indexOf(o))for(var u=i.shape.slice(1),c=s.slice(1),l=0;l<u.length;++l){var h=u[l],f=c[l];if(null!=f&&h!==f)throw new l_("A target Tensor with shape ".concat(i.shape," was passed for an ")+"output of shape ".concat(s,", while using a loss function that ")+"expects targets to have the same shape as the output.")}}}}function KT(e,t,n){var r,a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"";if(Array.isArray(e)){if(e.length!==t.length)throw new l_("Error when checking model ".concat(i,": the Array of ")+"Tensors that you are passing to your model is not the size the "+"the model expected. Expected to see ".concat(t.length," Tensor(s),")+" but instead got ".concat(e.length," Tensors(s)."));r=e}else{if(t.length>1)throw new l_("The model expects ".concat(t.length," ").concat(i," Tensors, ")+"but only received one Tensor. Found: array with shape "+"".concat(JSON.stringify(e.shape),"."));r=[e]}if(null!=n)for(var o=0;o<t.length;++o)if(null!=n[o]){var s=r[o];if(s.shape.length!==n[o].length)throw new l_("Error when checking ".concat(i,": expected ").concat(t[o]," ")+"to have ".concat(n[o].length," dimension(s), but got array with ")+"shape ".concat(JSON.stringify(s.shape)));for(var u=0;u<n[o].length;++u)if(0!==u||a){var c=s.shape[u],l=n[o][u];if(null!=l&&l!==c)throw new l_("Error when checking ".concat(i,": expected ")+"".concat(t[o]," to have shape ").concat(JSON.stringify(n[o])," but ")+"got array with shape ".concat(JSON.stringify(s.shape),"."))}}}var YT=function(t){tr(r,t);var n=sr(r);function r(e){var t;return $n(this,r),(t=n.call(this,e)).isTraining=!1,t}return Jn(r,[{key:"summary",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;if(!this.built)throw new l_("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");eT(this,e,t,n)}},{key:"compile",value:function(e){var t=this;if(null==e.loss&&(e.loss=[]),this.loss=e.loss,"string"===typeof e.optimizer)this.optimizer_=function(e){var t={Adagrad:function(){return nx.adagrad(.01)},Adadelta:function(){return nx.adadelta(1,.95,s_())},Adam:function(){return nx.adam(.001,.9,.999,s_())},Adamax:function(){return nx.adamax(.002,.9,.999,s_(),0)},RMSProp:function(){return nx.rmsprop(.001,.9,0,s_())},SGD:function(){return nx.sgd(.01)}};if(t.adagrad=t.Adagrad,t.adadelta=t.Adadelta,t.adam=t.Adam,t.adamax=t.Adamax,t.rmsprop=t.RMSProp,t.sgd=t.SGD,e in t)return t[e]();throw new l_("Unknown Optimizer ".concat(e))}(e.optimizer),this.isOptimizerOwned=!0;else{if(!(e.optimizer instanceof Sm))throw new l_("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=e.optimizer,this.isOptimizerOwned=!1}var n=[];if(Array.isArray(e.loss)||"string"===typeof e.loss||"function"===typeof e.loss)if(Array.isArray(e.loss)){if(e.loss.length!==this.outputs.length)throw new l_("When passing an Array as loss, it should have one entry per "+"model output. The model has ".concat(this.outputs.length," output(s), ")+"but you passed loss=".concat(e.loss,"."));var r=e.loss;n=r.map((function(e){return UC(e)}))}else{var a=UC(e.loss);this.outputs.forEach((function(e){n.push(a)}))}else{for(var i in e.loss=e.loss,e.loss)if(-1===this.outputNames.indexOf(i))throw new l_('Unknown entry in loss dictionary: "'.concat(i,'". ')+"Only expected the following keys: ".concat(this.outputNames));var o,s=al(this.outputNames);try{for(s.s();!(o=s.n()).done;){var u=o.value;null==e.loss[u]&&console.warn('Output "'.concat(u,'" is missing from loss dictionary. We assume ')+"this was done on purpose, and we will not be expecting data "+"to be passed to ".concat(u," during training")),n.push(UC(e.loss[u]))}}catch($Pe){s.e($Pe)}finally{s.f()}}this.lossFunctions=n,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(var c=0;c<this.outputs.length;++c){var l=this.internalOutputShapes[c],h=this.outputNames[c];this.feedOutputNames.push(h),this.feedOutputShapes.push(l),this.feedLossFns.push(this.lossFunctions[c])}var f=[];this.metrics=e.metrics,this.metricsNames=["loss"],this.metricsTensors=[],J_("loss",(function(){for(var e=0;e<t.outputs.length;++e)if(-1===f.indexOf(e)){var n=t.lossFunctions[e];t.outputs.length>1&&(t.metricsTensors.push([n,e]),t.metricsNames.push(t.outputNames[e]+"_loss"))}}));var d=function(e,t){if(null==e||Array.isArray(e)&&0===e.length)return t.map((function(e){return[]}));var n;if("string"===typeof e||"function"===typeof e)n=[e];else{if(!Array.isArray(e)&&"object"!==typeof e)throw new TypeError("Type of metrics argument not understood. Expected an string,"+"function, Array, or Object, found: ".concat(e));n=e}if(Array.isArray(n))return t.map((function(e){return n}));var r,a=[],i=al(t);try{for(i.s();!(r=i.n()).done;){var o=r.value,s=n.hasOwnProperty(o)?n[o]:[];Array.isArray(s)||(s=[s]),a.push(s)}}catch($Pe){i.e($Pe)}finally{i.f()}return a}(e.metrics,this.outputNames),p=function(e,n,r){t.outputNames.length>1&&(n=t.outputNames[e]+"_"+n),t.metricsNames.push(n),t.metricsTensors.push([r,e])};J_("metric",(function(){for(var e=function(e){if(-1!==f.indexOf(e))return"continue";!function(n){var r,a,i,o,s=al(n);try{for(s.s();!(o=s.n()).done;){var u=o.value;if("string"===typeof u&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(u)){var c=t.internalOutputShapes[e];1===c[c.length-1]||t.lossFunctions[e]===LC?-1!==["accuracy","acc"].indexOf(u)?a=VC:-1!==["crossentropy","ce"].indexOf(u)&&(a=jC):t.lossFunctions[e]===OC?-1!==["accuracy","acc"].indexOf(u)?a=qC:-1!==["crossentropy","ce"].indexOf(u)&&(a=XC):-1!==["accuracy","acc"].indexOf(u)?a=WC:-1!==["crossentropy","ce"].indexOf(u)&&(a=HC);var l=void 0;-1!==["accuracy","acc"].indexOf(u)?l="acc":-1!==["crossentropy","ce"].indexOf(u)&&(l="ce"),i=a,r=""+l}else{var h=YC(u);i=h,r=""+QC(u)}var f=void 0;J_(r,(function(){f=i})),p(e,r,f)}}catch($Pe){s.e($Pe)}finally{s.f()}}(d[e])},n=0;n<t.outputs.length;++n)e(n)})),this.collectedTrainableWeights=this.trainableWeights}},{key:"checkTrainableWeightsConsistency",value:function(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=null==n.batchSize?32:n.batchSize;DT(r);var a=!0,i=this.standardizeUserDataXY(e,t,a,r);try{var o=i[0].concat(i[1]);this.makeTestFunction();var s=this.testFunction,u=this.testLoop(s,o,r,n.verbose,n.steps);return m_(u)}finally{WT(i[0],e),WT(i[1],t)}}},{key:"evaluateDataset",value:function(){var e=ns(es().mark((function e(t,n){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.makeTestFunction(),e.abrupt("return",NT(this,t,n));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"checkNumSamples",value:function(e,t,n){var r,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"steps";if(null!=n){if(r=null,null!=t)throw new l_("If ".concat(a," is set, batchSize must be null or undefined.")+"Got batchSize = ".concat(t))}else{if(null==e)throw new l_("Either the input data should have a defined shape, or "+"".concat(a," shoud be specified."));r=Array.isArray(e)?e[0].shape[0]:e.shape[0]}return r}},{key:"execute",value:function(e,t){if(Array.isArray(t)&&0===t.length)throw new l_("`outputs` is an empty Array, which is not allowed.");var n=Array.isArray(t),r=n?t:[t],a=this.retrieveSymbolicTensors(r),i=new lT;if(e instanceof tp&&(e=[e]),Array.isArray(e)){if(e.length!==this.inputs.length)throw new l_("The number of inputs provided (".concat(e.length,") ")+"does not match the number of inputs of this model "+"(".concat(this.inputs.length,")."));for(var o=0;o<this.inputs.length;++o)i.add(this.inputs[o],e[o])}else{var s,u=al(this.inputs);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=e[c.name];if(null==l)throw new l_("No value is provided for the model's input ".concat(c.name));i.add(c,l)}}catch($Pe){u.e($Pe)}finally{u.f()}}var h=dT(a,i);return n?h:h[0]}},{key:"retrieveSymbolicTensors",value:function(e){var t,n=d_(null,e.length),r=e.length,a=al(this.layers);try{for(a.s();!(t=a.n()).done;){for(var i=t.value,o=Array.isArray(i.output)?i.output:[i.output],s=o.map((function(e){return e.name})),u=0;u<e.length;++u){var c=s.indexOf(e[u]);if(-1!==c&&(n[u]=o[c],r--),0===r)break}if(0===r)break}}catch($Pe){a.e($Pe)}finally{a.f()}if(r>0){var l=[];throw n.forEach((function(t,n){null==t&&l.push(e[n])})),new l_("Cannot find SymbolicTensors for output name(s): "+"".concat(JSON.stringify(l)))}return n}},{key:"predictLoop",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return bm((function(){var a=t.checkNumSamples(e);if(r)throw new h_("Verbose predictLoop() is not implemented yet.");for(var i=LT(a,n),o=t.outputs.map((function(e){return[]})),s=function(n){var r=bm((function(){var r=i[n][0],a=i[n][1],o=PT(e,r,a),s=[];if(Array.isArray(o))for(var u=0;u<o.length;++u)s.push({key:t.inputs[u],value:o[u]});else s.push({key:t.inputs[0],value:o});var c=new lT(s);return dT(t.outputs,c)}));r.forEach((function(e,t){return o[t].push(e)}))},u=0;u<i.length;++u)s(u);return m_(o.map((function(e){return Xm(e,0)})))}))}},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=VT(e);KT(n,this.inputNames,this.feedInputShapes,!1);try{var r=null==t.batchSize?32:t.batchSize;return DT(r),this.predictLoop(n,r)}finally{WT(n,e)}}},{key:"predictOnBatch",value:function(e){KT(e,this.inputNames,this.feedInputShapes,!0);var t=(Array.isArray(e)?e[0]:e).shape[0];return this.predictLoop(e,t)}},{key:"standardizeUserDataXY",value:function(e,t){var n=arguments.length>3?arguments[3]:void 0;if(null==this.optimizer_)throw new c_("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");for(var r=[],a=0;a<this.feedOutputShapes.length;++a){var i=this.feedOutputShapes[a],o=this.feedLossFns[a];o===OC?r.push(i.slice(0,i.length-1).concat([1])):r.push(i)}if(HT(e=qT(e,this.feedInputNames,this.feedInputShapes,!1,"input"),t=qT(t,this.feedOutputNames,r,!1,"target")),XT(t,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=n&&n>0&&e[0].shape[0]%n!==0)throw new l_("In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size "+"".concat(n,". Found: ").concat(e[0].shape[0]," sample(s)."));return[e,t]}},{key:"standardizeUserData",value:function(){var e=ns(es().mark((function e(t,n,r,a){var i,o,s,u,c,l,h,d,p,v=arguments;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=!(v.length>4&&void 0!==v[4])||v[4],o=v.length>5?v[5]:void 0,s=this.standardizeUserDataXY(t,n,i,o),u=f(s,2),c=u[0],l=u[1],null==r){e.next=5;break}throw new Error("sample weight is not supported yet.");case 5:if(h=null,null==a){e.next=19;break}d=bT(a,this.outputNames),h=[],p=0;case 10:if(!(p<d.length)){e.next=19;break}return e.t0=h,e.next=14,xT(l[p],null,d[p]);case 14:e.t1=e.sent,e.t0.push.call(e.t0,e.t1);case 16:++p,e.next=10;break;case 19:return e.abrupt("return",[c,l,h]);case 20:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"testLoop",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=arguments.length>4?arguments[4]:void 0;return bm((function(){var o=r.checkNumSamples(t,n,i,"steps"),s=[];if(a>0)throw new h_("Verbose mode is not implemented yet.");if(null!=i)throw new h_("steps mode in testLoop() is not implemented yet");for(var u=LT(o,n),c=Ny(uS(0,o)),l=0;l<u.length;++l){var h=u[l][0],f=u[l][1],d=fS(c,h,f-h),p=OT(t,d),v=e(p);if(0===l)for(var m=0;m<v.length;++m)s.push(_m(0));for(var g=0;g<v.length;++g){var y=v[g];s[g]=Tm(s[g],Ym(f-h,y))}}for(var b=0;b<s.length;++b)s[b]=gg(s[b],o);return s}))}},{key:"getDedupedMetricsNames",value:function(){for(var e=this.metricsNames,t=[],n=0;n<e.length;++n){var r=e[n],a=r;if(v_(e,r)>1){var i=v_(e.slice(0,n),r);a+="_".concat(i)}t.push(a)}return t}},{key:"makeTrainFunction",value:function(){var e=this;return function(t){var n=[],r=t.slice(0,e.inputs.length),a=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),i=t.slice(e.inputs.length+e.outputs.length,e.inputs.length+2*e.outputs.length),o=[],s=e.collectedTrainableWeights.map((function(e){return e.read()})),u=e.optimizer_.minimize((function(){for(var t=[],s=0;s<e.inputs.length;++s)t.push({key:e.inputs[s],value:r[s]});for(var u,c=new lT(t),l=dT(e.outputs,c,{training:!0}),h=0;h<e.lossFunctions.length;++h){var f=(0,e.lossFunctions[h])(a[h],l[h]);null!=i[h]&&(f=wT(f,i[h]));var d=Wg(f);n.push(d),u=0===h?f:Tm(u,f)}for(var p=0;p<e.metricsTensors.length;++p){var v=void 0;if(e.outputs.length>1&&p<e.outputs.length)v=n[p];else{var m=e.metricsTensors[p][0],g=e.metricsTensors[p][1];v=Wg(m(a[g],l[g]))}km(v),o.push(v)}return u=Wg(u),e.calculateLosses().forEach((function(e){u=Tm(u,e)})),u}),!0,s);return[u].concat(o)}}},{key:"makeTestFunction",value:function(){var e=this;this.testFunction=function(t){return bm((function(){for(var n,r=[],a=t.slice(0,e.inputs.length),i=t.slice(e.inputs.length,e.inputs.length+e.outputs.length),o=[],s=0;s<e.inputs.length;++s)o.push({key:e.inputs[s],value:a[s]});for(var u=new lT(o),c=dT(e.outputs,u),l=0;l<e.lossFunctions.length;++l){var h=e.lossFunctions[l],f=Wg(h(i[l],c[l]));n=0===l?f:Tm(n,f),r.push(n)}for(var d=0;d<e.metricsTensors.length;++d){var p=e.metricsTensors[d][0],v=e.metricsTensors[d][1],m=Wg(p(i[v],c[v]));r.push(m)}return r}))}}},{key:"fit",value:function(){var e=ns(es().mark((function e(t,n){var r,a=arguments;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a.length>2&&void 0!==a[2]?a[2]:{},e.abrupt("return",BT(this,t,n,r));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=ns(es().mark((function e(t,n){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",TT(this,t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=ns(es().mark((function e(t,n){var r,a,i,o,s,u,c,l,h,f;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.standardizeUserData(t,n);case 2:r=e.sent,a=r[0],i=r[1],o=this.makeTrainFunction(),s=o(a.concat(i)),u=[],c=al(s),e.prev=9,c.s();case 11:if((l=c.n()).done){e.next=19;break}return h=l.value,e.next=15,h.data();case 15:f=e.sent,u.push(f[0]);case 17:e.next=11;break;case 19:e.next=24;break;case 21:e.prev=21,e.t0=e.catch(9),c.e(e.t0);case 24:return e.prev=24,c.f(),e.finish(24);case 27:return xm(s),e.abrupt("return",m_(u));case 29:case"end":return e.stop()}}),e,this,[[9,21,24,27]])})));return function(t,n){return e.apply(this,arguments)}}()},{key:"getNamedWeights",value:function(e){for(var t=[],n=null!=e&&e.trainableOnly,r=n?this.trainableWeights:this.weights,a=this.getWeights(n),i=0;i<r.length;++i)n&&!r[i].trainable||t.push({name:r[i].originalName,tensor:a[i]});return t}},{key:"stopTraining",get:function(){return this.stopTraining_},set:function(e){this.stopTraining_=e}},{key:"optimizer",get:function(){return this.optimizer_},set:function(e){this.optimizer_!==e&&(this.optimizer_=e,this.isOptimizerOwned=!1)}},{key:"dispose",value:function(){var e=ja(nr(r.prototype),"dispose",this).call(this);if(0===e.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){var t=ym().numTensors;this.optimizer_.dispose(),e.numDisposedVariables+=t-ym().numTensors}return e}},{key:"getLossIdentifiers",value:function(){var e;if("string"===typeof this.loss)e=y_(this.loss);else if(Array.isArray(this.loss)){var t,n=al(this.loss);try{for(n.s();!(t=n.n()).done;){if("string"!==typeof t.value)throw new Error("Serialization of non-string loss is not supported.")}}catch($Pe){n.e($Pe)}finally{n.f()}e=this.loss.map((function(e){return y_(e)}))}else{var r=Object.keys(this.loss);e={};for(var a=this.loss,i=0,o=r;i<o.length;i++){var s=o[i];if("string"!==typeof a[s])throw new Error("Serialization of non-string loss is not supported.");e[s]=y_(a[s])}}return e}},{key:"getMetricIdentifiers",value:function(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[y_(QC(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((function(e){return y_(QC(e))}));var e={};for(var t in this.metrics)e[t]=y_(QC(this.metrics[t]));return e}},{key:"getTrainingConfig",value:function(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}},{key:"loadTrainingConfig",value:function(e){if(null!=e.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=e.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=e.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");var t,n,r=IC(sT(e.optimizer_config));if("string"===typeof e.loss)t=b_(e.loss);else if(Array.isArray(e.loss))t=e.loss.map((function(e){return b_(e)}));else if(null!=e.loss)for(var a in t={},e.loss)t[a]=b_(e.loss[a]);if(Array.isArray(e.metrics))n=e.metrics.map((function(e){return b_(e)}));else if(null!=e.metrics)for(var i in n={},e.metrics)n[i]=b_(e.metrics[i]);this.compile({loss:t,metrics:n,optimizer:r})}},{key:"save",value:function(){var t=ns(es().mark((function t(n,r){var a,i,o,s,u,c,l,h,f;return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if("string"!==typeof n){t.next=9;break}if(0!==(a=Yp(n)).length){t.next=6;break}throw new l_("Cannot find any save handlers for URL '".concat(n,"'"));case 6:if(!(a.length>1)){t.next=8;break}throw new l_("Found more than one (".concat(a.length,") save handlers for ")+"URL '".concat(n,"'"));case 8:n=a[0];case 9:if(null!=n.save){t.next=11;break}throw new l_("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");case 11:return t.next=13,Pp(this.getNamedWeights(r));case 13:if(i=t.sent,!1,null,o=this.toJSON(null,false),s={modelTopology:o,format:"layers-model",generatedBy:"TensorFlow.js tfjs-layers v".concat(cT),convertedBy:null},!(null!=r&&r.includeOptimizer)||null==this.optimizer){t.next=34;break}return s.trainingConfig=this.getTrainingConfig(),c="optimizer",t.t0=e,t.next=25,this.optimizer.getWeights();case 25:return t.t1=t.sent,t.t2=c,t.next=29,t.t0.encodeWeights.call(t.t0,t.t1,t.t2);case 29:l=t.sent,h=l.data,f=l.specs,(u=i.specs).push.apply(u,Tt(f)),i.data=Wp([i.data,h]);case 34:return null!=this.userDefinedMetadata&&(!0,JC(this.userDefinedMetadata,this.name,true),s.userDefinedMetadata=this.userDefinedMetadata),s.weightData=i.data,s.weightSpecs=i.specs,t.abrupt("return",n.save(s));case 38:case"end":return t.stop()}}),t,this)})));return function(e,n){return t.apply(this,arguments)}}()},{key:"setUserDefinedMetadata",value:function(e){JC(e,this.name),this.userDefinedMetadata=e}},{key:"getUserDefinedMetadata",value:function(){return this.userDefinedMetadata}}]),r}(gT);YT.className="Model",vm(YT);var QT=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n)}(YT);QT.className="Functional",vm(QT);var ZT=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),e=e||{},(r=t.call(this,{inputs:[],outputs:[]})).trainable=!0,r.built=!1,r.name=null!=e.name?e.name:JS("sequential_"),null!=e.layers){var a,i=al(e.layers);try{for(i.s();!(a=i.n()).done;){var o=a.value;r.add(o)}}catch($Pe){i.e($Pe)}finally{i.f()}}return r}return Jn(n,[{key:"checkShape",value:function(e){if(e.inboundNodes[0].outputTensors[0].shape.some((function(e){return e<0})))throw new l_("Negative dimension size caused by adding layer "+"".concat(e.name," with input shape [")+"".concat(e.inboundNodes[0].inputTensors[0].shape,"]"))}},{key:"add",value:function(e){var t,r=e instanceof n||e instanceof YT;if(r){if(1!==(t=e).outputs.length)throw new l_("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==t.inputs.length)throw new l_("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===e.inboundNodes.length){if(null==e.batchInputShape)throw new l_("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");var a=function(e){if(null==e.batchShape&&null==e.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=e.batchShape&&null!=e.shape)throw new l_("Please provide either a `shape` or `batchShape` argument to Input, but not both.");var t=e.batchShape;null!=e.shape&&null==t&&(t=[null].concat(e.shape));var n=e.dtype;return null==n&&(n="float32"),new mC({batchInputShape:t,name:e.name,dtype:n,sparse:e.sparse}).inboundNodes[0].outputTensors[0]}({batchShape:e.batchInputShape,dtype:e.dtype,name:e.name+"_input"});e.apply(a)}if(r)this.outputs=t.outputs,this.inputs=t.inputs;else{if(1!==e.inboundNodes.length)throw new l_("A layer added to a Sequential model must not already be "+"connected somewhere else. LayersModel received layer ".concat(e.name," ")+"which has ".concat(e.inboundNodes.length," pre-existing inbound ")+"connections.");if(1!==e.inboundNodes[0].outputTensors.length)throw new l_("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[e.inboundNodes[0].outputTensors[0]],this.inputs=pC(this.outputs[0])}this.inboundNodes=[],new hC({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:d_(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((function(e){return e.shape})),outputShapes:this.outputs[0].shape})}else{var i=e.apply(this.outputs[0]);if(Array.isArray(i))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(e),this.outputs=[i],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(e),this.built=!1}},{key:"pop",value:function(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{var e=this.layers.length-1;this.layers[e].outboundNodes=[],this.outputs=[this.layers[e].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}},{key:"call",value:function(e,t){return null==this.model&&this.build(),this.model.call(e,t)}},{key:"build",value:function(e){if(nC(e),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new YT({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}},{key:"countParams",value:function(){return this.built||this.build(),ja(nr(n.prototype),"countParams",this).call(this)}},{key:"summary",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:console.log;this.built||this.build(),ja(nr(n.prototype),"summary",this).call(this,e,t,r)}},{key:"setWeights",value:function(e){null==this.model&&this.build(),this.model.setWeights(e)}},{key:"evaluate",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.built)throw new c_("The model needs to be compiled before being used.");return this.model.evaluate(e,t,n)}},{key:"evaluateDataset",value:function(){var e=ns(es().mark((function e(t,n){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new c_("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.evaluateDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"predict",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return null==this.model&&this.build(),this.model.predict(e,t)}},{key:"predictOnBatch",value:function(e){return null==this.model&&this.build(),this.model.predictOnBatch(e)}},{key:"compile",value:function(e){this.build(),this.model.compile(e),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}},{key:"optimizer",get:function(){return null==this.model?void 0:this.model.optimizer},set:function(e){this.model.optimizer=e}},{key:"fit",value:function(){var e=ns(es().mark((function e(t,n){var r,a=arguments;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=a.length>2&&void 0!==a[2]?a[2]:{},this.built){e.next=3;break}throw new c_("The model needs to be compiled before being used.");case 3:return e.abrupt("return",this.model.fit(t,n,r));case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"fitDataset",value:function(){var e=ns(es().mark((function e(t,n){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.built){e.next=2;break}throw new c_("The model needs to be compiled before being used.");case 2:return e.abrupt("return",this.model.fitDataset(t,n));case 3:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"trainOnBatch",value:function(){var e=ns(es().mark((function e(t,n){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.model.trainOnBatch(t,n));case 1:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"stopTraining",get:function(){if(null==this.model)throw new l_("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining},set:function(e){if(null==this.model)throw new l_("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=e}},{key:"getConfig",value:function(){var e,t=[],n=al(this.layers);try{for(n.s();!(e=n.n()).done;){var r=e.value,a={};a.className=r.getClassName(),a.config=r.getConfig(),t.push(a)}}catch($Pe){n.e($Pe)}finally{n.f()}return{name:this.name,layers:t}}}],[{key:"fromConfig",value:function(e,t){var r,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i={};if(t instanceof Array){if(null==t[0].className||"Merge"===t[0].className)throw new l_("Legacy serialization format not supported yet.");r=t}else fl(null!=t.layers,(function(){return"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field."})),r=t.layers,delete t.layers,i=t;var o=new e(i);if(!(o instanceof n))throw new h_("Sequential.fromConfig called on non-Sequential input: ".concat(o));var s,u=al(r);try{for(u.s();!(s=u.n()).done;){var c=s.value,l=void 0,h=IC(c,l,a);a&&h.setFastWeightInitDuringBuild(!0),o.add(h)}}catch($Pe){u.e($Pe)}finally{u.f()}return o}}]),n}(YT);ZT.className="Sequential",vm(ZT);var JT=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"getConfig",value:function(){return{}}}]),n}(dm),$T=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return SS(e,t)}}]),n}(JT);$T.className="elu",vm($T);var eE=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e){return by(e)}}]),n}(JT);eE.className="selu",vm(eE);var tE=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e){return my(e)}}]),n}(JT);tE.className="relu",vm(tE);var nE=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e){return bm((function(){return jg(6,my(e))}))}}]),n}(JT);nE.className="relu6",vm(nE);var rE=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e){return e}}]),n}(JT);rE.className="linear",vm(rE);var aE=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e){return Qm(e)}}]),n}(JT);aE.className="sigmoid",vm(aE);var iE=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e){return function(e){return bm((function(){var t=Tm(.5,Ym(.2,e));return ig(t,0,1)}))}(e)}}]),n}(JT);iE.className="hardSigmoid",vm(iE);var oE=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e){return Ty(e)}}]),n}(JT);oE.className="softplus",vm(oE);var sE=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e){return function(e){return bm((function(){return gg(e,Cm(e).add(1))}))}(e)}}]),n}(JT);sE.className="softsign",vm(sE);var uE=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e){return Jm(e)}}]),n}(JT);uE.className="tanh",vm(uE);var cE=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return Cy(e,t)}}]),n}(JT);cE.className="softmax",vm(cE);var lE=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;return Fg(e,t)}}]),n}(JT);lE.className="logSoftmax",vm(lE);var hE=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return bm((function(){return Qm(e.mul(t)).mul(e)}))}}]),n}(JT);function fE(e){return e.getClassName()}function dE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return __(e,pm.getMap().classNameMap,t,"activation")}function pE(e){if(null==e){var t={className:"linear",config:{}};return dE(t)}if("string"===typeof e){var n={};return n.className=e,n.config={},dE(n)}return e instanceof JT?e:dE(e)}function vE(e){if(null!=e&&"object"!==typeof e)throw new Error("Argument to L1L2 regularizer's constructor is expected to be an "+"object, but received: ".concat(e))}hE.className="swish",vm(hE);var mE=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n)}(dm),gE=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this),vE(e),r.l1=null==e||null==e.l1?.01:e.l1,r.l2=null==e||null==e.l2?.01:e.l2,r.hasL1=0!==r.l1,r.hasL2=0!==r.l2,r}return Jn(n,[{key:"apply",value:function(e){var t=this;return bm((function(){var n=iy([1]);return t.hasL1&&(n=Tm(n,Lg(Ym(t.l1,Cm(e))))),t.hasL2&&(n=Tm(n,Lg(Ym(t.l2,kS(e))))),n.asScalar()}))}},{key:"getConfig",value:function(){return{l1:this.l1,l2:this.l2}}}],[{key:"fromConfig",value:function(e,t){return new e({l1:t.l1,l2:t.l2})}}]),n}(mE);gE.className="L1L2",vm(gE);var yE={l1l2:"L1L2"};function bE(e){return k_(e)}function xE(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return __(e,pm.getMap().classNameMap,t,"regularizer")}function kE(e){return null==e?null:"string"===typeof e?xE({className:e in yE?yE[e]:e,config:{}}):e instanceof mE?e:xE(e)}var wE=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,null!=e&&(r.maxValue=e.maxValue),r}return Jn(n,[{key:"call",value:function(e,t){e=tC(e);var n=my(e);return null!=this.maxValue&&(n=ig(n,0,this.maxValue)),n}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={maxValue:this.maxValue},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);wE.className="ReLU",vm(wE);var _E=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=.3,null==e&&(e={}),r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return Jn(n,[{key:"call",value:function(e,t){var n=tC(e);return Mg(n,this.alpha)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);_E.className="LeakyReLU",vm(_E);var SE=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA_INITIALIZER="zeros",null==e&&(e={}),r.supportsMasking=!0,r.alphaInitializer=KS(e.alphaInitializer||r.DEFAULT_ALPHA_INITIALIZER),r.alphaRegularizer=kE(e.alphaRegularizer),r.alphaConstraint=V_(e.alphaConstraint),null==e.sharedAxes)r.sharedAxes=null;else if(Array.isArray(e.sharedAxes))r.sharedAxes=e.sharedAxes;else{if("number"!==typeof e.sharedAxes)throw new l_("Expected sharedAxes to be a number or an array of numbers, "+"but got ".concat(e.sharedAxes));r.sharedAxes=[e.sharedAxes]}return r}return Jn(n,[{key:"build",value:function(e){var t=(e=nC(e)).slice(1);if(null!=this.sharedAxes){var n,r=al(this.sharedAxes);try{for(r.s();!(n=r.n()).done;){t[n.value-1]=1}}catch($Pe){r.e($Pe)}finally{r.f()}}this.alpha=this.addWeight("alpha",t,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);var a={};if(null!=this.sharedAxes)for(var i=1;i<e.length;++i)a[i]=e[i];this.inputSpec=[new uC({ndim:e.length,axes:a})],this.built=!0}},{key:"call",value:function(e,t){return e=tC(e),ly(e,this.alpha.read())}},{key:"getConfig",value:function(){var e={alphaInitializer:XS(this.alphaInitializer),alphaRegularizer:bE(this.alphaRegularizer),alphaConstraint:B_(this.alphaConstraint),sharedAxes:this.sharedAxes},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);SE.className="PReLU",vm(SE);var CE=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_ALPHA=1,null==e&&(e={}),null!=e.alpha&&e.alpha!==r.DEFAULT_ALPHA)throw new h_("Non-default alpha value (".concat(e.alpha,") is not supported by the ")+"ELU layer yet.");return r.alpha=null==e.alpha?r.DEFAULT_ALPHA:e.alpha,r}return Jn(n,[{key:"call",value:function(e,t){var n=tC(e);return yg(n)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={alpha:this.alpha},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);CE.className="ELU",vm(CE);var TE=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_THETA=1,null==e&&(e={}),r.theta=null==e.theta?r.DEFAULT_THETA:e.theta,r}return Jn(n,[{key:"call",value:function(e,t){var n=tC(e);return n.mul(cS(n.greater(this.theta),"float32"))}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={theta:this.theta},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);TE.className="ThresholdedReLU",vm(TE);var EE=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,null==e?{}:e)).DEFAULT_AXIS=1,null==e&&(e={}),r.softmax=(new cE).apply,r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r}return Jn(n,[{key:"call",value:function(e,t){var n=tC(e);return this.softmax(n,this.axis)}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e={axis:this.axis},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);function IE(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function AE(e,t,n){if("number"===typeof e)return d_(e,t);if(e.length!==t)throw new l_("The ".concat(n," argument must be an integer or tuple of ").concat(t," integers.")+" Received: ".concat(e.length," elements."));for(var r=0;r<t;++r){var a=e[r];if(!rS(a))throw new l_("The ".concat(n," argument must be an integer or tuple of ").concat(t)+" integers. Received: ".concat(JSON.stringify(e)," including a")+" non-integer number ".concat(a))}return e}function ME(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;if(null==e)return e;var i,o=t+(t-1)*(a-1);return i="same"===n?e:e-o+1,Math.floor((i+r-1)/r)}function NE(e,t,n,r){if(null==e)return null;if("valid"===r)e=e*t+sS([n-t,0]);else{if("same"!==r)throw new l_("Unsupport padding mode: ".concat(r,"."));e*=t}return e}function RE(e,t){return bm((function(){return K_(t),"channelsFirst"===t?Qy(e,[0,2,3,1]):e}))}function DE(e,t){return bm((function(){return K_(t),"channelsFirst"===t?Qy(e,[0,2,3,4,1]):e}))}function PE(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return bm((function(){if(null==i&&(i="channelsLast"),K_(i),3!==e.shape.length)throw new l_("The input of a conv1dWithBias operation should be 3, but is "+"".concat(e.shape.length," instead."));if(3!==t.shape.length)throw new l_("The kernel for a conv1dWithBias operation should be 3, but is "+"".concat(t.shape.length," instead"));if(null!=n&&1!==n.shape.length)throw new l_("The bias for a conv1dWithBias operation should be 1, but is "+"".concat(t.shape.length," instead"));if("channelsFirst"===i&&(e=Qy(e,[0,2,1])),"causal"===a)throw new h_("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");var s=hg(e,t,r,"same"===a?"same":"valid","NWC",o);return null!=n&&(s=_S(s,n)),s}))}function OE(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;return bm((function(){if(null==i&&(i="channelsLast"),K_(i),3!==e.rank&&4!==e.rank)throw new l_("conv2dWithBiasActivation expects input to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));if(3!==t.rank&&4!==t.rank)throw new l_("conv2dWithBiasActivation expects kernel to be of rank 3 or 4, "+"but received ".concat(e.rank,"."));var u=RE(e,i);if("causal"===a)throw new h_("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=hb({x:u,filter:t,strides:r,pad:"same"===a?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:s}),"channelsFirst"===i&&(u=Qy(u,[0,3,1,2])),u}))}function LE(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"valid",i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0;return bm((function(){if(null==i&&(i="channelsLast"),K_(i),4!==e.rank&&5!==e.rank)throw new l_("conv3dWithBias expects input to be of rank 4 or 5, but received "+"".concat(e.rank,"."));if(4!==t.rank&&5!==t.rank)throw new l_("conv3dWithBias expects kernel to be of rank 4 or 5, but received "+"".concat(e.rank,"."));var s=DE(e,i);if("causal"===a)throw new h_("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return s=pg(s,t,r,"same"===a?"same":"valid","NDHWC",o),null!=n&&(s=_S(s,n)),"channelsFirst"===i&&(s=Qy(s,[0,4,1,2,3])),s}))}EE.className="Softmax",vm(EE);var FE=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;if($n(this,n),(a=t.call(this,r)).bias=null,a.DEFAULT_KERNEL_INITIALIZER="glorotNormal",a.DEFAULT_BIAS_INITIALIZER="zeros",n.verifyArgs(r),a.rank=e,A_(a.rank,"rank"),1!==a.rank&&2!==a.rank&&3!==a.rank)throw new h_("Convolution layer for rank other than 1, 2, or 3 (".concat(a.rank,") is ")+"not implemented yet.");if(a.kernelSize=AE(r.kernelSize,e,"kernelSize"),a.strides=AE(null==r.strides?1:r.strides,e,"strides"),a.padding=null==r.padding?"valid":r.padding,Y_(a.padding),a.dataFormat=null==r.dataFormat?"channelsLast":r.dataFormat,K_(a.dataFormat),a.activation=pE(r.activation),a.useBias=null==r.useBias||r.useBias,a.biasInitializer=KS(r.biasInitializer||a.DEFAULT_BIAS_INITIALIZER),a.biasConstraint=V_(r.biasConstraint),a.biasRegularizer=kE(r.biasRegularizer),a.activityRegularizer=kE(r.activityRegularizer),a.dilationRate=AE(null==r.dilationRate?1:r.dilationRate,e,"dilationRate"),1===a.rank&&Array.isArray(a.dilationRate)&&1!==a.dilationRate.length)throw new l_("dilationRate must be a number or an array of a single number for 1D convolution, but received "+"".concat(JSON.stringify(a.dilationRate)));if(2===a.rank){if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate];else if(2!==a.dilationRate.length)throw new l_("dilationRate must be a number or array of two numbers for 2D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)))}else if(3===a.rank)if("number"===typeof a.dilationRate)a.dilationRate=[a.dilationRate,a.dilationRate,a.dilationRate];else if(3!==a.dilationRate.length)throw new l_("dilationRate must be a number or array of three numbers for 3D "+"convolution, but received ".concat(JSON.stringify(a.dilationRate)));return a}return Jn(n,[{key:"getConfig",value:function(){var e={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:fE(this.activation),useBias:this.useBias,biasInitializer:XS(this.biasInitializer),biasRegularizer:bE(this.biasRegularizer),activityRegularizer:bE(this.activityRegularizer),biasConstraint:B_(this.biasConstraint)},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(p_("kernelSize"in e,"required key 'kernelSize' not in config"),"number"!==typeof e.kernelSize&&!I_(e.kernelSize,"number",1,3))throw new l_("BaseConv expects config.kernelSize to be number or number[] with "+"length 1, 2, or 3, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(dC),zE=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this,e,r)).kernel=null,n.verifyArgs(r),a.filters=r.filters,A_(a.filters,"filters"),a.kernelInitializer=KS(r.kernelInitializer||a.DEFAULT_KERNEL_INITIALIZER),a.kernelConstraint=V_(r.kernelConstraint),a.kernelRegularizer=kE(r.kernelRegularizer),a}return Jn(n,[{key:"build",value:function(e){e=nC(e);var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new l_("The channel dimension of the input should be defined. "+"Found ".concat(e[t]));var n=e[t],r=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:IE({},t,n)}],this.built=!0}},{key:"call",value:function(e,t){var n=this;return bm((function(){var t;e=tC(e);var r=null==n.bias?null:n.bias.read(),a=N_(n.activation.getClassName());if(null!=a&&2===n.rank)t=OE(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate,a);else{if(1===n.rank)t=PE(e,n.kernel.read(),r,n.strides[0],n.padding,n.dataFormat,n.dilationRate[0]);else if(2===n.rank)t=OE(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate);else{if(3!==n.rank)throw new h_("convolutions greater than 3D are not implemented yet.");t=LE(e,n.kernel.read(),r,n.strides,n.padding,n.dataFormat,n.dilationRate)}null!=n.activation&&(t=n.activation.apply(t))}return t}))}},{key:"computeOutputShape",value:function(e){e=nC(e);for(var t=[],n="channelsLast"===this.dataFormat?e.slice(1,e.length-1):e.slice(2),r=0;r<n.length;++r){var a=ME(n[r],this.kernelSize[r],this.padding,this.strides[r],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[r]);t.push(a)}var i=[e[0]];return"channelsLast"===this.dataFormat?(i=i.concat(t)).push(this.filters):(i.push(this.filters),i=i.concat(t)),i}},{key:"getConfig",value:function(){var e={filters:this.filters,kernelInitializer:XS(this.kernelInitializer),kernelRegularizer:bE(this.kernelRegularizer),kernelConstraint:B_(this.kernelConstraint)},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"verifyArgs",value:function(e){if(!("filters"in e)||"number"!==typeof e.filters||e.filters<1)throw new l_("Convolution layer expected config.filters to be a 'number' > 0 "+"but got ".concat(JSON.stringify(e.filters)))}}]),n}(FE),BE=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,2,e),n.verifyArgs(e),r}return Jn(n,[{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!I_(e.kernelSize,"number",1,2))throw new l_("Conv2D expects config.kernelSize to be number or number[] with "+"length 1 or 2, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(zE);BE.className="Conv2D",vm(BE);var UE=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,3,e),n.verifyArgs(e),r}return Jn(n,[{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this);return delete e.rank,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&(!Array.isArray(e.kernelSize)||1!==e.kernelSize.length&&3!==e.kernelSize.length))throw new l_("Conv3D expects config.kernelSize to be number or"+" [number, number, number], but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(zE);UE.className="Conv3D",vm(UE);var VE=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),(r=t.call(this,e)).inputSpec=[new uC({ndim:4})],"same"!==r.padding&&"valid"!==r.padding)throw new l_("Conv2DTranspose currently supports only padding modes 'same' "+"and 'valid', but received padding mode ".concat(r.padding));return r}return Jn(n,[{key:"build",value:function(e){if(4!==(e=nC(e)).length)throw new l_("Input should have rank 4; Received input shape: "+JSON.stringify(e));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t])throw new l_("The channel dimension of the inputs should be defined. Found `None`.");var n=e[t],r=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",r,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new uC({ndim:4,axes:IE({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return bm((function(){var t=tC(e);if(4!==t.shape.length)throw new l_("Conv2DTranspose.call() expects input tensor to be rank-4, but "+"received a tensor of rank-".concat(t.shape.length));var r,a,i=t.shape,o=i[0];"channelsFirst"===n.dataFormat?(r=2,a=3):(r=1,a=2);var s=i[r],u=i[a],c=n.kernelSize[0],l=n.kernelSize[1],h=n.strides[0],f=n.strides[1],d=[o,NE(s,h,c,n.padding),NE(u,f,l,n.padding),n.filters];"channelsLast"!==n.dataFormat&&(t=Qy(t,[0,2,3,1]));var p=dg(t,n.kernel.read(),d,n.strides,n.padding);return"channelsLast"!==n.dataFormat&&(p=Qy(p,[0,3,1,2])),null!=n.bias&&(p=_S(p,n.bias.read(),n.dataFormat)),null!=n.activation&&(p=n.activation.apply(p)),p}))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=(e=nC(e)).slice();"channelsFirst"===this.dataFormat?(t=1,n=2,r=3):(t=3,n=1,r=2);var i=this.kernelSize[0],o=this.kernelSize[1],s=this.strides[0],u=this.strides[1];return a[t]=this.filters,a[n]=NE(a[n],s,i,this.padding),a[r]=NE(a[r],u,o,this.padding),a}},{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this);return delete e.dilationRate,e}}]),n}(BE);VE.className="Conv2DTranspose",vm(VE);var WE=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;if($n(this,n),(a=t.call(this,e,r)).DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",a.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",a.depthwiseKernel=null,a.pointwiseKernel=null,null==r.filters)throw new l_("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=r.kernelInitializer||null!=r.kernelRegularizer||null!=r.kernelConstraint)throw new l_("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=r.padding&&"same"!==r.padding&&"valid"!==r.padding)throw new l_("SeparableConv".concat(a.rank,"D supports only padding modes: ")+"'same' and 'valid', but received ".concat(JSON.stringify(r.padding)));return a.depthMultiplier=null==r.depthMultiplier?1:r.depthMultiplier,a.depthwiseInitializer=KS(r.depthwiseInitializer||a.DEFAULT_DEPTHWISE_INITIALIZER),a.depthwiseRegularizer=kE(r.depthwiseRegularizer),a.depthwiseConstraint=V_(r.depthwiseConstraint),a.pointwiseInitializer=KS(r.depthwiseInitializer||a.DEFAULT_POINTWISE_INITIALIZER),a.pointwiseRegularizer=kE(r.pointwiseRegularizer),a.pointwiseConstraint=V_(r.pointwiseConstraint),a}return Jn(n,[{key:"build",value:function(e){if((e=nC(e)).length<this.rank+2)throw new l_("Inputs to SeparableConv".concat(this.rank,"D should have rank ")+"".concat(this.rank+2,", but received input shape: ")+"".concat(JSON.stringify(e)));var t="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[t]||e[t]<0)throw new l_("The channel dimension of the inputs should be defined, "+"but found ".concat(JSON.stringify(e[t])));for(var n=e[t],r=this.kernelSize.concat([n,this.depthMultiplier]),a=[],i=0;i<this.rank;++i)a.push(1);a.push(n*this.depthMultiplier,this.filters);var o=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",r,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,o,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",a,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,o,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,o,this.biasConstraint):this.bias=null,this.inputSpec=[new uC({ndim:this.rank+2,axes:IE({},t,n)})],this.built=!0}},{key:"call",value:function(e,t){var n=this;return bm((function(){var t;if(e=tC(e),1===n.rank)throw new h_("1D separable convolution is not implemented yet.");return 2===n.rank&&("channelsFirst"===n.dataFormat&&(e=Qy(e,[0,2,3,1])),t=xy(e,n.depthwiseKernel.read(),n.pointwiseKernel.read(),n.strides,n.padding,n.dilationRate,"NHWC")),n.useBias&&(t=_S(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),"channelsFirst"===n.dataFormat&&(t=Qy(t,[0,3,1,2])),t}))}},{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.kernelInitializer,delete e.kernelRegularizer,delete e.kernelConstraint,e.depthwiseInitializer=XS(this.depthwiseInitializer),e.pointwiseInitializer=XS(this.pointwiseInitializer),e.depthwiseRegularizer=bE(this.depthwiseRegularizer),e.pointwiseRegularizer=bE(this.pointwiseRegularizer),e.depthwiseConstraint=B_(this.depthwiseConstraint),e.pointwiseConstraint=B_(this.pointwiseConstraint),e}}]),n}(zE);WE.className="SeparableConv";var GE=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,2,e)}return Jn(n)}(WE);GE.className="SeparableConv2D",vm(GE);var jE=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,1,e),n.verifyArgs(e),r.inputSpec=[{ndim:3}],r}return Jn(n,[{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this);return delete e.rank,delete e.dataFormat,e}}],[{key:"verifyArgs",value:function(e){if("number"!==typeof e.kernelSize&&!I_(e.kernelSize,"number",1,1))throw new l_("Conv1D expects config.kernelSize to be number or number[] with "+"length 1, but received ".concat(JSON.stringify(e.kernelSize),"."))}}]),n}(zE);jE.className="Conv1D",vm(jE);var qE=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,e),"number"===typeof e.cropping?r.cropping=[[e.cropping,e.cropping],[e.cropping,e.cropping]]:"number"===typeof e.cropping[0]?r.cropping=[[e.cropping[0],e.cropping[0]],[e.cropping[1],e.cropping[1]]]:r.cropping=e.cropping,r.dataFormat=void 0===e.dataFormat?"channelsLast":e.dataFormat,r.inputSpec=[{ndim:4}],r}return Jn(n,[{key:"computeOutputShape",value:function(e){return"channelsFirst"===this.dataFormat?[e[0],e[1],e[2]-this.cropping[0][0]-this.cropping[0][1],e[3]-this.cropping[1][0]-this.cropping[1][1]]:[e[0],e[1]-this.cropping[0][0]-this.cropping[0][1],e[2]-this.cropping[1][0]-this.cropping[1][1],e[3]]}},{key:"call",value:function(e,t){var n=this;return bm((function(){if(e=tC(e),"channelsLast"===n.dataFormat){var t=pS(e,n.cropping[0][0],e.shape[1]-n.cropping[0][0]-n.cropping[0][1],2);return pS(t,n.cropping[1][0],e.shape[2]-n.cropping[1][1]-n.cropping[1][0],3)}var r=pS(e,n.cropping[0][0],e.shape[2]-n.cropping[0][0]-n.cropping[0][1],3);return pS(r,n.cropping[1][0],e.shape[3]-n.cropping[1][1]-n.cropping[1][0],4)}))}},{key:"getConfig",value:function(){var e={cropping:this.cropping,dataFormat:this.dataFormat},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);qE.className="Cropping2D",vm(qE);var HE=function(e){tr(n,e);var t=sr(n);function n(e){var r,a;return $n(this,n),(r=t.call(this,e)).DEFAULT_SIZE=[2,2],r.inputSpec=[{ndim:4}],r.size=null==e.size?r.DEFAULT_SIZE:e.size,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,K_(r.dataFormat),r.interpolation=null==e.interpolation?"nearest":e.interpolation,a=r.interpolation,E_(G_,"InterpolationFormat",a),r}return Jn(n,[{key:"computeOutputShape",value:function(e){if("channelsFirst"===this.dataFormat){var t=null==e[2]?null:this.size[0]*e[2],n=null==e[3]?null:this.size[1]*e[3];return[e[0],e[1],t,n]}var r=null==e[1]?null:this.size[0]*e[1],a=null==e[2]?null:this.size[1]*e[2];return[e[0],r,a,e[3]]}},{key:"call",value:function(e,t){var n=this;return bm((function(){var t=tC(e),r=t.shape;if("channelsFirst"===n.dataFormat){t=Qy(t,[0,2,3,1]);var a=n.size[0]*r[2],i=n.size[1]*r[3],o="nearest"===n.interpolation?t.resizeNearestNeighbor([a,i]):t.resizeBilinear([a,i]);return Qy(o,[0,3,1,2])}var s=n.size[0]*r[1],u=n.size[1]*r[2];return"nearest"===n.interpolation?t.resizeNearestNeighbor([s,u]):t.resizeBilinear([s,u])}))}},{key:"getConfig",value:function(){var e={size:this.size,dataFormat:this.dataFormat},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);HE.className="UpSampling2D",vm(HE);var XE=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,2,e)).depthwiseKernel=null,r.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,r.depthwiseInitializer=KS(e.depthwiseInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.depthwiseConstraint=V_(e.depthwiseConstraint),r.depthwiseRegularizer=kE(e.depthwiseRegularizer),r}return Jn(n,[{key:"build",value:function(e){if((e=nC(e)).length<4)throw new l_("Inputs to DepthwiseConv2D should have rank 4. "+"Received input shape: ".concat(JSON.stringify(e),"."));var t="channelsFirst"===this.dataFormat?1:3;if(null==e[t]||e[t]<0)throw new l_("The channel dimension of the inputs to DepthwiseConv2D should "+"be defined, but is not (".concat(e[t],")."));var n=e[t],r=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",r,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return bm((function(){var t=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"valid",a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0;return bm((function(){null==a&&(a="channelsLast"),K_(a);var o=RE(e,a);if(4!==e.rank)throw new l_("Input for depthwiseConv2d is required to be 4-D, but is instead "+"".concat(e.rank,"-D"));if(4!==t.rank)throw new l_("depthwiseKernel is required to be 4-D, but is instead "+"".concat(t.rank,"-D"));return o=vg(o,t,n,"same"===r?"same":"valid","NHWC",i),"channelsFirst"===a&&(o=Qy(o,[0,3,1,2])),o}))}(e=tC(e),n.depthwiseKernel.read(),n.strides,n.padding,n.dataFormat,null);return n.useBias&&(t=_S(t,n.bias.read(),n.dataFormat)),null!=n.activation&&(t=n.activation.apply(t)),t}))}},{key:"computeOutputShape",value:function(e){e=nC(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[1]*this.depthMultiplier:e[3]*this.depthMultiplier,a=ME(t,this.kernelSize[0],this.padding,this.strides[0]),i=ME(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[e[0],r,a,i]:[e[0],a,i,r]}},{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this);return e.depthMultiplier=this.depthMultiplier,e.depthwiseInitializer=XS(this.depthwiseInitializer),e.depthwiseRegularizer=bE(this.depthwiseRegularizer),e.depthwiseConstraint=B_(this.depthwiseRegularizer),e}}]),n}(FE);function KE(e,t,n,r){if(Array.isArray(e)){if(null!=t||null!=n)throw new l_("When inputs is an array, neither initialState or constants should be provided");null!=r&&(n=e.slice(e.length-r,e.length),e=e.slice(0,e.length-r)),e.length>1&&(t=e.slice(1,e.length)),e=e[0]}function a(e){return null==e||Array.isArray(e)?e:[e]}return{inputs:e,initialState:t=a(t),constants:n=a(n)}}function YE(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4?arguments[4]:void 0,i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7];return bm((function(){var u=t.shape.length;if(u<3)throw new l_("Input should be at least 3D, but is ".concat(u,"D."));var c=[1,0].concat(uS(2,u));if(t=Qy(t,c),null!=i)throw new h_("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=a&&((a=a.asType("bool").asType("float32")).rank===u-1&&(a=wg(a,-1)),a=Qy(a,c)),r&&(t=gy(t,0),null!=a&&(a=gy(a,0)));var l,h,f=[],d=n,p=t.shape[0],v=Dy(t);null!=a&&(h=Dy(a));for(var m,g=function(t){var n=v[t],r=bm((function(){return e(n,d)}));if(null==a)l=r[0],d=r[1];else{var i=bm((function(){var e=h[t],n=sy(e).sub(e),a=r[0].mul(e).add(d[0].mul(n)),i=d.map((function(t,a){return r[1][a].mul(e).add(t.mul(n))}));return{output:a,newStates:i}}));l=i.output,d=i.newStates}s&&f.push(l)},y=0;y<p;++y)g(y);if(s){m=My(f,1)}return[l,m,d]}))}XE.className="DepthwiseConv2D",vm(XE);var QE=function(e){tr(n,e);var t=sr(n);function n(e){var r,a;if($n(this,n),r=t.call(this,e),null==e.cell)throw new l_("cell property is missing for the constructor of RNN.");if(null==(a=Array.isArray(e.cell)?new aI({cells:e.cell}):e.cell).stateSize)throw new l_("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");return r.cell=a,r.returnSequences=null!=e.returnSequences&&e.returnSequences,r.returnState=null!=e.returnState&&e.returnState,r.goBackwards=null!=e.goBackwards&&e.goBackwards,r._stateful=null!=e.stateful&&e.stateful,r.unroll=null!=e.unroll&&e.unroll,r.supportsMasking=!0,r.inputSpec=[new uC({ndim:3})],r.stateSpec=null,r.states_=null,r.numConstants=null,r.keptStates=[],r}return Jn(n,[{key:"getStates",value:function(){return null==this.states_?uS(0,Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1).map((function(e){return null})):this.states_}},{key:"setStates",value:function(e){this.states_=e}},{key:"computeOutputShape",value:function(e){$S(e)&&(e=e[0]);var t=this.cell.stateSize;Array.isArray(t)||(t=[t]);var n,r=t[0];if(n=this.returnSequences?[e[0],e[1],r]:[e[0],r],this.returnState){var a,i=[],o=al(t);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push([e[0],s])}}catch($Pe){o.e($Pe)}finally{o.f()}return[n].concat(i)}return n}},{key:"computeMask",value:function(e,t){var n=this;return bm((function(){Array.isArray(t)&&(t=t[0]);var e=n.returnSequences?t:null;if(n.returnState){var r=n.states.map((function(e){return null}));return[e].concat(r)}return e}))}},{key:"states",get:function(){if(null==this.states_){for(var e=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,t=[],n=0;n<e;++n)t.push(null);return t}return this.states_},set:function(e){this.states_=e}},{key:"build",value:function(e){if(null!=this.numConstants)throw new h_("Constants support is not implemented in RNN yet.");$S(e)&&(e=e[0]);var t=this.stateful?e[0]:null,n=e.slice(2);this.inputSpec[0]=new uC({shape:[t,null].concat(Tt(n))});var r,a=[e[0]].concat(e.slice(2));if(this.cell.build(a),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!gl(this.stateSpec.map((function(e){return e.shape[e.shape.length-1]})),r))throw new l_("An initialState was passed that is not compatible with "+"cell.stateSize. Received stateSpec=".concat(this.stateSpec,"; ")+"However cell.stateSize is ".concat(this.cell.stateSize))}else this.stateSpec=r.map((function(e){return new uC({shape:[null,e]})}));this.stateful&&this.resetStates()}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];bm((function(){if(!t.stateful)throw new u_("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape[0];if(null==r)throw new l_("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.states_)Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return iy([r,e])})):t.states_=[iy([r,t.cell.stateSize])];else if(null==e)xm(t.states_),null!=t.keptStates&&(xm(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(e){return iy([r,e])})):t.states_[0]=iy([r,t.cell.stateSize]);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new l_("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));!0===n?t.keptStates.push(t.states_.slice()):xm(t.states_);for(var a=0;a<t.states_.length;++a){var i=e[a],o=Array.isArray(t.cell.stateSize)?t.cell.stateSize[a]:t.cell.stateSize,s=[r,o];if(!gl(i.shape,s))throw new l_("State ".concat(a," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(s,", received shape=").concat(i.shape));t.states_[a]=i}}t.states_=t.states_.map((function(e){return km(e.clone())}))}))}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=KE(e,r,a,this.numConstants);e=i.inputs,r=i.initialState,a=i.constants;var o=[],s=[];if(null!=r){t.initialState=r,o=o.concat(r),this.stateSpec=[];var u,c=al(r);try{for(c.s();!(u=c.n()).done;){var l=u.value;this.stateSpec.push(new uC({shape:l.shape}))}}catch($Pe){c.e($Pe)}finally{c.f()}s=s.concat(this.stateSpec)}if(null!=a&&(t.constants=a,o=o.concat(a),this.numConstants=a.length),o[0]instanceof cC){var h=[e].concat(o),f=this.inputSpec.concat(s),d=this.inputSpec;this.inputSpec=f;var p=ja(nr(n.prototype),"apply",this).call(this,h,t);return this.inputSpec=d,p}return ja(nr(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return bm((function(){var r=null==t?null:t.mask,a=null==t?null:t.training,i=null==t?null:t.initialState;e=tC(e),null==i&&(i=n.stateful?n.states_:n.getInitialState(e));var o=Array.isArray(n.cell.stateSize)?n.cell.stateSize.length:1;if(i.length!==o)throw new l_("RNN Layer has ".concat(o," state(s) but was passed ")+"".concat(i.length," initial state(s)."));n.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");var s={training:a},u=YE((function(e,t){var r=n.cell.call([e].concat(t),s);return[r[0],r.slice(1)]}),e,i,n.goBackwards,r,null,n.unroll,n.returnSequences),c=u[0],l=u[1],h=u[2];n.stateful&&n.resetStates(h,a);var f=n.returnSequences?l:c;return n.returnState?[f].concat(h):f}))}},{key:"getInitialState",value:function(e){var t=this;return bm((function(){var n=iy(e.shape);return n=lS(n=Lg(n,[1,2])),Array.isArray(t.cell.stateSize)?t.cell.stateSize.map((function(e){return e>1?gS(n,[1,e]):n})):t.cell.stateSize>1?[gS(n,[1,t.cell.stateSize])]:[n]}))}},{key:"trainableWeights",get:function(){return this.trainable?this.cell.trainableWeights:[]}},{key:"nonTrainableWeights",get:function(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}},{key:"setFastWeightInitDuringBuild",value:function(e){ja(nr(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this),t={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(t.numConstants=this.numConstants);var r=this.cell.getConfig();return this.getClassName()===n.className&&(t.cell={className:this.cell.getClassName(),config:r}),Object.assign({},r,e,t)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.cell,a=IC(r,n);return new e(Object.assign(t,{cell:a}))}}]),n}(dC);QE.className="RNN",vm(QE);var ZE=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n)}(dC),JE=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,A_(r.units,"units"),r.activation=pE(null==e.activation?r.DEFAULT_ACTIVATION:e.activation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=KS(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=KS(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=KS(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=kE(e.kernelRegularizer),r.recurrentRegularizer=kE(e.recurrentRegularizer),r.biasRegularizer=kE(e.biasRegularizer),r.kernelConstraint=V_(e.kernelConstraint),r.recurrentConstraint=V_(e.recurrentConstraint),r.biasConstraint=V_(e.biasConstraint),r.dropout=oS([1,sS([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=oS([1,sS([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return Jn(n,[{key:"build",value:function(e){e=nC(e),this.kernel=this.addWeight("kernel",[e[e.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return bm((function(){if(2!==e.length)throw new l_("SimpleRNNCell expects 2 input Tensors, got ".concat(e.length,"."));var r=e[1];e=e[0];var a,i=null!=t.training&&t.training;0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=iI({ones:function(){return sy(e)},rate:n.dropout,training:i})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=iI({ones:function(){return sy(r)},rate:n.recurrentDropout,training:i}));var o=n.dropoutMask,s=n.recurrentDropoutMask;a=bS(null!=o?Ym(e,o):e,n.kernel.read()),null!=n.bias&&(a=_S(a,n.bias.read())),null!=s&&(r=Ym(r,s));var u=Tm(a,bS(r,n.recurrentKernel.read()));return null!=n.activation&&(u=n.activation.apply(u)),[u,u]}))}},{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:fE(this.activation),useBias:this.useBias,kernelInitializer:XS(this.kernelInitializer),recurrentInitializer:XS(this.recurrentInitializer),biasInitializer:XS(this.biasInitializer),kernelRegularizer:bE(this.kernelRegularizer),recurrentRegularizer:bE(this.recurrentRegularizer),biasRegularizer:bE(this.biasRegularizer),activityRegularizer:bE(this.activityRegularizer),kernelConstraint:B_(this.kernelConstraint),recurrentConstraint:B_(this.recurrentConstraint),biasConstraint:B_(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},e,t)}}]),n}(ZE);JE.className="SimpleRNNCell",vm(JE);var $E=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),e.cell=new JE(e),t.call(this,e)}return Jn(n,[{key:"call",value:function(e,t){var r=this;return bm((function(){null!=r.cell.dropoutMask&&(xm(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(xm(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return ja(nr(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(QE);$E.className="SimpleRNN",vm($E);var eI=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",e.resetAfter)throw new l_("GRUCell does not support reset_after parameter set to true.");return r.units=e.units,A_(r.units,"units"),r.activation=pE(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=pE(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=KS(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=KS(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=KS(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelRegularizer=kE(e.kernelRegularizer),r.recurrentRegularizer=kE(e.recurrentRegularizer),r.biasRegularizer=kE(e.biasRegularizer),r.kernelConstraint=V_(e.kernelConstraint),r.recurrentConstraint=V_(e.recurrentConstraint),r.biasConstraint=V_(e.biasConstraint),r.dropout=oS([1,sS([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=oS([1,sS([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.implementation=e.implementation,r.stateSize=r.units,r.dropoutMask=null,r.recurrentDropoutMask=null,r}return Jn(n,[{key:"build",value:function(e){var t=(e=nC(e))[e.length-1];this.kernel=this.addWeight("kernel",[t,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}},{key:"call",value:function(e,t){var n=this;return bm((function(){if(2!==e.length)throw new l_("GRUCell expects 2 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=null!=t.training&&t.training,a=e[1];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=iI({ones:function(){return sy(e)},rate:n.dropout,training:r,count:3})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=iI({ones:function(){return sy(a)},rate:n.recurrentDropout,training:r,count:3}));var i,o,s,u=n.dropoutMask,c=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Ym(e,u[0]));var l=bS(e,n.kernel.read());n.useBias&&(l=_S(l,n.bias.read())),0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Ym(a,c[0]));var h=n.recurrentKernel.read(),d=f(Ey(h,[2*n.units,n.units],h.rank-1),2),p=d[0],v=d[1],m=bS(a,p),g=f(Ey(l,3,l.rank-1),3),y=g[0],b=g[1],x=g[2],k=f(Ey(m,2,m.rank-1),2),w=k[0],_=k[1];i=n.recurrentActivation.apply(Tm(y,w)),o=n.recurrentActivation.apply(Tm(b,_));var S=bS(Ym(o,a),v);s=n.activation.apply(Tm(x,S));var C=Tm(Ym(i,a),Ym(Tm(1,ny(i)),s));return[C,C]}))}},{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:fE(this.activation),recurrentActivation:fE(this.recurrentActivation),useBias:this.useBias,kernelInitializer:XS(this.kernelInitializer),recurrentInitializer:XS(this.recurrentInitializer),biasInitializer:XS(this.biasInitializer),kernelRegularizer:bE(this.kernelRegularizer),recurrentRegularizer:bE(this.recurrentRegularizer),biasRegularizer:bE(this.biasRegularizer),activityRegularizer:bE(this.activityRegularizer),kernelConstraint:B_(this.kernelConstraint),recurrentConstraint:B_(this.recurrentConstraint),biasConstraint:B_(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},e,t)}}]),n}(ZE);eI.className="GRUCell",vm(eI);var tI=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new eI(e),t.call(this,e)}return Jn(n,[{key:"call",value:function(e,t){var r=this;return bm((function(){null!=r.cell.dropoutMask&&(xm(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(xm(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return ja(nr(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(QE);tI.className="GRU",vm(tI);var nI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).DEFAULT_ACTIVATION="tanh",r.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_RECURRENT_INITIALIZER="orthogonal",r.DEFAULT_BIAS_INITIALIZER="zeros",r.units=e.units,A_(r.units,"units"),r.activation=pE(void 0===e.activation?r.DEFAULT_ACTIVATION:e.activation),r.recurrentActivation=pE(void 0===e.recurrentActivation?r.DEFAULT_RECURRENT_ACTIVATION:e.recurrentActivation),r.useBias=null==e.useBias||e.useBias,r.kernelInitializer=KS(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.recurrentInitializer=KS(e.recurrentInitializer||r.DEFAULT_RECURRENT_INITIALIZER),r.biasInitializer=KS(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.unitForgetBias=e.unitForgetBias,r.kernelRegularizer=kE(e.kernelRegularizer),r.recurrentRegularizer=kE(e.recurrentRegularizer),r.biasRegularizer=kE(e.biasRegularizer),r.kernelConstraint=V_(e.kernelConstraint),r.recurrentConstraint=V_(e.recurrentConstraint),r.biasConstraint=V_(e.biasConstraint),r.dropout=oS([1,sS([0,null==e.dropout?0:e.dropout])]),r.recurrentDropout=oS([1,sS([0,null==e.recurrentDropout?0:e.recurrentDropout])]),r.implementation=e.implementation,r.stateSize=[r.units,r.units],r.dropoutMask=null,r.recurrentDropoutMask=null,r}return Jn(n,[{key:"build",value:function(e){var t,n,r=(e=nC(e))[e.length-1];if(this.kernel=this.addWeight("kernel",[r,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){var a=this.biasInitializer,i=this.units;n=new(t=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e,t){var n=a.apply([i]),r=(new NS).apply([i]),o=a.apply([2*i]);return mS(mS(n,r),o)}}]),n}(AS),t.className="CustomInit",t)}else n=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,n,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}},{key:"call",value:function(e,t){var n=this;return bm((function(){var r=null!=t.training&&t.training;if(3!==e.length)throw new l_("LSTMCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var a=e[1],i=e[2];e=e[0],0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=iI({ones:function(){return sy(e)},rate:n.dropout,training:r,count:4})),0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=iI({ones:function(){return sy(a)},rate:n.recurrentDropout,training:r,count:4}));var o,s,u,c,l=n.dropoutMask,h=n.recurrentDropoutMask;0<n.dropout&&n.dropout<1&&(e=Ym(e,l[0]));var d=bS(e,n.kernel.read());0<n.recurrentDropout&&n.recurrentDropout<1&&(a=Ym(a,h[0])),d=Tm(d,bS(a,n.recurrentKernel.read())),n.useBias&&(d=_S(d,n.bias.read()));var p=f(Ey(d,4,d.rank-1),4),v=p[0],m=p[1],g=p[2],y=p[3];o=n.recurrentActivation.apply(v),s=n.recurrentActivation.apply(m),u=Tm(Ym(s,i),Ym(o,n.activation.apply(g))),c=n.recurrentActivation.apply(y);var b=Ym(c,n.activation.apply(u));return[b,b,u]}))}},{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this),t={units:this.units,activation:fE(this.activation),recurrentActivation:fE(this.recurrentActivation),useBias:this.useBias,kernelInitializer:XS(this.kernelInitializer),recurrentInitializer:XS(this.recurrentInitializer),biasInitializer:XS(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:bE(this.kernelRegularizer),recurrentRegularizer:bE(this.recurrentRegularizer),biasRegularizer:bE(this.biasRegularizer),activityRegularizer:bE(this.activityRegularizer),kernelConstraint:B_(this.kernelConstraint),recurrentConstraint:B_(this.recurrentConstraint),biasConstraint:B_(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},e,t)}}]),n}(ZE);nI.className="LSTMCell",vm(nI);var rI=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),0===e.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),e.cell=new nI(e),t.call(this,e)}return Jn(n,[{key:"call",value:function(e,t){var r=this;return bm((function(){null!=r.cell.dropoutMask&&(xm(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(xm(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null);var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return ja(nr(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}}],[{key:"fromConfig",value:function(e,t){return 0===t.implmentation&&(t.implementation=1),new e(t)}}]),n}(QE);rI.className="LSTM",vm(rI);var aI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).cells=e.cells,r}return Jn(n,[{key:"stateSize",get:function(){var e,t=[],n=al(this.cells.slice().reverse());try{for(n.s();!(e=n.n()).done;){var r=e.value;Array.isArray(r.stateSize)?t.push.apply(t,Tt(r.stateSize)):t.push(r.stateSize)}}catch($Pe){n.e($Pe)}finally{n.f()}return t}},{key:"call",value:function(e,t){var n=this;return bm((function(){var r,a=e.slice(1),i=[],o=al(n.cells.slice().reverse());try{for(o.s();!(r=o.n()).done;){var s=r.value;Array.isArray(s.stateSize)?i.push(a.splice(0,s.stateSize.length)):i.push(a.splice(0,1))}}catch($Pe){o.e($Pe)}finally{o.f()}i.reverse();for(var u,c=[],l=0;l<n.cells.length;++l){var h=n.cells[l];a=i[l],u=0===l?[e[0]].concat(a):[u[0]].concat(a),u=h.call(u,t),c.push(u.slice(1))}a=[];var f,d=al(c.slice().reverse());try{for(d.s();!(f=d.n()).done;){var p,v=f.value;(p=a).push.apply(p,Tt(v))}}catch($Pe){d.e($Pe)}finally{d.f()}return[u[0]].concat(a)}))}},{key:"build",value:function(e){var t;$S(e)&&(e=e[0]),this.cells.forEach((function(n,r){J_("RNNCell_".concat(r),(function(){n.build(e),t=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,e=[e[0],t]}))})),this.built=!0}},{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this),t={cells:this.cells.map((function(e){return{className:e.getClassName(),config:e.getConfig()}}))};return Object.assign({},e,t)}},{key:"trainableWeights",get:function(){if(!this.trainable)return[];var e,t=[],n=al(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Tt(r.trainableWeights))}}catch($Pe){n.e($Pe)}finally{n.f()}return t}},{key:"nonTrainableWeights",get:function(){var e,t=[],n=al(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Tt(r.nonTrainableWeights))}}catch($Pe){n.e($Pe)}finally{n.f()}if(!this.trainable){var a,i=[],o=al(this.cells);try{for(o.s();!(a=o.n()).done;){var s=a.value;i.push.apply(i,Tt(s.trainableWeights))}}catch($Pe){o.e($Pe)}finally{o.f()}return i.concat(t)}return t}},{key:"getWeights",value:function(){var e,t=[],n=al(this.cells);try{for(n.s();!(e=n.n()).done;){var r=e.value;t.push.apply(t,Tt(r.weights))}}catch($Pe){n.e($Pe)}finally{n.f()}return oC(t)}},{key:"setWeights",value:function(e){var t,n=[],r=al(this.cells);try{for(r.s();!(t=r.n()).done;)for(var a=t.value,i=a.weights.length,o=e.splice(i),s=0;s<a.weights.length;++s)n.push([a.weights[s],o[s]])}catch($Pe){r.e($Pe)}finally{r.f()}sC(n)}}],[{key:"fromConfig",value:function(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=[],i=al(t.cells);try{for(i.s();!(n=i.n()).done;){var o=n.value;a.push(IC(o,r))}}catch($Pe){i.e($Pe)}finally{i.f()}return new e({cells:a})}}]),n}(ZE);function iI(e){var t=e.ones,n=e.rate,r=e.training,a=void 0!==r&&r,i=e.count,o=void 0===i?1:i,s=function(){return CS(t(),n)},u=function(){return TS(s,t,a)};return!o||o<=1?km(u().clone()):Array(o).fill(void 0).map(u).map((function(e){return km(e.clone())}))}aI.className="StackedRNNCells",vm(aI);var oI=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"===typeof Object.getOwnPropertySymbols){var a=0;for(r=Object.getOwnPropertySymbols(e);a<r.length;a++)t.indexOf(r[a])<0&&Object.prototype.propertyIsEnumerable.call(e,r[a])&&(n[r[a]]=e[r[a]])}return n},sI=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),e.unroll)throw new h_("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(e.cell))throw new h_("It is not possible at the moment to stack convolutional cells.");return(r=t.call(this,e)).inputSpec=[new uC({ndim:5})],r}return Jn(n,[{key:"call",value:function(e,t){var r=this;return bm((function(){if(null!=r.cell.dropoutMask&&(xm(r.cell.dropoutMask),r.cell.dropoutMask=null),null!=r.cell.recurrentDropoutMask&&(xm(r.cell.recurrentDropoutMask),r.cell.recurrentDropoutMask=null),t&&t.constants)throw new l_("ConvRNN2D cell does not support constants");var a=null==t?null:t.mask,i=null==t?null:t.training,o=null==t?null:t.initialState;return ja(nr(n.prototype),"call",r).call(r,e,{mask:a,training:i,initialState:o})}))}},{key:"computeOutputShape",value:function(e){var t=this.computeSingleOutputShape(e);return this.returnSequences||(t=[t[0]].concat(Tt(t.slice(2)))),this.returnState&&(t=[t].concat(Tt(Array(2).fill([e[0]].concat(Tt(t.slice(-3))))))),t}},{key:"getInitialState",value:function(e){var t=this;return bm((function(){var n=t.cell.stateSize,r=e.shape,a=t.computeSingleOutputShape(r),i=iy([a[0]].concat(Tt(a.slice(2))));return Array.isArray(n)?Array(n.length).fill(i):[i]}))}},{key:"resetStates",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1];bm((function(){if(!t.stateful)throw new u_("Cannot call resetStates() on an RNN Layer that is not stateful.");var r=t.inputSpec[0].shape,a=t.computeSingleOutputShape(r),i=[a[0]].concat(Tt(a.slice(2)));if(null==r[0])throw new l_("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==t.getStates())Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return iy(i)})):t.states_=[iy(i)];else if(null==e)xm(t.states_),null!=t.keptStates&&(xm(t.keptStates),t.keptStates=[]),Array.isArray(t.cell.stateSize)?t.states_=t.cell.stateSize.map((function(){return iy(i)})):t.states_[0]=iy(i);else{if(Array.isArray(e)||(e=[e]),e.length!==t.states_.length)throw new l_("Layer ".concat(t.name," expects ").concat(t.states_.length," state(s), ")+"but it received ".concat(e.length," state value(s). Input ")+"received: ".concat(e));n?t.keptStates.push(t.states_.slice()):xm(t.states_);for(var o=0;o<t.states_.length;++o){var s=e[o],u=i;if(!gl(s.shape,u))throw new l_("State ".concat(o," is incompatible with layer ").concat(t.name,": ")+"expected shape=".concat(u,", received shape=").concat(s.shape));t.states_[o]=s}}t.states_=t.states_.map((function(e){return km(e.clone())}))}))}},{key:"computeSingleOutputShape",value:function(e){var t=this.cell,n=t.dataFormat,r=t.filters,a=t.kernelSize,i=t.padding,o=t.strides,s=t.dilationRate,u="channelsFirst"===n,c=e[u?3:2],l=e[u?4:3],h=ME(c,a[0],i,o[0],s[0]),f=ME(l,a[1],i,o[1],s[1]);return[].concat(Tt(e.slice(0,2)),Tt(u?[r,h,f]:[h,f,r]))}}]),n}(QE);sI.className="ConvRNN2D";var uI=function(e){tr(n,e);var t=sr(n);function n(e){var r;$n(this,n);var a=e.filters,i=e.kernelSize,o=e.strides,s=e.padding,u=e.dataFormat,c=e.dilationRate;return(r=t.call(this,Object.assign({},e,{units:a}))).filters=a,A_(r.filters,"filters"),r.kernelSize=AE(i,2,"kernelSize"),r.kernelSize.forEach((function(e){return A_(e,"kernelSize")})),r.strides=AE(o||1,2,"strides"),r.strides.forEach((function(e){return A_(e,"strides")})),r.padding=s||"valid",Y_(r.padding),r.dataFormat=u||"channelsLast",K_(r.dataFormat),r.dilationRate=AE(c||1,2,"dilationRate"),r.dilationRate.forEach((function(e){return A_(e,"dilationRate")})),r}return Jn(n,[{key:"build",value:function(e){var t;e=nC(e);var n="channelsFirst"===this.dataFormat?1:e.length-1;if(null==e[n])throw new l_("The channel dimension of the input should be defined. "+"Found ".concat(e[n]));var r=e[n],a=this.kernelSize.concat([r,4*this.filters]);this.kernel=this.addWeight("kernel",a,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);var i=this.kernelSize.concat([this.filters,4*this.filters]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",i,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){var o;if(this.unitForgetBias){var s=this.biasInitializer,u=this.filters;o=new(t=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"apply",value:function(e,t){return vS([s.apply([u]),oy([u]),s.apply([2*u])])}}]),n}(AS),t.className="CustomInit",t)}else o=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.filters],null,o,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}},{key:"call",value:function(e,t){var n=this;return bm((function(){if(3!==e.length)throw new l_("ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got "+"".concat(e.length,"."));var r=t.training||!1,a=e[0],i=e[1],o=e[2];0<n.dropout&&n.dropout<1&&null==n.dropoutMask&&(n.dropoutMask=iI({ones:function(){return sy(a)},rate:n.dropout,training:r,count:4}));var s=n.dropoutMask,u=function(e,t,n){return t&&t[n]?Ym(t[n],e):e},c=u(a,s,0),l=u(a,s,1),h=u(a,s,2),d=u(a,s,3);0<n.recurrentDropout&&n.recurrentDropout<1&&null==n.recurrentDropoutMask&&(n.recurrentDropoutMask=iI({ones:function(){return sy(i)},rate:n.recurrentDropout,training:r,count:4}));var p=n.recurrentDropoutMask,v=u(i,p,0),m=u(i,p,1),g=u(i,p,2),y=u(i,p,3),b=f(Ey(n.kernel.read(),4,3),4),x=b[0],k=b[1],w=b[2],_=b[3],S=f(n.useBias?Ey(n.bias.read(),4):[null,null,null,null],4),C=S[0],T=S[1],E=S[2],I=S[3];c=n.inputConv(c,x,C,n.padding),l=n.inputConv(l,k,T,n.padding),h=n.inputConv(h,w,E,n.padding),d=n.inputConv(d,_,I,n.padding);var A=f(Ey(n.recurrentKernel.read(),4,3),4),M=A[0],N=A[1],R=A[2],D=A[3];v=n.recurrentConv(v,M),m=n.recurrentConv(m,N),g=n.recurrentConv(g,R),y=n.recurrentConv(y,D);var P=n.recurrentActivation.apply(Tm(c,v)),O=n.recurrentActivation.apply(Tm(l,m)),L=Tm(Ym(O,o),Ym(P,n.activation.apply(Tm(h,g)))),F=Ym(n.recurrentActivation.apply(Tm(d,y)),n.activation.apply(L));return[F,F,L]}))}},{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this),t=(e.units,oI(e,["units"])),r={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},t,r)}},{key:"inputConv",value:function(e,t,n,r){var a=lg(e,t,this.strides,r||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?_S(a,n,this.dataFormat):a}},{key:"recurrentConv",value:function(e,t){return lg(e,t,1,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}]),n}(nI);uI.className="ConvLSTM2DCell",vm(uI);var cI=function(e){tr(n,e);var t=sr(n);function n(e){$n(this,n);var r=new uI(e);return t.call(this,Object.assign({},e,{cell:r}))}return Jn(n,null,[{key:"fromConfig",value:function(e,t){return new e(t)}}]),n}(sI);cI.className="ConvLSTM2D",vm(cI);var lI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).rate=Math.max(Math.min(e.rate,1),0),r.noiseShape=e.noiseShape,r.seed=e.seed,r.supportsMasking=!0,r}return Jn(n,[{key:"getNoiseShape",value:function(e){if(null==this.noiseShape)return this.noiseShape;for(var t=e.shape,n=[],r=0;r<this.noiseShape.length;++r)n.push(null==this.noiseShape[r]?t[r]:this.noiseShape[r]);return n}},{key:"call",value:function(e,t){var n=this;return bm((function(){n.invokeCallHook(e,t);var r=tC(e);if(0<n.rate&&n.rate<1){var a=null!=t.training&&t.training,i=n.getNoiseShape(r);return TS((function(){return CS(r,n.rate,i,n.seed)}),(function(){return r}),a)}return e}))}},{key:"getConfig",value:function(){var e={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this)}}]),n}(dC);lI.className="Dropout",vm(lI);var hI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).inputSpec=[{ndim:3}],r}return Jn(n,[{key:"getNoiseShape",value:function(e){var t=e.shape;return[t[0],1,t[2]]}}]),n}(lI);hI.className="SpatialDropout1D",vm(hI);var fI=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),(r=t.call(this,e)).activation=null,r.useBias=!0,r.kernel=null,r.bias=null,r.DEFAULT_KERNEL_INITIALIZER="glorotNormal",r.DEFAULT_BIAS_INITIALIZER="zeros",null==e.batchInputShape&&null==e.inputShape&&null!=e.inputDim){var a=null;null!=e.batchSize&&(a=e.batchSize),r.batchInputShape=[a,e.inputDim]}return r.units=e.units,A_(r.units,"units"),r.activation=pE(e.activation),null!=e.useBias&&(r.useBias=e.useBias),r.kernelInitializer=KS(e.kernelInitializer||r.DEFAULT_KERNEL_INITIALIZER),r.biasInitializer=KS(e.biasInitializer||r.DEFAULT_BIAS_INITIALIZER),r.kernelConstraint=V_(e.kernelConstraint),r.biasConstraint=V_(e.biasConstraint),r.kernelRegularizer=kE(e.kernelRegularizer),r.biasRegularizer=kE(e.biasRegularizer),r.activityRegularizer=kE(e.activityRegularizer),r.supportsMasking=!0,r.inputSpec=[{minNDim:2}],r}return Jn(n,[{key:"build",value:function(e){var t=(e=nC(e))[e.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[t,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:IE({},-1,t)}],this.built=!0}},{key:"computeOutputShape",value:function(e){var t=(e=nC(e)).slice();return t[t.length-1]=this.units,t}},{key:"call",value:function(e,t){var n=this;return bm((function(){n.invokeCallHook(e,t);var r,a=tC(e),i=N_(n.activation.getClassName());return null!=i?r=bS(a,n.kernel.read(),i,n.bias?n.bias.read():null):(r=bS(a,n.kernel.read()),null!=n.bias&&(r=_S(r,n.bias.read())),null!=n.activation&&(r=n.activation.apply(r))),r}))}},{key:"getConfig",value:function(){var e={units:this.units,activation:fE(this.activation),useBias:this.useBias,kernelInitializer:XS(this.kernelInitializer),biasInitializer:XS(this.biasInitializer),kernelRegularizer:bE(this.kernelRegularizer),biasRegularizer:bE(this.biasRegularizer),activityRegularizer:bE(this.activityRegularizer),kernelConstraint:B_(this.kernelConstraint),biasConstraint:B_(this.biasConstraint)},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);fI.className="Dense",vm(fI);var dI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),e=e||{},(r=t.call(this,e)).inputSpec=[{minNDim:3}],r.dataFormat=e.dataFormat,r}return Jn(n,[{key:"computeOutputShape",value:function(e){var t,n=al((e=nC(e)).slice(1));try{for(n.s();!(t=n.n()).done;){if(null==t.value)throw new l_('The shape of the input to "Flatten" is not fully defined '+"(got ".concat(e.slice(1),"). Make sure to pass a complete ")+'"input_shape" or "batch_input_shape" argument to the first layer in your model.')}}catch($Pe){n.e($Pe)}finally{n.f()}return[e[0],aS(e,1)]}},{key:"call",value:function(e,t){var n=this;return bm((function(){n.invokeCallHook(e,t);var r=tC(e);if("channelsFirst"===n.dataFormat&&r.rank>1){for(var a=[0],i=2;i<r.rank;++i)a.push(i);a.push(1),r=r.transpose(a)}return function(e){if(e.rank<=1)throw new l_("batchFlatten requires a minimum rank of 2. Got rank: ".concat(e.rank,"."));var t=[e.shape[0],aS(e.shape,1)];return e.reshape(t)}(r)}))}},{key:"getConfig",value:function(){var e={};null!=this.dataFormat&&(e.dataFormat=this.dataFormat);var t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);dI.className="Flatten",vm(dI);var pI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).supportsMasking=!0,r.activation=pE(e.activation),r}return Jn(n,[{key:"call",value:function(e,t){var n=this;return bm((function(){n.invokeCallHook(e,t);var r=tC(e);return n.activation.apply(r)}))}},{key:"getConfig",value:function(){var e={activation:fE(this.activation)},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);pI.className="Activation",vm(pI);var vI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).n=e.n,r.inputSpec=[{ndim:2}],r}return Jn(n,[{key:"computeOutputShape",value:function(e){return[e[0],this.n,e[1]]}},{key:"call",value:function(e,t){var n=this;return bm((function(){return function(e,t){return bm((function(){if(2!==e.shape.length)throw new l_("repeat() expects a rank-2 tensor, but received a "+"rank-".concat(e.shape.length," tensor."));return gS(lS(e,1),[1,t,1])}))}(e=tC(e),n.n)}))}},{key:"getConfig",value:function(){var e={n:this.n},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);vI.className="RepeatVector",vm(vI);var mI=function(e){tr(n,e);var t=sr(n);function n(e){var r;$n(this,n),(r=t.call(this,e)).targetShape=e.targetShape;for(var a=0;a<r.targetShape.length;++a)r.isUnknown(r.targetShape[a])&&(r.targetShape[a]=null);return r}return Jn(n,[{key:"isUnknown",value:function(e){return e<0||null==e}},{key:"fixUnknownDimension",value:function(e,t){for(var n="Total size of new array must be unchanged.",r=t.slice(),a=1,i=null,o=0;o<r.length;++o){var s=r[o];if(this.isUnknown(s)){if(null!==i)throw new l_("Can only specifiy one unknown dimension.");i=o}else a*=s}var u=aS(e);if(null!==i){if(0===a||u%a!==0)throw new l_(n);r[i]=u/a}else if(u!==a)throw new l_(n);return r}},{key:"computeOutputShape",value:function(e){for(var t=!1,n=0;n<e.length;++n)if(this.isUnknown(e[n])){t=!0;break}return t?e.slice(0,1).concat(this.targetShape):e.slice(0,1).concat(this.fixUnknownDimension(e.slice(1),this.targetShape))}},{key:"call",value:function(e,t){var n=this;return bm((function(){n.invokeCallHook(e,t);var r=tC(e),a=r.shape,i=a.slice(0,1).concat(n.fixUnknownDimension(a.slice(1),n.targetShape));return r.reshape(i)}))}},{key:"getConfig",value:function(){var e={targetShape:this.targetShape},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);mI.className="Reshape",vm(mI);var gI=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),r=t.call(this,e),null==e.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(e.dims))throw new Error("Permute constructor requires `dims` to be an Array, but received "+"".concat(e.dims," instead."));var a=uS(1,e.dims.length+1);if(!gl(e.dims.slice().sort(),a))throw new Error("Invalid permutation `dims`: "+JSON.stringify(e.dims)+" `dims` must contain consecutive integers starting from 1.");return r.dims=e.dims,r.dimsIncludingBatch=[0].concat(r.dims),r.inputSpec=[new uC({ndim:r.dims.length+1})],r}return Jn(n,[{key:"computeOutputShape",value:function(e){var t=(e=nC(e)).slice();return this.dims.forEach((function(n,r){t[r+1]=e[n]})),t}},{key:"call",value:function(e,t){return Qy(tC(e),this.dimsIncludingBatch)}},{key:"getConfig",value:function(){var e={dims:this.dims},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);gI.className="Permute",vm(gI);var yI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,null==e?{}:e)).supportsMasking=!0,r.maskValue=null!=e?null==e.maskValue?0:e.maskValue:0,r}return Jn(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this),t={maskValue:this.maskValue};return Object.assign(t,e),t}},{key:"computeMask",value:function(e,t){var n=tC(e);return Im(ry(n,this.maskValue),-1)}},{key:"call",value:function(e,t){var n=this;return bm((function(){n.invokeCallHook(e,t);var r=tC(e),a=Im(ry(r,n.maskValue),-1,!0);return r.mul(a.asType(r.dtype))}))}}]),n}(dC);yI.className="Masking",vm(yI);var bI=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),(r=t.call(this,e)).embeddings=null,r.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==e.batchInputShape&&null==e.inputShape){var a=null;null!=e.batchSize&&(a=e.batchSize),null==e.inputLength?r.batchInputShape=[a,null]:r.batchInputShape=[a].concat(g_(e.inputLength))}return r.inputDim=e.inputDim,A_(r.inputDim,"inputDim"),r.outputDim=e.outputDim,A_(r.outputDim,"outputDim"),r.embeddingsInitializer=KS(e.embeddingsInitializer||r.DEFAULT_EMBEDDINGS_INITIALIZER),r.embeddingsRegularizer=kE(e.embeddingsRegularizer),r.activityRegularizer=kE(e.activityRegularizer),r.embeddingsConstraint=V_(e.embeddingsConstraint),r.maskZero=e.maskZero,r.supportsMasking=e.maskZero,r.inputLength=e.inputLength,r}return Jn(n,[{key:"build",value:function(e){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}},{key:"warnOnIncompatibleInputShape",value:function(e){}},{key:"computeMask",value:function(e,t){var n=this;return bm((function(){return n.maskZero?(e=tC(e),ry(e,Fy(e))):null}))}},{key:"computeOutputShape",value:function(e){if(e=nC(e),null==this.inputLength)return[].concat(Tt(e),[this.outputDim]);var t=g_(this.inputLength);if(t.length!==e.length-1)throw new l_('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));for(var n=0,r=0;r<t.length;++r){var a=t[r],i=e[r+1];if(null!=a&&null!=i&&a!==i)throw new l_('"inputLength" is '.concat(this.inputLength,", but received ")+"input shape has shape ".concat(e));null==a&&(t[n]=i),n++}return[e[0]].concat(Tt(t),[this.outputDim])}},{key:"call",value:function(e,t){var n=this;return bm((function(){n.invokeCallHook(e,t);var r=tC(e);return"int32"!==r.dtype&&(r=cS(r,"int32")),xS(n.embeddings.read(),r.as1D()).reshape(nC(n.computeOutputShape(r.shape)))}))}},{key:"getConfig",value:function(){var e={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:XS(this.embeddingsInitializer),embeddingsRegularizer:bE(this.embeddingsRegularizer),activityRegularizer:bE(this.activityRegularizer),embeddingsConstraint:B_(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);bI.className="Embedding",vm(bI);var xI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e||{})).supportsMasking=!0,r}return Jn(n,[{key:"mergeFunction",value:function(e){throw new h_}},{key:"computeElementwiseOpOutputShape",value:function(e,t){if(null==e||null==t)return null;if(e.length<t.length)return this.computeElementwiseOpOutputShape(t,e);if(0===t.length)return e;for(var n=e.slice(0,e.length-t.length),r=0;r<t.length;++r){var a=e[e.length-t.length+r],i=t[r];if(null==a||null==i||a<0||i<0)n.push(null);else if(1===a)n.push(i);else if(1===i)n.push(a);else{if(a!==i)throw new l_("Operands could not be broadcast together with shapes "+JSON.stringify(e)+" "+JSON.stringify(t));n.push(a)}}return n}},{key:"build",value:function(e){if(Array.isArray(e)&&!Array.isArray(e[0])&&(e=[nC(e)]),e.length<2)throw new l_("A merge layer should be called on an Array of at least 2 inputs."+" Got ".concat(e.length," input(s)."));var t,n=[],r=al(e);try{for(r.s();!(t=r.n()).done;){var a=t.value;null!=a&&null!==a[0]&&n.push(a[0])}}catch($Pe){r.e($Pe)}finally{r.f()}if((n=C_(n)).length>1)throw new l_("Can not merge tensors with different batch sizes. "+"Got tensors with shapes: ".concat(JSON.stringify(e),"."));for(var i=null==e[0]?null:e[0].slice(1),o=1;o<e.length;++o){var s=null==e[o]?null:e[o].slice(1);i=this.computeElementwiseOpOutputShape(i,s)}var u=e.map((function(e){return e.length}));-1===e.indexOf(null)&&1===C_(u).length?this.reshapeRequired=!1:this.reshapeRequired=!0}},{key:"call",value:function(e,t){var n=this;return bm((function(){if(n.reshapeRequired){var t=[],r=e.map((function(e){return e.rank}));if(-1===r.indexOf(null)){var a,i=sS(r),o=al(e);try{for(o.s();!(a=o.n()).done;){for(var s=a.value,u=s.rank,c=0;c<i-u;++c)s=lS(s,1);t.push(s)}}catch($Pe){o.e($Pe)}finally{o.f()}return n.mergeFunction(t)}var l,h=!1,f=al(e);try{for(f.s();!(l=f.n()).done;){var d=l.value,p=d.rank;if(null==p){var v=d.shape,m=v[0],g=v.slice(1).concat([m]),y=d.reshape([m].concat(aS(v.slice(1))));y=(y=Qy(y,[1,0])).reshape(g),t.push(y),h=!0}else if(p>1){var b=uS(1,p).concat([0]);t.push(Qy(d,b)),h=!0}else t.push(d)}}catch($Pe){f.e($Pe)}finally{f.f()}var x=n.mergeFunction(t),k=x.rank;if(h)if(null==k){var w=x.shape,_=w[w.length-1],S=[_].concat(w.slice(0,w.length-1));x=Qy(x.reshape([-1,_]),[1,0]).reshape(S)}else if(k>1){var C=[k-1].concat(uS(0,k-1));x=Qy(x,C)}return x}return n.mergeFunction(e)}))}},{key:"computeOutputShape",value:function(e){var t;t=null==e[0]?null:e[0].slice(1);for(var n=1;n<e.length;++n){var r=null==e[n]?null:e[n].slice(1);t=this.computeElementwiseOpOutputShape(t,r)}var a,i=[],o=al(e);try{for(o.s();!(a=o.n()).done;){var s=a.value;null!=s&&null!==s[0]&&i.push(s[0])}}catch($Pe){o.e($Pe)}finally{o.f()}return t=1===(i=C_(i)).length?i.concat(t):[null].concat(t)}},{key:"computeMask",value:function(e,t){return bm((function(){if(null==t)return null;if(!Array.isArray(t))throw new l_("`mask` should be an Array");if(!Array.isArray(e))throw new l_("`inputs` should be an Array");if(t.length!==e.length)throw new l_("The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths "+"(".concat(e.length," vs ").concat(t.length,")"));if(t.every((function(e){return null==e})))return null;for(var n=(t=t.map((function(e){return null==e?e:wg(e,0)})))[0],r=1;r<t.length-1;++r)n=zg(n,t[r]);return n}))}}]),n}(dC),kI=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"mergeFunction",value:function(e){return bm((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Tm(t,e[n]);return t}))}}]),n}(xI);kI.className="Add",vm(kI);var wI=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"mergeFunction",value:function(e){return bm((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Ym(t,e[n]);return t}))}}]),n}(xI);wI.className="Multiply",vm(wI);var _I=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"mergeFunction",value:function(e){return bm((function(){for(var t=e[0].clone(),n=1;n<e.length;++n)t=Tm(t,e[n]);return Ym(1/e.length,t)}))}}]),n}(xI);_I.className="Average",vm(_I);var SI=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"mergeFunction",value:function(e){return bm((function(){for(var t=e[0],n=1;n<e.length;++n)t=Vg(t,e[n]);return t}))}}]),n}(xI);SI.className="Maximum",vm(SI);var CI=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"mergeFunction",value:function(e){return bm((function(){for(var t=e[0],n=1;n<e.length;++n)t=jg(t,e[n]);return t}))}}]),n}(xI);CI.className="Minimum",vm(CI);var TI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).DEFAULT_AXIS=-1,null==e&&(e={}),r.axis=null==e.axis?r.DEFAULT_AXIS:e.axis,r.supportsMasking=!0,r.reshapeRequired=!1,r}return Jn(n,[{key:"build",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0])||1===e.length)throw new l_("A `Concatenate` layer should be called on a list of at least 2 inputs");var t,n=!0,r=al(e);try{for(r.s();!(t=r.n()).done;){if(null!=t.value){n=!1;break}}}catch($Pe){r.e($Pe)}finally{r.f()}if(!n){for(var a=[],i=0;i<e.length;++i){var o=e[i].slice();o.splice(this.axis,1);var s,u=!1,c=al(a);try{for(c.s();!(s=c.n()).done;){if(gl(s.value,o)){u=!0;break}}}catch($Pe){c.e($Pe)}finally{c.f()}u||a.push(o)}if(a.length>1)throw new l_("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(e))}}},{key:"mergeFunction",value:function(e){var t=this;return bm((function(){return vS(e,t.axis)}))}},{key:"computeOutputShape",value:function(e){if(!Array.isArray(e)||!Array.isArray(e[0]))throw new l_("A `Concatenate` layer should be called on a list of inputs.");var t,n=e,r=n[0].slice(),a=this.axis<0?r.length+this.axis:this.axis,i=al(n.slice(1));try{for(i.s();!(t=i.n()).done;){var o=t.value;if(null==r[a]||null==o[a]){r[a]=null;break}r[a]+=o[a]}}catch($Pe){i.e($Pe)}finally{i.f()}return r}},{key:"computeMask",value:function(e,t){var n=this;if(null==t)return null;if(!Array.isArray(t))throw new l_("`mask` should be an array for Concatenate");if(!Array.isArray(e))throw new l_("`inputs` should be an array for Concatenate");if(t.length!==e.length)throw new l_("Mismatch in the length of mask (".concat(t.length,") ")+"and the legnth of inputs (".concat(e.length,")"));return bm((function(){var r=!0;if(t.forEach((function(e){null==e||(r=!1)})),r)return null;for(var a=[],i=0;i<e.length;++i)null==t[i]?a.push(sy(e[i]).asType("bool")):t[i].rank<e[i].rank?a.push(wg(t[i],-1)):a.push(t[i]);var o=Xm(a,n.axis);return Em(o,-1,!1)}))}},{key:"getConfig",value:function(){var e={axis:this.axis},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(xI);function EI(e,t){for(;e<0;)e+=t;return e}TI.className="Concatenate",vm(TI);var II=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).axes=e.axes,r.normalize=null!=e.normalize&&e.normalize,r.supportsMasking=!0,r.reshapeRequired=!1,r}return Jn(n,[{key:"build",value:function(e){fl(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0],n=e[1];if(t.length>3||n.length>3)throw new h_("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);if(t[r[0]]!==n[r[1]])throw new l_("Dimension incompatibility: "+"".concat(t[r[0]]," !== ").concat(n[r[1]]))}},{key:"mergeFunction",value:function(e){if(2!==e.length)throw new l_("A `Dot` layer must be called on exactly 2 inputs, "+"but received ".concat(e.length," input(s)."));var t,n=e[0],r=e[1];return t=Array.isArray(this.axes)?this.axes.map((function(t,n){return EI(t,e[n].shape.length)})):[EI(this.axes,n.shape.length),EI(this.axes,r.shape.length)],this.normalize&&(n=AC(n,t[0]),r=AC(r,t[1])),function(e,t,n){if(e.shape.length>3||t.shape.length>3)throw new h_("batchDot is not implemented for tensors of 4D or higher rank yet");if(fl(e.shape.length>=2,(function(){return"batchDot requires the rank of x to be >= 2, "+"but got ".concat(e.shape.length)})),fl(e.shape.length>=2,(function(){return"batchDot requires the rank of y to be >= 2, "+"but got ".concat(t.shape.length)})),"number"===typeof n&&(n=[n,n]),"complex64"===e.dtype||"complex64"===t.dtype)throw new h_("batchDot is not implemented for complex64-type Tensors yet.");var r=e.shape.length,a=t.shape.length;null==n&&(n=[r-1,a-2]);var i=n;return bm((function(){var n,o;if(r>a){n=r-a;for(var s=[],u=0;u<n;++u)s.push(1);t=t.reshape(t.shape.concat(s))}else if(a>r){n=a-r;for(var c=[],l=0;l<n;++l)c.push(1);e=e.reshape(e.shape.concat(c))}else n=0;if(2===e.shape.length&&2===t.shape.length)o=i[0]===i[1]?e.mul(t).sum(i[0]):e.transpose([1,0]).mul(t).sum(i[1]);else{var h=i[0]!==e.shape.length-1,f=i[1]===t.shape.length-1;o=e.matMul(t,h,f)}if(n>0){for(var d,p=[],v=d=r>a?r+a-3:r-1;v<d+n;++v)p.push(v);o=o.squeeze(p)}return 1===o.shape.length&&(o=o.expandDims(1)),o}))}(n,r,t)}},{key:"interpretAxes",value:function(e,t){return Array.isArray(this.axes)?this.axes:[EI(this.axes,e.length),EI(this.axes,t.length)]}},{key:"computeOutputShape",value:function(e){fl(Array.isArray(e)&&2===e.length&&Array.isArray(e[0])&&Array.isArray(e[1]),(function(){return"A `Dot` layer should be called on a list of exactly 2 inputs."}));var t=e[0].slice(),n=e[1].slice();if(t.length>3||n.length>3)throw new h_("Dot layer does not support tensors of 4D or higher rank yet.");var r=this.interpretAxes(t,n);t.splice(r[0],1),n.splice(r[1],1),n.splice(0,1);var a=t.concat(n);return 1===a.length&&a.push(1),a}},{key:"computeMask",value:function(e,t){return null}},{key:"getConfig",value:function(){var e={axes:this.axes,normalize:this.normalize},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(xI);II.className="Dot",vm(II);var AI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).supportsMasking=!0,r.stddev=e.stddev,r}return Jn(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this),t={stddev:this.stddev};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return bm((function(){n.invokeCallHook(e,t);var r=tC(e);return TS((function(){return yS(r.shape,0,n.stddev).add(r)}),(function(){return r}),t.training||!1)}))}}]),n}(dC);AI.className="GaussianNoise",vm(AI);var MI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r}return Jn(n,[{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return bm((function(){n.invokeCallHook(e,t);var r=tC(e);if(n.rate>0&&n.rate<1){return TS((function(){var e=Math.sqrt(n.rate/(1-n.rate));return r.mul(yS(r.shape,1,e))}),(function(){return r}),t.training||!1)}return r}))}}]),n}(dC);MI.className="GaussianDropout",vm(MI);var NI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).supportsMasking=!0,r.rate=e.rate,r.noiseShape=e.noiseShape,r}return Jn(n,[{key:"_getNoiseShape",value:function(e){return this.noiseShape||tC(e).shape}},{key:"computeOutputShape",value:function(e){return e}},{key:"getConfig",value:function(){var e=ja(nr(n.prototype),"getConfig",this).call(this),t={rate:this.rate};return Object.assign(t,e),t}},{key:"call",value:function(e,t){var n=this;return bm((function(){if(n.rate<1&&n.rate>0){var r=n._getNoiseShape(e);return TS((function(){var t=tC(e),a=-1.7580993408473766,i=Ag(vy(r),n.rate);i=cS(i,"float32");var o=Math.pow((1-n.rate)*(1+n.rate*Math.pow(a,2)),-.5),s=-o*a*n.rate;return t.mul(i).add(i.add(-1).mul(a)).mul(o).add(s)}),(function(){return tC(e)}),t.training||!1)}return e}))}}]),n}(dC);function RI(e,t,n,r,a){var i,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.001;if(2===e.rank)i=ng(e,t,n,r,a,o);else if(3===e.rank)i=rg(e,t,n,r,a,o);else{if(4!==e.rank)throw new h_("batchNormalization is not implemented for array of rank ".concat(e.rank," ")+"yet");i=ag(e,t,n,r,a,o)}return i}function DI(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return bm((function(){var i=$g(e,r),o=i.mean,s=i.variance;return[RI(e,o,s,n,t,a),o,s]}))}function PI(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return bm((function(){var i,o=$g(e,r),s=o.mean,u=o.variance,c=[],l=al(uS(0,e.rank));try{for(l.s();!(i=l.n()).done;){var h=i.value;-1!==r.indexOf(h)?c.push(1):c.push(e.shape[h])}}catch($Pe){l.e($Pe)}finally{l.f()}var f=s.reshape(c),d=u.reshape(c),p=null==t?null:t.reshape(c),v=null==n?null:n.reshape(c);return[RI(e,f,d,v,p,a),s,u]}))}NI.className="AlphaDropout",vm(NI);var OI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),null==e&&(e={}),(r=t.call(this,e)).supportsMasking=!0,r.axis=null==e.axis?-1:e.axis,r.momentum=null==e.momentum?.99:e.momentum,r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=KS(e.betaInitializer||"zeros"),r.gammaInitializer=KS(e.gammaInitializer||"ones"),r.movingMeanInitializer=KS(e.movingMeanInitializer||"zeros"),r.movingVarianceInitializer=KS(e.movingVarianceInitializer||"ones"),r.betaConstraint=V_(e.betaConstraint),r.gammaConstraint=V_(e.gammaConstraint),r.betaRegularizer=kE(e.betaRegularizer),r.gammaRegularizer=kE(e.gammaRegularizer),r}return Jn(n,[{key:"build",value:function(e){e=nC(e);var t=this.axis>=0?this.axis:this.axis+e.length,n=e[t];if(null==n)throw new l_("Axis ".concat(t," of input tensor should have a defined dimension but ")+"the layer received an input with shape "+"".concat(JSON.stringify(e),"."));this.inputSpec=[new uC({ndim:e.length,axes:IE({},t,n)})];var r=[n];this.scale&&(this.gamma=this.addWeight("gamma",r,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",r,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",r,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",r,null,this.movingVarianceInitializer,null,!1),this.built=!0}},{key:"call",value:function(e,t){var n=this;return bm((function(){var r=null!=t.training&&t.training,a=tC(e),i=a.shape,o=i.length,s=uS(0,o),u=n.axis>=0?n.axis:n.axis+o;s.splice(u,1);var c=d_(1,o);c[u]=i[u];var l=s.slice();l.sort();var h=!gl(l,uS(0,o).slice(0,o-1));if(!r)return function(){if(h){var e=n.movingMean.read().reshape(c),t=n.movingVariance.read().reshape(c),r=n.center?n.beta.read().reshape(c):null,i=n.scale?n.gamma.read().reshape(c):null;return RI(a,e,t,r,i,n.epsilon)}return RI(a,n.movingMean.read(),n.movingVariance.read(),null==n.beta?null:n.beta.read(),null==n.gamma?null:n.gamma.read(),n.epsilon)}();var d=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.001;return gl(r.slice().sort(),uS(0,e.rank-1))?DI(e,t,n,r,a):PI(e,t,n,r,a)}(a,n.gamma.read(),n.beta.read(),s,n.epsilon),p=f(d,3),v=p[0],m=p[1],g=p[2],y=function(e,t,n){bm((function(){var r=1-n,a=e.read(),i=a.sub(t).mul(r);e.write(a.sub(i))}))};return y(n.movingMean,m,n.momentum),y(n.movingVariance,g,n.momentum),v}))}},{key:"getConfig",value:function(){var e={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:XS(this.betaInitializer),gammaInitializer:XS(this.gammaInitializer),movingMeanInitializer:XS(this.movingMeanInitializer),movingVarianceInitializer:XS(this.movingVarianceInitializer),betaRegularizer:bE(this.betaRegularizer),gammaRegularizer:bE(this.gammaRegularizer),betaConstraint:B_(this.betaConstraint),gammaConstraint:B_(this.gammaConstraint)},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);OI.className="BatchNormalization",vm(OI);var LI=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),null==e&&(e={}),(r=t.call(this,e)).axis=null==e.axis?-1:e.axis,"number"===typeof r.axis){if(!Number.isInteger(r.axis))throw new Error("Expected axis to be an integer, but received ".concat(r.axis))}else{if(!Array.isArray(r.axis))throw new Error("Expected axis to be an integer or an array of integers, "+"but received ".concat(JSON.stringify(r.axis)));var a,i=al(r.axis);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!Number.isInteger(o))throw new Error("Expected axis to be an array of integers, "+"but received ".concat(JSON.stringify(r.axis)))}}catch($Pe){i.e($Pe)}finally{i.f()}}return r.epsilon=null==e.epsilon?.001:e.epsilon,r.center=null==e.center||e.center,r.scale=null==e.scale||e.scale,r.betaInitializer=KS(e.betaInitializer||"zeros"),r.gammaInitializer=KS(e.gammaInitializer||"ones"),r.betaRegularizer=kE(e.betaRegularizer),r.gammaRegularizer=kE(e.gammaRegularizer),r.supportsMasking=!0,r}return Jn(n,[{key:"build",value:function(e){var t=(e=nC(e)).length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(var n=0;n<this.axis.length;++n)this.axis[n]<0&&(this.axis[n]+=t);var r,a=al(this.axis);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i<0||i>=t)throw new Error("Invalid axis: ".concat(i))}}catch($Pe){a.e($Pe)}finally{a.f()}if(this.axis.length!==C_(this.axis).length)throw new Error("Found duplicate axes in: ".concat(this.axis));var o=this.axis.map((function(t){return e[t]}));this.scale?this.gamma=this.addWeight("gamma",o,"float32",this.gammaInitializer,this.gammaRegularizer,true):this.gamma=null,this.center?this.beta=this.addWeight("beta",o,"float32",this.betaInitializer,this.betaRegularizer,true):this.beta=null,this.built=!0}},{key:"call",value:function(e,t){var n=this,r=tC(e),a=r.shape,i=a.length;return bm((function(){var e,t=$g(r,n.axis,!0),o=t.mean,s=t.variance,u=d_(1,i),c=al(n.axis);try{for(c.s();!(e=c.n()).done;){var l=e.value;u[l]=a[l]}}catch($Pe){c.e($Pe)}finally{c.f()}for(var h=function(e){return null!=e&&e.shape.length!==i&&n.axis!==[i-1]?e.reshape(u):e},f=h(n.gamma.read()),d=h(n.beta.read()),p=[],v=[],m=0;m<i;++m)-1!==n.axis.indexOf(m)?(p.push(a[m]),v.push(1)):(p.push(1),v.push(a[m]));return o=o.tile(p),s=s.tile(p),f=f.tile(v),d=d.tile(v),RI(r,o,s,d,f,n.epsilon)}))}},{key:"getConfig",value:function(){var e={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:XS(this.betaInitializer),gammaInitializer:XS(this.gammaInitializer),betaRegularizer:bE(this.betaRegularizer),gammaRegularizer:bE(this.gammaRegularizer)},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);LI.className="LayerNormalization",vm(LI);var FI=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),null==e&&(e={}),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,null==e.padding)r.padding=[[1,1],[1,1]];else if("number"===typeof e.padding)r.padding=[[e.padding,e.padding],[e.padding,e.padding]];else{if(e.padding=e.padding,2!==e.padding.length)throw new l_("ZeroPadding2D expects padding to be a length-2 array, but "+"received a length-".concat(e.padding.length," array."));var a,i;if("number"===typeof e.padding[0])a=[e.padding[0],e.padding[0]],i=[e.padding[1],e.padding[1]];else{if(e.padding=e.padding,2!==e.padding[0].length)throw new l_("ZeroPadding2D expects height padding to be a length-2 array, "+"but received a length-".concat(e.padding[0].length," array."));if(a=e.padding[0],2!==e.padding[1].length)throw new l_("ZeroPadding2D expects width padding to be a length-2 array, "+"but received a length-".concat(e.padding[1].length," array."));i=e.padding[1]}r.padding=[a,i]}return r.inputSpec=[new uC({ndim:4})],r}return Jn(n,[{key:"computeOutputShape",value:function(e){var t,n;return e=nC(e),"channelsFirst"===this.dataFormat?(t=null!=e[2]&&e[2]>=0?e[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[3]&&e[3]>=0?e[3]+this.padding[1][0]+this.padding[1][1]:null,[e[0],e[1],t,n]):(t=null!=e[1]&&e[1]>=0?e[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=e[2]&&e[2]>=0?e[2]+this.padding[1][0]+this.padding[1][1]:null,[e[0],t,n,e[3]])}},{key:"call",value:function(e,t){var n=this;return bm((function(){return function(e,t,n){return bm((function(){if(4!==e.rank)throw new l_("temporalPadding expects input tensor to be 4-D, but received a "+"".concat(e.rank,"-D tensor."));if(null==t&&(t=[[1,1],[1,1]]),2!==t.length||2!==t[0].length||2!==t[1].length)throw new l_("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n="channelsLast"),"channelsLast"!==n&&"channelsFirst"!==n)throw new l_("Unknown data format: ".concat(n,". ")+"Supported data formats are 'channelsLast' and 'channelsFirst.");var r;return r="channelsFirst"===n?[[0,0],[0,0],t[0],t[1]]:[[0,0],t[0],t[1],[0,0]],cy(e,r)}))}(tC(e),n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={padding:this.padding,dataFormat:this.dataFormat},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC);function zI(e,t,n,r,a,i){return bm((function(){var o;K_(a),Q_(i),Y_(r),null==n&&(n=[1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=RE(e,a);var s="same"===r?"same":"valid";return o="max"===i?Bg(e,t,n,s):qm(e,t,n,s),"channelsFirst"===a&&(o=Qy(o,[0,3,1,2])),o}))}function BI(e,t,n,r,a,i){return bm((function(){var o;K_(a),Q_(i),Y_(r),null==n&&(n=[1,1,1]),null==r&&(r="valid"),null==a&&(a="channelsLast"),null==i&&(i="max"),e=DE(e,a);var s="same"===r?"same":"valid";return o="max"===i?Ug(e,t,n,s):Hm(e,t,n,s),"channelsFirst"===a&&(o=Qy(o,[0,4,1,2,3])),o}))}FI.className="ZeroPadding2D",vm(FI);var UI=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),null==e.poolSize&&(e.poolSize=2),r=t.call(this,e),"number"===typeof e.poolSize)r.poolSize=[e.poolSize];else{if(!Array.isArray(e.poolSize)||1!==e.poolSize.length||"number"!==typeof e.poolSize[0])throw new l_("poolSize for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.poolSize)));r.poolSize=e.poolSize}if(A_(r.poolSize,"poolSize"),null==e.strides)r.strides=r.poolSize;else if("number"===typeof e.strides)r.strides=[e.strides];else{if(!Array.isArray(e.strides)||1!==e.strides.length||"number"!==typeof e.strides[0])throw new l_("strides for 1D convolutional layer must be a number or an Array of a single number, but received "+"".concat(JSON.stringify(e.strides)));r.strides=e.strides}return A_(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,Y_(r.padding),r.inputSpec=[new uC({ndim:3})],r}return Jn(n,[{key:"computeOutputShape",value:function(e){var t=ME((e=nC(e))[1],this.poolSize[0],this.padding,this.strides[0]);return[e[0],t,e[2]]}},{key:"call",value:function(e,t){var n=this;return bm((function(){n.invokeCallHook(e,t),e=lS(tC(e),2);var r=n.poolingFunction(tC(e),[n.poolSize[0],1],[n.strides[0],1],n.padding,"channelsLast");return Ay(r,[2])}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC),VI=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return K_(a),Y_(r),zI(e,t,n,r,a,"max")}}]),n}(UI);VI.className="MaxPooling1D",vm(VI);var WI=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return K_(a),Y_(r),zI(e,t,n,r,a,"avg")}}]),n}(UI);WI.className="AveragePooling1D",vm(WI);var GI=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),null==e.poolSize&&(e.poolSize=[2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(2!==e.strides.length)throw new l_("If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides];return A_(r.poolSize,"poolSize"),A_(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,K_(r.dataFormat),Y_(r.padding),r.inputSpec=[new uC({ndim:4})],r}return Jn(n,[{key:"computeOutputShape",value:function(e){e=nC(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2];return t=ME(t,this.poolSize[0],this.padding,this.strides[0]),n=ME(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n]:[e[0],t,n,e[3]]}},{key:"call",value:function(e,t){var n=this;return bm((function(){return n.invokeCallHook(e,t),n.poolingFunction(tC(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC),jI=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return K_(a),Y_(r),zI(e,t,n,r,a,"max")}}]),n}(GI);jI.className="MaxPooling2D",vm(jI);var qI=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return K_(a),Y_(r),zI(e,t,n,r,a,"avg")}}]),n}(GI);qI.className="AveragePooling2D",vm(qI);var HI=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),null==e.poolSize&&(e.poolSize=[2,2,2]),(r=t.call(this,e)).poolSize=Array.isArray(e.poolSize)?e.poolSize:[e.poolSize,e.poolSize,e.poolSize],null==e.strides)r.strides=r.poolSize;else if(Array.isArray(e.strides)){if(3!==e.strides.length)throw new l_("If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length "+"".concat(e.strides.length,"."));r.strides=e.strides}else r.strides=[e.strides,e.strides,e.strides];return A_(r.poolSize,"poolSize"),A_(r.strides,"strides"),r.padding=null==e.padding?"valid":e.padding,r.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,K_(r.dataFormat),Y_(r.padding),r.inputSpec=[new uC({ndim:5})],r}return Jn(n,[{key:"computeOutputShape",value:function(e){e=nC(e);var t="channelsFirst"===this.dataFormat?e[2]:e[1],n="channelsFirst"===this.dataFormat?e[3]:e[2],r="channelsFirst"===this.dataFormat?e[4]:e[3];return t=ME(t,this.poolSize[0],this.padding,this.strides[0]),n=ME(n,this.poolSize[1],this.padding,this.strides[1]),r=ME(r,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[e[0],e[1],t,n,r]:[e[0],t,n,r,e[4]]}},{key:"call",value:function(e,t){var n=this;return bm((function(){return n.invokeCallHook(e,t),n.poolingFunction(tC(e),n.poolSize,n.strides,n.padding,n.dataFormat)}))}},{key:"getConfig",value:function(){var e={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC),XI=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return K_(a),Y_(r),BI(e,t,n,r,a,"max")}}]),n}(HI);XI.className="MaxPooling3D",vm(XI);var KI=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"poolingFunction",value:function(e,t,n,r,a){return K_(a),Y_(r),BI(e,t,n,r,a,"avg")}}]),n}(HI);KI.className="AveragePooling3D",vm(KI);var YI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).inputSpec=[new uC({ndim:3})],r}return Jn(n,[{key:"computeOutputShape",value:function(e){return[e[0],e[2]]}},{key:"call",value:function(e,t){throw new h_}}]),n}(dC),QI=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e||{})}return Jn(n,[{key:"call",value:function(e,t){return bm((function(){var t=tC(e);return Wg(t,1)}))}}]),n}(YI);QI.className="GlobalAveragePooling1D",vm(QI);var ZI=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e||{})}return Jn(n,[{key:"call",value:function(e,t){return bm((function(){var t=tC(e);return Pg(t,1)}))}}]),n}(YI);ZI.className="GlobalMaxPooling1D",vm(ZI);var JI=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,K_(r.dataFormat),r.inputSpec=[new uC({ndim:4})],r}return Jn(n,[{key:"computeOutputShape",value:function(e){return"channelsLast"===this.dataFormat?[e[0],e[3]]:[e[0],e[1]]}},{key:"call",value:function(e,t){throw new h_}},{key:"getConfig",value:function(){var e={dataFormat:this.dataFormat},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}]),n}(dC),$I=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"call",value:function(e,t){var n=this;return bm((function(){var t=tC(e);return"channelsLast"===n.dataFormat?Wg(t,[1,2]):Wg(t,[2,3])}))}}]),n}(JI);$I.className="GlobalAveragePooling2D",vm($I);var eA=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"call",value:function(e,t){var n=this;return bm((function(){var t=tC(e);return"channelsLast"===n.dataFormat?Pg(t,[1,2]):Pg(t,[2,3])}))}}]),n}(JI);eA.className="GlobalMaxPooling2D",vm(eA);var tA=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).layer=e.layer,r}return Jn(n,[{key:"build",value:function(e){this.built=!0}},{key:"trainable",get:function(){return null!=this.layer&&this.layer.trainable},set:function(e){null!=this.layer&&(this.layer.trainable=e)}},{key:"trainableWeights",get:function(){return this.layer.trainableWeights}},{key:"nonTrainableWeights",get:function(){return this.layer.nonTrainableWeights}},{key:"updates",get:function(){return this.layer._updates}},{key:"losses",get:function(){return this.layer.losses}},{key:"getWeights",value:function(){return this.layer.getWeights()}},{key:"setWeights",value:function(e){this.layer.setWeights(e)}},{key:"getConfig",value:function(){var e={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}},{key:"setFastWeightInitDuringBuild",value:function(e){ja(nr(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(e)}}],[{key:"fromConfig",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=t.layer,a=IC(r,n);delete t.layer;var i={layer:a};return Object.assign(i,t),new e(i)}}]),n}(dC),nA=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).supportsMasking=!0,r}return Jn(n,[{key:"build",value:function(e){if((e=nC(e)).length<3)throw new l_("TimeDistributed layer expects an input shape >= 3D, but received "+"input shape ".concat(JSON.stringify(e)));this.inputSpec=[{shape:e}];var t=[e[0]].concat(e.slice(2));this.layer.built||(this.layer.build(t),this.layer.built=!0),ja(nr(n.prototype),"build",this).call(this,e)}},{key:"computeOutputShape",value:function(e){var t=[(e=nC(e))[0]].concat(e.slice(2)),n=this.layer.computeOutputShape(t),r=e[1];return[n[0],r].concat(n.slice(1))}},{key:"call",value:function(e,t){var n=this;return bm((function(){return YE((function(e,r){return[tC(n.layer.call(e,t)),[]]}),e=tC(e),[],!1,null,null,!1,!0)[1]}))}}]),n}(tA);nA.className="TimeDistributed",vm(nA);var rA=function(e){tr(n,e);var t=sr(n);function n(e){var r;$n(this,n),r=t.call(this,e);var a=e.layer.getConfig(),i={};i.className=e.layer.getClassName(),i.config=a,r.forwardLayer=IC(i),a.goBackwards=!0!==a.goBackwards;var o,s={};if(s.className=e.layer.getClassName(),s.config=a,r.backwardLayer=IC(s),r.forwardLayer.name="forward_"+r.forwardLayer.name,r.backwardLayer.name="backward_"+r.backwardLayer.name,r.mergeMode=void 0===e.mergeMode?"concat":e.mergeMode,o=r.mergeMode,E_(H_,"BidirectionalMergeMode",o),e.weights)throw new h_("weights support is not implemented for Bidirectional layer yet.");return r._stateful=e.layer.stateful,r.returnSequences=e.layer.returnSequences,r.returnState=e.layer.returnState,r.supportsMasking=!0,r._trainable=!0,r.inputSpec=e.layer.inputSpec,r.numConstants=null,r}return Jn(n,[{key:"trainable",get:function(){return this._trainable},set:function(e){this._trainable=e,null!=this.forwardLayer&&(this.forwardLayer.trainable=e),null!=this.backwardLayer&&(this.backwardLayer.trainable=e)}},{key:"getWeights",value:function(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}},{key:"setWeights",value:function(e){var t=e.length,n=Math.floor(t/2);this.forwardLayer.setWeights(e.slice(0,n)),this.backwardLayer.setWeights(e.slice(n))}},{key:"computeOutputShape",value:function(e){var t,n,r,a=this.forwardLayer.computeOutputShape(e);return Array.isArray(a)&&Array.isArray(a[0])||(a=[a]),this.returnState?(r=a.slice(1),t=a[0]):t=a[0],"concat"===this.mergeMode?(t[t.length-1]*=2,n=[t]):n=null==this.mergeMode?[t,t.slice()]:[t],this.returnState?null==this.mergeMode?n.concat(r).concat(r.slice()):[t].concat(r).concat(r.slice()):m_(n)}},{key:"apply",value:function(e,t){var r=null==t?null:t.initialState,a=null==t?null:t.constants;null==t&&(t={});var i=KE(e,r,a,this.numConstants);if(e=i.inputs,r=i.initialState,a=i.constants,Array.isArray(e)&&(r=e.slice(1),e=e[0]),(null==r||0===r.length)&&null==a)return ja(nr(n.prototype),"apply",this).call(this,e,t);var o=[],s=[];if(null!=r){var u=r.length;if(u%2>0)throw new l_("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");t.initialState=r,o.push.apply(o,Tt(r));var c=r.map((function(e){return new uC({shape:e.shape})}));this.forwardLayer.stateSpec=c.slice(0,u/2),this.backwardLayer.stateSpec=c.slice(u/2),s.push.apply(s,Tt(c))}if(null!=a)throw new h_("Support for constants in Bidirectional layers is not implemented yet.");for(var l=o[0]instanceof cC,h=0,f=o;h<f.length;h++){if(f[h]instanceof cC!==l)throw new l_("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors")}if(l){var d=[e].concat(o),p=this.inputSpec.concat(s),v=this.inputSpec;this.inputSpec=p;var m=ja(nr(n.prototype),"apply",this).call(this,d,t);return this.inputSpec=v,m}return ja(nr(n.prototype),"apply",this).call(this,e,t)}},{key:"call",value:function(e,t){var n=this;return bm((function(){var r,a,i,o,s=t.initialState;if(null==s)r=n.forwardLayer.call(e,t),a=n.backwardLayer.call(e,t);else{var u=s.slice(0,s.length/2),c=s.slice(s.length/2);r=n.forwardLayer.call(e,Object.assign(t,{initialState:u})),a=n.backwardLayer.call(e,Object.assign(t,{initialState:c}))}return n.returnState&&(Array.isArray(r)&&(i=r.slice(1).concat(a.slice(1))),r=r[0],a=a[0]),n.returnSequences&&(a=gy(a,1)),"concat"===n.mergeMode?o=vS([r,a]):"sum"===n.mergeMode?o=Tm(r,a):"ave"===n.mergeMode?o=Ym(.5,Tm(r,a)):"mul"===n.mergeMode?o=Ym(r,a):null==n.mergeMode&&(o=[r,a]),n.returnState?null==n.mergeMode?o.concat(i):[o].concat(i):o}))}},{key:"resetStates",value:function(e){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}},{key:"build",value:function(e){var t=this;J_(this.forwardLayer.name,(function(){t.forwardLayer.build(e)})),J_(this.backwardLayer.name,(function(){t.backwardLayer.build(e)})),this.built=!0}},{key:"computeMask",value:function(e,t){var n;if(Array.isArray(t)&&(t=t[0]),n=this.returnSequences?null==this.mergeMode?[t,t]:t:null==this.mergeMode?[null,null]:null,this.returnState){var r=this.forwardLayer.states.map((function(e){return null}));return Array.isArray(n)?n.concat(r).concat(r):[n].concat(r).concat(r)}return n}},{key:"trainableWeights",get:function(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}},{key:"nonTrainableWeights",get:function(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}},{key:"setFastWeightInitDuringBuild",value:function(e){ja(nr(n.prototype),"setFastWeightInitDuringBuild",this).call(this,e),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(e),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(e)}},{key:"getConfig",value:function(){var e={mergeMode:this.mergeMode},t=ja(nr(n.prototype),"getConfig",this).call(this);return Object.assign(e,t),e}}],[{key:"fromConfig",value:function(e,t){var n=IC(t.layer);if(delete t.layer,null!=t.numConstants)throw new h_("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");var r=t;return r.layer=n,new e(r)}}]),n}(tA);rA.className="Bidirectional",vm(rA);var aA,iA;!function(e){e[e.DT_INVALID=0]="DT_INVALID",e[e.DT_FLOAT=1]="DT_FLOAT",e[e.DT_DOUBLE=2]="DT_DOUBLE",e[e.DT_INT32=3]="DT_INT32",e[e.DT_UINT8=4]="DT_UINT8",e[e.DT_INT16=5]="DT_INT16",e[e.DT_INT8=6]="DT_INT8",e[e.DT_STRING=7]="DT_STRING",e[e.DT_COMPLEX64=8]="DT_COMPLEX64",e[e.DT_INT64=9]="DT_INT64",e[e.DT_BOOL=10]="DT_BOOL",e[e.DT_QINT8=11]="DT_QINT8",e[e.DT_QUINT8=12]="DT_QUINT8",e[e.DT_QINT32=13]="DT_QINT32",e[e.DT_BFLOAT16=14]="DT_BFLOAT16",e[e.DT_FLOAT_REF=101]="DT_FLOAT_REF",e[e.DT_DOUBLE_REF=102]="DT_DOUBLE_REF",e[e.DT_INT32_REF=103]="DT_INT32_REF",e[e.DT_UINT8_REF=104]="DT_UINT8_REF",e[e.DT_INT16_REF=105]="DT_INT16_REF",e[e.DT_INT8_REF=106]="DT_INT8_REF",e[e.DT_STRING_REF=107]="DT_STRING_REF",e[e.DT_COMPLEX64_REF=108]="DT_COMPLEX64_REF",e[e.DT_INT64_REF=109]="DT_INT64_REF",e[e.DT_BOOL_REF=110]="DT_BOOL_REF",e[e.DT_QINT8_REF=111]="DT_QINT8_REF",e[e.DT_QUINT8_REF=112]="DT_QUINT8_REF",e[e.DT_QINT32_REF=113]="DT_QINT32_REF",e[e.DT_BFLOAT16_REF=114]="DT_BFLOAT16_REF"}(aA||(aA={})),function(e){!function(e){e[e.LEGACY=0]="LEGACY",e[e.V1=1]="V1",e[e.V2=2]="V2"}(e.CheckpointFormatVersion||(e.CheckpointFormatVersion={}))}(iA||(iA={}));function oA(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Set;if(null==e)return null;if(r.has(e))throw new Error("Circular references are not supported.");if(n.has(e))return n.get(e);var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(a.recurse){if(lA(e)){var i=Array.isArray(e)?[]:{};for(var o in r.add(e),e){var s=e[o],u=oA(s,t,n,r);i[o]=u}return r.delete(e),i}throw new Error("Can't recurse into non-iterable type: ".concat(e))}return n.set(e,a.value),a.value}function sA(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:cA;return uA(e,t)}function uA(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Set,r=e[0];if(n.has(r))throw new Error("Circular references are not supported.");var a=t(e);if(a.recurse&&null!==a.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(a.recurse){if(lA(r)){var i=Array.isArray(r)?[]:{};n.add(r);var o=function(r){var a=e.map((function(e){return e[r]})),o=uA(a,t,n);i[r]=o};for(var s in r)o(s);return n.delete(r),i}throw new Error("Can't recurse into non-iterable type: ".concat(r))}return a.value}function cA(e){return null===e?null:lA(e[0])?{value:null,recurse:!0}:{value:e,recurse:!1}}function lA(e){return null!=e&&!ArrayBuffer.isView(e)&&(Array.isArray(e)||"object"===typeof e&&!(e instanceof tp))}function hA(e){return function(e,t){return oA(e,t)}(e,fA)}function fA(e){return e instanceof tp?{value:e.clone(),recurse:!1}:lA(e)?{value:null,recurse:!0}:{value:e,recurse:!1}}var dA=function(){function e(t){if($n(this,e),this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}return Jn(e,[{key:"wrap",value:function(e){for(;e<0;)e+=this.doubledCapacity;return e%this.doubledCapacity}},{key:"get",value:function(e){if(e<0)throw new RangeError("Can't get item at a negative index.");return this.data[e%this.capacity]}},{key:"set",value:function(e,t){if(e<0)throw new RangeError("Can't set item at a negative index.");this.data[e%this.capacity]=t}},{key:"length",value:function(){var e=this.end-this.begin;return e<0&&(e=this.doubledCapacity+e),e}},{key:"isFull",value:function(){return this.length()===this.capacity}},{key:"isEmpty",value:function(){return 0===this.length()}},{key:"push",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,e),this.end=this.wrap(this.end+1)}},{key:"pushAll",value:function(e){var t,n=al(e);try{for(n.s();!(t=n.n()).done;){var r=t.value;this.push(r)}}catch($Pe){n.e($Pe)}finally{n.f()}}},{key:"pop",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);var e=this.get(this.end);return this.set(this.end,void 0),e}},{key:"unshift",value:function(e){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,e)}},{key:"shift",value:function(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var e=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),e}},{key:"shuffleExcise",value:function(e){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");var t=this.wrap(this.begin+e),n=this.get(t);return this.set(t,this.pop()),n}}]),e}(),pA=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.call(this,n.INITIAL_CAPACITY)}return Jn(n,[{key:"isFull",value:function(){return!1}},{key:"push",value:function(e){ja(nr(n.prototype),"isFull",this).call(this)&&this.expand(),ja(nr(n.prototype),"push",this).call(this,e)}},{key:"unshift",value:function(e){ja(nr(n.prototype),"isFull",this).call(this)&&this.expand(),ja(nr(n.prototype),"unshift",this).call(this,e)}},{key:"expand",value:function(){for(var e=2*this.capacity,t=new Array(e),n=this.length(),r=0;r<n;r++)t[r]=this.get(this.wrap(this.begin+r));this.data=t,this.capacity=e,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}]),n}(dA);function vA(e){return new xA(e)}function mA(e,t){return new NA(e,t)}pA.INITIAL_CAPACITY=32;var gA,yA=function(){function e(){$n(this,e)}return Jn(e,[{key:"toArray",value:function(){var e=ns(es().mark((function e(){var t,n;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],e.next=3,this.next();case 3:n=e.sent;case 4:if(n.done){e.next=11;break}return t.push(n.value),e.next=8,this.next();case 8:n=e.sent,e.next=4;break;case 11:return e.abrupt("return",t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=ns(es().mark((function e(){var t,n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.prefetch(100),n=[],e.next=4,t.next();case 4:r=e.sent;case 5:if(r.done){e.next=12;break}return n.push(r.value),e.next=9,t.next();case 9:r=e.sent,e.next=5;break;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveFully",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:t=e.sent;case 3:if(t.done){e.next=9;break}return e.next=6,this.next();case 6:t=e.sent,e.next=3;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"resolveWhile",value:function(){var e=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.next();case 2:n=e.sent,r=t(n.value);case 4:if(n.done||!r){e.next=11;break}return e.next=7,this.next();case 7:n=e.sent,r=t(n.value),e.next=4;break;case 11:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"handleErrors",value:function(e){return new EA(this,e)}},{key:"filter",value:function(e){return new CA(this,e)}},{key:"map",value:function(e){return new TA(this,e)}},{key:"mapAsync",value:function(e){return new IA(this,e)}},{key:"serialMapAsync",value:function(e){return new IA(this,e).serial()}},{key:"flatmap",value:function(e){return new MA(this,e)}},{key:"forEachAsync",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.map(t).resolveFully());case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"serialForEach",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.serialMapAsync(t).resolveWhile((function(e){return!0===e})));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"rowMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return new SA(this,e,t)}},{key:"columnMajorBatch",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:cA,r=this.rowMajorBatch(e,t);return r.map((function(e){return sA(e,n)}))}},{key:"concatenate",value:function(e,t){return new NA(new bA([this,e]),t)}},{key:"take",value:function(e){return e<0||null==e?this:new _A(this,e)}},{key:"skip",value:function(e){return e<0||null==e?this:new wA(this,e)}},{key:"prefetch",value:function(e){return new RA(this,e)}},{key:"shuffle",value:function(e,t){return new DA(this,e,t)}},{key:"serial",value:function(){return new kA(this)}}]),e}(),bA=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).items=e,r.trav=0,r}return Jn(n,[{key:"summary",value:function(){return"Array of ".concat(this.items.length," items")}},{key:"next",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.trav>=this.items.length)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return t=this.items[this.trav],this.trav++,e.abrupt("return",{value:hA(t),done:!1});case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(yA),xA=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).nextFn=e,r}return Jn(n,[{key:"summary",value:function(){return"Function call"}},{key:"next",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.abrupt("return",this.nextFn());case 4:throw e.prev=4,e.t0=e.catch(0),e.t0.message="Error thrown while iterating through a dataset: ".concat(e.t0.message),e.t0;case 8:case"end":return e.stop()}}),e,this,[[0,4]])})));return function(){return e.apply(this,arguments)}}()}]),n}(yA),kA=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).upstream=e,r.lastRead=Promise.resolve({value:null,done:!1}),r}return Jn(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Serial")}},{key:"next",value:function(){var e=ns(es().mark((function e(){var t=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.upstream.next());case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(yA),wA=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Jn(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Skip")}},{key:"next",value:function(){var e=ns(es().mark((function e(){var t=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++<this.maxCount)){e.next=9;break}return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done){e.next=6;break}return e.abrupt("return",t);case 6:xm(t.value),e.next=0;break;case 9:return e.abrupt("return",this.upstream.next());case 10:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(yA),_A=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this)).upstream=e,a.maxCount=r,a.count=0,a}return Jn(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Take")}},{key:"next",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this.count++>=this.maxCount)){e.next=2;break}return e.abrupt("return",{value:null,done:!0});case 2:return e.abrupt("return",this.upstream.next());case 3:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(yA),SA=function(e){tr(n,e);var t=sr(n);function n(e,r){var a,i=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return $n(this,n),(a=t.call(this)).upstream=e,a.batchSize=r,a.enableSmallLastBatch=i,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Jn(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> RowMajorBatch")}},{key:"next",value:function(){var e=ns(es().mark((function e(){var t=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=ns(es().mark((function e(){var t,n;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=[];case 1:if(!(t.length<this.batchSize)){e.next=12;break}return e.next=4,this.upstream.next();case 4:if(!(n=e.sent).done){e.next=9;break}if(!(this.enableSmallLastBatch&&t.length>0)){e.next=8;break}return e.abrupt("return",{value:t,done:!1});case 8:return e.abrupt("return",{value:null,done:!0});case 9:t.push(n.value),e.next=1;break;case 12:return e.abrupt("return",{value:t,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(yA),CA=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this)).upstream=e,a.predicate=r,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Jn(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Filter")}},{key:"next",value:function(){var e=ns(es().mark((function e(){var t=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=3,this.upstream.next();case 3:if(!(t=e.sent).done&&!this.predicate(t.value)){e.next=6;break}return e.abrupt("return",t);case 6:xm(t.value),e.next=0;break;case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(yA),TA=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return Jn(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Map")}},{key:"next",value:function(){var e=ns(es().mark((function e(){var t,n,r,a,i,o,s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:n=dp(t.value),r=this.transform(t.value),a=dp(r),i=al(n);try{for(i.s();!(o=i.n()).done;)fp(s=o.value,a)||s.dispose()}catch($Pe){i.e($Pe)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(yA),EA=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this)).upstream=e,a.handler=r,a.count=0,a.lastRead=Promise.resolve({value:null,done:!1}),a}return Jn(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> handleErrors")}},{key:"next",value:function(){var e=ns(es().mark((function e(){var t=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=1,e.next=4,this.upstream.next();case 4:return e.abrupt("return",e.sent);case 7:if(e.prev=7,e.t0=e.catch(1),this.handler(e.t0)){e.next=11;break}return e.abrupt("return",{value:null,done:!0});case 11:e.next=0;break;case 13:case"end":return e.stop()}}),e,this,[[1,7]])})));return function(){return e.apply(this,arguments)}}()}]),n}(yA),IA=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return Jn(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> AsyncMap")}},{key:"next",value:function(){var e=ns(es().mark((function e(){var t,n,r,a,i,o,s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:return n=dp(t.value),e.next=8,this.transform(t.value);case 8:r=e.sent,a=dp(r),i=al(n);try{for(i.s();!(o=i.n()).done;)fp(s=o.value,a)||s.dispose()}catch($Pe){i.e($Pe)}finally{i.f()}return e.abrupt("return",{value:r,done:!1});case 13:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(yA),AA=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this)).outputQueue=new pA,e.lastRead=Promise.resolve({value:null,done:!1}),e}return Jn(n,[{key:"next",value:function(){var e=ns(es().mark((function e(){var t=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"serialNext",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.outputQueue.length()){e.next=7;break}return e.next=3,this.pump();case 3:if(e.sent){e.next=5;break}return e.abrupt("return",{value:null,done:!0});case 5:e.next=0;break;case 7:return e.abrupt("return",{value:this.outputQueue.shift(),done:!1});case 8:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(yA),MA=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this)).upstream=e,a.transform=r,a}return Jn(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Flatmap")}},{key:"pump",value:function(){var e=ns(es().mark((function e(){var t,n,r,a,i,o,s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.upstream.next();case 2:if(!(t=e.sent).done){e.next=5;break}return e.abrupt("return",!1);case 5:n=dp(t.value),r=this.transform(t.value),a=dp(r),this.outputQueue.pushAll(r),i=al(n);try{for(i.s();!(o=i.n()).done;)fp(s=o.value,a)||s.dispose()}catch($Pe){i.e($Pe)}finally{i.f()}return e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(AA),NA=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this)).baseErrorHandler=r,a.lastRead=null,a.iterator=null,a.moreIterators=e,a}return Jn(n,[{key:"summary",value:function(){return"".concat("TODO: fill in upstream of chained summaries"," -> Chained")}},{key:"next",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.readFromChain(this.lastRead),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"readFromChain",value:function(){var e=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t;case 2:if(null!=this.iterator){e.next=10;break}return e.next=5,this.moreIterators.next();case 5:if(!(n=e.sent).done){e.next=8;break}return e.abrupt("return",{value:null,done:!0});case 8:this.iterator=n.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler));case 10:return e.next=12,this.iterator.next();case 12:if(!(r=e.sent).done){e.next=16;break}return this.iterator=null,e.abrupt("return",this.readFromChain(t));case 16:return e.abrupt("return",r);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(yA);!function(e){e[e.FAIL=0]="FAIL",e[e.SHORTEST=1]="SHORTEST",e[e.LONGEST=2]="LONGEST"}(gA||(gA={}));var RA=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this)).upstream=e,a.bufferSize=r,a.buffer=new dA(r),a}return Jn(n,[{key:"summary",value:function(){return"".concat(this.upstream.summary()," -> Prefetch")}},{key:"refill",value:function(){for(;!this.buffer.isFull();){var e=this.upstream.next();this.buffer.push(e)}}},{key:"next",value:function(){return this.refill(),this.buffer.shift()}}]),n}(yA),DA=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;return $n(this,n),(i=t.call(this,e,r)).upstream=e,i.windowSize=r,i.upstreamExhausted=!1,i.random=hy.alea(a||Yd().toString()),i.lastRead=Promise.resolve({value:null,done:!1}),i}return Jn(n,[{key:"next",value:function(){var e=ns(es().mark((function e(){var t=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.lastRead=this.lastRead.then((function(){return t.serialNext()})),e.abrupt("return",this.lastRead);case 2:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"randomInt",value:function(e){return Math.floor(this.random()*e)}},{key:"chooseIndex",value:function(){return this.randomInt(this.buffer.length())}},{key:"serialNext",value:function(){var e=ns(es().mark((function e(){var t,n;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.upstreamExhausted||this.refill();case 1:if(this.buffer.isEmpty()){e.next=14;break}return t=this.chooseIndex(),e.next=5,this.buffer.shuffleExcise(t);case 5:if(!(n=e.sent).done){e.next=10;break}this.upstreamExhausted=!0,e.next=12;break;case 10:return this.refill(),e.abrupt("return",n);case 12:e.next=1;break;case 14:return e.abrupt("return",{value:null,done:!0});case 15:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),n}(RA),PA=function(){function e(){$n(this,e),this.size=null}return Jn(e,[{key:"batch",value:function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this;return fl(e>0,(function(){return"batchSize needs to be positive, but it is\n      ".concat(e)})),t=this.size===1/0||null==this.size?this.size:n?Math.ceil(this.size/e):Math.floor(this.size/e),OA(ns(es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,r.iterator();case 2:return t.abrupt("return",t.sent.columnMajorBatch(e,n,LA));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"concatenate",value:function(e){var t,n=this;return t=this.size===1/0||e.size===1/0?1/0:null!=this.size&&null!=e.size?this.size+e.size:null,OA(ns(es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.t0=t.sent,t.next=5,e.iterator();case 5:return t.t1=t.sent,t.abrupt("return",t.t0.concatenate.call(t.t0,t.t1));case 7:case"end":return t.stop()}}),t)}))),t)}},{key:"filter",value:function(e){var t,n=this;return t=this.size===1/0?1/0:null,OA(ns(es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.filter((function(t){return bm((function(){return e(t)}))})));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"forEachAsync",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.iterator();case 2:return e.abrupt("return",e.sent.forEachAsync(t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"map",value:function(e){var t=this;return OA(ns(es().mark((function n(){return es().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.map((function(t){return bm((function(){return e(t)}))})));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"mapAsync",value:function(e){var t=this;return OA(ns(es().mark((function n(){return es().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.mapAsync(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"prefetch",value:function(e){if(null==e)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");var t=this;return OA(ns(es().mark((function n(){return es().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.iterator();case 2:return n.abrupt("return",n.sent.prefetch(e));case 3:case"end":return n.stop()}}),n)}))),this.size)}},{key:"repeat",value:function(e){var t,n=this;return t=null!=this.size&&e>0?this.size*e:0===e?0:null!=this.size&&(void 0===e||e<0)?1/0:null,OA(ns(es().mark((function t(){var r;return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=vA(ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.iterator();case 2:return e.t0=e.sent,e.abrupt("return",{value:e.t0,done:!1});case 4:case"end":return e.stop()}}),e)})))),t.abrupt("return",mA(r.take(e)));case 2:case"end":return t.stop()}}),t)}))),t)}},{key:"skip",value:function(e){var t,n=this;return t=null!=this.size&&e>=0&&this.size>=e?this.size-e:null!=this.size&&(this.size<e||void 0===e||e<0)?0:null,OA(ns(es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.skip(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"shuffle",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(null==e||e<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError("`Dataset.shuffle()` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for `tf.Tensor`s), consider setting "+"bufferSize to the dataset size (".concat(this.size," elements)"));var r=this,a=hy.alea(t||Yd().toString());return OA(ns(es().mark((function t(){var i;return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=a.int32(),n&&(i+=a.int32()),t.next=4,r.iterator();case 4:return t.abrupt("return",t.sent.shuffle(e,i.toString()));case 5:case"end":return t.stop()}}),t)}))),this.size)}},{key:"take",value:function(e){var t,n=this;return t=null!=this.size&&this.size>e?e:null!=this.size&&this.size<=e?this.size:null,OA(ns(es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.iterator();case 2:return t.abrupt("return",t.sent.take(e));case 3:case"end":return t.stop()}}),t)}))),t)}},{key:"toArray",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArray());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"toArrayForTest",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.size!==1/0){e.next=2;break}throw new Error("Can not convert infinite data stream to array.");case 2:return e.next=4,this.iterator();case 4:return e.abrupt("return",e.sent.toArrayForTest());case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();function OA(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return new(function(n){tr(a,n);var r=sr(a);function a(){var e;return $n(this,a),(e=r.apply(this,arguments)).size=t,e}return Jn(a,[{key:"iterator",value:function(){var t=ns(es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",e());case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}()}]),a}(PA))}function LA(e){return null===e?null:function(e){return null==e||null===(t=e)||"object"!==typeof t&&"function"!==typeof t||Array.isArray(e)||"object"===typeof e&&e instanceof tp||El(e);var t}(e[0])?{value:function(e){if(0===e.length)throw new Error("Can't make a batch of zero elements.");return e[0]instanceof tp?My(e):Rp(e)}(e),recurse:!1}:{value:null,recurse:!0}}PA.MAX_BUFFER_SIZE=1e4;Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");var FA=function(){function e(t,n){$n(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return Jn(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),zA=function(){function e(){$n(this,e)}return Jn(e,[{key:"decComplexRef",value:function(e){}},{key:"time",value:function(e){return BA("time")}},{key:"read",value:function(e){return BA("read")}},{key:"readSync",value:function(e){return BA("readSync")}},{key:"numDataIds",value:function(){return BA("numDataIds")}},{key:"disposeData",value:function(e){return BA("disposeData")}},{key:"write",value:function(e,t,n){return BA("write")}},{key:"move",value:function(e,t,n,r){return BA("move")}},{key:"memory",value:function(){return BA("memory")}},{key:"floatPrecision",value:function(){return BA("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"batchMatMul",value:function(e,t,n,r){return BA("batchMatMul")}},{key:"fusedBatchMatMul",value:function(e){e.a,e.b,e.transposeA,e.transposeB,e.bias,e.activation,e.preluActivationWeights;return BA("fusedBatchMatMul")}},{key:"slice",value:function(e,t,n){return BA("slice")}},{key:"stridedSlice",value:function(e,t,n,r){return BA("stridedSlice")}},{key:"unstack",value:function(e,t){return BA("unstack")}},{key:"reverse",value:function(e,t){return BA("reverse")}},{key:"concat",value:function(e,t){return BA("concat")}},{key:"neg",value:function(e){return BA("neg")}},{key:"add",value:function(e,t){return BA("add")}},{key:"addN",value:function(e){return BA("addN")}},{key:"subtract",value:function(e,t){return BA("subtract")}},{key:"multiply",value:function(e,t){return BA("multiply")}},{key:"realDivide",value:function(e,t){return BA("realDivide")}},{key:"floorDiv",value:function(e,t){return BA("floorDiv")}},{key:"sum",value:function(e,t){return BA("sum")}},{key:"prod",value:function(e,t){return BA("prod")}},{key:"unsortedSegmentSum",value:function(e,t,n){return BA("unsortedSegmentSum")}},{key:"argMin",value:function(e,t){return BA("argMin")}},{key:"argMax",value:function(e,t){return BA("argMax")}},{key:"equal",value:function(e,t){return BA("equal")}},{key:"notEqual",value:function(e,t){return BA("notEqual")}},{key:"less",value:function(e,t){return BA("less")}},{key:"lessEqual",value:function(e,t){return BA("lessEqual")}},{key:"greater",value:function(e,t){return BA("greater")}},{key:"greaterEqual",value:function(e,t){return BA("greaterEqual")}},{key:"logicalNot",value:function(e){return BA("logicalNot")}},{key:"logicalAnd",value:function(e,t){return BA("logicalAnd")}},{key:"logicalOr",value:function(e,t){return BA("logicalOr")}},{key:"where",value:function(e){return BA("where")}},{key:"select",value:function(e,t,n){return BA("select")}},{key:"topk",value:function(e,t,n){return BA("topk")}},{key:"min",value:function(e,t){return BA("min")}},{key:"minimum",value:function(e,t){return BA("minimum")}},{key:"mod",value:function(e,t){return BA("mod")}},{key:"max",value:function(e,t){return BA("max")}},{key:"maximum",value:function(e,t){return BA("maximum")}},{key:"all",value:function(e,t){return BA("all")}},{key:"any",value:function(e,t){return BA("any")}},{key:"squaredDifference",value:function(e,t){return BA("squaredDifference")}},{key:"ceil",value:function(e){return BA("ceil")}},{key:"floor",value:function(e){return BA("floor")}},{key:"round",value:function(e){return BA("round")}},{key:"sign",value:function(e){return BA("sign")}},{key:"isNaN",value:function(e){return BA("isNaN")}},{key:"isInf",value:function(e){return BA("isInf")}},{key:"isFinite",value:function(e){return BA("isFinite")}},{key:"pow",value:function(e,t){return BA("pow")}},{key:"exp",value:function(e){return BA("exp")}},{key:"expm1",value:function(e){return BA("expm1")}},{key:"softmax",value:function(e,t){return BA("softmax")}},{key:"log",value:function(e){return BA("log")}},{key:"log1p",value:function(e){return BA("log1p")}},{key:"sqrt",value:function(e){return BA("sqrt")}},{key:"rsqrt",value:function(e){return BA("rsqrt")}},{key:"square",value:function(e){return BA("square")}},{key:"reciprocal",value:function(e){return BA("reciprocal")}},{key:"relu",value:function(e){return BA("relu")}},{key:"relu6",value:function(e){return BA("relu6")}},{key:"prelu",value:function(e,t){return BA("prelu")}},{key:"elu",value:function(e){return BA("elu")}},{key:"eluDer",value:function(e,t){return BA("eluDer")}},{key:"selu",value:function(e){return BA("selu")}},{key:"int",value:function(e){return BA("int")}},{key:"clip",value:function(e,t,n){return BA("clip")}},{key:"abs",value:function(e){return BA("abs")}},{key:"complexAbs",value:function(e){return BA("complexAbs")}},{key:"sigmoid",value:function(e){return BA("sigmoid")}},{key:"softplus",value:function(e){return BA("softplus")}},{key:"sin",value:function(e){return BA("sin")}},{key:"cos",value:function(e){return BA("cos")}},{key:"tan",value:function(e){return BA("tan")}},{key:"asin",value:function(e){return BA("asin")}},{key:"acos",value:function(e){return BA("acos")}},{key:"atan",value:function(e){return BA("atan")}},{key:"atan2",value:function(e,t){return BA("atan2")}},{key:"sinh",value:function(e){return BA("sinh")}},{key:"cosh",value:function(e){return BA("cosh")}},{key:"tanh",value:function(e){return BA("tanh")}},{key:"asinh",value:function(e){return BA("asinh")}},{key:"acosh",value:function(e){return BA("acosh")}},{key:"atanh",value:function(e){return BA("atanh")}},{key:"erf",value:function(e){return BA("erf")}},{key:"step",value:function(e,t){return BA("step")}},{key:"fusedConv2d",value:function(e){e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights;return BA("fusedConv2d")}},{key:"conv2d",value:function(e,t,n){return BA("conv2d")}},{key:"conv2dDerInput",value:function(e,t,n){return BA("conv2dDerInput")}},{key:"conv2dDerFilter",value:function(e,t,n){return BA("conv2dDerFilter")}},{key:"fusedDepthwiseConv2D",value:function(e){e.input,e.filter,e.convInfo,e.bias,e.activation,e.preluActivationWeights;return BA("fusedDepthwiseConv2D")}},{key:"depthwiseConv2D",value:function(e,t,n){return BA("depthwiseConv2D")}},{key:"depthwiseConv2DDerInput",value:function(e,t,n){return BA("depthwiseConv2DDerInput")}},{key:"depthwiseConv2DDerFilter",value:function(e,t,n){return BA("depthwiseConv2DDerFilter")}},{key:"conv3d",value:function(e,t,n){return BA("conv3d")}},{key:"conv3dDerInput",value:function(e,t,n){return BA("conv3dDerInput")}},{key:"conv3dDerFilter",value:function(e,t,n){return BA("conv3dDerFilter")}},{key:"maxPool",value:function(e,t){return BA("maxPool")}},{key:"maxPoolBackprop",value:function(e,t,n,r){return BA("maxPoolBackprop")}},{key:"avgPool",value:function(e,t){return BA("avgPool")}},{key:"avgPoolBackprop",value:function(e,t,n){return BA("avgPoolBackprop")}},{key:"avgPool3d",value:function(e,t){return BA("avgPool3d")}},{key:"avgPool3dBackprop",value:function(e,t,n){return BA("avgPool3dBackprop")}},{key:"maxPool3d",value:function(e,t){return BA("maxPool3d")}},{key:"maxPool3dBackprop",value:function(e,t,n,r){return BA("maxPool3dBackprop")}},{key:"reshape",value:function(e,t){return BA("reshape")}},{key:"cast",value:function(e,t){return BA("cast")}},{key:"tile",value:function(e,t){return BA("tile")}},{key:"pad",value:function(e,t,n){return BA("pad")}},{key:"transpose",value:function(e,t){return BA("transpose")}},{key:"gather",value:function(e,t,n){return BA("gather")}},{key:"gatherND",value:function(e,t){return BA("gatherND")}},{key:"scatterND",value:function(e,t,n){return BA("scatterND")}},{key:"batchToSpaceND",value:function(e,t,n){return BA("batchToSpaceND")}},{key:"spaceToBatchND",value:function(e,t,n){return BA("spaceToBatchND")}},{key:"resizeBilinear",value:function(e,t,n,r,a){return BA("resizeBilinear")}},{key:"resizeBilinearBackprop",value:function(e,t,n){return BA("resizeBilinearBackprop")}},{key:"resizeNearestNeighbor",value:function(e,t,n,r,a){return BA("resizeNearestNeighbor")}},{key:"resizeNearestNeighborBackprop",value:function(e,t,n){return BA("resizeNearestNeighborBackprop")}},{key:"batchNorm",value:function(e,t,n,r,a,i){return BA("batchNorm")}},{key:"localResponseNormalization4D",value:function(e,t,n,r,a){return BA("localResponseNormalization4D")}},{key:"LRNGrad",value:function(e,t,n,r,a,i,o){return BA("LRNGrad")}},{key:"multinomial",value:function(e,t,n,r){return BA("multinomial")}},{key:"oneHot",value:function(e,t,n,r){return BA("oneHot")}},{key:"cumsum",value:function(e,t,n,r){return BA("cumsum")}},{key:"nonMaxSuppression",value:function(e,t,n,r,a){return BA("nonMaxSuppression")}},{key:"fft",value:function(e){return BA("fft")}},{key:"ifft",value:function(e){return BA("ifft")}},{key:"complex",value:function(e,t){return BA("complex")}},{key:"real",value:function(e){return BA("real")}},{key:"imag",value:function(e){return BA("imag")}},{key:"cropAndResize",value:function(e,t,n,r,a,i){return BA("cropAndResize")}},{key:"depthToSpace",value:function(e,t,n){return BA("depthToSpace")}},{key:"split",value:function(e,t,n){return BA("split")}},{key:"sparseToDense",value:function(e,t,n,r){return BA("sparseToDense")}},{key:"diag",value:function(e){return BA("diag")}},{key:"fill",value:function(e,t,n){return BA("fill")}},{key:"onesLike",value:function(e){return BA("onesLike")}},{key:"zerosLike",value:function(e){return BA("zerosLike")}},{key:"linspace",value:function(e,t,n){return BA("linspace")}},{key:"dispose",value:function(){return BA("dispose")}}]),e}();function BA(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function UA(e,t,n){return Math.max(e,Math.min(t,n))}function VA(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function WA(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";VA(HA(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function GA(e){VA(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function jA(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||$A(e)&&!n)for(var r=0;r<e.length;++r)jA(e[r],t,n);else t.push(e);return t}function qA(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function HA(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function XA(e){return e%1===0}function KA(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function YA(e,t){var n=t.length;return e=null==e?t.map((function(e,t){return t})):[].concat(e),VA(e.every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)})),VA(e.every((function(e){return XA(e)})),(function(){return"All values in axis param must be integers but "+"got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function QA(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function ZA(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function JA(e,t){return"complex64"!==t&&(("float32"!==t||"complex64"===e)&&(("int32"!==t||"float32"===e||"complex64"===e)&&("bool"!==t||"bool"!==e)))}function $A(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array}function eM(e){return"string"===typeof e||e instanceof String}function tM(e){return Array.isArray(e)?tM(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array?"int32":"number"===typeof e?"float32":eM(e)?"string":function(e){return"boolean"===typeof e}(e)?"bool":"float32"}function nM(e){return!!(e&&e.constructor&&e.call&&e.apply)}function rM(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function aM(e,t,n){var r=new Array;if(1===t.length)for(var a=t[0],i=0;i<a;i++)r[i]=n[e+i];else for(var o=t[0],s=t.slice(1),u=s.reduce((function(e,t){return e*t})),c=0;c<o;c++)r[c]=aM(e+c*u,s,n);return r}function iM(e,t){if(0===e.length)return t[0];var n=e.reduce((function(e,t){return e*t}));if(0===n)return[];if(n!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length,"."));return aM(0,e,t)}function oM(e,t){for(var n=sM(e,t),r=0;r<n.length;r++)n[r]=1;return n}function sM(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function uM(e,t){var n=e.reduce((function(e,t){return e*t}),1);if(null==t||"float32"===t)return iM(e,new Float32Array(n));if("int32"===t)return iM(e,new Int32Array(n));if("bool"===t)return iM(e,new Uint8Array(n));throw new Error("Unknown data type ".concat(t))}function cM(e){e.forEach((function(t){VA(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"].")}))}))}function lM(e,t,n){if(0===t)return 0;if(1===t)return e[0];for(var r=e[e.length-1],a=0;a<e.length-1;++a)r+=n[a]*e[a];return r}function hM(e,t,n){if(0===t)return[];if(1===t)return[e];for(var r=new Array(t),a=0;a<r.length-1;++a)r[a]=Math.floor(e/n[a]),e-=r[a]*n[a];return r[r.length-1]=e,r}function fM(e){return e&&e.then&&"function"===typeof e.then}var dM="tfjsflags",pM=function(){function e(t){$n(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}return Jn(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(t,".")),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=2;break}return e.abrupt("return",this.flags[t]);case 2:return e.next=4,this.evaluateFlag(t);case 4:return this.flags[t]=e.sent,e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(fM(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!==typeof this.global&&"undefined"!==typeof this.global.location&&"undefined"!==typeof this.global.location.search){var t=function(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return vM(t,r[0],r[1]),r.join("=")})),t}(this.global.location.search);if(dM in t)t.tfjsflags.split(",").forEach((function(t){var n=f(t.split(":"),2),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if("".concat(+t)===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(r,a)}))}}}]),e}();function vM(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function mM(){return yM}var gM,yM=null;function bM(){if(null==gM){var e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof __webpack_require__.g)e=__webpack_require__.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}gM=e}return gM}function xM(e,t){var n=function(){var e=bM();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var kM="Abs",wM="Acos",_M="Acosh",SM="Add",CM="AddN",TM="All",EM="Any",IM="ArgMax",AM="ArgMin",MM="Asin",NM="Asinh",RM="Atan",DM="Atanh",PM="Atan2",OM="AvgPool",LM="AvgPoolGrad",FM="AvgPool3D",zM="AvgPool3DGrad",BM="BatchMatMul",UM="BatchToSpaceND",VM="Cast",WM="Ceil",GM="ClipByValue",jM="Complex",qM="ComplexAbs",HM="Concat",XM="Conv2D",KM="Conv2DBackpropFilter",YM="Conv2DBackpropInput",QM="Conv3D",ZM="Conv3DBackpropFilterV2",JM="Conv3DBackpropInputV2",$M="Cos",eN="Cosh",tN="Cumsum",nN="CropAndResize",rN="DepthToSpace",aN="DepthwiseConv2dNative",iN="DepthwiseConv2dNativeBackpropFilter",oN="DepthwiseConv2dNativeBackpropInput",sN="Dilation2D",uN="Dilation2DBackpropInput",cN="Dilation2DBackpropFilter",lN="RealDiv",hN="Elu",fN="EluGrad",dN="Erf",pN="Equal",vN="Exp",mN="ExpandDims",gN="Expm1",yN="Fill",bN="FlipLeftRight",xN="Floor",kN="FloorDiv",wN="FusedBatchNorm",_N="GatherV2",SN="Greater",CN="GreaterEqual",TN="Identity",EN="IFFT",IN="Imag",AN="IsFinite",MN="IsInf",NN="IsNan",RN="LeakyRelu",DN="Less",PN="LessEqual",ON="Log",LN="Log1p",FN="LogicalAnd",zN="LogicalNot",BN="LogicalOr",UN="LRN",VN="LRNGrad",WN="Max",GN="Maximum",jN="MaxPool",qN="MaxPoolGrad",HN="MaxPool3D",XN="MaxPool3DGrad",KN="Mean",YN="Min",QN="Minimum",ZN="MirrorPad",JN="Mod",$N="Multiply",eR="Neg",tR="NotEqual",nR="NonMaxSuppressionV3",rR="NonMaxSuppressionV4",aR="NonMaxSuppressionV5",iR="OnesLike",oR="OneHot",sR="Pack",uR="PadV2",cR="Pow",lR="Prelu",hR="Prod",fR="Range",dR="Real",pR="Reciprocal",vR="Relu",mR="Reshape",gR="ResizeNearestNeighbor",yR="ResizeNearestNeighborGrad",bR="ResizeBilinear",xR="ResizeBilinearGrad",kR="Relu6",wR="Reverse",_R="Round",SR="Rsqrt",CR="Select",TR="Selu",ER="Slice",IR="Sin",AR="Sinh",MR="Sign",NR="Sigmoid",RR="Softplus",DR="Sqrt",PR="Sum",OR="SpaceToBatchND",LR="SplitV",FR="Softmax",zR="SquaredDifference",BR="Square",UR="Sub",VR="StridedSlice",WR="Tan",GR="Tanh",jR="Tile",qR="TopK",HR="Transpose",XR="Unique",KR="Unpack",YR="UnsortedSegmentSum",QR="ZerosLike",ZR="Step",JR="RotateWithOffset",$R=xM("kernelRegistry",(function(){return new Map})),eD=xM("gradRegistry",(function(){return new Map}));function tD(e){return eD.get(e)}function nD(e){for(var t=$R.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=f(i,2),s=o[0],u=o[1];f(s.split("_"),1)[0]===e&&n.push(u)}return n}function rD(e){var t=e.kernelName,n=e.backendName,r=iD(t,n);$R.has(r)&&console.warn("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),$R.set(r,e)}function aD(e){var t=e.kernelName;eD.has(t)&&mM().getBool("DEBUG")&&console.warn("Overriding the gradient for '".concat(t,"'")),eD.set(t,e)}function iD(e,t){return"".concat(t,"_").concat(e)}var oD=function(){function e(t,n){$n(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new sD)}return Jn(e,[{key:"profileKernel",value:function(e,t,n){var r,a=this.backendTimer.time((function(){r=n()}));if(mM().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var i=function(t){var n=r[t];n.data().then((function(t){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(t,n.dtype,e)}))},o=0;o<r.length;o++)i(o);return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var sD=function(){function e(){$n(this,e)}return Jn(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"===typeof r?KA("".concat(r,"ms"),9):r.error,s=KA(e,25),u=t.rank,c=t.size,l=KA(t.shape.toString(),14),h="";for(var f in a){var d=a[f];if(null!=d){var p=d.shape||t.shape,v=p.length;h+="".concat(f,": ").concat(v,"D ").concat(v>0?p:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(h,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();function uD(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],h=!1,f=0;f<t.length;f++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),h=!0,a[s.id]=!0;break}if(h)break}}var d={};d[n.id]=!0;for(var p={},v=e.length-1;v>=0;v--)for(var m=e[v],g=m.inputs,y=0;y<m.outputs.length;y++)if(d[m.outputs[y].id]){for(var b in g)d[g[b].id]=!0,p[m.id]=!0;break}for(var x=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&p[w.id]){var _={};for(var S in w.inputs){var C=w.inputs[S];r[C.id]&&(_[S]=C)}var T=Object.assign({},w);T.inputs=_,T.outputs=w.outputs,x.push(T)}}return x}function cD(e,t,n,r){for(var a=function(a){var i=t[a],o=[];if(i.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(i.kernelName,"."));var s=i.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(s),"."));var a=n((function(){return s[t]()}));if("float32"!==a.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(a.dtype,"'"));var o=i.inputs[t];if(!HA(a.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(a.shape,"', which does not match ")+"the shape of the input '".concat(o.shape,"'"));if(null==e[o.id])e[o.id]=a;else{var u=e[o.id];e[o.id]=r(u,a),u.dispose()}};for(var c in i.inputs)u(c)},i=t.length-1;i>=0;i--)a(i)}function lD(e,t,n,r){var a=rM(t),i=function(e,t,n,r){var a=qA(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?pD(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,h=0;h<i;h++)o[h]=Math.max(o[h],hD(u[l+h],0,n).length);return o}(e,t,n,a),o=t.length,s=dD(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function hD(e,t,n){return KA(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ")+"".concat(parseFloat(e[1].toFixed(7)),"j"):eM(e)?"'".concat(e,"'"):"bool"===n?fD(e):parseFloat(e.toFixed(7)).toString(),t)}function fD(e){return 0===e?"false":"true"}function dD(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u){if("complex64"===n){var c=pD(e);return[hD(c[0],0,n)]}return"bool"===n?[fD(e[0])]:[e[0].toString()]}if(1===u){if(s>20){var l=3*o,h=Array.from(e.slice(0,l)),f=Array.from(e.slice((s-3)*o,s*o));return"complex64"===n&&(h=pD(h),f=pD(f)),["["+h.map((function(e,t){return hD(e,a[t],n)})).join(", ")+", ..., "+f.map((function(e,t){return hD(e,a[s-3+t],n)})).join(", ")+"]"]}var d="complex64"===n?pD(e):Array.from(e);return["["+d.map((function(e,t){return hD(e,a[t],n)})).join(", ")+"]"]}var p=t.slice(1),v=r.slice(1),m=r[0]*o,g=[];if(s>20){for(var y=0;y<3;y++){var b=y*m,x=b+m;g.push.apply(g,Tt(dD(e.slice(b,x),p,n,v,a,!1)))}g.push("...");for(var k=s-3;k<s;k++){var w=k*m,_=w+m;g.push.apply(g,Tt(dD(e.slice(w,_),p,n,v,a,k===s-1)))}}else for(var S=0;S<s;S++){var C=S*m,T=C+m;g.push.apply(g,Tt(dD(e.slice(C,T),p,n,v,a,S===s-1)))}var E=2===u?",":"";g[0]="["+g[0]+E;for(var I=1;I<g.length-1;I++)g[I]=" "+g[I]+E;for(var A=",\n",M=2;M<u;M++)A+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":A),g}function pD(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}function vD(e,t){return"string"===t?yD(e):mD([e],t)}function mD(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=jA(e)),mM().getBool("DEBUG")&&function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function gD(){return mM().platform.now()}function yD(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",mM().platform.encode(e,t)}function bD(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",mM().platform.decode(e,t)}var xD=function(){function e(t,n,r){var a=this;if($n(this,e),this.dtype=n,this.shape=t.slice(),this.size=qA(t),null!=r){var i=r.length;VA(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||ZA(n,this.size),this.strides=rM(t)}return Jn(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),VA(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return kD().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),kD=null,wD=null;var _D=function(){function e(t,n,r,a){$n(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=qA(t),this.strides=rM(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Jn(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",wD.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return wD.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",iM(this.shape,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return iM(this.shape,this.dataSync())}},{key:"data",value:function(){var e=ns(es().mark((function e(){var t,n;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=kD().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return bD(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataSync",value:function(){this.throwIfDisposed();var e=kD().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return bD(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,kD().read(this.dataId);case 3:if(t=e.sent,"string"!==this.dtype){e.next=8;break}return e.abrupt("return",t);case 8:return e.abrupt("return",new Uint8Array(t.buffer));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(kD().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return wD.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),wD.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.dataSync();return lD(t,this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),wD.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),kD().makeVariable(this,e,t,n)}}]),e}();Object.defineProperty(_D,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}});var SD,CD,TD,ED,ID,AD=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i){var o;return $n(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return Jn(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!HA(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));kD().disposeTensor(this),this.dataId=e.dataId,kD().incRef(this,null)}},{key:"dispose",value:function(){kD().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(_D);Object.defineProperty(AD,Symbol.hasInstance,{value:function(e){return e instanceof _D&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(SD||(SD={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(CD||(CD={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(TD||(TD={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(ED||(ED={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(ID||(ID={}));var MD={float32:ED,int32:CD,bool:TD,complex64:ID};function ND(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return MD[e][t]}function RD(e,t){if(e.dtype===t.dtype)return[e,t];var n=ND(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function DD(e){var t=[];return PD(e,t,new Set),t}function PD(e,t,n){if(null!=e)if(e instanceof _D)t.push(e);else if(r=e,Array.isArray(r)||"object"===typeof r){var r,a=e;for(var i in a){var o=a[i];n.has(o)||(n.add(o),PD(o,t,n))}}}var OD=function(){function e(){$n(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return Jn(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),LD=function(){function e(t){$n(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new OD}return Jn(e,[{key:"ready",value:function(){var e=ns(es().mark((function e(){var t,n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=18;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=15;break}return e.next=14,this.setBackend(r);case 14:return e.abrupt("return");case 15:n++,e.next=6;break;case 18:throw new Error("Could not initialize any backends, all backend initializations failed.");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(console.warn("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=16;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=12;break}return e.next=9,r;case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=r;case 13:if(e.t0){e.next=16;break}return e.abrupt("return",!1);case 16:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new oD(this.backendInstance),e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;nD(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;nD(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof zA||"function"!==typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,console.warn("Initialization of backend ".concat(e," failed")),console.warn(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch($Pe){return console.warn("Initialization of backend ".concat(e," failed")),console.warn($Pe.stack||$Pe.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t);r.disposeData(t),n.backend=e,e.move(t,a,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(a){throw t(),a}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=this.makeTensorFromDataId(e.dataId,e.shape,e.dtype),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t="float32",n={x:e},r={dtype:t};return BD.runKernelFunc((function(n){return n.cast(e,t)}),n,null,VM,r)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n,r,a){return this.runKernelFunc(null,t,null,e,n,r,a)}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e,t,n,r,a,i,o){var s,u=this,c=[],l=this.isTapeOn();null==r&&(r=null!=this.state.activeScope?this.state.activeScope.name:"");var h,f=this.state.numBytes,d=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var p,v,m=function(e,t){var n=iD(e,t);return $R.get(n)}(r,this.backendName);if(null!=m)h=function(){var e=u.backend.numDataIds();p=m.kernelFunc({inputs:t,attrs:a,backend:u.backend});var n=Array.isArray(p)?p:[p];u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,e,n);var s=n.map((function(e){if(null!=e.rank)return e;var t=e.dataId,n=e.shape,r=e.dtype;return u.makeTensorFromDataId(t,n,r)}));if(l){var h=u.getTensorsForGradient(r,t,s);if(null==h){null==o&&(o=[]);var f=s.filter((function(e,t){return o[t]}));h=(i||[]).slice().concat(f)}c=u.saveTensorsForBackwardMode(h)}return s};else{if(null==e)throw new Error("Error running ".concat(r,": Neither modular kernel nor forward func passed"));var g=function(e){l&&(c=e.map((function(e){return u.keep(u.clone(e))})))};h=function(){var t=u.backend.numDataIds();p=u.tidy((function(){return e(u.backend,g)}));var n=Array.isArray(p)?p:[p];return u.shouldCheckForMemLeaks()&&u.checkKernelForMemLeak(r,t,n),n}}return this.scopedRun((function(){return u.state.kernelDepth++}),(function(){return u.state.kernelDepth--}),(function(){u.ENV.getBool("DEBUG")||u.state.profiling?(v=u.profiler.profileKernel(r,t,(function(){return h()})),u.ENV.getBool("DEBUG")&&u.profiler.logKernelProfile(v),s=v.outputs):s=h()})),l&&this.addTapeNode(r,t,s,n,c,a),this.state.profiling&&this.state.activeProfile.kernels.push({name:r,bytesAdded:this.state.numBytes-f,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-d,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(t).map((function(e){return null!=t[e]?t[e].shape:null})),outputShapes:s.map((function(e){return e.shape})),kernelTimeMs:v.timeMs,extraInfo:v.extraInfo}),Array.isArray(p)?s:s[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=tD(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(VA(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return null}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&eM(e[0])&&(a=e.map((function(e){return yD(e)})));var i=r.write(a,t,n),o=new _D(t,n,i,this.nextTensorId());if(this.incRef(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=function(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a=new _D(t,n=n||"float32",e,this.nextTensorId());return this.incRef(a,r),a}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new AD(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"incRef",value:function(e,t){var n=this.state.tensorInfo.has(e.dataId)?this.state.tensorInfo.get(e.dataId).refCount:0;if(this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;var r=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(r=e.size*function(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}(e.dtype)),this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:r,refCount:0}),this.state.numBytes+=r}this.state.tensorInfo.get(e.dataId).refCount++,e instanceof AD||this.track(e)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){this.state.numTensors--,"string"===e.dtype&&this.state.numStringTensors--;var t=this.state.tensorInfo.get(e.dataId);t.refCount<=1?("complex64"!==e.dtype&&(this.state.numBytes-=t.bytes),this.state.numDataBuffers--,t.backend.disposeData(e.dataId),this.state.tensorInfo.delete(e.dataId)):(t.backend.decComplexRef(e.dataId),this.state.tensorInfo.get(e.dataId).refCount--)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=6,t();case 6:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Tt(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=al(this.state.activeProfile.kernels),e.prev=12,a.s();case 14:if((i=a.n()).done){e.next=24;break}return o=i.value,e.next=18,o.kernelTimeMs;case 18:return o.kernelTimeMs=e.sent,e.next=21,o.extraInfo;case 21:o.extraInfo=e.sent;case 22:e.next=14;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(12),a.e(e.t0);case 29:return e.prev=29,a.f(),e.finish(29);case 32:return e.abrupt("return",this.state.activeProfile);case 33:case"end":return e.stop()}}),e,this,[[12,26,29,32]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=tD(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=sM(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=DD(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(VA(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));VA(i instanceof _D,(function(){return"The result y returned by f() must be a tensor."}));var o=uD(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?FD(i.shape):n,cD(e,o,(function(e){return r.tidy(e)}),UD);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=al(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch($Pe){n.e($Pe)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return VA(nM(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;VA(r.every((function(e){return e instanceof _D})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};return r.forEach((function(e,t){o[t]=e})),t.runKernelFunc((function(t,n){return VA((i=e.apply(void 0,[].concat(r,[n]))).value instanceof _D,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),VA(nM(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value}),o,(function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];VA(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),VA(a.every((function(e){return e instanceof _D})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o}))}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"time",value:function(){var e=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=gD(),e.next=3,this.backend.time(t);case 3:return(r=e.sent).wallMs=gD()-n,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new OD,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function FD(e){var t=oM(qA(e),"float32");return BD.makeTensor(t,e,"float32")}function zD(){var e=bM();if(null==e._tfengine){var t=new pM(e);e._tfengine=new LD(t)}return function(e){yM=e}(e._tfengine.ENV),function(e){kD=e}((function(){return e._tfengine})),e._tfengine}LD.nextTensorId=0,LD.nextVariableId=0;var BD=zD();function UD(e,t){var n={a:e,b:t};return BD.runKernel(SM,n)}var VD=mM();VD.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),VD.registerFlag("IS_BROWSER",(function(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope})),VD.registerFlag("IS_NODE",(function(){return"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node})),VD.registerFlag("IS_CHROME",(function(){return"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),VD.registerFlag("PROD",(function(){return!1})),VD.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return VD.getBool("DEBUG")})),VD.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),VD.registerFlag("IS_TEST",(function(){return!1})),VD.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0}));var WD="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function GD(e){return WD?Buffer.byteLength(e):new Blob([e]).size}function jD(e){if(WD)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function qD(e){if(WD){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function HD(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function XD(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:GD(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:GD(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var KD=function(){function e(){$n(this,e),this.saveRouters=[],this.loadRouters=[]}return Jn(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),YD="tensorflowjs",QD="models_store",ZD="model_info_store";function JD(){if(!mM().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function $D(e){var t=e.result;t.createObjectStore(QD,{keyPath:"modelPath"}),t.createObjectStore(ZD,{keyPath:"modelPath"})}var eP=function(){function e(t){if($n(this,e),this.indexedDB=JD(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return Jn(e,[{key:"save",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(YD,1);a.onupgradeneeded=function(){return $D(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(QD,"readonly"),s=o.objectStore(QD).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=XD(t),l=i.transaction(ZD,"readwrite"),h=l.objectStore(ZD),f=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});f.onsuccess=function(){var a=(u=i.transaction(QD,"readwrite")).objectStore(QD).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(h=l.objectStore(ZD)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},f.onerror=function(e){return i.close(),r(f.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();eP.URL_SCHEME="indexeddb://";var tP=function(e){return mM().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(eP.URL_SCHEME)?(t=e.slice(eP.URL_SCHEME.length),new eP(t)):null;var t};KD.registerSaveRouter(tP),KD.registerLoadRouter(tP);var nP=function(){function e(){$n(this,e),this.indexedDB=JD()}return Jn(e,[{key:"listModels",value:function(){var e=ns(es().mark((function e(){var t=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(YD,1);r.onupgradeneeded=function(){return $D(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(ZD,"readonly"),i=a.objectStore(ZD).getAll();i.onsuccess=function(){var t,n={},r=al(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch($Pe){r.e($Pe)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=ns(es().mark((function e(t){var n=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(r=t).startsWith(eP.URL_SCHEME)?r.slice(eP.URL_SCHEME.length):r,e.abrupt("return",new Promise((function(e,r){var a=n.indexedDB.open(YD,1);a.onupgradeneeded=function(){return $D(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(ZD,"readwrite"),s=o.objectStore(ZD),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' ")+"in IndexedDB."));var a=s.delete(t),o=function(){var a=(n=i.transaction(QD,"readwrite")).objectStore(QD).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}})));case 2:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),rP="/",aP="tensorflowjs_models",iP="info",oP="model_topology",sP="weight_specs",uP="weight_data",cP="model_metadata";function lP(e){return{info:[aP,e,iP].join(rP),topology:[aP,e,oP].join(rP),weightSpecs:[aP,e,sP].join(rP),weightData:[aP,e,uP].join(rP),modelMetadata:[aP,e,cP].join(rP)}}function hP(e){var t=e.split(rP);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(rP)}var fP=function(){function e(t){if($n(this,e),!mM().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=lP(this.modelPath)}return Jn(e,[{key:"save",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=4;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 4:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=XD(t),e.prev=7,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,jD(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy},null!=t.signature&&(i.signature=t.signature),null!=t.userDefinedMetadata&&(i.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(i.modelInitializer=t.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),e.abrupt("return",{modelArtifactsInfo:a});case 20:throw e.prev=20,e.t0=e.catch(7),this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."));case 28:case"end":return e.stop()}}),e,this,[[7,20]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=ns(es().mark((function e(){var t,n,r,a,i,o,s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=9;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");case 9:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=13;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");case 13:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=19;break}throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));case 19:return n.weightData=qD(s),e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();fP.URL_SCHEME="localstorage://";var dP=function(e){return mM().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(fP.URL_SCHEME)?(t=e.slice(fP.URL_SCHEME.length),new fP(t)):null;var t};KD.registerSaveRouter(dP),KD.registerLoadRouter(dP);var pP=function(){function e(){$n(this,e),VA(mM().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),VA("undefined"===typeof window||"undefined"!==typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return Jn(e,[{key:"listModels",value:function(){var e=ns(es().mark((function e(){var t,n,r,a,i,o;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=aP+rP,r=rP+iP,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=hP(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(a=t).startsWith(fP.URL_SCHEME)?a.slice(fP.URL_SCHEME.length):a,n=lP(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),this.LS.removeItem(n.info),this.LS.removeItem(n.topology),this.LS.removeItem(n.weightSpecs),this.LS.removeItem(n.weightData),e.abrupt("return",r);case 10:case"end":return e.stop()}var a}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),vP="://",mP=function(){function e(){$n(this,e),this.managers={}}return Jn(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){VA(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(vP)&&(t=t.slice(0,t.indexOf(vP))),VA(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();VA(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}},{key:"getSchemes",value:function(){return Object.keys(this.getInstance().managers)}}]),e}();var gP=function(){function e(){$n(this,e)}return Jn(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}}]),e}();if(mM().get("IS_BROWSER")){mM().setPlatform("browser",new gP);try{mP.registerManager(fP.URL_SCHEME,new pP)}catch($Pe){}try{mP.registerManager(eP.URL_SCHEME,new nP)}catch($Pe){}}var yP,bP=function(){return __webpack_require__(911)};var xP=function(){function e(){$n(this,e),this.util=__webpack_require__(8489),this.textEncoder=new this.util.TextEncoder}return Jn(e,[{key:"fetch",value:function(e,t){return null!=mM().global.fetch?mM().global.fetch(e,t):(null==yP&&(yP=bP()),yP(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),e}();function kP(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",cM(e),new xD(e,t,n)}function wP(e,t){var n=e;if($A(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||$A(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&mM().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&_P(e,r,[]),r}function _P(e,t,n){if(n=n||[],Array.isArray(e)||$A(e)){VA(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements")})),VA(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)_P(e[a],r,n.concat(a))}else VA(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements")}))}function SP(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function CP(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof _D)return SP(r,e.dtype,t,n),e;var a=tM(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),SP(r,a,t,n),null==e||!$A(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=wP(e,a);$A(e)||Array.isArray(e)||(e=[e]);var s=!0,u="string"!==a?mD(e,a):jA(e,[],s);return BD.makeTensor(u,o,a)}function TP(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=e;return a.map((function(e,a){return CP(e,"".concat(t,"[").concat(a,"]"),n,r)}))}mM().get("IS_NODE")&&mM().setPlatform("node",new xP);function EP(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var a=function(){BD.startScope(n);try{var e=r.apply(void 0,arguments);return fM(e)&&console.error("Cannot return a Promise inside of tidy."),BD.endScope(e),e}catch(t){throw BD.endScope(null),t}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var IP=EP({cast_:function(e,t){var n=CP(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return BD.runKernel(VM,r,a)}});var AP=EP({clone_:function(e){var t={x:CP(e,"x","clone","string_or_numeric")};return BD.runKernel(TN,t)}});zD();var MP={buffer:kP,cast:IP,clone:AP,print:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};!function(e){wD=e}(MP);function NP(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var RP=function(){function e(t){if($n(this,e),!mM().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelTopologyFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return Jn(e,[{key:"save",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=7;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 7:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},null!=t.signature&&(a.signature=t.signature),null!=t.userDefinedMetadata&&(a.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(a.modelInitializer=t.modelInitializer),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor).download=this.modelTopologyFileName,o.href=i,e.next=18,NP((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 18:if(null==t.weightData){e.next=24;break}return(s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,e.next=24,NP((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 24:return e.abrupt("return",{modelArtifactsInfo:XD(t)});case 25:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();RP.URL_SCHEME="downloads://";function DP(e,t,n,r){!function(e){VA(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){VA(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)})),VA(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)})),VA(t>=e,(function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function PP(e,t){return OP.apply(this,arguments)}function OP(){return(OP=ns(es().mark((function e(t,n){var r,a,i,o,s,u,c,l,h;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?mM().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,DP(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0,u=s.map((function(e){return e.arrayBuffer()})),c=.5,l=1,null!=n.onProgress){e.next=24;break}return e.next=21,Promise.all(u);case 21:e.t1=e.sent,e.next=27;break;case 24:return e.next=26,DP(u,n.onProgress,c,l);case 26:e.t1=e.sent;case 27:return h=e.t1,e.abrupt("return",h);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}KD.registerSaveRouter((function(e){return mM().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(RP.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new RP(e)}(e.slice(RP.URL_SCHEME.length)):null}));var LP=function(){function e(t,n){if($n(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(VA("function"===typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=mM().platform.fetch,VA(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&VA(2===t.length,(function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return Jn(e,[{key:"save",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:r},null!=t.signature&&(a.signature=t.signature),null!=t.userDefinedMetadata&&(a.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(a.modelInitializer=t.modelInitializer),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=13,this.fetch(this.path,n);case 13:if(!(i=e.sent).ok){e.next=18;break}return e.abrupt("return",{modelArtifactsInfo:XD(t),responses:[i]});case 18:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."));case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=ns(es().mark((function e(){var t,n,r,a,i,o,s,u,c,l,h,d,p,v,m,g;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(t.status,". Please verify this URL points to ")+"the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 16:if(a=n.modelTopology,i=n.weightsManifest,o=n.generatedBy,s=n.convertedBy,u=n.format,c=n.signature,l=n.userDefinedMetadata,null!=a||null!=i){e.next=25;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");case 25:if(null==i){e.next=32;break}return e.next=28,this.loadWeights(i);case 28:p=e.sent,v=f(p,2),h=v[0],d=v[1];case 32:return m={modelTopology:a,weightSpecs:h,weightData:d,generatedBy:o,convertedBy:s,format:u},null!=c&&(m.signature=c),null!=l&&(m.userDefinedMetadata=l),(g=n.modelInitializer)&&(m.modelInitializer=g),e.abrupt("return",m);case 38:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,s,u,c,l,h,d,p,v,m,g,y,b,x,k;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=FP(n),a=f(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=[],c=al(t);try{for(c.s();!(l=c.n()).done;)h=l.value,u.push.apply(u,Tt(h.weights))}catch($Pe){c.e($Pe)}finally{c.f()}d=[],p=[],v=al(t);try{for(v.s();!(m=v.n()).done;){g=m.value,y=al(g.paths);try{for(y.s();!(b=y.n()).done;)x=b.value,null!=this.weightUrlConverter?p.push(this.weightUrlConverter(x)):d.push(s+x+o)}catch($Pe){y.e($Pe)}finally{y.f()}}}catch($Pe){v.e($Pe)}finally{v.f()}if(!this.weightUrlConverter){e.next=19;break}return e.t0=d.push,e.t1=d,e.t2=Tt,e.next=16,Promise.all(p);case 16:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 19:return e.next=21,PP(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 21:return k=e.sent,e.abrupt("return",[u,HD(k)]);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function FP(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function zP(e){return null!=e.match(LP.URL_SCHEME_REGEX)}LP.URL_SCHEME_REGEX=/^https?:\/\//;var BP=function(e,t){if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return zP(e)})):zP(e))?UP(e,t):null};function UP(e,t){return new LP(e,t)}KD.registerSaveRouter(BP),KD.registerLoadRouter(BP);function VP(e){for(var t=[],n=0;e>0;)1&e&&t.push(n),e/=2,n++;return t}function WP(e,t,n){return n<=e?n:n-(t-1)}function GP(e,t){for(var n=[],r=0;r<e;r++)n.push(t+r);return n}function jP(e,t,n,r,a,i,o,s,u){var c=e.length,l=new Array(c),h=new Array(c),f=new Array(c);if(t.length&&n>0){var d=t[0],p=n+1;l=function(e,t,n,r,a){for(var i=Tt(a),o=GP(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=0;else{var u=WP(t,n,s),c=r[u];e&1<<u&&(c=0),i[s]=c}return i}(o,d,p,r,e),h=function(e,t,n,r,a){for(var i=Tt(a),o=GP(n,t),s=0;s<i.length;s++)if(o.indexOf(s)>-1)i[s]=Number.MAX_SAFE_INTEGER;else{var u=WP(t,n,s),c=r[u];e&1<<u&&(c=Number.MAX_SAFE_INTEGER),i[s]=c}for(var l=0;l<i.length;l++){var h=a[l];i[l]<0&&(i[l]+=h),i[l]=UA(0,i[l],a[l])}return i}(s,d,p,a,e),f=function(e,t,n,r){for(var a=Tt(e),i=a.length;i<r.length;i++)a.push(1);for(var o=0;o<n;o++)0===o?a[t]=1:(a.splice(t,0,1),a.pop());return a}(i,d,p,e)}else for(var v=0;v<c;v++)l[v]=HP(o,r,i,e,v,u),h[v]=XP(s,a,i,e,v,u),f[v]=qP(i,v,u);return{begin:l,end:h,strides:f}}function qP(e,t,n){var r=e[t];return(n&1<<t||null==r)&&(r=1),r}function HP(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=UA(0,o,u-1)}function XP(e,t,n,r,a,i){var o=t[a],s=n[a]||1;(e&1<<a||i&1<<a||null==o)&&(o=s>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);var u=r[a];return o<0&&(o+=u),o=s>0?UA(0,o,u):UA(-1,o,u-1)}function KP(e,t,n){var r,a,i=e.shape.length;return(r="number"===typeof t?[t].concat(Tt(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){VA(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"===typeof n?[n].concat(Tt(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(VA(-1===t,(function(){return"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}function YP(e,t,n,r,a,i,o,s,u){var c=t.slice(),l=n.slice(),h=r;null==r&&(h=new Array(c.length));var f=VP(o);if(f.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==o&&0!==s)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==o&&0!==u)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");var d=e.length-c.length,p=VP(s),v=e.slice();p.forEach((function(e){c[e]=0,l[e]=1,v.splice(e,0,1)}));var m=jP(v,f,d,c,l,h,a,i,o),g=m.begin,y=m.end,b=m.strides;c=g,l=y,h=b;var x=VP(u);x.forEach((function(e){l[e]=c[e]+1,h[e]=1}));var k=function(e,t,n){for(var r=[],a=0;a<e.length;a++)r[a]=Math.ceil((t[a]-e[a])/n[a]);return r}(c,l,h),w=k.filter((function(e,t){return-1===x.indexOf(t)})),_=h.every((function(e){return 1===e}));return{nonStrided:_,$begin:c,$end:l,$strides:h,size:k,newShape:v,outShape:w}}var QP=EP({complex_:function(e,t){var n=CP(e,"real","complex"),r=CP(t,"imag","complex");WA(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:n,imag:r};return BD.runKernel(jM,a)}});var ZP=EP({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;VA(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=TP(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return AP(n[0]);var r=n,a={axis:t};return BD.runKernel(HM,r,a)}});var JP=EP({imag_:function(e){var t={input:CP(e,"input","imag")};return BD.runKernel(IN,t)}});var $P=EP({real_:function(e){var t={input:CP(e,"input","real")};return BD.runKernel(dR,t)}});var eO=EP({reshape_:function(e,t){var n={x:CP(e,"x","reshape","string_or_numeric")},r={shape:t};return BD.runKernel(mR,n,r)}});var tO=EP({slice_:function(e,t,n){var r=CP(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return BD.runKernel(ER,a,i)}});var nO=EP({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=CP(e,"x","split"),a={x:r},i={numOrSizeSplits:t,axis:n};return BD.runKernel(LR,a,i)}});function rO(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=rO(e,"float32"),r=rO(e,"float32");return QP(n,r)}var a=sM(qA(e),t);return BD.makeTensor(a,e,t)}var aO=EP({zerosLike_:function(e){var t={x:CP(e,"x","zerosLike")};return BD.runKernel(QR,t)}});var iO=EP({fft_:function(e){VA("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return BD.runKernel("FFT",t)}});var oO=EP({rfft_:function(e,t){VA("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=tO(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=ZP([e,rO(s)],e.shape.length-1),r=t}else n=e;var u=aO(n),c=eO(QP(n,u),[a,r]),l=iO(c),h=Math.floor(r/2)+1,f=$P(l),d=JP(l),p=nO(f,[h,r-h],f.shape.length-1),v=nO(d,[h,r-h],d.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=h,eO(QP(p[0],v[0]),m)}});var sO=EP({ifft_:function(e){VA("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return BD.runKernel(EN,t)}});var uO=EP({mul_:function(e,t){var n=CP(e,"a","mul"),r=CP(t,"b","mul"),a=f(RD(n,r),2),i={a:n=a[0],b:r=a[1]};return BD.runKernel($N,i)}});var cO=EP({reverse_:function(e,t){var n={x:CP(e,"x","reverse")},r={dims:t};return BD.runKernel(wR,n,r)}});function lO(e,t,n,r){if(null==r&&(r=tM(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!$A(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){cM(t);var a=qA(t),i=qA(n);VA(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==qA(t.slice(o));VA(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). ")}))}}return $A(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?mD(e,r):jA(e,[],!0),BD.makeTensor(e,t,r)}function hO(e,t){if(($A(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&$A(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return lO(e,[],[],t)}var fO=EP({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=eO(e,[r,n]);t=sO(a)}else{var i=[r,2*(n-1)],o=eO($P(e),[r,n]),s=eO(JP(e),[r,n]),u=cO(tO(o,[0,1],[r,n-2]),1),c=uO(cO(tO(s,[0,1],[r,n-2]),1),hO(-1)),l=ZP([o,u],1),h=ZP([s,c],1),f=eO(QP(l,h),[i[0],i[1]]);t=sO(f)}if(t=$P(t),3===e.rank&&0!==e.shape[0]){var d=t,p=e.shape[0];t=eO(t,[p,t.shape[0]/p,t.shape[1]]),d.dispose()}return t}});function dO(e,t){GA(e);var n=wP(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return lO(e,null,n,t)}function pO(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function vO(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return dO(a,"float32")}EP({hammingWindow_:function(e){return vO(e,.54,.46)}});var mO=EP({hannWindow_:function(e){return vO(e,.5,.5)}});function gO(e,t,n){var r={shape:e,value:t,dtype:n};return BD.runKernel(yN,{},r)}function yO(e,t,n){if(GA(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=wP(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return lO(e,t,r,n)}var bO=EP({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(tO(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=ZP([tO(e,i,t-s),gO([s],a)]);o.push(u),i+=n}return 0===o.length?yO([],[0,t]):eO(ZP(o),[o.length,t])}});EP({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:mO;null==r&&(r=pO(t));for(var i=bO(e,t,n),o=uO(i,a(t)),s=[],u=0;u<i.shape[0];u++)s.push(oO(tO(o,[u,0],[1,t]),r));return ZP(s)}});EP({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=CP(e,"image","cropAndResize"),s=CP(t,"boxes","cropAndResize","float32"),u=CP(n,"boxInd","cropAndResize","int32"),c=s.shape[0];VA(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),VA(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")})),VA(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")})),VA(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")})),VA(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),VA("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:o,boxes:s,boxInd:u},h={method:a,extrapolationValue:i,cropSize:r},f=BD.runKernel(nN,l,h);return f}});EP({flipLeftRight_:function(e){var t=CP(e,"image","flipLeftRight","float32");VA(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,".")}));var n={image:t};return BD.runKernel(bN,n,{})}});EP({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=CP(e,"image","rotateWithOffset","float32");VA(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r},s=BD.runKernel(JR,i,o);return s}});function xO(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),VA(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),VA(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),VA(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),VA(1===t.rank,(function(){return"scores must be a 1D tensor"})),VA(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(t.shape[0])})),VA(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}EP({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=CP(e,"boxes","nonMaxSuppression"),o=CP(t,"scores","nonMaxSuppression"),s=xO(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return BD.runKernel(nR,{boxes:i,scores:o},u)}});function kO(e,t,n){var r=function(e,t,n){return function(e,t,n){var r=0,a=e.length,i=0,o=!1;for(;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||wO)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function wO(e,t){return e>t?1:e<t?-1:0}function _O(e,t,n,r,a){return TO(e,t,n,r,a,0)}function SO(e,t,n,r,a,i){return TO(e,t,n,r,a,0,!1,i,!0)}function CO(e,t,n,r,a,i){return TO(e,t,n,r,a,i,!0)}function TO(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(AO);for(var h=i>0?-.5/i:0,f=[],d=[];f.length<n&&c.length>0;){var p=c.pop(),v=p.score,m=p.boxIndex,g=p.suppressBeginIndex;if(v<a)break;for(var y=!1,b=f.length-1;b>=g;--b){var x=EO(e,m,f[b]);if(x>=r){y=!0;break}if(p.score=p.score*IO(r,h,x),p.score<=a)break}p.suppressBeginIndex=f.length,y||(p.score===v?(f.push(m),d.push(p.score)):p.score>a&&kO(c,p,AO))}var k=f.length,w=n-k;s&&w>0&&(f.push.apply(f,Tt(new Array(w).fill(0))),d.push.apply(d,Tt(new Array(w).fill(0))));var _={selectedIndices:f};return o&&(_.selectedScores=d),u&&(_.validOutputs=k),_}function EO(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),f=Math.max(a[1],a[3]),d=(s-i)*(u-o),p=(h-c)*(f-l);if(d<=0||p<=0)return 0;var v=Math.max(i,c),m=Math.max(o,l),g=Math.min(s,h),y=Math.min(u,f),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(d+p-b)}function IO(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function AO(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}EP({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=CP(e,"boxes","nonMaxSuppression"),s=CP(t,"scores","nonMaxSuppression"),u=xO(o,s,n,r,a,i),c={boxes:o,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},h=BD.runKernel(aR,c,l);return{selectedIndices:h[0],selectedScores:h[1]}}});EP({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=CP(e,"boxes","nonMaxSuppression"),s=CP(t,"scores","nonMaxSuppression"),u=xO(o,s,n,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,h=u.scoreThreshold,f={boxes:o,scores:s},d={maxOutputSize:c,iouThreshold:l,scoreThreshold:h,padToMaxOutputSize:i},p=BD.runKernel(rR,f,d);return{selectedIndices:p[0],validOutputs:p[1]}}});var MO=EP({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=CP(e,"images","resizeBilinear");VA(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),VA(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")})),VA(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=eO(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Mb(t);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=BD.runKernel(bR,s,u);return o?eO(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var NO=EP({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=CP(e,"images","resizeNearestNeighbor");VA(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),VA(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")})),VA("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),VA(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=eO(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Mb(t);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=BD.runKernel(gR,s,u);return o?eO(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});function RO(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r}function DO(e,t){for(var n=[],r=0;r<t.length;r++){var a=e[e.length-r-1],i=t.length-r-1,o=t[i];(null==a||1===a&&o>1)&&n.unshift(i)}return n}function PO(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(s)}n.unshift(i)}}return n}var OO=EP({greaterEqual_:function(e,t){var n=CP(e,"a","greaterEqual"),r=CP(t,"b","greaterEqual"),a=f(RD(n,r),2);n=a[0],r=a[1],PO(n.shape,r.shape);var i={a:n,b:r};return BD.runKernel(CN,i)}});var LO=EP({lessEqual_:function(e,t){var n=CP(e,"a","lessEqual"),r=CP(t,"b","lessEqual"),a=f(RD(n,r),2);n=a[0],r=a[1],PO(n.shape,r.shape);var i={a:n,b:r};return BD.runKernel(PN,i)}});var FO=EP({logicalAnd_:function(e,t){var n=CP(e,"a","logicalAnd","bool"),r=CP(t,"b","logicalAnd","bool");PO(n.shape,r.shape);var a={a:n,b:r};return BD.runKernel(FN,a)}});function zO(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return BD.runKernel(fR,{},a)}var BO=EP({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=TP(e,"tensors","stack","string_or_numeric");VA(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&VA(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return BD.runKernel(sR,r,a)}});var UO=EP({sub_:function(e,t){var n=CP(e,"a","sub"),r=CP(t,"b","sub"),a=f(RD(n,r),2),i={a:n=a[0],b:r=a[1]};return BD.runKernel(UR,i)}});var VO=EP({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=CP(e,"x","unstack","string_or_numeric");VA(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return BD.runKernel(KR,r,a)}});var WO=EP({broadcastTo_:function(e,t){var n=CP(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!==0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=eO(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));var u=o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));if(0===u.length)return AP(n);var c={x:n},l={reps:o};return BD.runKernel(jR,c,l)}});var GO=EP({where_:function(e,t,n){var r=CP(t,"a","where"),a=CP(n,"b","where"),i=CP(e,"condition","where","bool"),o=PO(r.shape,a.shape),s=WO(r,o),u=WO(a,o);1===i.rank&&VA(i.shape[0]===r.shape[0],(function(){return"The first dimension of `a` must match the size of `condition`."})),1!==i.rank&&WA(i.shape,u.shape,"Error in where: ");var c={condition:i,t:s,e:u};return BD.runKernel(CR,c)}});EP({bandPart_:function(e,t,n){VA(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),VA(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=CP(e,"a","bandPart");VA(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,i=f(r.shape.slice(-2),2),o=i[0],s=i[1];if(!(t<=o))throw new Error("bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(o,")."));if(!(n<=s))throw new Error("bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(s,")."));t<0&&(t=o),n<0&&(n=s);var u=eO(zO(0,o,1,"int32"),[-1,1]),c=zO(0,s,1,"int32"),l=UO(u,c),h=FO(LO(l,hO(+t,"int32")),OO(l,hO(-n,"int32"))),d=rO([o,s],r.dtype);return eO(BO(VO(eO(r,[-1,o,s])).map((function(e){return GO(h,e,d)}))),a)}});var jO=EP({floorDiv_:function(e,t){var n=CP(e,"a","floorDiv"),r=CP(t,"b","floorDiv"),a=f(RD(n,r),2),i={a:n=a[0],b:r=a[1]};return BD.runKernel(kN,i)}});var qO=EP({div_:function(e,t){var n=CP(e,"a","div"),r=CP(t,"b","div"),a=f(RD(n,r),2);if(n=a[0],r=a[1],"int32"===n.dtype&&"int32"===r.dtype)return jO(n,r);var i={a:n,b:r};return BD.runKernel(lN,i,{})}});var HO=EP({abs_:function(e){var t=CP(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return BD.runKernel(qM,n)}var r={x:t};return BD.runKernel(kM,r)}});function XO(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function KO(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}function YO(e,t){return function(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}(e,t.map((function(e){return 1})),t)}function QO(e,t,n){VA(XO(t,n),(function(){return"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input.")}))}function ZO(e,t){if(XO(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function JO(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function $O(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var eL=EP({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=CP(e,"x","max"),a={x:r},i={reductionIndices:t,keepDims:n};return BD.runKernel(WN,a,i)}});var tL=EP({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=CP(e,"x","min"),a={x:r},i={axis:t,keepDims:n};return BD.runKernel(YN,a,i)}});var nL=EP({pow_:function(e,t){var n=CP(e,"base","pow"),r=CP(t,"exp","pow"),a=f(RD(n,r),2),i={a:n=a[0],b:r=a[1]};return BD.runKernel(cR,i)}});var rL=EP({sqrt_:function(e){var t={x:CP(e,"x","sqrt")};return BD.runKernel(DR,t)}});var aL=EP({square_:function(e){var t=CP(e,"x","square");return BD.runKernel("Square",{x:t},{})}});var iL=EP({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=CP(e,"x","sum");"bool"===r.dtype&&(r=IP(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return BD.runKernel(PR,a,i)}});function oL(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return HO(e);if(1!==e.rank&&null===n)return oL(eO(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return iL(HO(e),n);if(t===1/0)return eL(HO(e),n);if(t===-1/0)return tL(HO(e),n);if("euclidean"===t||2===t)return rL(iL(nL(HO(e),hO(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return eL(iL(HO(e),n[0]),n[1]-1);if(t===1/0)return eL(iL(HO(e),n[1]),n[0]);if(t===-1/0)return tL(iL(HO(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return rL(iL(aL(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var sL=EP({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=oL(e=CP(e,"x","norm"),t,n),i=a.shape;if(r){var o=YA(n,e.shape);i=YO(a.shape,o)}return eO(a,i)}});var uL=EP({squeeze_:function(e,t){var n=CP(e,"x","squeeze");return eO(n,function(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:YA(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}(n.shape,t).newShape)}});EP({gramSchmidt_:function(e){var t;Array.isArray(e)?function(){t=!1,VA(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){VA(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}():(t=!0,e=nO(e,e.shape[0],0).map((function(e){return uL(e,[0])}))),VA(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],").")}));for(var n=[],r=e,a=function(e){n.push(BD.tidy((function(){var t=r[e];if(e>0)for(var a=0;a<e;++a){var i=uO(iL(uO(n[a],t)),n[a]);t=UO(t,i)}return qO(t,sL(t,"euclidean"))})))},i=0;i<e.length;++i)a(i);return t?BO(n,0):n}});function cL(e){mM().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function lL(){return BD}function hL(e){DD(e).forEach((function(e){return e.dispose()}))}!function(e){e}(cL);var fL=EP({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=CP(e,"x","expandDims","string_or_numeric");VA(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return BD.runKernel(mN,r,a)}});var dL=EP({tile_:function(e,t){var n=CP(e,"x","tile","string_or_numeric");VA(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,".")}));var r={x:n},a={reps:t};return BD.runKernel(jR,r,a)}});var pL=EP({eye_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";null==t&&(t=e);for(var a=kP([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=eO(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return dL(fL(s,0),[n[0],1,1]);if(2===n.length)return dL(fL(fL(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return dL(fL(fL(fL(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});var vL=EP({greater_:function(e,t){var n=CP(e,"a","greater"),r=CP(t,"b","greater"),a=f(RD(n,r),2);n=a[0],r=a[1],PO(n.shape,r.shape);var i={a:n,b:r};return BD.runKernel(SN,i)}});var mL=EP({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=CP(e,"a","matMul"),i=CP(t,"b","matMul"),o=RD(a,i),s=f(o,2),u={a:a=s[0],b:i=s[1]},c={transposeA:n,transposeB:r};return BD.runKernel(BM,u,c)}});var gL=EP({neg_:function(e){var t={x:CP(e,"x","neg")};return BD.runKernel(eR,t)}});var yL=EP({transpose_:function(e,t){var n=CP(e,"x","transpose");if(null==t&&(t=n.shape.map((function(e,t){return t})).reverse()),VA(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of perm ".concat(t,".")})),t.forEach((function(e){VA(e>=0&&e<n.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(n.rank-1)+" but got ".concat(t)}))})),n.rank<=1)return n.clone();var r={x:n},a={perm:t};return BD.runKernel(HR,r,a)}});function bL(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return BD.tidy((function(){VA(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=pL(n),i=AP(e),o=yO([[1]],[1,1]),s=AP(o),u=n>=r?r:n,c=function(e){var t=i,u=s,c=a,l=f(BD.tidy((function(){var t=tO(i,[e,e],[n-e,1]),u=sL(t),c=tO(i,[e,e],[1,1]),l=GO(vL(c,0),yO([[-1]]),yO([[1]])),h=UO(c,uO(l,u)),f=qO(t,h);s=1===f.shape[0]?AP(o):ZP([o,tO(f,[1,0],[f.shape[0]-1,f.shape[1]])],0);var d=gL(qO(mL(l,h),u)),p=tO(i,[e,0],[n-e,r]),v=uO(d,s),m=yL(s);if(0===e)i=UO(p,mL(v,mL(m,p)));else{var g=UO(p,mL(v,mL(m,p)));i=ZP([tO(i,[0,0],[e,r]),g],0)}var y=yL(v),b=tO(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=UO(b,mL(mL(b,s),y));else{var x=UO(b,mL(mL(b,s),y));a=ZP([tO(a,[0,0],[n,e]),x],1)}return[s,i,a]})),3);s=l[0],i=l[1],a=l[2],hL([t,u,c])},l=0;l<u;++l)c(l);return!t&&n>r&&(a=tO(a,[0,0],[n,r]),i=tO(i,[0,0],[r,r])),[a,i]}))}var xL;EP({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(VA(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return bL(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=VO(eO(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];r.forEach((function(e){var n=f(bL(e,t),2),r=n[0],o=n[1];a.push(r),i.push(o)}));var o=eO(BO(a,0),e.shape),s=eO(BO(i,0),e.shape);return[o,s]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(xL||(xL={}));var kL=EP({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=CP(e,"x","mean"),a={x:r},i={axis:t,keepDims:n};return BD.runKernel(KN,a,i)}});var wL=EP({notEqual_:function(e,t){var n=CP(e,"a","notEqual"),r=CP(t,"b","notEqual"),a=f(RD(n,r),2);n=a[0],r=a[1],PO(n.shape,r.shape);var i={a:n,b:r};return BD.runKernel(tR,i)}});function _L(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=_L(e,"float32"),r=rO(e,"float32");return QP(n,r)}var a=oM(qA(e),t);return BD.makeTensor(a,e,t)}var SL=EP({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:xL.SUM_BY_NONZERO_WEIGHTS,r=CP(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=CP(t,"weights","computeWeightedLoss"));var i=null==a?r:uO(r,a);if(n===xL.NONE)return i;if(n===xL.SUM)return iL(i);if(n===xL.MEAN){if(null==a)return kL(i);var o=r.size/a.size,s=qO(iL(i),iL(a));return o>1?qO(s,hO(o)):s}if(n===xL.SUM_BY_NONZERO_WEIGHTS){if(null==a)return qO(iL(i),hO(r.size));var u=uO(a,_L(r.shape)),c=IP(iL(wL(u,hO(0))),"float32");return qO(iL(i),c)}throw Error("Unknown reduction: ".concat(n))}});EP({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:xL.SUM_BY_NONZERO_WEIGHTS,a=CP(e,"labels","absoluteDifference"),i=CP(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=CP(n,"weights","absoluteDifference")),WA(a.shape,i.shape,"Error in absoluteDifference: ");var s=HO(UO(a,i));return SL(s,o,r)}});EP({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xL.SUM_BY_NONZERO_WEIGHTS,i=CP(e,"labels","cosineDistance"),o=CP(t,"predictions","cosineDistance"),s=null;null!=r&&(s=CP(r,"weights","cosineDistance")),WA(i.shape,o.shape,"Error in cosineDistance: ");var u=hO(1),c=UO(u,iL(uO(i,o),n,!0));return SL(c,s,a)}});var CL=EP({relu_:function(e){var t={x:CP(e,"x","relu")};return BD.runKernel(vR,t)}});EP({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:xL.SUM_BY_NONZERO_WEIGHTS,a=CP(e,"labels","hingeLoss"),i=CP(t,"predictions","hingeLoss"),o=null;null!=n&&(o=CP(n,"weights","hingeLoss")),WA(a.shape,i.shape,"Error in hingeLoss: ");var s=hO(1);a=UO(uO(hO(2),a),s);var u=CL(UO(s,uO(a,i)));return SL(u,o,r)}});var TL=EP({add_:function(e,t){var n=CP(e,"a","add"),r=CP(t,"b","add"),a=f(RD(n,r),2),i={a:n=a[0],b:r=a[1]};return BD.runKernel(SM,i)}});var EL=EP({minimum_:function(e,t){var n=CP(e,"a","minimum"),r=CP(t,"b","minimum"),a=f(RD(n,r),2);n=a[0],r=a[1],"bool"===n.dtype&&(n=IP(n,"int32"),r=IP(r,"int32")),PO(n.shape,r.shape);var i={a:n,b:r};return BD.runKernel(QN,i)}});EP({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xL.SUM_BY_NONZERO_WEIGHTS,i=CP(e,"labels","huberLoss"),o=CP(t,"predictions","huberLoss"),s=null;null!=n&&(s=CP(n,"weights","huberLoss")),WA(i.shape,o.shape,"Error in huberLoss: ");var u=hO(r),c=HO(UO(o,i)),l=EL(c,u),h=UO(c,l),f=TL(uO(hO(.5),aL(l)),uO(u,h));return SL(f,s,a)}});var IL=EP({log_:function(e){var t={x:CP(e,"x","log")};return BD.runKernel(ON,t)}});EP({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xL.SUM_BY_NONZERO_WEIGHTS,i=CP(e,"labels","logLoss"),o=CP(t,"predictions","logLoss"),s=null;null!=n&&(s=CP(n,"weights","logLoss")),WA(i.shape,o.shape,"Error in logLoss: ");var u=hO(1),c=hO(r),l=gL(uO(i,IL(TL(o,c)))),h=uO(UO(u,i),IL(TL(UO(u,o),c))),f=UO(l,h);return SL(f,s,a)}});var AL=EP({squaredDifference_:function(e,t){var n=CP(e,"a","squaredDifference"),r=CP(t,"b","squaredDifference"),a=f(RD(n,r),2);n=a[0],r=a[1],PO(n.shape,r.shape);var i={a:n,b:r};return BD.runKernel(zR,i,{})}});EP({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:xL.SUM_BY_NONZERO_WEIGHTS,a=CP(e,"labels","meanSquaredError"),i=CP(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=CP(n,"weights","meanSquaredError")),WA(a.shape,i.shape,"Error in meanSquaredError: ");var s=AL(a,i);return SL(s,o,r)}});var ML=EP({exp_:function(e){var t={x:CP(e,"x","exp")};return BD.runKernel(vN,t)}});var NL=EP({log1p_:function(e){var t={x:CP(e,"x","log1p")};return BD.runKernel(LN,t)}});function RL(e,t){var n=CP(e,"labels","sigmoidCrossEntropyWithLogits"),r=CP(t,"logits","sigmoidCrossEntropyWithLogits");WA(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=CL(r),i=uO(r,n),o=NL(ML(gL(HO(r))));return TL(UO(a,i),o)}EP({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xL.SUM_BY_NONZERO_WEIGHTS,i=CP(e,"multiClassLabels","sigmoidCrossEntropy"),o=CP(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=CP(n,"weights","sigmoidCrossEntropy")),WA(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=hO(r),c=hO(1),l=hO(.5);i=TL(uO(i,UO(c,u)),uO(l,u))}var h=RL(i,o);return SL(h,s,a)}});function DL(e){return BD.customGrad(e)}var PL=EP({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=CP(e,"x","logSumExp"),a=YA(t,r.shape),i=eL(r,a,!0),o=UO(r,i),s=ML(o),u=iL(s,a),c=IL(u),l=TL(eO(i,c.shape),c);if(n){var h=YO(l.shape,a);return eO(l,h)}return l}});function OL(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(t.rank," ")+"and dim was ".concat(n));var r=DL((function(e,t,r){var a=PL(t,[n],!0),i=UO(IP(t,"float32"),a);r([e,i]);var o=gL(uO(i,e));return{value:iL(o,[n]),gradFunc:function(e,t){var r=f(t,2),a=r[0],i=r[1],o=YO(e.shape,[n]);return[uO(eO(e,o),UO(IP(a,"float32"),ML(i))),uO(eO(e,o),UO(ML(i),IP(a,"float32")))]}}}));return r(e,t)}EP({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:xL.SUM_BY_NONZERO_WEIGHTS,i=CP(e,"onehotLabels","softmaxCrossEntropy"),o=CP(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=CP(n,"weights","softmaxCrossEntropy")),WA(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=hO(r),c=hO(1),l=hO(i.shape[1]);i=TL(uO(i,UO(c,u)),qO(u,l))}var h=OL(i,o);return SL(h,s,a)}});function LL(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function FL(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0,o=e[3],s=[].concat(Tt(t),[o]),u=ZL(a);return UL(e,s,n,i,r,null,null,u)}function zL(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=GL(t),c=f(u,2),l=c[0],h=c[1];if("channelsLast"===s)o=[l,h,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));o=[l,h,e[1],e[1]]}return UL(e,o,n,r,a,i,!1,s)}function BL(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=jL(t),l=f(c,3),h=l[0],d=l[1],p=l[2];if("NDHWC"===u)s="channelsLast",o=[h,d,p,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat ".concat(u));s="channelsFirst",o=[h,d,p,e[1],e[1]]}return VL(e,o,n,r,a,!1,s,i)}function UL(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,h=-1;if("channelsLast"===s){var d=f(e,4);u=d[0],c=d[1],l=d[2],h=d[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var p=f(e,4);u=p[0],h=p[1],c=p[2],l=p[3]}var v,m=f(t,4),g=m[0],y=m[1],b=m[3],x=GL(n),k=f(x,2),w=k[0],_=k[1],S=GL(r),C=f(S,2),T=C[0],E=C[1],I=qL(g,T),A=qL(y,E),M=HL(a,c,l,w,_,I,A,i,s),N=M.padInfo,R=M.outHeight,D=M.outWidth,P=o?b*h:b;return"channelsFirst"===s?v=[u,P,R,D]:"channelsLast"===s&&(v=[u,R,D,P]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:h,outHeight:R,outWidth:D,outChannels:P,padInfo:N,strideHeight:w,strideWidth:_,filterHeight:g,filterWidth:y,effectiveFilterHeight:I,effectiveFilterWidth:A,dilationHeight:T,dilationWidth:E,inShape:e,outShape:v,filterShape:t}}function VL(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,l=-1,h=-1,d=-1;if("channelsLast"===o){var p=f(e,5);u=p[0],c=p[1],l=p[2],h=p[3],d=p[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));var v=f(e,5);u=v[0],d=v[1],c=v[2],l=v[3],h=v[4]}var m,g=f(t,5),y=g[0],b=g[1],x=g[2],k=g[4],w=jL(n),_=f(w,3),S=_[0],C=_[1],T=_[2],E=jL(r),I=f(E,3),A=I[0],M=I[1],N=I[2],R=qL(y,A),D=qL(b,M),P=qL(x,N),O=XL(a,c,l,h,S,C,T,R,D,P,s),L=O.padInfo,F=O.outDepth,z=O.outHeight,B=O.outWidth,U=i?k*d:k;return"channelsFirst"===o?m=[u,U,F,z,B]:"channelsLast"===o&&(m=[u,F,z,B,U]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:h,inChannels:d,outDepth:F,outHeight:z,outWidth:B,outChannels:U,padInfo:L,strideDepth:S,strideHeight:C,strideWidth:T,filterDepth:y,filterHeight:b,filterWidth:x,effectiveFilterDepth:R,effectiveFilterHeight:D,effectiveFilterWidth:P,dilationDepth:A,dilationHeight:M,dilationWidth:N,inShape:e,outShape:m,filterShape:t}}function WL(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=qL(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function GL(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function jL(e){return"number"===typeof e?[e,e,e]:e}function qL(e,t){return t<=1?e:e+(e-1)*(t-1)}function HL(e,t,n,r,a,i,o,s,u){var c,l,h;if("number"===typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,a){null==r&&(r=WL(e,t,n));var i=e[0],o=e[1];return[KL((i-t+2*r)/n+1,a),KL((o-t+2*r)/n+1,a)]}([t,n],i,r,e,s);l=f[0],h=f[1]}else if("same"===e){l=Math.ceil(t/r),h=Math.ceil(n/a);var d=Math.max(0,(l-1)*r+i-t),p=Math.max(0,(h-1)*a+o-n),v=Math.floor(d/2),m=d-v,g=Math.floor(p/2);c={top:v,bottom:m,left:g,right:p-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),h=Math.ceil((n-o+1)/a);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],x="channelsLast"===u?e[2][0]:e[3][0],k="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:x,right:k,type:0===y&&0===b&&0===x&&0===k?"VALID":"EXPLICIT"},l=KL((t-i+y+b)/r+1,s),h=KL((n-o+x+k)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:h}}function XL(e,t,n,r,a,i,o,s,u,c,l){var h,f,d,p;if("number"===typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var v=function(e,t,n,r,a,i){null==a&&(a=WL(e,t,r));var o=e[0],s=e[1],u=e[2];return[KL((o-t+2*a)/r+1,i),KL((s-t+2*a)/r+1,i),KL((u-t+2*a)/r+1,i),n]}([t,n,r,1],s,1,a,e,l);f=v[0],d=v[1],p=v[2]}else if("same"===e){var m=((f=Math.ceil(t/a))-1)*a+s-t,g=((d=Math.ceil(n/i))-1)*i+u-n,y=((p=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(m/2),x=m-b,k=Math.floor(g/2),w=g-k,_=Math.floor(y/2);h={top:k,bottom:w,left:_,right:y-_,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/a),d=Math.ceil((n-u+1)/i),p=Math.ceil((r-c+1)/o)}return{padInfo:h,outDepth:f,outHeight:d,outWidth:p}}function KL(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function YL(e){var t=f(GL(e),3),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function QL(e,t){return YL(e)||YL(t)}function ZL(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}var JL=EP({elu_:function(e){var t={x:CP(e,"x","elu")};return BD.runKernel(hN,t)}});var $L=EP({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n=CP(e,"x","leakyRelu"),r={x:n},a={alpha:t};return BD.runKernel(RN,r,a)}});var eF=EP({prelu_:function(e,t){var n={x:CP(e,"x","prelu"),alpha:CP(t,"alpha","prelu")};return BD.runKernel(lR,n)}});var tF=EP({relu6_:function(e){var t={x:CP(e,"x","relu6")};return BD.runKernel(kR,t)}});var nF=EP({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=CP(e,"x","step"),r={x:n},a={alpha:t};return BD.runKernel(ZR,r,a)}});function rF(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function aF(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var i=[],o=[],s=1;s<e;++s)s>=2*t+1||s%2===1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function iF(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function oF(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:qA(t.shape)/u,sliceSize:o,strides:[].concat(Tt(rM(n.slice(0,a))),[1]),outputSize:qA(n)}}var sF=1.7580993408473768,uF=1.0507009873554805;function cF(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}function lF(e,t){return{real:e[2*t],imag:e[2*t+1]}}function hF(e,t,n,r){e[2*r]=t,e[2*r+1]=n}function fF(e,t,n){var r=(n?2:-2)*Math.PI*(e/t);return{real:Math.cos(r),imag:Math.sin(r)}}function dF(e){try{return e.map((function(e){return bD(e)}))}catch($Pe){throw new Error("Failed to decode encoded string bytes into utf-8, error: ".concat($Pe))}}var pF={kernelName:kM,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return uO(e,nF(IP(n,"float32"),-1))}}}},vF={kernelName:wM,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){var t=aL(IP(n,"float32")),r=rL(UO(hO(1),t));return gL(qO(e,r))}}}},mF={kernelName:_M,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){var t=rL(UO(aL(IP(n,"float32")),1));return qO(e,t)}}}},gF={kernelName:SM,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=PO(r.shape,a.shape);return{a:function(){var t=e,n=DO(r.shape,i);return n.length>0&&(t=iL(t,n)),eO(t,r.shape)},b:function(){var t=e,n=DO(a.shape,i);return n.length>0&&(t=iL(t,n)),eO(t,a.shape)}}}},yF={kernelName:CM,saveAllInputs:!0,gradFunc:function(e,t){var n={};return t.forEach((function(t,r){n[r]=function(){return e.clone()}})),n}},bF={kernelName:IM,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return aO(n)}}}},xF={kernelName:AM,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return aO(n)}}}},kF={kernelName:MM,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return qO(e,rL(UO(hO(1),aL(IP(n,"float32")))))}}}},wF={kernelName:NM,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){var t=rL(TL(hO(1),aL(IP(n,"float32"))));return qO(e,t)}}}},_F={kernelName:PM,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=PO(r.shape,a.shape);return{a:function(){var t=TL(aL(r),aL(a)),n=uO(e,qO(a,t)),o=DO(r.shape,i);return o.length>0&&(n=iL(n,o)),eO(n,r.shape)},b:function(){var t=TL(aL(r),aL(a)),n=gL(uO(e,qO(r,t))),o=DO(a.shape,i);return o.length>0&&(n=iL(n,o)),eO(n,a.shape)}}}},SF={kernelName:RM,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return qO(e,TL(aL(IP(n,"float32")),1))}}}},CF={kernelName:DM,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return qO(e,UO(hO(1),aL(IP(n,"float32"))))}}}};var TF=EP({avgPool3dGrad_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1,1],i=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,s=CP(e,"dy","avgPool3dGrad"),u=CP(t,"input","avgPool3dGrad"),c=s,l=u,h=!1;4===u.rank&&(h=!0,c=eO(s,[1,s.shape[0],s.shape[1],s.shape[2],s.shape[3]]),l=eO(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),VA(5===c.rank,(function(){return"Error in avgPool3dGrad: dy must be rank 5 but got rank "+"".concat(c.rank,".")})),VA(5===l.rank,(function(){return"Error in avgPool3dGrad: input must be rank 5 but got rank "+"".concat(l.rank,".")})),VA(QL(r,a),(function(){return"Error in avgPool3dGrad: Either strides or dilations "+"must be 1. Got strides ".concat(r," and dilations '").concat(a,"'")})),null!=o&&VA(XA(i),(function(){return"Error in avgPool3dGrad: pad must be an integer when "+"using, dimRoundingMode ".concat(o," but got pad ").concat(i,".")}));var f={dy:c,input:l},d={filterSize:n,strides:r,dilations:a,pad:i,dimRoundingMode:o},p=BD.runKernel(zM,f,d);return h?eO(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}}),EF={kernelName:FM,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.filterSize,i=n.strides,o=n.dilations,s=n.pad,u=n.dimRoundingMode,c=null==o?[1,1,1]:o;return{x:function(){return TF(e,r,a,i,c,s,u)}}}};var IF=EP({avgPoolGrad_:function(e,t,n,r,a){var i=CP(e,"dy","avgPoolGrad"),o=CP(t,"input","avgPoolGrad");VA(o.rank===i.rank,(function(){return"Rank of input (".concat(o.rank,") does not match rank of dy (").concat(i.rank,")")}));var s=o,u=i,c=!1;3===o.rank&&(c=!0,s=eO(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=eO(i,[1,i.shape[0],i.shape[1],i.shape[2]])),VA(4===u.rank,(function(){return"Error in avgPoolGrad: dy must be rank 4 but got rank "+"".concat(u.rank,".")})),VA(4===s.rank,(function(){return"Error in avgPoolGrad: input must be rank 4 but got rank "+"".concat(s.rank,".")}));var l={dy:u,input:s},h={filterSize:n,strides:r,pad:a},f=BD.runKernel(LM,l,h);return c?eO(f,[f.shape[1],f.shape[2],f.shape[3]]):f}}),AF={kernelName:OM,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.filterSize,i=n.strides,o=n.pad;return{x:function(){return IF(e,r,a,i,o)}}}},MF={kernelName:BM,inputsToSave:["a","b"],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o=n.transposeA,s=n.transposeB;return o||s?!o&&s?{a:function(){return mL(e,i,!1,!1)},b:function(){return mL(e,a,!0,!1)}}:o&&!s?{a:function(){return mL(i,e,!1,!0)},b:function(){return mL(a,e,!1,!1)}}:{a:function(){return mL(i,e,!0,!0)},b:function(){return mL(e,a,!0,!0)}}:{a:function(){return mL(e,i,!1,!0)},b:function(){return mL(a,e,!0,!1)}}}};var NF=EP({spaceToBatchND_:function(e,t,n){var r=CP(e,"x","spaceToBatchND");VA(r.rank>=1+t.length,(function(){return"input rank ".concat(r.rank," should be > than [blockShape] ").concat(t.length)})),VA(n.length===t.length,(function(){return"paddings.shape[0] ".concat(n.length," must be equal to [blockShape] ").concat(t.length)})),VA(r.shape.reduce((function(e,r,a){return a>0&&a<=t.length?e&&(r+n[a-1][0]+n[a-1][1])%t[a-1]===0:e}),!0),(function(){return"input spatial dimensions ".concat(r.shape.slice(1)," with paddings ").concat(n.toString()," must be divisible by blockShapes ").concat(t.toString())}));var a={x:r},i={blockShape:t,paddings:n};return BD.runKernel(OR,a,i)}}),RF={kernelName:UM,gradFunc:function(e,t,n){var r=n.blockShape,a=n.crops;return{x:function(){return NF(e,r,a)}}}},DF={kernelName:"BroadcastTo",gradFunc:function(e,t,n){for(var r=n,a=r.inputShape,i=r.shape,o=Array.from(i),s=a.length-1;s>=0;s--)if(a[s]===i[s])o[s]=1;else if(1!==a[s])throw new Error("broadcastTo(): [".concat(a,"] cannot be broadcast to [").concat(i,"]."));for(var u=[],c=0;c<o.length;c++)o[c]>1&&u.push(c);return{x:function(){return iL(e,u,!0)}}}},PF={kernelName:VM,gradFunc:function(e){return{x:function(){return e.clone()}}}},OF={kernelName:WM,gradFunc:function(e){return{x:function(){return aO(e)}}}},LF={kernelName:GM,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.clipValueMin,i=n.clipValueMax;return{x:function(){return GO(FO(OO(r,a),LO(r,i)),e,aO(e))}}}},FF={kernelName:qM,inputsToSave:["x"],gradFunc:pF.gradFunc},zF={kernelName:HM,saveAllInputs:!0,gradFunc:function(e,t,n){var r=t.map((function(e){return e.shape})),a=YA(n.axis,t[0].shape)[0],i=r.map((function(e){return e[a]}));return nO(e,i,a).map((function(e){return function(){return e}}))}};var BF=EP({conv2DBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=eO(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=eO(t,[1,t.shape[0],t.shape[1],t.shape[2]])),VA(4===s.rank,(function(){return"Error in conv2dDerFilter: input must be rank 4, but got shape "+"".concat(s.shape,".")})),VA(4===u.rank,(function(){return"Error in conv2dDerFilter: dy must be rank 4, but got shape "+"".concat(u.shape,".")})),VA(4===n.length,(function(){return"Error in conv2dDerFilter: filterShape must be length 4, but got "+"".concat(n,".")}));var c="NHWC"===i?s.shape[3]:s.shape[1],l="NHWC"===i?u.shape[3]:u.shape[1];VA(c===n[2],(function(){return"Error in conv2dDerFilter: depth of input ".concat(c,") must ")+"match input depth in filter (".concat(n[2],".")})),VA(l===n[3],(function(){return"Error in conv2dDerFilter: depth of dy (".concat(l,") must ")+"match output depth for filter (".concat(n[3],").")})),null!=o&&VA(XA(a),(function(){return"Error in conv2dDerFilter: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(a,".")}));var h={x:s,dy:u},f={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,filterShape:n};return BD.runKernel(KM,h,f)}});var UF=EP({conv2DBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=arguments.length>6?arguments[6]:void 0;VA(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var s=e,u=t,c=!1;3===t.rank&&(c=!0,u=eO(t,[1,t.shape[0],t.shape[1],t.shape[2]]),s=[1,e[0],e[1],e[2]]),VA(4===s.length,(function(){return"Error in conv2dDerInput: inShape must be length 4, but got length "+"".concat(s.length,".")})),VA(4===u.rank,(function(){return"Error in conv2dDerInput: dy must be rank 4, but got "+"rank ".concat(u.rank)})),VA(4===n.rank,(function(){return"Error in conv2dDerInput: filter must be rank 4, but got "+"rank ".concat(n.rank)}));var l="NHWC"===i?s[3]:s[1],h="NHWC"===i?u.shape[3]:u.shape[1];VA(l===n.shape[2],(function(){return"Error in conv2dDerInput: depth of input (".concat(l,") must ")+"match input depth for filter ".concat(n.shape[2],".")})),VA(h===n.shape[3],(function(){return"Error in conv2dDerInput: depth of output (".concat(h,") must ")+"match output depth for filter ".concat(n.shape[3],".")})),null!=o&&VA(XA(a),(function(){return"Error in conv2dDerInput: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(a,".")}));var f={dy:u,filter:n},d={strides:r,pad:a,dataFormat:i,dimRoundingMode:o,inputShape:s},p=BD.runKernel(YM,f,d);return c?eO(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),VF={kernelName:XM,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o=n.dilations,s=n.strides,u=n.pad,c=n.dataFormat;return VA(YL(o),(function(){return"Error in gradient of conv2D: dilation rates greater than 1 "+"are not yet supported in gradients. Got dilations '".concat(o,"'")})),{x:function(){return UF(a.shape,e,i,s,u,c)},filter:function(){return BF(a,e,i.shape,s,u,c)}}}};var WF=EP({conv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=CP(e,"x","conv2d"),u=CP(t,"filter","conv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=eO(s,[1,s.shape[0],s.shape[1],s.shape[2]])),VA(4===c.rank,(function(){return"Error in conv2d: input must be rank 4, but got rank ".concat(c.rank,".")})),VA(4===u.rank,(function(){return"Error in conv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")})),null!=o&&VA(XA(r),(function(){return"Error in conv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")}));var h="NHWC"===a?c.shape[3]:c.shape[1];VA(h===u.shape[2],(function(){return"Error in conv2d: depth of input (".concat(h,") must match ")+"input depth for filter ".concat(u.shape[2],".")})),VA(QL(n,i),(function(){return"Error in conv2D: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(i,"'")}));var f={x:c,filter:u},d={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},p=BD.runKernel(XM,f,d);return l?eO(p,[p.shape[1],p.shape[2],p.shape[3]]):p}}),GF={kernelName:YM,inputsToSave:["dy","filter"],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o=n.strides,s=n.pad,u=n.dataFormat,c=n.dimRoundingMode;return{dy:function(){return WF(e,i,o,s,u,1,c)},filter:function(){return BF(e,a,i.shape,o,s,u,c)}}}};var jF=EP({conv3DBackpropFilter_:function(e,t,n,r,a){var i=e;4===e.rank&&(i=eO(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]));var o=t;4===o.rank&&(o=eO(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]])),VA(5===i.rank,(function(){return"Error in conv3dDerFilter: input must be rank 5, but got shape "+"".concat(i.shape,".")})),VA(5===o.rank,(function(){return"Error in conv3dDerFilter: dy must be rank 5, but got shape "+"".concat(o.shape,".")})),VA(5===n.length,(function(){return"Error in conv3dDerFilter: filterShape must be length 5, but got "+"".concat(n,".")})),VA(i.shape[4]===n[3],(function(){return"Error in conv3dDerFilter: depth of input ".concat(i.shape[4],") must ")+"match input depth in filter (".concat(n[3],".")})),VA(o.shape[4]===n[4],(function(){return"Error in conv3dDerFilter: depth of dy (".concat(o.shape[4],") must ")+"match output depth for filter (".concat(n[4],").")}));var s={x:i,dy:o},u={strides:r,pad:a,filterShape:n};return BD.runKernel(ZM,s,u)}});var qF=EP({conv3DBackpropInput_:function(e,t,n,r,a){VA(e.length===t.rank,(function(){return"Length of inShape "+"(".concat(e.length,") and rank of dy (").concat(t.rank,") must match")}));var i=e,o=t,s=!1;4===t.rank&&(s=!0,o=eO(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]),i=[1,e[0],e[1],e[2],e[3]]);var u=i[4],c=o.shape[4];VA(5===i.length,(function(){return"Error in conv3dDerInput: inShape must be length 5, but got length "+"".concat(i.length,".")})),VA(5===o.rank,(function(){return"Error in conv3dDerInput: dy must be rank 5, but got "+"rank ".concat(o.rank)})),VA(5===n.rank,(function(){return"Error in conv3dDerInput: filter must be rank 5, but got "+"rank ".concat(n.rank)})),VA(u===n.shape[3],(function(){return"Error in conv3dDerInput: depth of input (".concat(u,") must ")+"match input depth for filter ".concat(n.shape[3],".")})),VA(c===n.shape[4],(function(){return"Error in conv3dDerInput: depth of output (".concat(c,") must ")+"match output depth for filter ".concat(n.shape[4],".")}));var l={dy:o,filter:n},h={pad:a,strides:r,inputShape:i},f=BD.runKernel(JM,l,h);return s?eO(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}}),HF={kernelName:QM,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad;VA(YL(r),(function(){return"Error in gradient of conv3D: dilation rates greater than 1 are "+"not yet supported in gradients. Got dilations '".concat(r,"'")}));var o=f(t,2),s=o[0],u=o[1];return{x:function(){return qF(s.shape,e,u,a,i)},filter:function(){return jF(s,e,u.shape,a,i)}}}};var XF=EP({sin_:function(e){var t={x:CP(e,"x","sin")};return BD.runKernel(IR,t)}}),KF={kernelName:$M,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return uO(gL(XF(IP(n,"float32"))),e)}}}};var YF=EP({sinh_:function(e){var t={x:CP(e,"x","sinh")};return BD.runKernel(AR,t)}}),QF={kernelName:eN,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return uO(YF(IP(n,"float32")),e)}}}};var ZF=EP({cumsum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=CP(e,"x","cumsum"),i={x:a},o={axis:t,exclusive:n,reverse:r};return BD.runKernel(tN,i,o)}}),JF={kernelName:tN,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.axis,i=n.exclusive,o=n.reverse;return{x:function(){var t=ZO([a],r.rank),n=ZF(e,a,i,!o);return null!=t&&(n=yL(n,t)),n}}}};var $F=EP({depthwiseConv2dNativeBackpropFilter_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=e;3===e.rank&&(s=eO(e,[1,e.shape[0],e.shape[1],e.shape[2]]));var u=t;3===u.rank&&(u=eO(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={x:s,dy:u},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,filterShape:n};return BD.runKernel(iN,c,l)}});var ez=EP({depthwiseConv2dNativeBackpropInput_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=t,u=!1;3===t.rank&&(u=!0,s=eO(t,[1,t.shape[0],t.shape[1],t.shape[2]]));var c={dy:s,filter:n},l={strides:r,pad:a,dimRoundingMode:o,dilations:i,inputShape:e},h=BD.runKernel(oN,c,l);return u?eO(h,[h.shape[1],h.shape[2],h.shape[3]]):h}}),tz={kernelName:aN,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=n.dilations,a=n.strides,i=n.pad,o=n.dimRoundingMode,s=null==r?[1,1]:r;VA(YL(s),(function(){return"Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations "+"'".concat(s,"'")}));var u=f(t,2),c=u[0],l=u[1];return VA(4===c.rank,(function(){return"Error in gradient of depthwiseConv2dNative: input must be "+"rank 4, but got rank ".concat(c.rank,".")})),VA(4===l.rank,(function(){return"Error in gradient of depthwiseConv2dNative: filter must be "+"rank 4, but got rank ".concat(l.rank,".")})),VA(c.shape[3]===l.shape[2],(function(){return"Error in gradient of depthwiseConv2d: number of input "+"channels (".concat(c.shape[3],") must match the inChannels dimension ")+"in filter ".concat(l.shape[2],".")})),VA(QL(a,s),(function(){return"Error in gradient of depthwiseConv2d: Either strides or "+"dilations must be  1. Got strides ".concat(a," and dilations ")+"'".concat(s,"'.")})),null!=o&&VA(XA(i),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(i,".")})),{x:function(){return ez(c.shape,e,l,a,i,r,o)},filter:function(){return $F(c,e,l.shape,a,i,r,o)}}}},nz={kernelName:sN,inputsToSave:["x","filter"],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o={x:a,filter:i,dy:e},s={x:a,filter:i,dy:e};return{x:function(){return BD.runKernel(uN,o,n)},filter:function(){return BD.runKernel(cN,s,n)}}}},rz={kernelName:hN,outputsToSave:[!0],gradFunc:function(e,t){var n={dy:e,y:f(t,1)[0]};return{x:function(){return BD.runKernel(fN,n)}}}},az={kernelName:dN,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0],r=uO(ML(gL(aL(n))),2/Math.sqrt(Math.PI));return{x:function(){return uO(e,r)}}}},iz={kernelName:vN,outputsToSave:[!0],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return uO(e,n)}}}},oz={kernelName:mN,inputsToSave:["input"],gradFunc:function(e,t){var n=f(t,1)[0];return{input:function(){return eO(e,n.shape)}}}},sz={kernelName:gN,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return uO(e,ML(n))}}}},uz={kernelName:xN,gradFunc:function(e){return{x:function(){return aO(e)}}}},cz={kernelName:kN,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=PO(r.shape,a.shape);return{a:function(){var t=qO(e,IP(a,"float32")),n=DO(r.shape,i);return n.length>0?eO(iL(t,n),r.shape):t},b:function(){var t=uO(e,IP(r,"float32")),n=DO(a.shape,i);n.length>0&&(t=eO(iL(t,n),a.shape));var o=aL(a);return gL(qO(t,IP(o,"float32")))}}}};var lz=EP({rsqrt_:function(e){var t={x:CP(e,"x","rsqrt")};return BD.runKernel(SR,t)}}),hz={kernelName:wN,inputsToSave:["x","mean","variance","scale"],gradFunc:function(e,t,n){var r=n.varianceEpsilon,a=f(t,4),i=a[0],o=a[1],s=a[2],u=a[3],c=null==u?hO(1):u,l=DO(o.shape,i.shape),h=[];if(1===o.rank){for(var d=0;d<i.shape.length-1;++d)h.push(i.shape[d]);h.push(1)}var p=UO(i,o),v=uO(e,c),m=lz(TL(s,hO(r))),g=uO(uO(uO(m,m),m),hO(-.5));return{x:function(){return 1===o.rank?eO(uO(uO(e,dL(eO(m,[1,1,1,o.shape[0]]),h)),c),i.shape):eO(uO(uO(e,m),c),i.shape)},mean:function(){var e=uO(uO(m,hO(-1)),v);return 1===o.rank&&(e=iL(e,l)),eO(e,o.shape)},variance:function(){var e=uO(uO(g,p),v);return 1===o.rank&&(e=iL(e,l)),eO(e,o.shape)},scale:function(){var t=uO(p,m),n=uO(e,t);return 1===o.rank&&(n=iL(n,l)),eO(n,o.shape)},offset:function(){var t=e;return 1===o.rank&&(t=iL(t,l)),eO(t,o.shape)}}}};var fz=EP({unsortedSegmentSum_:function(e,t,n){var r=CP(e,"x","unsortedSegmentSum"),a=CP(t,"segmentIds","unsortedSegmentSum","int32");VA(XA(n),(function(){return"numSegments must be of dtype int"}));var i={x:r,segmentIds:a},o={numSegments:n};return BD.runKernel(YR,i,o)}}),dz={kernelName:_N,inputsToSave:["x","indices"],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o=n.axis,s=YA(o,a.shape)[0];return{x:function(){var t=a.shape,n=i.size,r=t.slice(0,s),u=r.length,c=t.slice(o,t.length).slice(1),l=c.length,h=pz(0,u),f=pz(u+1,u+1+l),d=vz([r,[n],c]),p=eO(e,d),v=eO(i,[n]),m=vz([[u],h,f]),g=yL(p,m),y=fz(g,v,a.shape[s]),b=JO(m);return y=yL(y,b)},indices:function(){return i}}}};function pz(e,t){for(var n=[],r=e;r<t;++r)n.push(r);return n}function vz(e){for(var t=[],n=0;n<e.length;++n)for(var r=0;r<e[n].length;++r)t.push(e[n][r]);return t}var mz={kernelName:CN,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1];return{a:function(){return aO(r)},b:function(){return aO(a)}}}},gz={kernelName:TN,gradFunc:function(e){return{x:function(){return IP(e,"float32")}}}},yz={kernelName:AN,gradFunc:function(e){return{x:function(){return aO(e)}}}},bz={kernelName:MN,gradFunc:function(e){return{x:function(){return aO(e)}}}},xz={kernelName:NN,gradFunc:function(e){return{x:function(){return aO(e)}}}},kz={kernelName:RN,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.alpha,i=vL(r,0);return{x:function(){return GO(i,e,uO(e,a))}}}},wz={kernelName:LN,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return qO(e,TL(n,1))}}}},_z={kernelName:ON,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return qO(e,IP(n,"float32"))}}}},Sz={kernelName:"LogSoftmax",inputsToSave:[],outputsToSave:[!0],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.axis;return{logits:function(){var t=ML(r);return UO(e,uO(iL(e,a,!0),t))}}}};var Cz=EP({localResponseNormalizationBackprop_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:.5,s={x:e,y:t,dy:n},u={depthRadius:r,bias:a,alpha:i,beta:o};return BD.runKernel(VN,s,u)}}),Tz={kernelName:UN,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o=n.depthRadius,s=n.bias,u=n.alpha,c=n.beta;return{x:function(){return Cz(a,i,e,o,s,u,c)}}}};var Ez=EP({equal_:function(e,t){var n=CP(e,"a","equal"),r=CP(t,"b","equal"),a=f(RD(n,r),2);n=a[0],r=a[1],PO(n.shape,r.shape);var i={a:n,b:r};return BD.runKernel(pN,i)}});function Iz(e,t,n,r){return t.rank<n.rank&&(t=eO(t,YO(t.shape,r))),e.rank<n.rank&&(e=eO(e,YO(e.shape,r))),{x:function(){return uO(e,IP(Ez(n,t),e.dtype))}}}var Az={kernelName:WN,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.reductionIndices,a=t[0],i=Iz(e,t[1],a,YA(r,a.shape));return{x:function(){return i.x()}}}};var Mz=EP({less_:function(e,t){var n=CP(e,"a","less"),r=CP(t,"b","less"),a=f(RD(n,r),2);n=a[0],r=a[1],PO(n.shape,r.shape);var i={a:n,b:r};return BD.runKernel(DN,i)}}),Nz={kernelName:GN,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1];return{a:function(){return uO(e,IP(OO(r,a),"float32"))},b:function(){return uO(e,IP(Mz(r,a),"float32"))}}}};var Rz=EP({maxPool3dGrad_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1,1],o=arguments.length>6?arguments[6]:void 0,s=arguments.length>7?arguments[7]:void 0,u=CP(e,"dy","maxPool3dGrad"),c=CP(t,"input","maxPool3dGrad"),l=CP(n,"output","maxPool3dGrad"),h=u,f=c,d=l,p=!1;4===c.rank&&(p=!0,h=eO(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),f=eO(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),d=eO(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),VA(5===h.rank,(function(){return"Error in maxPool3dGrad: dy must be rank 5 but got rank "+"".concat(h.rank,".")})),VA(5===f.rank,(function(){return"Error in maxPool3dGrad: input must be rank 5 but got rank "+"".concat(f.rank,".")})),VA(5===d.rank,(function(){return"Error in maxPool3dGrad: output must be rank 5 but got rank "+"".concat(d.rank,".")})),VA(QL(a,i),(function(){return"Error in maxPool3dGrad: Either strides or dilations "+"must be 1. Got strides ".concat(a," and dilations '").concat(i,"'")})),null!=s&&VA(XA(o),(function(){return"Error in maxPool3dGrad: pad must be an integer when "+"using, dimRoundingMode ".concat(s," but got pad ").concat(o,".")}));var v={dy:h,input:f,output:d},m={filterSize:r,strides:a,dilations:i,pad:o,dimRoundingMode:s},g=BD.runKernel(XN,v,m);return p?eO(g,[g.shape[1],g.shape[2],g.shape[3],g.shape[4]]):g}}),Dz={kernelName:HN,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.dilations,c=n.pad,l=n.dimRoundingMode,h=null==u?[1,1,1]:u;return{x:function(){return Rz(e,a,i,o,s,h,c,l)}}}};var Pz=EP({maxPoolGrad_:function(e,t,n,r,a,i,o){var s=CP(e,"dy","maxPoolGrad"),u=CP(t,"input","maxPoolGrad"),c=CP(n,"output","maxPoolGrad");VA(u.rank===s.rank,(function(){return"Rank of input (".concat(u.rank,") does not match rank of dy ")+"(".concat(s.rank,")")})),VA(4===s.rank,(function(){return"Error in maxPoolGrad: dy must be rank 4 but got rank "+"".concat(s.rank,".")})),VA(4===u.rank,(function(){return"Error in maxPoolGrad: input must be rank 4 but got rank "+"".concat(u.rank,".")})),null!=o&&VA(XA(i),(function(){return"Error in maxPoolGrad: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(i,".")}));var l={dy:s,input:u,output:c},h={filterSize:r,strides:a,pad:i,dimRoundingMode:o};return BD.runKernel(qN,l,h)}}),Oz={kernelName:jN,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=f(t,2),a=r[0],i=r[1],o=n.filterSize,s=n.strides,u=n.pad;return{x:function(){return Pz(e,a,i,o,s,u)}}}},Lz={kernelName:KN,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=YA(n.axis,r.shape),i=qA(KO(r.shape,a)[1]);return{x:function(){var t=r.shape.slice();a.forEach((function(e){t[e]=1}));var n=eO(e,t);return qO(uO(n,_L(r.shape,"float32")),i)}}}},Fz={kernelName:YN,inputsToSave:["x"],outputsToSave:[!0],gradFunc:function(e,t,n){var r=n.axis,a=f(t,2),i=a[0],o=Iz(e,a[1],i,YA(r,i.shape));return{x:function(){return o.x()}}}},zz={kernelName:QN,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1];return{a:function(){return uO(e,IP(LO(r,a),"float32"))},b:function(){return uO(e,IP(vL(r,a),"float32"))}}}},Bz={kernelName:ZN,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return tO(e,a,r.shape)}}}};var Uz=EP({floor_:function(e){var t={x:CP(e,"x","floor")};return BD.runKernel(xN,t)}}),Vz={kernelName:JN,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=PO(r.shape,a.shape);return{a:function(){var t=DO(r.shape,i);return t.length>0?eO(iL(e,t),r.shape):e},b:function(){var t=uO(e,gL(Uz(qO(r,a)))),n=DO(a.shape,i);return n.length>0?eO(iL(t,n),a.shape):t}}}},Wz={kernelName:$N,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=PO(r.shape,a.shape);return{a:function(){var t=uO(e,IP(a,"float32")),n=DO(r.shape,i);return n.length>0?eO(iL(t,n),r.shape):t},b:function(){var t=uO(e,IP(r,"float32")),n=DO(a.shape,i);return n.length>0?eO(iL(t,n),a.shape):t}}}},Gz={kernelName:eR,gradFunc:function(e){return{x:function(){return gL(e)}}}},jz={kernelName:oR,inputsToSave:["indices"],gradFunc:function(e,t){var n=t[0];return{indices:function(){return rO(n.shape,"float32")}}}},qz={kernelName:iR,gradFunc:function(e){return{x:function(){return aO(e)}}}},Hz={kernelName:sR,saveAllInputs:!0,gradFunc:function(e,t,n){var r=n.axis;return VO(e,r).map((function(e){return function(){return e}}))}},Xz={kernelName:uR,inputsToSave:["x"],gradFunc:function(e,t,n){var r=t[0],a=n.paddings.map((function(e){return e[0]}));return{x:function(){return tO(e,a,r.shape)}}}},Kz={kernelName:cR,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:function(e,t){var n=f(t,3),r=n[0],a=n[1],i=n[2],o=r,s=a,u=PO(o.shape,s.shape);return{a:function(){var t=IP(s,"float32"),n=uO(e,uO(t,nL(o,UO(t,hO(1))))),r=DO(o.shape,u);return r.length>0&&(n=iL(n,r)),eO(n,o.shape)},b:function(){var t=vL(o,0),n=GO(t,IL(o),aO(o)),r=uO(e,uO(i,n)),a=DO(s.shape,u);return a.length>0&&(r=iL(r,a)),eO(r,s.shape)}}}},Yz={kernelName:lR,inputsToSave:["x","alpha"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=vL(r,0);return{x:function(){return GO(i,e,uO(e,a))},alpha:function(){var t=GO(i,aO(e),uO(e,r)),n=DO(a.shape,e.shape);return n.length>0&&(t=iL(t,n)),eO(t,a.shape)}}}},Qz={kernelName:lN,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=PO(r.shape,a.shape);return{a:function(){var t=qO(e,IP(a,"float32")),n=DO(r.shape,i);return n.length>0?eO(iL(t,n),r.shape):t},b:function(){var t=uO(e,IP(r,"float32")),n=DO(a.shape,i);n.length>0&&(t=eO(iL(t,n),a.shape));var o=aL(a);return gL(qO(t,IP(o,"float32")))}}}},Zz={kernelName:pR,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return qO(e,gL(aL(n)))}}}},Jz={kernelName:kR,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0],r=uO(LO(n,6),nF(n));return{x:function(){return uO(e,IP(r,"float32"))}}}},$z={kernelName:vR,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return uO(e,IP(nF(n),"float32"))}}}},eB={kernelName:mR,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return eO(e,n.shape)}}}},tB={kernelName:bR,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:f(t,1)[0]};return{images:function(){return BD.runKernel(xR,r,n)}}}},nB={kernelName:gR,inputsToSave:["images"],gradFunc:function(e,t,n){var r={dy:e,images:f(t,1)[0]};return{images:function(){return BD.runKernel(yR,r,n)}}}},rB={kernelName:wR,gradFunc:function(e,t,n){var r=YA(n.dims,e.shape);return{x:function(){return cO(e,r)}}}},aB={kernelName:_R,gradFunc:function(e){return{x:function(){return aO(e)}}}},iB={kernelName:SR,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return gL(qO(e,uO(nL(n,1.5),2)))}}}};var oB=EP({logicalNot_:function(e){var t={x:CP(e,"x","logicalNot","bool")};return BD.runKernel(zN,t)}}),sB={kernelName:CR,inputsToSave:["condition"],gradFunc:function(e,t){var n=f(t,1)[0];return{condition:function(){return IP(aO(n),"float32")},t:function(){return uO(e,IP(n,e.dtype))},e:function(){return uO(e,IP(oB(n),e.dtype))}}}},uB={kernelName:TR,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){var t=vL(n,hO(0)),r=hO(sF),a=hO(uF),i=uO(e,a),o=uO(uO(e,r),ML(IP(n,"float32")));return GO(t,i,o)}}}},cB={kernelName:NR,outputsToSave:[!0],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return uO(e,uO(n,UO(hO(1),n)))}}}},lB={kernelName:MR,gradFunc:function(e){return{x:function(){return aO(e)}}}};var hB=EP({cos_:function(e){var t={x:CP(e,"x","cos")};return BD.runKernel($M,t)}}),fB={kernelName:IR,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return uO(hB(IP(n,"float32")),e)}}}};var dB=EP({cosh_:function(e){var t={x:CP(e,"x","cosh")};return BD.runKernel(eN,t)}}),pB={kernelName:AR,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return uO(dB(IP(n,"float32")),e)}}}};var vB=EP({pad_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=CP(e,"x","pad");if(0===r.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");var a={paddings:t,constantValue:n},i={x:r};return BD.runKernel(uR,i,a)}}),mB={kernelName:ER,inputsToSave:["x"],gradFunc:function(e,t,n){for(var r=f(t,1)[0],a=n.begin,i=n.size,o=r.shape,s=f(KP(r,a,i),2),u=s[0],c=s[1],l=[],h=0;h<e.rank;h++)l.push([u[h],o[h]-u[h]-c[h]]);return{x:function(){return vB(e,l)}}}},gB={kernelName:FR,outputsToSave:[!0],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.dim,i=uO(e,r);return{logits:function(){return UO(i,uO(iL(i,[a],true),r))}}}};var yB=EP({sigmoid_:function(e){var t={x:CP(e,"x","sigmoid")};return BD.runKernel(NR,t)}}),bB={kernelName:RR,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return uO(e,yB(n))}}}};var xB=EP({batchToSpaceND_:function(e,t,n){var r=CP(e,"x","batchToSpaceND"),a=t.reduce((function(e,t){return e*t}));VA(r.rank>=1+t.length,(function(){return"input rank is ".concat(r.rank," but should be > than blockShape.length ").concat(t.length)})),VA(n.length===t.length,(function(){return"crops.length is ".concat(n.length," but should be equal to blockShape.length  ").concat(t.length)})),VA(r.shape[0]%a===0,(function(){return"input tensor batch is ".concat(r.shape[0]," but is not divisible by the product of ")+"the elements of blockShape ".concat(t.join(" * ")," === ").concat(a)}));var i={x:r},o={blockShape:t,crops:n};return BD.runKernel(UM,i,o)}}),kB={kernelName:OR,gradFunc:function(e,t,n){var r=n.blockShape,a=n.paddings;return{x:function(){return xB(e,r,a)}}}},wB={kernelName:LR,gradFunc:function(e,t,n){var r=n.axis;return{x:function(){return ZP(e,r)}}}},_B={kernelName:DR,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return qO(e,uO(rL(IP(n,"float32")),2))}}}},SB={kernelName:BR,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return uO(e,uO(IP(n,"float32"),2))}}}},CB={kernelName:zR,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=hO(2);return{a:function(){return uO(e,uO(i,UO(r,a)))},b:function(){return uO(e,uO(i,UO(a,r)))}}}},TB={kernelName:ZR,gradFunc:function(e){return{x:function(){return aO(e)}}}},EB={kernelName:UR,inputsToSave:["a","b"],gradFunc:function(e,t){var n=f(t,2),r=n[0],a=n[1],i=PO(r.shape,a.shape);return{a:function(){var t=e,n=DO(r.shape,i);return n.length>0&&(t=iL(t,n)),eO(t,r.shape)},b:function(){var t=e,n=DO(a.shape,i);return n.length>0&&(t=iL(t,n)),eO(gL(t),a.shape)}}}},IB={kernelName:PR,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=r.shape.slice();YA(n.axis,r.shape).forEach((function(e){a[e]=1}));var i=eO(e,a),o=uO(i,_L(r.shape,"float32"));return{x:function(){return o}}}},AB={kernelName:WR,inputsToSave:["x"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return qO(e,aL(hB(n)))}}}},MB={kernelName:GR,outputsToSave:[!0],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return uO(UO(hO(1),aL(n)),e)}}}},NB={kernelName:jR,inputsToSave:["x"],gradFunc:function(e,t,n){var r=f(t,1)[0],a=n.reps;return{x:function(){var t=aO(r);if(1===r.rank)for(var n=0;n<a[0];++n)t=TL(t,tO(e,[n*r.shape[0]],[r.shape[0]]));else if(2===r.rank)for(var i=0;i<a[0];++i)for(var o=0;o<a[1];++o)t=TL(t,tO(e,[i*r.shape[0],o*r.shape[1]],[r.shape[0],r.shape[1]]));else if(3===r.rank)for(var s=0;s<a[0];++s)for(var u=0;u<a[1];++u)for(var c=0;c<a[2];++c)t=TL(t,tO(e,[s*r.shape[0],u*r.shape[1],c*r.shape[2]],[r.shape[0],r.shape[1],r.shape[2]]));else{if(4!==r.rank)throw new Error("Gradient for tile operation is not implemented for rank-"+"".concat(r.rank," tensors yet."));for(var l=0;l<a[0];++l)for(var h=0;h<a[1];++h)for(var f=0;f<a[2];++f)for(var d=0;d<a[3];++d)t=TL(t,tO(e,[l*r.shape[0],h*r.shape[1],f*r.shape[2],d*r.shape[3]],[r.shape[0],r.shape[1],r.shape[2],r.shape[3]]))}return t}}}},RB={kernelName:HR,gradFunc:function(e,t,n){var r=JO(n.perm);return{x:function(){return yL(e,r)}}}},DB={kernelName:KR,gradFunc:function(e,t,n){var r=n.axis;return{value:function(){return BO(e,r)}}}};var PB=EP({gather_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=CP(e,"x","gather"),i=CP(t,"indices","gather","int32"),o={x:a,indices:i},s={axis:n,batchDims:r};return BD.runKernel(_N,o,s)}});var OB=EP({maximum_:function(e,t){var n=CP(e,"a","maximum"),r=CP(t,"b","maximum"),a=f(RD(n,r),2);n=a[0],r=a[1],"bool"===n.dtype&&(n=IP(n,"int32"),r=IP(r,"int32")),PO(n.shape,r.shape);var i={a:n,b:r};return BD.runKernel(GN,i)}}),LB={kernelName:YR,inputsToSave:["segmentIds"],gradFunc:function(e,t){var n=f(t,1)[0];return{x:function(){return function(e,t){for(var n=OB(t,aO(t)),r=PB(e,n),a=OO(t,hO(0,"int32")),i=r.rank-a.rank,o=0;o<i;++o)a=fL(a,o+1);a=FO(a,_L(r.shape,"bool"));var s=aO(r);return GO(a,r,s)}(e,n)}}}};for(var FB=0,zB=[pF,vF,mF,gF,yF,bF,xF,kF,wF,_F,SF,CF,EF,AF,MF,RF,DF,PF,OF,LF,FF,zF,GF,VF,HF,KF,QF,JF,tz,nz,Qz,rz,az,iz,oz,sz,cz,uz,hz,dz,mz,gz,yz,bz,xz,kz,wz,_z,Sz,Tz,Az,Az,Nz,Dz,Oz,Lz,Fz,zz,Bz,Vz,Wz,Gz,jz,qz,Hz,Xz,Xz,Kz,Yz,Zz,Jz,$z,eB,tB,nB,rB,aB,iB,sB,uB,cB,lB,fB,pB,mB,gB,bB,kB,kB,wB,wB,_B,CB,SB,TB,EB,IB,AB,MB,NB,RB,DB,LB,{kernelName:QR,gradFunc:function(e){return{x:function(){return aO(e)}}}}];FB<zB.length;FB++){aD(zB[FB])}_D.prototype.abs=function(){return this.throwIfDisposed(),HO(this)};var BB=EP({acos_:function(e){var t={x:CP(e,"x","acos")};return BD.runKernel(wM,t)}});_D.prototype.acos=function(){return this.throwIfDisposed(),BB(this)};var UB=EP({acosh_:function(e){var t={x:CP(e,"x","acosh")};return BD.runKernel(_M,t)}});_D.prototype.acosh=function(){return this.throwIfDisposed(),UB(this)};var VB=EP({mod_:function(e,t){var n=CP(e,"a","mod"),r=CP(t,"b","mod"),a=f(RD(n,r),2),i={a:n=a[0],b:r=a[1]};return BD.runKernel(JN,i)}});var WB=EP({addStrict_:function(e,t){cL("strict variants of ops have been deprecated and will be removed in future");var n=CP(e,"a","addStrict"),r=CP(t,"b","addStrict");return WA(n.shape,r.shape,"Error in addStrict: "),TL(n,r)}}),GB=EP({divStrict_:function(e,t){cL("strict variants of ops have been deprecated and will be removed in future");var n=CP(e,"a","div"),r=CP(t,"b","div");return WA(n.shape,r.shape,"Error in divideStrict: "),qO(n,r)}}),jB=EP({maximumStrict_:function(e,t){cL("strict variants of ops have been deprecated and will be removed in future");var n=CP(e,"a","maximumStrict"),r=CP(t,"b","maximumStrict");return WA(n.shape,r.shape,"Error in maximumStrict: "),OB(n,r)}}),qB=EP({minimumStrict_:function(e,t){cL("strict variants of ops have been deprecated and will be removed in future");var n=CP(e,"a","minimumStrict"),r=CP(t,"b","minimumStrict");return WA(n.shape,r.shape,"Error in minimumStrict: "),EL(n,r)}}),HB=EP({modStrict_:function(e,t){cL("strict variants of ops have been deprecated and will be removed in future");var n=CP(e,"a","modStrict"),r=CP(t,"b","modStrict");return WA(n.shape,r.shape,"Error in modStrict: "),VB(n,r)}}),XB=EP({mulStrict_:function(e,t){cL("strict variants of ops have been deprecated and will be removed in future");var n=CP(e,"a","mul"),r=CP(t,"b","mul");return WA(n.shape,r.shape,"Error in multiplyStrict: "),uO(n,r)}}),KB=EP({powStrict_:function(e,t){return cL("strict variants of ops have been deprecated and will be removed in future"),WA(e.shape,t.shape,"Error in powStrict: "),nL(e,t)}}),YB=EP({squaredDifferenceStrict_:function(e,t){cL("strict variants of ops have been deprecated and will be removed in future");var n=CP(e,"a","squaredDifferenceStrict"),r=CP(t,"b","squaredDifferenceStrict");return WA(n.shape,r.shape,"Error in squaredDifferenceStrict: "),AL(n,r)}}),QB=EP({subStrict_:function(e,t){cL("strict variants of ops have been deprecated and will be removed in future");var n=CP(e,"a","subStrict"),r=CP(t,"b","subStrict");return WA(n.shape,r.shape,"Error in subStrict: "),UO(n,r)}});_D.prototype.addStrict=function(e){return this.throwIfDisposed(),WB(this,e)},_D.prototype.add=function(e){return this.throwIfDisposed(),TL(this,e)};var ZB=EP({all_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=CP(e,"x","all","bool"),a={x:r},i={axis:t,keepDims:n};return BD.runKernel(TM,a,i)}});_D.prototype.all=function(e,t){return this.throwIfDisposed(),ZB(this,e,t)};var JB=EP({any_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=CP(e,"x","any","bool"),a={x:r},i={axis:t,keepDims:n};return BD.runKernel(EM,a,i)}});_D.prototype.any=function(e,t){return this.throwIfDisposed(),JB(this,e,t)};var $B=EP({argMax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=CP(e,"x","argMax"),r={x:n},a={axis:t};return BD.runKernel(IM,r,a)}});_D.prototype.argMax=function(e){return this.throwIfDisposed(),$B(this,e)};var eU=EP({argMin_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=CP(e,"x","argMin"),r={x:n},a={axis:t};return BD.runKernel(AM,r,a)}});_D.prototype.argMin=function(e){return this.throwIfDisposed(),eU(this,e)},_D.prototype.asScalar=function(){return this.throwIfDisposed(),VA(1===this.size,(function(){return"The array must have only 1 element."})),eO(this,[])},_D.prototype.asType=function(e){return this.throwIfDisposed(),IP(this,e)},_D.prototype.as1D=function(){return this.throwIfDisposed(),eO(this,[this.size])},_D.prototype.as2D=function(e,t){return this.throwIfDisposed(),eO(this,[e,t])},_D.prototype.as3D=function(e,t,n){return this.throwIfDisposed(),eO(this,[e,t,n])},_D.prototype.as4D=function(e,t,n,r){return this.throwIfDisposed(),eO(this,[e,t,n,r])},_D.prototype.as5D=function(e,t,n,r,a){return this.throwIfDisposed(),eO(this,[e,t,n,r,a])};var tU=EP({asin_:function(e){var t={x:CP(e,"x","asin")};return BD.runKernel(MM,t)}});_D.prototype.asin=function(){return this.throwIfDisposed(),tU(this)};var nU=EP({asinh_:function(e){var t={x:CP(e,"x","asinh")};return BD.runKernel(NM,t)}});_D.prototype.asinh=function(){return this.throwIfDisposed(),nU(this)};var rU=EP({atan_:function(e){var t={x:CP(e,"x","atan")};return BD.runKernel(RM,t)}});_D.prototype.atan=function(){return this.throwIfDisposed(),rU(this)};var aU=EP({atan2_:function(e,t){var n=CP(e,"a","atan2"),r=CP(t,"b","atan2"),a=f(RD(n,r),2),i={a:n=a[0],b:r=a[1]};return BD.runKernel(PM,i)}});_D.prototype.atan2=function(e){return this.throwIfDisposed(),aU(this,e)};var iU=EP({atanh_:function(e){var t={x:CP(e,"x","atanh")};return BD.runKernel(DM,t)}});_D.prototype.atanh=function(){return this.throwIfDisposed(),iU(this)};var oU=EP({avgPool_:function(e,t,n,r,a){var i=CP(e,"x","avgPool","float32");VA(QL(n,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")}));var o=i,s=!1;3===i.rank&&(s=!0,o=eO(i,[1,i.shape[0],i.shape[1],i.shape[2]])),VA(4===o.rank,(function(){return"Error in avgPool: x must be rank 4 but got rank ".concat(o.rank,".")})),null!=a&&VA(XA(r),(function(){return"Error in avgPool: pad must be an integer when using, "+"dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=BD.runKernel(OM,u,c);return l=IP(l,i.dtype),s?eO(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});_D.prototype.avgPool=function(e,t,n,r){return this.throwIfDisposed(),oU(this,e,t,n,r)},_D.prototype.batchToSpaceND=function(e,t){return this.throwIfDisposed(),xB(this,e,t)};var sU=EP({batchNorm_:function(e,t,n,r,a,i){null==i&&(i=.001);var o,s,u=CP(e,"x","batchNorm"),c=CP(t,"mean","batchNorm"),l=CP(n,"variance","batchNorm");null!=a&&(o=CP(a,"scale","batchNorm")),null!=r&&(s=CP(r,"offset","batchNorm")),VA(c.rank===l.rank,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),VA(null==s||c.rank===s.rank,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),VA(null==o||c.rank===o.rank,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var h=function(e){return 0===e.rank||1===e.rank?eO(e,[1,1,1,e.size]):2===e.rank?eO(e,[1,1,e.shape[0],e.shape[1]]):3===e.rank?eO(e,[1,e.shape[0],e.shape[1],e.shape[2]]):e}(u),f={x:h,scale:o,offset:s,mean:c,variance:l},d={varianceEpsilon:i},p=BD.runKernel(wN,f,d);return eO(p,u.shape)}});_D.prototype.batchNorm=function(e,t,n,r,a){return this.throwIfDisposed(),sU(this,e,t,n,r,a)},_D.prototype.broadcastTo=function(e){return this.throwIfDisposed(),WO(this,e)},_D.prototype.cast=function(e){return this.throwIfDisposed(),IP(this,e)};var uU=EP({ceil_:function(e){var t={x:CP(e,"x","ceil")};return BD.runKernel(WM,t)}});_D.prototype.ceil=function(){return this.throwIfDisposed(),uU(this)};var cU=EP({clipByValue_:function(e,t,n){var r=CP(e,"x","clipByValue");VA(t<=n,(function(){return"Error in clip: min (".concat(t,") must be ")+"less than or equal to max (".concat(n,").")}));var a={x:r},i={clipValueMin:t,clipValueMax:n};return BD.runKernel(GM,a,i)}});_D.prototype.clipByValue=function(e,t){return this.throwIfDisposed(),cU(this,e,t)},_D.prototype.concat=function(e,t){return this.throwIfDisposed(),e instanceof _D&&(e=[e]),ZP([this].concat(Tt(e)),t)};var lU=EP({conv1d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,o=arguments.length>6?arguments[6]:void 0,s=CP(e,"x","conv1d"),u=CP(t,"filter","conv1d"),c=s,l=!1;2===s.rank&&(l=!0,c=eO(s,[1,s.shape[0],s.shape[1]])),VA(3===c.rank,(function(){return"Error in conv1d: input must be rank 3, but got rank ".concat(c.rank,".")})),VA(3===u.rank,(function(){return"Error in conv1d: filter must be rank 3, but got rank "+"".concat(u.rank,".")})),null!=o&&VA(XA(r),(function(){return"Error in conv1d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")})),VA(c.shape[2]===u.shape[1],(function(){return"Error in conv1d: depth of input (".concat(c.shape[2],") must match ")+"input depth for filter ".concat(u.shape[1],".")})),VA(QL(n,i),(function(){return"Error in conv1D: Either stride or dilation must be 1. "+"Got stride ".concat(n," and dilation '").concat(i,"'")})),VA("NWC"===a,(function(){return"Error in conv1d: got dataFormat of ".concat(a," but only NWC is currently supported.")}));var h=eO(u,[1,u.shape[0],u.shape[1],u.shape[2]]),f=eO(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=[1,n],p=[1,i],v="NHWC",m=WF(f,h,d,r,v,p,o);return eO(m,l?[m.shape[2],m.shape[3]]:[m.shape[0],m.shape[2],m.shape[3]])}});_D.prototype.conv1d=function(e,t,n,r,a,i){return this.throwIfDisposed(),lU(this,e,t,n,r,a,i)};var hU=EP({conv2dTranspose_:function(e,t,n,r,a,i){var o=CP(e,"x","conv2dTranspose"),s=CP(t,"filter","conv2dTranspose");return UF(n,o,s,r,a,"NHWC",i)}});_D.prototype.conv2dTranspose=function(e,t,n,r,a){return this.throwIfDisposed(),hU(this,e,t,n,r,a)},_D.prototype.conv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),WF(this,e,t,n,r,a,i)},_D.prototype.cos=function(){return this.throwIfDisposed(),hB(this)},_D.prototype.cosh=function(){return this.throwIfDisposed(),dB(this)},_D.prototype.cumsum=function(e,t,n){return this.throwIfDisposed(),ZF(this,e,t,n)};var fU=EP({depthToSpace_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"NHWC",r=CP(e,"x","depthToSpace"),a="NHWC"===n?r.shape[1]:r.shape[2],i="NHWC"===n?r.shape[2]:r.shape[3],o="NHWC"===n?r.shape[3]:r.shape[1];VA(a*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(a," and ").concat(t,"  for depthToSpace with input shape\n    ").concat(r.shape)})),VA(i*t>=0,(function(){return"Negative dimension size caused by overflow when multiplying\n    ".concat(i," and ").concat(t," for depthToSpace with input shape\n        ").concat(r.shape)})),VA(o%(t*t)===0,(function(){return"Dimension size must be evenly divisible by ".concat(t*t," but is ").concat(o," for depthToSpace with input shape ").concat(r.shape)}));var s={x:r},u={blockSize:t,dataFormat:n};return BD.runKernel(rN,s,u)}});_D.prototype.depthToSpace=function(e,t){return this.throwIfDisposed(),fU(this,e,t)};var dU=EP({depthwiseConv2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6?arguments[6]:void 0,s=CP(e,"x","depthwiseConv2d"),u=CP(t,"filter","depthwiseConv2d"),c=s,l=!1;3===s.rank&&(l=!0,c=eO(s,[1,s.shape[0],s.shape[1],s.shape[2]])),VA(4===c.rank,(function(){return"Error in depthwiseConv2d: input must be rank 4, but got "+"rank ".concat(c.rank,".")})),VA(4===u.rank,(function(){return"Error in depthwiseConv2d: filter must be rank 4, but got rank "+"".concat(u.rank,".")})),VA(c.shape[3]===u.shape[2],(function(){return"Error in depthwiseConv2d: number of input channels "+"(".concat(c.shape[3],") must match the inChannels dimension in ")+"filter ".concat(u.shape[2],".")})),null!=o&&VA(XA(r),(function(){return"Error in depthwiseConv2d: pad must be an integer when using, "+"dimRoundingMode ".concat(o," but got pad ").concat(r,".")}));var h={x:c,filter:u},f={strides:n,pad:r,dataFormat:a,dilations:i,dimRoundingMode:o},d=BD.runKernel(aN,h,f);return l?eO(d,[d.shape[1],d.shape[2],d.shape[3]]):d}});_D.prototype.depthwiseConv2D=function(e,t,n,r,a,i){return cL("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),dU(this,e,t,n,r,a,i)},_D.prototype.depthwiseConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),dU(this,e,t,n,r,a,i)};var pU=EP({dilation2d_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[1,1],i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"NHWC",o=CP(e,"x","dilation2d"),s=CP(t,"filter","dilation2d");VA(3===o.rank||4===o.rank,(function(){return"Error in dilation2d: input must be rank 3 or 4, but got rank "+"".concat(o.rank,".")})),VA(3===s.rank,(function(){return"Error in dilation2d: filter must be rank 3, but got rank "+"".concat(s.rank,".")})),VA("NHWC"===i,(function(){return"Error in dilation2d: Only NHWC is currently supported, "+"but got dataFormat of ".concat(i)}));var u=o,c=!1;3===o.rank&&(u=eO(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0);var l={x:u,filter:s},h={strides:n,pad:r,dilations:a},f=BD.runKernel(sN,l,h);return c?eO(f,[f.shape[1],f.shape[2],f.shape[3]]):f}});_D.prototype.dilation2d=function(e,t,n,r,a){return this.throwIfDisposed(),pU(this,e,t,n,r,a)};var vU=EP({divNoNan_:function(e,t){var n=CP(e,"a","div"),r=CP(t,"b","div"),a=f(RD(n,r),2);n=a[0],r=a[1];var i=qO(n,r),o=aO(i),s=Ez(r,o);return GO(s,o,i)}});_D.prototype.divNoNan=function(e){return this.throwIfDisposed(),vU(this,e)},_D.prototype.divStrict=function(e){return this.throwIfDisposed(),GB(this,e)},_D.prototype.div=function(e){return this.throwIfDisposed(),qO(this,e)};var mU=EP({dot_:function(e,t){var n=CP(e,"t1","dot"),r=CP(t,"t2","dot");VA((1===n.rank||2===n.rank)&&(1===r.rank||2===r.rank),(function(){return"Error in dot: inputs must all be rank 1 or 2, but got ranks "+"".concat(n.rank," and ").concat(r.rank,".")}));var a=1===n.rank?n.size:n.shape[1],i=1===r.rank?r.size:r.shape[0];if(VA(a===i,(function(){return"Error in dot: inner dimensions of inputs must match, but got "+"".concat(a," and ").concat(i,".")})),1===n.rank&&1===r.rank){var o=eO(n,[1,-1]),s=eO(r,[-1,1]),u=mL(o,s);return eO(u,[])}if(1===n.rank&&2===r.rank){var c=eO(n,[1,-1]),l=eO(r,[r.shape[0],r.shape[1]]),h=mL(c,l);return eO(h,[h.size])}if(2===n.rank&&1===r.rank){var f=eO(r,[-1,1]),d=mL(n,f);return eO(d,[d.size])}var p=eO(r,[r.shape[0],r.shape[1]]);return mL(n,p)}});_D.prototype.dot=function(e){return this.throwIfDisposed(),mU(this,e)},_D.prototype.elu=function(){return this.throwIfDisposed(),JL(this)};var gU=EP({equalStrict_:function(e,t){cL("strict variants of ops have been deprecated and will be removed in future");var n=CP(e,"a","equalStrict"),r=CP(t,"b","equalStrict");return WA(n.shape,r.shape,"Error in equalStrict: "),Ez(n,r)}}),yU=EP({greaterEqualStrict_:function(e,t){cL("strict variants of ops have been deprecated and will be removed in future");var n=CP(e,"a","greaterEqualStrict"),r=CP(t,"b","greaterEqualStrict");return WA(n.shape,r.shape,"Error in greaterEqualStrict: "),OO(n,r)}}),bU=EP({greaterStrict_:function(e,t){cL("strict variants of ops have been deprecated and will be removed in future");var n=CP(e,"a","greaterStrict"),r=CP(t,"b","greaterStrict");return WA(n.shape,r.shape,"Error in greaterStrict: "),vL(n,r)}}),xU=EP({lessEqualStrict_:function(e,t){cL("strict variants of ops have been deprecated and will be removed in future");var n=CP(e,"a","lessEqualStrict"),r=CP(t,"b","lessEqualStrict");return WA(n.shape,r.shape,"Error in lessEqualStrict: "),LO(n,r)}}),kU=EP({lessStrict_:function(e,t){cL("strict variants of ops have been deprecated and will be removed in future");var n=CP(e,"a","lessStrict"),r=CP(t,"b","lessStrict");return WA(n.shape,r.shape,"Error in lessStrict: "),Mz(n,r)}}),wU=EP({notEqualStrict_:function(e,t){cL("strict variants of ops have been deprecated and will be removed in future");var n=CP(e,"a","notEqualStrict"),r=CP(t,"b","notEqualStrict");return WA(n.shape,r.shape,"Error in notEqualStrict: "),wL(n,r)}});_D.prototype.equalStrict=function(e){return this.throwIfDisposed(),gU(this,e)},_D.prototype.equal=function(e){return this.throwIfDisposed(),Ez(this,e)};var _U=EP({erf_:function(e){var t=CP(e,"x","erf");VA("int32"===t.dtype||"float32"===t.dtype,(function(){return"Input dtype must be `int32` or `float32`."})),"int32"===t.dtype&&(t=IP(t,"float32"));var n={x:t};return BD.runKernel(dN,n)}});_D.prototype.erf=function(){return this.throwIfDisposed(),_U(this)},_D.prototype.exp=function(){return this.throwIfDisposed(),ML(this)},_D.prototype.expandDims=function(e){return this.throwIfDisposed(),fL(this,e)};var SU=EP({expm1_:function(e){var t={x:CP(e,"x","expm1")};return BD.runKernel(gN,t)}});_D.prototype.expm1=function(){return this.throwIfDisposed(),SU(this)},_D.prototype.fft=function(){return this.throwIfDisposed(),iO(this)},_D.prototype.flatten=function(){return this.throwIfDisposed(),eO(this,[this.size])},_D.prototype.floor=function(){return this.throwIfDisposed(),Uz(this)},_D.prototype.floorDiv=function(e){return this.throwIfDisposed(),jO(this,e)},_D.prototype.gather=function(e,t){return this.throwIfDisposed(),PB(this,e,t)},_D.prototype.greaterEqualStrict=function(e){return this.throwIfDisposed(),yU(this,e)},_D.prototype.greaterEqual=function(e){return this.throwIfDisposed(),OO(this,e)},_D.prototype.greaterStrict=function(e){return this.throwIfDisposed(),bU(this,e)},_D.prototype.greater=function(e){return this.throwIfDisposed(),vL(this,e)},_D.prototype.ifft=function(){return this.throwIfDisposed(),sO(this)},_D.prototype.irfft=function(){return this.throwIfDisposed(),fO(this)};var CU=EP({isFinite_:function(e){var t={x:CP(e,"x","isFinite")};return BD.runKernel(AN,t)}});_D.prototype.isFinite=function(){return this.throwIfDisposed(),CU(this)};var TU=EP({isInf_:function(e){var t={x:CP(e,"x","isInf")};return BD.runKernel(MN,t)}});_D.prototype.isInf=function(){return this.throwIfDisposed(),TU(this)};var EU=EP({isNaN_:function(e){var t={x:CP(e,"x","isNaN")};return BD.runKernel(NN,t)}});_D.prototype.isNaN=function(){return this.throwIfDisposed(),EU(this)},_D.prototype.leakyRelu=function(e){return this.throwIfDisposed(),$L(this,e)},_D.prototype.lessEqualStrict=function(e){return this.throwIfDisposed(),xU(this,e)},_D.prototype.lessEqual=function(e){return this.throwIfDisposed(),LO(this,e)},_D.prototype.lessStrict=function(e){return this.throwIfDisposed(),kU(this,e)},_D.prototype.less=function(e){return this.throwIfDisposed(),Mz(this,e)};var IU=EP({localResponseNormalization_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,i=CP(e,"x","localResponseNormalization");VA(4===i.rank||3===i.rank,(function(){return"Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ".concat(i.rank,".")})),VA(XA(t),(function(){return"Error in localResponseNormalization: depthRadius must be an "+"integer but got depthRadius ".concat(t,".")}));var o=i,s=!1;3===i.rank&&(s=!0,o=eO(i,[1,i.shape[0],i.shape[1],i.shape[2]]));var u={x:o},c={depthRadius:t,bias:n,alpha:r,beta:a},l=BD.runKernel(UN,u,c);return s?eO(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});_D.prototype.localResponseNormalization=function(e,t,n,r){return this.throwIfDisposed(),IU(this,e,t,n,r)};var AU=EP({softplus_:function(e){var t={x:CP(e,"x","softplus")};return BD.runKernel(RR,t)}});var MU=EP({logSigmoid_:function(e){var t=CP(e,"x","logSigmoid"),n=DL((function(e){return{value:gL(AU(gL(e))),gradFunc:function(t){return uO(t,yB(gL(e)))}}}));return n(t)}});_D.prototype.logSigmoid=function(){return this.throwIfDisposed(),MU(this)};var NU=EP({logSoftmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=CP(e,"logits","logSoftmax");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Log Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and axis was ").concat(t));var r=DL((function(e,n){var r=eL(e,t,!0),a=UO(e,r),i=UO(IP(a,"float32"),IL(iL(ML(a),t,!0)));n([i]);return{value:i,gradFunc:function(e,n){var r=f(n,1)[0],a=ML(r);return UO(e,uO(iL(e,t,!0),a))}}}));return r(n)}});_D.prototype.logSoftmax=function(e){return this.throwIfDisposed(),NU(this,e)},_D.prototype.logSumExp=function(e,t){return this.throwIfDisposed(),PL(this,e,t)},_D.prototype.log=function(){return this.throwIfDisposed(),IL(this)},_D.prototype.log1p=function(){return this.throwIfDisposed(),NL(this)},_D.prototype.logicalAnd=function(e){return this.throwIfDisposed(),FO(this,e)},_D.prototype.logicalNot=function(){return this.throwIfDisposed(),oB(this)};var RU=EP({logicalOr_:function(e,t){var n=CP(e,"a","logicalOr","bool"),r=CP(t,"b","logicalOr","bool");PO(n.shape,r.shape);var a={a:n,b:r};return BD.runKernel(BN,a)}});_D.prototype.logicalOr=function(e){return this.throwIfDisposed(),RU(this,e)};var DU=EP({logicalXor_:function(e,t){var n=CP(e,"a","logicalXor","bool"),r=CP(t,"b","logicalXor","bool");return PO(n.shape,r.shape),FO(RU(e,t),oB(FO(e,t)))}});_D.prototype.logicalXor=function(e){return this.throwIfDisposed(),DU(this,e)},_D.prototype.matMul=function(e,t,n){return this.throwIfDisposed(),mL(this,e,t,n)};var PU=EP({maxPool_:function(e,t,n,r,a){var i=CP(e,"x","maxPool"),o=i,s=!1;3===i.rank&&(s=!0,o=eO(i,[1,i.shape[0],i.shape[1],i.shape[2]])),VA(4===o.rank,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(o.rank,".")})),VA(QL(n,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(n," and dilations '").concat(1,"'")})),null!=a&&VA(XA(r),(function(){return"Error in maxPool: pad must be an integer when using, "+"dimRoundingMode ".concat(a," but got pad ").concat(r,".")}));var u={x:o},c={filterSize:t,strides:n,pad:r,dimRoundingMode:a},l=BD.runKernel(jN,u,c);return s?eO(l,[l.shape[1],l.shape[2],l.shape[3]]):l}});_D.prototype.maxPool=function(e,t,n,r){return this.throwIfDisposed(),PU(this,e,t,n,r)},_D.prototype.max=function(e,t){return this.throwIfDisposed(),eL(this,e,t)},_D.prototype.maximumStrict=function(e){return this.throwIfDisposed(),jB(this,e)},_D.prototype.maximum=function(e){return this.throwIfDisposed(),OB(this,e)},_D.prototype.mean=function(e,t){return this.throwIfDisposed(),kL(this,e,t)},_D.prototype.min=function(e,t){return this.throwIfDisposed(),tL(this,e,t)},_D.prototype.minimumStrict=function(e){return this.throwIfDisposed(),qB(this,e)},_D.prototype.minimum=function(e){return this.throwIfDisposed(),EL(this,e)};var OU=EP({mirrorPad_:function(e,t,n){VA("reflect"===n||"symmetric"===n,(function(){return"Invalid mode. Mode must be either reflect or symmetric. "+"Got ".concat(n,".")}));var r=CP(e,"x","mirrorPad");if(0===r.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");VA(t.length===r.rank,(function(){return"Padding doesn't match input. Must be ".concat(r.rank,". ")+"Got ".concat(t.length,".")}));for(var a="reflect"===n?1:0,i=function(e){VA(2===t[e].length,(function(){return"Invalid number of paddings. Must be length of 2 each."})),VA(t[e][0]>=0&&t[e][0]<=r.shape[e]-a&&t[e][1]>=0&&t[e][1]<=r.shape[e]-a,(function(){return"Padding in dimension ".concat(e," cannot be greater than or equal ")+"to ".concat(r.shape[e]-a," or less than 0 for input of ")+"shape ".concat(r.shape)}))},o=0;o<r.rank;o++)i(o);var s={paddings:t,mode:n},u={x:r};return BD.runKernel(ZN,u,s)}});_D.prototype.mirrorPad=function(e,t){return this.throwIfDisposed(),OU(this,e,t)},_D.prototype.modStrict=function(e){return this.throwIfDisposed(),HB(this,e)},_D.prototype.mod=function(e){return this.throwIfDisposed(),VB(this,e)},_D.prototype.mulStrict=function(e){return this.throwIfDisposed(),XB(this,e)},_D.prototype.mul=function(e){return this.throwIfDisposed(),uO(this,e)},_D.prototype.neg=function(){return this.throwIfDisposed(),gL(this)},_D.prototype.norm=function(e,t,n){return this.throwIfDisposed(),sL(this,e,t,n)},_D.prototype.notEqualStrict=function(e){return this.throwIfDisposed(),wU(this,e)},_D.prototype.notEqual=function(e){return this.throwIfDisposed(),wL(this,e)};var LU=EP({oneHot_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(t<2)throw new Error("Error in oneHot: depth must be >=2, but it is ".concat(t));var a=CP(e,"indices","oneHot","int32"),i={indices:a},o={depth:t,onValue:n,offValue:r};return BD.runKernel(oR,i,o)}});_D.prototype.oneHot=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return this.throwIfDisposed(),LU(this,e,t,n)};var FU=EP({onesLike_:function(e){var t={x:CP(e,"x","onesLike")};return BD.runKernel(iR,t)}});_D.prototype.onesLike=function(){return this.throwIfDisposed(),FU(this)},_D.prototype.pad=function(e,t){return this.throwIfDisposed(),vB(this,e,t)};var zU=EP({pool_:function(e,t,n,r,a,i){null==a&&(a=[1,1]),null==i&&(i=1),0===r&&(r="valid");var o=CP(e,"x","maxPool"),s=o,u=!1;3===o.rank&&(u=!0,s=eO(o,[1,o.shape[0],o.shape[1],o.shape[2]])),VA(QL(i,a),(function(){return"Error in pool: Either strides or dilations must be 1. "+"Got strides ".concat(i," and dilations '").concat(a,"'")}));var c,l=zL(s.shape,t,i,a,r),h=[l.dilationHeight,l.dilationWidth];c="same"===r?function(e,t){var n=e.map((function(e,n){return e+(e-1)*(t[n]-1)})),r=n.map((function(e){return e-1})),a=r.map((function(e){return Math.floor(e/2)})),i=r.map((function(e,t){return e-a[t]}));return r.map((function(e,t){return[a[t],i[t]]}))}([l.filterHeight,l.filterWidth],h):[[0,0],[0,0]];var d=1===h[0]&&1===h[1],p=function(e,t,n){var r=n.map((function(e){return e[0]})),a=n.map((function(e){return e[1]})),i=e.concat(r,a),o=t.map((function(e,t){return(e-i[t]%e)%e})),s=a.map((function(e,t){return e+o[t]})),u=t.map((function(e,t){return[r[t],s[t]]})),c=t.map((function(e,t){return[0,o[t]]}));return[u,c]}([l.inHeight,l.inWidth],h,c),v=f(p,2),m=v[0],g=v[1],y=d?r:"valid",b=d?s:NF(s,h,m),x=("avg"===n?function(){return oU(b,t,i,y)}:function(){return PU(b,t,i,y)})(),k=d?x:xB(x,h,g);return u?eO(k,[k.shape[1],k.shape[2],k.shape[3]]):k}});_D.prototype.pool=function(e,t,n,r,a){return this.throwIfDisposed(),zU(this,e,t,n,r,a)},_D.prototype.powStrict=function(e){return this.throwIfDisposed(),KB(this,e)},_D.prototype.pow=function(e){return this.throwIfDisposed(),nL(this,e)},_D.prototype.prelu=function(e){return this.throwIfDisposed(),eF(this,e)};var BU=EP({prod_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=CP(e,"x","prod");"bool"===r.dtype&&(r=IP(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return BD.runKernel(hR,a,i)}});_D.prototype.prod=function(e,t){return this.throwIfDisposed(),BU(this,e,t)};var UU=EP({reciprocal_:function(e){var t={x:CP(e,"x","reciprocal")};return BD.runKernel(pR,t)}});_D.prototype.reciprocal=function(){return this.throwIfDisposed(),UU(this)},_D.prototype.relu=function(){return this.throwIfDisposed(),CL(this)},_D.prototype.relu6=function(){return this.throwIfDisposed(),tF(this)},_D.prototype.reshapeAs=function(e){return this.throwIfDisposed(),eO(this,e.shape)},_D.prototype.reshape=function(e){return this.throwIfDisposed(),eO(this,e)},_D.prototype.resizeBilinear=function(e,t,n){return this.throwIfDisposed(),MO(this,e,t,n)},_D.prototype.resizeNearestNeighbor=function(e,t,n){return this.throwIfDisposed(),NO(this,e,t,n)},_D.prototype.reverse=function(e){return this.throwIfDisposed(),cO(this,e)},_D.prototype.rfft=function(){return this.throwIfDisposed(),oO(this)};var VU=EP({round_:function(e){var t={x:CP(e,"x","round")};return BD.runKernel(_R,t)}});_D.prototype.round=function(){return this.throwIfDisposed(),VU(this)},_D.prototype.rsqrt=function(){return this.throwIfDisposed(),lz(this)};var WU=EP({selu_:function(e){var t={x:CP(e,"x","selu")};return BD.runKernel(TR,t)}});_D.prototype.selu=function(){return this.throwIfDisposed(),WU(this)};var GU=EP({separableConv2d_:function(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[1,1],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NHWC",s=CP(e,"x","separableConv2d"),u=CP(t,"depthwiseFilter","separableConv2d"),c=CP(n,"pointwiseFilter","separableConv2d"),l=s,h=!1;if(3===s.rank&&(h=!0,l=eO(s,[1,s.shape[0],s.shape[1],s.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");VA(4===l.rank,(function(){return"Error in separableConv2d: input must be rank 4, but got "+"rank ".concat(l.rank,".")})),VA(4===u.rank,(function(){return"Error in separableConv2d: depthwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),VA(4===c.rank,(function(){return"Error in separableConv2d: pointwise filter must be rank 4, but "+"got rank ".concat(u.rank,".")})),VA(1===c.shape[0],(function(){return"Error in separableConv2d: the first dimension of pointwise filter "+" must be 1, but got ".concat(c.shape[0],".")})),VA(1===c.shape[1],(function(){return"Error in separableConv2d: the second dimension of pointwise "+"filter must be 1, but got ".concat(c.shape[1],".")}));var f=u.shape[2],d=u.shape[3];VA(c.shape[2]===f*d,(function(){return"Error in separableConv2d: the third dimension of pointwise filter "+"must be ".concat(f*d,", ")+"but got ".concat(c.shape[2],".")}));var p=dU(l,u,r,a,o,i),v=1,m=WF(p,c,v,"valid",o);return h?eO(m,[m.shape[1],m.shape[2],m.shape[3]]):m}});_D.prototype.separableConv2d=function(e,t,n,r,a,i){return this.throwIfDisposed(),GU(this,e,t,n,r,a,i)},_D.prototype.sigmoid=function(){return this.throwIfDisposed(),yB(this)};var jU=EP({sign_:function(e){var t={x:CP(e,"x","sign")};return BD.runKernel(MR,t)}});_D.prototype.sign=function(){return this.throwIfDisposed(),jU(this)},_D.prototype.sin=function(){return this.throwIfDisposed(),XF(this)},_D.prototype.sinh=function(){return this.throwIfDisposed(),YF(this)},_D.prototype.slice=function(e,t){return this.throwIfDisposed(),tO(this,e,t)};var qU=EP({softmax_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,n=CP(e,"logits","softmax","float32");if(-1===t&&(t=n.rank-1),t!==n.rank-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(n.rank," and dim was ").concat(t));var r={logits:n},a={dim:t};return BD.runKernel(FR,r,a)}});_D.prototype.softmax=function(e){return this.throwIfDisposed(),qU(this,e)},_D.prototype.softplus=function(){return this.throwIfDisposed(),AU(this)},_D.prototype.spaceToBatchND=function(e,t){return this.throwIfDisposed(),NF(this,e,t)},_D.prototype.split=function(e,t){return this.throwIfDisposed(),nO(this,e,t)},_D.prototype.sqrt=function(){return this.throwIfDisposed(),rL(this)},_D.prototype.square=function(){return this.throwIfDisposed(),aL(this)},_D.prototype.squaredDifference=function(e){return this.throwIfDisposed(),AL(this,e)},_D.prototype.squaredDifferenceStrict=function(e){return this.throwIfDisposed(),YB(this,e)},_D.prototype.squeeze=function(e){return this.throwIfDisposed(),uL(this,e)},_D.prototype.stack=function(e,t){this.throwIfDisposed();var n=e instanceof _D?[this,e]:[this].concat(Tt(e));return BO(n,t)},_D.prototype.step=function(e){return this.throwIfDisposed(),nF(this,e)};var HU=EP({stridedSlice_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0,u=arguments.length>8&&void 0!==arguments[8]?arguments[8]:0,c=CP(e,"x","stridedSlice"),l={x:c},h={begin:t,end:n,strides:r,beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u};return BD.runKernel(VR,l,h)}});_D.prototype.stridedSlice=function(e,t,n,r,a,i,o,s){return this.throwIfDisposed(),HU(this,e,t,n,r,a,i,o,s)},_D.prototype.subStrict=function(e){return this.throwIfDisposed(),QB(this,e)},_D.prototype.sub=function(e){return this.throwIfDisposed(),UO(this,e)},_D.prototype.sum=function(e,t){return this.throwIfDisposed(),iL(this,e,t)};var XU=EP({tan_:function(e){var t={x:CP(e,"x","tan")};return BD.runKernel(WR,t)}});_D.prototype.tan=function(){return this.throwIfDisposed(),XU(this)};var KU=EP({tanh_:function(e){var t={x:CP(e,"x","tanh")};return BD.runKernel(GR,t)}});_D.prototype.tanh=function(){return this.throwIfDisposed(),KU(this)},_D.prototype.tile=function(e){return this.throwIfDisposed(),dL(this,e)},_D.prototype.toBool=function(){return this.throwIfDisposed(),IP(this,"bool")},_D.prototype.toFloat=function(){return this.throwIfDisposed(),IP(this,"float32")},_D.prototype.toInt=function(){return this.throwIfDisposed(),IP(this,"int32")};var YU=EP({topk_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=CP(e,"x","topk");if(0===r.rank)throw new Error("topk() expects the input to be of rank 1 or higher");var a=r.shape[r.shape.length-1];if(t>a)throw new Error("'k' passed to topk() must be <= the last dimension (".concat(a,") ")+"but got ".concat(t));var i={x:r},o={k:t,sorted:n},s=BD.runKernel(qR,i,o),u=f(s,2),c=u[0],l=u[1];return{values:c,indices:l}}});_D.prototype.topk=function(e,t){return this.throwIfDisposed(),YU(this,e,t)},_D.prototype.transpose=function(e){return this.throwIfDisposed(),yL(this,e)};var QU=EP({unique_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=CP(e,"x","unique","string_or_numeric");VA(n.rank>0,(function(){return"The input tensor must be at least 1D"}));var r={x:n},a={axis:t},i=BD.runKernel(XR,r,a),o=f(i,2),s=o[0],u=o[1];return{values:s,indices:u}}});function ZU(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&VA("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors in the CPU backend.")}))}))}_D.prototype.unique=function(e){return this.throwIfDisposed(),QU(this,e)},_D.prototype.unsortedSegmentSum=function(e,t){return this.throwIfDisposed(),fz(this,e,t)},_D.prototype.unstack=function(e){return this.throwIfDisposed(),VO(this,e)},_D.prototype.where=function(e,t){return this.throwIfDisposed(),GO(e,this,t)},_D.prototype.zerosLike=function(){return this.throwIfDisposed(),aO(this)};var JU=function(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=kP(e,"int32"),i=kP([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()},$U=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this)).blockSize=48,e.firstUse=!0,e.data=new FA(ir(e),lL()),e}return Jn(n,[{key:"write",value:function(e,t,n){this.firstUse&&(this.firstUse=!1,mM().get("IS_NODE")&&function(){var e;mM().getBool("IS_TEST")||(e=console).warn.apply(e,arguments)}("\n============================\nHi there \ud83d\udc4b. Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));var r={};return this.data.set(r,{values:e,dtype:n,refCount:1}),r}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&eM(n[0])){var a=n.map((function(e){return yD(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return{dataId:r,shape:e,dtype:t}}},{key:"incRef",value:function(e){this.data.get(e).refCount++}},{key:"decRef",value:function(e){this.data.has(e)&&this.data.get(e).refCount--}},{key:"move",value:function(e,t,n,r){this.data.set(e,{values:t,dtype:r,refCount:1})}},{key:"numDataIds",value:function(){return this.data.numDataIds()}},{key:"read",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.readSync(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"readSync",value:function(e){var t=this.data.get(e),n=t.dtype,r=t.complexTensorInfos;return"complex64"===n?cF(this.readSync(r.real.dataId),this.readSync(r.imag.dataId)):this.data.get(e).values}},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return bD(e)}))}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return kP(e.shape,e.dtype,n)}},{key:"makeOutput",value:function(e,t,n){var r=this.write(e,t,n);return lL().makeTensorFromDataId(r,t,n,this)}},{key:"disposeData",value:function(e){if(this.data.has(e)){var t=this.data.get(e).complexTensorInfos;null!=t&&(this.disposeData(t.real.dataId),this.disposeData(t.imag.dataId)),this.data.delete(e)}}},{key:"disposeIntermediateTensorInfo",value:function(e){var t=e.dataId;if(this.data.has(t)){var n=this.data.get(t);n.refCount--,n.refCount<1&&this.disposeData(t)}}},{key:"time",value:function(){var e=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=gD(),t(),r=gD()-n,e.abrupt("return",{kernelMs:r});case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}},{key:"where",value:function(e){ZU([e],"where");var t=this.readSync(e.dataId);return JU(e.shape,t)}},{key:"dispose",value:function(){}},{key:"floatPrecision",value:function(){return 32}},{key:"epsilon",value:function(){return ja(nr(n.prototype),"epsilon",this).call(this)}}]),n}(zA);function eV(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(ZU(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");for(var u=o,c=u.data.get(s.dataId).values,l=qA(s.shape),h=n||s.dtype,f=ZA(h,l),d=0;d<l;++d)f[d]=t(c[d],i);return u.makeTensorInfo(s.shape,h,f)}}function tV(e,t,n){return function(r){var a=r.inputs,i=r.attrs,o=r.backend,s=a.x;if(ZU(s,e),"string"===s.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");var u=o,c=u.data.get(s.dataId).values,l=n||s.dtype,h=t(c,l,i);return u.makeTensorInfo(s.shape,l,h)}}!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;BD.registerBackend(e,t,n)}("cpu",(function(){return new $U}),1);var nV=eV(hN,(function(e){return e>=0?e:Math.exp(e)-1})),rV={kernelName:hN,backendName:"cpu",kernelFunc:nV};function aV(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var iV={kernelName:TN,backendName:"cpu",kernelFunc:aV};function oV(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha;ZU([a],"leakyRelu");for(var o=qA(a.shape),s=n.data.get(a.dataId).values,u=QA("float32",o),c=0;c<s.length;c++)u[c]=s[c]<0?i*s[c]:s[c];return n.makeTensorInfo(a.shape,"float32",u)}var sV={kernelName:RN,backendName:"cpu",kernelFunc:oV};function uV(e){return function(t,n,r,a,i){var o=PO(t,n),s=o.length,u=rM(o),c=QA(i,qA(o)),l=t.length,h=n.length,f=rM(t),d=rM(n),p=RO(t,o),v=RO(n,o);if(p.length+v.length===0)for(var m=0;m<c.length;++m)c[m]=e(r[m%r.length],a[m%a.length]);else for(var g=function(t){var n=hM(t,s,u),i=n.slice(-l);p.forEach((function(e){return i[e]=0}));var o=lM(i,l,f),m=n.slice(-h);v.forEach((function(e){return m[e]=0}));var g=lM(m,h,d);c[t]=e(r[o],a[g])},y=0;y<c.length;++y)g(y);return[c,o]}}var cV=uV((function(e,t){return e<0?t*e:e}));function lV(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha;ZU([r,a],"prelu");var i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=f(cV(r.shape,a.shape,i,o,r.dtype),2),u=s[0],c=s[1];return n.makeTensorInfo(c,r.dtype,u)}var hV={kernelName:lR,backendName:"cpu",kernelFunc:lV},fV=eV(vR,(function(e){return Math.max(0,e)})),dV={kernelName:vR,backendName:"cpu",kernelFunc:fV},pV=eV(kR,(function(e){return Math.min(Math.max(0,e),6)})),vV={kernelName:kR,backendName:"cpu",kernelFunc:pV};function mV(e,t,n,r,a){if("linear"===n)return aV({inputs:{x:t},backend:e});if("relu"===n)return fV({inputs:{x:t},backend:e});if("elu"===n)return nV({inputs:{x:t},backend:e});if("relu6"===n)return pV({inputs:{x:t},backend:e});if("prelu"===n)return lV({inputs:{x:t,alpha:r},backend:e});if("leakyrelu"===n)return oV({inputs:{x:t},backend:e,attrs:{alpha:a}});throw new Error("Activation ".concat(n," has not been implemented for the CPU backend."))}function gV(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.data.get(r.dataId).values,o=n.data.get(a.dataId).values,s=n.makeTensorInfo(r.shape,"complex64");return n.data.get(s.dataId).complexTensorInfos={real:n.makeTensorInfo(r.shape,"float32",i),imag:n.makeTensorInfo(a.shape,"float32",o)},s}var yV={kernelName:jM,backendName:"cpu",kernelFunc:gV};function bV(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"float32";if("complex64"===n){var r=bV(e,t,"float32"),a=bV(e,t,"float32");return gV({inputs:{real:r,imag:a},backend:e})}var i=sM(qA(t),n);return e.makeTensorInfo(t,n,i)}function xV(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.real,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var kV={kernelName:dR,backendName:"cpu",kernelFunc:xV};function wV(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dtype;if("complex64"===i){if("complex64"===a.dtype)return aV({inputs:{x:a},backend:n});var o=bV(n,a.shape,a.dtype),s=wV({inputs:{x:a},backend:n,attrs:{dtype:"float32"}}),u=gV({inputs:{real:s,imag:o},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}if("complex64"===a.dtype){var c=xV({inputs:{input:a},backend:n}),l=wV({inputs:{x:c},backend:n,attrs:{dtype:i}});return n.disposeIntermediateTensorInfo(c),l}if(!JA(a.dtype,i)){var h=aV({inputs:{x:a},backend:n});return{dataId:h.dataId,shape:h.shape,dtype:i}}if("int32"===i){var d=n.data.get(a.dataId).values,p=Int32Array.from(d);return n.makeTensorInfo(a.shape,"int32",p)}if("bool"===i){var v=n.data.get(a.dataId).values,m=mD([0],a.dtype),g=uV((function(e,t){return e!==t?1:0}))(a.shape,[],v,m,"bool"),y=f(g,2),b=y[0],x=y[1];return n.makeTensorInfo(x,"bool",b)}throw new Error("Error in Cast: failed to cast ".concat(a.dtype," to ").concat(i))}var _V={kernelName:VM,backendName:"cpu",kernelFunc:wV};function SV(e,t,n,r){return null==n?function(n){var a=n.inputs,i=n.backend,o=a.a,s=a.b,u=i;ZU([o,s],e);var c=u.data.get(o.dataId).values,l=u.data.get(s.dataId).values,h=r||o.dtype,d=f(t(o.shape,s.shape,c,l,h),2),p=d[0],v=d[1];return u.makeTensorInfo(v,h,p)}:function(e){var a=e.inputs,i=e.backend,o=a.a,s=a.b,u=i;if("complex64"===o.dtype||"complex64"===s.dtype){var c=wV({inputs:{x:o},backend:u,attrs:{dtype:"complex64"}}),l=u.data.get(c.dataId),h=l.complexTensorInfos.real,d=l.complexTensorInfos.imag,p=u.data.get(h.dataId).values,v=u.data.get(d.dataId).values,m=wV({inputs:{x:s},backend:u,attrs:{dtype:"complex64"}}),g=u.data.get(m.dataId),y=g.complexTensorInfos.real,b=g.complexTensorInfos.imag,x=u.data.get(y.dataId).values,k=u.data.get(b.dataId).values,w=f(n(o.shape,s.shape,p,v,x,k),3),_=w[0],S=w[1],C=w[2],T=u.makeTensorInfo(C,"float32",_),E=u.makeTensorInfo(C,"float32",S),I=gV({inputs:{real:T,imag:E},backend:u});return u.disposeIntermediateTensorInfo(c),u.disposeIntermediateTensorInfo(m),u.disposeIntermediateTensorInfo(T),u.disposeIntermediateTensorInfo(E),I}var A=u.data.get(o.dataId).values,M=u.data.get(s.dataId).values,N=r||o.dtype,R=f(t(o.shape,s.shape,A,M,N),2),D=R[0],P=R[1];return u.makeTensorInfo(P,N,D)}}function CV(e){return function(t,n,r,a,i,o){var s=PO(t,n),u=qA(s),c=s.length,l=rM(s),h=QA("float32",u),f=QA("float32",u),d=RO(t,s),p=RO(n,s),v=cF(r,a),m=cF(i,o),g=t.length,y=rM(t),b=n.length,x=rM(n);if(d.length+p.length===0)for(var k=0;k<h.length;k++){var w=k%v.length,_=k%m.length,S=e(v[2*w],v[2*w+1],m[2*_],m[2*_+1]);h[k]=S.real,f[k]=S.imag}else for(var C=function(t){var n=hM(t,c,l),r=n.slice(-g);d.forEach((function(e){return r[e]=0}));var a=lM(r,g,y),i=n.slice(-b);p.forEach((function(e){return i[e]=0}));var o=lM(i,b,x),s=e(v[2*a],v[2*a+1],m[2*o],m[2*o+1]);h[t]=s.real,f[t]=s.imag},T=0;T<h.length;T++)C(T);return[h,f,s]}}var TV=uV((function(e,t){return e+t})),EV=CV((function(e,t,n,r){return{real:e+n,imag:t+r}})),IV=SV(SM,TV,EV),AV={kernelName:SM,backendName:"cpu",kernelFunc:IV};function MV(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=qA(a.shape),s=function(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}(i,o),u=qA(s);VA(o===u,(function(){return"The new shape (".concat(s,") has ").concat(u," elements and the old ")+"shape (".concat(a.shape,") has ").concat(o," elements. The new shape and old ")+"shape must have the same number of elements."})),n.incRef(a.dataId);var c=n.data.get(a.dataId);if(null!=c.complexTensorInfos){var l=c.complexTensorInfos.real,h=c.complexTensorInfos.imag;l.shape=s,h.shape=s}return{dataId:a.dataId,shape:s,dtype:a.dtype}}var NV={kernelName:mR,backendName:"cpu",kernelFunc:MV};function RV(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=r.transposeA,s=r.transposeB;ZU([a,i],"matMul");var u=a.shape.length,c=i.shape.length,l=o?a.shape[u-2]:a.shape[u-1],h=s?i.shape[c-1]:i.shape[c-2],d=o?a.shape[u-1]:a.shape[u-2],p=s?i.shape[c-2]:i.shape[c-1],v=a.shape.slice(0,-2),m=i.shape.slice(0,-2),g=qA(v),y=qA(m);VA(u>=2&&c>=2&&(g===y||1===g||1===y),(function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input "+"batch dimensions of (".concat(v,") and (").concat(m,").")}));var b=(g>y?a.shape.slice(0,-2):i.shape.slice(0,-2)).concat([d,p]);VA(l===h,(function(){return"Error in matMul: inner shapes (".concat(l,") and (")+"".concat(h,") of Tensors with shapes ").concat(a.shape," and ")+"".concat(i.shape," and transposeA=").concat(o)+" and transposeB=".concat(s," must match.")}));for(var x=s?[y,p,h]:[y,h,p],k=MV({inputs:{x:a},backend:n,attrs:{shape:o?[g,l,d]:[g,d,l]}}),w=MV({inputs:{x:i},backend:n,attrs:{shape:x}}),_=o?k.shape[1]:k.shape[2],S=o?k.shape[2]:k.shape[1],C=s?w.shape[1]:w.shape[2],T=Math.max(g,y),E=n.data.get(k.dataId).values,I=n.data.get(w.dataId).values,A=rM(k.shape),M=rM(w.shape),N=f(o?[A[0],1,A[1]]:[A[0],A[1],1],3),R=N[0],D=N[1],P=N[2],O=f(s?[1,M[1],M[0]]:[M[1],1,M[0]],3),L=O[0],F=O[1],z=O[2],B=S*C,U=kP([T,S,C],k.dtype),V=U.values,W=n.blockSize,G=0;G<T;G++)for(var j=0;j<S;j+=W)for(var q=0;q<C;q+=W)for(var H=0;H<_;H+=W)for(var X=Math.min(j+W,S),K=Math.min(q+W,C),Y=Math.min(H+W,_),Q=j;Q<X;Q++)for(var Z=q;Z<K;Z++){for(var J=0,$=H;$<Y;$++){var ee=Math.min(G,g-1)*R,te=Math.min(G,y-1)*z;J+=E[ee+Q*D+$*P]*I[$*L+Z*F+te]}V[G*B+(Q*C+Z)]+=J}return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(w),n.makeTensorInfo(b,U.dtype,U.values)}var DV={kernelName:BM,backendName:"cpu",kernelFunc:RV};var PV={kernelName:"_FusedMatMul",backendName:"cpu",kernelFunc:function(e){var t,n,r,a=e.inputs,i=e.backend,o=e.attrs,s=a.a,u=a.b,c=a.bias,l=a.preluActivationWeights,h=o.transposeA,f=o.transposeB,d=o.activation,p=o.leakyreluAlpha,v=[];t=RV({inputs:{a:s,b:u},attrs:{transposeA:h,transposeB:f},backend:i}),c&&(n=IV({inputs:{a:t,b:c},backend:i}),v.push(t),t=n),d&&(r=mV(i,t,d,l,p),v.push(t),t=r);for(var m=0,g=v;m<g.length;m++){var y=g[m];i.disposeIntermediateTensorInfo(y)}return t}};function OV(e){for(var t=new Float32Array(e.length),n=0;n<e.length;++n)t[n]=Math.abs(e[n]);return t}var LV={kernelName:kM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs.x,n=e.backend;ZU(t,"abs");var r=new Float32Array(qA(t.shape));return r=OV(n.data.get(t.dataId).values),n.makeOutput(r,t.shape,"float32")}},FV=eV(wM,(function(e){return Math.acos(e)})),zV={kernelName:wM,backendName:"cpu",kernelFunc:FV},BV=eV(_M,(function(e){return Math.acosh(e)})),UV={kernelName:_M,backendName:"cpu",kernelFunc:BV};var VV={kernelName:CM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t;ZU(t,"addN");for(var a=r.map((function(e){return n.data.get(e.dataId).values})),i=kP(r[0].shape,r[0].dtype),o=i.values,s=0;s<r.length;s++)for(var u=a[s],c=0;c<o.length;c++)o[c]+=u[c];return n.makeTensorInfo(i.shape,i.dtype,i.values)}};function WV(e,t,n,r,a){for(var i=t.length,o=qA(t),s=rM(t),u=rM(a),c=QA(n,qA(a)),l=0;l<o;++l){for(var h=hM(l,i,s),f=new Array(h.length),d=0;d<f.length;d++)f[d]=h[r[d]];c[lM(f,i,u)]=e[l]}return c}function GV(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.perm;ZU(a,"transpose");for(var o=a.shape.length,s=new Array(o),u=0;u<s.length;u++)s[u]=a.shape[i[u]];var c=WV(r.data.get(a.dataId).values,a.shape,a.dtype,i,s);return{dataId:r.write(c,s,a.dtype),shape:s,dtype:a.dtype}}var jV={kernelName:HR,backendName:"cpu",kernelFunc:GV};var qV={kernelName:TM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;ZU(a,"all");var s=YA(i,a.shape),u=s,c=ZO(u,a.shape.length),l=a;null!=c&&(l=GV({inputs:{x:a},backend:n,attrs:{perm:c}}),u=$O(u.length,a.shape.length)),QO("all",u,l.shape.length);for(var h=f(KO(l.shape,u),2),d=h[0],p=qA(h[1]),v=sM(qA(d),l.dtype),m=n.data.get(l.dataId).values,g=0;g<v.length;++g){for(var y=g*p,b=m[y],x=0;x<p;++x){var k=m[y+x];b=b&&k}v[g]=b}null!=c&&n.disposeIntermediateTensorInfo(l);var w=n.makeTensorInfo(d,l.dtype,v);if(o){var _=MV({inputs:{x:w},backend:n,attrs:{shape:YO(d,s)}});return n.disposeIntermediateTensorInfo(w),_}return w}};var HV={kernelName:EM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;ZU(a,"any");var s=YA(i,a.shape),u=s,c=ZO(u,a.shape.length),l=a;null!=c&&(l=GV({inputs:{x:a},backend:n,attrs:{perm:c}}),u=$O(u.length,a.shape.length)),QO("any",u,l.shape.length);for(var h=f(KO(l.shape,u),2),d=h[0],p=qA(h[1]),v=sM(qA(d),l.dtype),m=n.data.get(l.dataId).values,g=0;g<v.length;++g){for(var y=g*p,b=m[y],x=0;x<p;++x){var k=m[y+x];b=b||k}v[g]=b}null!=c&&n.disposeIntermediateTensorInfo(l);var w=n.makeTensorInfo(d,l.dtype,v);if(o){var _=MV({inputs:{x:w},backend:n,attrs:{shape:YO(d,s)}});return n.disposeIntermediateTensorInfo(w),_}return w}};var XV={kernelName:IM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;ZU(a,"argMax");var o=YA(i,a.shape),s=ZO(o,a.shape.length),u=a,c=[];null!=s&&(u=GV({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=$O(o.length,u.shape.length)),QO("argMax",o=[o[0]],u.shape.length);for(var l=f(KO(u.shape,o),2),h=l[0],d=l[1],p=sM(qA(h),"int32"),v=qA(d),m=n.data.get(u.dataId).values,g=0;g<p.length;++g){for(var y=g*v,b=m[y],x=0,k=0;k<v;++k){var w=m[y+k];w>b&&(b=w,x=k)}p[g]=x}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(h,"int32",p)}};var KV={kernelName:AM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis;ZU(a,"argMin");var o=YA(i,a.shape),s=ZO(o,a.shape.length),u=a,c=[];null!=s&&(u=GV({inputs:{x:a},backend:n,attrs:{perm:s}}),c.push(u),o=$O(o.length,u.shape.length)),QO("argMin",o=[o[0]],u.shape.length);for(var l=f(KO(u.shape,o),2),h=l[0],d=l[1],p=sM(qA(h),"int32"),v=qA(d),m=n.data.get(u.dataId).values,g=0;g<p.length;++g){for(var y=g*v,b=m[y],x=0,k=0;k<v;++k){var w=m[y+k];w<b&&(b=w,x=k)}p[g]=x}return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(h,"int32",p)}},YV=eV(MM,(function(e){return Math.asin(e)})),QV={kernelName:MM,backendName:"cpu",kernelFunc:YV},ZV=eV(NM,(function(e){return Math.asinh(e)})),JV={kernelName:NM,backendName:"cpu",kernelFunc:ZV},$V=eV(RM,(function(e){return Math.atan(e)})),eW={kernelName:RM,backendName:"cpu",kernelFunc:$V},tW=uV((function(e,t){return Math.atan2(e,t)})),nW=SV(PM,tW),rW={kernelName:PM,backendName:"cpu",kernelFunc:nW},aW=eV(DM,(function(e){return Math.atanh(e)})),iW={kernelName:DM,backendName:"cpu",kernelFunc:aW};function oW(e,t,n,r,a,i){for(var o=a.strideHeight,s=a.strideWidth,u=a.dilationHeight,c=a.dilationWidth,l=a.effectiveFilterHeight,h=a.effectiveFilterWidth,f=a.padInfo.top,d=a.padInfo.left,p="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=kP(a.outShape,n),m=v.values,g=a.outShape[1]*a.outShape[2]*a.outShape[3],y=a.outShape[2]*a.outShape[3],b=a.outShape[3],x=0;x<a.batchSize;++x)for(var k=x*g,w=x*r[0],_=0;_<a.inChannels;++_)for(var S=0;S<a.outHeight;++S)for(var C=S*o-f,T=Math.max(0,C),E=Math.min(a.inHeight,l+C),I=k+S*y,A=0;A<a.outWidth;++A){for(var M=A*s-d,N=Math.max(0,M),R=Math.min(a.inWidth,h+M),D=p,P=0,O=0,L=T;L<E;L+=u){for(var F=w+L*r[1],z=N;z<R;z+=c){var B=e[F+z*r[2]+_];"max"===i&&B>D?D=B:"avg"===i&&(P+=B,O++)}if(isNaN(D))break}m[I+A*b+_]="avg"===i?P/O:D}return v}function sW(e,t,n,r){for(var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4],i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=kP(r.outShape,"int32"),s=r.strideHeight,u=r.strideWidth,c=r.dilationHeight,l=r.dilationWidth,h=r.effectiveFilterHeight,f=r.effectiveFilterWidth,d=r.padInfo.top,p=r.padInfo.left,v=kP(t,n,e),m=0;m<r.batchSize;++m)for(var g=0;g<r.inChannels;++g)for(var y=0;y<r.outHeight;++y){for(var b=y*s-d,x=b;x<0;)x+=c;for(var k=Math.min(r.inHeight,h+b),w=0;w<r.outWidth;++w){for(var _=w*u-p,S=_;S<0;)S+=l;for(var C=Math.min(r.inWidth,f+_),T=Number.NEGATIVE_INFINITY,E=-1,I=x;I<k;I+=c)for(var A=I-b,M=S;M<C;M+=l){var N=M-_,R=v.get(m,I,M,g);R>T&&(T=R,E=a?i?((m*r.inHeight+I)*r.inWidth+M)*r.inChannels+g:(I*r.inWidth+M)*r.inChannels+g:A*f+N)}o.set(E,m,y,w,g)}}return o}function uW(e,t,n,r,a,i){for(var o=a.strideDepth,s=a.strideHeight,u=a.strideWidth,c=a.dilationDepth,l=a.dilationHeight,h=a.dilationWidth,f=a.effectiveFilterDepth,d=a.effectiveFilterHeight,p=a.effectiveFilterWidth,v=a.padInfo.front,m=a.padInfo.top,g=a.padInfo.left,y="max"===i?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,b=kP(a.outShape,n),x=b.values,k=a.outShape[1]*a.outShape[2]*a.outShape[3]*a.outShape[4],w=a.outShape[2]*a.outShape[3]*a.outShape[4],_=a.outShape[3]*a.outShape[4],S=a.outShape[4],C=0;C<a.batchSize;++C)for(var T=C*k,E=C*r[0],I=0;I<a.inChannels;++I)for(var A=0;A<a.outDepth;++A){for(var M=A*o-v,N=M;N<0;)N+=c;for(var R=Math.min(a.inDepth,f+M),D=T+A*w,P=0;P<a.outHeight;++P){for(var O=P*s-m,L=O;L<0;)L+=l;for(var F=Math.min(a.inHeight,d+O),z=D+P*_,B=0;B<a.outWidth;++B){for(var U=B*u-g,V=U;V<0;)V+=h;for(var W=Math.min(a.inWidth,p+U),G=z+B*S,j=y,q=0,H=0,X=N;X<R;X+=c){for(var K=E+X*r[1],Y=L;Y<F;Y+=l){for(var Q=K+Y*r[2],Z=V;Z<W;Z+=h){var J=e[Q+Z*r[3]+I];if("max"===i&&J>j?j=J:"avg"===i&&(q+=J,H++),isNaN(j))break}if(isNaN(j))break}if(isNaN(j))break}x[G+I]="avg"===i?q/H:j}}}return b}var cW={kernelName:OM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;ZU(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;VA(QL(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=zL(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&HA(l.inShape,l.outShape))c=aV({inputs:{x:a},backend:n});else{var h=n.data.get(a.dataId).values,f=rM(a.shape),d=oW(h,a.shape,a.dtype,f,l,"avg");c=n.makeTensorInfo(l.outShape,a.dtype,d.values)}return c}};var lW={kernelName:FM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=r.dilations;ZU(a,"avgPool3d");var h=l;null==h&&(h=[1,1,1]);var f=BL(a.shape,i,o,h,s,u,c),d=uW(n.data.get(a.dataId).values,a.shape,a.dtype,rM(a.shape),f,"avg");return n.makeTensorInfo(d.shape,"float32",d.values)}};var hW={kernelName:zM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dilations,l=r.dimRoundingMode;ZU([a,i],"avgPool3DGrad");for(var h=BL(i.shape,o,s,c,u,l),f=h.strideDepth,d=h.strideHeight,p=h.strideWidth,v=h.filterDepth,m=h.filterHeight,g=h.filterWidth,y=h.dilationDepth,b=h.dilationHeight,x=h.dilationWidth,k=h.effectiveFilterDepth,w=h.effectiveFilterHeight,_=h.effectiveFilterWidth,S=k-1-h.padInfo.front,C=_-1-h.padInfo.left,T=w-1-h.padInfo.top,E=kP(i.shape,"float32"),I=1/(v*m*g),A=n.bufferSync(a),M=0;M<h.batchSize;++M)for(var N=0;N<h.inChannels;++N)for(var R=0;R<h.inDepth;++R)for(var D=0;D<h.inHeight;++D)for(var P=0;P<h.inWidth;++P){for(var O=R-S,L=D-T,F=P-C,z=0,B=0;B<k;B+=y){var U=(O+B)/f;if(!(U<0||U>=h.outDepth||Math.floor(U)!==U))for(var V=0;V<w;V+=b){var W=(L+V)/d;if(!(W<0||W>=h.outHeight||Math.floor(W)!==W))for(var G=0;G<_;G+=x){var j=(F+G)/p;if(!(j<0||j>=h.outWidth||Math.floor(j)!==j))z+=A.get(M,U,W,j,N)}}}E.set(z*I,M,R,D,P,N)}return n.makeTensorInfo(E.shape,E.dtype,E.values)}};var fW={kernelName:LM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;ZU([a,i],"avgPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=zL(o.shape,s,u,1,c),h=l.strideHeight,f=l.strideWidth,d=l.filterHeight,p=l.filterWidth,v=l.dilationHeight,m=l.dilationWidth,g=l.effectiveFilterHeight,y=l.effectiveFilterWidth,b=y-1-l.padInfo.left,x=g-1-l.padInfo.top,k=kP(o.shape,"float32"),w=1/(d*p),_=n.data.get(a.dataId).values,S=kP(a.shape,"float32",_),C=0;C<l.batchSize;++C)for(var T=0;T<l.inChannels;++T)for(var E=0;E<l.inHeight;++E)for(var I=0;I<l.inWidth;++I){for(var A=E-x,M=I-b,N=0,R=0;R<g;R+=v){var D=(A+R)/h;if(!(D<0||D>=l.outHeight||Math.floor(D)!==D))for(var P=0;P<y;P+=m){var O=(M+P)/f;if(!(O<0||O>=l.outWidth||Math.floor(O)!==O))N+=S.get(C,D,O,T)}}k.set(N*w,C,E,I,T)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}};var dW={kernelName:wN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.scale,o=t.offset,s=t.mean,u=t.variance;VA(s.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),VA(null==o||s.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),VA(null==i||s.shape.length===i.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."})),ZU([a,s,u,i,o],"batchNorm");var c=r.varianceEpsilon;null==c&&(c=.001);for(var l=n.data.get(a.dataId).values,h=n.data.get(s.dataId).values,f=n.data.get(u.dataId).values,d=i?n.data.get(i.dataId).values:new Float32Array([1]),p=o?n.data.get(o.dataId).values:new Float32Array([0]),v=new Float32Array(l.length),m=p.length,g=d.length,y=f.length,b=h.length,x=0,k=0,w=0,_=0,S=0;S<l.length;++S)v[S]=p[x++]+(l[S]-h[k++])*d[w++]/Math.sqrt(f[_++]+c),x>=m&&(x=0),k>=b&&(k=0),w>=g&&(w=0),_>=y&&(_=0);return n.makeTensorInfo(a.shape,a.dtype,v)}};function pW(e,t,n,r,a){var i=function(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}(r,t,n),o=qA(n),s=rM(r);if(i){var u=function(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}(t,s);return"string"===a?e.slice(u,u+o):e.subarray(u,u+o)}for(var c=kP(r,a,"string"===a?dF(e):e),l=kP(n,a),h=0;h<l.size;++h){var f=l.indexToLoc(h),d=f.map((function(e,n){return e+t[n]}));l.set.apply(l,[c.get.apply(c,Tt(d))].concat(Tt(f)))}return"string"===a?l.values.map((function(e){return yD(e)})):l.values}function vW(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.size;ZU(a,"slice");var s=f(KP(a,i,o),2),u=s[0],c=s[1];!function(e,t,n){var r=e.shape.length;VA(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,").")})),VA(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,").")}));for(var a=function(a){VA(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] ")+"(".concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}(a,u,c);var l=pW(n.data.get(a.dataId).values,u,c,a.shape,a.dtype);return n.makeTensorInfo(c,a.dtype,l)}var mW={kernelName:ER,backendName:"cpu",kernelFunc:vW};var gW={kernelName:UM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;ZU([a],"batchToSpaceND");var s=i.reduce((function(e,t){return e*t})),u=rF(a.shape,i,s),c=aF(u.length,i.length),l=iF(a.shape,i,s),h=function(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}(o,i.length),f=function(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}(l,o,i.length),d=MV({inputs:{x:a},backend:n,attrs:{shape:u}}),p=GV({inputs:{x:d},backend:n,attrs:{perm:c}}),v=MV({inputs:{x:p},backend:n,attrs:{shape:l}}),m=vW({inputs:{x:v},backend:n,attrs:{begin:h,size:f}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),m}};function yW(e,t,n,r,a){for(var i=qA(r),o=sM(a,n),s=0;s<e.length;s++){var u=e[s];if(u<0)throw new Error("Input x must be non-negative!");u>=a||(o[u]+=i>0?t[s]:1)}return o}function bW(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=e.shape[0],i=e.shape[1],o=kP([a,n],t.dtype),s=0;s<a;s++)for(var u=0;u<i;u++){var c=e.get(s,u);if(c<0)throw new Error("Input x must be non-negative!");c>=n||(r?o.set(1,s,c):t.size>0?o.set(o.get(s,c)+t.get(s,u),s,c):o.set(o.get(s,c)+1,s,c))}return o}var xW={kernelName:"Bincount",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=yW(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,s)}};function kW(e){return function(t,n,r){for(var a=QA(n,t.length),i=0;i<t.length;++i)a[i]=e(t[i],r);return a}}var wW=kW((function(e){return Math.ceil(e)})),_W=tV(WM,wW),SW={kernelName:WM,backendName:"cpu",kernelFunc:_W},CW=eV(GM,(function(e,t){var n=t;return e>n.clipValueMax?n.clipValueMax:e<n.clipValueMin?n.clipValueMin:e})),TW={kernelName:GM,backendName:"cpu",kernelFunc:CW},EW={kernelName:qM,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs.x,n=e.backend,r=new Float32Array(qA(t.shape)),a=n.data.get(t.dataId),i=a.complexTensorInfos.real,o=a.complexTensorInfos.imag,s=n.data.get(i.dataId).values,u=n.data.get(o.dataId).values,c=0;c<s.length;c++){var l=s[c],h=u[c];r[c]=Math.hypot(l,h)}return n.makeOutput(r,t.shape,"float32")}};function IW(e,t,n,r){var a=ZA(n,qA(t));if(r&&"string"!==n){var i=0;e.forEach((function(e){var t=qA(e.shape);a.set(e.vals,i),i+=t}))}else{var o=0;e.forEach((function(e){for(var r="string"===n?dF(e.vals):e.vals,i=0,s=0;s<e.shape[0];++s)for(var u=s*t[1]+o,c=0;c<e.shape[1];++c)a[u+c]=r[i++];o+=e.shape[1]}))}return a}function AW(e){var t=e.inputs,n=e.backend,r=t.input,a=n.data.get(r.dataId).complexTensorInfos.imag,i=n.data.get(a.dataId).values;return n.makeTensorInfo(a.shape,a.dtype,i)}var MW={kernelName:IN,backendName:"cpu",kernelFunc:AW};function NW(e){var t=e.inputs,n=e.backend,r=YA(e.attrs.axis,t[0].shape)[0],a=LL(t.map((function(e){return e.shape})),r);if(0===qA(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter((function(e){return qA(e.shape)>0}));if(1===i.length)return aV({inputs:{x:i[0]},backend:n});if(function(e,t){var n=e[0].length;e.forEach((function(e,t){VA(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")")}))})),VA(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)VA(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(a,".")}))}))}(i.map((function(e){return e.shape})),r),"complex64"===i[0].dtype){var o=i.map((function(e){return xV({inputs:{input:e},backend:n})})),s=i.map((function(e){return AW({inputs:{input:e},backend:n})})),u=NW({inputs:o,backend:n,attrs:{axis:r}}),c=NW({inputs:s,backend:n,attrs:{axis:r}}),l=gV({inputs:{real:u,imag:c},backend:n});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),l}var h=i.map((function(e){var t=qA(e.shape.slice(r));return MV({inputs:{x:e},backend:n,attrs:{shape:[-1,t]}})})),f=h.map((function(e){return{vals:n.data.get(e.dataId).values,shape:e.shape}}));a=LL(h.map((function(e){return e.shape})),1);var d=1===h[0].shape[0],p=IW(f,a,t[0].dtype,d),v=LL(i.map((function(e){return e.shape})),r),m=n.makeTensorInfo(v,t[0].dtype,p);return h.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}var RW={kernelName:HM,backendName:"cpu",kernelFunc:NW};function DW(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dilations,l=r.dimRoundingMode;ZU([a,i],"conv2d");for(var h=ZL(u),f=UL(a.shape,i.shape,o,c,s,l,!1,h),d=f.filterHeight,p=f.filterWidth,v=f.dilationHeight,m=f.dilationWidth,g=f.padInfo.left,y=f.padInfo.top,b="channelsLast"===f.dataFormat,x=new xD(f.outShape,a.dtype),k=rM(a.shape),w=rM(i.shape),_=k[0],S=b?k[1]:k[2],C=b?k[2]:1,T=b?1:k[1],E=x.strides[0],I=b?x.strides[1]:x.strides[2],A=b?x.strides[2]:1,M=b?1:x.strides[1],N=n.data.get(a.dataId).values,R=n.data.get(i.dataId).values,D=x.values,P=0;P<f.batchSize;++P)for(var O=P*_,L=P*E,F=0;F<f.outHeight;++F)for(var z=L+F*I,B=F*f.strideHeight-y,U=0;U<d;++U){var V=B+U*v;if(!(V<0||V>=f.inHeight))for(var W=U*w[0],G=O+V*S,j=0;j<f.outWidth;++j)for(var q=z+j*A,H=j*f.strideWidth-g,X=0;X<p;++X){var K=H+X*m;if(!(K<0||K>=f.inWidth))for(var Y=G+K*C,Q=W+X*w[1],Z=0;Z<f.inChannels;++Z){for(var J=N[Y+Z*T],$=0;$<f.outChannels;++$)D[q+$*M]+=J*R[Q+$];Q+=f.outChannels}}}return n.makeTensorInfo(x.shape,x.dtype,D)}var PW={kernelName:XM,backendName:"cpu",kernelFunc:DW};var OW={kernelName:KM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape;ZU([a,i],"conv2dBackpropFilter");for(var h=ZL(u),f=UL(a.shape,l,o,1,s,c,!1,h),d=f.strideHeight,p=f.strideWidth,v=f.filterHeight,m=f.filterWidth,g="channelsLast"===f.dataFormat,y=new xD(f.filterShape,"float32"),b=f.padInfo.left,x=f.padInfo.top,k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,_=new xD(a.shape,a.dtype,k),S=new xD(i.shape,i.dtype,w),C=0;C<v;++C)for(var T=Math.max(0,Math.ceil((x-C)/d)),E=Math.min(f.outHeight,(f.inHeight+x-C)/d),I=0;I<m;++I)for(var A=Math.max(0,Math.ceil((b-I)/p)),M=Math.min(f.outWidth,(f.inWidth+b-I)/p),N=0;N<f.inChannels;++N)for(var R=0;R<f.outChannels;++R){for(var D=0,P=0;P<f.batchSize;++P)for(var O=T;O<E;++O)for(var L=C+O*d-x,F=A;F<M;++F){var z=I+F*p-b;D+=g?_.get(P,L,z,N)*S.get(P,O,F,R):_.get(P,N,L,z)*S.get(P,R,O,F)}y.set(D,C,I,N,R)}return n.makeTensorInfo(y.shape,y.dtype,y.values)}};var LW={kernelName:YM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode;ZU([a,i],"conv2dBackpropInput");var h=rM(i.shape),d=rM(a.shape),p=ZL(c),v=UL(o,i.shape,s,1,u,l,!1,p),m=new xD(v.inShape,"float32"),g=m.values,y=n.data.get(a.dataId).values,b=n.data.get(i.dataId).values,x=f(h,3),k=x[0],w=x[1],_=x[2],S=v.batchSize,C=v.filterHeight,T=v.filterWidth,E=v.inChannels,I=v.inHeight,A=v.inWidth,M=v.outChannels,N=v.outHeight,R=v.outWidth,D=v.strideHeight,P=v.strideWidth;p=v.dataFormat;for(var O=C-1-v.padInfo.top,L=T-1-v.padInfo.left,F="channelsLast"===p,z=m.strides[0],B=F?m.strides[1]:m.strides[2],U=F?m.strides[2]:1,V=F?1:m.strides[1],W=d[0],G=F?d[1]:d[2],j=F?d[2]:1,q=F?1:d[1],H=0;H<S;++H)for(var X=0;X<E;++X)for(var K=0;K<I;++K)for(var Y=K-O,Q=Math.max(0,Math.ceil(Y/D)),Z=Math.min(N,(C+Y)/D),J=0;J<A;++J){for(var $=J-L,ee=Math.max(0,Math.ceil($/P)),te=Math.min(R,(T+$)/P),ne=0,re=Q;re<Z;++re)for(var ae=re*D-Y,ie=ee;ie<te;++ie)for(var oe=W*H+G*re+j*ie,se=k*(C-1-ae)+w*(T-1-(ie*P-$))+_*X,ue=0;ue<M;++ue){ne+=y[oe+q*ue]*b[se+ue]}g[z*H+B*K+U*J+V*X]=ne}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};var FW={kernelName:QM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations;ZU([a,i],"conv3d");for(var c=VL(a.shape,i.shape,o,u,s),l=c.filterDepth,h=c.filterHeight,f=c.filterWidth,d=c.dilationDepth,p=c.dilationHeight,v=c.dilationWidth,m=c.padInfo,g=m.front,y=m.left,b=m.top,x=new xD(c.outShape,a.dtype),k=n.data.get(a.dataId).values,w=n.data.get(i.dataId).values,_=x.values,S=rM(a.shape),C=rM(i.shape),T=0;T<c.batchSize;++T)for(var E=T*S[0],I=T*x.strides[0],A=0;A<c.outDepth;++A)for(var M=I+A*x.strides[1],N=A*c.strideDepth-g,R=0;R<l;++R){var D=N+R*d;if(!(D<0||D>=c.inDepth))for(var P=R*C[0],O=E+D*S[1],L=0;L<c.outHeight;++L)for(var F=M+L*x.strides[2],z=L*c.strideHeight-b,B=0;B<h;++B){var U=z+B*p;if(!(U<0||U>=c.inHeight))for(var V=P+B*C[1],W=O+U*S[2],G=0;G<c.outWidth;++G)for(var j=F+G*c.outChannels,q=G*c.strideWidth-y,H=0;H<f;++H){var X=q+H*v;if(!(X<0||X>=c.inWidth))for(var K=V+H*C[2],Y=W+X*c.inChannels,Q=K,Z=0;Z<c.inChannels;++Z){for(var J=k[Y+Z],$=0;$<c.outChannels;++$)_[j+$]+=J*w[Q+$];Q+=c.outChannels}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var zW={kernelName:ZM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape;ZU([a,i],"conv3dBackpropFilterV2");for(var c=rM(a.shape),l=rM(i.shape),h=VL(a.shape,u,o,1,s),d=h.strideDepth,p=h.strideHeight,v=h.strideWidth,m=h.filterDepth,g=h.filterHeight,y=h.filterWidth,b=new xD(h.filterShape,"float32"),x=b.values,k=f(b.strides,4),w=k[0],_=k[1],S=k[2],C=k[3],T=n.data.get(i.dataId).values,E=f(l,4),I=E[0],A=E[1],M=E[2],N=E[3],R=n.data.get(a.dataId).values,D=f(c,4),P=D[0],O=D[1],L=D[2],F=D[3],z=h.padInfo.front,B=h.padInfo.left,U=h.padInfo.top,V=0;V<m;++V)for(var W=Math.max(0,Math.ceil((z-V)/d)),G=Math.min(h.outDepth,(h.inDepth+z-V)/d),j=V*w,q=0;q<g;++q)for(var H=Math.max(0,Math.ceil((U-q)/p)),X=Math.min(h.outHeight,(h.inHeight+U-q)/p),K=q*_+j,Y=0;Y<y;++Y)for(var Q=Math.max(0,Math.ceil((B-Y)/v)),Z=Math.min(h.outWidth,(h.inWidth+B-Y)/v),J=Y*S+K,$=0;$<h.inChannels;++$)for(var ee=$*C+J,te=0;te<h.outChannels;++te){for(var ne=0,re=0;re<h.batchSize;++re)for(var ae=re*P,ie=re*I,oe=W;oe<G;++oe)for(var se=(V+oe*d-z)*O+ae,ue=oe*A+ie,ce=H;ce<X;++ce)for(var le=(q+ce*p-U)*L+se,he=ce*M+ue,fe=Q;fe<Z;++fe){var de=fe*N+he;ne+=R[(Y+fe*v-B)*F+le+$]*T[de+te]}x[ee+te]=ne}return n.makeTensorInfo(b.shape,b.dtype,b.values)}};var BW={kernelName:JM,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=r.inputShape;ZU([a],"conv3dBackpropInputV2");for(var c=rM(a.shape),l=rM(i.shape),h=VL(u,i.shape,s,1,o),d=new xD(h.inShape,"float32"),p=d.values,v=f(d.strides,4),m=v[0],g=v[1],y=v[2],b=v[3],x=n.data.get(a.dataId).values,k=f(c,4),w=k[0],_=k[1],S=k[2],C=k[3],T=n.data.get(i.dataId).values,E=f(l,4),I=E[0],A=E[1],M=E[2],N=E[3],R=h.batchSize,D=h.filterDepth,P=h.filterHeight,O=h.filterWidth,L=h.inChannels,F=h.inDepth,z=h.inHeight,B=h.inWidth,U=h.outChannels,V=h.outDepth,W=h.outHeight,G=h.outWidth,j=h.strideDepth,q=h.strideHeight,H=h.strideWidth,X=D-1-h.padInfo.front,K=P-1-h.padInfo.top,Y=O-1-h.padInfo.left,Q=0;Q<R;++Q)for(var Z=0;Z<L;++Z)for(var J=0;J<F;++J)for(var $=J-X,ee=Math.max(0,Math.ceil($/j)),te=Math.min(V,(D+$)/j),ne=0;ne<z;++ne)for(var re=ne-K,ae=Math.max(0,Math.ceil(re/q)),ie=Math.min(W,(P+re)/q),oe=0;oe<B;++oe){for(var se=oe-Y,ue=Math.max(0,Math.ceil(se/H)),ce=Math.min(G,(O+se)/H),le=0,he=ee;he<te;++he)for(var fe=he*j-$,de=ae;de<ie;++de)for(var pe=de*q-re,ve=ue;ve<ce;++ve)for(var me=w*Q+_*he+S*de+C*ve,ge=I*(D-1-fe)+A*(P-1-pe)+M*(O-1-(ve*H-se))+N*Z,ye=0;ye<U;++ye){le+=x[me+ye]*T[ge+ye]}p[m*Q+g*J+y*ne+b*oe+Z]=le}return n.makeTensorInfo(d.shape,d.dtype,d.values)}},UW=eV($M,(function(e){return Math.cos(e)})),VW={kernelName:$M,backendName:"cpu",kernelFunc:UW},WW=eV(eN,(function(e){return Math.cosh(e)})),GW={kernelName:eN,backendName:"cpu",kernelFunc:WW};var jW={kernelName:nN,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=f(a.shape,4),h=l[0],d=l[1],p=l[2],v=l[3],m=i.shape[0],g=f(s,2),y=g[0],b=g[1],x=kP([m,y,b,v],"float32"),k=n.data.get(i.dataId).values,w=n.data.get(o.dataId).values,_=n.data.get(a.dataId).values,S=rM(a.shape),C=rM(x.shape),T=0;T<m;T++){var E=4*T,I=k[E],A=k[E+1],M=k[E+2],N=k[E+3],R=w[T];if(!(R>=h))for(var D=y>1?(M-I)*(d-1)/(y-1):0,P=b>1?(N-A)*(p-1)/(b-1):0,O=0;O<y;O++){var L=y>1?I*(d-1)+O*D:.5*(I+M)*(d-1);if(L<0||L>d-1)for(var F=0;F<b;F++)for(var z=0;z<v;z++){var B=z+F*C[2]+O*C[1]+T*C[0];x.values[B]=c}else if("bilinear"===u)for(var U=Math.floor(L),V=Math.ceil(L),W=L-U,G=0;G<b;G++){var j=b>1?A*(p-1)+G*P:.5*(A+N)*(p-1);if(j<0||j>p-1)for(var q=0;q<v;q++){var H=q+G*C[2]+O*C[1]+T*C[0];x.values[H]=c}else for(var X=Math.floor(j),K=Math.ceil(j),Y=j-X,Q=0;Q<v;Q++){var Z=Q+X*S[2]+U*S[1]+R*S[0],J=_[Z],$=_[Z=Q+K*S[2]+U*S[1]+R*S[0]],ee=_[Z=Q+X*S[2]+V*S[1]+R*S[0]],te=J+($-J)*Y,ne=ee+(_[Z=Q+K*S[2]+V*S[1]+R*S[0]]-ee)*Y;Z=Q+G*C[2]+O*C[1]+T*C[0],x.values[Z]=te+(ne-te)*W}}else for(var re=0;re<b;++re){var ae=b>1?A*(p-1)+re*P:.5*(A+N)*(p-1);if(ae<0||ae>p-1)for(var ie=0;ie<v;ie++){var oe=ie+re*C[2]+O*C[1]+T*C[0];x.values[oe]=c}else for(var se=Math.round(ae),ue=Math.round(L),ce=0;ce<v;ce++){var le=ce+se*S[2]+ue*S[1]+R*S[0],he=ce+re*C[2]+O*C[1]+T*C[0];x.values[he]=_[le]}}}}return n.makeTensorInfo(x.shape,x.dtype,x.values)}};var qW={kernelName:tN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse;ZU(a,"cumsum");var u=ZO([i],a.shape.length),c=a;null!=u&&(c=GV({inputs:{x:a},backend:n,attrs:{perm:u}}));var l=$O(1,a.shape.length)[0];if(l!==c.shape.length-1)throw new Error("backend.cumsum in CPU expects an inner-most "+"axis=".concat(c.shape.length-1," but got axis=").concat(l));for(var h=ND(c.dtype,"int32"),f=sM(qA(c.shape),h),d=n.data.get(c.dataId).values,p=c.shape[c.shape.length-1],v=s?function(e,t){return e+p-t-1}:function(e,t){return e+t},m=0;m<d.length;m+=p)for(var g=0;g<p;g++){var y=v(m,g);if(0===g)f[y]=o?0:d[y];else{var b=v(m,g-1);f[y]=o?d[b]+f[b]:d[y]+f[b]}}var x=n.makeTensorInfo(c.shape,h,f);if(null!=u){var k=GV({inputs:{x:x},backend:n,attrs:{perm:JO(u)}});return n.disposeIntermediateTensorInfo(x),n.disposeIntermediateTensorInfo(c),k}return x}};var HW={kernelName:"DenseBincount",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=yW(n.data.get(a.dataId).values,n.data.get(i.dataId).values,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,u)}if(2===a.shape.length){var c=bW(n.bufferSync(a),n.bufferSync(i),o,s);return n.makeTensorInfo(c.shape,i.dtype,c.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}};var XW={kernelName:rN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;VA("NHWC"===o,(function(){return"Only NHWC dataFormat supported on CPU for depthToSpace. Got ".concat(o)})),VA(i>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(i)}));for(var s=a.shape[0],u=a.shape[1],c=a.shape[2],l=a.shape[3],h=u*i,f=c*i,d=l/(i*i),p=n.data.get(a.dataId).values,v=new Float32Array(s*h*f*d),m=0,g=0;g<s;++g)for(var y=0;y<h;++y)for(var b=Math.floor(y/i),x=y%i,k=0;k<f;++k)for(var w=Math.floor(k/i),_=(x*i+k%i)*d,S=0;S<d;++S){var C=S+_+l*(w+c*(b+u*g));v[m++]=p[C]}return n.makeTensorInfo([s,h,f,d],a.dtype,v)}};function KW(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode;ZU([a,i],"depthwiseConv2DNative");var l=rM(a.shape),h=rM(i.shape),f=u;null==f&&(f=[1,1]),VA(QL(o,f),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(f,"'")}));for(var d=UL(a.shape,i.shape,o,f,s,c,!0),p=d.filterHeight,v=d.filterWidth,m=d.dilationHeight,g=d.dilationWidth,y=d.padInfo,b=y.left,x=y.top,k=d.outChannels/d.inChannels,w=new xD(d.outShape,a.dtype),_=n.data.get(a.dataId).values,S=n.data.get(i.dataId).values,C=w.values,T=0;T<d.batchSize;++T)for(var E=T*l[0],I=T*w.strides[0],A=0;A<d.outHeight;++A)for(var M=I+A*w.strides[1],N=A*d.strideHeight-b,R=0;R<p;++R){var D=N+R*m;if(!(D<0||D>=d.inHeight))for(var P=R*h[0],O=E+D*l[1],L=0;L<d.outWidth;++L)for(var F=M+L*w.strides[2],z=L*d.strideWidth-x,B=0;B<v;++B){var U=z+B*g;if(!(U<0||U>=d.inWidth))for(var V=P+B*h[1],W=O+U*d.inChannels,G=F,j=V,q=0;q<d.inChannels;++q){for(var H=_[W+q],X=0;X<k;++X)C[G+X]+=H*S[j+X];G+=k,j+=k}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}var YW={kernelName:aN,backendName:"cpu",kernelFunc:KW};var QW={kernelName:iN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape;ZU([a,i],"depthwiseConv2dNativeBackpropFilter");for(var h=UL(a.shape,l,o,s,u,c,!0),f=h.strideHeight,d=h.strideWidth,p=h.filterHeight,v=h.filterWidth,m=new xD(h.filterShape,"float32"),g=h.padInfo.left,y=h.padInfo.top,b=h.outChannels/h.inChannels,x=n.data.get(a.dataId).values,k=new xD(a.shape,a.dtype,x),w=n.data.get(i.dataId).values,_=new xD(i.shape,i.dtype,w),S=0;S<p;++S)for(var C=Math.max(0,Math.ceil((y-S)/f)),T=Math.min(h.outHeight,(h.inHeight+y-S)/f),E=0;E<v;++E)for(var I=Math.max(0,Math.ceil((g-E)/d)),A=Math.min(h.outWidth,(h.inWidth+g-E)/d),M=0;M<h.outChannels;++M){for(var N=Math.trunc(M/b),R=M%b,D=0,P=0;P<h.batchSize;++P)for(var O=C;O<T;++O)for(var L=S+O*f-y,F=I;F<A;++F){var z=E+F*d-g;D+=k.get(P,L,z,N)*_.get(P,O,F,M)}m.set(D,S,E,N,R)}return n.makeTensorInfo(m.shape,m.dtype,m.values)}};var ZW={kernelName:oN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.inputShape;ZU([a,i],"depthwiseConv2DNativeBackpropInput");for(var h=rM(a.shape),d=rM(i.shape),p=UL(l,i.shape,o,s,u,c,!0),v=new xD(p.inShape,"float32"),m=v.values,g=f(v.strides,3),y=g[0],b=g[1],x=g[2],k=n.data.get(a.dataId).values,w=f(h,3),_=w[0],S=w[1],C=w[2],T=n.data.get(i.dataId).values,E=f(d,3),I=E[0],A=E[1],M=E[2],N=p.batchSize,R=p.filterHeight,D=p.filterWidth,P=p.inChannels,O=p.inHeight,L=p.inWidth,F=p.outChannels,z=p.outHeight,B=p.outWidth,U=p.strideHeight,V=p.strideWidth,W=R-1-p.padInfo.top,G=D-1-p.padInfo.left,j=F/P,q=0;q<N;++q)for(var H=0;H<P;++H)for(var X=0;X<O;++X)for(var K=X-W,Y=Math.max(0,Math.ceil(K/U)),Q=Math.min(z,(R+K)/U),Z=0;Z<L;++Z){for(var J=Z-G,$=Math.max(0,Math.ceil(J/V)),ee=Math.min(B,(D+J)/V),te=0,ne=Y;ne<Q;++ne)for(var re=ne*U-K,ae=$;ae<ee;++ae)for(var ie=_*q+S*ne+C*ae,oe=I*(R-1-re)+A*(D-1-(ae*V-J))+M*H,se=0;se<j;++se){te+=k[ie+(H*j+se)]*T[oe+se]}m[y*q+b*X+x*Z+H]=te}return n.makeTensorInfo(v.shape,v.dtype,v.values)}};var JW={kernelName:"Diag",backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=t.x,a=qA(r.shape),i=n.data.get(r.dataId).values,o=kP([a,a],r.dtype),s=o.values,u=0;u<i.length;u++)s[u*a+u]=i[u];var c=[].concat(Tt(r.shape),Tt(r.shape));return n.makeTensorInfo(c,o.dtype,o.values)}},$W={kernelName:sN,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=n,l=c.data.get(a.dataId).values,h=a.shape.length,f=c.data.get(i.dataId).values,d=i.shape.length,p=FL(a.shape,i.shape,o,s,"NHWC",u),v=p.batchSize,m=p.inHeight,g=p.inWidth,y=p.inChannels,b=p.outHeight,x=p.outWidth,k=p.padInfo,w=p.strideHeight,_=p.strideWidth,S=p.filterHeight,C=p.filterWidth,T=p.dilationHeight,E=p.dilationWidth,I=p.outShape,A=qA(I),M=I.length,N=ZA(a.dtype,A),R=0;R<v;++R)for(var D=0;D<b;++D)for(var P=D*w-k.top,O=0;O<x;++O)for(var L=O*_-k.left,F=0;F<y;++F){for(var z=Number.MIN_SAFE_INTEGER,B=0;B<S;++B){var U=P+B*T;if(U>=0&&U<m)for(var V=0;V<C;++V){var W=L+V*E;if(W>=0&&W<g){var G=lM([R,U,W,F],h,rM(a.shape)),j=lM([B,V,F],d,rM(i.shape)),q=l[G]+f[j];q>z&&(z=q)}}}N[lM([R,D,O,F],M,rM(I))]=z}return{dataId:c.write(mD(N,a.dtype),I,a.dtype),shape:I,dtype:a.dtype}}},eG={kernelName:cN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,h=iM(a.shape,l.data.get(a.dataId).values),f=iM(i.shape,l.data.get(i.dataId).values),d=FL(a.shape,i.shape,s,u,"NHWC",c),p=d.batchSize,v=d.inHeight,m=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,x=d.padInfo,k=d.strideHeight,w=d.strideWidth,_=d.filterHeight,S=d.filterWidth,C=d.dilationHeight,T=d.dilationWidth,E=d.outShape;VA(o.rank===E.length,(function(){return"Error in ".concat(cN,", dy ")+"must have the same rank as output ".concat(E.length,", but got ")+"".concat(o.rank)}));for(var I=iM(E,l.data.get(o.dataId).values),A=uM(i.shape,i.dtype),M=0;M<p;++M)for(var N=0;N<y;++N)for(var R=N*k-x.top,D=0;D<b;++D)for(var P=D*w-x.left,O=0;O<g;++O){for(var L=Number.MIN_SAFE_INTEGER,F=0,z=0,B=0;B<_;++B){var U=R+B*C;if(U>=0&&U<v)for(var V=0;V<S;++V){var W=P+V*T;if(W>=0&&W<m){var G=h[M][U][W][O]+f[B][V][O];G>L&&(L=G,F=B,z=V)}}}A[F][z][O]+=I[M][N][D][O]}return{dataId:l.write(mD(A,a.dtype),i.shape,i.dtype),shape:i.shape,dtype:i.dtype}}},tG={kernelName:uN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.dy,s=r.strides,u=r.pad,c=r.dilations,l=n,h=iM(a.shape,l.data.get(a.dataId).values),f=iM(i.shape,l.data.get(i.dataId).values),d=FL(a.shape,i.shape,s,u,"NHWC",c),p=d.batchSize,v=d.inHeight,m=d.inWidth,g=d.inChannels,y=d.outHeight,b=d.outWidth,x=d.padInfo,k=d.strideHeight,w=d.strideWidth,_=d.filterHeight,S=d.filterWidth,C=d.dilationHeight,T=d.dilationWidth,E=d.outShape;VA(o.rank===E.length,(function(){return"Error in ".concat(uN,", dy ")+"must have the same rank as output ".concat(E.length,", but got ")+"".concat(o.rank)}));for(var I=iM(E,l.data.get(o.dataId).values),A=uM(a.shape,a.dtype),M=0;M<p;++M)for(var N=0;N<y;++N)for(var R=N*k-x.top,D=0;D<b;++D)for(var P=D*w-x.left,O=0;O<g;++O){for(var L=Number.MIN_SAFE_INTEGER,F=R<0?0:R,z=P<0?0:P,B=0;B<_;++B){var U=R+B*C;if(U>=0&&U<v)for(var V=0;V<S;++V){var W=P+V*T;if(W>=0&&W<m){var G=h[M][U][W][O]+f[B][V][O];G>L&&(L=G,F=U,z=W)}}}A[M][F][z][O]+=I[M][N][D][O]}return{dataId:l.write(mD(A,a.dtype),a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}};var nG={kernelName:fN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y;ZU([r,a],"eluGrad");for(var i=new Float32Array(qA(a.shape)),o=n.data.get(a.dataId).values,s=n.data.get(r.dataId).values,u=0;u<o.length;++u){var c=o[u];i[u]=c>=1?s[u]:s[u]*(c+1)}return n.makeTensorInfo(a.shape,"float32",i)}},rG=uV((function(e,t){return e===t?1:0})),aG=SV(pN,rG,null,"bool"),iG={kernelName:pN,backendName:"cpu",kernelFunc:aG},oG=eV(dN,(function(e){var t=Math.sign(e),n=Math.abs(e),r=1/(1+.3275911*n);return t*(1-((((1.061405429*r-1.453152027)*r+1.421413741)*r-.284496736)*r+.254829592)*r*Math.exp(-n*n))})),sG={kernelName:dN,backendName:"cpu",kernelFunc:oG},uG=kW((function(e){return Math.exp(e)})),cG=tV(vN,uG),lG={kernelName:vN,backendName:"cpu",kernelFunc:cG};function hG(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.input,i=r.dim,o=a.shape.length,s=a.shape.slice(),u=i;return i<0&&(VA(-(o+1)<=i,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+i+1),s.splice(u,0,1),MV({inputs:{x:a},backend:n,attrs:{shape:s}})}var fG={kernelName:mN,backendName:"cpu",kernelFunc:hG},dG=kW((function(e){return Math.expm1(e)})),pG=tV(gN,dG),vG={kernelName:gN,backendName:"cpu",kernelFunc:pG},mG=uV((function(e,t){return e*t})),gG=CV((function(e,t,n,r){return{real:e*n-t*r,imag:e*r+t*n}})),yG=SV($N,mG,gG),bG={kernelName:$N,backendName:"cpu",kernelFunc:yG},xG=uV((function(e,t){return e/t})),kG=SV(lN,xG),wG={kernelName:lN,backendName:"cpu",kernelFunc:kG},_G=uV((function(e,t){return e-t})),SG=CV((function(e,t,n,r){return{real:e-n,imag:t-r}})),CG=SV(UR,_G,SG),TG={kernelName:UR,backendName:"cpu",kernelFunc:CG};function EG(e,t,n){for(var r=e.shape,a=r[0],i=r[1],o=n.data.get(e.dataId),s=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[a,i],l=qA(c),h=QA("float32",l),f=QA("float32",l),d=0;d<a;d++){for(var p=vW({inputs:{x:s},backend:n,attrs:{begin:[d,0],size:[1,i]}}),v=vW({inputs:{x:u},backend:n,attrs:{begin:[d,0],size:[1,i]}}),m=gV({inputs:{real:p,imag:v},backend:n}),g=IG(m,t,n),y=cF(g.real,g.imag),b=0;b<i;b++){var x=lF(y,b);h[d*i+b]=x.real,f[d*i+b]=x.imag}n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(m)}var k=n.makeTensorInfo(c,"float32",h),w=n.makeTensorInfo(c,"float32",f),_=gV({inputs:{real:k,imag:w},backend:n});return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(w),_}function IG(e,t,n){var r=qA(e.shape),a=n.data.get(e.dataId),i=n.data.get(a.complexTensorInfos.real.dataId).values,o=n.data.get(a.complexTensorInfos.imag.dataId).values;if(0===((g=r)&g-1)){var s=AG(i,o,r,t,n),u=[e.shape[0],e.shape[1]];if(t){var c=n.makeTensorInfo(u,"float32",s.real),l=n.makeTensorInfo(u,"float32",s.imag),h=n.makeTensorInfo([],"float32",vD(r,"float32")),f=aV({inputs:{x:h},backend:n}),d=wG.kernelFunc({inputs:{a:c,b:h},backend:n}),p=wG.kernelFunc({inputs:{a:l,b:f},backend:n}),v=n.data.get(d.dataId).values,m=n.data.get(p.dataId).values;return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),{real:v,imag:m}}return s}var g,y=function(e,t,n){for(var r=new Float32Array(2*t),a=0;a<t;a++){for(var i=0,o=0,s=0;s<t;s++){var u=fF(a*s,t,n),c=lF(e,s);i+=c.real*u.real-c.imag*u.imag,o+=c.real*u.imag+c.imag*u.real}n&&(i/=t,o/=t),hF(r,i,o,a)}return r}(cF(i,o),r,t);return function(e){for(var t=new Float32Array(e.length/2),n=new Float32Array(e.length/2),r=0;r<e.length;r+=2)t[r/2]=e[r],n[r/2]=e[r+1];return{real:t,imag:n}}(y)}function AG(e,t,n,r,a){if(1===n)return{real:e,imag:t};var i=cF(e,t),o=n/2,s=function(e){for(var t=Math.ceil(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=0;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(i),u=s.real,c=s.imag,l=[u.length],h=a.makeTensorInfo(l,"float32",u),f=a.makeTensorInfo(l,"float32",c),d=gV({inputs:{real:h,imag:f},backend:a}),p=function(e){for(var t=Math.floor(e.length/4),n=new Float32Array(t),r=new Float32Array(t),a=2;a<e.length;a+=4)n[Math.floor(a/4)]=e[a],r[Math.floor(a/4)]=e[a+1];return{real:n,imag:r}}(i),v=p.real,m=p.imag,g=[v.length],y=a.makeTensorInfo(g,"float32",v),b=a.makeTensorInfo(g,"float32",m),x=gV({inputs:{real:y,imag:b},backend:a}),k=AG(u,c,o,r,a),w=k.real,_=k.imag,S=[w.length],C=a.makeTensorInfo(S,"float32",w),T=a.makeTensorInfo(S,"float32",_),E=gV({inputs:{real:C,imag:T},backend:a}),I=AG(v,m,o,r,a),A=I.real,M=I.imag,N=[A.length],R=a.makeTensorInfo(N,"float32",A),D=a.makeTensorInfo(N,"float32",M),P=gV({inputs:{real:R,imag:D},backend:a}),O=function(e,t){for(var n=new Float32Array(e/2),r=new Float32Array(e/2),a=0;a<Math.ceil(e/2);a++){var i=(t?2:-2)*Math.PI*(a/e);n[a]=Math.cos(i),r[a]=Math.sin(i)}return{real:n,imag:r}}(n,r),L=[O.real.length],F=a.makeTensorInfo(L,"float32",O.real),z=a.makeTensorInfo(L,"float32",O.imag),B=gV({inputs:{real:F,imag:z},backend:a}),U=yG({inputs:{a:B,b:P},backend:a}),V=IV({inputs:{a:E,b:U},backend:a}),W=CG({inputs:{a:E,b:U},backend:a}),G=xV({inputs:{input:V},backend:a}),j=xV({inputs:{input:W},backend:a}),q=AW({inputs:{input:V},backend:a}),H=AW({inputs:{input:W},backend:a}),X=NW({inputs:[G,j],backend:a,attrs:{axis:0}}),K=NW({inputs:[q,H],backend:a,attrs:{axis:0}}),Y=a.data.get(X.dataId).values,Q=a.data.get(K.dataId).values;return a.disposeIntermediateTensorInfo(h),a.disposeIntermediateTensorInfo(f),a.disposeIntermediateTensorInfo(d),a.disposeIntermediateTensorInfo(y),a.disposeIntermediateTensorInfo(b),a.disposeIntermediateTensorInfo(x),a.disposeIntermediateTensorInfo(C),a.disposeIntermediateTensorInfo(T),a.disposeIntermediateTensorInfo(E),a.disposeIntermediateTensorInfo(R),a.disposeIntermediateTensorInfo(D),a.disposeIntermediateTensorInfo(P),a.disposeIntermediateTensorInfo(F),a.disposeIntermediateTensorInfo(z),a.disposeIntermediateTensorInfo(B),a.disposeIntermediateTensorInfo(U),a.disposeIntermediateTensorInfo(V),a.disposeIntermediateTensorInfo(W),a.disposeIntermediateTensorInfo(G),a.disposeIntermediateTensorInfo(q),a.disposeIntermediateTensorInfo(j),a.disposeIntermediateTensorInfo(H),a.disposeIntermediateTensorInfo(X),a.disposeIntermediateTensorInfo(K),{real:Y,imag:Q}}var MG={kernelName:"FFT",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=qA(r.shape),i=r.shape[r.shape.length-1],o=MV({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=EG(o,!1,n),u=MV({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}};function NG(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype||tM(a),o=ZA(i,qA(r));return function(e,t,n){e.fill(t)}(o,a),t.makeTensorInfo(r,i,o)}var RG={kernelName:yN,backendName:"cpu",kernelFunc:NG};var DG={kernelName:bN,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=(e.attrs,e.backend),r=t.image,a=n,i=QA(r.dtype,qA(r.shape)),o=f(r.shape,4),s=o[0],u=o[1],c=o[2],l=o[3],h=a.data.get(r.dataId).values,d=0;d<s;d++)for(var p=d*c*u*l,v=0;v<u;v++)for(var m=v*(c*l),g=0;g<c;g++)for(var y=g*l,b=0;b<l;b++){var x=[s,v,g,b][2],k=Math.round(c-x),w=p+m+y+b,_=h[w];if(k>=0&&k<c)_=h[p+m+k*l+b];i[w]=_}return{dataId:a.write(i,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},PG=kW((function(e){return Math.floor(e)})),OG=tV(xN,PG),LG={kernelName:xN,backendName:"cpu",kernelFunc:OG},FG=uV((function(e,t){return Math.floor(e/t)})),zG=SV(kN,FG,null,"int32"),BG={kernelName:kN,backendName:"cpu",kernelFunc:zG};var UG={kernelName:"FusedConv2D",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,h=r.dilations,f=r.dimRoundingMode,d=r.activation,p=r.leakyreluAlpha,v=DW({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:f}});if(o){var m=v;v=IV({inputs:{a:v,b:o},backend:n}),n.disposeIntermediateTensorInfo(m)}if(d){var g=v;v=mV(n,v,d,s,p),n.disposeIntermediateTensorInfo(g)}return v}};var VG={kernelName:"FusedDepthwiseConv2D",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dataFormat,h=r.dilations,f=r.dimRoundingMode,d=r.activation,p=r.leakyreluAlpha,v=KW({inputs:{x:a,filter:i},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:f}});if(o){var m=v;v=IV({inputs:{a:v,b:o},backend:n}),n.disposeIntermediateTensorInfo(m)}if(d){var g=v;v=mV(n,v,d,s,p),n.disposeIntermediateTensorInfo(g)}return v}};var WG={kernelName:"GatherNd",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=qA(r.shape),o=a.shape,s=o[o.length-1],u=function(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===qA(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,h=i;h<n;++h)l*=u[h],c.push(u[h]);var f=[].concat(Tt(rM(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,f]}(r,a),c=f(u,4),l=c[0],h=c[1],d=c[2],p=c[3];if(0===h)return n.makeTensorInfo(l,r.dtype,[]);for(var v=kP([h,d],r.dtype),m=n.data.get(a.dataId).values,g=n.data.get(r.dataId).values,y=0;y<h;y++){for(var b=[],x=0,k=0;k<s;k++){var w=m[y*s+k];x+=w*p[k],b.push(w)}if(x<0||x>=i/d)throw new Error("Invalid indices: ".concat(b," does not index into ").concat(r.shape));for(var _=0;_<d;_++)v.values[y*d+_]=g[x*d+_]}return n.makeTensorInfo(l,v.dtype,v.values)}};function GG(e,t,n){for(var r=kP(n,e.dtype),a=0;a<r.size;++a){var i=r.indexToLoc(a).slice(),o=i[0],s=i[2],u=t.locToIndex([o,s]);i[2]=t.values[u];var c=e.locToIndex(i);r.values[a]=e.values[c]}return r}var jG={kernelName:_N,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims;ZU([a,i],"gatherV2");var u=s;null==s&&(u=0);var c=qA(i.shape),l=function(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,h=1,f=0;f<r;++f)u.push(e.shape[f]),c*=e.shape[f];for(var d=r;d<n;d++)u.push(e.shape[d]),l*=e.shape[d];for(var p=r;p<a;p++)u.push(t.shape[p]);for(var v=n+1;v<i;v++)u.push(e.shape[v]),h*=e.shape[v];return{batchSize:c,sliceSize:h,outerSize:l,dimSize:s,outputShape:u}}(a,i,YA(o,a.shape)[0],u),h=MV({inputs:{x:a},backend:n,attrs:{shape:[l.batchSize,l.outerSize,l.dimSize,l.sliceSize]}}),f=MV({inputs:{x:i},backend:n,attrs:{shape:[l.batchSize,c/l.batchSize]}}),d=[l.batchSize,l.outerSize,c/l.batchSize,l.sliceSize],p=n.bufferSync(f),v=GG(n.bufferSync(h),p,d);return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.makeTensorInfo(l.outputShape,v.dtype,v.values)}},qG=uV((function(e,t){return e>t?1:0})),HG=SV(SN,qG,null,"bool"),XG={kernelName:SN,backendName:"cpu",kernelFunc:HG},KG=uV((function(e,t){return e>=t?1:0})),YG=SV(CN,KG,null,"bool"),QG={kernelName:CN,backendName:"cpu",kernelFunc:YG};var ZG={kernelName:EN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.input,a=qA(r.shape),i=r.shape[r.shape.length-1],o=MV({inputs:{x:r},backend:n,attrs:{shape:[a/i,i]}}),s=EG(o,!0,n),u=MV({inputs:{x:s},backend:n,attrs:{shape:r.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}},JG=eV(AN,(function(e){return Number.isFinite(e)?1:0}),"bool"),$G={kernelName:AN,backendName:"cpu",kernelFunc:JG},ej=eV(MN,(function(e){return Math.abs(e)===1/0?1:0}),"bool"),tj={kernelName:MN,backendName:"cpu",kernelFunc:ej},nj=eV(NN,(function(e){return Number.isNaN(e)?1:0}),"bool"),rj={kernelName:NN,backendName:"cpu",kernelFunc:nj},aj=uV((function(e,t){return e<t?1:0})),ij=SV(DN,aj,null,"bool"),oj={kernelName:DN,backendName:"cpu",kernelFunc:ij},sj=uV((function(e,t){return e<=t?1:0})),uj=SV(PN,sj,null,"bool"),cj={kernelName:PN,backendName:"cpu",kernelFunc:uj};function lj(e,t,n){var r=(t-e)/(n-1),a=sM(n,"float32");a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+r;return a}var hj={kernelName:"LinSpace",backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=lj(n.start,n.stop,n.num);return t.makeTensorInfo([r.length],"float32",r)}},fj=kW((function(e){return Math.log(e)})),dj=tV(ON,fj),pj={kernelName:ON,backendName:"cpu",kernelFunc:dj},vj=eV(LN,(function(e){return Math.log1p(e)})),mj={kernelName:LN,backendName:"cpu",kernelFunc:vj},gj=uV((function(e,t){return e&&t})),yj=SV(FN,gj,null,"bool"),bj={kernelName:FN,backendName:"cpu",kernelFunc:yj},xj=eV(zN,(function(e){return e?0:1}),"bool"),kj={kernelName:zN,backendName:"cpu",kernelFunc:xj},wj=uV((function(e,t){return e||t})),_j=SV(BN,wj,null,"bool"),Sj={kernelName:BN,backendName:"cpu",kernelFunc:_j};var Cj={kernelName:UN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta;ZU(a,"LRN");var c=a.shape[3],l=c-1,h=n.data.get(a.dataId).values,f=qA(a.shape),d=new Float32Array(f);function p(e){for(var t=e%c,n=e-t+Math.max(0,t-i),r=e-t+Math.min(t+i,l),a=0;n<=r;n++){var o=h[n];a+=o*o}return a}for(var v=0;v<f;v++){var m=p(v),g=h[v]*Math.pow(o+s*m,-u);d[v]=g}return n.makeTensorInfo(a.shape,a.dtype,d)}};var Tj={kernelName:VN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta;ZU(o,"LRNGrad");for(var h=qA(o.shape),f=o.shape[3],d=n.data.get(o.dataId).values,p=n.data.get(a.dataId).values,v=n.data.get(i.dataId).values,m=new Float32Array(h),g=h,y=0;y<g;y++){for(var b=y%f,x=y-b+Math.max(0,b-s),k=y-b+Math.min(f,b+s+1),w=0,_=x;_<k;_++)w+=Math.pow(p[_],2);w=c*w+u;for(var S=x;S<k;S++){var C=-2*c*l*p[S]*v[y]/w;y===S&&(C+=Math.pow(w,-l)),C*=d[y],m[S]+=C}}return n.makeTensorInfo(o.shape,a.dtype,m)}};function Ej(e,t,n,r){for(var a=QA(r,qA(n)),i=0;i<a.length;++i){for(var o=i*t,s=e[o],u=0;u<t;++u){var c=e[o+u];c>s&&(s=c)}a[i]=s}return a}function Ij(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=n,u=a.shape,c=u.length,l=YA(i,u),h=l,d=ZO(h,c),p=s.data.get(a.dataId).values;if(null!=d){for(var v=new Array(c),m=0;m<v.length;m++)v[m]=u[d[m]];p=WV(p,u,a.dtype,d,v),h=$O(h.length,c),u=v}ZU(a,"max"),QO("max",h,c);var g=f(KO(u,h),2),y=g[0],b=Ej(p,qA(g[1]),y,a.dtype),x=s.write(b,y,a.dtype),k=y;o&&(k=v=YO(y,l));return{dataId:x,shape:k,dtype:a.dtype}}var Aj={kernelName:WN,backendName:"cpu",kernelFunc:Ij},Mj=uV((function(e,t){return Math.max(e,t)})),Nj=SV(GN,Mj),Rj={kernelName:GN,backendName:"cpu",kernelFunc:Nj};var Dj={kernelName:jN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;ZU(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;VA(QL(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c,l=zL(a.shape,i,o,1,s,u);if(1===l.filterWidth&&1===l.filterHeight&&HA(l.inShape,l.outShape))c=aV({inputs:{x:a},backend:n});else{var h=n.data.get(a.dataId).values,f=rM(a.shape),d=oW(h,a.shape,a.dtype,f,l,"max");c=n.makeTensorInfo(l.outShape,a.dtype,d.values)}return c}};var Pj={kernelName:HN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=r.dilations;ZU(a,"maxPool3d");var h=l;null==h&&(h=[1,1,1]);var f=BL(a.shape,i,o,h,s,u,c),d=uW(n.data.get(a.dataId).values,a.shape,a.dtype,rM(a.shape),f,"max");return n.makeTensorInfo(d.shape,"float32",d.values)}};var Oj={kernelName:XN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dilations,l=r.dimRoundingMode;ZU([a,i],"maxPool3DGrad");for(var h=BL(i.shape,o,s,c,u,l),f=function(e,t){for(var n=kP(t.outShape,"int32"),r=t.strideDepth,a=t.strideHeight,i=t.strideWidth,o=t.dilationDepth,s=t.dilationHeight,u=t.dilationWidth,c=t.effectiveFilterDepth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,f=t.padInfo.front,d=t.padInfo.top,p=t.padInfo.left,v=0;v<t.batchSize;++v)for(var m=0;m<t.inChannels;++m)for(var g=0;g<t.outDepth;++g){for(var y=g*r-f,b=y;b<0;)b+=o;for(var x=Math.min(t.inDepth,c+y),k=0;k<t.outHeight;++k){for(var w=k*a-d,_=w;_<0;)_+=s;for(var S=Math.min(t.inHeight,l+w),C=0;C<t.outWidth;++C){for(var T=C*i-p,E=T;E<0;)E+=u;for(var I=Math.min(t.inWidth,h+T),A=Number.NEGATIVE_INFINITY,M=-1,N=b;N<x;N+=o)for(var R=N-y,D=_;D<S;D+=s)for(var P=D-w,O=E;O<I;O+=u){var L=O-T,F=e.get(v,N,D,O,m);F>=A&&(A=F,M=R*l*h+P*l+L)}n.set(M,v,g,k,C,m)}}}return n}(n.bufferSync(i),h),d=h.strideDepth,p=h.strideHeight,v=h.strideWidth,m=h.dilationDepth,g=h.dilationHeight,y=h.dilationWidth,b=h.effectiveFilterDepth,x=h.effectiveFilterHeight,k=h.effectiveFilterWidth,w=b-1-h.padInfo.front,_=k-1-h.padInfo.left,S=x-1-h.padInfo.top,C=kP(i.shape,"float32"),T=n.bufferSync(a),E=0;E<h.batchSize;++E)for(var I=0;I<h.inChannels;++I)for(var A=0;A<h.inDepth;++A)for(var M=0;M<h.inHeight;++M)for(var N=0;N<h.inWidth;++N){for(var R=A-w,D=M-S,P=N-_,O=0,L=0;L<b;L+=m){var F=(R+L)/d;if(!(F<0||F>=h.outDepth||Math.floor(F)!==F))for(var z=0;z<x;z+=g){var B=(D+z)/p;if(!(B<0||B>=h.outHeight||Math.floor(B)!==B))for(var U=0;U<k;U+=y){var V=(P+U)/v;if(!(V<0||V>=h.outWidth||Math.floor(V)!==V)){var W=b*x*k-1-f.get(E,F,B,V,I)===L*x*k+z*k+U?1:0;if(0!==W)O+=T.get(E,F,B,V,I)*W}}}}C.set(O,E,A,M,N,I)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}};var Lj={kernelName:qN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;ZU([i,t.output],"maxPoolGrad");for(var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,h=zL(o.shape,s,u,1,c,l),f=n.data.get(o.dataId).values,d=kP(h.outShape,o.dtype,sW(f,o.shape,o.dtype,h).values),p=h.strideHeight,v=h.strideWidth,m=h.dilationHeight,g=h.dilationWidth,y=h.effectiveFilterHeight,b=h.effectiveFilterWidth,x=b-1-h.padInfo.left,k=y-1-h.padInfo.top,w=kP(o.shape,"float32"),_=n.data.get(a.dataId).values,S=kP(a.shape,"float32",_),C=0;C<h.batchSize;++C)for(var T=0;T<h.inChannels;++T)for(var E=0;E<h.inHeight;++E)for(var I=0;I<h.inWidth;++I){for(var A=E-k,M=I-x,N=0,R=0;R<y;R+=m){var D=(A+R)/p;if(!(D<0||D>=h.outHeight||Math.floor(D)!==D))for(var P=0;P<b;P+=g){var O=(M+P)/v;if(!(O<0||O>=h.outWidth||Math.floor(O)!==O)){var L=y*b-1-d.get(C,D,O,T)===R*b+P?1:0;if(0!==L)N+=S.get(C,D,O,T)*L}}}w.set(N,C,E,I,T)}return n.makeTensorInfo(w.shape,w.dtype,w.values)}};var Fj={kernelName:"MaxPoolWithArgmax",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;ZU(a,"MaxPoolWithArgmax");var l=c.data.get(a.dataId).values,h=zL(a.shape,i,o,[1,1],s),d=function(e,t,n,r,a){var i=oW(e,0,n,rM(t),a,"max"),o=sW(e,t,n,a,!0,r);return[i.values,o.values]}(l,a.shape,a.dtype,u,h),p=f(d,2),v=p[0],m=p[1],g=c.write(v,h.outShape,a.dtype),y=c.write(m,h.outShape,a.dtype);return[{dataId:g,shape:h.outShape,dtype:a.dtype},{dataId:y,shape:h.outShape,dtype:"int32"}]}};function zj(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims;ZU(i,"sum");var u=(t="bool"===i.dtype?wV({inputs:{x:i},backend:r,attrs:{dtype:"int32"}}):aV({inputs:{x:i},backend:r})).shape.length,c=YA(o,t.shape),l=ZO(c,u),h=c,d=t;null!=l&&(d=GV({inputs:{x:t},backend:r,attrs:{perm:l}}),h=$O(h.length,u)),QO("sum",h,d.shape.length);for(var p=f(KO(d.shape,h),2),v=p[0],m=p[1],g=bV(r,v,ND(d.dtype,"int32")),y=qA(m),b=r.data.get(g.dataId).values,x=r.data.get(d.dataId).values,k=0;k<b.length;++k){for(var w=k*y,_=0,S=0;S<y;++S)_+=x[w+S];b[k]=_}if(s){var C=g;g=MV({inputs:{x:g},backend:r,attrs:{shape:YO(g.shape,c)}}),r.disposeIntermediateTensorInfo(C)}return r.disposeIntermediateTensorInfo(t),null!=l&&r.disposeIntermediateTensorInfo(d),g}var Bj={kernelName:PR,backendName:"cpu",kernelFunc:zj};var Uj={kernelName:KN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=YA(i,a.shape),u=qA(KO(a.shape,s)[1]),c=[],l=n.makeTensorInfo([],"float32",new Float32Array([u]));c.push(l);var h=wV({inputs:{x:a},backend:n,attrs:{dtype:"float32"}});c.push(h);var f=kG({inputs:{a:h,b:l},backend:n});c.push(f);var d=zj({inputs:{x:f},backend:n,attrs:{axis:i,keepDims:o}});return c.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),d}};var Vj={kernelName:YN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;ZU(a,"min");var s=YA(i,a.shape),u=s,c=ZO(u,a.shape.length),l=a;null!=c&&(l=GV({inputs:{x:a},backend:n,attrs:{perm:c}}),u=$O(u.length,a.shape.length)),QO("min",u,l.shape.length);for(var h=f(KO(l.shape,u),2),d=h[0],p=qA(h[1]),v=sM(qA(d),l.dtype),m=n.data.get(l.dataId).values,g=0;g<v.length;++g){for(var y=g*p,b=m[y],x=0;x<p;++x){var k=m[y+x];k<b&&(b=k)}v[g]=b}null!=c&&n.disposeIntermediateTensorInfo(l);var w=n.makeTensorInfo(d,l.dtype,v);if(o){var _=MV({inputs:{x:w},backend:n,attrs:{shape:YO(d,s)}});return n.disposeIntermediateTensorInfo(w),_}return w}},Wj=uV((function(e,t){return Math.min(e,t)})),Gj=SV(QN,Wj),jj={kernelName:QN,backendName:"cpu",kernelFunc:Gj};var qj={kernelName:ZN,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode;ZU(a,"mirrorPad");for(var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=i.map((function(e,t){return e[0]+a.shape[t]})),l="reflect"===o?0:1,h=n.data.get(a.dataId).values,f=a.shape.length,d=rM(a.shape),p=qA(s),v=s.length,m=rM(s),g=QA(a.dtype,p),y=0;y<p;y++){for(var b=hM(y,v,m),x=0;x<v;x++)b[x]<u[x]?b[x]=2*u[x]-b[x]-l:b[x]>=c[x]&&(b[x]=2*(c[x]-1)-b[x]+l);b=b.map((function(e,t){return e-u[t]}));var k=lM(b,f,d);g[y]=h[k]}return{dataId:n.write(g,s,a.dtype),shape:s,dtype:a.dtype}}},Hj=uV((function(e,t){var n=e%t;return e<0&&t<0||e>=0&&t>=0?n:(n+t)%t})),Xj=SV(JN,Hj),Kj={kernelName:JN,backendName:"cpu",kernelFunc:Xj};function Yj(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.dim,o=a.shape.length,s=i;if(-1===s&&(s=o-1),s!==o-1)throw Error("Softmax along a non-last dimension is not yet supported. "+"Logits was rank ".concat(o," and dim was ").concat(s));var u=YA([s],a.shape),c=Ij({inputs:{x:a},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),l=YO(c.shape,u),h=MV({inputs:{x:c},backend:n,attrs:{shape:l}}),f=CG({inputs:{a:a,b:h},backend:n}),d=cG({inputs:{x:f},backend:n}),p=zj({inputs:{x:d},backend:n,attrs:{axis:u,keepDims:!1}}),v=MV({inputs:{x:p},backend:n,attrs:{shape:l}}),m=kG({inputs:{a:d,b:v},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),m}var Qj={kernelName:FR,backendName:"cpu",kernelFunc:Yj};var Zj={kernelName:"Multinomial",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized;ZU(a,"multinomial");for(var u=s?a:Yj({inputs:{logits:a},backend:n,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],h=n.data.get(u.dataId).values,f=[c,i],d=sM(qA(f),"int32"),p=0;p<c;++p){var v=p*l,m=new Float32Array(l-1);m[0]=h[v];for(var g=1;g<m.length;++g)m[g]=m[g-1]+h[v+g];for(var y=hy.alea(o.toString()),b=p*i,x=0;x<i;++x){var k=y();d[b+x]=m.length;for(var w=0;w<m.length;w++)if(k<m[w]){d[b+x]=w;break}}}return s||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(f,"int32",d)}};function Jj(e,t,n){var r=vD(-1,n);return mG([],t,r,e,n)}var $j={kernelName:eR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x;ZU(r,"neg");var a=f(Jj(n.data.get(r.dataId).values,r.shape,r.dtype),2),i=a[0],o=a[1];return n.makeTensorInfo(o,r.dtype,i)}},eq=_O;var tq={kernelName:nR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold;ZU(a,"NonMaxSuppression");var c=n.data.get(a.dataId).values,l=n.data.get(i.dataId).values,h=eq(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},nq=SO;var rq={kernelName:rR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize;ZU(a,"NonMaxSuppressionPadded");var l=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,f=nq(l,h,o,s,u,c),d=f.selectedIndices,p=f.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},aq=CO;var iq={kernelName:aR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma;ZU(a,"NonMaxSuppressionWithScore");var l=n.data.get(a.dataId).values,h=n.data.get(i.dataId).values,f=aq(l,h,o,s,u,c),d=f.selectedIndices,p=f.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([p.length],"float32",new Float32Array(p))]}},oq=uV((function(e,t){return e!==t?1:0})),sq=SV(tR,oq,null,"bool"),uq={kernelName:tR,backendName:"cpu",kernelFunc:sq};var cq={kernelName:oR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.depth,o=r.onValue,s=r.offValue;ZU(a,"oneHot");var u=qA(a.shape),c=new Float32Array(u*i);c.fill(s);for(var l=n.data.get(a.dataId).values,h=0;h<u;++h)l[h]>=0&&l[h]<i&&(c[h*i+l[h]]=o);return n.makeTensorInfo([].concat(Tt(a.shape),[i]),"int32",c)}};function lq(e){var t=e.inputs,n=e.backend,r=t.x;if("string"===r.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===r.dtype){var a=xV({inputs:{input:r},backend:n}),i=lq({inputs:{x:a},backend:n}),o=AW({inputs:{input:r},backend:n}),s=lq({inputs:{x:o},backend:n}),u=gV({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return NG({backend:n,attrs:{shape:r.shape,value:0,dtype:r.dtype}})}var hq={kernelName:QR,backendName:"cpu",kernelFunc:lq};var fq={kernelName:iR,backendName:"cpu",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===a.dtype){var i=xV({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=AW({inputs:{input:a},backend:r}),u=lq({inputs:{x:s},backend:r}),c=gV({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return NG({backend:r,attrs:{shape:a.shape,value:1,dtype:a.dtype}})}};function dq(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return hG({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){WA(a,e.shape,"All tensors passed to stack must have matching shapes"),VA(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=NW({inputs:t.map((function(e){var t=hG({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}var pq={kernelName:sR,backendName:"cpu",kernelFunc:dq};var vq={kernelName:uR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue;ZU(a,"pad");var s=i.map((function(e,t){return e[0]+a.shape[t]+e[1]})),u=i.map((function(e){return e[0]})),c=n.data.get(a.dataId).values,l=qA(a.shape),h=a.shape.length,f=rM(a.shape),d=qA(s),p=s.length,v=rM(s),m=QA(a.dtype,d);0!==o&&m.fill(o);for(var g=0;g<l;g++){m[lM(hM(g,h,f).map((function(e,t){return e+u[t]})),p,v)]=c[g]}return{dataId:n.write(m,s,a.dtype),shape:s,dtype:a.dtype}}},mq=uV((function(e,t){return Math.pow(e,t)})),gq=SV(cR,mq),yq={kernelName:cR,backendName:"cpu",kernelFunc:gq};function bq(e,t,n,r){for(var a=f(KO(e,r),2),i=a[0],o=a[1],s=ND(t,"int32"),u=sM(qA(i),s),c=qA(o),l=0;l<u.length;++l){for(var h=l*c,d=1,p=0;p<c;++p)d*=n[h+p];u[l]=d}return{outVals:u,outShape:i,outDtype:s}}var xq={kernelName:hR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims;ZU(a,"prod");var s=a.shape.length,u=YA(i,a.shape),c=ZO(u,s),l=u,h=a,f=[];null!=c&&(h=GV({inputs:{x:a},backend:n,attrs:{perm:c}}),f.push(h),l=$O(l.length,s));var d=n.data.get(h.dataId).values,p=bq(h.shape,h.dtype,d,l),v=p.outVals,m=p.outShape,g=p.outDtype,y=m;return o&&(y=YO(m,u)),f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(y,g,v)}};function kq(e,t,n,r){if(e===t||e<t&&n<0||t<e&&n>1)return sM(0,r);var a=sM(Math.abs(Math.ceil((t-e)/n)),r);t<e&&1===n&&(n=-1),a[0]=e;for(var i=1;i<a.length;i++)a[i]=a[i-1]+n;return a}var wq={kernelName:fR,backendName:"cpu",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.dtype,o=kq(r,a,n.step,i);return t.makeTensorInfo([o.length],i,o)}},_q=eV(pR,(function(e){return 1/e})),Sq={kernelName:pR,backendName:"cpu",kernelFunc:_q};var Cq={kernelName:bR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;ZU(a,"resizeBilinear");for(var u=rM(a.shape),c=f(s,2),l=c[0],h=c[1],d=f(a.shape,4),p=d[0],v=d[1],m=d[2],g=d[3],y=n.data.get(a.dataId).values,b=new Float32Array(qA([p,l,h,g])),x=[i&&l>1?v-1:v,i&&h>1?m-1:m],k=[i&&l>1?l-1:l,i&&h>1?h-1:h],w=0,_=x[0]/k[0],S=x[1]/k[1],C=0;C<p;C++)for(var T=0;T<l;T++){var E=void 0;E=o?_*(T+.5)-.5:_*T;for(var I=Math.max(0,Math.floor(E)),A=E-I,M=Math.min(v-1,Math.ceil(E)),N=C*u[0]+I*u[1],R=C*u[0]+M*u[1],D=0;D<h;D++){var P=void 0;P=o?S*(D+.5)-.5:S*D;for(var O=Math.max(0,Math.floor(P)),L=P-O,F=Math.min(m-1,Math.ceil(P)),z=N+O*u[2],B=R+O*u[2],U=N+F*u[2],V=R+F*u[2],W=0;W<g;W++){var G=y[z+W],j=y[B+W],q=G+(y[U+W]-G)*L,H=q+(j+(y[V+W]-j)*L-q)*A;b[w++]=H}}}return n.makeTensorInfo([p,l,h,g],"float32",b)}};var Tq={kernelName:xR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;ZU([i,a],"resizeBilinearGrad");for(var s=rM(a.shape),u=f(a.shape,4),c=u[0],l=u[1],h=u[2],d=u[3],p=f(i.shape,3),v=p[1],m=p[2],g=new Float32Array(c*l*h*d),y=[o&&v>1?l-1:l,o&&m>1?h-1:h],b=[o&&v>1?v-1:v,o&&m>1?m-1:m],x=y[0]/b[0],k=y[1]/b[1],w=n.data.get(i.dataId).values,_=0,S=0;S<c;S++)for(var C=S*s[0],T=0;T<v;T++)for(var E=T*x,I=Math.floor(E),A=Math.min(Math.ceil(E),l-1),M=C+I*s[1],N=C+A*s[1],R=E-I,D=1-R,P=0;P<m;P++)for(var O=P*k,L=Math.floor(O),F=Math.min(Math.ceil(O),h-1),z=O-L,B=1-z,U=M+L*s[2],V=M+F*s[2],W=N+L*s[2],G=N+F*s[2],j=D*B,q=D*z,H=R*B,X=R*z,K=0;K<d;K++){var Y=w[_++];g[U+K]+=Y*j,g[V+K]+=Y*q,g[W+K]+=Y*H,g[G+K]+=Y*X}return n.makeTensorInfo([c,h,l,d],"float32",g)}};var Eq={kernelName:gR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=r.size;ZU(a,"resizeNearestNeighbor");for(var u=rM(a.shape),c=f(s,2),l=c[0],h=c[1],d=f(a.shape,4),p=d[0],v=d[1],m=d[2],g=d[3],y=n.data.get(a.dataId).values,b=new Float32Array(p*l*h*g),x=[i&&l>1?v-1:v,i&&h>1?m-1:m],k=[i&&l>1?l-1:l,i&&h>1?h-1:h],w=x[0]/k[0],_=x[1]/k[1],S=0,C=0;C<p;C++)for(var T=C*u[0],E=0;E<l;E++){var I=o?w*(E+.5):w*E,A=Math.min(v-1,i?Math.round(I):Math.floor(I));o&&(A=Math.max(0,A));for(var M=T+A*u[1],N=0;N<h;N++){var R=o?_*(N+.5):_*N,D=Math.min(m-1,i?Math.round(R):Math.floor(R));o&&(D=Math.max(0,D));for(var P=M+D*u[2],O=0;O<g;O++){var L=y[P+O];b[S++]=L}}}return n.makeTensorInfo([p,l,h,g],a.dtype,b)}};var Iq={kernelName:yR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners;ZU([i,a],"resizeNearestNeighborGrad");for(var s=rM(a.shape),u=rM(i.shape),c=f(a.shape,4),l=c[0],h=c[1],d=c[2],p=c[3],v=f(i.shape,3),m=v[1],g=v[2],y=new Float32Array(l*h*d*p),b=n.data.get(i.dataId).values,x=[o&&m>1?h-1:h,o&&g>1?d-1:d],k=[o&&m>1?m-1:m,o&&g>1?g-1:g],w=x[0]/k[0],_=x[1]/k[1],S=1/w,C=1/_,T=2*Math.ceil(S)+2,E=2*Math.ceil(C)+2,I=0;I<l;I++)for(var A=I*s[0],M=0;M<h;M++)for(var N=A+M*s[1],R=Math.floor(M*S),D=Math.floor(R-T/2),P=0;P<d;P++)for(var O=N+P*s[2],L=Math.floor(P*C),F=Math.floor(L-E/2),z=0;z<p;z++){for(var B=0,U=0;U<T;U++){var V=U+D;if(!(V<0||V>=m)){var W=A+V*u[1],G=V*w;if(M===Math.min(h-1,o?Math.round(G):Math.floor(G)))for(var j=0;j<E;j++){var q=j+F;if(!(q<0||q>=g)){var H=W+q*u[2],X=q*_;P===Math.min(d-1,o?Math.round(X):Math.floor(X))&&(B+=b[H+z])}}}}y[O+z]=B}return n.makeTensorInfo(a.shape,a.dtype,y)}};var Aq={kernelName:wR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims;ZU(a,"reverse");var o=a.shape.length,s=YA(i,a.shape);if(0===o)return aV({inputs:{x:a},backend:n});for(var u=new xD(a.shape,a.dtype),c=n.bufferSync(a),l=function(e){var t=u.indexToLoc(e),n=t.slice();s.forEach((function(e){return n[e]=a.shape[e]-1-n[e]})),u.set.apply(u,[c.get.apply(c,Tt(n))].concat(Tt(t)))},h=0;h<u.size;h++)l(h);return n.makeTensorInfo(u.shape,u.dtype,u.values)}},Mq={kernelName:JR,backendName:"cpu",kernelFunc:function(e){for(var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=QA(a.dtype,qA(a.shape)),l=f(a.shape,4),h=l[0],d=l[1],p=l[2],v=l[3],m=function(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}(s,d,p),g=f(m,2),y=g[0],b=g[1],x=Math.sin(i),k=Math.cos(i),w=u.data.get(a.dataId).values,_=0;_<h;_++)for(var S=_*p*d*v,C=0;C<d;C++)for(var T=C*(p*v),E=0;E<p;E++)for(var I=E*v,A=0;A<v;A++){var M=[h,C,E,A],N=M[2],R=M[1],D=(N-y)*k-(R-b)*x,P=(N-y)*x+(R-b)*k;D=Math.round(D+y),P=Math.round(P+b);var O=o;if("number"!==typeof o&&(O=3===A?255:o[A]),D>=0&&D<p&&P>=0&&P<d)O=w[S+P*(p*v)+D*v+A];c[S+T+I+A]=O}return{dataId:u.write(c,a.shape,a.dtype),shape:a.shape,dtype:a.dtype}}},Nq=eV(_R,(function(e){var t=Math.floor(e);return e-t<.5?Math.floor(e):e-t>.5?Math.ceil(e):t%2===0?t:t+1})),Rq={kernelName:_R,backendName:"cpu",kernelFunc:Nq},Dq=kW((function(e){return 1/Math.sqrt(e)})),Pq=tV(SR,Dq),Oq={kernelName:SR,backendName:"cpu",kernelFunc:Pq};function Lq(e,t,n,r,a,i,o,s,u,c){var l=[r/a,a],h=e.values,f=t.values;if(0===r)return kP(n,t.dtype);var d=kP(l,t.dtype);d.values.fill(u);for(var p=0;p<i;p++){for(var v=[],m=0,g=0;g<o;g++){var y=h[p*o+g];v.push(y),m+=y*s[g]}if(m<0||m>=r/a)throw new Error("Invalid indices: ".concat(v," does not index into ").concat(n));for(var b=0;b<a;b++)c?d.values[m*a+b]+=f[p*a+b]:d.values[m*a+b]=0===t.rank?f[0]:f[p*a+b]}return d}var Fq={kernelName:"ScatterNd",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=oF(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,h=s.strides,f=s.outputSize,d=Lq(n.bufferSync(a),n.bufferSync(i),o,f,l,c,u,h,0,!0);return n.makeTensorInfo(o,d.dtype,d.values)}};var zq={kernelName:CR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e;ZU([r,a,i],"select");for(var o=r.shape.length,s=n.data.get(r.dataId).values,u=n.data.get(a.dataId).values,c=n.data.get(i.dataId).values,l=ND(a.dtype,i.dtype),h=sM(qA(a.shape),l),f=0,d=0===o||o>1||1===a.shape.length?1:qA(a.shape.slice(1)),p=0;p<s.length;p++)for(var v=0;v<d;v++)1===s[p]?h[f++]=u[p]:h[f++]=c[p];return n.makeTensorInfo(a.shape,l,h)}},Bq=eV(TR,(function(e){return e>=0?1.0507009873554805*e:1.7580993408473768*(Math.exp(e)-1)})),Uq={kernelName:TR,backendName:"cpu",kernelFunc:Bq},Vq=eV(NR,(function(e){return 1/(1+Math.exp(-e))})),Wq={kernelName:NR,backendName:"cpu",kernelFunc:Vq},Gq=eV(MR,(function(e){return e<0?-1:e>0?1:0})),jq={kernelName:MR,backendName:"cpu",kernelFunc:Gq},qq=eV(IR,(function(e){return Math.sin(e)})),Hq={kernelName:IR,backendName:"cpu",kernelFunc:qq},Xq=eV(AR,(function(e){return Math.sinh(e)})),Kq={kernelName:AR,backendName:"cpu",kernelFunc:Xq},Yq=Math.log(1.1920928955078125e-7)+2,Qq=eV(RR,(function(e){var t=e>-Yq,n=e<Yq,r=Math.exp(e);return n?r:t?e:Math.log(1+r)})),Zq={kernelName:RR,backendName:"cpu",kernelFunc:Qq};var Jq={kernelName:OR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;ZU([a],"spaceToBatchND");var s=qA(i),u=[[0,0]];u.push.apply(u,Tt(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=vq.kernelFunc({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),h=rF(l.shape,i,s,!1),f=aF(h.length,i.length,!1),d=iF(l.shape,i,s,!1),p=MV({inputs:{x:l},backend:n,attrs:{shape:h}}),v=GV({inputs:{x:p},backend:n,attrs:{perm:f}}),m=MV({inputs:{x:v},backend:n,attrs:{shape:d}});return n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),m}};var $q={kernelName:"SparseToDense",backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=oF(0,a,s),c=u.sliceRank,l=u.numUpdates,h=u.sliceSize,f=u.strides,d=u.outputSize,p=Lq(n.bufferSync(a),n.bufferSync(i),s,d,h,l,c,f,n.data.get(o.dataId).values[0],!1);return n.makeTensorInfo(s,p.dtype,p.values)}};var eH={kernelName:LR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=YA(r.axis,a.shape)[0],s=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)VA(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);VA(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}VA(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}(a,i,o),u=new Array(a.shape.length).fill(0),c=a.shape.slice();return s.map((function(e){var t=Tt(c);t[o]=e;var r=vW({inputs:{x:a},backend:n,attrs:{begin:u,size:t}});return u[o]+=e,r}))}},tH=eV(DR,(function(e){return Math.sqrt(e)})),nH={kernelName:DR,backendName:"cpu",kernelFunc:tH},rH={kernelName:BR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n;ZU(r,"square");for(var i=a.data.get(r.dataId).values,o=new Float32Array(i.length),s=0;s<i.length;++s){var u=i[s];o[s]=u*u}return{dataId:a.write(o,r.shape,r.dtype),shape:r.shape,dtype:r.dtype}}},aH=uV((function(e,t){var n=e-t;return n*n})),iH=SV(zR,aH),oH={kernelName:zR,backendName:"cpu",kernelFunc:iH},sH=eV(ZR,(function(e,t){var n=t;return isNaN(e)?NaN:e>0?1:n.alpha})),uH={kernelName:ZR,backendName:"cpu",kernelFunc:sH};function cH(e,t,n,r){for(var a=kP(e,t.dtype),i=0;i<a.size;i++){for(var o=a.indexToLoc(i),s=new Array(o.length),u=0;u<s.length;u++)s[u]=o[u]*n[u]+r[u];a.set.apply(a,[t.get.apply(t,s)].concat(Tt(o)))}return a}var lH={kernelName:VR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.begin,o=r.end,s=r.strides,u=r.beginMask,c=r.endMask,l=r.ellipsisMask,h=r.newAxisMask,f=r.shrinkAxisMask;ZU(a,"stridedSlice");var d,p=YP(a.shape,i,o,s,u,c,l,h,f),v=p.nonStrided,m=p.$begin,g=p.$strides,y=p.size,b=p.newShape,x=p.outShape,k=MV({inputs:{x:a},backend:n,attrs:{shape:b}});if(v){var w=vW({inputs:{x:k},backend:n,attrs:{begin:m,size:y}});d=MV({inputs:{x:w},backend:n,attrs:{shape:x}}),n.disposeIntermediateTensorInfo(w)}else if(x.some((function(e){return 0===e})))d=n.makeTensorInfo(x,a.dtype,[]);else{var _=cH(x,n.bufferSync(k),g,m);d=n.makeTensorInfo(_.shape,_.dtype,_.values)}var S=MV({inputs:{x:d},backend:n,attrs:{shape:x}});return n.disposeIntermediateTensorInfo(k),n.disposeIntermediateTensorInfo(d),S}},hH=eV(WR,(function(e){return Math.tan(e)})),fH={kernelName:WR,backendName:"cpu",kernelFunc:hH},dH=eV(GR,(function(e){return Math.tanh(e)}));function pH(e,t){for(var n=new Array(e.rank),r=0;r<n.length;r++)n[r]=e.shape[r]*t[r];for(var a=kP(n,e.dtype),i=0;i<a.values.length;++i){for(var o=a.indexToLoc(i),s=new Array(e.rank),u=0;u<s.length;u++)s[u]=o[u]%e.shape[u];var c=e.locToIndex(s);a.values[i]=e.values[c]}return a}var vH={kernelName:jR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;ZU(a,"tile");var o=pH(n.bufferSync(a),i);return n.makeTensorInfo(o.shape,o.dtype,o.values)}};function mH(e,t,n,r,a){for(var i=t[t.length-1],o=e.length/i,s=i,u=QA(n,o*r),c=QA("int32",o*r),l=0;l<o;l++){for(var h=l*s,f=e.subarray(h,h+s),d=[],p=0;p<f.length;p++)d.push({value:f[p],index:p});d.sort((function(e,t){return t.value-e.value}));for(var v=l*r,m=u.subarray(v,v+r),g=c.subarray(v,v+r),y=0;y<r;y++)m[y]=d[y].value,g[y]=d[y].index}var b=t.slice();return b[b.length-1]=r,[kP(b,n,u),kP(b,"int32",c)]}var gH={kernelName:qR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k;r.sorted,ZU(a,"topk");var o=f(mH(n.data.get(a.dataId).values,a.shape,a.dtype,i),2),s=o[0],u=o[1];return[n.makeTensorInfo(s.shape,s.dtype,s.values),n.makeTensorInfo(u.shape,u.dtype,u.values)]}};function yH(e,t,n,r){for(var a=YA(t,n)[0],i=[1,n[0],1],o=0;o<a;o++)i[0]*=n[o];i[1]=n[a];for(var s=a+1;s<n.length;s++)i[2]*=n[s];for(var u={},c=new Int32Array(n[a]),l=new xD(i,r,e),h=[],f=1===i[0]&&1===i[2],d=0;d<n[a];d++){var p=void 0;if(f)p=e[d].toString();else{for(var v=[],m=0;m<i[0];m++)for(var g=0;g<i[2];g++)v.push(l.get(m,d,g));p=v.join(",")}if(void 0!==u[p])c[d]=u[p];else{var y=Object.keys(u).length;u[p]=y,c[d]=y,h.push(d)}}var b=i.slice();b[1]=Object.keys(u).length;var x=new xD(b,r);h.forEach((function(e,t){for(var n=0;n<i[0];n++)for(var r=0;r<i[2];r++)x.set(l.get(n,e,r),n,t,r)}));var k=n.slice();return k[a]=b[1],{outputValues:x.values,outputShape:k,indices:c}}var bH={kernelName:XR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;ZU(i,"unique");var o=yH(r.data.get(i.dataId).values,a,i.shape,i.dtype),s=o.outputValues,u=o.outputShape,c=o.indices;return[r.makeTensorInfo(u,i.dtype,s),r.makeTensorInfo([c.length],"int32",c)]}};var xH={kernelName:KR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a.shape.length,s=a.shape[i],u=new Array(o-1),c=0,l=0;l<o;l++)l!==i&&(u[c++]=a.shape[l]);var h=new Array(o).fill(0),f=a.shape.slice();f[i]=1;for(var d=new Array(s),p=0;p<d.length;p++){h[i]=p;var v=vW({inputs:{x:a},backend:n,attrs:{begin:h,size:f}});d[p]=MV({inputs:{x:v},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(v)}return d}};for(var kH={kernelName:YR,backendName:"cpu",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments;ZU(a,"unsortedSegmentSum");for(var s=[],u=[],c=a.shape.length-i.shape.length,l=i,h=0;h<c;++h){var f=hG({inputs:{input:l},backend:n,attrs:{dim:h+1}});l=f,u.push(f)}for(var d=0;d<o;++d){var p=vD(d,"int32"),v=n.makeTensorInfo([],"int32",p),m=aG({inputs:{a:v,b:l},backend:n}),g=wV({inputs:{x:m},backend:n,attrs:{dtype:"float32"}}),y=yG({inputs:{a:g,b:a},backend:n}),b=zj({inputs:{x:y},backend:n,attrs:{axis:0,keepDims:!1}});s.push(b),u.push(v),u.push(m),u.push(g),u.push(y),u.push(b)}var x=dq({inputs:s,backend:n,attrs:{axis:0}});return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),x}},wH=0,_H=[PV,LV,zV,UV,AV,VV,qV,HV,XV,KV,QV,JV,eW,rW,iW,cW,lW,hW,fW,DV,dW,gW,xW,_V,SW,TW,yV,EW,RW,OW,LW,PW,zW,BW,FW,VW,GW,jW,qW,HW,XW,YW,QW,ZW,JW,$W,tG,eG,wG,rV,nG,iG,sG,lG,fG,vG,MG,RG,DG,LG,BG,UG,VG,WG,jG,XG,QG,iV,ZG,MW,$G,tj,rj,sV,oj,cj,hj,pj,mj,bj,kj,Sj,Cj,Tj,Rj,Dj,Pj,Oj,Lj,Fj,Aj,Uj,Vj,jj,qj,Kj,Zj,bG,$j,tq,rq,iq,uq,cq,fq,pq,vq,yq,hV,xq,wq,kV,Sq,dV,vV,NV,Cq,Tq,Eq,Iq,Aq,Mq,Rq,Oq,Fq,zq,Uq,Wq,jq,Hq,Kq,mW,Qj,Zq,Jq,$q,eH,nH,rH,oH,uH,lH,TG,Bj,fH,{kernelName:GR,backendName:"cpu",kernelFunc:dH},vH,gH,jV,bH,xH,kH,hq];wH<_H.length;wH++){rD(_H[wH])}var SH,CH,TH,EH={},IH={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function AH(e){if(!(e in EH)){var t=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!==typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);if(t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete EH[e]}),!1),1===e)return t.getContext("webgl",IH)||t.getContext("experimental-webgl",IH);return t.getContext("webgl2",IH)}(e);if(null===t)return console.log("Could not get context for WebGL version",e),null;EH[e]=t}var n=EH[e];return n.isContextLost()?(delete EH[e],AH(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),EH[e])}function MH(e,t){return[t,e]}function NH(e){var t=ml(e);return bl(Math.ceil(t/4))}function RH(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function DH(e,t){var n,r,a,i,o,s,u,c,l,h=e;return 2===jl().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,a=h.RGBA16F,i=h.RGBA32F,o=h.RED,s=4,u=1,c=h.HALF_FLOAT,l=h.FLOAT):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=h.RGBA,o=e.RGBA,s=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function PH(e,t){var n=t();return jl().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(SH||(SH={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(CH||(CH={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(TH||(TH={}));function OH(e){return!!(jl().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function LH(e,t){return YH(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function FH(e,t){var n=YH(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(PH(e,(function(){return e.shaderSource(n,t)})),PH(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw function(e,t){var n=UH.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return xl((t+1).toString(),i)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),h=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(xl(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var zH,BH,UH=/ERROR: [0-9]+:([0-9]+):/g;function VH(e,t){if(PH(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function WH(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(PH(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),PH(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),PH(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function GH(e,t,n){return YH(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}function jH(e,t,n){return e.getUniformLocation(t,n)}function qH(e,t,n,r){PH(e,(function(){return function(e,t,n){QH(e,n),PH(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),PH(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}(e,t,r)})),PH(e,(function(){return e.uniform1i(n,r)}))}function HH(e,t,n){PH(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),PH(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function XH(e,t){PH(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),PH(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function KH(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function YH(e,t,n){var r=PH(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function QH(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function ZH(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return ml(e.slice(0,e.length-t))}function JH(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function $H(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[ZH(e)].concat(Tt(JH(e)))),t}function eX(e){return e%2===0}function tX(e,t){if(gl(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(eX(n)&&eX(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&eX(e[0])&&eX(t[0])}function nX(e,t){return null!=e.getExtension(t)}function rX(e){try{if(null!=AH(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function aX(e){if(0===e)return!1;var t=AH(e);if(1!==e){if(nX(t,"EXT_color_buffer_float"))return iX(t);var n="EXT_color_buffer_half_float";if(nX(t,n)){var r=t.getExtension(n);return function(e,t){var n=DH(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,r)}return!1}return!!nX(t,"OES_texture_float")&&(!!nX(t,"WEBGL_color_buffer_float")&&iX(t))}function iX(e){var t=DH(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function oX(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&fl("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors ")+"in the WebGL backend."}))}))}var sX=jl();function uX(){var e,t,n,r,a,i,o,s,u,c;return 2===jl().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function cX(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Pl(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function lX(e){var t=Pl(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}sX.registerFlag("HAS_WEBGL",(function(){return sX.getNumber("WEBGL_VERSION")>0})),sX.registerFlag("WEBGL_VERSION",(function(){return rX(2)?2:rX(1)?1:0})),sX.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),sX.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===sX.get("WEBGL_VERSION")})),sX.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),sX.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),sX.registerFlag("WEBGL_PACK",(function(){return sX.getBool("HAS_WEBGL")})),sX.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return sX.getBool("WEBGL_PACK")})),sX.registerFlag("WEBGL_PACK_CLIP",(function(){return sX.getBool("WEBGL_PACK")})),sX.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),sX.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return sX.getBool("WEBGL_PACK")})),sX.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return sX.getBool("WEBGL_PACK")})),sX.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return sX.getBool("WEBGL_PACK")})),sX.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return sX.getBool("WEBGL_PACK")})),sX.registerFlag("WEBGL_PACK_REDUCE",(function(){return sX.getBool("WEBGL_PACK")})),sX.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return sX.getBool("WEBGL_PACK")})),sX.registerFlag("WEBGL_CONV_IM2COL",(function(){return sX.getBool("WEBGL_PACK")})),sX.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==zH){var t=AH(e);zH=t.getParameter(t.MAX_TEXTURE_SIZE)}return zH}(sX.getNumber("WEBGL_VERSION"))})),sX.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==BH){var t=AH(e);BH=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,BH)}(sX.getNumber("WEBGL_VERSION"))})),sX.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=sX.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=AH(e);return nX(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:nX(t,"EXT_disjoint_timer_query")?1:0}(e)})),sX.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return sX.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!kp()})),sX.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=AH(e);if(1===e){if(!nX(t,"OES_texture_float"))return!1}else if(!nX(t,"EXT_color_buffer_float"))return!1;return iX(t)}(sX.getNumber("WEBGL_VERSION"))})),sX.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!sX.getBool("WEBGL_FORCE_F16_TEXTURES")&&sX.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),sX.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return aX(sX.getNumber("WEBGL_VERSION"))})),sX.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=sX.getNumber("WEBGL_VERSION"))&&null!=AH(e).fenceSync;var e})),sX.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return sX.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),sX.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))}));var hX="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",fX=Jn((function e(t){$n(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=SH.DENSE;var n=NH(t),r=uX();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(cX(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(n[0],", ").concat(n[1],"));\n        int index = 4 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")})),dX=Jn((function e(t){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=SH.DENSE;var n=NH(t),r=uX();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(cX(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(n[0],", ").concat(n[1],"));\n        int index = 4 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")})),pX=Jn((function e(t){$n(this,e),this.variableNames=["A"],this.outTexUsage=CH.DOWNLOAD;var n=uX();this.outputShape=t,this.userCode="\n      ".concat(hX,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),vX=Jn((function e(t){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=CH.DOWNLOAD;var n=uX();this.outputShape=t,this.userCode="\n      ".concat(hX,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),mX=Jn((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];$n(this,e),this.variableNames=["A"];var a=uX(),i=f(n,2),o=i[0],s=i[1];this.outputShape=t;var u="result";r&&(u="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(lX(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / ").concat(s,";\n        int c = imod(flatIndex, ").concat(s,");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n        vec4 values = ").concat(a.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(a.output," = vec4(").concat(u,", 0., 0., 0.);\n      }\n    ")})),gX=Jn((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];$n(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var a=uX(),i=f(n,2),o=i[0],s=i[1];this.outputShape=t;var u="",c="result";r&&(c="floor(result * 255. + 0.5)");for(var l=0;l<=1;l++)for(var h=0;h<=1;h++){var d=2*l+h;u+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(h," < ").concat(t[2],") {\n            localCoords[2] += ").concat(h,";\n            if(localCoords[1] + ").concat(l," < ").concat(t[1],") {\n              localCoords[1] += ").concat(l,";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ").concat(s,";\n              c = imod(flatIndex, ").concat(s,");\n              uv = (vec2(c, r) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n              values = ").concat(a.texture2D,"(A, uv);\n\n              if(offset == 0) {\n                result[").concat(d,"] = values[0];\n              } else if(offset == 1) {\n                result[").concat(d,"] = values[1];\n              } else if(offset == 2) {\n                result[").concat(d,"] = values[2];\n              } else {\n                result[").concat(d,"] = values[3];\n              }\n            }\n          }\n        ")}this.userCode="\n      ".concat(lX(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ").concat(u,"\n\n        ").concat(a.output," = ").concat(c,";\n      }\n    ")}));function yX(e){var t=uX();return function(e,t){var n=YH(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(PH(e,(function(){return e.shaderSource(n,t)})),PH(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function bX(e){return function(e,t){var n=YH(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return PH(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),PH(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function xX(e){return function(e,t){var n=YH(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return PH(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),PH(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}function kX(e,t,n,r,a,i){!function(e,t){var n=jl().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var a="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+i+".")}}(t,n);var o=function(e){return YH(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return PH(e,(function(){return e.bindTexture(s,o)})),PH(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),PH(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),PH(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),PH(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),PH(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})),PH(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),o}function wX(e){return e.internalFormatFloat}function _X(e){return e.internalFormatHalfFloat}function SX(e){return e.downloadTextureFormat}function CX(e){return e.internalFormatPackedFloat}function TX(e){return e.internalFormatPackedHalfFloat}function EX(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=f(RH(e,t),2);return n[0]*n[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}var IX=function(){function e(t){$n(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=jl().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(e,t){EH[e]=t}(n,t)):this.gl=AH(n);var r="WEBGL_color_buffer_float",a="EXT_color_buffer_half_float";if(1===jl().getNumber("WEBGL_VERSION")){var i="OES_texture_half_float";if(this.textureFloatExtension=LH(this.gl,"OES_texture_float"),nX(this.gl,i))this.textureHalfFloatExtension=LH(this.gl,i);else if(jl().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),nX(this.gl,a))this.colorBufferHalfFloatExtension=LH(this.gl,a);else if(jl().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",nX(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!nX(this.gl,a))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(a)}this.vertexBuffer=bX(this.gl),this.indexBuffer=xX(this.gl),this.framebuffer=function(e){return YH(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=DH(this.gl,this.textureHalfFloatExtension)}return Jn(e,[{key:"debug",get:function(){return jl().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;PH(t,(function(){return t.finish()})),PH(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),PH(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),PH(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),PH(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),PH(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=f(MH(t,n),2);return kX(e,a[0],a[1],wX(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=f(MH(t,n),2);return kX(e,a[0],a[1],_X(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=f(MH(t,n),2);return kX(e,a[0],a[1],SX(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){PH(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?PH(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):PH(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),PH(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){var o,s,u;PH(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),PH(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),PH(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=f(RH(t,n),2);return kX(e,a[0],a[1],TX(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=f(RH(t,n),2);return kX(e,a[0],a[1],CX(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(XH(this.gl,this.framebuffer),this.outputTexture=null),PH(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=f(MH(t,n),2),i=a[0],o=a[1],s=new Uint8Array(t*n*4);return PH(e,(function(){return e.readPixels(0,0,i,o,r.downloadTextureFormat,e.UNSIGNED_BYTE,s)})),new Float32Array(s.buffer)}(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return EX(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();PH(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return PH(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),PH(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),PH(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(jl().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else jl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,jl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return PH(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(r.gl,t,n)}))}},{key:"createProgram",value:function(e){this.throwIfDisposed();var t=this.gl,n=FH(t,e),r=yX(t),a=function(e){return YH(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(t);return PH(t,(function(){return t.attachShader(a,r)})),PH(t,(function(){return t.attachShader(a,n)})),function(e,t){if(PH(e,(function(){return e.linkProgram(t)})),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,a),this.debug&&VH(t,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=function(e,t,n){return PH(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),WH(e,t,"clipSpacePos",n,3,20,0)&&WH(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),a}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&PH(this.gl,(function(){return t.gl.deleteProgram(e)}))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&VH(this.gl,this.program),PH(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?GH(this.gl,e,t):jH(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),PH(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),qH(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=f(RH(t,n),2),a=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,a,i)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&VH(this.gl,this.program),KH(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),PH(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),PH(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=LH(this.gl,2===jl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===jl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==jl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=ns(es().mark((function e(t){var n=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,kl((function(){return n.disposed||n.isQueryAvailable(t,jl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,jl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||kl((function(){return n.pollItems(),0===n.itemsToPoll.length}))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),HH(this.gl,e,this.framebuffer),this.debug&&KH(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(HH(this.gl,this.outputTexture,this.framebuffer),this.debug&&KH(this.gl)):XH(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;HH(r,e,this.framebuffer),this.debug&&KH(r),this.outputTexture=e,PH(r,(function(){return r.viewport(0,0,t,n)})),PH(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),PH(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]),e}();var AX=function(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r};function MX(e,t,n,r){var a=[];e.forEach((function(e){var t=ml(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?a.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(a.push("uniform sampler2D ".concat(e.name,";")),a.push("uniform int offset".concat(e.name,";")))}));var i,o,s=a.join("\n"),u=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r="";r+=n?RX(e):NX(e);var a=e.shapeInfo.logicalShape,i=t.logicalShape;a.length<=i.length&&(r+=n?BX(e,t):UX(e,t));return r}(e,t,r)})).join("\n"),c=t.texShape,l=uX(),h=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(l),f=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(DX,"\n    ").concat(PX,"\n    ").concat(OX,"\n  ")}(l);return t.isPacked?(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===n[0])return"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(n[1],".0);\n      }\n    ");if(1===n[1])return"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(n[0],".0);\n      }\n    ");return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      return 2 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n    }\n  ")}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(gl(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(n[0],", ").concat(n[1],"));\n      }\n    ");var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),a=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t);default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),a=r*Math.ceil(e[e.length-2]/2),i=a,o="",s="b, r, c",u=2;u<e.length-1;u++)i*=e[e.length-u-1],o="\n      int b".concat(u," = index / ").concat(i,";\n      index -= b").concat(u," * ").concat(i,";\n    ")+o,s="b".concat(u,", ")+s;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      ").concat(o,"\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec").concat(e.length,"(").concat(s,");\n    }\n  ")}(e,t)}}(t.logicalShape,c),o=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(l)):(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){if(1===t[0])return"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t);case 2:return function(e,t){if(gl(e,t))return"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=cX(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t);case 4:return function(e,t){var n=cX(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t);case 5:return function(e,t){var n=cX(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=cX(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,c),o=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(l)),r&&(f+=LX),[f,h,o,s,i,u,n].join("\n")}function NX(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(n,"() {return ").concat(t,";}");var r=f(e.shapeInfo.texShape,2),a=r[0],i=r[1];if(1===a&&1===i)return"\n      float ".concat(n,"() {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var o=f(e.shapeInfo.texShape,2),s=o[0],u=o[1],c=FX(t);return"\n    float ".concat(n,"() {\n      vec2 uv = uvFromFlat(").concat(s,", ").concat(u,", ").concat(c,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(n,"(int index) {\n        ").concat(zX(e),"\n      }\n    ");var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===i&&1===a)return"\n      float ".concat(n,"(int index) {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var o=FX(t);if(1===i)return"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(o,") + 0.5) / ").concat(a,".0);\n        return sampleTexture(").concat(t,", uv);\n      }\n    ");if(1===a)return"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(o,") + 0.5) / ").concat(i,".0, 0.5);\n        return sampleTexture(").concat(t,", uv);\n      }\n    ");return"\n    float ".concat(n,"(int index) {\n      vec2 uv = uvFromFlat(").concat(a,", ").concat(i,", index + ").concat(o,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape;if(null!=a&&gl(t,a)){var i=a[0],o=a[1];return"\n    float ".concat(r,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(o,".0, ").concat(i,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}var s=_l(t),u=s.newShape,c=s.keptDims,l=u;if(l.length<t.length){var h=WX(e,l),f=["row","col"];return"\n      ".concat(NX(h),"\n      float ").concat(r,"(int row, int col) {\n        return ").concat(r,"(").concat(GX(f,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(t[1],", 1)));\n        ").concat(zX(e),"\n      }\n    ");var d=a[0],p=a[1],v=FX(n);if(1===p)return"\n    float ".concat(r,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(t[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(d,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");if(1===d)return"\n    float ".concat(r,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(t[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(p,".0, 0.5);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");return"\n  float ".concat(r,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(t[1]," + col + ").concat(v,";\n    vec2 uv = uvFromFlat(").concat(d,", ").concat(p,", index);\n    return sampleTexture(").concat(n,", uv);\n  }\n")}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[1]*t[2],i=t[2],o=_l(t),s=o.newShape,u=o.keptDims,c=s;if(c.length<t.length){var l=WX(e,c),h=["row","col","depth"];return"\n        ".concat(NX(l),"\n        float ").concat(r,"(int row, int col, int depth) {\n          return ").concat(r,"(").concat(GX(h,u),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(a,", ").concat(i,", 1)));\n        ").concat(zX(e),"\n      }\n    ");var f=e.shapeInfo.texShape,d=f[0],p=f[1],v=e.shapeInfo.flatOffset;if(p===a&&null==v)return"\n        float ".concat(r,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(i,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(p,".0, ").concat(d,".0);\n          return sampleTexture(").concat(n,", uv);\n        }\n      ");if(p===i&&null==v)return"\n    float ".concat(r,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(t[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(p,".0, ").concat(d,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var m=FX(n);return"\n      float ".concat(r,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(a," + col * ").concat(i," + depth + ").concat(m,";\n        vec2 uv = uvFromFlat(").concat(d,", ").concat(p,", index);\n        return sampleTexture(").concat(n,", uv);\n      }\n  ")}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[3],i=t[2]*a,o=t[1]*i,s=_l(t),u=s.newShape,c=s.keptDims;if(u.length<t.length){var l=WX(e,u),h=["row","col","depth","depth2"];return"\n      ".concat(NX(l),"\n      float ").concat(r,"(int row, int col, int depth, int depth2) {\n        return ").concat(r,"(").concat(GX(h,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(o,", ").concat(i,", ").concat(a,", 1)));\n        ").concat(zX(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],v=d[1];if(v===o&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(v===a&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(t[1]*t[2],", ").concat(t[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var m=FX(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(o," + col * ").concat(i," +\n          depth * ").concat(a," + depth2;\n      vec2 uv = uvFromFlat(").concat(p,", ").concat(v,", index + ").concat(m,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=_l(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var h=WX(e,c),f=["row","col","depth","depth2","depth3"];return"\n      ".concat(NX(h),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(GX(f,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(zX(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,v=p[0],m=p[1];if(m===s&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(m,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(m===a&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(m,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=FX(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(m,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=_l(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){var s=WX(e,i),u=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(NX(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(GX(u,o),");\n      }\n    ")}var c=t[5],l=t[4]*c,h=t[3]*l,f=t[2]*h,d=t[1]*f;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(d,", ").concat(f,", ").concat(h,", ").concat(l,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(c,", 1)));\n        ").concat(zX(e),"\n      }\n    ");var p=e.shapeInfo.flatOffset,v=e.shapeInfo.texShape,m=v[0],g=v[1];if(g===d&&null==p)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(f,", ").concat(h,", ").concat(l,", ").concat(c,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(g===c&&null==p)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var y=FX(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(d," + col * ").concat(f," + depth * ").concat(h," +\n          depth2 * ").concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(g,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(t.length,"-D input sampling")+" is not yet supported")}}function RX(e){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=uX();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=uX();return"\n    vec4 ".concat(n,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(a[0],", ").concat(a[1],", index);\n      return ").concat(i.texture2D,"(").concat(t,", uv);\n    }\n  ")}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=a[0],o=a[1],s=uX();if(null!=a&&gl(t,a))return"\n      vec4 ".concat(r,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(o,".0, ").concat(i,".0);\n\n        return ").concat(s.texture2D,"(").concat(n,", uv);\n      }\n    ");var u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=Math.ceil(t[1]/2);return"\n    vec4 ".concat(r,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(c,", ").concat(u[0],", ").concat(u[1],", row, col);\n      return ").concat(s.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===t[0]){var o=[1,2],s=WX(e,t.slice(1)),u=["b","row","col"];return"\n        ".concat(RX(s),"\n        vec4 ").concat(r,"(int b, int row, int col) {\n          return ").concat(r,"(").concat(GX(u,o),");\n        }\n      ")}var c=i[0],l=i[1],h=Math.ceil(t[2]/2),f=h*Math.ceil(t[1]/2),d=uX();return"\n    vec4 ".concat(r,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(c,", ").concat(l,", ").concat(f,", ").concat(h,", b, row, col);\n      return ").concat(d.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=o[0],u=o[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),h="int b, int row, int col",f="b * ".concat(l," + (row / 2) * ").concat(c," + (col / 2)"),d=2;d<n-1;d++)h="int b".concat(d,", ")+h,l*=t[n-d-1],f="b".concat(d," * ").concat(l," + ")+f;var p=uX();return"\n    vec4 ".concat(a,"(").concat(h,") {\n      int index = ").concat(f,";\n      int texR = index / ").concat(u,";\n      int texC = index - texR * ").concat(u,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(u,", ").concat(s,");\n      return ").concat(p.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e)}}var DX="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",PX="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",OX="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",LX="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function FX(e){return"offset".concat(e)}function zX(e){var t=e.name,n=ml(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function BX(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=AX(e.shapeInfo.logicalShape,t.logicalShape),c=VX(s),l=s-o,h=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(h[e+l]," = 0;")})).join("\n");var f="";f=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(h[t+l])})).join(", ");var d="return outputValue;",p=1===ml(e.shapeInfo.logicalShape),v=1===ml(t.logicalShape);if(1!==o||p||v){if(p&&!v)d=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var m=o-2,g=o-1;u.indexOf(m)>-1&&u.indexOf(g)>-1?d="return vec4(outputValue.x);":u.indexOf(m)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}}else d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(f,");\n      ").concat(d,"\n    }\n  ")}function UX(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&gl(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var c,l=VX(u),h=AX(e.shapeInfo.logicalShape,t.logicalShape),f=u-s,d=["x","y","z","w","u","v"];c=0===s?"":u<2&&h.length>=1?"coords = 0;":h.map((function(e){return"coords.".concat(d[e+f]," = 0;")})).join("\n");var p="";return p=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(d[t+f])})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(c,"\n      return get").concat(r,"(").concat(p,");\n    }\n  ")}function VX(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function WX(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function GX(e,t){return t.map((function(t){return e[t]})).join(", ")}function jX(e,t,n,r){var a=t.userCode,i=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=i.map((function(e){return e.shapeInfo})),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=MX(i,s,a,t.packedInputs),c=e.createProgram(u),l=null,h=e.getUniformLocation(c,"NAN",!1);1===jl().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(c,"INFINITY",!1));for(var f={},d=0;d<t.variableNames.length;d++){var p=t.variableNames[d];f[p]=e.getUniformLocation(c,p,false),f["offset".concat(p)]=e.getUniformLocation(c,"offset".concat(p),false)}return{program:t,source:u,webGLProgram:c,uniformLocations:f,inShapeInfos:o,outShapeInfo:s,infLoc:l,nanLoc:h}}function qX(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!gl(r,i))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!gl(o,s))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(o," and ").concat(s," must match"))}}))}function HX(e,t,n,r,a){qX(t.inShapeInfos,n),qX([t.outShapeInfo],[r]);var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i,o[0],o[1]):e.setOutputMatrixTexture(i,o[0],o[1]),e.setProgram(t.webGLProgram),1===jl().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],o=t.uniformLocations["offset".concat(a)];if(null!=i)if(n.isUniform)if(ml(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(i,s)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,i,r)})),null!=a&&a(e,t.webGLProgram),e.executeProgram()}function XX(e,t,n){var r="";t.concat(n).forEach((function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+="".concat(e.shape,"_").concat(n,"_").concat(t)}));var a=e.userCode,i=e.constructor.name;return i+="_"+r+"_"+a}var KX=TV,YX=yW,QX=bW,ZX=wW,JX=IW,$X=uG,eK=dG,tK=PG,nK=GG,rK=qG,aK=aj,iK=lj,oK=fj,sK=Ej,uK=Mj,cK=Wj,lK=mG,hK=Jj,fK=bq,dK=kq,pK=Dq,vK=OV,mK=pW,gK=cH,yK=_G,bK=pH,xK=mH,kK=WV,wK=yH;function _K(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function SK(e,t){return 1===t?[e]:_K(e,t)}var CK=Jn((function e(t){$n(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var n=t.length;if(0===n)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var r=SK("rc",n),a=VX(n),i=function(e,t,n){if(1===e)return"rc > ".concat(t[0]);for(var r="",a=e-2;a<e;a++)r+="".concat(n[a]," >= ").concat(t[a]),a<e-1&&(r+="||");return r}(n,t,r),o=function(e,t,n,r){if(1===e)return"";var a=r.slice(-2);return"\n    int r = ".concat(a[0],";\n    int c = ").concat(a[1],";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ").concat(t,";\n    bool rEdge = rp1 >= ").concat(n,";\n  ")}(n,t[t.length-1],t[t.length-2],r),s=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var a=0;a<=1;a++){for(var i="".concat(0===r?"r":"rp1",", ").concat(0===a?"c":"cp1"),o=2;o<e;o++)i="".concat(t[t.length-1-o],",")+i;n.push(i)}return n}(n,t);if(1===n)return"getA(rc),\n            rc + 1 >= ".concat(e[0]," ? 0. : getA(rc + 1),\n            0, 0");return"getA(".concat(r[0],"),\n          cEdge ? 0. : getA(").concat(r[1],"),\n          rEdge ? 0. : getA(").concat(r[2],"),\n          rEdge || cEdge ? 0. : getA(").concat(r[3],")")}(t,r);this.userCode="\n        void main() {\n          ".concat(a," rc = getOutputCoords();\n\n          if(").concat(i,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(o,"\n\n            setOutput(vec4(").concat(s,"));\n          }\n        }\n      ")}}));var TK=Jn((function e(t,n){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e){var t=cX(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(t,"\n      return ivec3(r, c, d);\n    }\n  ")}(n),"\n      ").concat(lX(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(t[1],";\n        int cols = ").concat(t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")}));var EK=function(){function e(t){$n(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return Jn(e,[{key:"acquireTexture",value:function(e,t,n){var r=AK(t,n),a=MK(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=IK(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return r===TH.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===TH.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===TH.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===TH.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===TH.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=AK(n,r),i=MK(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=IK(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=jl().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}]),e}();function IK(e,t,n,r,a){var i,o=function(e,t){switch(e){case TH.PACKED_2X2_FLOAT32:return CX(t);case TH.PACKED_2X2_FLOAT16:return TX(t);case TH.UNPACKED_FLOAT32:return wX(t);case TH.UNPACKED_FLOAT16:return _X(t);case TH.PACKED_4X1_UNSIGNED_BYTE:return SX(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var s=f(RH(e[0],e[1]),2);i=s[0]*s[1]}else{var u=f(MH(e[0],e[1]),2);i=u[0]*u[1]}var c=function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;throw new Error("Unknown internal format ".concat(t))}(n,o);return i*c}function AK(e,t){if(e===CH.UPLOAD)return TH.PACKED_2X2_FLOAT32;if(e===CH.RENDER||null==e)return function(e){return jl().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?TH.PACKED_2X2_FLOAT32:TH.UNPACKED_FLOAT32:e?TH.PACKED_2X2_FLOAT16:TH.UNPACKED_FLOAT16}(t);if(e===CH.DOWNLOAD||e===CH.PIXELS)return TH.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function MK(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var NK=Jn((function e(t,n){$n(this,e),this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),RK="if (isnan(x)) return x;",DK="return x;",PK="return abs(x);";var OK="return (x >= 0.0) ? x : (exp(x) - 1.0);",LK=RK+"\n  return (x < 0.0) ? 0.0 : x;\n",FK=RK+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",zK="return x;",BK="return x;",UK="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",VK="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",WK="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",GK=Jn((function e(t,n){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),jK=Jn((function e(t){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var n=t.length,r=SK("rc",n),a=VX(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")})),qK=function(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=Pv(e,"int32"),i=Pv([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()},HK={};var XK=function(e){tr(n,e);var t=sr(n);function n(e){var r,a;if($n(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.warnedAboutCPUBackend=!1,r.pendingDeletes=0,r.disposed=!1,!jl().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var i=AH(jl().getNumber("WEBGL_VERSION"));r.binaryCache=((a=jl().getNumber("WEBGL_VERSION"))in HK||(HK[a]={}),HK[a]),r.gpgpu=new IX(i),r.canvas=i.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=e,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=e.gl.canvas;return r.textureManager=new EK(r.gpgpu),r.numMBBeforeWarning=null==jl().global.screen?1024:jl().global.screen.height*jl().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new il(ir(r),gm()),r}return Jn(n,[{key:"numDataIds",value:function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}},{key:"write",value:function(e,t,n){if((jl().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||jl().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:CH.UPLOAD,refCount:1,complexParentRefCount:0}),r}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"decComplexRef",value:function(e){if(this.texData.has(e)){var t=this.texData.get(e);t.complexParentRefCount>0&&t.refCount--}}},{key:"move",value:function(e,t,n,r){if(jl().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:CH.UPLOAD,refCount:1,complexParentRefCount:0})}},{key:"disposeIntermediateTensorInfo",value:function(e){var t=e.dataId;if(this.texData.has(t)){var n=this.texData.get(t);n.refCount--,n.refCount<1&&this.disposeData(t)}}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new GK(o,zK):new NK(o,zK);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var h,f,d=null!=this.activeTimers;(d&&(h=Yd()),"complex64"===r)?f=px(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):f=this.getValuesFromTexture(e);return d&&(this.downloadWaitMs+=Yd()-h),this.convertAndCacheOnCPU(e,f)}},{key:"read",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,s,u,c,l,h,f,d,p,v,m,g,y,b,x,k,w,_;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,s=r.dtype,u=r.complexTensorInfos,c=r.isPacked,null==o){e.next=11;break}return l=c?new GK(i,zK):new NK(i,zK),h=this.runWebGLProgram(l,[{dataId:t,shape:i,dtype:s}],s),f=this.read(h.dataId),this.disposeIntermediateTensorInfo(h),e.abrupt("return",f);case 11:if(null==a){e.next=13;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 13:if(jl().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==jl().getNumber("WEBGL_VERSION")){e.next=15;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 15:if(d=null,"complex64"!==s&&jl().get("WEBGL_BUFFER_SUPPORTED")&&(p=this.decode(t),m=this.texData.get(p.dataId),d=(v=this.gpgpu).createBufferFromTexture.apply(v,[m.texture].concat(Tt(NH(i))))),this.pendingRead.set(t,[]),"complex64"===s){e.next=21;break}return e.next=21,this.gpgpu.createAndWaitForFence();case 21:if("complex64"!==s){e.next=30;break}return e.next=24,Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]);case 24:y=e.sent,b=y[0],x=y[1],g=px(b,x),e.next=31;break;case 30:null==d?g=this.getValuesFromTexture(t):(k=ml(i),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,k));case 31:return null!=p&&this.disposeIntermediateTensorInfo(p),w=this.convertAndCacheOnCPU(t,g),_=this.pendingRead.get(t),this.pendingRead.delete(t),_.forEach((function(e){return e(w)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),e.abrupt("return",w);case 38:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return Zd(e)}))}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return Pv(e.shape,e.dtype,n)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!OH(n)){if(jl().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=ml(n);if(jl().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,s=this.decode(e),u=this.texData.get(s.dataId),c=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[u.texture].concat(Tt(NH(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(s),c}var l=jl().getBool("WEBGL_PACK")&&!0===a,h=l?$H(n):n,f=l?new vX(h):new pX(h),d=this.runWebGLProgram(f,[{shape:h,dtype:r,dataId:e}],"float32"),p=this.texData.get(d.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture,p.texShape[0],p.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(d),v}},{key:"time",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,s,u;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.activeTimers,r=[],a=!1,null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,t(),i=vl(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=vl(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=n,a&&(this.programTimersStack=null),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},!(jl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=19;break}return e.next=14,Promise.all(i);case 14:u=e.sent,s.kernelMs=hl(u),s.getExtraProfileInfo=function(){return u.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=20;break;case 19:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 20:return this.uploadWaitMs=0,this.downloadWaitMs=0,e.abrupt("return",s);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return jl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Yd(),endMs:null}}},{key:"endTimer",value:function(e){return jl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=Yd(),e)}},{key:"getQueryTime",value:function(){var e=ns(es().mark((function e(t){var n;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(jl().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e))if(this.texData.get(e).complexParentRefCount>0)this.texData.get(e).refCount--;else{this.releaseGPUData(e);var t=this.texData.get(e).complexTensorInfos;null!=t&&(this.texData.get(t.real.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.real),this.texData.get(t.imag.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.imag)),this.texData.delete(e)}}}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"getCPUBackend",value:function(){return jl().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=gm().findBackend("cpu")),this.cpuBackend):null}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:128,r=this.getCPUBackend();return jl().getBool("IS_TEST")||this.warnedAboutCPUBackend||null!=r||(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),null!=r&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&ml(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){dx("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return qK(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new GK(e.shape,t);return this.compileAndRun(r,[e],n)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=vK(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(jl().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,PK,e.dtype);var n=new NK(e.shape,PK);return this.compileAndRun(n,[e])}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&Al(n[0])){var a=n.map((function(e){return Qd(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){var r=this.makeTensorInfo(e,t,n).dataId;return gm().makeTensorFromDataId(r,e,t,this)}},{key:"unpackTensor",value:function(e){var t=new jK(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new CK(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[ZH(e.shape)].concat(Tt(JH(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[ZH(t)].concat(Tt(JH(t))),i=new TK(a,n),o=this.runWebGLProgram(i,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}},{key:"decode",value:function(e){var t,n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype,o=$H(a);t=r?new dX(o):new fX(o);return{dtype:i,shape:a,dataId:this.runWebGLProgram(t,[{shape:o,dtype:i,dataId:e}],i,null,!0).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===SH.DENSE){var u=NH(e.outputShape);s.texShape=u.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===ml(o.shape))return s.values=Sl(o.dtype,0),o;var c=[],l=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&ml(t.shape)<=jl().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!==!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),c.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!tX(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),c.push(t),n=a.texData.get(t.dataId),r.shape=i}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);var h,f={shape:o.shape,texData:s,isUniform:!1},d=XX(e,l,f),p=this.getAndSaveBinary(d,(function(){return jX(a.gpgpu,e,l,f)})),v=null!=this.activeTimers;if(v&&(h=this.startTimer()),HX(this.gpgpu,p,l,f,r),c.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),v&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)})),!jl().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===i){var m=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),m}return o}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n=n||t[0].dtype;var i=this.runWebGLProgram(e,t,n,r,a);return gm().makeTensorFromDataId(i.dataId,i.shape,i.dtype)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;if(!this.disposed){if(!jl().getBool("IS_TEST"))Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}));this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=bm((function(){if(!jl().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=jl().getBool("DEBUG");jl().set("DEBUG",!1);var n=e.abs(_m(1e-8)).dataSync()[0];if(jl().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,i=t.texture,o=t.usage,s=t.isPacked;if(null==i){var u,c=null!=this.activeTimers;c&&(u=Yd());var l=t.texShape;if(null==l&&(l=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=jl().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,e=e.map((function(t,n){return n>=e.length-2?ll(e[n]):e[n]})),1===e.length&&(e=[2,e[0]])),2!==e.length){var r=_l(e);e=r.newShape}var a=ml(e);if(e.length<=1&&a<=n)return[1,a];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){var i=ZH(e),o=2,s=2;if(e.length){var u=f(JH(e),2);o=u[0],s=u[1]}return bl(a=i*(o/2)*(s/2)).map((function(e){return 2*e}))}return bl(a)}(n,s),t.texShape=l),null!=a){var h,d=$H(n),p=l[1],v=l[0],m=a instanceof Uint8Array;if(s){var g=f(RH(l[0],l[1]),2);p=g[0],v=g[1],h=new gX(d,[v,p],m)}else h=new mX(d,[v,p],m);var y=this.makeTensorInfo([v,p],r);this.texData.get(y.dataId).usage=m?CH.PIXELS:CH.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),p,v,a);var b=this.runWebGLProgram(h,[y],r,null,!0),x=this.texData.get(b.dataId);t.texture=x.texture,t.texShape=x.texShape,t.isPacked=x.isPacked,t.usage=x.usage,this.disposeIntermediateTensorInfo(y),this.texData.delete(b.dataId),t.values=null,c&&(this.uploadWaitMs+=Yd()-u)}else{var k=this.acquireTexture(l,o,r,s);t.texture=k}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*Il(t)}}]),n}(ol);wp()&&function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;bp.registerBackend(e,t,n)}("webgl",(function(){return new XK}),2);var KK=Jn((function e(t,n,r){$n(this,e),this.variableNames=["A","B"],this.outputShape=xg(n,r),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")})),YK=Jn((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];$n(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=xg(n,r);var i=this.outputShape.length,o="";if(a)if(0===i||1===ml(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{var s=VX(i);if(o="\n          ".concat(s," coords = getOutputCoords();\n        "),1===i)o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var u=SK("coords",i);o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")}));function QK(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var ZK={kernelName:Jh,backendName:"webgl",kernelFunc:QK};function JK(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=QK({inputs:{x:r},backend:n});n.texData.get(s.dataId).complexParentRefCount++;var u=QK({inputs:{x:a},backend:n});return n.texData.get(u.dataId).complexParentRefCount++,o.complexTensorInfos={real:s,imag:u},i}var $K={kernelName:yh,backendName:"webgl",kernelFunc:JK},eY="return (a < 0.) ? b * a : a;",tY="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var nY={kernelName:af,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",Xd(i,"float32")),s=jl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new YK(tY,a.shape,o.shape):new KK(eY,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],a.dtype);return n.disposeIntermediateTensorInfo(o),u}},rY="return (a < 0.) ? b * a : a;",aY="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var iY={kernelName:Bf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=jl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new YK(aY,r.shape,a.shape):new KK(rY,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}};function oY(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var h=c.texData.get(u.dataId),f=r(h.values,l);return c.makeTensorInfo(u.shape,l,f)}return i=jl().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new GK(u.shape,n):new NK(u.shape,t),c.runWebGLProgram(i,[u],l)}}function sY(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,s=e.cpuKernelImpl,u=e.dtype;return function(e){var r=e.inputs,i=e.backend,c=r.a,l=r.b,h=i;if(o&&"complex64"===c.dtype){var d=h.texData.get(c.dataId),p=h.texData.get(l.dataId),v=[[d.complexTensorInfos.real,p.complexTensorInfos.real],[d.complexTensorInfos.imag,p.complexTensorInfos.imag]].map((function(e){var n=f(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o={dataId:a.dataId,dtype:a.dtype,shape:l.shape},s=new KK(t,c.shape,l.shape);return h.runWebGLProgram(s,[i,o],cp(r.dtype,a.dtype))})),m=f(v,2),g=m[0],y=m[1],b=JK({inputs:{real:g,imag:y},backend:h});return h.disposeIntermediateTensorInfo(g),h.disposeIntermediateTensorInfo(y),b}var x,k=u||cp(c.dtype,l.dtype);if(h.shouldExecuteOnCPU([c,l])&&null!=s){var w=h.texData.get(c.dataId),_=h.texData.get(l.dataId),S=f(s(c.shape,l.shape,w.values,_.values,k),2),C=S[0],T=S[1],E=h.makeTensorInfo(T,k);return h.texData.get(E.dataId).values=C,E}return x=jl().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new YK(n,c.shape,l.shape,a):new KK(t,c.shape,l.shape),h.runWebGLProgram(x,[c,l],k)}}function uY(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?BK:DK;if("relu"===e)return t?VK:LK;if("elu"===e)return t?UK:OK;if("relu6"===e)return t?WK:FK;if("prelu"===e)return t?aY:rY;if("leakyrelu"===e)return t?tY:eY;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var cY=Jn((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];$n(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;var l=a?t[1]:t[2],h=Math.ceil(l/2),f=a?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",p=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",g="";s&&(m=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var b="rc.x",x="rc.x";t[0]<n[0]?b="int(min(float(rc.x), ".concat(t[0]-1,".))"):n[0]<t[0]&&(x="int(min(float(rc.x), ".concat(n[0]-1,".))")),this.userCode="\n      ".concat(m,"\n\n      const float sharedDimension = ").concat(h,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(h,"; i++) {\n          int batchA = ").concat(b,";\n          int batchB = ").concat(x,";\n          vec4 a = getMatrixA(batchA, ").concat(f,");\n          vec4 b = getMatrixB(batchB, ").concat(d,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(p[0]," * ").concat(v[0],");\n          result += (").concat(p[1]," * ").concat(v[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(y,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")})),lY="return areal * breal - aimag * bimag;",hY="return areal * bimag + aimag * breal;",fY=Jn((function e(t,n,r){$n(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=xg(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")})),dY="return a * b;";function pY(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=cp(a.dtype,i.dtype);if("complex64"===a.dtype){var s=r.texData.get(a.dataId),u=r.texData.get(i.dataId),c=new fY(lY,a.shape,i.shape),l=new fY(hY,a.shape,i.shape),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],d=r.runWebGLProgram(c,h,"float32"),p=r.runWebGLProgram(l,h,"float32"),v=JK({inputs:{real:d,imag:p},backend:r});return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(p),v}if(r.shouldExecuteOnCPU([a,i])){var m=r.texData.get(a.dataId),g=r.texData.get(i.dataId),y=f(lK(a.shape,i.shape,m.values,g.values,o),2),b=y[0],x=y[1],k=r.makeTensorInfo(x,o);return r.texData.get(k.dataId).values=b,k}return t=jl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new YK(dY,a.shape,i.shape):new KK(dY,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}var vY={kernelName:If,backendName:"webgl",kernelFunc:pY};function mY(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,s=ml(a.shape),u=function(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}(i,s),c=ml(u);fl(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."}));var l=o.texData.get(a.dataId);return!l.isPacked||tX(a.shape,u)||null!==l.texture&&tX(l.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[ZH(e.shape)].concat(Tt(JH(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[ZH(t)].concat(Tt(JH(t))),o=new TK(i,r),s=n.runWebGLProgram(o,[a],e.dtype,null,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}(a,u,o)}var gY={kernelName:qf,backendName:"webgl",kernelFunc:mY},yY=Jn((function e(t,n){$n(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var l=1/n;c="sumValue += dot(values * ".concat(yl(l)?l.toPrecision(2):l,", ones);")}var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),bY=Jn((function e(t,n){$n(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),h=r%4,f="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n      }\n    "),d="vec4";"all"===n?(s="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===n&&(s="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(f,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(f,"\n        } else if (").concat(2===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(f,"\n        } else if (").concat(3===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(f,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}));function xY(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=ox(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u=a[o],c=u.inSize,l=u.windowSize,h=u.outSize,f=void 0;f="mean"===n?0===o?new yY({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:h},c):new yY({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:h}):new bY({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:h},n),s=i,i=r.runWebGLProgram(f,[i],t),s.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(s)}return i}var kY=Jn((function e(t,n){$n(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=VX(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}));var wY=Jn((function e(t,n){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=VX(this.rank),o=_K("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),h="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(h,";\n      if(").concat(l,") {\n        result[1] = ").concat(h,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(h,";\n        if(").concat(l,") {\n          result[3] = ").concat(h,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}));function _Y(e,t,n){var r=jl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new wY(e.shape,t):new kY(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function SY(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,i=e.shape.length,o=wl(a,e.shape),s=o,u=Yg(s,i),c=null!=u,l=e;c&&(l=_Y(e,u,r),s=Zg(s.length,i)),Kg("sum",s,i);var h=f(Hg(l.shape,s),2),d=h[0],p=h[1],v=d;n&&(v=Xg(d,o));var m=ml(p),g=mY({inputs:{x:l},attrs:{shape:[ml(e.shape)/m,m]},backend:r}),y=xY(g,lp(e.dtype),"sum",r),b=mY({inputs:{x:y},attrs:{shape:v},backend:r});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(y),c&&r.disposeIntermediateTensorInfo(l),b}(t.x,r.axis,r.keepDims,n)}var CY={kernelName:cd,backendName:"webgl",kernelFunc:SY};function TY(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=i.shape[o[l]];if(s.shouldExecuteOnCPU([i])){var h=s.texData.get(i.dataId).values,f=kK(h,i.shape,i.dtype,o,c);t=s.makeTensorInfo(c,i.dtype),s.texData.get(t.dataId).values=f}else t=_Y(i,o,s);return t}var EY={kernelName:kd,backendName:"webgl",kernelFunc:TY};function IY(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,h=void 0===l?0:l,f=e.activation,d=void 0===f?null:f,p=t.shape.length,v=n.shape.length,m=r?t.shape[p-2]:t.shape[p-1],g=a?n.shape[v-1]:n.shape[v-2],y=r?t.shape[p-1]:t.shape[p-2],b=a?n.shape[v-2]:n.shape[v-1],x=t.shape.slice(0,-2),k=n.shape.slice(0,-2),w=ml(x),_=ml(k);fl(p>=2&&v>=2&&(w===_||1===w||1===_),(function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input "+"batch dimensions of (".concat(x,") and (").concat(k,").")}));var S=(w>_?t.shape.slice(0,-2):n.shape.slice(0,-2)).concat([y,b]);fl(m===g,(function(){return"Error in matMul: inner shapes (".concat(m,") and (")+"".concat(g,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match.")}));var C,T=r?[w,m,y]:[w,y,m],E=a?[_,b,g]:[_,g,b],I=mY({inputs:{x:t},backend:i,attrs:{shape:T}}),A=mY({inputs:{x:n},backend:i,attrs:{shape:E}}),M=[I,A],N=Math.max(w,_),R=r?I.shape[1]:I.shape[2],D=null!=s,P=null!=c,O="leakyrelu"===d,L=null!=d?uY(d,!0):null;if((1===y||1===b)&&R>1e3&&!1===(D||P||O||null!=L)){var F=I,z=A;r&&(F=TY({inputs:{x:I},backend:i,attrs:{perm:[0,2,1]}}),M.push(F)),a&&(z=TY({inputs:{x:A},backend:i,attrs:{perm:[0,2,1]}}),M.push(z));var B=1===b,U=F;1!==b&&(U=mY({inputs:{x:F},backend:i,attrs:{shape:[N,R,1]}}),M.push(U));var V=1===b?2:1,W=z;B&&(W=mY({inputs:{x:z},backend:i,attrs:{shape:[N,1,R]}}),M.push(W));var G=pY({inputs:{a:U,b:W},backend:i});C=SY({inputs:{x:G},backend:i,attrs:{axis:V,keepDims:!0}}),M.push(G)}else{var j=cp(t.dtype,n.dtype),q=new cY(T,E,[N,y,b],r,a,D,L,P,O),H=[I,A];if(null!=s&&H.push(s),P&&H.push(c),O){var X=i.makeTensorInfo([],"float32",Xd(h,"float32"));H.push(X),M.push(X)}C=i.runWebGLProgram(q,H,j)}var K=mY({inputs:{x:C},backend:i,attrs:{shape:S}});M.push(C);for(var Y=0,Q=M;Y<Q.length;Y++){var Z=Q[Y];i.disposeIntermediateTensorInfo(Z)}return K}var AY={kernelName:Id,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return IY({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},MY="return abs(x);";var NY={kernelName:Yl,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=vK(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=jl().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new GK(a.shape,MY):new NK(a.shape,MY),r.runWebGLProgram(t,[a],a.dtype)}},RY=oY({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"}),DY={kernelName:Ql,backendName:"webgl",kernelFunc:RY},PY=oY({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"}),OY={kernelName:Zl,backendName:"webgl",kernelFunc:PY},LY="return a + b;",FY=sY({opSnippet:LY,packedOpSnippet:LY,supportsComplex:!0,cpuKernelImpl:KX}),zY={kernelName:Jl,backendName:"webgl",kernelFunc:FY},BY=Jn((function e(t,n){$n(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),UY=Jn((function e(t,n){$n(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}));var VY={kernelName:$l,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return QK({inputs:{x:a[0]},backend:r});if(a.length>jl().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return cp(e,t)})),c=a.map((function(e){return e.shape})),l=jl().getBool("WEBGL_PACK")?new UY(a[0].shape,c):new BY(a[0].shape,c);return r.runWebGLProgram(l,a,u)}};var WY={kernelName:eh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=wl(i,a.shape),c=u,l=Yg(c,s),h=a;null!=l&&(h=TY({inputs:{x:a},backend:n,attrs:{perm:l}}),c=Zg(c.length,s)),Kg("all",c,s);var d,p=f(Hg(h.shape,c),2),v=p[0],m=mY({inputs:{x:h},backend:n,attrs:{shape:[-1,ml(p[1])]}}),g=xY(m,m.dtype,"all",n);return d=mY(o?{inputs:{x:g},backend:n,attrs:{shape:Xg(v,u)}}:{inputs:{x:g},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(h),d}};var GY={kernelName:th,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=wl(i,a.shape),c=u,l=Yg(c,s),h=a;null!=l&&(h=TY({inputs:{x:a},backend:n,attrs:{perm:l}}),c=Zg(c.length,s)),Kg("any",c,s);var d,p=f(Hg(h.shape,c),2),v=p[0],m=mY({inputs:{x:h},backend:n,attrs:{shape:[-1,ml(p[1])]}}),g=xY(m,m.dtype,"any",n);return d=mY(o?{inputs:{x:g},backend:n,attrs:{shape:Xg(v,u)}}:{inputs:{x:g},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(h),d}},jY=Jn((function e(t,n,r){$n(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")})),qY=Jn((function e(t,n,r,a){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,fl(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=t[t.length-1],o=Math.ceil(i/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,h=VX(l),f=SK("coords",l);if(1===o){var d=VX(u=l+1);s="\n        ".concat(d," sourceLocR = ").concat(d,"(").concat(f.join(),", 0);\n        ++").concat(f[l-1],";\n        ").concat(d," sourceLocG = ").concat(d,"(").concat(f.join(),", 0);\n        ++").concat(f[l-2],";\n        ").concat(d," sourceLocA = ").concat(d,"(").concat(f.join(),", 0);\n        --").concat(f[l-1],";\n        ").concat(d," sourceLocB = ").concat(d,"(").concat(f.join(),", 0);\n        --").concat(f[l-2],";")}else u=l,s="\n        ".concat(h," sourceLocR = coords;\n        ++").concat(f[l-1],";\n        ").concat(h," sourceLocG = coords;\n        ++").concat(f[l-2],";\n        ").concat(h," sourceLocA = coords;\n        --").concat(f[l-1],";\n        ").concat(h," sourceLocB = coords;\n        --").concat(f[l-2],";");var p=["x","y","z","w","u","v"].slice(0,u),v="."+p[u-1],m=p.map((function(e){return"int "+e})),g=SK("sourceLocR",u-1).concat("inIdx.r"),y=SK("sourceLocG",u-1).concat("inIdx.g"),b=SK("sourceLocB",u-1).concat("inIdx.b"),x=SK("sourceLocA",u-1).concat("inIdx.a"),k="max"===r?"greaterThan":"lessThan",w=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),")));"),_="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(x.join(),") : 0.)"),S=a?"":"\n      float getBestIndicesAChannel(".concat(m.join(),") {\n        return getChannel(getBestIndicesA(").concat(p.join(),"),\n                                          vec2(").concat(p.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(m.join(),") {\n        return getChannel(getA(").concat(p.join(),"),\n                               vec2(").concat(p.slice(-2).join(),"));\n      }\n      ").concat(S,"\n      void main() {\n        ").concat(h," coords = getOutputCoords();\n        bool hasNextCol = ").concat(f[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(f[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(v,", sourceLocG").concat(v,",\n          sourceLocB").concat(v,", sourceLocA").concat(v,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(_,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(w,"\n          vec4 candidate = ").concat(_,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(k,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}));function HY(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);var o=ox(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new jY(s,n,null==r),c=[t];null!=r&&c.push(r);var l=e.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;var h=HY(e,t,n,l);return e.disposeIntermediateTensorInfo(l),h}function XY(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,i=a[a.length-1],o=ox(i),s=new qY(a,o,n,null==r),u=null==r?[t]:[t,r],c=e.runWebGLProgram(s,u,"int32");if(c.shape.length===t.shape.length){var l=XY(e,t,n,c);return e.disposeIntermediateTensorInfo(c),l}return c}function KY(e,t,n,r){var a=[n];if(Kg("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!jl().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var i=[],o=f(Hg(t.shape,a),2),s=o[0],u=ml(o[1]),c=mY({inputs:{x:t},backend:e,attrs:{shape:[-1,u]}});i.push(c);var l=HY(e,c,r);i.push(l);var h=mY({inputs:{x:l},backend:e,attrs:{shape:s}});return i.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),h}return XY(e,t,r)}var YY={kernelName:nh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=wl(r.axis,a.shape),o=Yg(i,a.shape.length),s=a,u=[];null!=o&&(s=TY({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=Zg(i.length,s.shape.length)),Kg("argMax",[i[0]],s.shape.length);var c=KY(n,s,i[0],"max");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}};var QY={kernelName:rh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=wl(r.axis,a.shape),o=Yg(i,a.shape.length),s=a,u=[];null!=o&&(s=TY({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=Zg(i.length,s.shape.length)),Kg("argMin",[i[0]],s.shape.length);var c=KY(n,s,i[0],"min");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}},ZY=oY({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"}),JY={kernelName:ah,backendName:"webgl",kernelFunc:ZY},$Y=oY({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"}),eQ={kernelName:ih,backendName:"webgl",kernelFunc:$Y},tQ=oY({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"}),nQ={kernelName:oh,backendName:"webgl",kernelFunc:tQ},rQ=sY({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),aQ={kernelName:uh,backendName:"webgl",kernelFunc:rQ},iQ=oY({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"}),oQ={kernelName:sh,backendName:"webgl",kernelFunc:iQ},sQ=Jn((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if($n(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;var v="avg"===n,m="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),g="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),y="0.0";if(v||(y="-1.0 / 1e-20"),r){var b=">=";this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(b," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?m:g:"wR * ".concat(f," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var x="max",k="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(k="avgValue / count");var w=4*Math.floor(o/4),_=o%4,S="\n      if (".concat(v,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(x,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n      const float initializationValue = ").concat(y,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(y,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(S,"\n          }\n\n          int xC = xCCorner + ").concat(w,";\n          if (").concat(1===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(S,"\n          } else if (").concat(2===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(S,"\n          } else if (").concat(3===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(S,"\n          }\n        }\n        setOutput(").concat(k,");\n      }\n    ")}})),uQ=Jn((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if($n(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,h=t.dilationHeight,f=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,v=t.effectiveFilterWidth,m=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;var b="avg"===n,x="0.0";if(b||(x="-1.0 / 1e-20"),r){var k=">=";this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(p,";\n                wR += ").concat(h,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(v,";\n                  wC += ").concat(f,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(k," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(p," * ").concat(v," +\n                      wR * ").concat(v," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var w="max",_="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(_="avgValue / count");var S=4*Math.floor(o/4),C=o%4,T="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(w,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(x,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(x,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(h,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(S,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(f,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(f,", ch)\n              );\n\n              ").concat(T,"\n            }\n\n            int xC = xCCorner + ").concat(S,";\n            if (").concat(1===C,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(T,"\n            } else if (").concat(2===C,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(T,"\n            } else if (").concat(3===C,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(f,", ch),\n                initializationValue\n              );\n\n              ").concat(T,"\n            }\n          }\n          setOutput(").concat(_,");\n        }\n      }\n    ")}}));var cQ={kernelName:ch,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;oX(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;fl(Wm(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Mm(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&gl(c.inShape,c.outShape))return QK({inputs:{x:a},backend:n});var l=new sQ(c,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}};var lQ={kernelName:hh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=Nm(a.shape,i,o,[1,1,1],s,u,c),h=new uQ(l,"avg",!1);return n.runWebGLProgram(h,[a],"float32")}},hQ=Jn((function e(t){$n(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.top,h=c-1-t.padInfo.left,f=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(h,");\n      const float avgMultiplier = float(").concat(f,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),fQ=Jn((function e(t){$n(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterDepth,f=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=h-1-t.padInfo.front,v=f-1-t.padInfo.top,m=d-1-t.padInfo.left,g=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(p,", ").concat(v,", ").concat(m,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(h,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(f,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var dQ={kernelName:fh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Nm(i.shape,o,s,[1,1,1],u,c),h=new fQ(l);return n.runWebGLProgram(h,[a],i.dtype)}};var pQ={kernelName:lh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;oX([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=Mm(o.shape,s,u,1,c),h=new hQ(l);return n.runWebGLProgram(h,[a],o.dtype)}};var vQ={kernelName:dh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return IY({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},mQ=Jn((function e(t,n,r,a,i,o){$n(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],xg(t,n),xg(t,r);var s="0.0";null!=a&&(xg(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(xg(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")})),gQ=Jn((function e(t,n,r,a,i,o){$n(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],xg(t,n),xg(t,r);var s="vec4(0.0)";null!=a&&(xg(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(xg(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")})),yQ={kernelName:Kh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;fl(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),fl(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),fl(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var c=r.varianceEpsilon;null==c&&(c=.001);var l=[a,i,o],h=null;null!=s&&(h=s.shape,l.push(s));var f=null;null!=u&&(f=u.shape,l.push(u));var d=jl().getBool("WEBGL_PACK_NORMALIZATION")?new gQ(a.shape,i.shape,o.shape,h,f,c):new mQ(a.shape,i.shape,o.shape,h,f,c);return n.runWebGLProgram(d,l,l[0].dtype)}},bQ=function(){function e(t){$n(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n,r=VX(this.rank),a="uniform int start[".concat(this.rank,"];"),i=function(e){if(1===e)return"sourceLoc";if(e<=6)return xQ.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),o=t.map((function(e,t){return"sourceLoc.".concat(xQ[t]," = start[").concat(t,"] + coords.").concat(xQ[t],";")}));n="\n        ".concat(r," sourceLoc;\n        ").concat(r," coords = getOutputCoords();\n        ").concat(o.join("\n"),"\n      "),this.userCode="\n      ".concat(a,"\n      void main() {\n        ").concat(n,"\n        setOutput(getSource(").concat(i,"));\n      }\n    ")}return Jn(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the ")+"length of start (".concat(e.length,")"));return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}}}]),e}(),xQ=["x","y","z","w","u","v"];var kQ=function(){function e(t){$n(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var n=VX(this.rank),r=SK("coords",this.rank),a=SK("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      uniform int start[".concat(this.rank,"];\n      void main() {\n        ").concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}return Jn(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the ")+"length of start (".concat(e.length,")"));return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}}}]),e}();function wQ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=f(hm(a,r.begin,r.size),2),o=i[0],s=i[1];if(function(e,t,n){var r=e.shape.length;fl(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,").")})),fl(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,").")}));for(var a=function(a){fl(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] ")+"(".concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}(a,o,s),0===ml(s))return n.makeTensorInfo(s,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var u=n.texData.get(a.dataId),c=mK(u.values,o,s,a.shape,a.dtype);return n.makeTensorInfo(s,a.dtype,c)}var l=n.texData.get(a.dataId).isPacked,h=function(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}(a.shape,o,s);if(l||!h){var d=jl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new kQ(s):new bQ(s),p=d.getCustomSetupFunc(o);return n.runWebGLProgram(d,[a],a.dtype,p)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.complexParentRefCount=0,o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=function(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}(t,Pl(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(a,o,s,n)}var _Q={kernelName:nd,backendName:"webgl",kernelFunc:wQ},SQ={kernelName:ph,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;fl(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=sx(a.shape,i,s),c=ux(u.length,i.length),l=cx(a.shape,i,s),h=function(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}(o,i.length),f=function(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}(l,o,i.length),d=[],p=mY({inputs:{x:a},backend:n,attrs:{shape:u}}),v=TY({inputs:{x:p},backend:n,attrs:{perm:c}}),m=mY({inputs:{x:v},backend:n,attrs:{shape:l}}),g=wQ({inputs:{x:m},backend:n,attrs:{begin:h,size:f}});return d.push(p),d.push(v),d.push(m),d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var CQ={kernelName:"Bincount",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=YX(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}},TQ=sY({opSnippet:"return float(a != b);",dtype:"bool"}),EQ={kernelName:Mf,backendName:"webgl",kernelFunc:TQ};function IQ(e){var t=e.inputs,n=e.backend,r=t.input;return QK({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var AQ={kernelName:Wf,backendName:"webgl",kernelFunc:IQ};var MQ={kernelName:vh,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=t.attrs,i=n.x,o=a.dtype;if("complex64"===o){if("complex64"===i.dtype)return QK({inputs:{x:i},backend:r});var s=iy(i.shape),u=e({inputs:{x:i},backend:r,attrs:{dtype:"float32"}}),c=JK({inputs:{real:u,imag:s},backend:r});return s.dispose(),r.disposeIntermediateTensorInfo(u),c}if("complex64"===i.dtype){var l=IQ({inputs:{input:i},backend:r}),h=e({inputs:{x:l},backend:r,attrs:{dtype:o}});return r.disposeIntermediateTensorInfo(l),h}if(!Tl(i.dtype,o)){var f=QK({inputs:{x:i},backend:r});return{dataId:f.dataId,shape:f.shape,dtype:o}}if("int32"===o)return function(e,t){var n=new NK(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(i,r);if("bool"===o){var d=r.makeTensorInfo([],"bool",Sl("bool",1)),p=TQ({inputs:{a:i,b:d},backend:r});return r.disposeIntermediateTensorInfo(d),p}throw new Error("Error in Cast: failed to cast ".concat(i.dtype," to ").concat(o))}},NQ="return ceil(x);",RQ=oY({opSnippet:NQ,packedOpSnippet:NQ,cpuKernelImpl:ZX}),DQ={kernelName:mh,backendName:"webgl",kernelFunc:RQ},PQ=function(){function e(t){$n(this,e),this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return Jn(e,[{key:"getCustomSetupFunc",value:function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}}}]),e}(),OQ=function(){function e(t){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return Jn(e,[{key:"getCustomSetupFunc",value:function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}}}]),e}();var LQ={kernelName:gh,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax,u=(t=jl().getBool("WEBGL_PACK_CLIP")?new OQ(i.shape):new PQ(i.shape)).getCustomSetupFunc(o,s);return r.runWebGLProgram(t,[i],i.dtype,u)}},FQ=Jn((function e(t){$n(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}));function zQ(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var BQ={kernelName:bh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new FQ(r.shape),o=[zQ(r,a.complexTensorInfos.real),zQ(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},UQ=Jn((function e(t){$n(this,e),this.outputShape=[],this.outputShape=ix(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++){var o=n[i-1];a.push("else if (yC < ".concat(n[i],") ")+"setOutput(getT".concat(i,"(yR, yC-").concat(o,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")})),VQ=Jn((function e(t,n){$n(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=ix(t,n);var r=this.outputShape,a=r.length,i=VX(a),o=SK("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],h=s.slice(-2),f=s.join(),d="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(f,"), vec2(").concat(h.join(),"));\n        }"),p=1;p<u.length;p++){var v=u[p-1];d+="\n        if (".concat(l," < ").concat(u[p],"  && ").concat(l," >= ").concat(u[p-1],") {\n          return getChannel(\n            getT").concat(p,"(").concat(WQ(s,l,v),"),\n            vec2(").concat(WQ(h,l,v),"));\n        }")}var m=u.length,g=u[u.length-1];d+="\n        return getChannel(\n          getT".concat(m,"(").concat(WQ(s,l,g),"),\n          vec2(").concat(WQ(h,l,g),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(d,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")}));function WQ(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function GQ(e){var t=e.inputs,n=e.backend,r=t.input;return QK({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var jQ={kernelName:ef,backendName:"webgl",kernelFunc:GQ};function qQ(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return IQ({inputs:{input:e},backend:n})})),i=e.map((function(e){return GQ({inputs:{input:e},backend:n})})),o=qQ(a,t,n),s=qQ(i,t,n),u=JK({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}if("string"===r){var c=HQ(e,t,n),l=c.tensors2D,h=c.outShape,f=l.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),d=1===l[0].shape[0],p=JX(f,h,r,d),v=ix(e.map((function(e){return e.shape})),t),m=n.makeTensorInfo(v,r,p);return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}if(e.length>jl().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var g=Math.floor(e.length/2),y=qQ(e.slice(0,g),t,n),b=qQ(e.slice(g),t,n),x=qQ([y,b],t,n);return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),x}if(jl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){var k=new VQ(e.map((function(e){return e.shape})),t);return n.runWebGLProgram(k,e,r)}var w=HQ(e,t,n),_=w.tensors2D,S=w.outShape,C=new UQ(_.map((function(e){return e.shape}))),T=n.runWebGLProgram(C,_,r);_.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var E=mY({inputs:{x:T},attrs:{shape:S},backend:n});return n.disposeIntermediateTensorInfo(T),E}function HQ(e,t,n){var r=ix(e.map((function(e){return e.shape})),t),a=e.map((function(e){return mY({inputs:{x:e},attrs:{shape:[-1,ml(e.shape.slice(t))]},backend:n})}));return{tensors2D:a,outShape:r}}function XQ(e){var t=e.inputs,n=e.backend,r=wl(e.attrs.axis,t[0].shape)[0],a=ix(t.map((function(e){return e.shape})),r);if(0===ml(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter((function(e){return ml(e.shape)>0}));return 1===i.length?QK({inputs:{x:i[0]},backend:n}):(function(e,t){var n=e[0].length;e.forEach((function(e,t){fl(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")")}))})),fl(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)fl(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(a,".")}))}))}(i.map((function(e){return e.shape})),r),qQ(i,r,n))}var KQ={kernelName:xh,backendName:"webgl",kernelFunc:XQ},YQ=Jn((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];$n(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,f=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),v=t.inChannels%4,m="channelsLast"===t.dataFormat,g=m?1:2,y=m?2:3,b=m?3:1,x="",k="";r&&(x=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),k="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(y,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(f,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(d,"; wC++) {\n            int xC = xCCorner + wC * ").concat(h,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(p,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(m,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===v,") {\n\n              if (").concat(m,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(p,") *\n                    getW(wR, wC, ").concat(p,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(p,", xR, xC) *\n                    getW(wR, wC, ").concat(p,", d2);\n              }\n\n            } else if (").concat(2===v,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(p,", d2),\n                getW(wR, wC, ").concat(p," + 1, d2)\n              );\n\n              if (").concat(m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(p,"),\n                  getX(batch, xR, xC, ").concat(p," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(p,", xR, xC),\n                  getX(batch, ").concat(p," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===v,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(p,", d2),\n                getW(wR, wC, ").concat(p," + 1, d2),\n                getW(wR, wC, ").concat(p," + 2, d2)\n              );\n\n              if (").concat(m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(p,"),\n                  getX(batch, xR, xC, ").concat(p," + 1),\n                  getX(batch, xR, xC, ").concat(p," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(p,", xR, xC),\n                  getX(batch, ").concat(p," + 1, xR, xC),\n                  getX(batch, ").concat(p," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(w,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")})),QQ=Jn((function e(t){$n(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,h=t.filterDepth,f=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),v=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(h,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(p,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===v,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(p,") *\n                  getW(wF, wR, wC, ").concat(p,", d2);\n              } else if (").concat(2===v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1),\n                  getX(batch, xF, xR, xC, ").concat(p," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2),\n                  getW(wF, wR, wC, ").concat(p," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),ZQ=Jn((function e(t,n,r){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var a=r.filterWidth,i=r.inChannels,o=r.strideWidth,s=r.strideHeight,u=r.padInfo,c=r.outWidth,l=r.dilationWidth,h=r.dilationHeight,f=r.dataFormat,d=u.left,p=u.top,v=i*a,m=uX(),g="channelsLast"===f,y=g?0:1,b=g?1:2,x="",k=0;k<=1;k++)for(var w=0;w<=1;w++)x+="\n          blockIndex = rc.y + ".concat(w,";\n          pos = rc.x + ").concat(k,";\n\n          if(blockIndex < ").concat(t[1]," && pos < ").concat(t[0],") {\n            offsetY = int(blockIndex / (").concat(c,")) * ").concat(s," - ").concat(p,";\n            d0 = offsetY + ").concat(h," * (pos / ").concat(v,");\n\n            if(d0 < ").concat(n[y]," && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ").concat(c,".) * ").concat(o,". - ").concat(d,".);\n              d1 = offsetX + ").concat(l," * (int(mod(float(pos), ").concat(v,".) / ").concat(i,".));\n\n              if(d1 < ").concat(n[b]," && d1 >= 0) {\n\n                ch = int(mod(float(pos), ").concat(i,".));\n\n                if (").concat(g,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*k+w,"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*k+w,"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(x,"\n\n        ").concat(m.output," = result;\n      }\n    ")}));function JQ(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,h=void 0===l?0:l,f=e.activation,d=void 0===f?null:f,p=n.shape,v=i.texData.get(n.dataId),m=a.inChannels,g=p[0]*p[1]*p[2],y=a.outChannels,b="channelsLast"===a.dataFormat,x=[],k=(1===g||1===y)&&m>1e3,w=p[2]%2!==0&&!!v.isPacked;if(!k&&jl().getBool("WEBGL_LAZILY_UNPACK")&&jl().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&w){var _=b?p[0]*p[1]*(p[2]+1):p[0]*p[2]*(p[3]+1),S={dataId:n.dataId,shape:[1,_,a.inChannels],dtype:n.dtype},C=v.shape;v.shape=v.shape.slice(),v.shape[v.shape.length-2]++,fl(tX(v.shape,S.shape),(function(){return"packed reshape ".concat(v.shape," to ").concat(S.shape," isn't free")}));var T=mY({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});x.push(T);var E=IY({a:S,b:T,backend:i,transposeA:false,transposeB:false,bias:s,activation:d,preluActivationWeights:c,leakyreluAlpha:h}),I=i.texData.get(E.dataId);fl(I.isPacked,(function(){return"batchMatMul result is expected to be packed"})),v.shape=C,I.shape=a.outShape,(t=QK({inputs:{x:E},backend:i})).shape=a.outShape,x.push(E)}else{var A=mY({inputs:{x:n},backend:i,attrs:{shape:[1,b?p[0]*p[1]*p[2]:p[0]*p[2]*p[3],a.inChannels]}}),M=mY({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),N=IY({a:A,b:M,transposeA:false,transposeB:false,backend:i,bias:s,activation:d,preluActivationWeights:c,leakyreluAlpha:h});t=mY({inputs:{x:N},backend:i,attrs:{shape:a.outShape}}),x.push(A),x.push(M),x.push(N)}for(var R=0,D=x;R<D.length;R++){var P=D[R];i.disposeIntermediateTensorInfo(P)}return t}function $Q(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,h=e.activation,f=void 0===h?null:h,d=r.filterWidth,p=r.filterHeight,v=r.inChannels,m=r.outWidth,g=r.outHeight,y="channelsLast"===r.dataFormat,b=d*p*v,x=g*m,k=[b,x],w=[],_=mY({inputs:{x:t},backend:a,attrs:{shape:t.shape.slice(1)}}),S=mY({inputs:{x:n},backend:a,attrs:{shape:[1,b,ml(n.shape)/b]}});w.push(_),w.push(S);var C=new ZQ(k,_.shape,r),T=a.runWebGLProgram(C,[_],"float32"),E=mY({inputs:{x:T},backend:a,attrs:{shape:[1,k[0],k[1]]}});w.push(T),w.push(E);var I=null!=o,A=null!=u,M="leakyrelu"===f,N=f?uY(f,!0):null,R=new cY(E.shape,S.shape,[1,x,r.outChannels],!0,!1,I,N,A,M),D=[E,S];if(o&&D.push(o),A&&D.push(u),M){var P=a.makeTensorInfo([],"float32",Xd(l,"float32"));D.push(P),w.push(P)}var O=a.runWebGLProgram(R,D,"float32"),L=mY({inputs:{x:O},backend:a,attrs:{shape:y?[1,g,m,r.outChannels]:[1,r.outChannels,g,m]}});w.push(O);for(var F=0,z=w;F<z.length;F++){var B=z[F];a.disposeIntermediateTensorInfo(B)}return L}var eZ={kernelName:kh,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,h=a.dimRoundingMode,f=Gm(c),d=Rm(i.shape,o.shape,s,l,u,h,!1,f);if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(jl().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])t=$Q({x:i,filter:o,convInfo:d,backend:r});else{var p=new YQ(d);t=r.runWebGLProgram(p,[i,o],"float32")}else t=JQ({x:i,filter:o,convInfo:d,backend:r});var v=mY({inputs:{x:t},backend:r,attrs:{shape:d.outShape}});return r.disposeIntermediateTensorInfo(t),v}},tZ=Jn((function e(t){$n(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat(o,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),nZ=Jn((function e(t){$n(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=o?1:2,l=o?2:3,h=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(h,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),rZ=Jn((function e(t){$n(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),aZ=Jn((function e(t){$n(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,l=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var iZ={kernelName:wh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,h=Gm(u),f=Rm(a.shape,l,o,1,s,c,!1,h),d=new tZ(f);return n.runWebGLProgram(d,[a,i],"float32")}};var oZ={kernelName:_h,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,h=Gm(c),f=Rm(o,i.shape,s,1,u,l,!1,h),d=new nZ(f);return n.runWebGLProgram(d,[a,i],"float32")}};var sZ={kernelName:Sh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=Dm(a.shape,i.shape,o,u,s),l=new QQ(c);return n.runWebGLProgram(l,[a,i],"float32")}};var uZ={kernelName:Ch,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=Dm(a.shape,u,o,1,s),l=new rZ(c);return n.runWebGLProgram(l,[a,i],"float32")}};var cZ={kernelName:Th,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=Dm(r.inputShape,i.shape,s,1,o),c=new aZ(u);return n.runWebGLProgram(c,[a,i],"float32")}},lZ=oY({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"}),hZ={kernelName:Eh,backendName:"webgl",kernelFunc:lZ},fZ=oY({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"}),dZ={kernelName:Ih,backendName:"webgl",kernelFunc:fZ},pZ=Jn((function e(t,n,r,a,i){$n(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=f(t,4),s=o[0],u=o[1],c=o[2],l=o[3],h=f(n,1)[0],d=f(r,2),p=d[0],v=d[1];this.outputShape=[h,p,v,l];var m="bilinear"===a?1:0,g="".concat(u-1,".0"),y="".concat(c-1,".0"),b=f(p>1?["".concat((u-1)/(p-1)),"(y2-y1) * height_ratio","y1*".concat(g," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(g)],3),x=b[0],k=b[1],w=b[2],_=f(v>1?["".concat((c-1)/(v-1)),"(x2-x1) * width_ratio","x1*".concat(y," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(y)],3),S=_[0],C=_[1],T=_[2];this.userCode="\n      const float height_ratio = float(".concat(x,");\n      const float width_ratio = float(").concat(S,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(k,";\n        float width_scale = ").concat(C,";\n\n        float in_y = ").concat(w,";\n        if( in_y < 0.0 || in_y > ").concat(g," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(T,";\n        if( in_x < 0.0 || in_x > ").concat(y," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(m," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")})),vZ={kernelName:Mh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new pZ(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}},mZ=function(){function e(t,n,r){$n(this,e),this.variableNames=["x"],this.outputShape=t;var a=t.length,i=n?"0.0":"getX(".concat(gZ(a,"coords"),")"),o=t[t.length-1],s="",u="";n?(s=r?"end != ".concat(o-1):"end != 0",u=r?"end + 1":"end - 1"):(s=r?"end + pow2 < ".concat(o):"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode="\n      uniform float index;\n      void main() {\n        ".concat(VX(a)," coords = getOutputCoords();\n        int end = ").concat(yZ(a,"coords"),";\n        float val = ").concat(i,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(s,") {\n          int idx = ").concat(u,";\n          ").concat(yZ(a,"coords")," = idx;\n          val += getX(").concat(gZ(a,"coords"),");\n        }\n        setOutput(val);\n      }\n    ")}return Jn(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.index&&(t.index=n.getUniformLocation(r,"index")),n.gl.uniform1f(t.index,e)}}}]),e}();function gZ(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}function yZ(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}var bZ={kernelName:Ah,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length,c=Yg([i],u),l=a;null!=c&&(l=TY({inputs:{x:a},backend:n,attrs:{perm:c}}));var h=Zg(1,u)[0];if(h!==u-1)throw new Error("WebGL cumsum shader expects an inner-most axis=".concat(a.shape.length-1," ")+"but got axis=".concat(i));for(var f=l.shape[h],d=QK({inputs:{x:l},backend:n}),p=0;p<=Math.ceil(Math.log2(f))-1;p++){var v=new mZ(l.shape,!1,s),m=v.getCustomSetupFunc(p),g=d;d=n.runWebGLProgram(v,[d],d.dtype,m),n.disposeIntermediateTensorInfo(g)}if(o){var y=new mZ(l.shape,o,s),b=d;d=n.runWebGLProgram(y,[d],d.dtype),n.disposeIntermediateTensorInfo(b)}if(null!=c){var x=TY({inputs:{x:d},backend:n,attrs:{perm:Qg(c)}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(l),x}return d}};var xZ={kernelName:"DenseBincount",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=YX(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var h=n.bufferSync(a),f=n.bufferSync(i),d=QX(h,f,o,s);return n.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}},kZ=function(){function e(t,n,r){$n(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return Jn(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var wZ={kernelName:Nh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;fl(i>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(i)}));var s=a.shape[0],u="NHWC"===o?a.shape[1]:a.shape[2],c="NHWC"===o?a.shape[2]:a.shape[3],l="NHWC"===o?a.shape[3]:a.shape[1],h=u*i,f=c*i,d=l/(i*i),p=new kZ("NHWC"===o?[s,h,f,d]:[s,d,h,f],i,o);return n.runWebGLProgram(p,[a],a.dtype)}},_Z=Jn((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];$n(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.inHeight,s=t.inWidth,u=t.padInfo.top,c=t.padInfo.left,l=t.strideHeight,h=t.strideWidth,f=t.dilationHeight,d=t.dilationWidth,p=t.filterHeight,v=t.filterWidth,m=t.outChannels/t.inChannels,g="",y="";r&&(g=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),y="result = activation(result);");var b=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(g,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(h,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(c,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(m,";\n        int q = d2 - d1 * ").concat(m,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(p,"; wR++) {\n          int xR = xRCorner + wR * ").concat(f,";\n\n          if (xR < 0 || xR >= ").concat(o,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(v,"; wC++) {\n            int xC = xCCorner + wC * ").concat(d,";\n\n            if (xC < 0 || xC >= ").concat(s,") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(b,"\n        ").concat(y,"\n        setOutput(result);\n      }\n    ")})),SZ=Jn((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];$n(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var o=t.inHeight,s=t.inWidth,u=t.padInfo.top,c=t.padInfo.left,l=t.strideHeight,h=t.strideWidth,f=t.dilationHeight,d=t.dilationWidth,p=t.filterHeight,v=t.filterWidth,m=v,g="int xR; int xC; int xCOffset;",y=0;y<p;y++)for(var b=0;b<v;b++)g+="\n          vec4 xTexelR".concat(y,"C").concat(2*b," = vec4(0.);\n          vec4 wR").concat(y,"C").concat(b," = vec4(0.);\n          vec4 xR").concat(y,"C").concat(b," = vec4(0.);");for(var x=0;x<p;x++)for(var k=0;k<m;k++){var w=2*k;if(g+="\n          xR = xRCorner + ".concat(x*f,";\n          xC = xCCorner + ").concat(w*d,";\n        "),1===h){if(w<v&&(g+=c%2===1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < ".concat(o," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(x,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    xTexelR").concat(x,"C").concat(w,".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR").concat(x,"C").concat(w," = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < ").concat(o," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR").concat(x,"C").concat(w," = vec4(previous.zw, xTexelR").concat(x,"C").concat(w,".xy);\n                } else {\n                  xR").concat(x,"C").concat(w," = vec4(0, 0, xTexelR").concat(x,"C").concat(w,".xy);\n                }\n              "):"\n                if(xR >= 0 && xR < ".concat(o," && xC >= 0 && xC < ").concat(s,") {\n                  xTexelR").concat(x,"C").concat(w," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(w," = vec4(0.);\n                }\n\n                xR").concat(x,"C").concat(w," = xTexelR").concat(x,"C").concat(w,";\n              "),w+1<v)){var _=c%2===0?ll(d):d;d%2===0&&c%2===1||d%2!==0&&c%2!==1?(g+="\n                  xCOffset = xC + ".concat(c%2," + ").concat(_,";\n\n                  if(xR >= 0 && xR < ").concat(o," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(x,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                  }\n                "),d>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < ".concat(o," &&\n                      xCOffset >= 0 && xCOffset < ").concat(s,") {\n                      xTexelR").concat(x,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR").concat(x,"C").concat(w," = vec4(0.);\n                    }\n                  ")),g+="\n                  xR".concat(x,"C").concat(w+1," = vec4(\n                    xTexelR").concat(x,"C").concat(w,".zw, xTexelR").concat(x,"C").concat(w+2,".xy);\n                ")):g+="\n                  xCOffset = xC + ".concat(_,";\n\n                  if(xR >= 0 && xR < ").concat(o," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(x,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR").concat(x,"C").concat(w+1," = xTexelR").concat(x,"C").concat(w+2,";\n                ")}}else w<v&&(g+="\n              if(xR >= 0 && xR < ".concat(o,") {\n            "),c%2===1?(g+="\n                xCOffset = xC + 1 - ".concat(h,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(x,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(w," = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ").concat(s,") {\n                  xTexelR").concat(x,"C").concat(w+2," = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(w+2," = vec4(0.);\n                }\n\n                xR").concat(x,"C").concat(w," = vec4(\n                  xTexelR").concat(x,"C").concat(w,".zw, xTexelR").concat(x,"C").concat(w+2,".zw);\n              "),w+1<v&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + ".concat(h,";\n                  if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR").concat(x,"C").concat(w+1," = vec4(xTexelR").concat(x,"C").concat(w+2,".xy, final.xy);\n                "))):(g+="\n                if(xC >= 0 && xC < ".concat(s,") {\n                  xTexelR").concat(x,"C").concat(w," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(w," = vec4(0.);\n                }\n\n                xCOffset = xC + ").concat(h,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(x,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(w+2," = vec4(0.);\n                }\n\n                xR").concat(x,"C").concat(w," = vec4(\n                  xTexelR").concat(x,"C").concat(w,".xy, xTexelR").concat(x,"C").concat(w+2,".xy);\n              "),w+1<v&&(g+="\n                  xR".concat(x,"C").concat(w+1," = vec4(\n                    xTexelR").concat(x,"C").concat(w,".zw, xTexelR").concat(x,"C").concat(w+2,".zw);\n                "))),g+="}");w<v&&(g+="\n            vec4 wTexelR".concat(x,"C").concat(w," = getW(").concat(x,", ").concat(w,", d1, q);\n            wR").concat(x,"C").concat(w," = vec4(wTexelR").concat(x,"C").concat(w,".xz, wTexelR").concat(x,"C").concat(w,".xz);\n          "),w+1<v&&(g+="\n              vec4 wTexelR".concat(x,"C").concat(w+1," = getW(").concat(x,", ").concat(w+1,", d1, q);\n              wR").concat(x,"C").concat(w+1," =\n                vec4(wTexelR").concat(x,"C").concat(w+1,".xz, wTexelR").concat(x,"C").concat(w+1,".xz);")))}for(var S=0;S<p;S++)for(var C=0;C<v;C++)g+="dotProd += xR".concat(S,"C").concat(C," * wR").concat(S,"C").concat(C,";");var T="",E="";r&&(T=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),E="result = activation(result);");var I=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(T,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(h,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(c,");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        ").concat(g,"\n\n        vec4 result = dotProd;\n        ").concat(I,"\n        ").concat(E,"\n        setOutput(result);\n      }\n    ")}));var CZ={kernelName:Rh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;null==l&&(l=[1,1]),fl(Wm(o,l),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var h,f=Rm(a.shape,i.shape,o,l,s,c,!0);return h=jl().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?new SZ(f):new _Z(f),n.runWebGLProgram(h,[a,i],"float32")}},TZ=Jn((function e(t){$n(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),EZ=Jn((function e(t){$n(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var IZ={kernelName:Dh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,h=Rm(a.shape,l,o,s,u,c,!0),f=new TZ(h);return n.runWebGLProgram(f,[a,i],"float32")}};var AZ={kernelName:Ph,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=Rm(r.inputShape,i.shape,o,s,u,c,!0),h=new EZ(l);return n.runWebGLProgram(h,[a,i],"float32")}},MZ=Jn((function e(t){$n(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}));var NZ={kernelName:"Diag",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat(Tt(r.shape),Tt(r.shape)),i=ml(r.shape),o=mY({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new MZ(i),u=n.runWebGLProgram(s,[o],o.dtype),c=mY({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),c}},RZ=Jn((function e(t){$n(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,h=a.top,f=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(h,", ").concat(f,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}));var DZ={kernelName:Oh,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0,o=e[3],s=[].concat(Tt(t),[o]),u=Gm(a);return Rm(e,s,n,i,r,null,null,u)}(i.shape,o.shape,s,u,"NHWC",c),h=new RZ(l),f=mY({inputs:{x:t=r.runWebGLProgram(h,[i,o],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),f}},PZ=oY({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"}),OZ={kernelName:Fh,backendName:"webgl",kernelFunc:PZ},LZ={kernelName:zh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=jl().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new YK("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new KK("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},FZ=sY({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool"}),zZ={kernelName:Uh,backendName:"webgl",kernelFunc:FZ},BZ=oY({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(.3275911,";\n  float a1 = ").concat(.254829592,";\n  float a2 = ").concat(-.284496736,";\n  float a3 = ").concat(1.421413741,";\n  float a4 = ").concat(-1.453152027,";\n  float a5 = ").concat(1.061405429,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")}),UZ={kernelName:Bh,backendName:"webgl",kernelFunc:BZ},VZ="return exp(x);",WZ=oY({opSnippet:VZ,packedOpSnippet:VZ,cpuKernelImpl:$X}),GZ={kernelName:Vh,backendName:"webgl",kernelFunc:WZ};function jZ(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(fl(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),mY({inputs:{x:i},backend:r,attrs:{shape:s}})}var qZ={kernelName:Wh,backendName:"webgl",kernelFunc:jZ},HZ="return exp(x) - 1.0;",XZ=oY({opSnippet:HZ,packedOpSnippet:HZ,cpuKernelImpl:eK}),KZ={kernelName:Gh,backendName:"webgl",kernelFunc:XZ},YZ=Jn((function e(t,n,r){$n(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}));function QZ(e,t,n){var r=n.texData.get(e.dataId),a=ml(e.shape),i=e.shape[e.shape.length-1],o=mY({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new YZ("real",s,t),c=new YZ("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],h=n.runWebGLProgram(u,l,"float32"),f=n.runWebGLProgram(c,l,"float32"),d=JK({inputs:{real:h,imag:f},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f);var p=mY({inputs:{x:d},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(d),p}var ZZ={kernelName:"FFT",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return QZ(t.input,!1,n)}},JZ=function(){function e(t,n){$n(this,e),this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return Jn(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}}}]),e}();function $Z(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||Nl(a))){var o=Cl(i,ml(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new JZ(r,a),u=s.getCustomSetupFunc(a);return t.runWebGLProgram(s,[],i,u)}var eJ,tJ={kernelName:jh,backendName:"webgl",kernelFunc:$Z},nJ=Jn((function e(t){$n(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),rJ={kernelName:qh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new nJ(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},aJ="return floor(x);",iJ=oY({opSnippet:aJ,packedOpSnippet:aJ,cpuKernelImpl:tK}),oJ={kernelName:Hh,backendName:"webgl",kernelFunc:iJ},sJ=sY({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),uJ={kernelName:Xh,backendName:"webgl",kernelFunc:sJ},cJ=Jn((function e(t){$n(this,e),this.variableNames=["A"];var n=uX(),r=f(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")})),lJ=Jn((function e(t){$n(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=uX(),r=f(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),hJ={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!==typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement,u="undefined"!==typeof ImageBitmap&&a instanceof ImageBitmap,c=f(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),l=c[0],h=c[1],d=[h,l],p=[h,l,i];(s||o||u)&&(null==eJ&&(eJ=document.createElement("canvas").getContext("2d")),eJ.canvas.width=l,eJ.canvas.height=h,eJ.drawImage(a,0,0,l,h),a=eJ.canvas);var v=n.makeTensorInfo(d,"int32");n.texData.get(v.dataId).usage=CH.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(v.dataId),a);var m=jl().getBool("WEBGL_PACK")?new lJ(p):new cJ(p),g=n.runWebGLProgram(m,[v],"int32");return n.disposeData(v.dataId),g}};var fJ={kernelName:Ad,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,l=a.pad,h=a.dataFormat,f=a.dilations,d=a.dimRoundingMode,p=a.activation,v=a.leakyreluAlpha,m=Gm(h),g=Rm(i.shape,o.shape,c,f,l,d,!1,m),y=[];if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(jl().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])t=$Q({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:p,preluActivationWeights:u,leakyreluAlpha:v});else{var b=null!=s,x=null!=u,k="leakyrelu"===p,w=p?uY(p,!1):null,_=new YQ(g,b,w,x,k),S=[i,o];if(s&&S.push(s),u&&S.push(u),k){var C=r.makeTensorInfo([],"float32",Xd(v,"float32"));S.push(C),y.push(C)}t=r.runWebGLProgram(_,S,"float32")}else t=JQ({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:p,preluActivationWeights:u,leakyreluAlpha:v});var T=mY({inputs:{x:t},backend:r,attrs:{shape:g.outShape}});return y.push(t),y.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),T}};var dJ={kernelName:Md,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,h=r.dimRoundingMode,f=r.activation,d=r.leakyreluAlpha,p=[],v=l;null==v&&(v=[1,1]),fl(Wm(u,v),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(v,"'")}));var m,g=Rm(a.shape,i.shape,u,v,c,h,!0),y=jl().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=f?uY(f,y):null,x=[a,i],k=null!=o,w=null!=s,_="leakyrelu"===f;if(k&&x.push(o),w&&x.push(s),_){var S=n.makeTensorInfo([],"float32",Xd(d,"float32"));x.push(S),p.push(S)}m=y?new SZ(g,k,b,w,_):new _Z(g,k,b,w,_);var C=n.runWebGLProgram(m,x,"float32");return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),C}},pJ=Jn((function e(t,n,r){$n(this,e),this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=r;var a=VX(n.length),i=VX(r.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        ".concat(a," strides = ").concat(a,"(").concat(this.strides,");\n         void main() {\n          ").concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ").concat(this.sliceDim,"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ").concat(o,";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      ")}));var vJ={kernelName:"GatherNd",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=a.shape,o=i[i.length-1],s=function(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===ml(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,h=i;h<n;++h)l*=u[h],c.push(u[h]);var f=[].concat(Tt(Pl(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,f]}(r,a),u=f(s,4),c=u[0],l=u[1],h=u[2],d=u[3],p=mY({inputs:{x:a},backend:n,attrs:{shape:[l,o]}}),v=mY({inputs:{x:r},backend:n,attrs:{shape:[ml(r.shape)/h,h]}}),m=new pJ(o,d,[l,h]),g=n.runWebGLProgram(m,[v,p],v.dtype),y=mY({inputs:{x:g},backend:n,attrs:{shape:c}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),y}},mJ=Jn((function e(t,n){$n(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=VX(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("int(getIndices(resRC.x, resRC.z))"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        setOutput(getA(").concat(a,"));\n      }\n    ")}));var gJ={kernelName:Yh,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=function(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,h=1,f=0;f<r;++f)u.push(e.shape[f]),c*=e.shape[f];for(var d=r;d<n;d++)u.push(e.shape[d]),l*=e.shape[d];for(var p=r;p<a;p++)u.push(t.shape[p]);for(var v=n+1;v<i;v++)u.push(e.shape[v]),h*=e.shape[v];return{batchSize:c,sliceSize:h,outerSize:l,dimSize:s,outputShape:u}}(a,i,wl(o,a.shape)[0],s),c=ml(i.shape),l=[],h=mY({inputs:{x:a},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),f=mY({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,c/u.batchSize]}});l.push(h),l.push(f);var d=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var p=n.bufferSync(f),v=n.bufferSync(h),m=nK(v,p,d);return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(u.outputShape,m.dtype,m.values)}var g=new mJ(h.shape,d),y=n.runWebGLProgram(g,[h,f],h.dtype);l.push(y);var b=mY({inputs:{x:y},backend:n,attrs:{shape:u.outputShape}});return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),b}},yJ=sY({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:rK,dtype:"bool"}),bJ={kernelName:Qh,backendName:"webgl",kernelFunc:yJ},xJ=sY({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool"}),kJ={kernelName:Zh,backendName:"webgl",kernelFunc:xJ};var wJ={kernelName:$h,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return QZ(t.input,!0,n)}},_J=oY({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"}),SJ={kernelName:tf,backendName:"webgl",kernelFunc:_J},CJ=oY({opSnippet:"return float(isinf(x));",dtype:"bool"}),TJ={kernelName:nf,backendName:"webgl",kernelFunc:CJ},EJ=oY({opSnippet:"return float(isnan(x));",dtype:"bool"}),IJ={kernelName:rf,backendName:"webgl",kernelFunc:EJ},AJ=sY({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:aK,dtype:"bool"}),MJ={kernelName:of,backendName:"webgl",kernelFunc:AJ},NJ=sY({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",dtype:"bool"}),RJ={kernelName:sf,backendName:"webgl",kernelFunc:NJ};var DJ={kernelName:uf,backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=iK(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},PJ=oY({opSnippet:"if (x < 0.0) return NAN;\n  return log(x);",packedOpSnippet:"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:oK}),OJ={kernelName:cf,backendName:"webgl",kernelFunc:PJ},LJ=oY({opSnippet:"return log(1.0 + x);"}),FJ={kernelName:lf,backendName:"webgl",kernelFunc:LJ},zJ=sY({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),BJ={kernelName:hf,backendName:"webgl",kernelFunc:zJ},UJ=oY({opSnippet:"return float(!(x >= 1.0));"}),VJ={kernelName:ff,backendName:"webgl",kernelFunc:UJ},WJ=sY({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"}),GJ={kernelName:df,backendName:"webgl",kernelFunc:WJ},jJ=Jn((function e(t,n,r,a,i){$n(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")})),qJ=Jn((function e(t,n,r,a,i){$n(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")})),HJ={kernelName:pf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=jl().getBool("WEBGL_PACK_NORMALIZATION")?new qJ(a.shape,i,o,s,u):new jJ(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},XJ=Jn((function e(t,n,r,a,i){$n(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")})),KJ={kernelName:vf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,h=new XJ(a.shape,s,u,c,l);return n.runWebGLProgram(h,[a,i,o],a.dtype)}};function YJ(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=wl(i,a.shape),c=u,l=Yg(c,s),h=null!=l,d=n.shouldExecuteOnCPU([a]),p=a;if(h){if(d){for(var v=n.texData.get(p.dataId).values,m=new Array(s),g=0;g<m.length;g++)m[g]=a.shape[l[g]];var y=kK(v,a.shape,a.dtype,l,m);p=n.makeTensorInfo(m,a.dtype),n.texData.get(p.dataId).values=y}else p=_Y(a,l,n);c=Zg(c.length,s)}Kg("max",c,s);var b,x=f(Hg(p.shape,c),2),k=x[0],w=x[1],_=k;if(o&&(_=Xg(k,u)),d){v=n.texData.get(p.dataId).values;var S=sK(v,ml(w),_,a.dtype);b=n.makeTensorInfo(_,a.dtype),n.texData.get(b.dataId).values=S}else b=function(e,t,n,r){var a=ml(t),i=mY({inputs:{x:e},attrs:{shape:[ml(e.shape)/a,a]},backend:r}),o=xY(i,e.dtype,"max",r),s=mY({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(p,w,_,n);return h&&n.disposeIntermediateTensorInfo(p),b}var QJ={kernelName:mf,backendName:"webgl",kernelFunc:YJ},ZJ=sY({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:uK}),JJ={kernelName:gf,backendName:"webgl",kernelFunc:ZJ};var $J={kernelName:yf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;oX(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;fl(Wm(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Mm(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&gl(c.inShape,c.outShape))return QK({inputs:{x:a},backend:n});var l=new sQ(c,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}};var e$={kernelName:xf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=Nm(a.shape,i,o,[1,1,1],s,c,u),h=new uQ(l,"max",!1);return n.runWebGLProgram(h,[a],a.dtype)}},t$=Jn((function e(t){$n(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,c=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),n$=Jn((function e(t){$n(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,h=u-1-t.padInfo.front,f=c-1-t.padInfo.top,d=l-1-t.padInfo.left,p=u*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(h,", ").concat(f,", ").concat(d,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(p," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var r$={kernelName:kf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Nm(i.shape,o,s,[1,1,1],u,c),h=new uQ(l,"max",!0),f=n.runWebGLProgram(h,[i],i.dtype),d=new n$(l),p=n.runWebGLProgram(d,[a,f],i.dtype);return n.disposeIntermediateTensorInfo(f),p}};var a$={kernelName:bf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;oX([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,h=Mm(o.shape,s,u,1,c,l),f=new sQ(h,"max",!0),d=n.runWebGLProgram(f,[o],o.dtype),p=new t$(h),v=n.runWebGLProgram(p,[a,d],o.dtype);return n.disposeIntermediateTensorInfo(d),v}};var i$={kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;fl(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var l=[1,1];fl(Wm(o,l),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(l,"'")}));var h=Mm(a.shape,i,o,l,s),d=function(e,t,n,r){var a=new sQ(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new sQ(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,u,h,c),p=f(d,2);return[p[0],p[1]]}};var o$={kernelName:wf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.keepDims,o=n.axis,s=r,u=a.shape.length,c=wl(o,a.shape),l=c,h=Yg(l,u),d=null!=h,p=s.shouldExecuteOnCPU([a]),v=[],m=a;if(d){if(p){for(var g=s.texData.get(m.dataId).values,y=new Array(u),b=0;b<y.length;b++)y[b]=a.shape[h[b]];var x=kK(g,a.shape,a.dtype,h,y);m=s.makeTensorInfo(y,a.dtype),s.texData.get(m.dataId).values=x}else m=_Y(a,h,s);v.push(m),l=Zg(l.length,u)}Kg("sum",l,u);var k=f(Hg(m.shape,l),2),w=k[0],_=k[1],S=w;i&&(S=Xg(w,c));for(var C=function(e,t,n,r){var a=ml(t),i=mY({inputs:{x:e},attrs:{shape:[ml(e.shape)/a,a]},backend:r}),o=xY(i,"float32","mean",r),s=mY({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(m,_,S,s),T=0,E=v;T<E.length;T++){b=E[T];s.disposeIntermediateTensorInfo(b)}return C}};var s$={kernelName:_f,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=wl(i,a.shape),c=u,l=Yg(c,s),h=a;null!=l&&(h=TY({inputs:{x:a},backend:n,attrs:{perm:l}}),c=Zg(c.length,a.shape.length)),Kg("min",c,s);var d,p=f(Hg(h.shape,c),2),v=p[0],m=mY({inputs:{x:h},backend:n,attrs:{shape:[-1,ml(p[1])]}}),g=xY(m,m.dtype,"min",n);return d=mY(o?{inputs:{x:g},backend:n,attrs:{shape:Xg(v,u)}}:{inputs:{x:g},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(h),d}},u$=sY({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:cK}),c$={kernelName:Sf,backendName:"webgl",kernelFunc:u$},l$=Jn((function e(t,n,r){$n(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=VX(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")})),h$=Jn((function e(t,n,r){$n(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=VX(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=SK("rc",a),c=SK("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),f="reflect"===r?0:1,d="";if(1===a){var p="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(f,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(f,";\n        }\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(p,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(p,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ")}else{var v="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(f,") +\n                gte * ((end - 1) * 2 - source + ").concat(f,");\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(v,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(v,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(v,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(v,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")})),f$={kernelName:Cf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=jl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new h$(a.shape,i,o):new l$(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},d$=sY({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),p$={kernelName:Tf,backendName:"webgl",kernelFunc:d$},v$=function(){function e(t,n,r){$n(this,e),this.variableNames=["probs"],this.outputShape=[t,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")}return Jn(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}}}]),e}(),m$=sY({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),g$={kernelName:Lh,backendName:"webgl",kernelFunc:m$},y$="return a - b;",b$=sY({opSnippet:y$,packedOpSnippet:y$,supportsComplex:!0,cpuKernelImpl:yK}),x$={kernelName:vd,backendName:"webgl",kernelFunc:b$};function k$(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=wl([r.dim],a.shape),o=YJ({inputs:{x:a},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),s=Xg(o.shape,i),u=mY({inputs:{x:o},backend:n,attrs:{shape:s}}),c=b$({inputs:{a:a,b:u},backend:n}),l=WZ({inputs:{x:c},backend:n}),h=SY({inputs:{x:l},backend:n,attrs:{axis:i,keepDims:!1}}),f=mY({inputs:{x:h},backend:n,attrs:{shape:s}}),d=m$({inputs:{a:l,b:f},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),d}var w$={kernelName:fd,backendName:"webgl",kernelFunc:k$};var _$={kernelName:Ef,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:k$({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],h=new v$(c,l,i),f=h.getCustomSetupFunc(o),d=n.runWebGLProgram(h,[u],"int32",f);return s||n.disposeIntermediateTensorInfo(u),d}},S$="return -x;";var C$={kernelName:Af,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var i=r.texData.get(a.dataId),o=f(hK(i.values,a.shape,a.dtype),2),s=o[0],u=o[1];return r.makeTensorInfo(u,a.dtype,s)}return t=jl().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new GK(a.shape,S$):new NK(a.shape,S$),r.runWebGLProgram(t,[a],a.dtype)}},T$=_b;var E$={kernelName:Nf,backendName:"webgl",kernelFunc:function(e){dx("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(i.dataId),h=T$(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},I$=Sb;var A$={kernelName:Rf,backendName:"webgl",kernelFunc:function(e){dx("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),h=n.readSync(i.dataId),f=I$(l,h,o,s,u,c),d=f.selectedIndices,p=f.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},M$=Cb;var N$={kernelName:Df,backendName:"webgl",kernelFunc:function(e){dx("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),h=n.readSync(i.dataId),f=M$(l,h,o,s,u,c),d=f.selectedIndices,p=f.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([p.length],"float32",new Float32Array(p))]}},R$=Jn((function e(t,n,r,a){$n(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")})),D$={kernelName:Of,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.depth,o=r.onValue,s=r.offValue,u=ml(a.shape),c=new R$(u,i,o,s),l=mY({inputs:{x:a},backend:n,attrs:{shape:[u]}}),h=n.runWebGLProgram(c,[l],a.dtype);n.disposeIntermediateTensorInfo(l);var f=mY({inputs:{x:h},backend:n,attrs:{shape:[].concat(Tt(a.shape),[i])}});return n.disposeIntermediateTensorInfo(h),f}};function P$(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=IQ({inputs:{input:r},backend:n}),i=P$({inputs:{x:a},backend:n}),o=GQ({inputs:{input:r},backend:n}),s=P$({inputs:{x:o},backend:n}),u=JK({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return $Z({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var O$={kernelName:Cd,backendName:"webgl",kernelFunc:P$};var L$={kernelName:Pf,backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=IQ({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=GQ({inputs:{input:a},backend:r}),u=P$({inputs:{x:s},backend:r}),c=JK({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return $Z({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var F$={kernelName:Lf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return jZ({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){dl(a,e.shape,"All tensors passed to stack must have matching shapes"),fl(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=XQ({inputs:t.map((function(e){var t=jZ({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}},z$=Jn((function e(t,n,r){$n(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=VX(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float(").concat(r,"));\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float(").concat(r,"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")})),B$=Jn((function e(t,n,r){$n(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=VX(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=SK("rc",a),c=SK("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),f=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],d=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",v=0,m=1===a?2:4;v<m;v++)p+="\n        ".concat(f[v],"\n        if (").concat(d,") {\n          result[").concat(v,"] = float(").concat(r,");\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(v,"] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ");p+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")})),U$=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue,s=jl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new B$(a.shape,i,o):new z$(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)},V$={kernelName:Ff,backendName:"webgl",kernelFunc:U$},W$=sY({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"}),G$={kernelName:zf,backendName:"webgl",kernelFunc:W$};var j$={kernelName:Uf,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=[],l=wl(o,i.shape),h=l,d=Yg(h,u),p=i;if(null!=d&&(p=TY({inputs:{x:i},backend:r,attrs:{perm:d}}),h=Zg(h.length,u),c.push(p)),Kg("prod",h,u),r.shouldExecuteOnCPU([p])){var v=r.texData.get(p.dataId).values,m=fK(p.shape,p.dtype,v,h),g=m.outVals,y=m.outShape,b=m.outDtype;t=r.makeTensorInfo(y,b,g)}else{var x=f(Hg(p.shape,h),2),k=x[0],w=ml(x[1]),_=mY({inputs:{x:p},backend:r,attrs:{shape:[-1,w]}}),S=xY(_,lp(i.dtype),"prod",r);t=mY({inputs:{x:S},backend:r,attrs:{shape:k}}),c.push(_),c.push(S)}if(s){c.push(t);var C=Xg(t.shape,l);t=mY({inputs:{x:t},backend:r,attrs:{shape:C}})}return c.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}},q$=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=dK(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},H$={kernelName:Vf,backendName:"webgl",kernelFunc:q$},X$=oY({opSnippet:"return 1.0 / x;"}),K$={kernelName:Gf,backendName:"webgl",kernelFunc:X$},Y$=oY({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),Q$={kernelName:jf,backendName:"webgl",kernelFunc:Y$},Z$=oY({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),J$={kernelName:Qf,backendName:"webgl",kernelFunc:Z$},$$=Jn((function e(t,n,r,a,i){$n(this,e),this.variableNames=["A"],this.outputShape=[];var o=f(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var h,d=[a&&n>1?u-1:u,a&&r>1?c-1:c],p=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(d[0]/p[0],",\n          ").concat(d[1]/p[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")})),e0=Jn((function e(t,n,r,a,i){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=f(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var h,d=[a&&n>1?u-1:u,a&&r>1?c-1:c],p=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(d[0]/p[0],",\n          ").concat(d[1]/p[1],",\n          ").concat(d[1]/p[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}));var t0={kernelName:Kf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=f(r.size,2),u=s[0],c=s[1],l=jl().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new e0(a.shape,u,c,i,o):new $$(a.shape,u,c,i,o);return n.runWebGLProgram(l,[a],"float32")}},n0=Jn((function e(t,n,r){$n(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=f(n,3),i=a[1],o=a[2],s=f(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],h=[r&&u>1?u-1:u,r&&c>1?c-1:c],d=l[0]/h[0],p=l[1]/h[1],v=1/d,m=1/p,g=2*Math.ceil(v)+2,y=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(d,");\n        const float widthScale = float(").concat(p,");\n\n        const float invHeightScale = float(").concat(v,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(g,");\n        const int winWidth = int(").concat(y,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var r0={kernelName:Yf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new n0(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},a0=Jn((function e(t,n,r,a,i){$n(this,e),this.variableNames=["A"],this.outputShape=[];var o=f(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var h,d=[a&&n>1?u-1:u,a&&r>1?c-1:c],p=[a&&n>1?n-1:n,a&&r>1?r-1:r],v=a?"0.5":"0.0";h=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(d[0]/p[0],",\n          ").concat(d[1]/p[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(v,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")}));var i0={kernelName:Hf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=f(r.size,2),u=s[0],c=s[1],l=new a0(a.shape,u,c,i,o);return n.runWebGLProgram(l,[a],a.dtype)}},o0=Jn((function e(t,n,r){$n(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=f(n,3),i=a[1],o=a[2],s=f(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],h=[r&&u>1?u-1:u,r&&c>1?c-1:c],d=l[0]/h[0],p=l[1]/h[1],v=1/d,m=1/p,g=2*Math.ceil(v)+2,y=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(d,");\n        const float widthScale = float(").concat(p,");\n\n        const float invHeightScale = float(").concat(v,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(g,");\n        const int winWidth = int(").concat(y,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(l[0],") *\n                (float(dyR) / float(").concat(h[0],"));\n\n            float sourceFracCol =\n                float(").concat(l[1],") *\n                  (float(dyC) / float(").concat(h[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var s0={kernelName:Xf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new o0(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},u0=Jn((function e(t,n){$n(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=VX(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")})),c0=Jn((function e(t,n){$n(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=SK("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=VX(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}));var l0={kernelName:Zf,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=wl(i,a.shape);if(0===o)return QK({inputs:{x:a},backend:n});var u=jl().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new c0(a.shape,s):new u0(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},h0=Jn((function e(t,n,r,a){$n(this,e),this.variableNames=["Image"],this.outputShape=[];var i=t[1],o=t[2],s=Math.sin(n).toFixed(3),u=Math.cos(n).toFixed(3);this.outputShape=t;var c=function(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}(a,i,o),l=f(c,2),h=l[0],d=l[1],p=h.toFixed(3),v=d.toFixed(3),m="";m="number"===typeof r?"float outputValue = ".concat(r.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(r.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - ".concat(p,") * ").concat(u," - (float(y) - ").concat(v,") * ").concat(s,";\n          float coordYFloat = (float(x) - ").concat(p,") * ").concat(s," + (float(y) - ").concat(v,") * ").concat(u,";\n          int coordX = int(round(coordXFloat + ").concat(p,"));\n          int coordY = int(round(coordYFloat + ").concat(v,"));\n          ").concat(m,"\n          if(coordX >= 0 && coordX < ").concat(o," && coordY >= 0 && coordY < ").concat(i,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),f0={kernelName:Ed,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new h0(a.shape,i,o,s);return u.runWebGLProgram(c,[a],a.dtype)}},d0=oY({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),p0={kernelName:Jf,backendName:"webgl",kernelFunc:d0},v0=oY({opSnippet:"return inversesqrt(x);",cpuKernelImpl:pK}),m0={kernelName:$f,backendName:"webgl",kernelFunc:v0},g0=Jn((function e(t,n,r,a,i,o){$n(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=VX(i.length),u=VX(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="getIndices(".concat(c,")"),h="";1===a?h="i":2===a&&(h="i, coords[1]");var f="getUpdates(".concat(h,")"),d=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(l,");\n              flattenedIndex += index * ").concat(d,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(f,";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")}));var y0={kernelName:"ScatterNd",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=lx(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,h=s.strides,f=s.outputSize,d=[f/l,l];if(0===f)return n.makeTensorInfo(o,a.dtype);var p=mY({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),v=mY({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new g0(c,u,p.shape.length,v.shape.length,h,d),y=n.runWebGLProgram(g,[v,p,m],v.dtype),b=mY({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),b}},b0=Jn((function e(t,n,r){var a,i;if($n(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=VX(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")}));var x0={kernelName:ed,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new b0(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],cp(a.dtype,i.dtype))}},k0=oY({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(hx,";\n  float scale = ").concat(fx,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")}),w0={kernelName:td,backendName:"webgl",kernelFunc:k0},_0=oY({opSnippet:"return 1.0 / (1.0 + exp(-1.0 * x));"}),S0={kernelName:od,backendName:"webgl",kernelFunc:_0},C0=oY({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"}),T0={kernelName:id,backendName:"webgl",kernelFunc:C0},E0=oY({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"}),I0={kernelName:rd,backendName:"webgl",kernelFunc:E0},A0=oY({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"}),M0={kernelName:ad,backendName:"webgl",kernelFunc:A0},N0=oY({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"}),R0={kernelName:sd,backendName:"webgl",kernelFunc:N0},D0={kernelName:ld,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;fl(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,Tt(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],h=U$({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),f=sx(h.shape,i,s,!1),d=ux(f.length,i.length,!1),p=cx(h.shape,i,s,!1),v=mY({inputs:{x:h},backend:n,attrs:{shape:f}}),m=TY({inputs:{x:v},backend:n,attrs:{perm:d}}),g=mY({inputs:{x:m},backend:n,attrs:{shape:p}});return l.push(h),l.push(v),l.push(m),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var P0={kernelName:"SparseToDense",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=lx(0,a,s),c=u.sliceRank,l=u.numUpdates,h=u.strides,f=u.outputSize,d=new g0(l,c,a.shape.length,i.shape.length,h,[f,1],!1),p=n.runWebGLProgram(d,[i,a,o],i.dtype),v=mY({inputs:{x:p},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(p),v}};var O0={kernelName:hd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=wl(r.axis,a.shape)[0],s=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)fl(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);fl(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}fl(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}(a,i,o),u=a.shape.length,c=new Array(u).fill(0),l=a.shape.slice();return s.map((function(e){var t=Tt(l);t[o]=e;var r=wQ({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[o]+=e,r}))}},L0=oY({opSnippet:"return sqrt(x);"}),F0={kernelName:ud,backendName:"webgl",kernelFunc:L0},z0={kernelName:pd,backendName:"webgl",kernelFunc:oY({opSnippet:"return x * x;"})},B0="return (a - b) * (a - b);",U0=sY({opSnippet:B0,packedOpSnippet:B0}),V0={kernelName:dd,backendName:"webgl",kernelFunc:U0};var W0={kernelName:Td,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=RK+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new NK(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},G0=Jn((function e(t,n,r){$n(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=VX(r.length),o=VX(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}));var j0={kernelName:md,backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,h=a.ellipsisMask,f=a.newAxisMask,d=a.shrinkAxisMask,p=fm(i.shape,o,s,u,c,l,h,f,d),v=p.nonStrided,m=p.$begin,g=p.$strides,y=p.size,b=p.newShape,x=p.outShape,k=mY({inputs:{x:i},backend:r,attrs:{shape:b}});if(v){var w=wQ({inputs:{x:k},backend:r,attrs:{begin:m,size:y}});t=mY({inputs:{x:w},backend:r,attrs:{shape:x}}),r.disposeIntermediateTensorInfo(w)}else if(x.some((function(e){return 0===e})))t=r.makeTensorInfo(x,i.dtype,[]);else{if(r.shouldExecuteOnCPU([k])){var _=r.texData.get(k.dataId).values,S=Pv(k.shape,k.dtype,_),C=gK(x,S,g,m);t=r.makeTensorInfo(x,k.dtype,C.values)}else{var T=new G0(m,g,x);t=r.runWebGLProgram(T,[k],k.dtype)}}var E=mY({inputs:{x:t},backend:r,attrs:{shape:x}});return r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo(t),E}},q0=oY({opSnippet:"return tan(x);"}),H0={kernelName:gd,backendName:"webgl",kernelFunc:q0},X0=oY({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"}),K0={kernelName:yd,backendName:"webgl",kernelFunc:X0},Y0=Jn((function e(t,n){$n(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=VX(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}));function Q0(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype){var o=n.readSync(a.dataId).map((function(e){return Zd(e)})),s=Pv(a.shape,a.dtype,o),u=bK(s,i);return n.makeTensorInfo(u.shape,u.dtype,u.values)}var c=new Y0(a.shape,i);return n.runWebGLProgram(c,[a],a.dtype)}var Z0={kernelName:bd,backendName:"webgl",kernelFunc:Q0};var J0={kernelName:xd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=n.readSync(a.dataId),u=f(xK(s,a.shape,a.dtype,i,o),2),c=u[0],l=u[1];return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}};var $0={kernelName:wd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;oX(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=wK(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}};var e1={kernelName:_d,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,h=0;h<s;h++)h!==i&&(c[l++]=o.shape[h]);var f=[],d=new Array(s).fill(0),p=o.shape.slice();p[i]=1;for(var v=new Array(u),m=0;m<v.length;m++){d[i]=m;var g=wQ({inputs:{x:o},backend:n,attrs:{begin:d,size:p}}),y=mY({inputs:{x:g},backend:n,attrs:{shape:c}});v[m]=y,f.push(g)}return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}},t1=Jn((function e(t,n){$n(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var f="";i%r>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(f,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}));for(var n1={kernelName:Sd,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=Yg([c],s),h=a;null!=l&&(h=TY({inputs:{x:a},backend:n,attrs:{perm:l}}),u.push(h),c=Zg(1,s)[0]);var f=function(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}(h.shape,c,o),d=ml([h.shape[c]]),p=mY({inputs:{x:h},backend:n,attrs:{shape:[-1,d]}});u.push(p);var v=function e(t,r,a,i,o){var s=t.shape[0],c=t.shape[1],l=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=Dl(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Dl(e,n+1);return n}(c,o),h=new t1({windowSize:l,inSize:c,batchSize:s,numSegments:o},r),f=n.compileAndRun(h,[t,a],i);if(u.push(f),f.shape[1]===o)return f;var d=q$({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),p=Q0({inputs:{x:d},backend:n,attrs:{reps:[c/l]}});return u.push(d),u.push(p),e(f,r,p,i,o)}(p,"unsortedSegmentSum",i,lp(a.dtype),o),m=mY({inputs:{x:v},backend:n,attrs:{shape:f}}),g=m;if(null!=l){u.push(m);var y=Qg(l);g=TY({inputs:{x:g},backend:n,attrs:{perm:y}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},r1=0,a1=[HJ,KJ,AY,NY,DY,OY,zY,VY,WY,GY,YY,QY,JY,eQ,aQ,nQ,oQ,lQ,cQ,dQ,pQ,vQ,yQ,SQ,CQ,MQ,DQ,LQ,BQ,$K,KQ,iZ,oZ,eZ,uZ,cZ,sZ,hZ,dZ,vZ,bZ,xZ,wZ,IZ,AZ,CZ,NZ,DZ,OZ,LZ,zZ,UZ,GZ,qZ,KZ,ZZ,tJ,rJ,oJ,uJ,hJ,fJ,dJ,vJ,gJ,bJ,kJ,ZK,wJ,jQ,SJ,TJ,IJ,nY,MJ,RJ,DJ,FJ,OJ,BJ,VJ,GJ,QJ,e$,$J,r$,a$,i$,JJ,o$,s$,c$,f$,p$,_$,vY,C$,E$,A$,N$,EQ,D$,L$,F$,V$,G$,iY,j$,H$,AQ,g$,K$,J$,Q$,gY,t0,r0,i0,s0,l0,f0,p0,m0,y0,x0,w0,S0,T0,I0,M0,_Q,w$,R0,D0,P0,O0,F0,z0,V0,W0,j0,x$,CY,H0,K0,Z0,J0,EY,$0,e1,n1,O$];r1<a1.length;r1++){Od(a1[r1])}var i1="C C# Db D D# Eb E F F# Gb G G# Ab A A# Bb B".split(" "),o1=function(e){return"string"!==typeof e?i1.slice():i1.filter((function(t){var n=t[1]||" ";return-1!==e.indexOf(n)}))},s1=(o1(" #"),o1(" b"),/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/);function u1(e){"string"!==typeof e&&(e="");var t=s1.exec(e);return[t[1].toUpperCase(),t[2].replace(/x/g,"##"),t[3],t[4]]}var c1=Object.freeze({pc:null,name:null,step:null,alt:null,oct:null,octStr:null,chroma:null,midi:null,freq:null}),l1=[0,2,4,5,7,9,11],h1=function(e,t){return void 0===t&&(t={}),function(n){return t[n]||(t[n]=e(n))}}((function(e){var t=u1(e);if(""===t[0]||""!==t[3])return c1;var n=t[0],r=t[1],a=t[2],i={letter:n,acc:r,octStr:a,pc:n+r,name:n+r+a,step:(n.charCodeAt(0)+3)%7,alt:"b"===r[0]?-r.length:r.length,oct:a.length?+a:null,chroma:0,midi:null,freq:null};return i.chroma=(l1[i.step]+i.alt+120)%12,i.midi=null!==i.oct?l1[i.step]+i.alt+12*(i.oct+1):null,i.freq=f1(i.midi),Object.freeze(i)})),f1=function(e,t){return void 0===t&&(t=440),"number"===typeof e?Math.pow(2,(e-69)/12)*t:null},d1=(Math.log(2),Math.log(440),function(e){return h1(e).chroma}),p1=function(e,t){return Array(t+1).join(e)},v1=function(e,t){void 0===e&&(e={}),void 0===t&&(t=null);var n=t?Object.assign({},h1(t),e):e,r=n.step,a=n.alt,i=n.oct;if("number"!==typeof r)return null;var o=function(e){return"CDEFGAB"[e]}(r);if(!o)return null;var s=o+function(e){return function(e,t){return"number"!==typeof e?"":t(e)}(e,(function(e){return e<0?p1("b",-e):p1("#",e)}))}(a);return i||0===i?s+i:s};var m1=new RegExp("^([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})|(AA|A|P|M|m|d|dd)([-+]?\\d+)$"),g1=[0,2,4,5,7,9,11],y1="PMMPPMM",b1=("1P 2m 2M 3m 3M 4P 5P 6m 6M 7m 7M 8P".split(" "),Object.freeze({name:null,num:null,q:null,step:null,alt:null,dir:null,type:null,simple:null,semitones:null,chroma:null,oct:null})),x1=function(e){return(Math.abs(e)-1)%7},k1=function(e){var t=function(e){var t=m1.exec(""+e);return null===t?null:t[1]?[t[1],t[2]]:[t[4],t[3]]}(e);if(null===t)return b1;var n={num:0,q:"d",name:"",type:"M",step:0,dir:-1,simple:1,alt:0,oct:0,semitones:0,chroma:0,ic:0};return n.num=+t[0],n.q=t[1],n.step=x1(n.num),n.type=y1[n.step],"M"===n.type&&"P"===n.q?b1:(n.name=""+n.num+n.q,n.dir=n.num<0?-1:1,n.simple=8===n.num||-8===n.num?n.num:n.dir*(n.step+1),n.alt=function(e,t){return"M"===t&&"M"===e||"P"===t&&"P"===e?0:"m"===t&&"M"===e?-1:/^A+$/.test(t)?t.length:/^d+$/.test(t)?"P"===e?-t.length:-t.length-1:null}(n.type,n.q),n.oct=Math.floor((Math.abs(n.num)-1)/7),n.semitones=n.dir*(g1[n.step]+n.alt+12*n.oct),n.chroma=(n.dir*(g1[n.step]+n.alt)%12+12)%12,Object.freeze(n))},w1={};function _1(e){return"string"!==typeof e?b1:w1[e]||(w1[e]=k1(e))}"P m M m M P d P m M m M".split(" ");var S1=[0,2,4,-1,1,3,5],C1=S1.map((function(e){return Math.floor(7*e/12)})),T1=[3,0,4,1,5,2,6];var E1=function(e,t,n){var r=T1[function(e){var t=(e+1)%7;return t<0?7+t:t}(e)],a=Math.floor((e+1)/7);return void 0===t?{step:r,alt:a,dir:n}:{step:r,alt:a,oct:t+4*a+C1[r],dir:n}},I1=function(e){return function(e,t){return void 0===t&&(t={}),function(n){return t[n]||(t[n]=e(n))}}((function(t){var n=e(t);return null===n.name?null:function(e){var t=e.step,n=e.alt,r=e.oct,a=e.dir;void 0===a&&(a=1);var i=S1[t]+7*n;return null===r?[a*i]:[a*i,a*(r-C1[t]-4*n)]}(n)}))},A1=I1(h1),M1=I1(_1);function N1(e,t){if(1===arguments.length)return function(t){return N1(e,t)};var n=A1(e),r=M1(t);if(null===n||null===r)return null;var a=1===n.length?[n[0]+r[0]]:[n[0]+r[0],n[1]+r[1]];return v1(E1(a[0],a[1]))}var R1=JSON.parse('{"chromatic":["1P 2m 2M 3m 3M 4P 4A 5P 6m 6M 7m 7M"],"lydian":["1P 2M 3M 4A 5P 6M 7M"],"major":["1P 2M 3M 4P 5P 6M 7M",["ionian"]],"mixolydian":["1P 2M 3M 4P 5P 6M 7m",["dominant"]],"dorian":["1P 2M 3m 4P 5P 6M 7m"],"aeolian":["1P 2M 3m 4P 5P 6m 7m",["minor"]],"phrygian":["1P 2m 3m 4P 5P 6m 7m"],"locrian":["1P 2m 3m 4P 5d 6m 7m"],"melodic minor":["1P 2M 3m 4P 5P 6M 7M"],"melodic minor second mode":["1P 2m 3m 4P 5P 6M 7m"],"lydian augmented":["1P 2M 3M 4A 5A 6M 7M"],"lydian dominant":["1P 2M 3M 4A 5P 6M 7m",["lydian b7"]],"melodic minor fifth mode":["1P 2M 3M 4P 5P 6m 7m",["hindu","mixolydian b6M"]],"locrian #2":["1P 2M 3m 4P 5d 6m 7m",["half-diminished"]],"altered":["1P 2m 3m 3M 5d 6m 7m",["super locrian","diminished whole tone","pomeroy"]],"harmonic minor":["1P 2M 3m 4P 5P 6m 7M"],"phrygian dominant":["1P 2m 3M 4P 5P 6m 7m",["spanish","phrygian major"]],"half-whole diminished":["1P 2m 3m 3M 4A 5P 6M 7m",["dominant diminished"]],"diminished":["1P 2M 3m 4P 5d 6m 6M 7M",["whole-half diminished"]],"major pentatonic":["1P 2M 3M 5P 6M",["pentatonic"]],"lydian pentatonic":["1P 3M 4A 5P 7M",["chinese"]],"mixolydian pentatonic":["1P 3M 4P 5P 7m",["indian"]],"locrian pentatonic":["1P 3m 4P 5d 7m",["minor seven flat five pentatonic"]],"minor pentatonic":["1P 3m 4P 5P 7m"],"minor six pentatonic":["1P 3m 4P 5P 6M"],"minor hexatonic":["1P 2M 3m 4P 5P 7M"],"flat three pentatonic":["1P 2M 3m 5P 6M",["kumoi"]],"flat six pentatonic":["1P 2M 3M 5P 6m"],"major flat two pentatonic":["1P 2m 3M 5P 6M"],"whole tone pentatonic":["1P 3M 5d 6m 7m"],"ionian pentatonic":["1P 3M 4P 5P 7M"],"lydian #5P pentatonic":["1P 3M 4A 5A 7M"],"lydian dominant pentatonic":["1P 3M 4A 5P 7m"],"minor #7M pentatonic":["1P 3m 4P 5P 7M"],"super locrian pentatonic":["1P 3m 4d 5d 7m"],"in-sen":["1P 2m 4P 5P 7m"],"iwato":["1P 2m 4P 5d 7m"],"hirajoshi":["1P 2M 3m 5P 6m"],"kumoijoshi":["1P 2m 4P 5P 6m"],"pelog":["1P 2m 3m 5P 6m"],"vietnamese 1":["1P 3m 4P 5P 6m"],"vietnamese 2":["1P 3m 4P 5P 7m"],"prometheus":["1P 2M 3M 4A 6M 7m"],"prometheus neopolitan":["1P 2m 3M 4A 6M 7m"],"ritusen":["1P 2M 4P 5P 6M"],"scriabin":["1P 2m 3M 5P 6M"],"piongio":["1P 2M 4P 5P 6M 7m"],"major blues":["1P 2M 3m 3M 5P 6M"],"minor blues":["1P 3m 4P 5d 5P 7m",["blues"]],"composite blues":["1P 2M 3m 3M 4P 5d 5P 6M 7m"],"augmented":["1P 2A 3M 5P 5A 7M"],"augmented heptatonic":["1P 2A 3M 4P 5P 5A 7M"],"dorian #4":["1P 2M 3m 4A 5P 6M 7m"],"lydian diminished":["1P 2M 3m 4A 5P 6M 7M"],"whole tone":["1P 2M 3M 4A 5A 7m"],"leading whole tone":["1P 2M 3M 4A 5A 7m 7M"],"lydian minor":["1P 2M 3M 4A 5P 6m 7m"],"locrian major":["1P 2M 3M 4P 5d 6m 7m",["arabian"]],"neopolitan":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan minor":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan major":["1P 2m 3m 4P 5P 6M 7M",["dorian b2"]],"neopolitan major pentatonic":["1P 3M 4P 5d 7m"],"romanian minor":["1P 2M 3m 5d 5P 6M 7m"],"double harmonic lydian":["1P 2m 3M 4A 5P 6m 7M"],"harmonic major":["1P 2M 3M 4P 5P 6m 7M"],"double harmonic major":["1P 2m 3M 4P 5P 6m 7M",["gypsy"]],"egyptian":["1P 2M 4P 5P 7m"],"hungarian minor":["1P 2M 3m 4A 5P 6m 7M"],"hungarian major":["1P 2A 3M 4A 5P 6M 7m"],"oriental":["1P 2m 3M 4P 5d 6M 7m"],"spanish heptatonic":["1P 2m 3m 3M 4P 5P 6m 7m"],"flamenco":["1P 2m 3m 3M 4A 5P 7m"],"balinese":["1P 2m 3m 4P 5P 6m 7M"],"todi raga":["1P 2m 3m 4A 5P 6m 7M"],"malkos raga":["1P 3m 4P 6m 7m"],"kafi raga":["1P 3m 3M 4P 5P 6M 7m 7M"],"purvi raga":["1P 2m 3M 4P 4A 5P 6m 7M"],"persian":["1P 2m 3M 4P 5d 6m 7M"],"bebop":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop dominant":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop minor":["1P 2M 3m 3M 4P 5P 6M 7m"],"bebop major":["1P 2M 3M 4P 5P 5A 6M 7M"],"bebop locrian":["1P 2m 3m 4P 5d 5P 6m 7m"],"minor bebop":["1P 2M 3m 4P 5P 6m 7m 7M"],"mystery #1":["1P 2m 3M 5d 6m 7m"],"enigmatic":["1P 2m 3M 5d 6m 7m 7M"],"minor six diminished":["1P 2M 3m 4P 5P 6m 6M 7M"],"ionian augmented":["1P 2M 3M 4P 5A 6M 7M"],"lydian #9":["1P 2m 3M 4A 5P 6M 7M"],"ichikosucho":["1P 2M 3M 4P 5d 5P 6M 7M"],"six tone symmetric":["1P 2m 3M 4P 5A 6M"]}'),D1=JSON.parse('{"4":["1P 4P 7m 10m",["quartal"]],"5":["1P 5P"],"7":["1P 3M 5P 7m",["Dominant","Dom"]],"9":["1P 3M 5P 7m 9M",["79"]],"11":["1P 5P 7m 9M 11P"],"13":["1P 3M 5P 7m 9M 13M",["13_"]],"64":["5P 8P 10M"],"M":["1P 3M 5P",["Major",""]],"M#5":["1P 3M 5A",["augmented","maj#5","Maj#5","+","aug"]],"M#5add9":["1P 3M 5A 9M",["+add9"]],"M13":["1P 3M 5P 7M 9M 13M",["maj13","Maj13"]],"M13#11":["1P 3M 5P 7M 9M 11A 13M",["maj13#11","Maj13#11","M13+4","M13#4"]],"M6":["1P 3M 5P 13M",["6"]],"M6#11":["1P 3M 5P 6M 11A",["M6b5","6#11","6b5"]],"M69":["1P 3M 5P 6M 9M",["69"]],"M69#11":["1P 3M 5P 6M 9M 11A"],"M7#11":["1P 3M 5P 7M 11A",["maj7#11","Maj7#11","M7+4","M7#4"]],"M7#5":["1P 3M 5A 7M",["maj7#5","Maj7#5","maj9#5","M7+"]],"M7#5sus4":["1P 4P 5A 7M"],"M7#9#11":["1P 3M 5P 7M 9A 11A"],"M7add13":["1P 3M 5P 6M 7M 9M"],"M7b5":["1P 3M 5d 7M"],"M7b6":["1P 3M 6m 7M"],"M7b9":["1P 3M 5P 7M 9m"],"M7sus4":["1P 4P 5P 7M"],"M9":["1P 3M 5P 7M 9M",["maj9","Maj9"]],"M9#11":["1P 3M 5P 7M 9M 11A",["maj9#11","Maj9#11","M9+4","M9#4"]],"M9#5":["1P 3M 5A 7M 9M",["Maj9#5"]],"M9#5sus4":["1P 4P 5A 7M 9M"],"M9b5":["1P 3M 5d 7M 9M"],"M9sus4":["1P 4P 5P 7M 9M"],"Madd9":["1P 3M 5P 9M",["2","add9","add2"]],"Maj7":["1P 3M 5P 7M",["maj7","M7"]],"Mb5":["1P 3M 5d"],"Mb6":["1P 3M 13m"],"Msus2":["1P 2M 5P",["add9no3","sus2"]],"Msus4":["1P 4P 5P",["sus","sus4"]],"Maddb9":["1P 3M 5P 9m"],"11b9":["1P 5P 7m 9m 11P"],"13#11":["1P 3M 5P 7m 9M 11A 13M",["13+4","13#4"]],"13#9":["1P 3M 5P 7m 9A 13M",["13#9_"]],"13#9#11":["1P 3M 5P 7m 9A 11A 13M"],"13b5":["1P 3M 5d 6M 7m 9M"],"13b9":["1P 3M 5P 7m 9m 13M"],"13b9#11":["1P 3M 5P 7m 9m 11A 13M"],"13no5":["1P 3M 7m 9M 13M"],"13sus4":["1P 4P 5P 7m 9M 13M",["13sus"]],"69#11":["1P 3M 5P 6M 9M 11A"],"7#11":["1P 3M 5P 7m 11A",["7+4","7#4","7#11_","7#4_"]],"7#11b13":["1P 3M 5P 7m 11A 13m",["7b5b13"]],"7#5":["1P 3M 5A 7m",["+7","7aug","aug7"]],"7#5#9":["1P 3M 5A 7m 9A",["7alt","7#5#9_","7#9b13_"]],"7#5b9":["1P 3M 5A 7m 9m"],"7#5b9#11":["1P 3M 5A 7m 9m 11A"],"7#5sus4":["1P 4P 5A 7m"],"7#9":["1P 3M 5P 7m 9A",["7#9_"]],"7#9#11":["1P 3M 5P 7m 9A 11A",["7b5#9"]],"7#9#11b13":["1P 3M 5P 7m 9A 11A 13m"],"7#9b13":["1P 3M 5P 7m 9A 13m"],"7add6":["1P 3M 5P 7m 13M",["67","7add13"]],"7b13":["1P 3M 7m 13m"],"7b5":["1P 3M 5d 7m"],"7b6":["1P 3M 5P 6m 7m"],"7b9":["1P 3M 5P 7m 9m"],"7b9#11":["1P 3M 5P 7m 9m 11A",["7b5b9"]],"7b9#9":["1P 3M 5P 7m 9m 9A"],"7b9b13":["1P 3M 5P 7m 9m 13m"],"7b9b13#11":["1P 3M 5P 7m 9m 11A 13m",["7b9#11b13","7b5b9b13"]],"7no5":["1P 3M 7m"],"7sus4":["1P 4P 5P 7m",["7sus"]],"7sus4b9":["1P 4P 5P 7m 9m",["susb9","7susb9","7b9sus","7b9sus4","phryg"]],"7sus4b9b13":["1P 4P 5P 7m 9m 13m",["7b9b13sus4"]],"9#11":["1P 3M 5P 7m 9M 11A",["9+4","9#4","9#11_","9#4_"]],"9#11b13":["1P 3M 5P 7m 9M 11A 13m",["9b5b13"]],"9#5":["1P 3M 5A 7m 9M",["9+"]],"9#5#11":["1P 3M 5A 7m 9M 11A"],"9b13":["1P 3M 7m 9M 13m"],"9b5":["1P 3M 5d 7m 9M"],"9no5":["1P 3M 7m 9M"],"9sus4":["1P 4P 5P 7m 9M",["9sus"]],"m":["1P 3m 5P"],"m#5":["1P 3m 5A",["m+","mb6"]],"m11":["1P 3m 5P 7m 9M 11P",["_11"]],"m11A 5":["1P 3m 6m 7m 9M 11P"],"m11b5":["1P 3m 7m 12d 2M 4P",["h11","_11b5"]],"m13":["1P 3m 5P 7m 9M 11P 13M",["_13"]],"m6":["1P 3m 4P 5P 13M",["_6"]],"m69":["1P 3m 5P 6M 9M",["_69"]],"m7":["1P 3m 5P 7m",["minor7","_","_7"]],"m7#5":["1P 3m 6m 7m"],"m7add11":["1P 3m 5P 7m 11P",["m7add4"]],"m7b5":["1P 3m 5d 7m",["half-diminished","h7","_7b5"]],"m9":["1P 3m 5P 7m 9M",["_9"]],"m9#5":["1P 3m 6m 7m 9M"],"m9b5":["1P 3m 7m 12d 2M",["h9","-9b5"]],"mMaj7":["1P 3m 5P 7M",["mM7","_M7"]],"mMaj7b6":["1P 3m 5P 6m 7M",["mM7b6"]],"mM9":["1P 3m 5P 7M 9M",["mMaj9","-M9"]],"mM9b6":["1P 3m 5P 6m 7M 9M",["mMaj9b6"]],"mb6M7":["1P 3m 6m 7M"],"mb6b9":["1P 3m 6m 9m"],"o":["1P 3m 5d",["mb5","dim"]],"o7":["1P 3m 5d 13M",["diminished","m6b5","dim7"]],"o7M7":["1P 3m 5d 6M 7M"],"oM7":["1P 3m 5d 7M"],"sus24":["1P 2M 4P 5P",["sus4add9"]],"+add#9":["1P 3M 5A 9A"],"madd4":["1P 3m 4P 5P"],"madd9":["1P 3m 5P 9M"]}'),P1=function(e){return d1(e)||function(e){return _1(e).chroma}(e)||0};function O1(e){if(F1(e))return e;if(!Array.isArray(e))return"";var t=[0,0,0,0,0,0,0,0,0,0,0,0];return e.map(P1).forEach((function(e){t[e]=1})),t.join("")}var L1=/^[01]{12}$/;function F1(e){return L1.test(e)}"1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M".split(" ");var z1=function(e){var t=Object.keys(e).sort(),n=[],r=[],a=function(e,t,a){n[e]=t,r[a]=r[a]||[],r[a].push(e)};t.forEach((function(t){var n=e[t][0].split(" "),r=e[t][1],i=O1(n);a(t,n,i),r&&r.forEach((function(e){return a(e,n,i)}))}));var i=Object.keys(n).sort(),o=function(e){return n[e]};return o.names=function(e){return"string"===typeof e?(r[e]||[]).slice():(!0===e?i:t).slice()},o},B1=z1(R1),U1=z1(D1),V1=(function(e,t){var n=function(n){return e(n)||t(n)};n.names=function(n){return e.names(n).concat(t.names(n))}}(B1,U1),Object.freeze({name:null,intervals:[],names:[],chroma:null,setnum:null}));B1.names;U1.names;var W1=Object.freeze({name:null,names:[],intervals:[],chroma:null,setnum:null}),G1=function(e,t){return void 0===t&&(t={}),function(n){return t[n]||(t[n]=e(n))}}((function(e){var t=U1(e);if(!t)return W1;var n={intervals:t,name:e};return n.chroma=O1(t),n.setnum=parseInt(n.chroma,2),n.names=U1.names(n.chroma),n})),j1=function(e){return G1(X1(e)[1]).intervals};var q1=function(e){return void 0!==U1(X1(e)[1])},H1=/^(6|64|7|9|11|13)$/;function X1(e){var t=u1(e);return""===t[0]?["",e]:"A"===t[0]&&"ug"===t[3]?["","aug"]:H1.test(t[2])?[t[0]+t[1],t[2]+t[3]]:[t[0]+t[1]+t[2],t[3]]}var K1,Y1=120,Q1=[[36,35],[38,27,28,31,32,33,34,37,39,40,56,65,66,75,85],[42,44,54,68,69,70,71,73,78,80],[46,67,72,74,79,81],[45,29,41,61,64,84],[48,47,60,63,77,86,87],[50,30,43,62,76,83],[49,55,57,58],[51,52,53,59,82]],Z1=127,J1="N.C.",$1=12,e2=[["1P","3M","5P"],["1P","3m","5P"],["1P","3M","5A"],["1P","3m","5d"]];!function(e){e[e.Major=0]="Major",e[e.Minor=1]="Minor",e[e.Augmented=2]="Augmented",e[e.Diminished=3]="Diminished",e[e.Other=4]="Other"}(K1||(K1={}));var t2=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,e),Object.setPrototypeOf(ir(r),(this instanceof n?this.constructor:void 0).prototype),r}return Jn(n)}(cr(Error)),n2=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,e),Object.setPrototypeOf(ir(r),(this instanceof n?this.constructor:void 0).prototype),r}return Jn(n)}(cr(Error)),r2=function(){function e(){$n(this,e)}return Jn(e,null,[{key:"pitches",value:function(e){if(!X1(e)[0]||!q1(e))throw new t2("Unrecognized chord symbol: ".concat(e));return function(e,t){if(t)return G1(t).intervals.map(N1(e));var n=X1(e),r=n[0],a=n[1];return G1(a).intervals.map(N1(r))}(e).map(d1)}},{key:"root",value:function(e){var t=X1(e)[0];if(!t)throw new t2("Chord symbol has unknown root: ".concat(e));return d1(t)}},{key:"quality",value:function(e){if(!q1(e))throw new t2("Unrecognized chord symbol: ".concat(e));var t=j1(e),n=e2.map((function(e){return e.every((function(e){return t.includes(e)}))})),r=n.indexOf(!0),a=n.lastIndexOf(!0);return r>=0&&r===a?r:K1.Other}}]),e}(),a2=function(){function e(){$n(this,e)}return Jn(e,[{key:"encodeProgression",value:function(e,t){var n=this,r=e.map((function(e){return n.encode(e)})),a=Array.from(Array(t).keys()).map((function(e){return Math.floor(e*r.length/t)}));return My(a.map((function(e){return r[e]})))}}]),e}();var i2=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).depth=25,e}return Jn(n,[{key:"index",value:function(e){if(e===J1)return 0;var t=r2.root(e),n=1+r2.quality(e)*$1+t;if(n>=this.depth)throw new n2("Chord is neither major nor minor: ".concat(e));return n}},{key:"encode",value:function(e){var t=this;return bm((function(){return ay(Ny([t.index(e)],"int32"),t.depth).as1D()}))}}]),n}(a2),o2=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).depth=49,e}return Jn(n,[{key:"index",value:function(e){if(e===J1)return 0;var t=r2.root(e),n=1+r2.quality(e)*$1+t;if(n>=this.depth)throw new n2("Chord is not a standard triad: ".concat(e));return n}},{key:"encode",value:function(e){var t=this;return bm((function(){return ay(Ny([t.index(e)],"int32"),t.depth).as1D()}))}}]),n}(a2),s2=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).depth=37,e}return Jn(n,[{key:"encode",value:function(e){var t=this;return bm((function(){if(e===J1)return ay(Ny([0],"int32"),t.depth).as1D();var n=r2.root(e),r=ay(Ny([n],"int32"),$1).as1D(),a=Pv([$1]);r2.pitches(e).forEach((function(e){return a.set(1,e)}));var i=a.toTensor().as1D(),o=r;return og([Ny([0]),r,i,o])}))}}]),n}(a2),u2=__webpack_require__(5842).tensorflow.magenta.NoteSequence;var c2=function(){if("undefined"!==typeof globalThis)return globalThis;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof __webpack_require__.g)return __webpack_require__.g;throw new Error("cannot find the global object")}(),l2=(c2.fetch.bind(c2),c2.performance,c2.navigator,!!c2.webkitOfflineAudioContext),h2="undefined"!==typeof c2.WorkerGlobalScope;var f2,d2="undefined"!==typeof __webpack_require__.g&&"undefined"!==typeof __webpack_require__.g.process,p2=d2?__webpack_require__(5359):window.fetch.bind(window),v2=d2?__webpack_require__(6075):window.performance;d2?__webpack_require__(4309):window.navigator;!function(e){e[e.NONE=0]="NONE",e[e.WARN=5]="WARN",e[e.INFO=10]="INFO",e[e.DEBUG=20]="DEBUG"}(f2||(f2={}));function m2(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"Magenta.js",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10;if(0===n)throw Error("Logging level cannot be NONE.");if(10>=n){var r=5===n?console.warn:console.log;r("%c ".concat(t," "),"background:magenta; color:white",e)}}function g2(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Magenta.js",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10,a=(v2.now()-t)/1e3;m2("".concat(e," in ").concat(a.toPrecision(3),"s"),n,r)}var y2=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,e),Object.setPrototypeOf(ir(r),(this instanceof n?this.constructor:void 0).prototype),r}return Jn(n)}(cr(Error)),b2=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,e),Object.setPrototypeOf(ir(r),(this instanceof n?this.constructor:void 0).prototype),r}return Jn(n)}(cr(Error)),x2=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,e),Object.setPrototypeOf(ir(r),(this instanceof n?this.constructor:void 0).prototype),r}return Jn(n)}(cr(Error)),k2=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,e),Object.setPrototypeOf(ir(r),(this instanceof n?this.constructor:void 0).prototype),r}return Jn(n)}(cr(Error)),w2=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),r=t.call(this,e),Object.setPrototypeOf(ir(r),(this instanceof n?this.constructor:void 0).prototype),r}return Jn(n)}(cr(Error));function _2(e){return u2.decode(u2.encode(e).finish())}function S2(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5,r=e*t;return Math.floor(r+(1-n))}function C2(e){return e.controlChanges.concat(e.textAnnotations)}function T2(e){if(e.tempos&&0!==e.tempos.length){if(e.tempos.sort((function(e,t){return e.time-t.time})),0!==e.tempos[0].time&&e.tempos[0].qpm!==Y1)throw new k2("NoteSequence has an implicit tempo change from initial "+"".concat(Y1," qpm to ")+"".concat(e.tempos[0].qpm," qpm at ").concat(e.tempos[0].time," seconds."));for(var t=1;t<e.tempos.length;t++)if(e.tempos[t].qpm!==e.tempos[0].qpm)throw new k2("NoteSequence has at least one tempo change from "+"".concat(e.tempos[0].qpm," qpm to ").concat(e.tempos[t].qpm)+"qpm at ".concat(e.tempos[t].time," seconds."))}}function E2(e,t){var n=_2(e);if(n.quantizationInfo=u2.QuantizationInfo.create({stepsPerQuarter:t}),n.timeSignatures.length>0){if(n.timeSignatures.sort((function(e,t){return e.time-t.time})),0!==n.timeSignatures[0].time&&(4!==n.timeSignatures[0].numerator||4!==n.timeSignatures[0].denominator))throw new y2("NoteSequence has an implicit change from initial 4/4 time "+"signature to ".concat(n.timeSignatures[0].numerator,"/")+"".concat(n.timeSignatures[0].denominator," at ")+"".concat(n.timeSignatures[0].time," seconds."));for(var r=1;r<n.timeSignatures.length;r++){var a=n.timeSignatures[r];if(a.numerator!==n.timeSignatures[0].numerator||a.denominator!==n.timeSignatures[0].denominator)throw new y2("NoteSequence has at least one time signature change from "+"".concat(n.timeSignatures[0].numerator,"/")+"".concat(n.timeSignatures[0].denominator," to ")+"".concat(a.numerator,"/").concat(a.denominator," ")+"at ".concat(a.time," seconds"))}n.timeSignatures[0].time=0,n.timeSignatures=[n.timeSignatures[0]]}else{var i=u2.TimeSignature.create({numerator:4,denominator:4,time:0});n.timeSignatures.push(i)}var o,s=n.timeSignatures[0];if(!(o=s.denominator)||0!==(o&o-1))throw new b2("Denominator is not a power of 2. Time signature: "+"".concat(s.numerator,"/").concat(s.denominator));if(0===s.numerator)throw new b2("Numerator is 0. Time signature: "+"".concat(s.numerator,"/").concat(s.denominator));if(n.tempos.length>0)T2(n),n.tempos[0].time=0,n.tempos=[n.tempos[0]];else{var u=u2.Tempo.create({qpm:Y1,time:0});n.tempos.push(u)}var c=function(e,t){return e*t/60}(t,n.tempos[0].qpm);return n.totalQuantizedSteps=S2(e.totalTime,c),function(e,t){var n,r=al(e.notes);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(a.quantizedStartStep=S2(a.startTime,t),a.quantizedEndStep=S2(a.endTime,t),a.quantizedEndStep===a.quantizedStartStep&&(a.quantizedEndStep+=1),a.quantizedStartStep<0||a.quantizedEndStep<0)throw new x2("Got negative note time: start_step = "+"".concat(a.quantizedStartStep,", end_step = ")+"".concat(a.quantizedEndStep));a.quantizedEndStep>e.totalQuantizedSteps&&(e.totalQuantizedSteps=a.quantizedEndStep)}}catch($Pe){r.e($Pe)}finally{r.f()}C2(e).forEach((function(e){if(e.quantizedStep=S2(e.time,t),e.quantizedStep<0)throw new x2("Got negative event time: step = ".concat(e.quantizedStep))}))}(n,c),n}function I2(e){return e.quantizationInfo&&(e.quantizationInfo.stepsPerQuarter>0||e.quantizationInfo.stepsPerSecond>0)}function A2(e){if(!I2(e))throw new w2("NoteSequence ".concat(e.id," is not quantized (missing quantizationInfo)"))}function M2(e){return e.quantizationInfo&&e.quantizationInfo.stepsPerQuarter>0}function N2(e){if(!M2(e))throw new w2("NoteSequence ".concat(e.id," is not quantized or is quantized based on absolute timing"))}function R2(e,t){N2(e),T2(e);var n=_2(e);t?n.tempos&&n.tempos.length>0?n.tempos[0].qpm=t:n.tempos.push(u2.Tempo.create({time:0,qpm:t})):t=e.tempos&&e.tempos.length>0?n.tempos[0].qpm:Y1;var r=function(e){return e/n.quantizationInfo.stepsPerQuarter*(60/t)};return n.totalTime=r(n.totalQuantizedSteps),n.notes.forEach((function(e){e.startTime=r(e.quantizedStartStep),e.endTime=r(e.quantizedEndStep),n.totalTime=Math.max(n.totalTime,e.endTime),delete e.quantizedStartStep,delete e.quantizedEndStep})),C2(n).forEach((function(e){e.time=r(e.time)})),delete n.totalQuantizedSteps,delete n.quantizationInfo,n}function D2(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:4,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Y1;return u2.create({quantizationInfo:{stepsPerQuarter:e},tempos:[{qpm:t}]})}var P2=function(){function e(t,n,r){$n(this,e),this.events=t,this.minPitch=n,this.maxPitch=r}return Jn(e,[{key:"toNoteSequence",value:function(e,t){for(var n=D2(e,t),r=null,a=0;a<this.events.length;++a){var i=this.events[a];switch(i){case 0:break;case 1:r&&(r.quantizedEndStep=a,n.notes.push(r),r=null);break;default:r&&(r.quantizedEndStep=a,n.notes.push(r)),r=u2.Note.create({pitch:i-2+this.minPitch,quantizedStartStep:a})}}return r&&(r.quantizedEndStep=this.events.length,n.notes.push(r)),n.totalQuantizedSteps=this.events.length,n}}],[{key:"fromNoteSequence",value:function(t,n,r){var a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=arguments.length>4?arguments[4]:void 0;A2(t);var o=t.notes.sort((function(e,t){return e.quantizedStartStep===t.quantizedStartStep?t.pitch-e.pitch:e.quantizedStartStep-t.quantizedStartStep})),s=new Int32Array(i||t.totalQuantizedSteps),u=-1;return o.forEach((function(e){if(e.quantizedStartStep===u){if(a)return;throw new Error("`NoteSequence` is not monophonic.")}if(e.pitch<n||e.pitch>r)throw Error("`NoteSequence` has a pitch outside of the valid range: "+"".concat(e.pitch));s[e.quantizedStartStep]=e.pitch-n+2,s[e.quantizedEndStep]=1,u=e.quantizedStartStep})),new e(s,n,r)}}]),e}(),O2=function(){function e(){$n(this,e),this.depth=1}return Jn(e,[{key:"extract",value:function(e){for(var t=e.events.length,n=Pv([t,1]),r=0;r<t;++r)n.set(e.events[r]>=2?1:0,r,0);return n.toTensor().as2D(t,1)}}]),e}(),L2=function(){function e(){$n(this,e),this.depth=3}return Jn(e,[{key:"extract",value:function(e){for(var t=e.events.length,n=Pv([t,3]),r=null,a=null,i=0;i<t;++i)if(e.events[i]>=2){if(null!==r){0===n.get(r,0)&&0===n.get(r,1)&&0===n.get(r,2)&&(r=-1);var o=void 0;o=e.events[i]<a?0:e.events[i]>a?2:1;for(var s=i;s>r;--s)n.set(1,s,o)}r=i,a=e.events[i]}if(r!==t-1)if(null===r||0===n.get(r,0)&&0===n.get(r,1)&&0===n.get(r,2))for(var u=0;u<t;++u)n.set(1,u,1);else for(var c=t-1;c>r;--c)for(var l=0;l<3;l++)n.set(n.get(r,l),c,l);return n.toTensor().as2D(t,3)}}]),e}(),F2=function(){function e(t,n,r,a,i){$n(this,e),this.events=t,this.maxShiftSteps=n,this.numVelocityBins=r,this.program=a,this.isDrum=i}return Jn(e,[{key:"getNumSteps",value:function(){return this.events.filter((function(e){return"time-shift"===e.type})).map((function(e){return e.steps})).reduce((function(e,t){return e+t}),0)}},{key:"setNumSteps",value:function(e){var t=this.getNumSteps();if(t<e){if(this.events.length){var n=this.events[this.events.length-1];if("time-shift"===n.type){var r=Math.min(e-t,this.maxShiftSteps-n.steps);n.steps+=r,t+=r}}for(;t<e;)t+this.maxShiftSteps>e?(this.events.push({type:"time-shift",steps:e-t}),t=e):(this.events.push({type:"time-shift",steps:this.maxShiftSteps}),t+=this.maxShiftSteps)}else if(t>e)for(;this.events.length&&t>e;){var a=this.events[this.events.length-1];"time-shift"===a.type?t-a.steps<e?(a.steps-=t-e,t=e):(this.events.pop(),t-=a.steps):this.events.pop()}}},{key:"toNoteSequence",value:function(e){for(var t=this,n=this.numVelocityBins?Math.ceil(127/this.numVelocityBins):void 0,r=u2.create(),a=0,i=void 0,o=new Map,s=0;s<=127;++s)o.set(s,[]);var u,c=al(this.events);try{for(c.s();!(u=c.n()).done;){var l=u.value;switch(l.type){case"note-on":o.get(l.pitch).push([a,i]);break;case"note-off":var h=o.get(l.pitch);if(h.length){var d=f(h.shift(),2),p=d[0],v=d[1];a>p?r.notes.push(u2.Note.create({pitch:l.pitch,velocity:v,instrument:e,quantizedStartStep:p,quantizedEndStep:a,program:this.program,isDrum:this.isDrum})):m2("Ignoring zero-length note: "+"(pitch = ".concat(l.pitch,", step = ").concat(a,")"),"Performance")}else m2("Ignoring note-off with no previous note-on:"+"(pitch = ".concat(l.pitch,", step = ").concat(a,")"),"Performance");break;case"time-shift":a+=l.steps;break;case"velocity-change":if(!n)throw new Error("Unexpected velocity change event: ".concat(l));i=0+(l.velocityBin-1)*n+1;break;default:throw new Error("Unrecognized performance event: ".concat(l))}}}catch($Pe){c.e($Pe)}finally{c.f()}return o.forEach((function(n,i){var o,s=al(n);try{for(s.s();!(o=s.n()).done;){var u=f(o.value,2),c=u[0],l=u[1];a>c?r.notes.push(u2.Note.create({pitch:i,velocity:l,instrument:e,quantizedStartStep:c,quantizedEndStep:a,program:t.program,isDrum:t.isDrum})):m2("Ignoring zero-length note: "+"(pitch = ".concat(i,", step = ").concat(a,")"),"Performance")}}catch($Pe){s.e($Pe)}finally{s.f()}})),r.totalQuantizedSteps=a,r}}],[{key:"fromNoteSequence",value:function(t,n,r,a){A2(t);var i,o=t.notes.filter((function(e,t){return void 0===a||e.instrument===a})),s=o.sort((function(e,t){return e.startTime===t.startTime?e.pitch-t.pitch:e.startTime-t.startTime})),u=s.map((function(e,t){return{step:e.quantizedStartStep,index:t,isOffset:0}})),c=s.map((function(e,t){return{step:e.quantizedEndStep,index:t,isOffset:1}})),l=u.concat(c).sort((function(e,t){return e.step===t.step?e.index===t.index?e.isOffset-t.isOffset:e.index-t.index:e.step-t.step})),h=r?Math.ceil(127/r):void 0,f=[],d=0,p=r,v=al(l);try{for(v.s();!(i=v.n()).done;){var m=i.value;if(m.step>d){for(;m.step>d+n;)f.push({type:"time-shift",steps:n}),d+=n;f.push({type:"time-shift",steps:m.step-d}),d=m.step}if(m.isOffset)f.push({type:"note-off",pitch:s[m.index].pitch});else{if(h){var g=Math.floor((s[m.index].velocity-0-1)/h)+1;g!==p&&(f.push({type:"velocity-change",velocityBin:g}),p=g)}f.push({type:"note-on",pitch:s[m.index].pitch})}}}catch($Pe){v.e($Pe)}finally{v.f()}var y=!!o.some((function(e){return e.isDrum}))&&(!o.some((function(e){return!e.isDrum}))||void 0),b=Array.from(new Set(o.map((function(e){return e.program})))),x=new e(f,n,r,y||1!==b.length?void 0:b[0],y);return x.setNumSteps(t.totalQuantizedSteps),x}}]),e}();var z2=function(){function e(t){$n(this,e),this.NUM_SPLITS=0,this.SEGMENTED_BY_TRACK=!1,this.numSteps=t.numSteps,this.numSegments=t.numSegments}return Jn(e,[{key:"tensorSteps",value:function(e){return _m(e.shape[0],"int32")}}]),e}(),B2=function(e){tr(n,e);var t=sr(n);function n(e){var r;$n(this,n),(r=t.call(this,e)).pitchClasses=e.pitchClasses||Q1,r.pitchToClass=new Map;for(var a=function(e){r.pitchClasses[e].forEach((function(t){r.pitchToClass.set(t,e)}))},i=0;i<r.pitchClasses.length;++i)a(i);return r.depth=r.pitchClasses.length+1,r}return Jn(n,[{key:"toTensor",value:function(e){var t=this;A2(e);for(var n=this.numSteps||e.totalQuantizedSteps,r=Pv([n,this.pitchClasses.length+1],"int32"),a=0;a<n;++a)r.set(1,a,-1);return e.notes.forEach((function(e){r.set(1,e.quantizedStartStep,t.pitchToClass.get(e.pitch)),r.set(0,e.quantizedStartStep,-1)})),r.toTensor()}},{key:"toNoteSequence",value:function(){var e=ns(es().mark((function e(t,n,r){var a,i,o,s,u;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=D2(n,r),i=t.argMax(1),e.next=4,i.data();case 4:for(o=e.sent,i.dispose(),s=0;s<o.length;++s)for(u=0;u<this.pitchClasses.length;u++)o[s]>>u&1&&a.notes.push(u2.Note.create({pitch:this.pitchClasses[u][0],quantizedStartStep:s,quantizedEndStep:s+1,isDrum:!0}));return a.totalQuantizedSteps=o.length,e.abrupt("return",a);case 9:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(z2),U2=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"toNoteSequence",value:function(){var e=ns(es().mark((function e(t,n,r){var a,i,o,s,u;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=D2(n,r),e.next=3,t.data();case 3:for(i=e.sent,o=0;o<t.shape[0];++o)for(s=i.slice(o*this.pitchClasses.length,(o+1)*this.pitchClasses.length),u=0;u<s.length;++u)s[u]&&a.notes.push(u2.Note.create({pitch:this.pitchClasses[u][0],quantizedStartStep:o,quantizedEndStep:o+1,isDrum:!0}));return a.totalQuantizedSteps=t.shape[0],e.abrupt("return",a);case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(B2),V2=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).depth=Math.pow(2,r.pitchClasses.length),r}return Jn(n,[{key:"toTensor",value:function(e){var t=this;N2(e);var n,r=this.numSteps||e.totalQuantizedSteps,a=Array(r).fill(0),i=al(e.notes);try{for(i.s();!(n=i.n()).done;){var o=n.value,s=o.pitch,u=o.quantizedStartStep;a[u]+=Math.pow(2,this.pitchToClass.get(s))}}catch($Pe){i.e($Pe)}finally{i.f()}return bm((function(){return ay(Ny(a,"int32"),t.depth)}))}}]),n}(B2),W2=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).NOTE_OFF=1,r.FIRST_PITCH=2,r.minPitch=e.minPitch,r.maxPitch=e.maxPitch,r.ignorePolyphony=e.ignorePolyphony,r.depth=e.maxPitch-e.minPitch+1+r.FIRST_PITCH,r}return Jn(n,[{key:"toTensor",value:function(e){var t=this,n=P2.fromNoteSequence(e,this.minPitch,this.maxPitch,this.ignorePolyphony,this.numSteps);return bm((function(){return ay(Rp(n.events,[n.events.length],"int32"),t.depth)}))}},{key:"toNoteSequence",value:function(){var e=ns(es().mark((function e(t,n,r){var a,i,o;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.argMax(1),e.next=3,a.data();case 3:return i=e.sent,a.dispose(),o=new P2(i,this.minPitch,this.maxPitch),e.abrupt("return",o.toNoteSequence(n,r));case 7:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(z2),G2=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this,e)).minPitch=e.minPitch,a.maxPitch=e.maxPitch,a.ignorePolyphony=e.ignorePolyphony,a.melodyControl=r,a.depth=r.depth,a}return Jn(n,[{key:"toTensor",value:function(e){var t=P2.fromNoteSequence(e,this.minPitch,this.maxPitch,this.ignorePolyphony,this.numSteps);return this.melodyControl.extract(t)}}]),n}(z2),j2=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e,new O2)}return Jn(n,[{key:"toNoteSequence",value:function(){var e=ns(es().mark((function e(t,n,r){var a,i,o;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=D2(n,r),e.next=3,t.data();case 3:for(i=e.sent,o=0;o<i.length;++o)i[o]&&a.notes.push(u2.Note.create({pitch:Q1[1][0],quantizedStartStep:o,quantizedEndStep:o+1,isDrum:!0}));return a.totalQuantizedSteps=i.length,e.abrupt("return",a);case 7:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(G2),q2=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e,new L2)}return Jn(n,[{key:"toNoteSequence",value:function(){var e=ns(es().mark((function e(t,n,r){var a,i,o,s,u;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=D2(n,r),i=t.argMax(1),e.next=4,i.data();case 4:o=e.sent,i.dispose(),s=Math.round((this.maxPitch+this.minPitch)/2),u=0;case 8:if(!(u<o.length)){e.next=23;break}e.t0=o[u],e.next=0===e.t0?12:2===e.t0?15:18;break;case 12:return(s-=1)<this.minPitch&&(s=this.minPitch,m2("Pitch range exceeded when creating NoteSequence from shape.","MelodyShapeConverter")),e.abrupt("break",19);case 15:return(s+=1)>this.maxPitch&&(s=this.maxPitch,m2("Pitch range exceeded when creating NoteSequence from shape.","MelodyShapeConverter")),e.abrupt("break",19);case 18:return e.abrupt("break",19);case 19:a.notes.push(u2.Note.create({pitch:s,quantizedStartStep:u,quantizedEndStep:u+1}));case 20:++u,e.next=8;break;case 23:return a.totalQuantizedSteps=o.length,e.abrupt("return",a);case 25:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(G2),H2=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).NUM_SPLITS=3,r.MEL_PROG_RANGE=[0,31],r.BASS_PROG_RANGE=[32,39],e.melArgs.numSteps=e.numSteps,e.bassArgs.numSteps=e.numSteps,e.drumsArgs.numSteps=e.numSteps,r.melConverter=new W2(e.melArgs),r.bassConverter=new W2(e.bassArgs),r.drumsConverter=new V2(e.drumsArgs),r.depth=r.melConverter.depth+r.bassConverter.depth+r.drumsConverter.depth,r}return Jn(n,[{key:"toTensor",value:function(e){var t=this;A2(e);var n=_2(e),r=_2(e),a=_2(e);return n.notes=e.notes.filter((function(e){return!e.isDrum&&e.program>=t.MEL_PROG_RANGE[0]&&e.program<=t.MEL_PROG_RANGE[1]})),r.notes=e.notes.filter((function(e){return!e.isDrum&&e.program>=t.BASS_PROG_RANGE[0]&&e.program<=t.BASS_PROG_RANGE[1]})),a.notes=e.notes.filter((function(e){return e.isDrum})),bm((function(){return Xm([t.melConverter.toTensor(n),t.bassConverter.toTensor(r),t.drumsConverter.toTensor(a)],-1)}))}},{key:"toNoteSequence",value:function(){var e=ns(es().mark((function e(t,n,r){var a,i,o,s,u,c,l=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=Ey(t,[this.melConverter.depth,this.bassConverter.depth,this.drumsConverter.depth],-1),e.next=3,this.melConverter.toNoteSequence(o[0],n,r);case 3:return(s=e.sent).notes.forEach((function(e){e.instrument=0,e.program=0})),e.next=7,this.bassConverter.toNoteSequence(o[1],n,r);case 7:return u=e.sent,(a=s.notes).push.apply(a,Tt(u.notes.map((function(e){return e.instrument=1,e.program=l.BASS_PROG_RANGE[0],e})))),e.next=11,this.drumsConverter.toNoteSequence(o[2],n,r);case 11:return c=e.sent,(i=s.notes).push.apply(i,Tt(c.notes.map((function(e){return e.instrument=2,e})))),o.forEach((function(e){return e.dispose()})),e.abrupt("return",s);case 15:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(z2),X2=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).NUM_SPLITS=3,r.trioConverter=new H2(e),r.depth=3,r}return Jn(n,[{key:"toTensor",value:function(e){var t=this;return bm((function(){var n=t.trioConverter.toTensor(e),r=Ey(n,[t.trioConverter.melConverter.depth,t.trioConverter.bassConverter.depth,t.trioConverter.drumsConverter.depth],1),a=Am(r[0],1),i=Am(r[1],1),o=Am(r[2],1),s=Ig(a,1),u=Ig(i,1),c=Ig(o,0);return My([s,u,c],1)}))}},{key:"toNoteSequence",value:function(){var e=ns(es().mark((function e(t,n,r){var a,i,o,s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=Ey(t,3,1),e.next=3,Promise.all(a.map((function(e){return e.data()})));case 3:for(i=e.sent,o=D2(n,r),s=0;s<this.numSteps;++s)i[0][s]&&o.notes.push(u2.Note.create({pitch:72,quantizedStartStep:s,quantizedEndStep:s+1,instrument:0,program:0})),i[1][s]&&o.notes.push(u2.Note.create({pitch:36,quantizedStartStep:s,quantizedEndStep:s+1,instrument:1,program:32})),i[2][s]&&o.notes.push(u2.Note.create({pitch:Q1[1][0],quantizedStartStep:s,quantizedEndStep:s+1,instrument:2,isDrum:!0}));return o.totalQuantizedSteps=this.numSteps,e.abrupt("return",o);case 8:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()}]),n}(z2),K2=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).SEGMENTED_BY_TRACK=!0,r.stepsPerQuarter=e.stepsPerQuarter,r.totalSteps=e.totalSteps,r.numVelocityBins=e.numVelocityBins,r.minPitch=e.minPitch?e.minPitch:0,r.maxPitch=e.maxPitch?e.maxPitch:127,r.numPitches=r.maxPitch-r.minPitch+1,r.performanceEventDepth=2*r.numPitches+r.totalSteps+r.numVelocityBins,r.numPrograms=129,r.endToken=r.performanceEventDepth+r.numPrograms,r.depth=r.endToken+1,r.endTensor=bm((function(){return ay(Ny([r.endToken],"int32"),r.depth).as1D()})),r}return Jn(n,[{key:"trackToTensor",value:function(e){var t=this,n=this.numSteps/this.numSegments,r=void 0;if(e){for(;e.events.length>n-2;)e.events.pop();(r=Pv([e.events.length+2],"int32")).set(this.performanceEventDepth+(e.isDrum?this.numPrograms-1:e.program),0),e.events.forEach((function(e,n){switch(e.type){case"note-on":r.set(e.pitch-t.minPitch,n+1);break;case"note-off":r.set(t.numPitches+e.pitch-t.minPitch,n+1);break;case"time-shift":r.set(2*t.numPitches+e.steps-1,n+1);break;case"velocity-change":r.set(2*t.numPitches+t.totalSteps+e.velocityBin-1,n+1);break;default:throw new Error("Unrecognized performance event: ".concat(e))}})),r.set(this.endToken,e.events.length+1)}else r=Pv([1],"int32",new Int32Array([this.endToken]));return bm((function(){var e=ay(r.toTensor(),t.depth);return e.pad([[0,n-e.shape[0]],[0,0]])}))}},{key:"toTensor",value:function(e){var t=this;if(N2(e),e.quantizationInfo.stepsPerQuarter!==this.stepsPerQuarter)throw new Error("Steps per quarter note mismatch: ".concat(e.quantizationInfo.stepsPerQuarter," != ").concat(this.stepsPerQuarter));var n=_2(e);n.notes=e.notes.filter((function(e){return e.pitch>=t.minPitch&&e.pitch<=t.maxPitch}));for(var r=new Set(n.notes.map((function(e){return e.instrument}))),a=Array.from(r).map((function(e){return F2.fromNoteSequence(n,t.totalSteps,t.numVelocityBins,e)})).sort((function(e,t){return t.isDrum?-1:e.isDrum?1:e.program-t.program}));a.length>this.numSegments;)a.pop();for(a.forEach((function(e){return e.setNumSteps(t.totalSteps)}));a.length<this.numSegments;)a.push(void 0);return bm((function(){return Xm(a.map((function(e){return t.trackToTensor(e)})),0)}))}},{key:"tokensToTrack",value:function(e){var t=this,n=e.indexOf(this.endToken),r=n>=0?n:e.length,a=e.slice(0,r),i=a.filter((function(e){return e<t.performanceEventDepth})),o=a.filter((function(e){return e>=t.performanceEventDepth})),s=f(o.length?o[0]-this.performanceEventDepth<this.numPrograms-1?[o[0]-this.performanceEventDepth,!1]:[0,!0]:[0,!1],2),u=s[0],c=s[1],l=Array.from(i).map((function(e){if(e<t.numPitches)return{type:"note-on",pitch:t.minPitch+e};if(e<2*t.numPitches)return{type:"note-off",pitch:t.minPitch+e-t.numPitches};if(e<2*t.numPitches+t.totalSteps)return{type:"time-shift",steps:e-2*t.numPitches+1};if(e<2*t.numPitches+t.totalSteps+t.numVelocityBins)return{type:"velocity-change",velocityBin:e-2*t.numPitches-t.totalSteps+1};throw new Error("Invalid performance event token: ".concat(e))}));return new F2(l,this.totalSteps,this.numVelocityBins,u,c)}},{key:"toNoteSequence",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o=this,s=arguments;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=s.length>1&&void 0!==s[1]?s[1]:this.stepsPerQuarter,r=s.length>2?s[2]:void 0,(a=D2(n,r)).totalQuantizedSteps=this.totalSteps,i=bm((function(){return Ey(t.argMax(1),o.numSegments)})),e.next=7,Promise.all(i.map(function(){var e=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.data();case 2:return n=e.sent,r=o.tokensToTrack(n),t.dispose(),e.abrupt("return",r);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 7:return e.sent.forEach((function(e,t){var n;e.setNumSteps(o.totalSteps),(n=a.notes).push.apply(n,Tt(e.toNoteSequence(t).notes))})),e.abrupt("return",a);case 10:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),n}(z2),Y2=function(e){tr(n,e);var t=sr(n);function n(e){var r;$n(this,n),(r=t.call(this,e)).TAPIFY_CHANNEL=3,r.stepsPerQuarter=e.stepsPerQuarter||4,r.pitchClasses=e.pitchClasses||Q1,r.pitchToClass=new Map;for(var a=function(e){r.pitchClasses[e].forEach((function(t){r.pitchToClass.set(t,e)}))},i=0;i<r.pitchClasses.length;++i)a(i);return r.humanize=e.humanize||!1,r.tapify=e.tapify||!1,r.splitInstruments=e.splitInstruments||!1,r.depth=3,r}return Jn(n,[{key:"toTensor",value:function(e){for(var t=this,n=M2(e)?e:E2(e,this.stepsPerQuarter),r=this.numSteps,a=n.tempos&&n.tempos.length?n.tempos[0].qpm:Y1,i=60/a/this.stepsPerQuarter,o=[],s=0;s<r;++s)o.push(new Map);n.notes.forEach((function(e){if(t.tapify||t.pitchToClass.has(e.pitch)){var n=e.quantizedStartStep;if(n>=o.length)throw Error("Model does not support sequences with more than ".concat(r," steps (").concat(r*i," seconds at qpm ").concat(a,")."));var s=t.tapify?t.TAPIFY_CHANNEL:t.pitchToClass.get(e.pitch);(!o[n].has(s)||o[n].get(s).velocity<e.velocity)&&o[n].set(s,e)}}));var u=this.pitchClasses.length,c=Pv([r,u]),l=Pv([r,u]),h=Pv([r,u]);function f(e){if(void 0===e.startTime)return 0;var t=e.startTime;return 2*(e.quantizedStartStep*i-t)/i}for(var d=0;d<r;++d)for(var p=0;p<u;++p){var v=o[d].get(p);c.set(v?1:0,d,p),this.humanize||this.tapify||l.set(v?v.velocity/Z1:0,d,p),this.humanize||h.set(v?f(v):0,d,p)}return bm((function(){var e=c.toTensor(),n=l.toTensor(),a=h.toTensor(),i=t.splitInstruments?r*u:r;return Xm([e.as2D(i,-1),n.as2D(i,-1),a.as2D(i,-1)],1)}))}},{key:"toNoteSequence",value:function(){var e=ns(es().mark((function e(t,n){var r,a,i,o,s,u,c,l,h,f,d,p,v,m,g,y,b,x=arguments;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=function(e,t,n){return Math.min(Math.max(e,t),n)},r=x.length>2&&void 0!==x[2]?x[2]:Y1,!n||n===this.stepsPerQuarter){e.next=4;break}throw Error("`stepsPerQuarter` is set by the model.");case 4:return n=this.stepsPerQuarter,a=this.splitInstruments?t.shape[0]/this.pitchClasses.length:t.shape[0],i=60/r/this.stepsPerQuarter,o=u2.create({totalTime:a*i,tempos:[{qpm:r}]}),e.next=10,t.data();case 10:for(s=e.sent,c=this.pitchClasses.length,l=0;l<a;++l)for(h=s.slice(l*c*this.depth,(l+1)*c*this.depth),f=0;f<c;++f)d=h[this.splitInstruments?f*this.depth:f],p=this.splitInstruments?f*this.depth+1:c+f,v=h[p],m=this.splitInstruments?f*this.depth+2:2*c+f,g=h[m],d>.5&&(y=u(Math.round(v*Z1),0,Z1),b=u(g/2,-.5,.5),o.notes.push(u2.Note.create({pitch:this.pitchClasses[f][0],startTime:(l-b)*i,endTime:(l-b+1)*i,velocity:y,isDrum:!0})));return e.abrupt("return",o);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()}]),n}(z2),Q2="14.7.77",Z2=__webpack_require__(8667),J2=new WeakSet,$2=new WeakMap,e3=new WeakMap,t3=new WeakMap,n3=new WeakMap,r3=new WeakMap,a3=new WeakMap,i3=new WeakMap,o3=new WeakMap,s3=new WeakMap,u3={construct:function(){return u3}},c3=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,l3=function(e,t){for(var n=[],r=e.replace(/^[\s]+/,""),a=r.match(c3);null!==a;){var i=a[1].slice(1,-1),o=a[0].replace(/([\s]+)?;?$/,"").replace(i,new URL(i,t).toString());n.push(o),a=(r=r.slice(a[0].length).replace(/^[\s]+/,"")).match(c3)}return[n.join(";"),r]},h3=function(e){if(void 0!==e&&!Array.isArray(e))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},f3=function(e){if(!function(e){try{new new Proxy(e,u3)}catch(t){return!1}return!0}(e))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===e.prototype||"object"!==typeof e.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},d3=function(e,t){var n=e.get(t);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},p3=function(e,t){var n=Array.from(e).filter(t);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");var r=f(n,1)[0];return e.delete(r),r},v3=function(e,t,n,r){var a=d3(e,t),i=p3(a,(function(e){return e[0]===n&&e[1]===r}));return 0===a.size&&e.delete(t),i},m3=function(e){return d3(a3,e)},g3=function(e){if(J2.has(e))throw new Error("The AudioNode is already stored.");J2.add(e),m3(e).forEach((function(e){return e(!0)}))},y3=function(e){return"port"in e},b3=function(e){if(!J2.has(e))throw new Error("The AudioNode is not stored.");J2.delete(e),m3(e).forEach((function(e){return e(!1)}))},x3=function(e,t){!y3(e)&&t.every((function(e){return 0===e.size}))&&b3(e)};function k3(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w3(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k3(Object(n),!0).forEach((function(t){IE(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k3(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var _3={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},S3=function(e,t){return e.context===t},C3=function(e){try{e.copyToChannel(new Float32Array(1),0,-1)}catch(t){return!1}return!0},T3=function(){return new DOMException("","IndexSizeError")},E3=function(e){var t;e.getChannelData=(t=e.getChannelData,function(n){try{return t.call(e,n)}catch($Pe){if(12===$Pe.code)throw T3();throw $Pe}})},I3={numberOfChannels:1},A3=-34028234663852886e22,M3=-A3,N3=function(e){return J2.has(e)},R3={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},D3=function(e){return d3($2,e)},P3=function(e){return d3(t3,e)},O3=function e(t,n){D3(t).activeInputs.forEach((function(r){return r.forEach((function(r){var a=f(r,1)[0];n.includes(t)||e(a,[].concat(Tt(n),[t]))}))}));var r,a=al(function(e){return"playbackRate"in e}(t)?[t.playbackRate]:y3(t)?Array.from(t.parameters.values()):function(e){return"frequency"in e&&"gain"in e}(t)?[t.Q,t.detune,t.frequency,t.gain]:function(e){return"offset"in e}(t)?[t.offset]:function(e){return!("frequency"in e)&&"gain"in e}(t)?[t.gain]:function(e){return"detune"in e&&"frequency"in e}(t)?[t.detune,t.frequency]:function(e){return"pan"in e}(t)?[t.pan]:[]);try{for(a.s();!(r=a.n()).done;){var i=r.value,o=P3(i);void 0!==o&&o.activeInputs.forEach((function(t){var r=f(t,1)[0];return e(r,n)}))}}catch($Pe){a.e($Pe)}finally{a.f()}N3(t)&&b3(t)},L3=function(e){O3(e.destination,[])},F3=function(e){return void 0===e||"number"===typeof e||"string"===typeof e&&("balanced"===e||"interactive"===e||"playback"===e)},z3=function(e){return"context"in e},B3=function(e){return z3(e[0])},U3=function(e,t,n,r){var a,i=al(e);try{for(i.s();!(a=i.n()).done;){if(n(a.value)){if(r)return!1;throw Error("The set contains at least one similar element.")}}}catch($Pe){i.e($Pe)}finally{i.f()}return e.add(t),!0},V3=function(e,t,n,r){var a=f(n,2),i=a[0],o=a[1];U3(e,[t,i,o],(function(e){return e[0]===t&&e[1]===i}),r)},W3=function(e,t,n){var r=f(t,3),a=r[0],i=r[1],o=r[2],s=e.get(a);void 0===s?e.set(a,new Set([[i,o]])):U3(s,[i,o],(function(e){return e[0]===i}),n)},G3=function(e){return"inputs"in e},j3=function(e,t,n,r){if(G3(t)){var a=t.inputs[r];return e.connect(a,n,0),[a,n,0]}return e.connect(t,n,r),[t,n,r]},q3=function(e,t,n){var r,a=al(e);try{for(a.s();!(r=a.n()).done;){var i=r.value;if(i[0]===t&&i[1]===n)return e.delete(i),i}}catch($Pe){a.e($Pe)}finally{a.f()}return null},H3=function(e,t){if(!m3(e).delete(t))throw new Error("Missing the expected event listener.")},X3=function(e,t,n){var r=d3(e,t),a=p3(r,(function(e){return e[0]===n}));return 0===r.size&&e.delete(t),a},K3=function(e,t,n,r){G3(t)?e.disconnect(t.inputs[r],n,0):e.disconnect(t,n,r)},Y3=function(e){return d3(e3,e)},Q3=function(e){return d3(n3,e)},Z3=function(e){return i3.has(e)},J3=function(e){return!J2.has(e)},$3=function(e,t){return new Promise((function(n){if(null!==t)n(!0);else{var r=e.createScriptProcessor(256,1,1),a=e.createGain(),i=e.createBuffer(1,2,44100),o=i.getChannelData(0);o[0]=1,o[1]=1;var s=e.createBufferSource();s.buffer=i,s.loop=!0,s.connect(r).connect(e.destination),s.connect(a),s.disconnect(a),r.onaudioprocess=function(t){var a=t.inputBuffer.getChannelData(0);Array.prototype.some.call(a,(function(e){return 1===e}))?n(!0):n(!1),s.stop(),r.onaudioprocess=null,s.disconnect(r),r.disconnect(e.destination)},s.start()}}))},e4=function(e,t){var n,r=new Map,a=al(e);try{for(a.s();!(n=a.n()).done;){var i,o=al(n.value);try{for(o.s();!(i=o.n()).done;){var s=i.value,u=r.get(s);r.set(s,void 0===u?1:u+1)}}catch($Pe){o.e($Pe)}finally{o.f()}}}catch($Pe){a.e($Pe)}finally{a.f()}r.forEach((function(e,n){return t(n,e)}))},t4=function(e){return"context"in e},n4=function(e){var t,n,r=new Map;e.connect=(t=e.connect.bind(e),function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=t4(e)?t(e,n,a):t(e,n),o=r.get(e);return void 0===o?r.set(e,[{input:a,output:n}]):o.every((function(e){return e.input!==a||e.output!==n}))&&o.push({input:a,output:n}),i}),e.disconnect=(n=e.disconnect,function(t,a,i){if(n.apply(e),void 0===t)r.clear();else if("number"===typeof t){var o,s=al(r);try{for(s.s();!(o=s.n()).done;){var u=f(o.value,2),c=u[0],l=u[1].filter((function(e){return e.output!==t}));0===l.length?r.delete(c):r.set(c,l)}}catch($Pe){s.e($Pe)}finally{s.f()}}else if(r.has(t))if(void 0===a)r.delete(t);else{var h=r.get(t);if(void 0!==h){var d=h.filter((function(e){return e.output!==a&&(e.input!==i||void 0===i)}));0===d.length?r.delete(t):r.set(t,d)}}var p,v=al(r);try{var m=function(){var t=f(p.value,2),n=t[0];t[1].forEach((function(t){t4(n)?e.connect(n,t.output,t.input):e.connect(n,t.output)}))};for(v.s();!(p=v.n()).done;)m()}catch($Pe){v.e($Pe)}finally{v.f()}})},r4=function(e,t,n,r){var a=P3(t),i=a.activeInputs,o=a.passiveInputs,s=D3(e).outputs,u=m3(e),c=function(a){var s=Y3(e),u=Q3(t);if(a){var c=X3(o,e,n);V3(i,e,c,!1),r||Z3(e)||s.connect(u,n)}else{var l=function(e,t,n){return p3(e,(function(e){return e[0]===t&&e[1]===n}))}(i,e,n);W3(o,l,!1),r||Z3(e)||s.disconnect(u,n)}};return!!U3(s,[t,n],(function(e){return e[0]===t&&e[1]===n}),!0)&&(u.add(c),N3(e)?V3(i,e,[n,c],!0):W3(o,[e,n,c],!0),!0)},a4=function(e,t,n,r,a){var i=function(e,t,n,r){var a=D3(t),i=a.activeInputs,o=a.passiveInputs,s=q3(i[r],e,n);return null===s?[v3(o,e,n,r)[2],!1]:[s[2],!0]}(e,n,r,a),o=f(i,2),s=o[0],u=o[1];if(null!==s&&(H3(e,s),!u||t||Z3(e)||K3(Y3(e),Y3(n),r,a)),N3(n)){var c=D3(n).activeInputs;x3(n,c)}},i4=function(e,t,n,r){var a=function(e,t,n){var r=P3(t),a=r.activeInputs,i=r.passiveInputs,o=q3(a,e,n);return null===o?[X3(i,e,n)[1],!1]:[o[2],!0]}(e,n,r),i=f(a,2),o=i[0],s=i[1];null!==o&&(H3(e,o),!s||t||Z3(e)||Y3(e).disconnect(Q3(n),r))},o4=function(){function e(t){$n(this,e),this._map=new Map(t)}return Jn(e,[{key:"size",get:function(){return this._map.size}},{key:"entries",value:function(){return this._map.entries()}},{key:"forEach",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._map.forEach((function(r,a){return e.call(n,r,a,t)}))}},{key:"get",value:function(e){return this._map.get(e)}},{key:"has",value:function(e){return this._map.has(e)}},{key:"keys",value:function(){return this._map.keys()}},{key:"values",value:function(){return this._map.values()}}]),e}(),s4={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}};function u4(e,t,n,r,a){if("function"===typeof e.copyFromChannel)0===t[n].byteLength&&(t[n]=new Float32Array(128)),e.copyFromChannel(t[n],r,a);else{var i=e.getChannelData(r);if(0===t[n].byteLength)t[n]=i.slice(a,a+128);else{var o=new Float32Array(i.buffer,a*Float32Array.BYTES_PER_ELEMENT,128);t[n].set(o)}}}var c4=function(e,t,n,r,a){"function"===typeof e.copyToChannel?0!==t[n].byteLength&&e.copyToChannel(t[n],r,a):0!==t[n].byteLength&&e.getChannelData(r).set(t[n],a)},l4=function(e,t){for(var n=[],r=0;r<e;r+=1){for(var a=[],i="number"===typeof t?t:t[r],o=0;o<i;o+=1)a.push(new Float32Array(128));n.push(a)}return n},h4=function(e,t){var n=d3(s3,e),r=Y3(t);return d3(n,r)},f4=function(){var e=ns(es().mark((function e(t,n,r,a,i,o,s){var u,c,l,h,f,d,p,v,m,g,y;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(u=null===n?128*Math.ceil(t.context.length/128):n.length,c=a.channelCount*a.numberOfInputs,l=i.reduce((function(e,t){return e+t}),0),h=0===l?null:r.createBuffer(l,u,r.sampleRate),void 0!==o){e.next=6;break}throw new Error("Missing the processor constructor.");case 6:return f=D3(t),e.next=9,h4(r,t);case 9:d=e.sent,p=l4(a.numberOfInputs,a.channelCount),v=l4(a.numberOfOutputs,i),m=Array.from(t.parameters.keys()).reduce((function(e,t){return w3(w3({},e),{},IE({},t,new Float32Array(128)))}),{}),g=function(e){if(a.numberOfInputs>0&&null!==n)for(var u=0;u<a.numberOfInputs;u+=1)for(var l=0;l<a.channelCount;l+=1)u4(n,p[u],l,l,e);void 0!==o.parameterDescriptors&&null!==n&&o.parameterDescriptors.forEach((function(t,r){var a=t.name;u4(n,m,a,c+r,e)}));for(var g=0;g<a.numberOfInputs;g+=1)for(var y=0;y<i[g];y+=1)0===v[g][y].byteLength&&(v[g][y]=new Float32Array(128));try{var b=p.map((function(e,t){return 0===f.activeInputs[t].size?[]:e})),x=s(e/r.sampleRate,r.sampleRate,(function(){return d.process(b,v,m)}));if(null!==h)for(var k=0,w=0;k<a.numberOfOutputs;k+=1){for(var _=0;_<i[k];_+=1)c4(h,v[k],_,w+_,e);w+=i[k]}if(!x)return"break"}catch(S){return t.dispatchEvent(new ErrorEvent("processorerror",{colno:S.colno,filename:S.filename,lineno:S.lineno,message:S.message})),"break"}},y=0;case 15:if(!(y<u)){e.next=22;break}if("break"!==g(y)){e.next=19;break}return e.abrupt("break",22);case 19:y+=128,e.next=15;break;case 22:return e.abrupt("return",h);case 23:case"end":return e.stop()}}),e)})));return function(t,n,r,a,i,o,s){return e.apply(this,arguments)}}(),d4={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},p4={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},v4={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},m4={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},g4={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},y4=function(e){var t=new MessageChannel,n=t.port1,r=t.port2;return new Promise((function(t){var a=function(){r.onmessage=null,n.close(),r.close(),t()};r.onmessage=function(){return a()};try{n.postMessage(e,[e])}finally{a()}}))},b4={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},x4=function(e,t,n){var r=t[n];if(void 0===r)throw e();return r},k4={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},w4={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},_4=function(){return new DOMException("","InvalidStateError")},S4=function(){return new DOMException("","InvalidAccessError")},C4={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},T4=function(e,t,n,r,a,i,o,s,u,c,l){for(var h=c.length,f=s,d=0;d<h;d+=1){for(var p=n[0]*c[d],v=1;v<a;v+=1){var m=f-v&u-1;p+=n[v]*i[m],p-=e[v]*o[m]}for(var g=a;g<r;g+=1)p+=n[g]*i[f-g&u-1];for(var y=a;y<t;y+=1)p-=e[y]*o[f-y&u-1];i[f]=c[d],o[f]=p,f=f+1&u-1,l[d]=p}return f},E4=function(e,t,n,r){var a=n instanceof Float64Array?n:new Float64Array(n),i=r instanceof Float64Array?r:new Float64Array(r),o=a.length,s=i.length,u=Math.min(o,s);if(1!==a[0]){for(var c=0;c<o;c+=1)i[c]/=a[0];for(var l=1;l<s;l+=1)a[l]/=a[0]}for(var h=new Float32Array(32),f=new Float32Array(32),d=t.createBuffer(e.numberOfChannels,e.length,e.sampleRate),p=e.numberOfChannels,v=0;v<p;v+=1){var m=e.getChannelData(v),g=d.getChannelData(v);h.fill(0),f.fill(0),T4(a,o,i,s,u,h,f,0,32,m,g)}return d},I4=function(){var e=ns(es().mark((function e(t,n,r,a,i,o,s,u,c,l,h,f,d,p,v,m){var g;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t(n,n)&&t(r,r)&&t(i,i)&&t(o,o)&&t(u,u)&&t(c,c)&&t(l,l)&&t(h,h)&&t(f,f)&&t(d,d)&&t(p,p))){e.next=5;break}return e.next=3,Promise.all([t(a,a),t(s,s),t(v,v),t(m,m)]);case 3:return g=e.sent,e.abrupt("return",g.every((function(e){return e})));case 5:return e.abrupt("return",!1);case 6:case"end":return e.stop()}}),e)})));return function(t,n,r,a,i,o,s,u,c,l,h,f,d,p,v,m){return e.apply(this,arguments)}}(),A4={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},M4=function(e){var t=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{var n=e.decodeAudioData(t.buffer,(function(){}));return void 0!==n&&(n.catch((function(){})),!0)}catch(r){}return!1},N4={numberOfChannels:1},R4=function(e,t,n){var r=t[n];void 0!==r&&r!==e[n]&&(e[n]=r)},D4=function(e,t){R4(e,t,"channelCount"),R4(e,t,"channelCountMode"),R4(e,t,"channelInterpretation")},P4=function(e){return"function"===typeof e.getFloatTimeDomainData},O4=function(e,t,n){var r=t[n];void 0!==r&&r!==e[n].value&&(e[n].value=r)},L4=function(e){e.start=function(t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0;if("number"===typeof a&&a<0||r<0||n<0)throw new RangeError("The parameters can't be negative.");t.call(e,n,r,a)}}(e.start)},F4=function(e){e.stop=function(t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(n<0)throw new RangeError("The parameter can't be negative.");t.call(e,n)}}(e.stop)},z4=function(e,t){return null===e?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(e*t)))))},B4=function(e){return new Promise((function(t,n){var r=new MessageChannel,a=r.port1,i=r.port2;a.onmessage=function(e){var n=e.data;a.close(),i.close(),t(n)},a.onmessageerror=function(e){var t=e.data;a.close(),i.close(),n(t)},i.postMessage(e)}))},U4=function(){var e=ns(es().mark((function e(t,n){var r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B4(n);case 2:return r=e.sent,e.abrupt("return",new t(r));case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),V4=function(e,t){var n=e.createBiquadFilter();return D4(n,t),O4(n,t,"Q"),O4(n,t,"detune"),O4(n,t,"frequency"),O4(n,t,"gain"),R4(n,t,"type"),n},W4=function(e,t){var n=e.createChannelSplitter(t.numberOfOutputs);return D4(n,t),function(e){var t=e.numberOfOutputs;Object.defineProperty(e,"channelCount",{get:function(){return t},set:function(e){if(e!==t)throw _4()}}),Object.defineProperty(e,"channelCountMode",{get:function(){return"explicit"},set:function(e){if("explicit"!==e)throw _4()}}),Object.defineProperty(e,"channelInterpretation",{get:function(){return"discrete"},set:function(e){if("discrete"!==e)throw _4()}})}(n),n};function G4(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var j4=function(e,t){return e.connect=t.connect.bind(t),e.disconnect=t.disconnect.bind(t),e},q4=["offset"],H4=function(e,t){var n=e.createDelay(t.maxDelayTime);return D4(n,t),O4(n,t,"delayTime"),n},X4=function(e,t){var n=e.createGain();return D4(n,t),O4(n,t,"gain"),n};function K4(e,t){var n=t[0]*t[0]+t[1]*t[1];return[(e[0]*t[0]+e[1]*t[1])/n,(e[1]*t[0]-e[0]*t[1])/n]}function Y4(e,t){return[e[0]*t[0]-e[1]*t[1],e[0]*t[1]+e[1]*t[0]]}function Q4(e,t){for(var n=[0,0],r=e.length-1;r>=0;r-=1)(n=Y4(n,t))[0]+=e[r];return n}var Z4,J4,$4,e5,t5,n5,r5=["coneInnerAngle","coneOuterAngle","coneOuterGain","distanceModel","maxDistance","orientationX","orientationY","orientationZ","panningModel","positionX","positionY","positionZ","refDistance","rolloffFactor"],a5=function(e,t,n,r){return e.createScriptProcessor(t,n,r)},i5=["channelCount","channelCountMode","pan"],o5=["curve","oversample"],s5=function(){return new DOMException("","NotSupportedError")},u5={numberOfChannels:1},c5={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},l5={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},h5={disableNormalization:!1},f5={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},d5=function(){return new DOMException("","UnknownError")},p5={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},v5=function(e,t,n){return void 0===e.copyFromChannel?e.getChannelData(n)[0]:(e.copyFromChannel(t,n),t[0])},m5=function(e){if(null===e)return!1;var t=e.length;return t%2!==0?0!==e[Math.floor(t/2)]:e[t/2-1]+e[t/2]!==0},g5=function(e,t,n,r){for(var a=e;!a.hasOwnProperty(t);)a=Object.getPrototypeOf(a);var i=Object.getOwnPropertyDescriptor(a,t),o=i.get,s=i.set;Object.defineProperty(e,t,{get:n(o),set:r(s)})},y5=function(e){var t=e.createOscillator();try{t.start(-1)}catch($Pe){return $Pe instanceof RangeError}return!1},b5=function(e){var t=e.createBuffer(1,1,44100),n=e.createBufferSource();n.buffer=t,n.start(),n.stop();try{return n.stop(),!0}catch(r){return!1}},x5=function(e){var t=e.createOscillator();try{t.stop(-1)}catch($Pe){return $Pe instanceof RangeError}return!1},k5=function(){try{new DOMException}catch(e){return!1}return!0},w5=function(){return new Promise((function(e){var t=new ArrayBuffer(0),n=new MessageChannel,r=n.port1,a=n.port2;r.onmessage=function(t){var n=t.data;return e(null!==n)},a.postMessage(t,[t])}))},_5=function(e,t){var n=t.createGain();e.connect(n);var r,a=(r=e.disconnect,function(){r.call(e,n),e.removeEventListener("ended",a)});e.addEventListener("ended",a),j4(e,n),e.stop=function(t){var r=!1;return function(){var a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(r)try{t.call(e,a)}catch(i){n.gain.setValueAtTime(0,a)}else t.call(e,a),r=!0}}(e.stop)},S5=function(e,t){return function(n){var r={value:e};return Object.defineProperties(n,{currentTarget:r,target:r}),"function"===typeof t?t.call(e,n):t.handleEvent.call(e,n)}},C5=function(e){return function(t,n,r,a){var i=f(r,3),o=i[0],s=i[1],u=i[2];e(t[s],[n,o,u],(function(e){return e[0]===n&&e[1]===o}),a)}}(U3),T5=function(e){return function(t,n,r,a){var i=f(r,3),o=i[0],s=i[1],u=i[2],c=t.get(o);void 0===c?t.set(o,new Set([[s,n,u]])):e(c,[s,n,u],(function(e){return e[0]===s&&e[1]===n}),a)}}(U3),E5=function(e){return function(t,n,r,a){return e(t[a],(function(e){return e[0]===n&&e[1]===r}))}}(p3),I5=new WeakMap,A5=function(e){return function(t){var n;return null!==(n=e.get(t))&&void 0!==n?n:0}}(I5),M5=(Z4=new Map,J4=new WeakMap,function(e,t){var n=J4.get(e);if(void 0!==n)return n;var r=Z4.get(e);if(void 0!==r)return r;try{var a=t();return a instanceof Promise?(Z4.set(e,a),a.catch((function(){return!1})).then((function(t){return Z4.delete(e),J4.set(e,t),t}))):(J4.set(e,a),a)}catch(i){return J4.set(e,!1),!1}}),N5="undefined"===typeof window?null:window,R5=function(e,t){return function(n,r){var a=n.createAnalyser();if(D4(a,r),!(r.maxDecibels>r.minDecibels))throw t();return R4(a,r,"fftSize"),R4(a,r,"maxDecibels"),R4(a,r,"minDecibels"),R4(a,r,"smoothingTimeConstant"),e(P4,(function(){return P4(a)}))||function(e){e.getFloatTimeDomainData=function(t){var n=new Uint8Array(t.length);e.getByteTimeDomainData(n);for(var r=Math.max(n.length,e.fftSize),a=0;a<r;a+=1)t[a]=.0078125*(n[a]-128);return t}}(a),a}}(M5,T3),D5=function(e){return function(t){var n=e(t);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer}}(D3),P5=function(e,t,n){return function(){var r=ns(es().mark((function r(a,i,o){var s;return es().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s=e(a),r.next=3,Promise.all(s.activeInputs.map((function(e,r){return Array.from(e).map(function(){var e=ns(es().mark((function e(s){var u,c,l,h,d,p;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=f(s,2),c=u[0],l=u[1],h=t(c),e.next=4,h.render(c,i);case 4:d=e.sent,p=a.context.destination,n(c)||a===p&&n(a)||d.connect(o,l,r);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())})).reduce((function(e,t){return[].concat(Tt(e),Tt(t))}),[]));case 3:case"end":return r.stop()}}),r)})));return function(e,t,n){return r.apply(this,arguments)}}()}(D3,D5,Z3),O5=function(e,t,n){return function(){var r=new WeakMap,a=function(){var a=ns(es().mark((function a(i,o){var s,u;return es().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=t(i),S3(s,o)||(u={channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,fftSize:s.fftSize,maxDecibels:s.maxDecibels,minDecibels:s.minDecibels,smoothingTimeConstant:s.smoothingTimeConstant},s=e(o,u)),r.set(o,s),a.next=6,n(i,o,s);case 6:return a.abrupt("return",s);case 7:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}();return{render:function(e,t){var n=r.get(t);return void 0!==n?Promise.resolve(n):a(e,t)}}}}(R5,Y3,P5),L5=($4=r3,function(e){var t=$4.get(e);if(void 0===t)throw _4();return t}),F5=function(e){return null===e?null:e.hasOwnProperty("OfflineAudioContext")?e.OfflineAudioContext:e.hasOwnProperty("webkitOfflineAudioContext")?e.webkitOfflineAudioContext:null}(N5),z5=function(e){return function(t){return null!==e&&t instanceof e}}(F5),B5=new WeakMap,U5=function(e){return function(){function t(e){$n(this,t),this._nativeEventTarget=e,this._listeners=new WeakMap}return Jn(t,[{key:"addEventListener",value:function(t,n,r){if(null!==n){var a=this._listeners.get(n);void 0===a&&(a=e(this,n),"function"===typeof n&&this._listeners.set(n,a)),this._nativeEventTarget.addEventListener(t,a,r)}}},{key:"dispatchEvent",value:function(e){return this._nativeEventTarget.dispatchEvent(e)}},{key:"removeEventListener",value:function(e,t,n){var r=null===t?void 0:this._listeners.get(t);this._nativeEventTarget.removeEventListener(e,void 0===r?null:r,n)}}]),t}()}(S5),V5=function(e){return null===e?null:e.hasOwnProperty("AudioContext")?e.AudioContext:e.hasOwnProperty("webkitAudioContext")?e.webkitAudioContext:null}(N5),W5=function(e){return function(t){return null!==e&&t instanceof e}}(V5),G5=function(e){return function(t){return null!==e&&"function"===typeof e.AudioNode&&t instanceof e.AudioNode}}(N5),j5=function(e){return function(t){return null!==e&&"function"===typeof e.AudioParam&&t instanceof e.AudioParam}}(N5),q5=function(e){return null===e?null:e.hasOwnProperty("AudioWorkletNode")?e.AudioWorkletNode:null}(N5),H5=function(e,t,n,r,a,i,o,s,u,c,l,h,f,d,p,v){return function(c){tr(g,c);var m=sr(g);function g(t,r,a,i){var o;$n(this,g),(o=m.call(this,a))._context=t,o._nativeAudioNode=a;var s=l(t);return h(s)&&!0!==n($3,(function(){return $3(s,v)}))&&n4(a),e3.set(ir(o),a),a3.set(ir(o),new Set),"closed"!==t.state&&r&&g3(ir(o)),e(ir(o),i,a),o}return Jn(g,[{key:"channelCount",get:function(){return this._nativeAudioNode.channelCount},set:function(e){this._nativeAudioNode.channelCount=e}},{key:"channelCountMode",get:function(){return this._nativeAudioNode.channelCountMode},set:function(e){this._nativeAudioNode.channelCountMode=e}},{key:"channelInterpretation",get:function(){return this._nativeAudioNode.channelInterpretation},set:function(e){this._nativeAudioNode.channelInterpretation=e}},{key:"context",get:function(){return this._context}},{key:"numberOfInputs",get:function(){return this._nativeAudioNode.numberOfInputs}},{key:"numberOfOutputs",get:function(){return this._nativeAudioNode.numberOfOutputs}},{key:"connect",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw a();var c=l(this._context),h=p(c);if(f(e)||d(e))throw i();if(z3(e)){var v=Y3(e);try{var m,g=j3(this._nativeAudioNode,v,n,s),y=J3(this);if(h||y)(m=this._nativeAudioNode).disconnect.apply(m,Tt(g));"closed"!==this.context.state&&!y&&J3(e)&&g3(e)}catch($Pe){if(12===$Pe.code)throw i();throw $Pe}var b=t(this,e,n,s,h);if(b){var x=u([this],e);e4(x,r(h))}return e}var k=Q3(e);if("playbackRate"===k.name&&1024===k.maxValue)throw o();try{this._nativeAudioNode.connect(k,n),(h||J3(this))&&this._nativeAudioNode.disconnect(k,n)}catch($Pe){if(12===$Pe.code)throw i();throw $Pe}var w=r4(this,e,n,h);if(w){var _=u([this],e);e4(_,r(h))}}},{key:"disconnect",value:function(e,t,n){var r,o=l(this._context),c=p(o);if(void 0===e)r=function(e,t){var n,r=D3(e),a=[],i=al(r.outputs);try{for(i.s();!(n=i.n()).done;){var o=n.value;B3(o)?a4.apply(void 0,[e,t].concat(Tt(o))):i4.apply(void 0,[e,t].concat(Tt(o))),a.push(o[0])}}catch($Pe){i.e($Pe)}finally{i.f()}return r.outputs.clear(),a}(this,c);else if("number"===typeof e){if(e<0||e>=this.numberOfOutputs)throw a();r=function(e,t,n){var r,a=D3(e),i=[],o=al(a.outputs);try{for(o.s();!(r=o.n()).done;){var s=r.value;s[1]===n&&(B3(s)?a4.apply(void 0,[e,t].concat(Tt(s))):i4.apply(void 0,[e,t].concat(Tt(s))),i.push(s[0]),a.outputs.delete(s))}}catch($Pe){o.e($Pe)}finally{o.f()}return i}(this,c,e)}else{if(void 0!==t&&(t<0||t>=this.numberOfOutputs))throw a();if(z3(e)&&void 0!==n&&(n<0||n>=e.numberOfInputs))throw a();if(r=function(e,t,n,r,a){var i=D3(e);return Array.from(i.outputs).filter((function(e){return e[0]===n&&(void 0===r||e[1]===r)&&(void 0===a||e[2]===a)})).map((function(n){return B3(n)?a4.apply(void 0,[e,t].concat(Tt(n))):i4.apply(void 0,[e,t].concat(Tt(n))),i.outputs.delete(n),n[0]}))}(this,c,e,t,n),0===r.length)throw i()}var h,f=al(r);try{for(f.s();!(h=f.n()).done;){var d=h.value,v=u([this],d);e4(v,s)}}catch($Pe){f.e($Pe)}finally{f.f()}}}]),g}(c)}((e5=$2,function(e,t,n){for(var r=[],a=0;a<n.numberOfInputs;a+=1)r.push(new Set);e5.set(e,{activeInputs:r,outputs:new Set,passiveInputs:new WeakMap,renderer:t})}),function(e,t,n,r,a,i,o,s,u,c,l,h,f){var d=new WeakMap;return function(p,v,m,g,y){var b=i(v),x=b.activeInputs,k=b.passiveInputs,w=i(p).outputs,_=s(p),S=function(i){var s=u(v),c=u(p);if(i){var b=v3(k,p,m,g);e(x,p,b,!1),y||h(p)||n(c,s,m,g),f(v)&&g3(v)}else{var w=r(x,p,m,g);t(k,g,w,!1),y||h(p)||a(c,s,m,g);var _=o(v);if(0===_)l(v)&&x3(v,x);else{var S=d.get(v);void 0!==S&&clearTimeout(S),d.set(v,setTimeout((function(){l(v)&&x3(v,x)}),1e3*_))}}};return!!c(w,[v,m,g],(function(e){return e[0]===v&&e[1]===m&&e[2]===g}),!0)&&(_.add(S),l(p)?e(x,p,[m,g,S],!0):t(k,g,[p,m,S],!0),!0)}}(C5,T5,j3,E5,K3,D3,A5,m3,Y3,U3,N3,Z3,J3),M5,function(e,t,n,r,a,i){return function(o){return function(s,u){var c=e.get(s);if(void 0===c){if(!o&&i(s)){var l,h=r(s),f=al(n(s).outputs);try{for(f.s();!(l=f.n()).done;){var d=l.value;if(B3(d)){var p=r(d[0]);t(h,p,d[1],d[2])}else{var v=a(d[0]);h.disconnect(v,d[1])}}}catch($Pe){f.e($Pe)}finally{f.f()}}e.set(s,u)}else e.set(s,c+u)}}}(i3,K3,D3,Y3,Q3,N3),T3,S4,s5,function(e,t,n,r,a,i,o,s){return function(u,c){var l=t.get(u);if(void 0===l)throw new Error("Missing the expected cycle count.");var h=i(u.context),f=s(h);if(l===c){if(t.delete(u),!f&&o(u)){var d,p=r(u),v=al(n(u).outputs);try{for(v.s();!(d=v.n()).done;){var m=d.value;if(B3(m)){var g=r(m[0]);e(p,g,m[1],m[2])}else{var y=a(m[0]);p.connect(y,m[1])}}}catch($Pe){v.e($Pe)}finally{v.f()}}}else t.set(u,l-c)}}(j3,i3,D3,Y3,Q3,L5,N3,z5),function(e,t,n){return function r(a,i){var o=z3(i)?i:n(e,i);if(function(e){return"delayTime"in e}(o))return[];if(a[0]===o)return[a];if(a.includes(o))return[];var s=t(o).outputs;return Array.from(s).map((function(e){return r([].concat(Tt(a),[o]),e[0])})).reduce((function(e,t){return e.concat(t)}),[])}}(B5,D3,d3),U5,L5,W5,G5,j5,z5,q5),X5=function(e,t,n,r,a,i){return function(e){tr(s,e);var o=sr(s);function s(e,n){var u;$n(this,s);var c=a(e),l=w3(w3({},_3),n),h=r(c,l),f=i(c)?t():null;return(u=o.call(this,e,!1,h,f))._nativeAnalyserNode=h,u}return Jn(s,[{key:"fftSize",get:function(){return this._nativeAnalyserNode.fftSize},set:function(e){this._nativeAnalyserNode.fftSize=e}},{key:"frequencyBinCount",get:function(){return this._nativeAnalyserNode.frequencyBinCount}},{key:"maxDecibels",get:function(){return this._nativeAnalyserNode.maxDecibels},set:function(e){var t=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=e,!(e>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=t,n()}},{key:"minDecibels",get:function(){return this._nativeAnalyserNode.minDecibels},set:function(e){var t=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=e,!(this._nativeAnalyserNode.maxDecibels>e))throw this._nativeAnalyserNode.minDecibels=t,n()}},{key:"smoothingTimeConstant",get:function(){return this._nativeAnalyserNode.smoothingTimeConstant},set:function(e){this._nativeAnalyserNode.smoothingTimeConstant=e}},{key:"getByteFrequencyData",value:function(e){this._nativeAnalyserNode.getByteFrequencyData(e)}},{key:"getByteTimeDomainData",value:function(e){this._nativeAnalyserNode.getByteTimeDomainData(e)}},{key:"getFloatFrequencyData",value:function(e){this._nativeAnalyserNode.getFloatFrequencyData(e)}},{key:"getFloatTimeDomainData",value:function(e){this._nativeAnalyserNode.getFloatTimeDomainData(e)}}]),s}(e)}(H5,O5,T3,R5,L5,z5),K5=new WeakSet,Y5=function(e){return null===e?null:e.hasOwnProperty("AudioBuffer")?e.AudioBuffer:null}(N5),Q5=(t5=new Uint32Array(1),function(e){return t5[0]=e,t5[0]}),Z5=function(e,t){return function(n){n.copyFromChannel=function(r,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e(i),s=e(a);if(s>=n.numberOfChannels)throw t();for(var u=n.length,c=n.getChannelData(s),l=r.length,h=o<0?-o:0;h+o<u&&h<l;h+=1)r[h]=c[h+o]},n.copyToChannel=function(r,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e(i),s=e(a);if(s>=n.numberOfChannels)throw t();for(var u=n.length,c=n.getChannelData(s),l=r.length,h=o<0?-o:0;h+o<u&&h<l;h+=1)c[h+o]=r[h]}}}(Q5,T3),J5=function(e){return function(t){t.copyFromChannel=function(n){return function(r,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e(i),s=e(a);if(o<t.length)return n.call(t,r,s,o)}}(t.copyFromChannel),t.copyToChannel=function(n){return function(r,a){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=e(i),s=e(a);if(o<t.length)return n.call(t,r,s,o)}}(t.copyToChannel)}}(Q5),$5=function(e,t,n,r,a,i,o,s){var u=null;return function(c){function l(c){if($n(this,l),null===a)throw new Error("Missing the native OfflineAudioContext constructor.");var h=w3(w3({},I3),c),f=h.length,d=h.numberOfChannels,p=h.sampleRate;null===u&&(u=new a(1,1,44100));var v=null!==r&&t(i,i)?new r({length:f,numberOfChannels:d,sampleRate:p}):u.createBuffer(d,f,p);if(0===v.numberOfChannels)throw n();return"function"!==typeof v.copyFromChannel?(o(v),E3(v)):t(C3,(function(){return C3(v)}))||s(v),e.add(v),v}return Jn(l,null,[{key:Symbol.hasInstance,value:function(t){return null!==t&&"object"===typeof t&&Object.getPrototypeOf(t)===l.prototype||e.has(t)}}]),l}()}(K5,M5,s5,Y5,F5,function(e){return function(){if(null===e)return!1;try{new e({length:1,sampleRate:44100})}catch(t){return!1}return!0}}(Y5),Z5,J5),e6=function(e){return function(t,n){var r=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(r).connect(t.destination);n.addEventListener("ended",(function e(){n.removeEventListener("ended",e),n.disconnect(r),r.disconnect()}))}}(X4),t6=function(e,t,n){return function(){var r=ns(es().mark((function r(a,i,o){var s;return es().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return s=t(a),r.next=3,Promise.all(Array.from(s.activeInputs).map(function(){var t=ns(es().mark((function t(r){var a,s,u,c,l;return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return a=f(r,2),s=a[0],u=a[1],c=e(s),t.next=4,c.render(s,i);case 4:l=t.sent,n(s)||l.connect(o,u);case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 3:case"end":return r.stop()}}),r)})));return function(e,t,n){return r.apply(this,arguments)}}()}(D5,P3,Z3),n6=function(e){return function(t,n,r){return e(n,t,r)}}(t6),r6=function(e,t,n,r,a,i,o,s,u,c,l){return function(h,f){var d=h.createBufferSource();return D4(d,f),O4(d,f,"playbackRate"),R4(d,f,"buffer"),R4(d,f,"loop"),R4(d,f,"loopEnd"),R4(d,f,"loopStart"),t(n,(function(){return n(h)}))||function(e){e.start=function(t){var n=!1;return function(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2?arguments[2]:void 0;if(n)throw _4();t.call(e,r,a,i),n=!0}}(e.start)}(d),t(r,(function(){return r(h)}))||u(d),t(a,(function(){return a(h)}))||c(d,h),t(i,(function(){return i(h)}))||L4(d),t(o,(function(){return o(h)}))||l(d,h),t(s,(function(){return s(h)}))||F4(d),e(h,d),d}}(e6,M5,(function(e){var t=e.createBufferSource();t.start();try{t.start()}catch(n){return!0}return!1}),(function(e){var t=e.createBufferSource(),n=e.createBuffer(1,1,44100);t.buffer=n;try{t.start(0,1)}catch(r){return!1}return!0}),(function(e){var t=e.createBufferSource();t.start();try{t.stop()}catch(n){return!1}return!0}),y5,b5,x5,(function(e){e.start=function(t){return function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,a=arguments.length>2?arguments[2]:void 0,i=e.buffer,o=null===i?r:Math.min(i.duration,r);null!==i&&o>i.duration-.5/e.context.sampleRate?t.call(e,n,0,0):t.call(e,n,o,a)}}(e.start)}),function(e){return function(t,n){var r=n.createBuffer(1,1,44100);null===t.buffer&&(t.buffer=r),e(t,"buffer",(function(e){return function(){var n=e.call(t);return n===r?null:n}}),(function(e){return function(n){return e.call(t,null===n?r:n)}}))}}(g5),_5),a6=function(e,t){return function(n,r,a){return e(r).replay(a),t(r,n,a)}}(function(e){return function(t){var n=e(t);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer}}(P3),t6),i6=function(e,t,n,r,a){return function(){var i=new WeakMap,o=null,s=null,u=function(){var u=ns(es().mark((function u(c,l){var h,f,d,p;return es().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:if(h=n(c),(f=S3(h,l))||(d={buffer:h.buffer,channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,loop:h.loop,loopEnd:h.loopEnd,loopStart:h.loopStart,playbackRate:h.playbackRate.value},h=t(l,d),null!==o&&(p=h).start.apply(p,Tt(o)),null!==s&&h.stop(s)),i.set(l,h),f){u.next=9;break}return u.next=7,r(l,c.playbackRate,h.playbackRate);case 7:u.next=11;break;case 9:return u.next=11,e(l,c.playbackRate,h.playbackRate);case 11:return u.next=13,a(c,l,h);case 13:return u.abrupt("return",h);case 14:case"end":return u.stop()}}),u)})));return function(e,t){return u.apply(this,arguments)}}();return{set start(e){o=e},set stop(e){s=e},render:function(e,t){var n=i.get(t);return void 0!==n?Promise.resolve(n):u(e,t)}}}}(n6,r6,Y3,a6,P5),o6=function(e,t,n,r,a,i,o,s,u,c,l,h,f){return function(d,p,v){var m=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,g=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,y=new Z2.AutomationEventList(v.defaultValue),b=p?r(y):null,x={get defaultValue(){return v.defaultValue},get maxValue(){return null===m?v.maxValue:m},get minValue(){return null===g?v.minValue:g},get value(){return v.value},set value(e){v.value=e,x.setValueAtTime(e,d.context.currentTime)},cancelAndHoldAtTime:function(e){if("function"===typeof v.cancelAndHoldAtTime)null===b&&y.flush(d.context.currentTime),y.add(a(e)),v.cancelAndHoldAtTime(e);else{var t=Array.from(y).pop();null===b&&y.flush(d.context.currentTime),y.add(a(e));var n=Array.from(y).pop();v.cancelScheduledValues(e),t!==n&&void 0!==n&&("exponentialRampToValue"===n.type?v.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?v.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?v.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&v.setValueCurveAtTime(n.values,n.startTime,n.duration))}return x},cancelScheduledValues:function(e){return null===b&&y.flush(d.context.currentTime),y.add(i(e)),v.cancelScheduledValues(e),x},exponentialRampToValueAtTime:function(e,t){if(0===e)throw new RangeError;if(!Number.isFinite(t)||t<0)throw new RangeError;return null===b&&y.flush(d.context.currentTime),y.add(o(e,t)),v.exponentialRampToValueAtTime(e,t),x},linearRampToValueAtTime:function(e,t){return null===b&&y.flush(d.context.currentTime),y.add(s(e,t)),v.linearRampToValueAtTime(e,t),x},setTargetAtTime:function(e,t,n){return null===b&&y.flush(d.context.currentTime),y.add(u(e,t,n)),v.setTargetAtTime(e,t,n),x},setValueAtTime:function(e,t){return null===b&&y.flush(d.context.currentTime),y.add(c(e,t)),v.setValueAtTime(e,t),x},setValueCurveAtTime:function(e,t,n){var r=e instanceof Float32Array?e:new Float32Array(e);if(null!==h&&"webkitAudioContext"===h.name){for(var a=t+n,i=d.context.sampleRate,o=Math.ceil(t*i),s=Math.floor(a*i),u=s-o,c=new Float32Array(u),p=0;p<u;p+=1){var m=(r.length-1)/n*((o+p)/i-t),g=Math.floor(m),k=Math.ceil(m);c[p]=g===k?r[g]:(1-(m-g))*r[g]+(1-(k-m))*r[k]}null===b&&y.flush(d.context.currentTime),y.add(l(c,t,n)),v.setValueCurveAtTime(c,t,n);var w=s/i;w<a&&f(x,c[c.length-1],w),f(x,r[r.length-1],a)}else null===b&&y.flush(d.context.currentTime),y.add(l(r,t,n)),v.setValueCurveAtTime(r,t,n);return x}};return n.set(x,v),t.set(x,d),e(x,b),x}}((n5=t3,function(e,t){n5.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:t})}),B5,n3,(function(e){return{replay:function(t){var n,r=al(e);try{for(r.s();!(n=r.n()).done;){var a=n.value;if("exponentialRampToValue"===a.type){var i=a.endTime,o=a.value;t.exponentialRampToValueAtTime(o,i)}else if("linearRampToValue"===a.type){var s=a.endTime,u=a.value;t.linearRampToValueAtTime(u,s)}else if("setTarget"===a.type){var c=a.startTime,l=a.target,h=a.timeConstant;t.setTargetAtTime(l,c,h)}else if("setValue"===a.type){var f=a.startTime,d=a.value;t.setValueAtTime(d,f)}else{if("setValueCurve"!==a.type)throw new Error("Can't apply an unknown automation.");var p=a.duration,v=a.startTime,m=a.values;t.setValueCurveAtTime(m,v,p)}}}catch($Pe){r.e($Pe)}finally{r.f()}}}}),Z2.createCancelAndHoldAutomationEvent,Z2.createCancelScheduledValuesAutomationEvent,Z2.createExponentialRampToValueAutomationEvent,Z2.createLinearRampToValueAutomationEvent,Z2.createSetTargetAutomationEvent,Z2.createSetValueAutomationEvent,Z2.createSetValueCurveAutomationEvent,V5,(function e(t,n,r){try{t.setValueAtTime(n,r)}catch($Pe){if(9!==$Pe.code)throw $Pe;e(t,n,r+1e-7)}})),s6=function(e,t,n,r,a,i,o,s){return function(e){tr(c,e);var u=sr(c);function c(e,r){var s;$n(this,c);var l=i(e),h=w3(w3({},R3),r),f=a(l,h),d=o(l),p=d?t():null;return(s=u.call(this,e,!1,f,p))._audioBufferSourceNodeRenderer=p,s._isBufferNullified=!1,s._isBufferSet=null!==h.buffer,s._nativeAudioBufferSourceNode=f,s._onended=null,s._playbackRate=n(ir(s),d,f.playbackRate,M3,A3),s}return Jn(c,[{key:"buffer",get:function(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer},set:function(e){if(this._nativeAudioBufferSourceNode.buffer=e,null!==e){if(this._isBufferSet)throw r();this._isBufferSet=!0}}},{key:"loop",get:function(){return this._nativeAudioBufferSourceNode.loop},set:function(e){this._nativeAudioBufferSourceNode.loop=e}},{key:"loopEnd",get:function(){return this._nativeAudioBufferSourceNode.loopEnd},set:function(e){this._nativeAudioBufferSourceNode.loopEnd=e}},{key:"loopStart",get:function(){return this._nativeAudioBufferSourceNode.loopStart},set:function(e){this._nativeAudioBufferSourceNode.loopStart=e}},{key:"onended",get:function(){return this._onended},set:function(e){var t="function"===typeof e?s(this,e):null;this._nativeAudioBufferSourceNode.onended=t;var n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===t?e:n}},{key:"playbackRate",get:function(){return this._playbackRate}},{key:"start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;if(this._nativeAudioBufferSourceNode.start(t,n,r),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===r?[t,n]:[t,n,r]),"closed"!==this.context.state){g3(this);var a=function t(){e._nativeAudioBufferSourceNode.removeEventListener("ended",t),N3(e)&&b3(e)};this._nativeAudioBufferSourceNode.addEventListener("ended",a)}}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._nativeAudioBufferSourceNode.stop(e),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=e)}}]),c}(e)}(H5,i6,o6,_4,r6,L5,z5,S5),u6=function(e,t,n,r,a,i,o,s){return function(e){tr(c,e);var u=sr(c);function c(e,n){var r;$n(this,c);var l=i(e),h=o(l),f=a(l,n,h),d=h?t(s):null;return(r=u.call(this,e,!1,f,d))._isNodeOfNativeOfflineAudioContext=h,r._nativeAudioDestinationNode=f,r}return Jn(c,[{key:"channelCount",get:function(){return this._nativeAudioDestinationNode.channelCount},set:function(e){if(this._isNodeOfNativeOfflineAudioContext)throw r();if(e>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=e}},{key:"channelCountMode",get:function(){return this._nativeAudioDestinationNode.channelCountMode},set:function(e){if(this._isNodeOfNativeOfflineAudioContext)throw r();this._nativeAudioDestinationNode.channelCountMode=e}},{key:"maxChannelCount",get:function(){return this._nativeAudioDestinationNode.maxChannelCount}}]),c}(e)}(H5,(function(e){var t=new WeakMap,n=function(){var n=ns(es().mark((function n(r,a){var i;return es().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return i=a.destination,t.set(a,i),n.next=4,e(r,a,i);case 4:return n.abrupt("return",i);case 5:case"end":return n.stop()}}),n)})));return function(e,t){return n.apply(this,arguments)}}();return{render:function(e,r){var a=t.get(r);return void 0!==a?Promise.resolve(a):n(e,r)}}}),T3,_4,function(e,t){return function(n,r,a){var i=n.destination;if(i.channelCount!==r)try{i.channelCount=r}catch(s){}a&&"explicit"!==i.channelCountMode&&(i.channelCountMode="explicit"),0===i.maxChannelCount&&Object.defineProperty(i,"maxChannelCount",{value:r});var o=e(n,{channelCount:r,channelCountMode:i.channelCountMode,channelInterpretation:i.channelInterpretation,gain:1});return t(o,"channelCount",(function(e){return function(){return e.call(o)}}),(function(e){return function(t){e.call(o,t);try{i.channelCount=t}catch($Pe){if(t>i.maxChannelCount)throw $Pe}}})),t(o,"channelCountMode",(function(e){return function(){return e.call(o)}}),(function(e){return function(t){e.call(o,t),i.channelCountMode=t}})),t(o,"channelInterpretation",(function(e){return function(){return e.call(o)}}),(function(e){return function(t){e.call(o,t),i.channelInterpretation=t}})),Object.defineProperty(o,"maxChannelCount",{get:function(){return i.maxChannelCount}}),o.connect(i),o}}(X4,g5),L5,z5,P5),c6=function(e,t,n,r,a){return function(){var i=new WeakMap,o=function(){var o=ns(es().mark((function o(s,u){var c,l,h;return es().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(c=n(s),(l=S3(c,u))||(h={Q:c.Q.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,detune:c.detune.value,frequency:c.frequency.value,gain:c.gain.value,type:c.type},c=t(u,h)),i.set(u,c),l){o.next=15;break}return o.next=7,r(u,s.Q,c.Q);case 7:return o.next=9,r(u,s.detune,c.detune);case 9:return o.next=11,r(u,s.frequency,c.frequency);case 11:return o.next=13,r(u,s.gain,c.gain);case 13:o.next=23;break;case 15:return o.next=17,e(u,s.Q,c.Q);case 17:return o.next=19,e(u,s.detune,c.detune);case 19:return o.next=21,e(u,s.frequency,c.frequency);case 21:return o.next=23,e(u,s.gain,c.gain);case 23:return o.next=25,a(s,u,c);case 25:return o.abrupt("return",c);case 26:case"end":return o.stop()}}),o)})));return function(e,t){return o.apply(this,arguments)}}();return{render:function(e,t){var n=i.get(t);return void 0!==n?Promise.resolve(n):o(e,t)}}}}(n6,V4,Y3,a6,P5),l6=function(e){return function(t,n){return e.set(t,n)}}(I5),h6=function(e,t,n,r,a,i,o,s){return function(e){tr(c,e);var u=sr(c);function c(e,r){var l;$n(this,c);var h=i(e),f=w3(w3({},d4),r),d=a(h,f),p=o(h),v=p?n():null;return(l=u.call(this,e,!1,d,v))._Q=t(ir(l),p,d.Q,M3,A3),l._detune=t(ir(l),p,d.detune,1200*Math.log2(M3),-1200*Math.log2(M3)),l._frequency=t(ir(l),p,d.frequency,e.sampleRate/2,0),l._gain=t(ir(l),p,d.gain,40*Math.log10(M3),A3),l._nativeBiquadFilterNode=d,s(ir(l),1),l}return Jn(c,[{key:"detune",get:function(){return this._detune}},{key:"frequency",get:function(){return this._frequency}},{key:"gain",get:function(){return this._gain}},{key:"Q",get:function(){return this._Q}},{key:"type",get:function(){return this._nativeBiquadFilterNode.type},set:function(e){this._nativeBiquadFilterNode.type=e}},{key:"getFrequencyResponse",value:function(e,t,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(e,t,n)}catch($Pe){if(11===$Pe.code)throw r();throw $Pe}if(e.length!==t.length||t.length!==n.length)throw r()}}]),c}(e)}(H5,o6,c6,S4,V4,L5,z5,l6),f6=function(e,t){return function(n,r,a){var i,o,s=new Set;return n.connect=(i=n.connect,function(a){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,u=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,c=0===s.size;if(t(a))return i.call(n,a,o,u),e(s,[a,o,u],(function(e){return e[0]===a&&e[1]===o&&e[2]===u}),!0),c&&r(),a;i.call(n,a,o),e(s,[a,o],(function(e){return e[0]===a&&e[1]===o}),!0),c&&r()}),n.disconnect=(o=n.disconnect,function(e,r,i){var u=s.size>0;if(void 0===e)o.apply(n),s.clear();else if("number"===typeof e){o.call(n,e);var c,l=al(s);try{for(l.s();!(c=l.n()).done;){var h=c.value;h[1]===e&&s.delete(h)}}catch($Pe){l.e($Pe)}finally{l.f()}}else{t(e)?o.call(n,e,r,i):o.call(n,e,r);var f,d=al(s);try{for(d.s();!(f=d.n()).done;){var p=f.value;p[0]!==e||void 0!==r&&p[1]!==r||void 0!==i&&p[2]!==i||s.delete(p)}}catch($Pe){d.e($Pe)}finally{d.f()}}var v=0===s.size;u&&v&&a()}),n}}(U3,G5),d6=function(e,t){return function(n,r){r.channelCount=1,r.channelCountMode="explicit",Object.defineProperty(r,"channelCount",{get:function(){return 1},set:function(){throw e()}}),Object.defineProperty(r,"channelCountMode",{get:function(){return"explicit"},set:function(){throw e()}});var a=n.createBufferSource();t(r,(function(){for(var e=r.numberOfInputs,t=0;t<e;t+=1)a.connect(r,0,t)}),(function(){return a.disconnect(r)}))}}(_4,f6),p6=function(e,t){return function(n,r){var a=n.createChannelMerger(r.numberOfInputs);return null!==e&&"webkitAudioContext"===e.name&&t(n,a),D4(a,r),a}}(V5,d6),v6=function(e,t,n){return function(){var r=new WeakMap,a=function(){var a=ns(es().mark((function a(i,o){var s,u;return es().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=t(i),S3(s,o)||(u={channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,numberOfInputs:s.numberOfInputs},s=e(o,u)),r.set(o,s),a.next=6,n(i,o,s);case 6:return a.abrupt("return",s);case 7:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}();return{render:function(e,t){var n=r.get(t);return void 0!==n?Promise.resolve(n):a(e,t)}}}}(p6,Y3,P5),m6=function(e,t,n,r,a){return function(e){tr(o,e);var i=sr(o);function o(e,s){$n(this,o);var u=r(e),c=w3(w3({},p4),s),l=n(u,c),h=a(u)?t():null;return i.call(this,e,!1,l,h)}return Jn(o)}(e)}(H5,v6,p6,L5,z5),g6=function(e,t,n){return function(){var r=new WeakMap,a=function(){var a=ns(es().mark((function a(i,o){var s,u;return es().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return s=t(i),S3(s,o)||(u={channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,numberOfOutputs:s.numberOfOutputs},s=e(o,u)),r.set(o,s),a.next=6,n(i,o,s);case 6:return a.abrupt("return",s);case 7:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}();return{render:function(e,t){var n=r.get(t);return void 0!==n?Promise.resolve(n):a(e,t)}}}}(W4,Y3,P5),y6=function(e,t,n,r,a,i){return function(e){tr(s,e);var o=sr(s);function s(e,u){$n(this,s);var c=r(e),l=i(w3(w3({},v4),u)),h=n(c,l),f=a(c)?t():null;return o.call(this,e,!1,h,f)}return Jn(s)}(e)}(H5,g6,W4,L5,z5,(function(e){return w3(w3({},e),{},{channelCount:e.numberOfOutputs})})),b6=function(e,t,n,r){return function(a,i){var o=i.offset,s=G4(i,q4),u=a.createBuffer(1,2,44100),c=t(a,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),l=n(a,w3(w3({},s),{},{gain:o})),h=u.getChannelData(0);h[0]=1,h[1]=1,c.buffer=u,c.loop=!0;var f={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(e){l.channelCount=e},get channelCountMode(){return l.channelCountMode},set channelCountMode(e){l.channelCountMode=e},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(e){l.channelInterpretation=e},get context(){return l.context},get inputs(){return[]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get offset(){return l.gain},get onended(){return c.onended},set onended(e){c.onended=e},addEventListener:function(){return c.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent:function(){return c.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener:function(){return c.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},start:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;c.start.call(c,e)},stop:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;c.stop.call(c,e)}};return e(a,c),r(j4(f,l),(function(){return c.connect(l)}),(function(){return c.disconnect(l)}))}}(e6,r6,X4,f6),x6=function(e,t,n,r,a){return function(i,o){if(void 0===i.createConstantSource)return n(i,o);var s=i.createConstantSource();return D4(s,o),O4(s,o,"offset"),t(r,(function(){return r(i)}))||L4(s),t(a,(function(){return a(i)}))||F4(s),e(i,s),s}}(e6,M5,b6,y5,x5),k6=function(e,t,n,r,a){return function(){var i=new WeakMap,o=null,s=null,u=function(){var u=ns(es().mark((function u(c,l){var h,f,d;return es().wrap((function(u){for(;;)switch(u.prev=u.next){case 0:if(h=n(c),(f=S3(h,l))||(d={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,offset:h.offset.value},h=t(l,d),null!==o&&h.start(o),null!==s&&h.stop(s)),i.set(l,h),f){u.next=9;break}return u.next=7,r(l,c.offset,h.offset);case 7:u.next=11;break;case 9:return u.next=11,e(l,c.offset,h.offset);case 11:return u.next=13,a(c,l,h);case 13:return u.abrupt("return",h);case 14:case"end":return u.stop()}}),u)})));return function(e,t){return u.apply(this,arguments)}}();return{set start(e){o=e},set stop(e){s=e},render:function(e,t){var n=i.get(t);return void 0!==n?Promise.resolve(n):u(e,t)}}}}(n6,x6,Y3,a6,P5),w6=function(e,t,n,r,a,i,o){return function(e){tr(u,e);var s=sr(u);function u(e,o){var c;$n(this,u);var l=a(e),h=w3(w3({},m4),o),f=r(l,h),d=i(l),p=d?n():null;return(c=s.call(this,e,!1,f,p))._constantSourceNodeRenderer=p,c._nativeConstantSourceNode=f,c._offset=t(ir(c),d,f.offset,M3,A3),c._onended=null,c}return Jn(u,[{key:"offset",get:function(){return this._offset}},{key:"onended",get:function(){return this._onended},set:function(e){var t="function"===typeof e?o(this,e):null;this._nativeConstantSourceNode.onended=t;var n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===t?e:n}},{key:"start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){g3(this);var n=function t(){e._nativeConstantSourceNode.removeEventListener("ended",t),N3(e)&&b3(e)};this._nativeConstantSourceNode.addEventListener("ended",n)}}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._nativeConstantSourceNode.stop(e),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=e)}}]),u}(e)}(H5,o6,k6,x6,L5,z5,S5),_6=function(e,t){return function(n,r){var a=n.createConvolver();if(D4(a,r),r.disableNormalization===a.normalize&&(a.normalize=!r.disableNormalization),R4(a,r,"buffer"),r.channelCount>2)throw e();if(t(a,"channelCount",(function(e){return function(){return e.call(a)}}),(function(t){return function(n){if(n>2)throw e();return t.call(a,n)}})),"max"===r.channelCountMode)throw e();return t(a,"channelCountMode",(function(e){return function(){return e.call(a)}}),(function(t){return function(n){if("max"===n)throw e();return t.call(a,n)}})),a}}(s5,g5),S6=function(e,t,n){return function(){var r=new WeakMap,a=function(){var a=ns(es().mark((function a(i,o){var s,u;return es().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(s=t(i),S3(s,o)||(u={buffer:s.buffer,channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,disableNormalization:!s.normalize},s=e(o,u)),r.set(o,s),!G3(s)){a.next=9;break}return a.next=7,n(i,o,s.inputs[0]);case 7:a.next=11;break;case 9:return a.next=11,n(i,o,s);case 11:return a.abrupt("return",s);case 12:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}();return{render:function(e,t){var n=r.get(t);return void 0!==n?Promise.resolve(n):a(e,t)}}}}(_6,Y3,P5),C6=function(e,t,n,r,a,i){return function(e){tr(s,e);var o=sr(s);function s(e,u){var c;$n(this,s);var l=r(e),h=w3(w3({},g4),u),f=n(l,h),d=a(l)?t():null;return(c=o.call(this,e,!1,f,d))._isBufferNullified=!1,c._nativeConvolverNode=f,null!==h.buffer&&i(ir(c),h.buffer.duration),c}return Jn(s,[{key:"buffer",get:function(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer},set:function(e){if(this._nativeConvolverNode.buffer=e,null===e&&null!==this._nativeConvolverNode.buffer){var t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,44100),this._isBufferNullified=!0,i(this,0)}else this._isBufferNullified=!1,i(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}},{key:"normalize",get:function(){return this._nativeConvolverNode.normalize},set:function(e){this._nativeConvolverNode.normalize=e}}]),s}(e)}(H5,S6,_6,L5,z5,l6),T6=function(e,t,n,r,a){return function(i){var o=new WeakMap,s=function(){var s=ns(es().mark((function s(u,c){var l,h,f;return es().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(l=n(u),(h=S3(l,c))||(f={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,delayTime:l.delayTime.value,maxDelayTime:i},l=t(c,f)),o.set(c,l),h){s.next=9;break}return s.next=7,r(c,u.delayTime,l.delayTime);case 7:s.next=11;break;case 9:return s.next=11,e(c,u.delayTime,l.delayTime);case 11:return s.next=13,a(u,c,l);case 13:return s.abrupt("return",l);case 14:case"end":return s.stop()}}),s)})));return function(e,t){return s.apply(this,arguments)}}();return{render:function(e,t){var n=o.get(t);return void 0!==n?Promise.resolve(n):s(e,t)}}}}(n6,H4,Y3,a6,P5),E6=function(e,t,n,r,a,i,o){return function(e){tr(u,e);var s=sr(u);function u(e,c){var l;$n(this,u);var h=a(e),f=w3(w3({},b4),c),d=r(h,f),p=i(h),v=p?n(f.maxDelayTime):null;return(l=s.call(this,e,!1,d,v))._delayTime=t(ir(l),p,d.delayTime),o(ir(l),f.maxDelayTime),l}return Jn(u,[{key:"delayTime",get:function(){return this._delayTime}}]),u}(e)}(H5,o6,T6,H4,L5,z5,l6),I6=function(e){return function(t,n){var r=t.createDynamicsCompressor();if(D4(r,n),n.channelCount>2)throw e();if("max"===n.channelCountMode)throw e();return O4(r,n,"attack"),O4(r,n,"knee"),O4(r,n,"ratio"),O4(r,n,"release"),O4(r,n,"threshold"),r}}(s5),A6=function(e,t,n,r,a){return function(){var i=new WeakMap,o=function(){var o=ns(es().mark((function o(s,u){var c,l,h;return es().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(c=n(s),(l=S3(c,u))||(h={attack:c.attack.value,channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,knee:c.knee.value,ratio:c.ratio.value,release:c.release.value,threshold:c.threshold.value},c=t(u,h)),i.set(u,c),l){o.next=17;break}return o.next=7,r(u,s.attack,c.attack);case 7:return o.next=9,r(u,s.knee,c.knee);case 9:return o.next=11,r(u,s.ratio,c.ratio);case 11:return o.next=13,r(u,s.release,c.release);case 13:return o.next=15,r(u,s.threshold,c.threshold);case 15:o.next=27;break;case 17:return o.next=19,e(u,s.attack,c.attack);case 19:return o.next=21,e(u,s.knee,c.knee);case 21:return o.next=23,e(u,s.ratio,c.ratio);case 23:return o.next=25,e(u,s.release,c.release);case 25:return o.next=27,e(u,s.threshold,c.threshold);case 27:return o.next=29,a(s,u,c);case 29:return o.abrupt("return",c);case 30:case"end":return o.stop()}}),o)})));return function(e,t){return o.apply(this,arguments)}}();return{render:function(e,t){var n=i.get(t);return void 0!==n?Promise.resolve(n):o(e,t)}}}}(n6,I6,Y3,a6,P5),M6=function(e,t,n,r,a,i,o,s){return function(e){tr(c,e);var u=sr(c);function c(e,a){var l;$n(this,c);var h=i(e),f=w3(w3({},k4),a),d=r(h,f),p=o(h),v=p?n():null;return(l=u.call(this,e,!1,d,v))._attack=t(ir(l),p,d.attack),l._knee=t(ir(l),p,d.knee),l._nativeDynamicsCompressorNode=d,l._ratio=t(ir(l),p,d.ratio),l._release=t(ir(l),p,d.release),l._threshold=t(ir(l),p,d.threshold),s(ir(l),.006),l}return Jn(c,[{key:"attack",get:function(){return this._attack}},{key:"channelCount",get:function(){return this._nativeDynamicsCompressorNode.channelCount},set:function(e){var t=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=e,e>2)throw this._nativeDynamicsCompressorNode.channelCount=t,a()}},{key:"channelCountMode",get:function(){return this._nativeDynamicsCompressorNode.channelCountMode},set:function(e){var t=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=e,"max"===e)throw this._nativeDynamicsCompressorNode.channelCountMode=t,a()}},{key:"knee",get:function(){return this._knee}},{key:"ratio",get:function(){return this._ratio}},{key:"reduction",get:function(){return"number"===typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}},{key:"release",get:function(){return this._release}},{key:"threshold",get:function(){return this._threshold}}]),c}(e)}(H5,o6,A6,I6,s5,L5,z5,l6),N6=function(e,t,n,r,a){return function(){var i=new WeakMap,o=function(){var o=ns(es().mark((function o(s,u){var c,l,h;return es().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(c=n(s),(l=S3(c,u))||(h={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,gain:c.gain.value},c=t(u,h)),i.set(u,c),l){o.next=9;break}return o.next=7,r(u,s.gain,c.gain);case 7:o.next=11;break;case 9:return o.next=11,e(u,s.gain,c.gain);case 11:return o.next=13,a(s,u,c);case 13:return o.abrupt("return",c);case 14:case"end":return o.stop()}}),o)})));return function(e,t){return o.apply(this,arguments)}}();return{render:function(e,t){var n=i.get(t);return void 0!==n?Promise.resolve(n):o(e,t)}}}}(n6,X4,Y3,a6,P5),R6=function(e,t,n,r,a,i){return function(e){tr(s,e);var o=sr(s);function s(e,u){var c;$n(this,s);var l=a(e),h=w3(w3({},w4),u),f=r(l,h),d=i(l),p=d?n():null;return(c=o.call(this,e,!1,f,p))._gain=t(ir(c),d,f.gain,M3,A3),c}return Jn(s,[{key:"gain",get:function(){return this._gain}}]),s}(e)}(H5,o6,N6,X4,L5,z5),D6=function(e,t,n,r){return function(a,i,o){var s=o.channelCount,u=o.channelCountMode,c=o.channelInterpretation,l=o.feedback,h=o.feedforward,f=z4(i,a.sampleRate),d=l instanceof Float64Array?l:new Float64Array(l),p=h instanceof Float64Array?h:new Float64Array(h),v=d.length,m=p.length,g=Math.min(v,m);if(0===v||v>20)throw r();if(0===d[0])throw t();if(0===m||m>20)throw r();if(0===p[0])throw t();if(1!==d[0]){for(var y=0;y<m;y+=1)p[y]/=d[0];for(var b=1;b<v;b+=1)d[b]/=d[0]}var x=n(a,f,s,s);x.channelCount=s,x.channelCountMode=u,x.channelInterpretation=c;for(var k=[],w=[],_=[],S=0;S<s;S+=1){k.push(0);var C=new Float32Array(32),T=new Float32Array(32);C.fill(0),T.fill(0),w.push(C),_.push(T)}x.onaudioprocess=function(e){for(var t=e.inputBuffer,n=e.outputBuffer,r=t.numberOfChannels,a=0;a<r;a+=1){var i=t.getChannelData(a),o=n.getChannelData(a);k[a]=T4(d,v,p,m,g,w[a],_[a],k[a],32,i,o)}};var E=a.sampleRate/2,I={get bufferSize(){return f},get channelCount(){return x.channelCount},set channelCount(e){x.channelCount=e},get channelCountMode(){return x.channelCountMode},set channelCountMode(e){x.channelCountMode=e},get channelInterpretation(){return x.channelInterpretation},set channelInterpretation(e){x.channelInterpretation=e},get context(){return x.context},get inputs(){return[x]},get numberOfInputs(){return x.numberOfInputs},get numberOfOutputs(){return x.numberOfOutputs},addEventListener:function(){return x.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent:function(){return x.dispatchEvent(arguments.length<=0?void 0:arguments[0])},getFrequencyResponse:function(t,n,r){if(t.length!==n.length||n.length!==r.length)throw e();for(var a=t.length,i=0;i<a;i+=1){var o=-Math.PI*(t[i]/E),s=[Math.cos(o),Math.sin(o)],u=K4(Q4(p,s),Q4(d,s));n[i]=Math.sqrt(u[0]*u[0]+u[1]*u[1]),r[i]=Math.atan2(u[1],u[0])}},removeEventListener:function(){return x.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}};return j4(I,x)}}(S4,_4,a5,s5),P6=function(e,t,n,r){return function(a){return e(M4,(function(){return M4(a)}))?Promise.resolve(e(r,r)).then((function(e){if(!e){var t=n(a,512,0,1);a.oncomplete=function(){t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=function(){return a.currentTime},t.connect(a.destination)}return a.startRendering()})):new Promise((function(e){var n=t(a,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});a.oncomplete=function(t){n.disconnect(),e(t.renderedBuffer)},n.connect(a.destination),a.startRendering()}))}}(M5,X4,a5,function(e,t){return function(){if(null===t)return Promise.resolve(!1);var n=new t(1,1,44100),r=e(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((function(e){n.oncomplete=function(){r.disconnect(),e(0!==n.currentTime)},n.startRendering()}))}}(X4,F5)),O6=function(e,t,n,r,a){return function(i,o){var s=new WeakMap,u=null,c=function(){var c=ns(es().mark((function c(l,h){var f,d,p,v,m;return es().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(f=null,d=t(l),p=S3(d,h),void 0===h.createIIRFilter?f=e(h,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):p||(d=h.createIIRFilter(o,i)),s.set(h,null===f?d:f),null===f){c.next=17;break}if(null!==u){c.next=11;break}if(null!==n){c.next=9;break}throw new Error("Missing the native OfflineAudioContext constructor.");case 9:v=new n(l.context.destination.channelCount,l.context.length,h.sampleRate),u=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r(l,v,v.destination);case 2:return e.next=4,a(v);case 4:return t=e.sent,e.abrupt("return",E4(t,h,i,o));case 6:case"end":return e.stop()}}),e)})))();case 11:return c.next=13,u;case 13:return m=c.sent,f.buffer=m,f.start(0),c.abrupt("return",f);case 17:return c.next=19,r(l,h,d);case 19:return c.abrupt("return",d);case 20:case"end":return c.stop()}}),c)})));return function(e,t){return c.apply(this,arguments)}}();return{render:function(e,t){var n=s.get(t);return void 0!==n?Promise.resolve(n):c(e,t)}}}}(r6,Y3,F5,P5,P6),L6=function(e){return function(t,n,r){if(void 0===t.createIIRFilter)return e(t,n,r);var a=t.createIIRFilter(r.feedforward,r.feedback);return D4(a,r),a}}(D6),F6=function(e,t,n,r,a,i){return function(e){tr(s,e);var o=sr(s);function s(e,u){var c;$n(this,s);var l=r(e),h=a(l),f=w3(w3({},C4),u),d=t(l,h?null:e.baseLatency,f),p=h?n(f.feedback,f.feedforward):null;return c=o.call(this,e,!1,d,p),function(e){var t;e.getFrequencyResponse=(t=e.getFrequencyResponse,function(n,r,a){if(n.length!==r.length||r.length!==a.length)throw S4();return t.call(e,n,r,a)})}(d),c._nativeIIRFilterNode=d,i(ir(c),1),c}return Jn(s,[{key:"getFrequencyResponse",value:function(e,t,n){return this._nativeIIRFilterNode.getFrequencyResponse(e,t,n)}}]),s}(e)}(H5,L6,O6,L5,z5,l6),z6=function(e,t,n,r,a,i,o,s){return function(u,c){var l=c.listener,h=void 0===l.forwardX?function(){var h=new Float32Array(1),f=t(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),d=o(c),p=!1,v=[0,0,-1,0,1,0],m=[0,0,0],g=function(){if(!p){p=!0;var e=r(c,256,9,0);e.onaudioprocess=function(e){var t=e.inputBuffer,n=[i(t,h,0),i(t,h,1),i(t,h,2),i(t,h,3),i(t,h,4),i(t,h,5)];n.some((function(e,t){return e!==v[t]}))&&(l.setOrientation.apply(l,n),v=n);var r=[i(t,h,6),i(t,h,7),i(t,h,8)];r.some((function(e,t){return e!==m[t]}))&&(l.setPosition.apply(l,r),m=r)},f.connect(e)}},y=function(e){return function(t){t!==v[e]&&(v[e]=t,l.setOrientation.apply(l,Tt(v)))}},b=function(e){return function(t){t!==m[e]&&(m[e]=t,l.setPosition.apply(l,Tt(m)))}},x=function(t,r,i){var o=n(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:r});o.connect(f,0,t),o.start(),Object.defineProperty(o.offset,"defaultValue",{get:function(){return r}});var l,h,p,v,m,y,b,x=e({context:u},d,o.offset,M3,A3);return s(x,"value",(function(e){return function(){return e.call(x)}}),(function(e){return function(t){try{e.call(x,t)}catch($Pe){if(9!==$Pe.code)throw $Pe}g(),d&&i(t)}})),x.cancelAndHoldAtTime=(l=x.cancelAndHoldAtTime,d?function(){throw a()}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=l.apply(x,t);return g(),r}),x.cancelScheduledValues=(h=x.cancelScheduledValues,d?function(){throw a()}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=h.apply(x,t);return g(),r}),x.exponentialRampToValueAtTime=(p=x.exponentialRampToValueAtTime,d?function(){throw a()}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=p.apply(x,t);return g(),r}),x.linearRampToValueAtTime=(v=x.linearRampToValueAtTime,d?function(){throw a()}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=v.apply(x,t);return g(),r}),x.setTargetAtTime=(m=x.setTargetAtTime,d?function(){throw a()}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=m.apply(x,t);return g(),r}),x.setValueAtTime=(y=x.setValueAtTime,d?function(){throw a()}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=y.apply(x,t);return g(),r}),x.setValueCurveAtTime=(b=x.setValueCurveAtTime,d?function(){throw a()}:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=b.apply(x,t);return g(),r}),x};return{forwardX:x(0,0,y(0)),forwardY:x(1,0,y(1)),forwardZ:x(2,-1,y(2)),positionX:x(6,0,b(0)),positionY:x(7,0,b(1)),positionZ:x(8,0,b(2)),upX:x(3,0,y(3)),upY:x(4,1,y(4)),upZ:x(5,0,y(5))}}():l,f=h.forwardX,d=h.forwardY,p=h.forwardZ,v=h.positionX,m=h.positionY,g=h.positionZ,y=h.upX,b=h.upY,x=h.upZ;return{get forwardX(){return f},get forwardY(){return d},get forwardZ(){return p},get positionX(){return v},get positionY(){return m},get positionZ(){return g},get upX(){return y},get upY(){return b},get upZ(){return x}}}}(o6,p6,x6,a5,s5,v5,z5,g5),B6=new WeakMap,U6=function(e,t,n,r,a,i){return function(n){tr(s,n);var o=sr(s);function s(n,i){var u;return $n(this,s),(u=o.call(this,n))._nativeContext=n,r3.set(ir(u),n),r(n)&&a.set(n,new Set),u._destination=new e(ir(u),i),u._listener=t(ir(u),n),u._onstatechange=null,u}return Jn(s,[{key:"currentTime",get:function(){return this._nativeContext.currentTime}},{key:"destination",get:function(){return this._destination}},{key:"listener",get:function(){return this._listener}},{key:"onstatechange",get:function(){return this._onstatechange},set:function(e){var t="function"===typeof e?i(this,e):null;this._nativeContext.onstatechange=t;var n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===t?e:n}},{key:"sampleRate",get:function(){return this._nativeContext.sampleRate}},{key:"state",get:function(){return this._nativeContext.state}}]),s}(n)}(u6,z6,U5,z5,B6,S5),V6=function(e,t,n,r,a,i){return function(o,s){var u=o.createOscillator();return D4(u,s),O4(u,s,"detune"),O4(u,s,"frequency"),void 0!==s.periodicWave?u.setPeriodicWave(s.periodicWave):R4(u,s,"type"),t(n,(function(){return n(o)}))||L4(u),t(r,(function(){return r(o)}))||i(u,o),t(a,(function(){return a(o)}))||F4(u),e(o,u),u}}(e6,M5,y5,b5,x5,_5),W6=function(e,t,n,r,a){return function(){var i=new WeakMap,o=null,s=null,u=null,c=function(){var c=ns(es().mark((function c(l,h){var f,d,p;return es().wrap((function(c){for(;;)switch(c.prev=c.next){case 0:if(f=n(l),(d=S3(f,h))||(p={channelCount:f.channelCount,channelCountMode:f.channelCountMode,channelInterpretation:f.channelInterpretation,detune:f.detune.value,frequency:f.frequency.value,periodicWave:null===o?void 0:o,type:f.type},f=t(h,p),null!==s&&f.start(s),null!==u&&f.stop(u)),i.set(h,f),d){c.next=11;break}return c.next=7,r(h,l.detune,f.detune);case 7:return c.next=9,r(h,l.frequency,f.frequency);case 9:c.next=15;break;case 11:return c.next=13,e(h,l.detune,f.detune);case 13:return c.next=15,e(h,l.frequency,f.frequency);case 15:return c.next=17,a(l,h,f);case 17:return c.abrupt("return",f);case 18:case"end":return c.stop()}}),c)})));return function(e,t){return c.apply(this,arguments)}}();return{set periodicWave(e){o=e},set start(e){s=e},set stop(e){u=e},render:function(e,t){var n=i.get(t);return void 0!==n?Promise.resolve(n):c(e,t)}}}}(n6,V6,Y3,a6,P5),G6=function(e,t,n,r,a,i,o){return function(e){tr(u,e);var s=sr(u);function u(e,o){var c;$n(this,u);var l=a(e),h=w3(w3({},c5),o),f=n(l,h),d=i(l),p=d?r():null,v=e.sampleRate/2;return(c=s.call(this,e,!1,f,p))._detune=t(ir(c),d,f.detune,153600,-153600),c._frequency=t(ir(c),d,f.frequency,v,-v),c._nativeOscillatorNode=f,c._onended=null,c._oscillatorNodeRenderer=p,null!==c._oscillatorNodeRenderer&&void 0!==h.periodicWave&&(c._oscillatorNodeRenderer.periodicWave=h.periodicWave),c}return Jn(u,[{key:"detune",get:function(){return this._detune}},{key:"frequency",get:function(){return this._frequency}},{key:"onended",get:function(){return this._onended},set:function(e){var t="function"===typeof e?o(this,e):null;this._nativeOscillatorNode.onended=t;var n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===t?e:n}},{key:"type",get:function(){return this._nativeOscillatorNode.type},set:function(e){this._nativeOscillatorNode.type=e,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}},{key:"setPeriodicWave",value:function(e){this._nativeOscillatorNode.setPeriodicWave(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=e)}},{key:"start",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){g3(this);var n=function t(){e._nativeOscillatorNode.removeEventListener("ended",t),N3(e)&&b3(e)};this._nativeOscillatorNode.addEventListener("ended",n)}}},{key:"stop",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;this._nativeOscillatorNode.stop(e),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=e)}}]),u}(e)}(H5,o6,V6,W6,L5,z5,S5),j6=function(e){return function(t,n){var r=e(t,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),a=t.createBuffer(1,2,44100);return r.buffer=a,r.loop=!0,r.connect(n),r.start(),function(){r.stop(),r.disconnect(n)}}}(r6),q6=function(e,t,n,r,a){return function(i,o){var s=o.curve,u=o.oversample,c=G4(o,o5),l=i.createWaveShaper(),h=i.createWaveShaper();D4(l,c),D4(h,c);var f=n(i,w3(w3({},c),{},{gain:1})),d=n(i,w3(w3({},c),{},{gain:-1})),p=n(i,w3(w3({},c),{},{gain:1})),v=n(i,w3(w3({},c),{},{gain:-1})),m=null,g=!1,y=null,b={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(e){f.channelCount=e,d.channelCount=e,l.channelCount=e,p.channelCount=e,h.channelCount=e,v.channelCount=e},get channelCountMode(){return l.channelCountMode},set channelCountMode(e){f.channelCountMode=e,d.channelCountMode=e,l.channelCountMode=e,p.channelCountMode=e,h.channelCountMode=e,v.channelCountMode=e},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(e){f.channelInterpretation=e,d.channelInterpretation=e,l.channelInterpretation=e,p.channelInterpretation=e,h.channelInterpretation=e,v.channelInterpretation=e},get context(){return l.context},get curve(){return y},set curve(n){if(null!==n&&n.length<2)throw t();if(null===n)l.curve=n,h.curve=n;else{var a=n.length,o=new Float32Array(a+2-a%2),s=new Float32Array(a+2-a%2);o[0]=n[0],s[0]=-n[a-1];for(var u=Math.ceil((a+1)/2),c=(a+1)/2-1,d=1;d<u;d+=1){var p=d/u*c,v=Math.floor(p),b=Math.ceil(p);o[d]=v===b?n[v]:(1-(p-v))*n[v]+(1-(b-p))*n[b],s[d]=v===b?-n[a-1-v]:-(1-(p-v))*n[a-1-v]-(1-(b-p))*n[a-1-b]}o[u]=a%2===1?n[u-1]:(n[u-2]+n[u-1])/2,l.curve=o,h.curve=s}y=n,g&&(r(y)&&null===m?m=e(i,f):null!==m&&(m(),m=null))},get inputs(){return[f]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get oversample(){return l.oversample},set oversample(e){l.oversample=e,h.oversample=e},addEventListener:function(){return f.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent:function(){return f.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener:function(){return f.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}};null!==s&&(b.curve=s instanceof Float32Array?s:new Float32Array(s)),u!==b.oversample&&(b.oversample=u);return a(j4(b,p),(function(){f.connect(l).connect(p),f.connect(d).connect(h).connect(v).connect(p),g=!0,r(y)&&(m=e(i,f))}),(function(){f.disconnect(l),l.disconnect(p),f.disconnect(d),d.disconnect(h),h.disconnect(v),v.disconnect(p),g=!1,null!==m&&(m(),m=null)}))}}(j6,_4,X4,m5,f6),H6=function(e,t,n,r,a,i,o){return function(s,u){var c=s.createWaveShaper();if(null!==i&&"webkitAudioContext"===i.name&&void 0===s.createGain().gain.automationRate)return n(s,u);D4(c,u);var l=null===u.curve||u.curve instanceof Float32Array?u.curve:new Float32Array(u.curve);if(null!==l&&l.length<2)throw t();R4(c,{curve:l},"curve"),R4(c,u,"oversample");var h=null,f=!1;o(c,"curve",(function(e){return function(){return e.call(c)}}),(function(t){return function(n){return t.call(c,n),f&&(r(n)&&null===h?h=e(s,c):r(n)||null===h||(h(),h=null)),n}}));return a(c,(function(){f=!0,r(c.curve)&&(h=e(s,c))}),(function(){f=!1,null!==h&&(h(),h=null)}))}}(j6,_4,q6,m5,f6,V5,g5),X6=function(e,t,n,r,a,i,o,s,u,c){return function(l,h){var f=h.coneInnerAngle,d=h.coneOuterAngle,p=h.coneOuterGain,v=h.distanceModel,m=h.maxDistance,g=h.orientationX,y=h.orientationY,b=h.orientationZ,x=h.panningModel,k=h.positionX,w=h.positionY,_=h.positionZ,S=h.refDistance,C=h.rolloffFactor,T=G4(h,r5),E=l.createPanner();if(T.channelCount>2)throw o();if("max"===T.channelCountMode)throw o();D4(E,T);var I={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},A=n(l,w3(w3({},I),{},{channelInterpretation:"speakers",numberOfInputs:6})),M=r(l,w3(w3({},T),{},{gain:1})),N=r(l,w3(w3({},I),{},{gain:1})),R=r(l,w3(w3({},I),{},{gain:0})),D=r(l,w3(w3({},I),{},{gain:0})),P=r(l,w3(w3({},I),{},{gain:0})),O=r(l,w3(w3({},I),{},{gain:0})),L=r(l,w3(w3({},I),{},{gain:0})),F=a(l,256,6,1),z=i(l,w3(w3({},I),{},{curve:new Float32Array([1,1]),oversample:"none"})),B=[g,y,b],U=[k,w,_],V=new Float32Array(1);F.onaudioprocess=function(e){var t=e.inputBuffer,n=[u(t,V,0),u(t,V,1),u(t,V,2)];n.some((function(e,t){return e!==B[t]}))&&(E.setOrientation.apply(E,n),B=n);var r=[u(t,V,3),u(t,V,4),u(t,V,5)];r.some((function(e,t){return e!==U[t]}))&&(E.setPosition.apply(E,r),U=r)},Object.defineProperty(R.gain,"defaultValue",{get:function(){return 0}}),Object.defineProperty(D.gain,"defaultValue",{get:function(){return 0}}),Object.defineProperty(P.gain,"defaultValue",{get:function(){return 0}}),Object.defineProperty(O.gain,"defaultValue",{get:function(){return 0}}),Object.defineProperty(L.gain,"defaultValue",{get:function(){return 0}});var W={get bufferSize(){},get channelCount(){return E.channelCount},set channelCount(e){if(e>2)throw o();M.channelCount=e,E.channelCount=e},get channelCountMode(){return E.channelCountMode},set channelCountMode(e){if("max"===e)throw o();M.channelCountMode=e,E.channelCountMode=e},get channelInterpretation(){return E.channelInterpretation},set channelInterpretation(e){M.channelInterpretation=e,E.channelInterpretation=e},get coneInnerAngle(){return E.coneInnerAngle},set coneInnerAngle(e){E.coneInnerAngle=e},get coneOuterAngle(){return E.coneOuterAngle},set coneOuterAngle(e){E.coneOuterAngle=e},get coneOuterGain(){return E.coneOuterGain},set coneOuterGain(e){if(e<0||e>1)throw t();E.coneOuterGain=e},get context(){return E.context},get distanceModel(){return E.distanceModel},set distanceModel(e){E.distanceModel=e},get inputs(){return[M]},get maxDistance(){return E.maxDistance},set maxDistance(e){if(e<0)throw new RangeError;E.maxDistance=e},get numberOfInputs(){return E.numberOfInputs},get numberOfOutputs(){return E.numberOfOutputs},get orientationX(){return N.gain},get orientationY(){return R.gain},get orientationZ(){return D.gain},get panningModel(){return E.panningModel},set panningModel(e){E.panningModel=e},get positionX(){return P.gain},get positionY(){return O.gain},get positionZ(){return L.gain},get refDistance(){return E.refDistance},set refDistance(e){if(e<0)throw new RangeError;E.refDistance=e},get rolloffFactor(){return E.rolloffFactor},set rolloffFactor(e){if(e<0)throw new RangeError;E.rolloffFactor=e},addEventListener:function(){return M.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent:function(){return M.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener:function(){return M.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}};f!==W.coneInnerAngle&&(W.coneInnerAngle=f),d!==W.coneOuterAngle&&(W.coneOuterAngle=d),p!==W.coneOuterGain&&(W.coneOuterGain=p),v!==W.distanceModel&&(W.distanceModel=v),m!==W.maxDistance&&(W.maxDistance=m),g!==W.orientationX.value&&(W.orientationX.value=g),y!==W.orientationY.value&&(W.orientationY.value=y),b!==W.orientationZ.value&&(W.orientationZ.value=b),x!==W.panningModel&&(W.panningModel=x),k!==W.positionX.value&&(W.positionX.value=k),w!==W.positionY.value&&(W.positionY.value=w),_!==W.positionZ.value&&(W.positionZ.value=_),S!==W.refDistance&&(W.refDistance=S),C!==W.rolloffFactor&&(W.rolloffFactor=C),1===B[0]&&0===B[1]&&0===B[2]||E.setOrientation.apply(E,Tt(B)),0===U[0]&&0===U[1]&&0===U[2]||E.setPosition.apply(E,Tt(U));return c(j4(W,E),(function(){M.connect(E),e(M,z,0,0),z.connect(N).connect(A,0,0),z.connect(R).connect(A,0,1),z.connect(D).connect(A,0,2),z.connect(P).connect(A,0,3),z.connect(O).connect(A,0,4),z.connect(L).connect(A,0,5),A.connect(F).connect(l.destination)}),(function(){M.disconnect(E),s(M,z,0,0),z.disconnect(N),N.disconnect(A),z.disconnect(R),R.disconnect(A),z.disconnect(D),D.disconnect(A),z.disconnect(P),P.disconnect(A),z.disconnect(O),O.disconnect(A),z.disconnect(L),L.disconnect(A),A.disconnect(F),F.disconnect(l.destination)}))}}(j3,_4,p6,X4,a5,H6,s5,K3,v5,f6),K6=function(e){return function(t,n){var r=t.createPanner();return void 0===r.orientationX?e(t,n):(D4(r,n),O4(r,n,"orientationX"),O4(r,n,"orientationY"),O4(r,n,"orientationZ"),O4(r,n,"positionX"),O4(r,n,"positionY"),O4(r,n,"positionZ"),R4(r,n,"coneInnerAngle"),R4(r,n,"coneOuterAngle"),R4(r,n,"coneOuterGain"),R4(r,n,"distanceModel"),R4(r,n,"maxDistance"),R4(r,n,"panningModel"),R4(r,n,"refDistance"),R4(r,n,"rolloffFactor"),r)}}(X6),Y6=function(e,t,n,r,a,i,o,s,u,c){return function(){var l=new WeakMap,h=null,f=function(){var f=ns(es().mark((function f(d,p){var v,m,g,y,b,x,k;return es().wrap((function(f){for(;;)switch(f.prev=f.next){case 0:if(v=null,m=i(d),g={channelCount:m.channelCount,channelCountMode:m.channelCountMode,channelInterpretation:m.channelInterpretation},y=w3(w3({},g),{},{coneInnerAngle:m.coneInnerAngle,coneOuterAngle:m.coneOuterAngle,coneOuterGain:m.coneOuterGain,distanceModel:m.distanceModel,maxDistance:m.maxDistance,panningModel:m.panningModel,refDistance:m.refDistance,rolloffFactor:m.rolloffFactor}),b=S3(m,p),"bufferSize"in m?v=r(p,w3(w3({},g),{},{gain:1})):b||(x=w3(w3({},y),{},{orientationX:m.orientationX.value,orientationY:m.orientationY.value,orientationZ:m.orientationZ.value,positionX:m.positionX.value,positionY:m.positionY.value,positionZ:m.positionZ.value}),m=a(p,x)),l.set(p,null===v?m:v),null===v){f.next=12;break}return f.delegateYield(es().mark((function e(){var i,l,f,m,b,x,k,w,_,S,C,T,E,I;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!==h){e.next=7;break}if(null!==o){e.next=3;break}throw new Error("Missing the native OfflineAudioContext constructor.");case 3:i=new o(6,d.context.length,p.sampleRate),(l=t(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6})).connect(i.destination),h=ns(es().mark((function e(){var t,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([d.orientationX,d.orientationY,d.orientationZ,d.positionX,d.positionY,d.positionZ].map(function(){var e=ns(es().mark((function e(t,r){var a;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=n(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===r?1:0}),e.next=3,s(i,t,a.offset);case 3:return e.abrupt("return",a);case 4:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}()));case 2:for(t=e.sent,r=0;r<6;r+=1)t[r].connect(l,0,r),t[r].start(0);return e.abrupt("return",c(i));case 5:case"end":return e.stop()}}),e)})))();case 7:return e.next=9,h;case 9:return f=e.sent,m=r(p,w3(w3({},g),{},{gain:1})),e.next=13,u(d,p,m);case 13:for(b=[],x=0;x<f.numberOfChannels;x+=1)b.push(f.getChannelData(x));for(k=[b[0][0],b[1][0],b[2][0]],w=[b[3][0],b[4][0],b[5][0]],_=r(p,w3(w3({},g),{},{gain:1})),S=a(p,w3(w3({},y),{},{orientationX:k[0],orientationY:k[1],orientationZ:k[2],positionX:w[0],positionY:w[1],positionZ:w[2]})),m.connect(_).connect(S.inputs[0]),S.connect(v),C=128;C<f.length;C+=128)T=[b[0][C],b[1][C],b[2][C]],E=[b[3][C],b[4][C],b[5][C]],(T.some((function(e,t){return e!==k[t]}))||E.some((function(e,t){return e!==w[t]})))&&(k=T,w=E,I=C/p.sampleRate,_.gain.setValueAtTime(0,I),_=r(p,w3(w3({},g),{},{gain:0})),S=a(p,w3(w3({},y),{},{orientationX:k[0],orientationY:k[1],orientationZ:k[2],positionX:w[0],positionY:w[1],positionZ:w[2]})),_.gain.setValueAtTime(1,I),m.connect(_).connect(S.inputs[0]),S.connect(v));return e.abrupt("return",{v:v});case 23:case"end":return e.stop()}}),e)}))(),"t0",9);case 9:if("object"!==typeof(k=f.t0)){f.next=12;break}return f.abrupt("return",k.v);case 12:if(b){f.next=27;break}return f.next=15,s(p,d.orientationX,m.orientationX);case 15:return f.next=17,s(p,d.orientationY,m.orientationY);case 17:return f.next=19,s(p,d.orientationZ,m.orientationZ);case 19:return f.next=21,s(p,d.positionX,m.positionX);case 21:return f.next=23,s(p,d.positionY,m.positionY);case 23:return f.next=25,s(p,d.positionZ,m.positionZ);case 25:f.next=39;break;case 27:return f.next=29,e(p,d.orientationX,m.orientationX);case 29:return f.next=31,e(p,d.orientationY,m.orientationY);case 31:return f.next=33,e(p,d.orientationZ,m.orientationZ);case 33:return f.next=35,e(p,d.positionX,m.positionX);case 35:return f.next=37,e(p,d.positionY,m.positionY);case 37:return f.next=39,e(p,d.positionZ,m.positionZ);case 39:if(!G3(m)){f.next=44;break}return f.next=42,u(d,p,m.inputs[0]);case 42:f.next=46;break;case 44:return f.next=46,u(d,p,m);case 46:return f.abrupt("return",m);case 47:case"end":return f.stop()}}),f)})));return function(e,t){return f.apply(this,arguments)}}();return{render:function(e,t){var n=l.get(t);return void 0!==n?Promise.resolve(n):f(e,t)}}}}(n6,p6,x6,X4,K6,Y3,F5,a6,P5,P6),Q6=function(e,t,n,r,a,i,o){return function(e){tr(u,e);var s=sr(u);function u(e,c){var l;$n(this,u);var h=a(e),f=w3(w3({},l5),c),d=n(h,f),p=i(h),v=p?r():null;return(l=s.call(this,e,!1,d,v))._nativePannerNode=d,l._orientationX=t(ir(l),p,d.orientationX,M3,A3),l._orientationY=t(ir(l),p,d.orientationY,M3,A3),l._orientationZ=t(ir(l),p,d.orientationZ,M3,A3),l._positionX=t(ir(l),p,d.positionX,M3,A3),l._positionY=t(ir(l),p,d.positionY,M3,A3),l._positionZ=t(ir(l),p,d.positionZ,M3,A3),o(ir(l),1),l}return Jn(u,[{key:"coneInnerAngle",get:function(){return this._nativePannerNode.coneInnerAngle},set:function(e){this._nativePannerNode.coneInnerAngle=e}},{key:"coneOuterAngle",get:function(){return this._nativePannerNode.coneOuterAngle},set:function(e){this._nativePannerNode.coneOuterAngle=e}},{key:"coneOuterGain",get:function(){return this._nativePannerNode.coneOuterGain},set:function(e){this._nativePannerNode.coneOuterGain=e}},{key:"distanceModel",get:function(){return this._nativePannerNode.distanceModel},set:function(e){this._nativePannerNode.distanceModel=e}},{key:"maxDistance",get:function(){return this._nativePannerNode.maxDistance},set:function(e){this._nativePannerNode.maxDistance=e}},{key:"orientationX",get:function(){return this._orientationX}},{key:"orientationY",get:function(){return this._orientationY}},{key:"orientationZ",get:function(){return this._orientationZ}},{key:"panningModel",get:function(){return this._nativePannerNode.panningModel},set:function(e){this._nativePannerNode.panningModel=e}},{key:"positionX",get:function(){return this._positionX}},{key:"positionY",get:function(){return this._positionY}},{key:"positionZ",get:function(){return this._positionZ}},{key:"refDistance",get:function(){return this._nativePannerNode.refDistance},set:function(e){this._nativePannerNode.refDistance=e}},{key:"rolloffFactor",get:function(){return this._nativePannerNode.rolloffFactor},set:function(e){this._nativePannerNode.rolloffFactor=e}}]),u}(e)}(H5,o6,K6,Y6,L5,z5,l6),Z6=function(e){return function(t,n){var r=n.disableNormalization,a=n.imag,i=n.real,o=a instanceof Float32Array?a:new Float32Array(a),s=i instanceof Float32Array?i:new Float32Array(i),u=t.createPeriodicWave(s,o,{disableNormalization:r});if(Array.from(a).length<2)throw e();return u}}(T3),J6=function(e,t,n,r){return function(a){function i(a,o){$n(this,i);var s=t(a),u=r(w3(w3({},h5),o)),c=e(s,u);return n.add(c),c}return Jn(i,null,[{key:Symbol.hasInstance,value:function(e){return null!==e&&"object"===typeof e&&Object.getPrototypeOf(e)===i.prototype||n.has(e)}}]),i}()}(Z6,L5,new WeakSet,(function(e){var t=e.imag,n=e.real;return w3(w3({},e),{},void 0===t?void 0===n?{imag:[0,0],real:[0,0]}:{imag:Array.from(n,(function(){return 0})),real:n}:void 0===n?{imag:t,real:Array.from(t,(function(){return 0}))}:{imag:t,real:n})})),$6=function(e,t,n,r,a,i){var o=16385,s=new Float32Array([1,1]),u=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},l=w3(w3({},c),{},{oversample:"none"}),h=function(e,i,h,f,d){if(1===i)return function(e,t,a,i){for(var h=new Float32Array(o),f=new Float32Array(o),d=0;d<o;d+=1){var p=d/16384*u;h[d]=Math.cos(p),f[d]=Math.sin(p)}var v=n(e,w3(w3({},c),{},{gain:0})),m=r(e,w3(w3({},l),{},{curve:h})),g=r(e,w3(w3({},l),{},{curve:s})),y=n(e,w3(w3({},c),{},{gain:0})),b=r(e,w3(w3({},l),{},{curve:f}));return{connectGraph:function(){t.connect(v),t.connect(void 0===g.inputs?g:g.inputs[0]),t.connect(y),g.connect(a),a.connect(void 0===m.inputs?m:m.inputs[0]),a.connect(void 0===b.inputs?b:b.inputs[0]),m.connect(v.gain),b.connect(y.gain),v.connect(i,0,0),y.connect(i,0,1)},disconnectGraph:function(){t.disconnect(v),t.disconnect(void 0===g.inputs?g:g.inputs[0]),t.disconnect(y),g.disconnect(a),a.disconnect(void 0===m.inputs?m:m.inputs[0]),a.disconnect(void 0===b.inputs?b:b.inputs[0]),m.disconnect(v.gain),b.disconnect(y.gain),v.disconnect(i,0,0),y.disconnect(i,0,1)}}}(e,h,f,d);if(2===i)return function(e,a,i,h){for(var f=new Float32Array(o),d=new Float32Array(o),p=new Float32Array(o),v=new Float32Array(o),m=Math.floor(8192.5),g=0;g<o;g+=1)if(g>m){var y=(g-m)/(16384-m)*u;f[g]=Math.cos(y),d[g]=Math.sin(y),p[g]=0,v[g]=1}else{var b=g/(16384-m)*u;f[g]=1,d[g]=0,p[g]=Math.cos(b),v[g]=Math.sin(b)}var x=t(e,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),k=n(e,w3(w3({},c),{},{gain:0})),w=r(e,w3(w3({},l),{},{curve:f})),_=n(e,w3(w3({},c),{},{gain:0})),S=r(e,w3(w3({},l),{},{curve:d})),C=r(e,w3(w3({},l),{},{curve:s})),T=n(e,w3(w3({},c),{},{gain:0})),E=r(e,w3(w3({},l),{},{curve:p})),I=n(e,w3(w3({},c),{},{gain:0})),A=r(e,w3(w3({},l),{},{curve:v}));return{connectGraph:function(){a.connect(x),a.connect(void 0===C.inputs?C:C.inputs[0]),x.connect(k,0),x.connect(_,0),x.connect(T,1),x.connect(I,1),C.connect(i),i.connect(void 0===w.inputs?w:w.inputs[0]),i.connect(void 0===S.inputs?S:S.inputs[0]),i.connect(void 0===E.inputs?E:E.inputs[0]),i.connect(void 0===A.inputs?A:A.inputs[0]),w.connect(k.gain),S.connect(_.gain),E.connect(T.gain),A.connect(I.gain),k.connect(h,0,0),T.connect(h,0,0),_.connect(h,0,1),I.connect(h,0,1)},disconnectGraph:function(){a.disconnect(x),a.disconnect(void 0===C.inputs?C:C.inputs[0]),x.disconnect(k,0),x.disconnect(_,0),x.disconnect(T,1),x.disconnect(I,1),C.disconnect(i),i.disconnect(void 0===w.inputs?w:w.inputs[0]),i.disconnect(void 0===S.inputs?S:S.inputs[0]),i.disconnect(void 0===E.inputs?E:E.inputs[0]),i.disconnect(void 0===A.inputs?A:A.inputs[0]),w.disconnect(k.gain),S.disconnect(_.gain),E.disconnect(T.gain),A.disconnect(I.gain),k.disconnect(h,0,0),T.disconnect(h,0,0),_.disconnect(h,0,1),I.disconnect(h,0,1)}}}(e,h,f,d);throw a()};return function(t,r){var o=r.channelCount,s=r.channelCountMode,u=r.pan,c=G4(r,i5);if("max"===s)throw a();var l=e(t,w3(w3({},c),{},{channelCount:1,channelCountMode:s,numberOfInputs:2})),f=n(t,w3(w3({},c),{},{channelCount:o,channelCountMode:s,gain:1})),d=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:u}),p=h(t,o,f,d,l),v=p.connectGraph,m=p.disconnectGraph;Object.defineProperty(d.gain,"defaultValue",{get:function(){return 0}}),Object.defineProperty(d.gain,"maxValue",{get:function(){return 1}}),Object.defineProperty(d.gain,"minValue",{get:function(){return-1}});var g={get bufferSize(){},get channelCount(){return f.channelCount},set channelCount(e){if(f.channelCount!==e){y&&m();var n=h(t,e,f,d,l);v=n.connectGraph,m=n.disconnectGraph,y&&v()}f.channelCount=e},get channelCountMode(){return f.channelCountMode},set channelCountMode(e){if("clamped-max"===e||"max"===e)throw a();f.channelCountMode=e},get channelInterpretation(){return f.channelInterpretation},set channelInterpretation(e){f.channelInterpretation=e},get context(){return f.context},get inputs(){return[f]},get numberOfInputs(){return f.numberOfInputs},get numberOfOutputs(){return f.numberOfOutputs},get pan(){return d.gain},addEventListener:function(){return f.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},dispatchEvent:function(){return f.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener:function(){return f.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}},y=!1;return i(j4(g,l),(function(){v(),y=!0}),(function(){m(),y=!1}))}}(p6,W4,X4,H6,s5,f6),e8=function(e,t){return function(n,r){var a=r.channelCountMode;if("clamped-max"===a)throw t();if(void 0===n.createStereoPanner)return e(n,r);var i=n.createStereoPanner();return D4(i,r),O4(i,r,"pan"),Object.defineProperty(i,"channelCountMode",{get:function(){return a},set:function(e){if(e!==a)throw t()}}),i}}($6,s5),t8=function(e,t,n,r,a){return function(){var i=new WeakMap,o=function(){var o=ns(es().mark((function o(s,u){var c,l,h;return es().wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(c=n(s),(l=S3(c,u))||(h={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,pan:c.pan.value},c=t(u,h)),i.set(u,c),l){o.next=9;break}return o.next=7,r(u,s.pan,c.pan);case 7:o.next=11;break;case 9:return o.next=11,e(u,s.pan,c.pan);case 11:if(!G3(c)){o.next=16;break}return o.next=14,a(s,u,c.inputs[0]);case 14:o.next=18;break;case 16:return o.next=18,a(s,u,c);case 18:return o.abrupt("return",c);case 19:case"end":return o.stop()}}),o)})));return function(e,t){return o.apply(this,arguments)}}();return{render:function(e,t){var n=i.get(t);return void 0!==n?Promise.resolve(n):o(e,t)}}}}(n6,e8,Y3,a6,P5),n8=function(e,t,n,r,a,i){return function(e){tr(s,e);var o=sr(s);function s(e,u){var c;$n(this,s);var l=a(e),h=w3(w3({},f5),u),f=n(l,h),d=i(l),p=d?r():null;return(c=o.call(this,e,!1,f,p))._pan=t(ir(c),d,f.pan),c}return Jn(s,[{key:"pan",get:function(){return this._pan}}]),s}(e)}(H5,o6,e8,t8,L5,z5),r8=function(e,t,n){return function(){var r=new WeakMap,a=function(){var a=ns(es().mark((function a(i,o){var s,u;return es().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(s=t(i),S3(s,o)||(u={channelCount:s.channelCount,channelCountMode:s.channelCountMode,channelInterpretation:s.channelInterpretation,curve:s.curve,oversample:s.oversample},s=e(o,u)),r.set(o,s),!G3(s)){a.next=9;break}return a.next=7,n(i,o,s.inputs[0]);case 7:a.next=11;break;case 9:return a.next=11,n(i,o,s);case 11:return a.abrupt("return",s);case 12:case"end":return a.stop()}}),a)})));return function(e,t){return a.apply(this,arguments)}}();return{render:function(e,t){var n=r.get(t);return void 0!==n?Promise.resolve(n):a(e,t)}}}}(H6,Y3,P5),a8=function(e,t,n,r,a,i,o){return function(e){tr(u,e);var s=sr(u);function u(e,t){var c;$n(this,u);var l=a(e),h=w3(w3({},p5),t),f=n(l,h),d=i(l)?r():null;return(c=s.call(this,e,!0,f,d))._isCurveNullified=!1,c._nativeWaveShaperNode=f,o(ir(c),1),c}return Jn(u,[{key:"curve",get:function(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve},set:function(e){if(null===e)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(e.length<2)throw t();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=e}}},{key:"oversample",get:function(){return this._nativeWaveShaperNode.oversample},set:function(e){this._nativeWaveShaperNode.oversample=e}}]),u}(e)}(H5,_4,H6,r8,L5,z5,l6),i8=function(e){return null!==e&&e.isSecureContext}(N5),o8=function(e){return function(t,n,r){Object.defineProperties(e,{currentFrame:{configurable:!0,get:function(){return Math.round(t*n)}},currentTime:{configurable:!0,get:function(){return t}}});try{return r()}finally{null!==e&&(delete e.currentFrame,delete e.currentTime)}}}(N5),s8=new WeakMap,u8=function(e,t){return function(n){var r=e.get(n);if(void 0!==r)return r;if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");return r=new t(1,1,44100),e.set(n,r),r}}(s8,F5),c8=i8?function(e,t,n,r,a,i,o,s,u,c,l,h,d){var p=0;return function(v,m){var g=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{credentials:"omit"},y=l.get(v);if(void 0!==y&&y.has(m))return Promise.resolve();var b=c.get(v);if(void 0!==b){var x=b.get(m);if(void 0!==x)return x}var k=i(v),w=void 0===k.audioWorklet?a(m).then((function(e){var t=f(e,2),r=t[0],a=t[1],i=f(l3(r,a),2),o=i[0],s=i[1],u="".concat(o,";((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{").concat(s,"\n})})(window,'_AWGS')");return n(u)})).then((function(){var e=d._AWGS.pop();if(void 0===e)throw new SyntaxError;r(k.currentTime,k.sampleRate,(function(){return e(Jn((function e(){$n(this,e)})),void 0,(function(e,n){if(""===e.trim())throw t();var r=o3.get(k);if(void 0!==r){if(r.has(e))throw t();f3(n),h3(n.parameterDescriptors),r.set(e,n)}else f3(n),h3(n.parameterDescriptors),o3.set(k,new Map([[e,n]]))}),k.sampleRate,void 0,void 0)}))})):Promise.all([a(m),Promise.resolve(e(h,h))]).then((function(e){var t=f(e,2),n=f(t[0],2),r=n[0],a=n[1],i=t[1],c=p+1;p=c;var l=f(l3(r,a),2),h=l[0],d=l[1],v=i?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}",m=i?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));",y=i?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));",b="".concat(h,";((AudioWorkletProcessor,registerProcessor)=>{").concat(d,"\n})(").concat(v,",(n,p)=>registerProcessor(n,class extends p{").concat(m,"process(i,o,p){").concat(y,"return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac").concat(c,"',class extends AudioWorkletProcessor{process(){return !1}})"),x=new Blob([b],{type:"application/javascript; charset=utf-8"}),w=URL.createObjectURL(x);return k.audioWorklet.addModule(w,g).then((function(){if(s(k))return k;var e=o(k);return e.audioWorklet.addModule(w,g).then((function(){return e}))})).then((function(e){if(null===u)throw new SyntaxError;try{new u(e,"__sac".concat(c))}catch(t){throw new SyntaxError}})).finally((function(){return URL.revokeObjectURL(w)}))}));return void 0===b?c.set(v,new Map([[m,w]])):b.set(m,w),w.then((function(){var e=l.get(v);void 0===e?l.set(v,new Set([m])):e.add(m)})).finally((function(){var e=c.get(v);void 0!==e&&e.delete(m)})),w}}(M5,s5,function(e){return function(t){return new Promise((function(n,r){if(null!==e){var a=e.document.head;if(null===a)r(new SyntaxError);else{var i=e.document.createElement("script"),o=new Blob([t],{type:"application/javascript"}),s=URL.createObjectURL(o),u=e.onerror,c=function(){e.onerror=u,URL.revokeObjectURL(s)};e.onerror=function(t,n,a,i,o){return n===s||n===e.location.href&&1===a&&1===i?(c(),r(o),!1):null!==u?u(t,n,a,i,o):void 0},i.onerror=function(){c(),r(new SyntaxError)},i.onload=function(){c(),n()},i.src=s,i.type="module",a.appendChild(i)}}else r(new SyntaxError)}))}}(N5),o8,function(e){return function(){var t=ns(es().mark((function t(n){var r;return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch(n);case 3:if(!(r=t.sent).ok){t.next=10;break}return t.next=7,r.text();case 7:return t.t0=t.sent,t.t1=r.url,t.abrupt("return",[t.t0,t.t1]);case 10:t.next=14;break;case 12:t.prev=12,t.t2=t.catch(0);case 14:throw e();case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(e){return t.apply(this,arguments)}}()}((function(){return new DOMException("","AbortError")})),L5,u8,z5,q5,new WeakMap,new WeakMap,function(e,t){return ns(es().mark((function n(){var r,a,i,o,s,u,c;return es().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!==e){n.next=2;break}return n.abrupt("return",!0);case 2:if(null!==t){n.next=4;break}return n.abrupt("return",!1);case 4:return r=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),a=new t(1,128,44100),i=URL.createObjectURL(r),o=!1,s=!1,n.prev=9,n.next=12,a.audioWorklet.addModule(i);case 12:return u=new e(a,"a",{numberOfOutputs:0}),c=a.createOscillator(),u.port.onmessage=function(){return o=!0},u.onprocessorerror=function(){return s=!0},c.connect(u),c.start(0),n.next=20,a.startRendering();case 20:n.next=24;break;case 22:n.prev=22,n.t0=n.catch(9);case 24:return n.prev=24,URL.revokeObjectURL(i),n.finish(24);case 27:return n.abrupt("return",o&&!s);case 28:case"end":return n.stop()}}),n,null,[[9,22,24,27]])})))}(q5,F5),N5):void 0,l8=function(e,t){return function(n){return e(n)||t(n)}}(W5,z5),h8=function(e,t,n,r,a,i,o,s,u,c,l){return function(h,f){var d=o(h)?h:i(h);if(a.has(f)){var p=n();return Promise.reject(p)}try{a.add(f)}catch(v){}return t(u,(function(){return u(d)}))?d.decodeAudioData(f).then((function(n){return y4(f).catch((function(){})),t(s,(function(){return s(n)}))||l(n),e.add(n),n})):new Promise((function(t,n){var a=function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y4(f);case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(){return e.apply(this,arguments)}}(),i=function(e){n(e),a()};try{d.decodeAudioData(f,(function(n){"function"!==typeof n.copyFromChannel&&(c(n),E3(n)),e.add(n),a().then((function(){return t(n)}))}),(function(e){i(null===e?r():e)}))}catch(p){i(p)}}))}}(K5,M5,(function(){return new DOMException("","DataCloneError")}),(function(){return new DOMException("","EncodingError")}),new WeakSet,L5,l8,C3,M4,Z5,J5),f8=function(e,t,n,r,a,i,o,s,u,c,l,h,f,d,p,v,m,g,y,b){return function(p){tr(k,p);var x=sr(k);function k(t,n){var r;return $n(this,k),(r=x.call(this,t,n))._nativeContext=t,r._audioWorklet=void 0===e?void 0:{addModule:function(t,n){return e(ir(r),t,n)}},r}return Jn(k,[{key:"audioWorklet",get:function(){return this._audioWorklet}},{key:"createAnalyser",value:function(){return new t(this)}},{key:"createBiquadFilter",value:function(){return new a(this)}},{key:"createBuffer",value:function(e,t,r){return new n({length:t,numberOfChannels:e,sampleRate:r})}},{key:"createBufferSource",value:function(){return new r(this)}},{key:"createChannelMerger",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return new i(this,{numberOfInputs:e})}},{key:"createChannelSplitter",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:6;return new o(this,{numberOfOutputs:e})}},{key:"createConstantSource",value:function(){return new s(this)}},{key:"createConvolver",value:function(){return new u(this)}},{key:"createDelay",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return new l(this,{maxDelayTime:e})}},{key:"createDynamicsCompressor",value:function(){return new h(this)}},{key:"createGain",value:function(){return new f(this)}},{key:"createIIRFilter",value:function(e,t){return new d(this,{feedback:t,feedforward:e})}},{key:"createOscillator",value:function(){return new v(this)}},{key:"createPanner",value:function(){return new m(this)}},{key:"createPeriodicWave",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{disableNormalization:!1};return new g(this,w3(w3({},n),{},{imag:t,real:e}))}},{key:"createStereoPanner",value:function(){return new y(this)}},{key:"createWaveShaper",value:function(){return new b(this)}},{key:"decodeAudioData",value:function(e,t,n){return c(this._nativeContext,e).then((function(e){return"function"===typeof t&&t(e),e}),(function(e){throw"function"===typeof n&&n(e),e}))}}]),k}(p)}(c8,X5,$5,s6,h6,m6,y6,w6,C6,h8,E6,M6,R6,F6,U6,G6,Q6,J6,n8,a8),d8=function(e,t,n,r){return function(e){tr(i,e);var a=sr(i);function i(e,o){var s;$n(this,i);var u=n(e),c=t(u,o);if(r(u))throw TypeError();return(s=a.call(this,e,!0,c,null))._nativeMediaElementAudioSourceNode=c,s}return Jn(i,[{key:"mediaElement",get:function(){return this._nativeMediaElementAudioSourceNode.mediaElement}}]),i}(e)}(H5,(function(e,t){return e.createMediaElementSource(t.mediaElement)}),L5,z5),p8=function(e,t,n,r){return function(e){tr(i,e);var a=sr(i);function i(e,o){var s;$n(this,i);var u=n(e);if(r(u))throw new TypeError;var c=w3(w3({},A4),o),l=t(u,c);return(s=a.call(this,e,!1,l,null))._nativeMediaStreamAudioDestinationNode=l,s}return Jn(i,[{key:"stream",get:function(){return this._nativeMediaStreamAudioDestinationNode.stream}}]),i}(e)}(H5,(function(e,t){var n=e.createMediaStreamDestination();return D4(n,t),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:function(){return 0}}),n}),L5,z5),v8=function(e,t,n,r){return function(e){tr(i,e);var a=sr(i);function i(e,o){var s;$n(this,i);var u=n(e),c=t(u,o);if(r(u))throw new TypeError;return(s=a.call(this,e,!0,c,null))._nativeMediaStreamAudioSourceNode=c,s}return Jn(i,[{key:"mediaStream",get:function(){return this._nativeMediaStreamAudioSourceNode.mediaStream}}]),i}(e)}(H5,(function(e,t){var n=t.mediaStream,r=n.getAudioTracks();r.sort((function(e,t){return e.id<t.id?-1:e.id>t.id?1:0}));var a=r.slice(0,1),i=e.createMediaStreamSource(new MediaStream(a));return Object.defineProperty(i,"mediaStream",{value:n}),i}),L5,z5),m8=function(e,t){return function(n,r){var a=r.mediaStreamTrack;if("function"===typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(a);var i=new MediaStream([a]),o=n.createMediaStreamSource(i);if("audio"!==a.kind)throw e();if(t(n))throw new TypeError;return o}}(_4,z5),g8=function(e,t,n){return function(e){tr(a,e);var r=sr(a);function a(e,i){$n(this,a);var o=n(e),s=t(o,i);return r.call(this,e,!0,s,null)}return Jn(a)}(e)}(H5,m8,L5),y8=function(e,t,n,r,a,i,o,s,u){return function(e){tr(l,e);var c=sr(l);function l(){var e,t,a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if($n(this,l),null===u)throw new Error("Missing the native AudioContext constructor.");try{t=new u(a)}catch($Pe){if(12===$Pe.code&&"sampleRate is not in range"===$Pe.message)throw n();throw $Pe}if(null===t)throw r();if(!F3(a.latencyHint))throw new TypeError("The provided value '".concat(a.latencyHint,"' is not a valid enum value of type AudioContextLatencyCategory."));if(void 0!==a.sampleRate&&t.sampleRate!==a.sampleRate)throw n();e=c.call(this,t,2);var i=a.latencyHint,o=t,s=o.sampleRate;if(e._baseLatency="number"===typeof t.baseLatency?t.baseLatency:"balanced"===i?512/s:"interactive"===i||void 0===i?256/s:"playback"===i?1024/s:128*Math.max(2,Math.min(128,Math.round(i*s/128)))/s,e._nativeAudioContext=t,"webkitAudioContext"===u.name?(e._nativeGainNode=t.createGain(),e._nativeOscillatorNode=t.createOscillator(),e._nativeGainNode.gain.value=1e-37,e._nativeOscillatorNode.connect(e._nativeGainNode).connect(t.destination),e._nativeOscillatorNode.start()):(e._nativeGainNode=null,e._nativeOscillatorNode=null),e._state=null,"running"===t.state){e._state="suspended";var h=function n(){"suspended"===e._state&&(e._state=null),t.removeEventListener("statechange",n)};t.addEventListener("statechange",h)}return e}return Jn(l,[{key:"baseLatency",get:function(){return this._baseLatency}},{key:"state",get:function(){return null!==this._state?this._state:this._nativeAudioContext.state}},{key:"close",value:function(){var e=this;return"closed"===this.state?this._nativeAudioContext.close().then((function(){throw t()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((function(){null!==e._nativeGainNode&&null!==e._nativeOscillatorNode&&(e._nativeOscillatorNode.stop(),e._nativeGainNode.disconnect(),e._nativeOscillatorNode.disconnect()),L3(e)})))}},{key:"createMediaElementSource",value:function(e){return new a(this,{mediaElement:e})}},{key:"createMediaStreamDestination",value:function(){return new i(this)}},{key:"createMediaStreamSource",value:function(e){return new o(this,{mediaStream:e})}},{key:"createMediaStreamTrackSource",value:function(e){return new s(this,{mediaStreamTrack:e})}},{key:"resume",value:function(){var e=this;return"suspended"===this._state?new Promise((function(t,n){e._nativeAudioContext.addEventListener("statechange",(function r(){e._nativeAudioContext.removeEventListener("statechange",r),"running"===e._nativeAudioContext.state?t():e.resume().then(t,n)}))})):this._nativeAudioContext.resume().catch((function(e){if(void 0===e||15===e.code)throw t();throw e}))}},{key:"suspend",value:function(){return this._nativeAudioContext.suspend().catch((function(e){if(void 0===e)throw t();throw e}))}}]),l}(e)}(f8,_4,s5,d5,d8,p8,v8,g8,V5),b8=function(e){return function(t){var n=e.get(t);if(void 0===n)throw new Error("The context has no set of AudioWorkletNodes.");return n}}(B6),x8=function(e){return function(t,n){e(t).add(n)}}(b8),k8=function(e){return function(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,i=t[r];if(void 0===i)throw e();return t4(n)?i.connect(n,0,a):i.connect(n,0)}}(T3),w8=function(e){return function(t,n){e(t).delete(n)}}(b8),_8=function(e){return function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return void 0===n?t.forEach((function(e){return e.disconnect()})):"number"===typeof n?x4(e,t,n).disconnect():t4(n)?void 0===r?t.forEach((function(e){return e.disconnect(n)})):void 0===a?x4(e,t,r).disconnect(n,0):x4(e,t,r).disconnect(n,0,a):void 0===r?t.forEach((function(e){return e.disconnect(n)})):x4(e,t,r).disconnect(n,0)}}(T3),S8=new WeakMap,C8=function(e,t){return function(n){return t(e,n)}}(S8,d3),T8=function(e,t,n,r,a,i,o,s,u,c,l,h,f){return function(d,p,v,m){if(0===m.numberOfInputs&&0===m.numberOfOutputs)throw u();var g=Array.isArray(m.outputChannelCount)?m.outputChannelCount:Array.from(m.outputChannelCount);if(g.some((function(e){return e<1})))throw u();if(g.length!==m.numberOfOutputs)throw t();if("explicit"!==m.channelCountMode)throw u();var y=m.channelCount*m.numberOfInputs,b=g.reduce((function(e,t){return e+t}),0),x=void 0===v.parameterDescriptors?0:v.parameterDescriptors.length;if(y+x>6||b>6)throw u();for(var k=new MessageChannel,w=[],_=[],S=0;S<m.numberOfInputs;S+=1)w.push(o(d,{channelCount:m.channelCount,channelCountMode:m.channelCountMode,channelInterpretation:m.channelInterpretation,gain:1})),_.push(a(d,{channelCount:m.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:m.channelCount}));var C=[];if(void 0!==v.parameterDescriptors){var T,E=al(v.parameterDescriptors);try{var I=function(){var e=T.value,t=e.defaultValue,n=e.maxValue,r=e.minValue,a=e.name,o=i(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==m.parameterData[a]?m.parameterData[a]:void 0===t?0:t});Object.defineProperties(o.offset,{defaultValue:{get:function(){return void 0===t?0:t}},maxValue:{get:function(){return void 0===n?M3:n}},minValue:{get:function(){return void 0===r?A3:r}}}),C.push(o)};for(E.s();!(T=E.n()).done;)I()}catch($Pe){E.e($Pe)}finally{E.f()}}for(var A=r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,y+x)}),M=z4(p,d.sampleRate),N=s(d,M,y+x,Math.max(1,b)),R=a(d,{channelCount:Math.max(1,b),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,b)}),D=[],P=0;P<m.numberOfOutputs;P+=1)D.push(r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:g[P]}));for(var O=0;O<m.numberOfInputs;O+=1){w[O].connect(_[O]);for(var L=0;L<m.channelCount;L+=1)_[O].connect(A,L,O*m.channelCount+L)}var F=new o4(void 0===v.parameterDescriptors?[]:v.parameterDescriptors.map((function(e,t){var n=e.name,r=C[t];return r.connect(A,0,y+t),r.start(0),[n,r.offset]})));A.connect(N);var z,B,U=m.channelInterpretation,V=null,W=0===m.numberOfOutputs?[N]:D,G={get bufferSize(){return M},get channelCount(){return m.channelCount},set channelCount(e){throw n()},get channelCountMode(){return m.channelCountMode},set channelCountMode(e){throw n()},get channelInterpretation(){return U},set channelInterpretation(e){var t,n=al(w);try{for(n.s();!(t=n.n()).done;){t.value.channelInterpretation=e}}catch($Pe){n.e($Pe)}finally{n.f()}U=e},get context(){return N.context},get inputs(){return w},get numberOfInputs(){return m.numberOfInputs},get numberOfOutputs(){return m.numberOfOutputs},get onprocessorerror(){return V},set onprocessorerror(e){"function"===typeof V&&G.removeEventListener("processorerror",V),"function"===typeof(V="function"===typeof e?e:null)&&G.addEventListener("processorerror",V)},get parameters(){return F},get port(){return k.port2},addEventListener:function(){return N.addEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},connect:e.bind(null,W),disconnect:c.bind(null,W),dispatchEvent:function(){return N.dispatchEvent(arguments.length<=0?void 0:arguments[0])},removeEventListener:function(){return N.removeEventListener(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])}},j=new Map;k.port1.addEventListener=(z=k.port1.addEventListener,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("message"===t[0]){var r="function"===typeof t[1]?t[1]:"object"===typeof t[1]&&null!==t[1]&&"function"===typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==r){var a=j.get(t[1]);void 0!==a?t[1]=a:(t[1]=function(e){l(d.currentTime,d.sampleRate,(function(){return r(e)}))},j.set(r,t[1]))}}return z.call(k.port1,t[0],t[1],t[2])}),k.port1.removeEventListener=(B=k.port1.removeEventListener,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("message"===t[0]){var r=j.get(t[1]);void 0!==r&&(j.delete(t[1]),t[1]=r)}return B.call(k.port1,t[0],t[1],t[2])});var q=null;Object.defineProperty(k.port1,"onmessage",{get:function(){return q},set:function(e){"function"===typeof q&&k.port1.removeEventListener("message",q),"function"===typeof(q="function"===typeof e?e:null)&&(k.port1.addEventListener("message",q),k.port1.start())}}),v.prototype.port=k.port1;var H=null,X=function(e,t,n,r){var a=s3.get(e);void 0===a&&(a=new WeakMap,s3.set(e,a));var i=U4(n,r);return a.set(t,i),i}(d,G,v,m);X.then((function(e){return H=e}));var K=l4(m.numberOfInputs,m.channelCount),Y=l4(m.numberOfOutputs,g),Q=void 0===v.parameterDescriptors?[]:v.parameterDescriptors.reduce((function(e,t){var n=t.name;return w3(w3({},e),{},IE({},n,new Float32Array(128)))}),{}),Z=!0,J=function(){m.numberOfOutputs>0&&N.disconnect(R);for(var e=0,t=0;e<m.numberOfOutputs;e+=1){for(var n=D[e],r=0;r<g[e];r+=1)R.disconnect(n,t+r,r);t+=g[e]}},$=new Map;N.onaudioprocess=function(e){var t=e.inputBuffer,n=e.outputBuffer;null!==H&&function(){for(var e=h(G),r=function(r){for(var a=0;a<m.numberOfInputs;a+=1)for(var i=0;i<m.channelCount;i+=1)u4(t,K[a],i,i,r);void 0!==v.parameterDescriptors&&v.parameterDescriptors.forEach((function(e,n){var a=e.name;u4(t,Q,a,y+n,r)}));for(var o=0;o<m.numberOfInputs;o+=1)for(var s=0;s<g[o];s+=1)0===Y[o][s].byteLength&&(Y[o][s]=new Float32Array(128));try{var u=K.map((function(t,n){if(e[n].size>0)return $.set(n,M/128),t;var r=$.get(n);return void 0===r?[]:(t.every((function(e){return e.every((function(e){return 0===e}))}))&&(1===r?$.delete(n):$.set(n,r-1)),t)})),c=l(d.currentTime+r/d.sampleRate,d.sampleRate,(function(){return H.process(u,Y,Q)}));Z=c;for(var h=0,f=0;h<m.numberOfOutputs;h+=1){for(var p=0;p<g[h];p+=1)c4(n,Y[h],p,f+p,r);f+=g[h]}}catch(E){Z=!1,G.dispatchEvent(new ErrorEvent("processorerror",{colno:E.colno,filename:E.filename,lineno:E.lineno,message:E.message}))}if(!Z){for(var b=0;b<m.numberOfInputs;b+=1){w[b].disconnect(_[b]);for(var x=0;x<m.channelCount;x+=1)_[r].disconnect(A,x,b*m.channelCount+x)}if(void 0!==v.parameterDescriptors)for(var k=v.parameterDescriptors.length,S=0;S<k;S+=1){var T=C[S];T.disconnect(A,0,y+S),T.stop()}return A.disconnect(N),N.onaudioprocess=null,ee?J():re(),"break"}},a=0;a<M;a+=128){if("break"===r(a))break}}()};var ee=!1,te=o(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),ne=function(){return N.connect(te).connect(d.destination)},re=function(){N.disconnect(te),te.disconnect()};return ne(),f(G,(function(){if(Z){re(),m.numberOfOutputs>0&&N.connect(R);for(var e=0,t=0;e<m.numberOfOutputs;e+=1){for(var n=D[e],r=0;r<g[e];r+=1)R.connect(n,t+r,r);t+=g[e]}}ee=!0}),(function(){Z&&(ne(),J()),ee=!1}))}}(k8,T3,_4,p6,W4,x6,X4,a5,s5,_8,o8,C8,f6),E8=function(e,t,n,r,a){return function(i,o,s,u,c,l){if(null!==s)try{var h=new s(i,u,l),f=new Map,d=null;if(Object.defineProperties(h,{channelCount:{get:function(){return l.channelCount},set:function(){throw e()}},channelCountMode:{get:function(){return"explicit"},set:function(){throw e()}},onprocessorerror:{get:function(){return d},set:function(e){"function"===typeof d&&h.removeEventListener("processorerror",d),"function"===typeof(d="function"===typeof e?e:null)&&h.addEventListener("processorerror",d)}}}),h.addEventListener=(m=h.addEventListener,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("processorerror"===t[0]){var r="function"===typeof t[1]?t[1]:"object"===typeof t[1]&&null!==t[1]&&"function"===typeof t[1].handleEvent?t[1].handleEvent:null;if(null!==r){var a=f.get(t[1]);void 0!==a?t[1]=a:(t[1]=function(e){"error"===e.type?(Object.defineProperties(e,{type:{value:"processorerror"}}),r(e)):r(new ErrorEvent(t[0],w3({},e)))},f.set(r,t[1]))}}return m.call(h,"error",t[1],t[2]),m.call.apply(m,[h].concat(t))}),h.removeEventListener=(v=h.removeEventListener,function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if("processorerror"===t[0]){var r=f.get(t[1]);void 0!==r&&(f.delete(t[1]),t[1]=r)}return v.call(h,"error",t[1],t[2]),v.call(h,t[0],t[1],t[2])}),0!==l.numberOfOutputs){var p=n(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});h.connect(p).connect(i.destination);return a(h,(function(){return p.disconnect()}),(function(){return p.connect(i.destination)}))}return h}catch($Pe){if(11===$Pe.code)throw r();throw $Pe}var v,m;if(void 0===c)throw r();return function(e){var t=(new MessageChannel).port1;try{t.postMessage(e)}finally{t.close()}}(l),t(i,o,c,l)}}(_4,T8,X4,s5,f6),I8=function(e,t,n,r,a,i,o,s,u,c,l,h,d,p,v,m){return function(g,y,b){var x=new WeakMap,k=null,w=function(){var s=ns(es().mark((function s(w,_){var S,C,T,E,I,A,M,N,R,D,P,O,L,F,z,B,U,V,W,G,j,q,H,X,K,Y,Q,Z,J,$,ee,te,ne;return es().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(S=l(w),C=null,T=S3(S,_),E=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount),null===h){for(I=E.reduce((function(e,t){return e+t}),0),A=a(_,{channelCount:Math.max(1,I),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,I)}),M=[],N=0;N<w.numberOfOutputs;N+=1)M.push(r(_,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:E[N]}));(R=o(_,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})).connect=t.bind(null,M),R.disconnect=u.bind(null,M),C=[A,M,R]}else T||(S=new h(_,g));if(x.set(_,null===C?S:C[2]),null===C){s.next=41;break}if(null!==k){s.next=32;break}if(void 0!==b){s.next=10;break}throw new Error("Missing the processor constructor.");case 10:if(null!==d){s.next=12;break}throw new Error("Missing the native OfflineAudioContext constructor.");case 12:if(D=w.channelCount*w.numberOfInputs,P=void 0===b.parameterDescriptors?0:b.parameterDescriptors.length,O=D+P,L=function(){var e=ns(es().mark((function e(){var t,n,s,u,c,l,h,g,b,x,k,S,C;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t=new d(O,128*Math.ceil(w.context.length/128),_.sampleRate),n=[],s=[],u=0;u<y.numberOfInputs;u+=1)n.push(o(t,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),s.push(a(t,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));return e.next=6,Promise.all(Array.from(w.parameters.values()).map(function(){var e=ns(es().mark((function e(n){var r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:n.value}),e.next=3,p(t,n,r.offset);case 3:return e.abrupt("return",r);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()));case 6:for(c=e.sent,l=r(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,D+P)}),h=0;h<y.numberOfInputs;h+=1)for(n[h].connect(s[h]),g=0;g<y.channelCount;g+=1)s[h].connect(l,g,h*y.channelCount+g);b=al(c.entries());try{for(b.s();!(x=b.n()).done;)k=f(x.value,2),S=k[0],(C=k[1]).connect(l,0,D+S),C.start(0)}catch($Pe){b.e($Pe)}finally{b.f()}return l.connect(t.destination),e.next=14,Promise.all(n.map((function(e){return v(w,t,e)})));case 14:return e.abrupt("return",m(t));case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),s.t0=f4,s.t1=w,0!==O){s.next=22;break}s.t2=null,s.next=25;break;case 22:return s.next=24,L();case 24:s.t2=s.sent;case 25:s.t3=s.t2,s.t4=_,s.t5=y,s.t6=E,s.t7=b,s.t8=c,k=(0,s.t0)(s.t1,s.t3,s.t4,s.t5,s.t6,s.t7,s.t8);case 32:return s.next=34,k;case 34:for(F=s.sent,z=n(_,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),B=f(C,3),U=B[0],V=B[1],W=B[2],null!==F&&(z.buffer=F,z.start(0)),z.connect(U),G=0,j=0;G<w.numberOfOutputs;G+=1){for(q=V[G],H=0;H<E[G];H+=1)U.connect(q,j+H,H);j+=E[G]}return s.abrupt("return",W);case 41:if(T){s.next=61;break}X=al(w.parameters.entries()),s.prev=43,X.s();case 45:if((K=X.n()).done){s.next=51;break}return Y=f(K.value,2),Q=Y[0],Z=Y[1],s.next=49,p(_,Z,S.parameters.get(Q));case 49:s.next=45;break;case 51:s.next=56;break;case 53:s.prev=53,s.t9=s.catch(43),X.e(s.t9);case 56:return s.prev=56,X.f(),s.finish(56);case 59:s.next=78;break;case 61:J=al(w.parameters.entries()),s.prev=62,J.s();case 64:if(($=J.n()).done){s.next=70;break}return ee=f($.value,2),te=ee[0],ne=ee[1],s.next=68,e(_,ne,S.parameters.get(te));case 68:s.next=64;break;case 70:s.next=75;break;case 72:s.prev=72,s.t10=s.catch(62),J.e(s.t10);case 75:return s.prev=75,J.f(),s.finish(75);case 78:return s.next=80,v(w,_,S);case 80:return s.abrupt("return",S);case 81:case"end":return s.stop()}}),s,null,[[43,53,56,59],[62,72,75,78]])})));return function(e,t){return s.apply(this,arguments)}}();return{render:function(e,t){s(t,e);var n=x.get(t);return void 0!==n?Promise.resolve(n):w(e,t)}}}}(n6,k8,r6,p6,W4,x6,X4,w8,_8,o8,Y3,q5,F5,a6,P5,P6),A8=function(e){return function(t){return e.get(t)}}(s8),M8=function(e){return function(t,n){e.set(t,n)}}(S8),N8=i8?function(e,t,n,r,a,i,o,s,u,c,l,h,f,d){return function(t){tr(v,t);var p=sr(v);function v(t,d,m){var g,y;$n(this,v);var b=s(t),x=u(b),k=l(w3(w3({},s4),m));f(k);var w=o3.get(b),_=null===w||void 0===w?void 0:w.get(d),S=x||"closed"!==b.state?b:null!==(y=o(b))&&void 0!==y?y:b,C=a(S,x?null:t.baseLatency,c,d,_,k),T=x?r(d,k,_):null;g=p.call(this,t,!0,C,T);var E=[];C.parameters.forEach((function(e,t){var r=n(ir(g),x,e);E.push([t,r])})),g._nativeAudioWorkletNode=C,g._onprocessorerror=null,g._parameters=new o4(E),x&&e(b,ir(g));var I=i(ir(g)).activeInputs;return h(C,I),g}return Jn(v,[{key:"onprocessorerror",get:function(){return this._onprocessorerror},set:function(e){var t="function"===typeof e?d(this,e):null;this._nativeAudioWorkletNode.onprocessorerror=t;var n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===t?e:n}},{key:"parameters",get:function(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}},{key:"port",get:function(){return this._nativeAudioWorkletNode.port}}]),v}(t)}(x8,H5,o6,I8,E8,D3,A8,L5,z5,q5,(function(e){return w3(w3({},e),{},{outputChannelCount:void 0!==e.outputChannelCount?e.outputChannelCount:1===e.numberOfInputs&&1===e.numberOfOutputs?[e.channelCount]:Array.from({length:e.numberOfOutputs},(function(){return 1}))})}),M8,(function(e){var t=new MessageChannel,n=t.port1,r=t.port2;try{n.postMessage(e)}finally{n.close(),r.close()}}),S5):void 0,R8=(function(e,t,n,r,a){}(_4,s5,d5,U6,V5),function(e,t){return function(n,r,a){if(null===t)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new t(n,r,a)}catch($Pe){if("SyntaxError"===$Pe.name)throw e();throw $Pe}}}(s5,F5)),D8=function(e,t,n,r,a,i,o,s){return function(u,c){return n(u).render(u,c).then((function(){return Promise.all(Array.from(r(c)).map((function(e){return n(e).render(e,c)})))})).then((function(){return a(c)})).then((function(n){return"function"!==typeof n.copyFromChannel?(o(n),E3(n)):t(i,(function(){return i(n)}))||s(n),e.add(n),n}))}}(K5,M5,D5,b8,P6,C3,Z5,J5),P8=(function(e,t,n,r,a){}(M5,_4,R8,U6,D8),function(e,t,n,r,a){return function(e){tr(o,e);var i=sr(o);function o(e,n,a){var s,u;if($n(this,o),"number"===typeof e&&void 0!==n&&void 0!==a)u={length:n,numberOfChannels:e,sampleRate:a};else{if("object"!==typeof e)throw new Error("The given parameters are not valid.");u=e}var c=w3(w3({},u5),u),l=c.length,h=c.numberOfChannels,f=c.sampleRate,d=r(h,l,f);return t(M4,(function(){return M4(d)}))||d.addEventListener("statechange",function(){var e=0;return function t(n){"running"===s._state&&(e>0?(d.removeEventListener("statechange",t),n.stopImmediatePropagation(),s._waitForThePromiseToSettle(n)):e+=1)}}()),(s=i.call(this,d,h))._length=l,s._nativeOfflineAudioContext=d,s._state=null,s}return Jn(o,[{key:"length",get:function(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}},{key:"state",get:function(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}},{key:"startRendering",value:function(){var e=this;return"running"===this._state?Promise.reject(n()):(this._state="running",a(this.destination,this._nativeOfflineAudioContext).finally((function(){e._state=null,L3(e)})))}},{key:"_waitForThePromiseToSettle",value:function(e){var t=this;null===this._state?this._nativeOfflineAudioContext.dispatchEvent(e):setTimeout((function(){return t._waitForThePromiseToSettle(e)}))}}]),o}(e)}(f8,M5,_4,R8,D8)),O8=function(e,t){return function(n){var r=e.get(n);return t(r)||t(n)}}(r3,W5),L8=function(e,t){return function(n){return e.has(n)||t(n)}}(e3,G5),F8=function(e,t){return function(n){return e.has(n)||t(n)}}(n3,j5),z8=function(e,t){return function(n){var r=e.get(n);return t(r)||t(n)}}(r3,z5),B8=function(){return I4(M5,function(e){return function(){if(null===e)return!1;var t=new e(1,1,44100).createBuffer(1,1,44100);if(void 0===t.copyToChannel)return!0;var n=new Float32Array(2);try{t.copyFromChannel(n,0,0)}catch(r){return!1}return!0}}(F5),function(e){return function(){if(null===e)return!1;if(void 0!==e.prototype&&void 0!==e.prototype.close)return!0;var t=new e,n=void 0!==t.close;try{t.close()}catch(r){}return n}}(V5),function(e){return function(){if(null===e)return Promise.resolve(!1);var t=new e(1,1,44100);return new Promise((function(e){var n,r=!0,a=function(n){r&&(r=!1,t.startRendering(),e(n instanceof TypeError))};try{n=t.decodeAudioData(null,(function(){}),a)}catch($Pe){a($Pe)}void 0!==n&&n.catch(a)}))}}(F5),function(e){return function(){if(null===e)return!1;var t;try{t=new e({latencyHint:"balanced"})}catch(n){return!1}return t.close(),!0}}(V5),function(e){return function(){if(null===e)return!1;var t=new e(1,1,44100).createGain(),n=t.connect(t)===t;return t.disconnect(t),n}}(F5),function(e,t){return ns(es().mark((function n(){var r,a,i,o,s,u,c;return es().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(null!==e){n.next=2;break}return n.abrupt("return",!0);case 2:if(null!==t){n.next=4;break}return n.abrupt("return",!1);case 4:return r=new Blob(['let c,p;class A extends AudioWorkletProcessor{constructor(){super();this.port.onmessage=(e)=>{p=e.data;p.onmessage=()=>{p.postMessage(c);p.close()};this.port.postMessage(0)}}process(){c=1}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),a=new MessageChannel,i=new t(1,128,44100),o=URL.createObjectURL(r),s=!1,n.prev=9,n.next=12,i.audioWorklet.addModule(o);case 12:return u=new e(i,"a",{numberOfOutputs:0}),c=i.createOscillator(),n.next=16,new Promise((function(e){u.port.onmessage=function(){return e()},u.port.postMessage(a.port2,[a.port2])}));case 16:return u.port.onmessage=function(){return s=!0},c.connect(u),c.start(0),n.next=21,i.startRendering();case 21:return n.next=23,new Promise((function(e){a.port1.onmessage=function(t){var n=t.data;return e(1===n)},a.port1.postMessage(0)}));case 23:s=n.sent,n.next=28;break;case 26:n.prev=26,n.t0=n.catch(9);case 28:return n.prev=28,a.port1.close(),URL.revokeObjectURL(o),n.finish(28);case 32:return n.abrupt("return",s);case 33:case"end":return n.stop()}}),n,null,[[9,26,28,32]])})))}(q5,F5),function(e){return function(){if(null===e)return!1;var t=new e(1,1,44100).createChannelMerger();if("max"===t.channelCountMode)return!0;try{t.channelCount=2}catch(n){return!0}return!1}}(F5),function(e){return function(){if(null===e)return!1;var t=new e(1,1,44100);return void 0===t.createConstantSource||t.createConstantSource().offset.maxValue!==Number.POSITIVE_INFINITY}}(F5),function(e){return function(){if(null===e)return!1;var t=new e(1,1,44100),n=t.createConvolver();n.buffer=t.createBuffer(1,1,t.sampleRate);try{n.buffer=t.createBuffer(1,1,t.sampleRate)}catch(r){return!1}return!0}}(F5),function(e){return function(){if(null===e)return!1;var t=new e(1,1,44100).createConvolver();try{t.channelCount=1}catch(n){return!1}return!0}}(F5),k5,function(e){return function(){return null!==e&&e.hasOwnProperty("isSecureContext")}}(N5),function(e){return function(){if(null===e)return!1;var t=new e;try{return t.createMediaStreamSource(new MediaStream),!1}catch($Pe){return!0}finally{t.close()}}}(V5),function(e){return function(){if(null===e)return Promise.resolve(!1);var t=new e(1,1,44100);if(void 0===t.createStereoPanner)return Promise.resolve(!0);if(void 0===t.createConstantSource)return Promise.resolve(!0);var n=t.createConstantSource(),r=t.createStereoPanner();return n.channelCount=1,n.offset.value=1,r.channelCount=1,n.start(),n.connect(r).connect(t.destination),t.startRendering().then((function(e){return 1!==e.getChannelData(0)[0]}))}}(F5),w5)};function U8(e,t){if(!e)throw new Error(t)}function V8(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1/0;if(!(t<=e&&e<=n))throw new RangeError("Value must be within [".concat(t,", ").concat(n,"], got: ").concat(e))}function W8(e){e.isOffline||"running"===e.state||H8('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}var G8=console;function j8(e){G8=e}function q8(){var e;(e=G8).log.apply(e,arguments)}function H8(){var e;(e=G8).warn.apply(e,arguments)}function X8(e){return"undefined"===typeof e}function K8(e){return!X8(e)}function Y8(e){return"function"===typeof e}function Q8(e){return"number"===typeof e}function Z8(e){return"[object Object]"===Object.prototype.toString.call(e)&&e.constructor===Object}function J8(e){return"boolean"===typeof e}function $8(e){return Array.isArray(e)}function e7(e){return"string"===typeof e}function t7(e){return e7(e)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(e)}function n7(e){return new y8(e)}function r7(e,t,n){return new P8(e,t,n)}var a7="object"===typeof self?self:null,i7=a7&&(a7.hasOwnProperty("AudioContext")||a7.hasOwnProperty("webkitAudioContext"));function o7(e,t,n,r){var a,i=arguments.length,o=i<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(e,t,n,r);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(o=(i<3?a(o):i>3?a(t,n,o):a(t,n))||o);return i>3&&o&&Object.defineProperty(t,n,o),o}function s7(e,t,n,r){return new(n||(n=Promise))((function(a,i){function o(e){try{u(r.next(e))}catch(t){i(t)}}function s(e){try{u(r.throw(e))}catch(t){i(t)}}function u(e){var t;e.done?a(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(o,s)}u((r=r.apply(e,t||[])).next())}))}Object.create;Object.create;var u7=function(){function e(t,n,r){$n(this,e),this._callback=t,this._type=n,this._updateInterval=r,this._createClock()}return Jn(e,[{key:"_createWorker",value:function(){var e=new Blob(["\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ".concat((1e3*this._updateInterval).toFixed(1),";\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t")],{type:"text/javascript"}),t=URL.createObjectURL(e),n=new Worker(t);n.onmessage=this._callback.bind(this),this._worker=n}},{key:"_createTimeout",value:function(){var e=this;this._timeout=setTimeout((function(){e._createTimeout(),e._callback()}),1e3*this._updateInterval)}},{key:"_createClock",value:function(){if("worker"===this._type)try{this._createWorker()}catch(e){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}},{key:"_disposeClock",value:function(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}},{key:"updateInterval",get:function(){return this._updateInterval},set:function(e){this._updateInterval=Math.max(e,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*e,1))}},{key:"type",get:function(){return this._type},set:function(e){this._disposeClock(),this._type=e,this._createClock()}},{key:"dispose",value:function(){this._disposeClock()}}]),e}();function c7(e){return F8(e)}function l7(e){return L8(e)}function h7(e){return z8(e)}function f7(e){return O8(e)}function d7(e){return e instanceof AudioBuffer}function p7(e,t){return"value"===e||c7(t)||l7(t)||d7(t)}function v7(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(!n.length)return e;var a=n.shift();if(Z8(e)&&Z8(a))for(var i in a)p7(i,a[i])?e[i]=a[i]:Z8(a[i])?(e[i]||Object.assign(e,IE({},i,{})),v7(e[i],a[i])):Object.assign(e,IE({},i,a[i]));return v7.apply(void 0,[e].concat(n))}function m7(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3?arguments[3]:void 0,a={},i=Array.from(t);if(Z8(i[0])&&r&&!Reflect.has(i[0],r)){var o=Object.keys(i[0]).some((function(t){return Reflect.has(e,t)}));o||(v7(a,IE({},r,i[0])),n.splice(n.indexOf(r),1),i.shift())}if(1===i.length&&Z8(i[0]))v7(a,i[0]);else for(var s=0;s<n.length;s++)K8(i[s])&&(a[n[s]]=i[s]);return v7(e,a)}function g7(e,t){return X8(e)?t:e}function y7(e,t){return t.forEach((function(t){Reflect.has(e,t)&&delete e[t]})),e}var b7=function(){function e(){$n(this,e),this.debug=!1,this._wasDisposed=!1}return Jn(e,[{key:"log",value:function(){if(this.debug||a7&&this.toString()===a7.TONE_DEBUG_CLASS){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];q8.apply(void 0,[this].concat(t))}}},{key:"dispose",value:function(){return this._wasDisposed=!0,this}},{key:"disposed",get:function(){return this._wasDisposed}},{key:"toString",value:function(){return this.name}}],[{key:"getDefaults",value:function(){return{}}}]),e}();b7.version=Q2;var x7=1e-6;function k7(e,t){return e>t+x7}function w7(e,t){return k7(e,t)||S7(e,t)}function _7(e,t){return e+x7<t}function S7(e,t){return Math.abs(e-t)<x7}function C7(e,t,n){return Math.max(Math.min(e,n),t)}var T7=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this)).name="Timeline",e._timeline=[];var r=m7(n.getDefaults(),arguments,["memory"]);return e.memory=r.memory,e.increasing=r.increasing,e}return Jn(n,[{key:"length",get:function(){return this._timeline.length}},{key:"add",value:function(e){if(U8(Reflect.has(e,"time"),"Timeline: events must have a time attribute"),e.time=e.time.valueOf(),this.increasing&&this.length){var t=this._timeline[this.length-1];U8(w7(e.time,t.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(e)}else{var n=this._search(e.time);this._timeline.splice(n+1,0,e)}if(this.length>this.memory){var r=this.length-this.memory;this._timeline.splice(0,r)}return this}},{key:"remove",value:function(e){var t=this._timeline.indexOf(e);return-1!==t&&this._timeline.splice(t,1),this}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"time",n=this._search(e,t);return-1!==n?this._timeline[n]:null}},{key:"peek",value:function(){return this._timeline[0]}},{key:"shift",value:function(){return this._timeline.shift()}},{key:"getAfter",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"time",n=this._search(e,t);return n+1<this._timeline.length?this._timeline[n+1]:null}},{key:"getBefore",value:function(e){var t=this._timeline.length;if(t>0&&this._timeline[t-1].time<e)return this._timeline[t-1];var n=this._search(e);return n-1>=0?this._timeline[n-1]:null}},{key:"cancel",value:function(e){if(this._timeline.length>1){var t=this._search(e);if(t>=0)if(S7(this._timeline[t].time,e)){for(var n=t;n>=0&&S7(this._timeline[n].time,e);n--)t=n;this._timeline=this._timeline.slice(0,t)}else this._timeline=this._timeline.slice(0,t+1);else this._timeline=[]}else 1===this._timeline.length&&w7(this._timeline[0].time,e)&&(this._timeline=[]);return this}},{key:"cancelBefore",value:function(e){var t=this._search(e);return t>=0&&(this._timeline=this._timeline.slice(t+1)),this}},{key:"previousEvent",value:function(e){var t=this._timeline.indexOf(e);return t>0?this._timeline[t-1]:null}},{key:"_search",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"time";if(0===this._timeline.length)return-1;var n=0,r=this._timeline.length,a=r;if(r>0&&this._timeline[r-1][t]<=e)return r-1;for(;n<a;){var i=Math.floor(n+(a-n)/2),o=this._timeline[i],s=this._timeline[i+1];if(S7(o[t],e)){for(var u=i;u<this._timeline.length;u++){var c=this._timeline[u];if(!S7(c[t],e))break;i=u}return i}if(_7(o[t],e)&&k7(s[t],e))return i;k7(o[t],e)?a=i:n=i+1}return-1}},{key:"_iterate",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this._timeline.length-1;this._timeline.slice(t,n+1).forEach(e)}},{key:"forEach",value:function(e){return this._iterate(e),this}},{key:"forEachBefore",value:function(e,t){var n=this._search(e);return-1!==n&&this._iterate(t,0,n),this}},{key:"forEachAfter",value:function(e,t){var n=this._search(e);return this._iterate(t,n+1),this}},{key:"forEachBetween",value:function(e,t,n){var r=this._search(e),a=this._search(t);return-1!==r&&-1!==a?(this._timeline[r].time!==e&&(r+=1),this._timeline[a].time===t&&(a-=1),this._iterate(n,r,a)):-1===r&&this._iterate(n,0,a),this}},{key:"forEachFrom",value:function(e,t){for(var n=this._search(e);n>=0&&this._timeline[n].time>=e;)n--;return this._iterate(t,n+1),this}},{key:"forEachAtTime",value:function(e,t){var n=this._search(e);if(-1!==n&&S7(this._timeline[n].time,e)){for(var r=n,a=n;a>=0&&S7(this._timeline[a].time,e);a--)r=a;this._iterate((function(e){t(e)}),r,n)}return this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._timeline=[],this}}],[{key:"getDefaults",value:function(){return{memory:1/0,increasing:!1}}}]),n}(b7),E7=[];function I7(e){E7.push(e)}var A7=[];function M7(e){A7.push(e)}function N7(e){A7.forEach((function(t){return t(e)}))}var R7=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).name="Emitter",e}return Jn(n,[{key:"on",value:function(e,t){var n=this;return e.split(/\W+/).forEach((function(e){X8(n._events)&&(n._events={}),n._events.hasOwnProperty(e)||(n._events[e]=[]),n._events[e].push(t)})),this}},{key:"once",value:function(e,t){var n=this;return this.on(e,(function r(){t.apply(void 0,arguments),n.off(e,r)})),this}},{key:"off",value:function(e,t){var n=this;return e.split(/\W+/).forEach((function(r){if(X8(n._events)&&(n._events={}),n._events.hasOwnProperty(e))if(X8(t))n._events[e]=[];else for(var a=n._events[e],i=a.length-1;i>=0;i--)a[i]===t&&a.splice(i,1)})),this}},{key:"emit",value:function(e){if(this._events&&this._events.hasOwnProperty(e)){for(var t=this._events[e].slice(0),n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];for(var i=0,o=t.length;i<o;i++)t[i].apply(this,r)}return this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._events=void 0,this}}],[{key:"mixin",value:function(e){["on","once","off","emit"].forEach((function(t){var r=Object.getOwnPropertyDescriptor(n.prototype,t);Object.defineProperty(e.prototype,t,r)}))}}]),n}(b7),D7=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).isOffline=!1,e}return Jn(n,[{key:"toJSON",value:function(){return{}}}]),n}(R7),P7=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this)).name="Context",e._constants=new Map,e._timeouts=new T7,e._timeoutIds=0,e._initialized=!1,e.isOffline=!1,e._workletModules=new Map;var r=m7(n.getDefaults(),arguments,["context"]);return r.context?e._context=r.context:e._context=n7({latencyHint:r.latencyHint}),e._ticker=new u7(e.emit.bind(ir(e),"tick"),r.clockSource,r.updateInterval),e.on("tick",e._timeoutLoop.bind(ir(e))),e._context.onstatechange=function(){e.emit("statechange",e.state)},e._setLatencyHint(r.latencyHint),e.lookAhead=r.lookAhead,e}return Jn(n,[{key:"initialize",value:function(){return this._initialized||(!function(e){E7.forEach((function(t){return t(e)}))}(this),this._initialized=!0),this}},{key:"createAnalyser",value:function(){return this._context.createAnalyser()}},{key:"createOscillator",value:function(){return this._context.createOscillator()}},{key:"createBufferSource",value:function(){return this._context.createBufferSource()}},{key:"createBiquadFilter",value:function(){return this._context.createBiquadFilter()}},{key:"createBuffer",value:function(e,t,n){return this._context.createBuffer(e,t,n)}},{key:"createChannelMerger",value:function(e){return this._context.createChannelMerger(e)}},{key:"createChannelSplitter",value:function(e){return this._context.createChannelSplitter(e)}},{key:"createConstantSource",value:function(){return this._context.createConstantSource()}},{key:"createConvolver",value:function(){return this._context.createConvolver()}},{key:"createDelay",value:function(e){return this._context.createDelay(e)}},{key:"createDynamicsCompressor",value:function(){return this._context.createDynamicsCompressor()}},{key:"createGain",value:function(){return this._context.createGain()}},{key:"createIIRFilter",value:function(e,t){return this._context.createIIRFilter(e,t)}},{key:"createPanner",value:function(){return this._context.createPanner()}},{key:"createPeriodicWave",value:function(e,t,n){return this._context.createPeriodicWave(e,t,n)}},{key:"createStereoPanner",value:function(){return this._context.createStereoPanner()}},{key:"createWaveShaper",value:function(){return this._context.createWaveShaper()}},{key:"createMediaStreamSource",value:function(e){return U8(f7(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamSource(e)}},{key:"createMediaElementSource",value:function(e){return U8(f7(this._context),"Not available if OfflineAudioContext"),this._context.createMediaElementSource(e)}},{key:"createMediaStreamDestination",value:function(){return U8(f7(this._context),"Not available if OfflineAudioContext"),this._context.createMediaStreamDestination()}},{key:"decodeAudioData",value:function(e){return this._context.decodeAudioData(e)}},{key:"currentTime",get:function(){return this._context.currentTime}},{key:"state",get:function(){return this._context.state}},{key:"sampleRate",get:function(){return this._context.sampleRate}},{key:"listener",get:function(){return this.initialize(),this._listener},set:function(e){U8(!this._initialized,"The listener cannot be set after initialization."),this._listener=e}},{key:"transport",get:function(){return this.initialize(),this._transport},set:function(e){U8(!this._initialized,"The transport cannot be set after initialization."),this._transport=e}},{key:"draw",get:function(){return this.initialize(),this._draw},set:function(e){U8(!this._initialized,"Draw cannot be set after initialization."),this._draw=e}},{key:"destination",get:function(){return this.initialize(),this._destination},set:function(e){U8(!this._initialized,"The destination cannot be set after initialization."),this._destination=e}},{key:"createAudioWorkletNode",value:function(e,t){return function(e,t,n){return U8(K8(N8),"This node only works in a secure context (https or localhost)"),new N8(e,t,n)}(this.rawContext,e,t)}},{key:"addAudioWorkletModule",value:function(e,t){return s7(this,void 0,void 0,es().mark((function n(){return es().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return U8(K8(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(t)||this._workletModules.set(t,this.rawContext.audioWorklet.addModule(e)),n.next=4,this._workletModules.get(t);case 4:case"end":return n.stop()}}),n,this)})))}},{key:"workletsAreReady",value:function(){return s7(this,void 0,void 0,es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=[],this._workletModules.forEach((function(e){return t.push(e)})),e.next=4,Promise.all(t);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"updateInterval",get:function(){return this._ticker.updateInterval},set:function(e){this._ticker.updateInterval=e}},{key:"clockSource",get:function(){return this._ticker.type},set:function(e){this._ticker.type=e}},{key:"latencyHint",get:function(){return this._latencyHint}},{key:"_setLatencyHint",value:function(e){var t=0;if(this._latencyHint=e,e7(e))switch(e){case"interactive":t=.1;break;case"playback":t=.5;break;case"balanced":t=.25}this.lookAhead=t,this.updateInterval=t/2}},{key:"rawContext",get:function(){return this._context}},{key:"now",value:function(){return this._context.currentTime+this.lookAhead}},{key:"immediate",value:function(){return this._context.currentTime}},{key:"resume",value:function(){return f7(this._context)?this._context.resume():Promise.resolve()}},{key:"close",value:function(){return s7(this,void 0,void 0,es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!f7(this._context)){e.next=3;break}return e.next=3,this._context.close();case 3:this._initialized&&N7(this);case 4:case"end":return e.stop()}}),e,this)})))}},{key:"getConstant",value:function(e){if(this._constants.has(e))return this._constants.get(e);for(var t=this._context.createBuffer(1,128,this._context.sampleRate),n=t.getChannelData(0),r=0;r<n.length;r++)n[r]=e;var a=this._context.createBufferSource();return a.channelCount=1,a.channelCountMode="explicit",a.buffer=t,a.loop=!0,a.start(0),this._constants.set(e,a),a}},{key:"dispose",value:function(){var e=this;return ja(nr(n.prototype),"dispose",this).call(this),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((function(t){return e._constants[t].disconnect()})),this}},{key:"_timeoutLoop",value:function(){for(var e=this.now(),t=this._timeouts.peek();this._timeouts.length&&t&&t.time<=e;)t.callback(),this._timeouts.shift(),t=this._timeouts.peek()}},{key:"setTimeout",value:function(e,t){this._timeoutIds++;var n=this.now();return this._timeouts.add({callback:e,id:this._timeoutIds,time:n+t}),this._timeoutIds}},{key:"clearTimeout",value:function(e){var t=this;return this._timeouts.forEach((function(n){n.id===e&&t._timeouts.remove(n)})),this}},{key:"clearInterval",value:function(e){return this.clearTimeout(e)}},{key:"setInterval",value:function(e,t){var n=this,r=++this._timeoutIds;return function a(){var i=n.now();n._timeouts.add({callback:function(){e(),a()},id:r,time:i+t})}(),r}}],[{key:"getDefaults",value:function(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}}]),n}(D7),O7=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).lookAhead=0,e.latencyHint=0,e.isOffline=!1,e}return Jn(n,[{key:"createAnalyser",value:function(){return{}}},{key:"createOscillator",value:function(){return{}}},{key:"createBufferSource",value:function(){return{}}},{key:"createBiquadFilter",value:function(){return{}}},{key:"createBuffer",value:function(e,t,n){return{}}},{key:"createChannelMerger",value:function(e){return{}}},{key:"createChannelSplitter",value:function(e){return{}}},{key:"createConstantSource",value:function(){return{}}},{key:"createConvolver",value:function(){return{}}},{key:"createDelay",value:function(e){return{}}},{key:"createDynamicsCompressor",value:function(){return{}}},{key:"createGain",value:function(){return{}}},{key:"createIIRFilter",value:function(e,t){return{}}},{key:"createPanner",value:function(){return{}}},{key:"createPeriodicWave",value:function(e,t,n){return{}}},{key:"createStereoPanner",value:function(){return{}}},{key:"createWaveShaper",value:function(){return{}}},{key:"createMediaStreamSource",value:function(e){return{}}},{key:"createMediaElementSource",value:function(e){return{}}},{key:"createMediaStreamDestination",value:function(){return{}}},{key:"decodeAudioData",value:function(e){return Promise.resolve({})}},{key:"createAudioWorkletNode",value:function(e,t){return{}}},{key:"rawContext",get:function(){return{}}},{key:"addAudioWorkletModule",value:function(e,t){return s7(this,void 0,void 0,es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Promise.resolve());case 1:case"end":return e.stop()}}),e)})))}},{key:"resume",value:function(){return Promise.resolve()}},{key:"setTimeout",value:function(e,t){return 0}},{key:"clearTimeout",value:function(e){return this}},{key:"setInterval",value:function(e,t){return 0}},{key:"clearInterval",value:function(e){return this}},{key:"getConstant",value:function(e){return{}}},{key:"currentTime",get:function(){return 0}},{key:"state",get:function(){return{}}},{key:"sampleRate",get:function(){return 0}},{key:"listener",get:function(){return{}}},{key:"transport",get:function(){return{}}},{key:"draw",get:function(){return{}},set:function(e){}},{key:"destination",get:function(){return{}},set:function(e){}},{key:"now",value:function(){return 0}},{key:"immediate",value:function(){return 0}}]),n}(D7);function L7(e,t){$8(t)?t.forEach((function(t){return L7(e,t)})):Object.defineProperty(e,t,{enumerable:!0,writable:!1})}function F7(e,t){$8(t)?t.forEach((function(t){return F7(e,t)})):Object.defineProperty(e,t,{writable:!0})}var z7=function(){},B7=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this)).name="ToneAudioBuffer",e.onload=z7;var r=m7(n.getDefaults(),arguments,["url","onload","onerror"]);return e.reverse=r.reverse,e.onload=r.onload,r.url&&d7(r.url)||r.url instanceof n?e.set(r.url):e7(r.url)&&e.load(r.url).catch(r.onerror),e}return Jn(n,[{key:"sampleRate",get:function(){return this._buffer?this._buffer.sampleRate:G7().sampleRate}},{key:"set",value:function(e){var t=this;return e instanceof n?e.loaded?this._buffer=e.get():e.onload=function(){t.set(e),t.onload(t)}:this._buffer=e,this._reversed&&this._reverse(),this}},{key:"get",value:function(){return this._buffer}},{key:"load",value:function(e){return s7(this,void 0,void 0,es().mark((function t(){var r,a,i=this;return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=n.load(e).then((function(e){i.set(e),i.onload(i)})),n.downloads.push(r),t.prev=2,t.next=5,r;case 5:return t.prev=5,a=n.downloads.indexOf(r),n.downloads.splice(a,1),t.finish(5);case 9:return t.abrupt("return",this);case 10:case"end":return t.stop()}}),t,this,[[2,,5,9]])})))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._buffer=void 0,this}},{key:"fromArray",value:function(e){for(var t=$8(e)&&e[0].length>0,n=t?e.length:1,r=t?e[0].length:e.length,a=G7(),i=a.createBuffer(n,r,a.sampleRate),o=t||1!==n?e:[e],s=0;s<n;s++)i.copyToChannel(o[s],s);return this._buffer=i,this}},{key:"toMono",value:function(e){if(Q8(e))this.fromArray(this.toArray(e));else{for(var t=new Float32Array(this.length),n=this.numberOfChannels,r=0;r<n;r++)for(var a=this.toArray(r),i=0;i<a.length;i++)t[i]+=a[i];t=t.map((function(e){return e/n})),this.fromArray(t)}return this}},{key:"toArray",value:function(e){if(Q8(e))return this.getChannelData(e);if(1===this.numberOfChannels)return this.toArray(0);for(var t=[],n=0;n<this.numberOfChannels;n++)t[n]=this.getChannelData(n);return t}},{key:"getChannelData",value:function(e){return this._buffer?this._buffer.getChannelData(e):new Float32Array(0)}},{key:"slice",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.duration,r=Math.floor(e*this.sampleRate),a=Math.floor(t*this.sampleRate);U8(r<a,"The start time must be less than the end time");for(var i=a-r,o=G7().createBuffer(this.numberOfChannels,i,this.sampleRate),s=0;s<this.numberOfChannels;s++)o.copyToChannel(this.getChannelData(s).subarray(r,a),s);return new n(o)}},{key:"_reverse",value:function(){if(this.loaded)for(var e=0;e<this.numberOfChannels;e++)this.getChannelData(e).reverse();return this}},{key:"loaded",get:function(){return this.length>0}},{key:"duration",get:function(){return this._buffer?this._buffer.duration:0}},{key:"length",get:function(){return this._buffer?this._buffer.length:0}},{key:"numberOfChannels",get:function(){return this._buffer?this._buffer.numberOfChannels:0}},{key:"reverse",get:function(){return this._reversed},set:function(e){this._reversed!==e&&(this._reversed=e,this._reverse())}}],[{key:"getDefaults",value:function(){return{onerror:z7,onload:z7,reverse:!1}}},{key:"fromArray",value:function(e){return(new n).fromArray(e)}},{key:"fromUrl",value:function(e){return s7(this,void 0,void 0,es().mark((function t(){var r;return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return r=new n,t.next=3,r.load(e);case 3:return t.abrupt("return",t.sent);case 4:case"end":return t.stop()}}),t)})))}},{key:"load",value:function(e){return s7(this,void 0,void 0,es().mark((function t(){var r,a,i,o,s,u,c,l,h,f;return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(r=e.match(/\[([^\]\[]+\|.+)\]$/))){t.next=23;break}a=r[1].split("|"),i=a[0],o=al(a),t.prev=5,o.s();case 7:if((s=o.n()).done){t.next=14;break}if(u=s.value,!n.supportsType(u)){t.next=12;break}return i=u,t.abrupt("break",14);case 12:t.next=7;break;case 14:t.next=19;break;case 16:t.prev=16,t.t0=t.catch(5),o.e(t.t0);case 19:return t.prev=19,o.f(),t.finish(19);case 22:e=e.replace(r[0],i);case 23:return c=""===n.baseUrl||n.baseUrl.endsWith("/")?n.baseUrl:n.baseUrl+"/",t.next=26,fetch(c+e);case 26:if((l=t.sent).ok){t.next=29;break}throw new Error("could not load url: ".concat(e));case 29:return t.next=31,l.arrayBuffer();case 31:return h=t.sent,t.next=34,G7().decodeAudioData(h);case 34:return f=t.sent,t.abrupt("return",f);case 36:case"end":return t.stop()}}),t,null,[[5,16,19,22]])})))}},{key:"supportsType",value:function(e){var t=e.split("."),n=t[t.length-1];return""!==document.createElement("audio").canPlayType("audio/"+n)}},{key:"loaded",value:function(){return s7(this,void 0,void 0,es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve();case 2:if(!n.downloads.length){e.next=7;break}return e.next=5,n.downloads[0];case 5:e.next=2;break;case 7:case"end":return e.stop()}}),e)})))}}]),n}(b7);B7.baseUrl="",B7.downloads=[];var U7=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,{clockSource:"offline",context:h7(arguments[0])?arguments[0]:r7(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:h7(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]})).name="OfflineContext",e._currentTime=0,e.isOffline=!0,e._duration=h7(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1],e}return Jn(n,[{key:"now",value:function(){return this._currentTime}},{key:"currentTime",get:function(){return this._currentTime}},{key:"_renderClock",value:function(e){return s7(this,void 0,void 0,es().mark((function t(){var n,r;return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:n=0;case 1:if(!(this._duration-this._currentTime>=0)){t.next=11;break}if(this.emit("tick"),this._currentTime+=128/this.sampleRate,n++,r=Math.floor(this.sampleRate/128),!e||n%r!==0){t.next=9;break}return t.next=9,new Promise((function(e){return setTimeout(e,1)}));case 9:t.next=1;break;case 11:case"end":return t.stop()}}),t,this)})))}},{key:"render",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];return s7(this,void 0,void 0,es().mark((function t(){var n;return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this.workletsAreReady();case 2:return t.next=4,this._renderClock(e);case 4:return t.next=6,this._context.startRendering();case 6:return n=t.sent,t.abrupt("return",new B7(n));case 8:case"end":return t.stop()}}),t,this)})))}},{key:"close",value:function(){return Promise.resolve()}}]),n}(P7),V7=new O7,W7=V7;function G7(){return W7===V7&&i7&&j7(new P7),W7}function j7(e){W7=f7(e)?new P7(e):h7(e)?new U7(e):e}function q7(){return W7.resume()}if(a7&&!a7.TONE_SILENCE_LOGGING){var H7="v";"dev"===Q2&&(H7="");var X7=" * Tone.js ".concat(H7).concat(Q2," * ");console.log("%c".concat(X7),"background: #000; color: #fff")}function K7(e){return Math.pow(10,e/20)}function Y7(e){return Math.log(e)/Math.LN10*20}function Q7(e){return Math.pow(2,e/12)}var Z7=440;function J7(e){return Math.round($7(e))}function $7(e){return 69+12*Math.log2(e/Z7)}function e9(e){return Z7*Math.pow(2,(e-69)/12)}var t9=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;return $n(this,n),(i=t.call(this)).defaultUnits="s",i._val=r,i._units=a,i.context=e,i._expressions=i._getExpressions(),i}return Jn(n,[{key:"_getExpressions",value:function(){var e=this;return{hz:{method:function(t){return e._frequencyToUnits(parseFloat(t))},regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:function(t){return e._ticksToUnits(parseInt(t,10))},regexp:/^(\d+)i$/i},m:{method:function(t){return e._beatsToUnits(parseInt(t,10)*e._getTimeSignature())},regexp:/^(\d+)m$/i},n:{method:function(t,n){var r=parseInt(t,10),a="."===n?1.5:1;return 1===r?e._beatsToUnits(e._getTimeSignature())*a:e._beatsToUnits(4/r)*a},regexp:/^(\d+)n(\.?)$/i},number:{method:function(t){return e._expressions[e.defaultUnits].method.call(e,t)},regexp:/^(\d+(?:\.\d+)?)$/},s:{method:function(t){return e._secondsToUnits(parseFloat(t))},regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:function(t){return parseInt(t,10)/e.context.sampleRate},regexp:/^(\d+)samples$/},t:{method:function(t){var n=parseInt(t,10);return e._beatsToUnits(8/(3*Math.floor(n)))},regexp:/^(\d+)t$/i},tr:{method:function(t,n,r){var a=0;return t&&"0"!==t&&(a+=e._beatsToUnits(e._getTimeSignature()*parseFloat(t))),n&&"0"!==n&&(a+=e._beatsToUnits(parseFloat(n))),r&&"0"!==r&&(a+=e._beatsToUnits(parseFloat(r)/4)),a},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}},{key:"valueOf",value:function(){if(this._val instanceof n&&this.fromType(this._val),X8(this._val))return this._noArg();if(e7(this._val)&&X8(this._units)){for(var e in this._expressions)if(this._expressions[e].regexp.test(this._val.trim())){this._units=e;break}}else if(Z8(this._val)){var t=0;for(var r in this._val)if(K8(this._val[r])){var a=this._val[r];t+=new this.constructor(this.context,r).valueOf()*a}return t}if(K8(this._units)){var i=this._expressions[this._units],o=this._val.toString().trim().match(i.regexp);return o?i.method.apply(this,o.slice(1)):i.method.call(this,this._val)}return e7(this._val)?parseFloat(this._val):this._val}},{key:"_frequencyToUnits",value:function(e){return 1/e}},{key:"_beatsToUnits",value:function(e){return 60/this._getBpm()*e}},{key:"_secondsToUnits",value:function(e){return e}},{key:"_ticksToUnits",value:function(e){return e*this._beatsToUnits(1)/this._getPPQ()}},{key:"_noArg",value:function(){return this._now()}},{key:"_getBpm",value:function(){return this.context.transport.bpm.value}},{key:"_getTimeSignature",value:function(){return this.context.transport.timeSignature}},{key:"_getPPQ",value:function(){return this.context.transport.PPQ}},{key:"fromType",value:function(e){switch(this._units=void 0,this.defaultUnits){case"s":this._val=e.toSeconds();break;case"i":this._val=e.toTicks();break;case"hz":this._val=e.toFrequency();break;case"midi":this._val=e.toMidi()}return this}},{key:"toFrequency",value:function(){return 1/this.toSeconds()}},{key:"toSamples",value:function(){return this.toSeconds()*this.context.sampleRate}},{key:"toMilliseconds",value:function(){return 1e3*this.toSeconds()}}]),n}(b7),n9=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).name="TimeClass",e}return Jn(n,[{key:"_getExpressions",value:function(){var e=this;return Object.assign(ja(nr(n.prototype),"_getExpressions",this).call(this),{now:{method:function(t){return e._now()+new e.constructor(e.context,t).valueOf()},regexp:/^\+(.+)/},quantize:{method:function(t){var r=new n(e.context,t).valueOf();return e._secondsToUnits(e.context.transport.nextSubdivision(r))},regexp:/^@(.+)/}})}},{key:"quantize",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=new this.constructor(this.context,e).valueOf(),r=this.valueOf(),a=Math.round(r/n),i=a*n,o=i-r;return r+o*t}},{key:"toNotation",value:function(){for(var e=this,t=this.toSeconds(),r=["1m"],a=1;a<9;a++){var i=Math.pow(2,a);r.push(i+"n."),r.push(i+"n"),r.push(i+"t")}r.push("0");var o=r[0],s=new n(this.context,r[0]).toSeconds();return r.forEach((function(r){var a=new n(e.context,r).toSeconds();Math.abs(a-t)<Math.abs(s-t)&&(o=r,s=a)})),o}},{key:"toBarsBeatsSixteenths",value:function(){var e=this._beatsToUnits(1),t=this.valueOf()/e;t=parseFloat(t.toFixed(4));var n=Math.floor(t/this._getTimeSignature()),r=t%1*4;t=Math.floor(t)%this._getTimeSignature();var a=r.toString();return a.length>3&&(r=parseFloat(parseFloat(a).toFixed(3))),[n,t,r].join(":")}},{key:"toTicks",value:function(){var e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.round(t*this._getPPQ())}},{key:"toSeconds",value:function(){return this.valueOf()}},{key:"toMidi",value:function(){return J7(this.toFrequency())}},{key:"_now",value:function(){return this.context.now()}}]),n}(t9);function r9(e,t){return new n9(G7(),e,t)}var a9=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).name="Frequency",e.defaultUnits="hz",e}return Jn(n,[{key:"_getExpressions",value:function(){return Object.assign({},ja(nr(n.prototype),"_getExpressions",this).call(this),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method:function(e){return"midi"===this.defaultUnits?e:n.mtof(e)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method:function(e,t){var r=i9[e.toLowerCase()]+12*(parseInt(t,10)+1);return"midi"===this.defaultUnits?r:n.mtof(r)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method:function(e,t,n){var r=1;return e&&"0"!==e&&(r*=this._beatsToUnits(this._getTimeSignature()*parseFloat(e))),t&&"0"!==t&&(r*=this._beatsToUnits(parseFloat(t))),n&&"0"!==n&&(r*=this._beatsToUnits(parseFloat(n)/4)),r}}})}},{key:"transpose",value:function(e){return new n(this.context,this.valueOf()*Q7(e))}},{key:"harmonize",value:function(e){var t=this;return e.map((function(e){return t.transpose(e)}))}},{key:"toMidi",value:function(){return J7(this.valueOf())}},{key:"toNote",value:function(){var e=this.toFrequency(),t=Math.log2(e/n.A4),r=Math.round(12*t)+57,a=Math.floor(r/12);return a<0&&(r+=-12*a),o9[r%12]+a.toString()}},{key:"toSeconds",value:function(){return 1/ja(nr(n.prototype),"toSeconds",this).call(this)}},{key:"toTicks",value:function(){var e=this._beatsToUnits(1),t=this.valueOf()/e;return Math.floor(t*this._getPPQ())}},{key:"_noArg",value:function(){return 0}},{key:"_frequencyToUnits",value:function(e){return e}},{key:"_ticksToUnits",value:function(e){return 1/(60*e/(this._getBpm()*this._getPPQ()))}},{key:"_beatsToUnits",value:function(e){return 1/ja(nr(n.prototype),"_beatsToUnits",this).call(this,e)}},{key:"_secondsToUnits",value:function(e){return 1/e}}],[{key:"A4",get:function(){return Z7},set:function(e){!function(e){Z7=e}(e)}},{key:"mtof",value:function(e){return e9(e)}},{key:"ftom",value:function(e){return J7(e)}}]),n}(n9),i9={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},o9=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function s9(e,t){return new a9(G7(),e,t)}var u9=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).name="TransportTime",e}return Jn(n,[{key:"_now",value:function(){return this.context.transport.seconds}}]),n}(n9);function c9(e,t){return new u9(G7(),e,t)}var l9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),e=t.call(this);var r=m7(n.getDefaults(),arguments,["context"]);return e.defaultContext?e.context=e.defaultContext:e.context=r.context,e}return Jn(n,[{key:"now",value:function(){return this.context.currentTime+this.context.lookAhead}},{key:"immediate",value:function(){return this.context.currentTime}},{key:"sampleTime",get:function(){return 1/this.context.sampleRate}},{key:"blockTime",get:function(){return 128/this.context.sampleRate}},{key:"toSeconds",value:function(e){return new n9(this.context,e).toSeconds()}},{key:"toFrequency",value:function(e){return new a9(this.context,e).toFrequency()}},{key:"toTicks",value:function(e){return new u9(this.context,e).toTicks()}},{key:"_getPartialProperties",value:function(e){var t=this.get();return Object.keys(t).forEach((function(n){X8(e[n])&&delete t[n]})),t}},{key:"get",value:function(){var e=this,t=this.constructor.getDefaults();return Object.keys(t).forEach((function(r){if(Reflect.has(e,r)){var a=e[r];K8(a)&&K8(a.value)&&K8(a.setValueAtTime)?t[r]=a.value:a instanceof n?t[r]=a._getPartialProperties(t[r]):$8(a)||Q8(a)||e7(a)||J8(a)?t[r]=a:delete t[r]}})),t}},{key:"set",value:function(e){var t=this;return Object.keys(e).forEach((function(r){Reflect.has(t,r)&&K8(t[r])&&(t[r]&&K8(t[r].value)&&K8(t[r].setValueAtTime)?t[r].value!==e[r]&&(t[r].value=e[r]):t[r]instanceof n?t[r].set(e[r]):t[r]=e[r])})),this}}],[{key:"getDefaults",value:function(){return{context:G7()}}}]),n}(b7),h9=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"stopped";return $n(this,n),(e=t.call(this)).name="StateTimeline",e._initial=r,e.setStateAtTime(e._initial,0),e}return Jn(n,[{key:"getValueAtTime",value:function(e){var t=this.get(e);return null!==t?t.state:this._initial}},{key:"setStateAtTime",value:function(e,t,n){return V8(t,0),this.add(Object.assign({},n,{state:e,time:t})),this}},{key:"getLastState",value:function(e,t){for(var n=this._search(t);n>=0;n--){var r=this._timeline[n];if(r.state===e)return r}}},{key:"getNextState",value:function(e,t){var n=this._search(t);if(-1!==n)for(var r=n;r<this._timeline.length;r++){var a=this._timeline[r];if(a.state===e)return a}}}]),n}(T7),f9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["param","units","convert"]))).name="Param",e.overridden=!1,e._minOutput=1e-7;var r=m7(n.getDefaults(),arguments,["param","units","convert"]);for(U8(K8(r.param)&&(c7(r.param)||r.param instanceof n),"param must be an AudioParam");!c7(r.param);)r.param=r.param._param;return e._swappable=!!K8(r.swappable)&&r.swappable,e._swappable?(e.input=e.context.createGain(),e._param=r.param,e.input.connect(e._param)):e._param=e.input=r.param,e._events=new T7(1e3),e._initialValue=e._param.defaultValue,e.units=r.units,e.convert=r.convert,e._minValue=r.minValue,e._maxValue=r.maxValue,K8(r.value)&&r.value!==e._toType(e._initialValue)&&e.setValueAtTime(r.value,0),e}return Jn(n,[{key:"value",get:function(){var e=this.now();return this.getValueAtTime(e)},set:function(e){this.cancelScheduledValues(this.now()),this.setValueAtTime(e,this.now())}},{key:"minValue",get:function(){return K8(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}},{key:"maxValue",get:function(){return K8(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}},{key:"_is",value:function(e,t){return this.units===t}},{key:"_assertRange",value:function(e){return K8(this.maxValue)&&K8(this.minValue)&&V8(e,this._fromType(this.minValue),this._fromType(this.maxValue)),e}},{key:"_fromType",value:function(e){return this.convert&&!this.overridden?this._is(e,"time")?this.toSeconds(e):this._is(e,"decibels")?K7(e):this._is(e,"frequency")?this.toFrequency(e):e:this.overridden?0:e}},{key:"_toType",value:function(e){return this.convert&&"decibels"===this.units?Y7(e):e}},{key:"setValueAtTime",value:function(e,t){var n=this.toSeconds(t),r=this._fromType(e);return U8(isFinite(r)&&isFinite(n),"Invalid argument(s) to setValueAtTime: ".concat(JSON.stringify(e),", ").concat(JSON.stringify(t))),this._assertRange(r),this.log(this.units,"setValueAtTime",e,n),this._events.add({time:n,type:"setValueAtTime",value:r}),this._param.setValueAtTime(r,n),this}},{key:"getValueAtTime",value:function(e){var t=Math.max(this.toSeconds(e),0),n=this._events.getAfter(t),r=this._events.get(t),a=this._initialValue;if(null===r)a=this._initialValue;else if("setTargetAtTime"!==r.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)a=r.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){var i=r.value;if("setTargetAtTime"===r.type){var o=this._events.getBefore(r.time);i=null===o?this._initialValue:o.value}a="linearRampToValueAtTime"===n.type?this._linearInterpolate(r.time,i,n.time,n.value,t):this._exponentialInterpolate(r.time,i,n.time,n.value,t)}else a=r.value;else{var s,u=this._events.getBefore(r.time);s=null===u?this._initialValue:u.value,"setTargetAtTime"===r.type&&(a=this._exponentialApproach(r.time,s,r.value,r.constant,t))}return this._toType(a)}},{key:"setRampPoint",value:function(e){e=this.toSeconds(e);var t=this.getValueAtTime(e);return this.cancelAndHoldAtTime(e),0===this._fromType(t)&&(t=this._toType(this._minOutput)),this.setValueAtTime(t,e),this}},{key:"linearRampToValueAtTime",value:function(e,t){var n=this._fromType(e),r=this.toSeconds(t);return U8(isFinite(n)&&isFinite(r),"Invalid argument(s) to linearRampToValueAtTime: ".concat(JSON.stringify(e),", ").concat(JSON.stringify(t))),this._assertRange(n),this._events.add({time:r,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",e,r),this._param.linearRampToValueAtTime(n,r),this}},{key:"exponentialRampToValueAtTime",value:function(e,t){var n=this._fromType(e);n=S7(n,0)?this._minOutput:n,this._assertRange(n);var r=this.toSeconds(t);return U8(isFinite(n)&&isFinite(r),"Invalid argument(s) to exponentialRampToValueAtTime: ".concat(JSON.stringify(e),", ").concat(JSON.stringify(t))),this._events.add({time:r,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",e,r),this._param.exponentialRampToValueAtTime(n,r),this}},{key:"exponentialRampTo",value:function(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(e,n+this.toSeconds(t)),this}},{key:"linearRampTo",value:function(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(e,n+this.toSeconds(t)),this}},{key:"targetRampTo",value:function(e,t,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(e,n,t),this}},{key:"exponentialApproachValueAtTime",value:function(e,t,n){t=this.toSeconds(t),n=this.toSeconds(n);var r=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(e,t,r),this.cancelAndHoldAtTime(t+.9*n),this.linearRampToValueAtTime(e,t+n),this}},{key:"setTargetAtTime",value:function(e,t,n){var r=this._fromType(e);U8(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");var a=this.toSeconds(t);return this._assertRange(r),U8(isFinite(r)&&isFinite(a),"Invalid argument(s) to setTargetAtTime: ".concat(JSON.stringify(e),", ").concat(JSON.stringify(t))),this._events.add({constant:n,time:a,type:"setTargetAtTime",value:r}),this.log(this.units,"setTargetAtTime",e,a,n),this._param.setTargetAtTime(r,a,n),this}},{key:"setValueCurveAtTime",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;n=this.toSeconds(n),t=this.toSeconds(t);var a=this._fromType(e[0])*r;this.setValueAtTime(this._toType(a),t);for(var i=n/(e.length-1),o=1;o<e.length;o++){var s=this._fromType(e[o])*r;this.linearRampToValueAtTime(this._toType(s),t+o*i)}return this}},{key:"cancelScheduledValues",value:function(e){var t=this.toSeconds(e);return U8(isFinite(t),"Invalid argument to cancelScheduledValues: ".concat(JSON.stringify(e))),this._events.cancel(t),this._param.cancelScheduledValues(t),this.log(this.units,"cancelScheduledValues",t),this}},{key:"cancelAndHoldAtTime",value:function(e){var t=this.toSeconds(e),n=this._fromType(this.getValueAtTime(t));U8(isFinite(t),"Invalid argument to cancelAndHoldAtTime: ".concat(JSON.stringify(e))),this.log(this.units,"cancelAndHoldAtTime",t,"value="+n);var r=this._events.get(t),a=this._events.getAfter(t);return r&&S7(r.time,t)?a?(this._param.cancelScheduledValues(a.time),this._events.cancel(a.time)):(this._param.cancelAndHoldAtTime(t),this._events.cancel(t+this.sampleTime)):a&&(this._param.cancelScheduledValues(a.time),this._events.cancel(a.time),"linearRampToValueAtTime"===a.type?this.linearRampToValueAtTime(this._toType(n),t):"exponentialRampToValueAtTime"===a.type&&this.exponentialRampToValueAtTime(this._toType(n),t)),this._events.add({time:t,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,t),this}},{key:"rampTo",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.1,n=arguments.length>2?arguments[2]:void 0;return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(e,t,n):this.linearRampTo(e,t,n),this}},{key:"apply",value:function(e){var t=this.context.currentTime;e.setValueAtTime(this.getValueAtTime(t),t);var n=this._events.get(t);if(n&&"setTargetAtTime"===n.type)for(var r=this._events.getAfter(n.time),a=r?r.time:t+2,i=(a-t)/10,o=t;o<a;o+=i)e.linearRampToValueAtTime(this.getValueAtTime(o),o);return this._events.forEachAfter(this.context.currentTime,(function(t){"cancelScheduledValues"===t.type?e.cancelScheduledValues(t.time):"setTargetAtTime"===t.type?e.setTargetAtTime(t.value,t.time,t.constant):e[t.type](t.value,t.time)})),this}},{key:"setParam",value:function(e){U8(this._swappable,"The Param must be assigned as 'swappable' in the constructor");var t=this.input;return t.disconnect(this._param),this.apply(e),this._param=e,t.connect(this._param),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._events.dispose(),this}},{key:"defaultValue",get:function(){return this._toType(this._param.defaultValue)}},{key:"_exponentialApproach",value:function(e,t,n,r,a){return n+(t-n)*Math.exp(-(a-e)/r)}},{key:"_linearInterpolate",value:function(e,t,n,r,a){return t+(a-e)/(n-e)*(r-t)}},{key:"_exponentialInterpolate",value:function(e,t,n,r,a){return t*Math.pow(r/t,(a-e)/(n-e))}}],[{key:"getDefaults",value:function(){return Object.assign(l9.getDefaults(),{convert:!0,units:"number"})}}]),n}(l9),d9=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).name="ToneAudioNode",e._internalChannels=[],e}return Jn(n,[{key:"numberOfInputs",get:function(){return K8(this.input)?c7(this.input)||this.input instanceof f9?1:this.input.numberOfInputs:0}},{key:"numberOfOutputs",get:function(){return K8(this.output)?this.output.numberOfOutputs:0}},{key:"_isAudioNode",value:function(e){return K8(e)&&(e instanceof n||l7(e))}},{key:"_getInternalNodes",value:function(){var e=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&e.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&e.push(this.output),e}},{key:"_setChannelProperties",value:function(e){this._getInternalNodes().forEach((function(t){t.channelCount=e.channelCount,t.channelCountMode=e.channelCountMode,t.channelInterpretation=e.channelInterpretation}))}},{key:"_getChannelProperties",value:function(){var e=this._getInternalNodes();U8(e.length>0,"ToneAudioNode does not have any internal nodes");var t=e[0];return{channelCount:t.channelCount,channelCountMode:t.channelCountMode,channelInterpretation:t.channelInterpretation}}},{key:"channelCount",get:function(){return this._getChannelProperties().channelCount},set:function(e){var t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCount:e}))}},{key:"channelCountMode",get:function(){return this._getChannelProperties().channelCountMode},set:function(e){var t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelCountMode:e}))}},{key:"channelInterpretation",get:function(){return this._getChannelProperties().channelInterpretation},set:function(e){var t=this._getChannelProperties();this._setChannelProperties(Object.assign(t,{channelInterpretation:e}))}},{key:"connect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return v9(this,e,t,n),this}},{key:"toDestination",value:function(){return this.connect(this.context.destination),this}},{key:"toMaster",value:function(){return H8("toMaster() has been renamed toDestination()"),this.toDestination()}},{key:"disconnect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return m9(this,e,t,n),this}},{key:"chain",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return p9.apply(void 0,[this].concat(t)),this}},{key:"fan",value:function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return n.forEach((function(t){return e.connect(t)})),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),K8(this.input)&&(this.input instanceof n?this.input.dispose():l7(this.input)&&this.input.disconnect()),K8(this.output)&&(this.output instanceof n?this.output.dispose():l7(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}]),n}(l9);function p9(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r=t.shift();t.reduce((function(e,t){return e instanceof d9?e.connect(t):l7(e)&&v9(e,t),t}),r)}function v9(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;for(U8(K8(e),"Cannot connect from undefined node"),U8(K8(t),"Cannot connect to undefined node"),(t instanceof d9||l7(t))&&U8(t.numberOfInputs>0,"Cannot connect to node with no inputs"),U8(e.numberOfOutputs>0,"Cannot connect from node with no outputs");t instanceof d9||t instanceof f9;)K8(t.input)&&(t=t.input);for(;e instanceof d9;)K8(e.output)&&(e=e.output);c7(t)?e.connect(t,n):e.connect(t,n,r)}function m9(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(K8(t))for(;t instanceof d9;)t=t.input;for(;!l7(e);)K8(e.output)&&(e=e.output);c7(t)?e.disconnect(t,n):l7(t)?e.disconnect(t,n,r):e.disconnect()}var g9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["gain","units"]))).name="Gain",e._gainNode=e.context.createGain(),e.input=e._gainNode,e.output=e._gainNode;var r=m7(n.getDefaults(),arguments,["gain","units"]);return e.gain=new f9({context:e.context,convert:r.convert,param:e._gainNode.gain,units:r.units,value:r.gain,minValue:r.minValue,maxValue:r.maxValue}),L7(ir(e),"gain"),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._gainNode.disconnect(),this.gain.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{convert:!0,gain:1,units:"gain"})}}]),n}(d9),y9=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).onended=z7,r._startTime=-1,r._stopTime=-1,r._timeout=-1,r.output=new g9({context:r.context,gain:0}),r._gainNode=r.output,r.getStateAtTime=function(e){var t=this.toSeconds(e);return-1!==this._startTime&&t>=this._startTime&&(-1===this._stopTime||t<=this._stopTime)?"started":"stopped"},r._fadeIn=e.fadeIn,r._fadeOut=e.fadeOut,r._curve=e.curve,r.onended=e.onended,r}return Jn(n,[{key:"_startGain",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;U8(-1===this._startTime,"Source cannot be started more than once");var n=this.toSeconds(this._fadeIn);return this._startTime=e+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,e),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(t,e+n):this._gainNode.gain.exponentialApproachValueAtTime(t,e,n)):this._gainNode.gain.setValueAtTime(t,e),this}},{key:"stop",value:function(e){return this.log("stop",e),this._stopGain(this.toSeconds(e)),this}},{key:"_stopGain",value:function(e){var t=this;U8(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();var n=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(e)+n,this._stopTime=Math.max(this._stopTime,this.context.currentTime),n>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,n,e):this._gainNode.gain.targetRampTo(0,n,e):(this._gainNode.gain.cancelAndHoldAtTime(e),this._gainNode.gain.setValueAtTime(0,e)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((function(){var e="exponential"===t._curve?2*n:0;t._stopSource(t.now()+e),t._onended()}),this._stopTime-this.context.currentTime),this}},{key:"_onended",value:function(){var e=this;if(this.onended!==z7&&(this.onended(this),this.onended=z7,!this.context.isOffline)){var t=function(){return e.dispose()};"undefined"!==typeof window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}},{key:"state",get:function(){return this.getStateAtTime(this.now())}},{key:"cancelStop",value:function(){return this.log("cancelStop"),U8(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._gainNode.disconnect(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:z7})}}]),n}(d9),b9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["offset"]))).name="ToneConstantSource",e._source=e.context.createConstantSource();var r=m7(n.getDefaults(),arguments,["offset"]);return v9(e._source,e._gainNode),e.offset=new f9({context:e.context,convert:r.convert,param:e._source.offset,units:r.units,value:r.offset,minValue:r.minValue,maxValue:r.maxValue}),e}return Jn(n,[{key:"start",value:function(e){var t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._source.start(t),this}},{key:"_stopSource",value:function(e){this._source.stop(e)}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(y9.getDefaults(),{convert:!0,offset:1,units:"number"})}}]),n}(y9),x9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["value","units"]))).name="Signal",e.override=!0;var r=m7(n.getDefaults(),arguments,["value","units"]);return e.output=e._constantSource=new b9({context:e.context,convert:r.convert,offset:r.value,units:r.units,minValue:r.minValue,maxValue:r.maxValue}),e._constantSource.start(0),e.input=e._param=e._constantSource.offset,e}return Jn(n,[{key:"connect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return k9(this,e,t,n),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._param.dispose(),this._constantSource.dispose(),this}},{key:"setValueAtTime",value:function(e,t){return this._param.setValueAtTime(e,t),this}},{key:"getValueAtTime",value:function(e){return this._param.getValueAtTime(e)}},{key:"setRampPoint",value:function(e){return this._param.setRampPoint(e),this}},{key:"linearRampToValueAtTime",value:function(e,t){return this._param.linearRampToValueAtTime(e,t),this}},{key:"exponentialRampToValueAtTime",value:function(e,t){return this._param.exponentialRampToValueAtTime(e,t),this}},{key:"exponentialRampTo",value:function(e,t,n){return this._param.exponentialRampTo(e,t,n),this}},{key:"linearRampTo",value:function(e,t,n){return this._param.linearRampTo(e,t,n),this}},{key:"targetRampTo",value:function(e,t,n){return this._param.targetRampTo(e,t,n),this}},{key:"exponentialApproachValueAtTime",value:function(e,t,n){return this._param.exponentialApproachValueAtTime(e,t,n),this}},{key:"setTargetAtTime",value:function(e,t,n){return this._param.setTargetAtTime(e,t,n),this}},{key:"setValueCurveAtTime",value:function(e,t,n,r){return this._param.setValueCurveAtTime(e,t,n,r),this}},{key:"cancelScheduledValues",value:function(e){return this._param.cancelScheduledValues(e),this}},{key:"cancelAndHoldAtTime",value:function(e){return this._param.cancelAndHoldAtTime(e),this}},{key:"rampTo",value:function(e,t,n){return this._param.rampTo(e,t,n),this}},{key:"value",get:function(){return this._param.value},set:function(e){this._param.value=e}},{key:"convert",get:function(){return this._param.convert},set:function(e){this._param.convert=e}},{key:"units",get:function(){return this._param.units}},{key:"overridden",get:function(){return this._param.overridden},set:function(e){this._param.overridden=e}},{key:"maxValue",get:function(){return this._param.maxValue}},{key:"minValue",get:function(){return this._param.minValue}},{key:"apply",value:function(e){return this._param.apply(e),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{convert:!0,units:"number",value:0})}}]),n}(d9);function k9(e,t,n,r){(t instanceof f9||c7(t)||t instanceof x9&&t.override)&&(t.cancelScheduledValues(0),t.setValueAtTime(0,0),t instanceof x9&&(t.overridden=!0)),v9(e,t,n,r)}var w9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["value"]))).name="TickParam",e._events=new T7(1/0),e._multiplier=1;var r=m7(n.getDefaults(),arguments,["value"]);return e._multiplier=r.multiplier,e._events.cancel(0),e._events.add({ticks:0,time:0,type:"setValueAtTime",value:e._fromType(r.value)}),e.setValueAtTime(r.value,0),e}return Jn(n,[{key:"setTargetAtTime",value:function(e,t,n){t=this.toSeconds(t),this.setRampPoint(t);for(var r=this._fromType(e),a=this._events.get(t),i=Math.round(Math.max(1/n,1)),o=0;o<=i;o++){var s=n*o+t,u=this._exponentialApproach(a.time,a.value,r,n,s);this.linearRampToValueAtTime(this._toType(u),s)}return this}},{key:"setValueAtTime",value:function(e,t){var r=this.toSeconds(t);ja(nr(n.prototype),"setValueAtTime",this).call(this,e,t);var a=this._events.get(r),i=this._events.previousEvent(a),o=this._getTicksUntilEvent(i,r);return a.ticks=Math.max(o,0),this}},{key:"linearRampToValueAtTime",value:function(e,t){var r=this.toSeconds(t);ja(nr(n.prototype),"linearRampToValueAtTime",this).call(this,e,t);var a=this._events.get(r),i=this._events.previousEvent(a),o=this._getTicksUntilEvent(i,r);return a.ticks=Math.max(o,0),this}},{key:"exponentialRampToValueAtTime",value:function(e,t){t=this.toSeconds(t);for(var n=this._fromType(e),r=this._events.get(t),a=Math.round(Math.max(10*(t-r.time),1)),i=(t-r.time)/a,o=0;o<=a;o++){var s=i*o+r.time,u=this._exponentialInterpolate(r.time,r.value,t,n,s);this.linearRampToValueAtTime(this._toType(u),s)}return this}},{key:"_getTicksUntilEvent",value:function(e,t){if(null===e)e={ticks:0,time:0,type:"setValueAtTime",value:0};else if(X8(e.ticks)){var n=this._events.previousEvent(e);e.ticks=this._getTicksUntilEvent(n,e.time)}var r=this._fromType(this.getValueAtTime(e.time)),a=this._fromType(this.getValueAtTime(t)),i=this._events.get(t);return i&&i.time===t&&"setValueAtTime"===i.type&&(a=this._fromType(this.getValueAtTime(t-this.sampleTime))),.5*(t-e.time)*(r+a)+e.ticks}},{key:"getTicksAtTime",value:function(e){var t=this.toSeconds(e),n=this._events.get(t);return Math.max(this._getTicksUntilEvent(n,t),0)}},{key:"getDurationOfTicks",value:function(e,t){var n=this.toSeconds(t),r=this.getTicksAtTime(t);return this.getTimeOfTick(r+e)-n}},{key:"getTimeOfTick",value:function(e){var t=this._events.get(e,"ticks"),n=this._events.getAfter(e,"ticks");if(t&&t.ticks===e)return t.time;if(t&&n&&"linearRampToValueAtTime"===n.type&&t.value!==n.value){var r=this._fromType(this.getValueAtTime(t.time)),a=(this._fromType(this.getValueAtTime(n.time))-r)/(n.time-t.time),i=Math.sqrt(Math.pow(r,2)-2*a*(t.ticks-e)),o=(-r+i)/a;return(o>0?o:(-r-i)/a)+t.time}return t?0===t.value?1/0:t.time+(e-t.ticks)/t.value:e/this._initialValue}},{key:"ticksToTime",value:function(e,t){return this.getDurationOfTicks(e,t)}},{key:"timeToTicks",value:function(e,t){var n=this.toSeconds(t),r=this.toSeconds(e),a=this.getTicksAtTime(n);return this.getTicksAtTime(n+r)-a}},{key:"_fromType",value:function(e){return"bpm"===this.units&&this.multiplier?1/(60/e/this.multiplier):ja(nr(n.prototype),"_fromType",this).call(this,e)}},{key:"_toType",value:function(e){return"bpm"===this.units&&this.multiplier?e/this.multiplier*60:ja(nr(n.prototype),"_toType",this).call(this,e)}},{key:"multiplier",get:function(){return this._multiplier},set:function(e){var t=this.value;this._multiplier=e,this.cancelScheduledValues(0),this.setValueAtTime(t,0)}}],[{key:"getDefaults",value:function(){return Object.assign(f9.getDefaults(),{multiplier:1,units:"hertz",value:1})}}]),n}(f9),_9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["value"]))).name="TickSignal";var r=m7(n.getDefaults(),arguments,["value"]);return e.input=e._param=new w9({context:e.context,convert:r.convert,multiplier:r.multiplier,param:e._constantSource.offset,units:r.units,value:r.value}),e}return Jn(n,[{key:"ticksToTime",value:function(e,t){return this._param.ticksToTime(e,t)}},{key:"timeToTicks",value:function(e,t){return this._param.timeToTicks(e,t)}},{key:"getTimeOfTick",value:function(e){return this._param.getTimeOfTick(e)}},{key:"getDurationOfTicks",value:function(e,t){return this._param.getDurationOfTicks(e,t)}},{key:"getTicksAtTime",value:function(e){return this._param.getTicksAtTime(e)}},{key:"multiplier",get:function(){return this._param.multiplier},set:function(e){this._param.multiplier=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._param.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(x9.getDefaults(),{multiplier:1,units:"hertz",value:1})}}]),n}(x9),S9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency"]))).name="TickSource",e._state=new h9,e._tickOffset=new T7;var r=m7(n.getDefaults(),arguments,["frequency"]);return e.frequency=new _9({context:e.context,units:r.units,value:r.frequency}),L7(ir(e),"frequency"),e._state.setStateAtTime("stopped",0),e.setTicksAtTime(0,0),e}return Jn(n,[{key:"state",get:function(){return this.getStateAtTime(this.now())}},{key:"start",value:function(e,t){var n=this.toSeconds(e);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),K8(t)&&this.setTicksAtTime(t,n)),this}},{key:"stop",value:function(e){var t=this.toSeconds(e);if("stopped"===this._state.getValueAtTime(t)){var n=this._state.get(t);n&&n.time>0&&(this._tickOffset.cancel(n.time),this._state.cancel(n.time))}return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this.setTicksAtTime(0,t),this}},{key:"pause",value:function(e){var t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&this._state.setStateAtTime("paused",t),this}},{key:"cancel",value:function(e){return e=this.toSeconds(e),this._state.cancel(e),this._tickOffset.cancel(e),this}},{key:"getTicksAtTime",value:function(e){var t=this,n=this.toSeconds(e),r=this._state.getLastState("stopped",n),a={state:"paused",time:n};this._state.add(a);var i=r,o=0;return this._state.forEachBetween(r.time,n+this.sampleTime,(function(e){var n=i.time,r=t._tickOffset.get(e.time);r&&r.time>=i.time&&(o=r.ticks,n=r.time),"started"===i.state&&"started"!==e.state&&(o+=t.frequency.getTicksAtTime(e.time)-t.frequency.getTicksAtTime(n)),i=e})),this._state.remove(a),o}},{key:"ticks",get:function(){return this.getTicksAtTime(this.now())},set:function(e){this.setTicksAtTime(e,this.now())}},{key:"seconds",get:function(){return this.getSecondsAtTime(this.now())},set:function(e){var t=this.now(),n=this.frequency.timeToTicks(e,t);this.setTicksAtTime(n,t)}},{key:"getSecondsAtTime",value:function(e){var t=this;e=this.toSeconds(e);var n=this._state.getLastState("stopped",e),r={state:"paused",time:e};this._state.add(r);var a=n,i=0;return this._state.forEachBetween(n.time,e+this.sampleTime,(function(e){var n=a.time,r=t._tickOffset.get(e.time);r&&r.time>=a.time&&(i=r.seconds,n=r.time),"started"===a.state&&"started"!==e.state&&(i+=e.time-n),a=e})),this._state.remove(r),i}},{key:"setTicksAtTime",value:function(e,t){return t=this.toSeconds(t),this._tickOffset.cancel(t),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(e,t),ticks:e,time:t}),this}},{key:"getStateAtTime",value:function(e){return e=this.toSeconds(e),this._state.getValueAtTime(e)}},{key:"getTimeOfTick",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.now(),n=this._tickOffset.get(t),r=this._state.get(t),a=Math.max(n.time,r.time),i=this.frequency.getTicksAtTime(a)+e-n.ticks;return this.frequency.getTimeOfTick(i)}},{key:"forEachTickBetween",value:function(e,t,n){var r=this,a=this._state.get(e);this._state.forEachBetween(e,t,(function(t){a&&"started"===a.state&&"started"!==t.state&&r.forEachTickBetween(Math.max(a.time,e),t.time-r.sampleTime,n),a=t}));var i=null;if(a&&"started"===a.state){var o=Math.max(a.time,e),s=this.frequency.getTicksAtTime(o),u=s-this.frequency.getTicksAtTime(a.time),c=Math.ceil(u)-u;c=S7(c,1)?0:c;for(var l=this.frequency.getTimeOfTick(s+c);l<t;){try{n(l,Math.round(this.getTicksAtTime(l)))}catch(h){i=h;break}l+=this.frequency.getDurationOfTicks(1,l)}}if(i)throw i;return this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign({frequency:1,units:"hertz"},l9.getDefaults())}}]),n}(l9),C9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["callback","frequency"]))).name="Clock",e.callback=z7,e._lastUpdate=0,e._state=new h9("stopped"),e._boundLoop=e._loop.bind(ir(e));var r=m7(n.getDefaults(),arguments,["callback","frequency"]);return e.callback=r.callback,e._tickSource=new S9({context:e.context,frequency:r.frequency,units:r.units}),e._lastUpdate=0,e.frequency=e._tickSource.frequency,L7(ir(e),"frequency"),e._state.setStateAtTime("stopped",0),e.context.on("tick",e._boundLoop),e}return Jn(n,[{key:"state",get:function(){return this._state.getValueAtTime(this.now())}},{key:"start",value:function(e,t){W8(this.context);var n=this.toSeconds(e);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,t),n<this._lastUpdate&&this.emit("start",n,t)),this}},{key:"stop",value:function(e){var t=this.toSeconds(e);return this.log("stop",t),this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._tickSource.stop(t),t<this._lastUpdate&&this.emit("stop",t),this}},{key:"pause",value:function(e){var t=this.toSeconds(e);return"started"===this._state.getValueAtTime(t)&&(this._state.setStateAtTime("paused",t),this._tickSource.pause(t),t<this._lastUpdate&&this.emit("pause",t)),this}},{key:"ticks",get:function(){return Math.ceil(this.getTicksAtTime(this.now()))},set:function(e){this._tickSource.ticks=e}},{key:"seconds",get:function(){return this._tickSource.seconds},set:function(e){this._tickSource.seconds=e}},{key:"getSecondsAtTime",value:function(e){return this._tickSource.getSecondsAtTime(e)}},{key:"setTicksAtTime",value:function(e,t){return this._tickSource.setTicksAtTime(e,t),this}},{key:"getTimeOfTick",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.now();return this._tickSource.getTimeOfTick(e,t)}},{key:"getTicksAtTime",value:function(e){return this._tickSource.getTicksAtTime(e)}},{key:"nextTickTime",value:function(e,t){var n=this.toSeconds(t),r=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(r+e,n)}},{key:"_loop",value:function(){var e=this,t=this._lastUpdate,n=this.now();this._lastUpdate=n,this.log("loop",t,n),t!==n&&(this._state.forEachBetween(t,n,(function(t){switch(t.state){case"started":var n=e._tickSource.getTicksAtTime(t.time);e.emit("start",t.time,n);break;case"stopped":0!==t.time&&e.emit("stop",t.time);break;case"paused":e.emit("pause",t.time)}})),this._tickSource.forEachTickBetween(t,n,(function(t,n){e.callback(t,n)})))}},{key:"getStateAtTime",value:function(e){var t=this.toSeconds(e);return this._state.getValueAtTime(t)}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(l9.getDefaults(),{callback:z7,frequency:1,units:"hertz"})}}]),n}(l9);R7.mixin(C9);var T9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["delayTime","maxDelay"]))).name="Delay";var r=m7(n.getDefaults(),arguments,["delayTime","maxDelay"]),a=e.toSeconds(r.maxDelay);return e._maxDelay=Math.max(a,e.toSeconds(r.delayTime)),e._delayNode=e.input=e.output=e.context.createDelay(a),e.delayTime=new f9({context:e.context,param:e._delayNode.delayTime,units:"time",value:r.delayTime,minValue:0,maxValue:e.maxDelay}),L7(ir(e),"delayTime"),e}return Jn(n,[{key:"maxDelay",get:function(){return this._maxDelay}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._delayNode.disconnect(),this.delayTime.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{delayTime:0,maxDelay:1})}}]),n}(d9);function E9(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:G7().sampleRate;return s7(this,void 0,void 0,es().mark((function a(){var i,o,s,u;return es().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return i=G7(),j7(o=new U7(n,t,r)),a.next=5,e(o);case 5:return s=o.render(),j7(i),a.next=9,s;case 9:return u=a.sent,a.abrupt("return",new B7(u));case 11:case"end":return a.stop()}}),a)})))}var I9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this)).name="ToneAudioBuffers",e._buffers=new Map,e._loadingCount=0;var r=m7(n.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");return e.baseUrl=r.baseUrl,Object.keys(r.urls).forEach((function(t){e._loadingCount++;var n=r.urls[t];e.add(t,n,e._bufferLoaded.bind(ir(e),r.onload),r.onerror)})),e}return Jn(n,[{key:"has",value:function(e){return this._buffers.has(e.toString())}},{key:"get",value:function(e){return U8(this.has(e),"ToneAudioBuffers has no buffer named: ".concat(e)),this._buffers.get(e.toString())}},{key:"_bufferLoaded",value:function(e){this._loadingCount--,0===this._loadingCount&&e&&e()}},{key:"loaded",get:function(){return Array.from(this._buffers).every((function(e){var t=f(e,2);t[0];return t[1].loaded}))}},{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:z7,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:z7;return e7(t)?this._buffers.set(e.toString(),new B7(this.baseUrl+t,n,r)):this._buffers.set(e.toString(),new B7(t,n,r)),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._buffers.forEach((function(e){return e.dispose()})),this._buffers.clear(),this}}],[{key:"getDefaults",value:function(){return{baseUrl:"",onerror:z7,onload:z7,urls:{}}}}]),n}(b7),A9=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).name="MidiClass",e.defaultUnits="midi",e}return Jn(n,[{key:"_frequencyToUnits",value:function(e){return J7(ja(nr(n.prototype),"_frequencyToUnits",this).call(this,e))}},{key:"_ticksToUnits",value:function(e){return J7(ja(nr(n.prototype),"_ticksToUnits",this).call(this,e))}},{key:"_beatsToUnits",value:function(e){return J7(ja(nr(n.prototype),"_beatsToUnits",this).call(this,e))}},{key:"_secondsToUnits",value:function(e){return J7(ja(nr(n.prototype),"_secondsToUnits",this).call(this,e))}},{key:"toMidi",value:function(){return this.valueOf()}},{key:"toFrequency",value:function(){return e9(this.toMidi())}},{key:"transpose",value:function(e){return new n(this.context,this.toMidi()+e)}}]),n}(a9);function M9(e,t){return new A9(G7(),e,t)}var N9=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).name="Ticks",e.defaultUnits="i",e}return Jn(n,[{key:"_now",value:function(){return this.context.transport.ticks}},{key:"_beatsToUnits",value:function(e){return this._getPPQ()*e}},{key:"_secondsToUnits",value:function(e){return Math.floor(e/(60/this._getBpm())*this._getPPQ())}},{key:"_ticksToUnits",value:function(e){return e}},{key:"toTicks",value:function(){return this.valueOf()}},{key:"toSeconds",value:function(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}]),n}(u9);function R9(e,t){return new N9(G7(),e,t)}var D9=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).name="Draw",e.expiration=.25,e.anticipation=.008,e._events=new T7,e._boundDrawLoop=e._drawLoop.bind(ir(e)),e._animationFrame=-1,e}return Jn(n,[{key:"schedule",value:function(e,t){return this._events.add({callback:e,time:this.toSeconds(t)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}},{key:"cancel",value:function(e){return this._events.cancel(this.toSeconds(e)),this}},{key:"_drawLoop",value:function(){for(var e=this.context.currentTime;this._events.length&&this._events.peek().time-this.anticipation<=e;){var t=this._events.shift();t&&e-t.time<=this.expiration&&t.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}]),n}(l9);I7((function(e){e.draw=new D9({context:e})})),M7((function(e){e.draw.dispose()}));var P9=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).name="IntervalTimeline",e._root=null,e._length=0,e}return Jn(n,[{key:"add",value:function(e){U8(K8(e.time),"Events must have a time property"),U8(K8(e.duration),"Events must have a duration parameter"),e.time=e.time.valueOf();var t=new O9(e.time,e.time+e.duration,e);for(null===this._root?this._root=t:this._root.insert(t),this._length++;null!==t;)t.updateHeight(),t.updateMax(),this._rebalance(t),t=t.parent;return this}},{key:"remove",value:function(e){if(null!==this._root){var t=[];this._root.search(e.time,t);for(var n=0,r=t;n<r.length;n++){var a=r[n];if(a.event===e){this._removeNode(a),this._length--;break}}}return this}},{key:"length",get:function(){return this._length}},{key:"cancel",value:function(e){var t=this;return this.forEachFrom(e,(function(e){return t.remove(e)})),this}},{key:"_setRoot",value:function(e){this._root=e,null!==this._root&&(this._root.parent=null)}},{key:"_replaceNodeInParent",value:function(e,t){null!==e.parent?(e.isLeftChild()?e.parent.left=t:e.parent.right=t,this._rebalance(e.parent)):this._setRoot(t)}},{key:"_removeNode",value:function(e){if(null===e.left&&null===e.right)this._replaceNodeInParent(e,null);else if(null===e.right)this._replaceNodeInParent(e,e.left);else if(null===e.left)this._replaceNodeInParent(e,e.right);else{var t,n=null;if(e.getBalance()>0)if(null===e.left.right)(t=e.left).right=e.right,n=t;else{for(t=e.left.right;null!==t.right;)t=t.right;t.parent&&(t.parent.right=t.left,n=t.parent,t.left=e.left,t.right=e.right)}else if(null===e.right.left)(t=e.right).left=e.left,n=t;else{for(t=e.right.left;null!==t.left;)t=t.left;t.parent&&(t.parent.left=t.right,n=t.parent,t.left=e.left,t.right=e.right)}null!==e.parent?e.isLeftChild()?e.parent.left=t:e.parent.right=t:this._setRoot(t),n&&this._rebalance(n)}e.dispose()}},{key:"_rotateLeft",value:function(e){var t=e.parent,n=e.isLeftChild(),r=e.right;r&&(e.right=r.left,r.left=e),null!==t?n?t.left=r:t.right=r:this._setRoot(r)}},{key:"_rotateRight",value:function(e){var t=e.parent,n=e.isLeftChild(),r=e.left;r&&(e.left=r.right,r.right=e),null!==t?n?t.left=r:t.right=r:this._setRoot(r)}},{key:"_rebalance",value:function(e){var t=e.getBalance();t>1&&e.left?e.left.getBalance()<0?this._rotateLeft(e.left):this._rotateRight(e):t<-1&&e.right&&(e.right.getBalance()>0?this._rotateRight(e.right):this._rotateLeft(e))}},{key:"get",value:function(e){if(null!==this._root){var t=[];if(this._root.search(e,t),t.length>0){for(var n=t[0],r=1;r<t.length;r++)t[r].low>n.low&&(n=t[r]);return n.event}}return null}},{key:"forEach",value:function(e){if(null!==this._root){var t=[];this._root.traverse((function(e){return t.push(e)})),t.forEach((function(t){t.event&&e(t.event)}))}return this}},{key:"forEachAtTime",value:function(e,t){if(null!==this._root){var n=[];this._root.search(e,n),n.forEach((function(e){e.event&&t(e.event)}))}return this}},{key:"forEachFrom",value:function(e,t){if(null!==this._root){var n=[];this._root.searchAfter(e,n),n.forEach((function(e){e.event&&t(e.event)}))}return this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),null!==this._root&&this._root.traverse((function(e){return e.dispose()})),this._root=null,this}}]),n}(b7),O9=function(){function e(t,n,r){$n(this,e),this._left=null,this._right=null,this.parent=null,this.height=0,this.event=r,this.low=t,this.high=n,this.max=this.high}return Jn(e,[{key:"insert",value:function(e){e.low<=this.low?null===this.left?this.left=e:this.left.insert(e):null===this.right?this.right=e:this.right.insert(e)}},{key:"search",value:function(e,t){e>this.max||(null!==this.left&&this.left.search(e,t),this.low<=e&&this.high>e&&t.push(this),this.low>e||null!==this.right&&this.right.search(e,t))}},{key:"searchAfter",value:function(e,t){this.low>=e&&(t.push(this),null!==this.left&&this.left.searchAfter(e,t)),null!==this.right&&this.right.searchAfter(e,t)}},{key:"traverse",value:function(e){e(this),null!==this.left&&this.left.traverse(e),null!==this.right&&this.right.traverse(e)}},{key:"updateHeight",value:function(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}},{key:"updateMax",value:function(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}},{key:"getBalance",value:function(){var e=0;return null!==this.left&&null!==this.right?e=this.left.height-this.right.height:null!==this.left?e=this.left.height+1:null!==this.right&&(e=-(this.right.height+1)),e}},{key:"isLeftChild",value:function(){return null!==this.parent&&this.parent.left===this}},{key:"left",get:function(){return this._left},set:function(e){this._left=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}},{key:"right",get:function(){return this._right},set:function(e){this._right=e,null!==e&&(e.parent=this),this.updateHeight(),this.updateMax()}},{key:"dispose",value:function(){this.parent=null,this._left=null,this._right=null,this.event=null}}]),e}(),L9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["volume"]))).name="Volume";var r=m7(n.getDefaults(),arguments,["volume"]);return e.input=e.output=new g9({context:e.context,gain:r.volume,units:"decibels"}),e.volume=e.output.gain,L7(ir(e),"volume"),e._unmutedVolume=r.volume,e.mute=r.mute,e}return Jn(n,[{key:"mute",get:function(){return this.volume.value===-1/0},set:function(e){!this.mute&&e?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!e&&(this.volume.value=this._unmutedVolume)}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.input.dispose(),this.volume.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{mute:!1,volume:0})}}]),n}(d9),F9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="Destination",e.input=new L9({context:e.context}),e.output=new g9({context:e.context}),e.volume=e.input.volume;var r=m7(n.getDefaults(),arguments);return p9(e.input,e.output,e.context.rawContext.destination),e.mute=r.mute,e._internalChannels=[e.input,e.context.rawContext.destination,e.output],e}return Jn(n,[{key:"mute",get:function(){return this.input.mute},set:function(e){this.input.mute=e}},{key:"chain",value:function(){this.input.disconnect();for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return t.unshift(this.input),t.push(this.output),p9.apply(void 0,t),this}},{key:"maxChannelCount",get:function(){return this.context.rawContext.destination.maxChannelCount}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.volume.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{mute:!1,volume:0})}}]),n}(d9);I7((function(e){e.destination=new F9({context:e})})),M7((function(e){e.destination.dispose()}));var z9=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).name="TimelineValue",r._timeline=new T7({memory:10}),r._initialValue=e,r}return Jn(n,[{key:"set",value:function(e,t){return this._timeline.add({value:e,time:t}),this}},{key:"get",value:function(e){var t=this._timeline.get(e);return t?t.value:this._initialValue}}]),n}(b7),B9=function(){function e(t,n){$n(this,e),this.id=e._eventId++;var r=Object.assign(e.getDefaults(),n);this.transport=t,this.callback=r.callback,this._once=r.once,this.time=r.time}return Jn(e,[{key:"invoke",value:function(e){this.callback&&(this.callback(e),this._once&&this.transport.clear(this.id))}},{key:"dispose",value:function(){return this.callback=void 0,this}}],[{key:"getDefaults",value:function(){return{callback:z7,once:!1,time:0}}}]),e}();B9._eventId=0;var U9=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;$n(this,n),(a=t.call(this,e,r))._currentId=-1,a._nextId=-1,a._nextTick=a.time,a._boundRestart=a._restart.bind(ir(a));var i=Object.assign(n.getDefaults(),r);return a.duration=new N9(e.context,i.duration).valueOf(),a._interval=new N9(e.context,i.interval).valueOf(),a._nextTick=i.time,a.transport.on("start",a._boundRestart),a.transport.on("loopStart",a._boundRestart),a.context=a.transport.context,a._restart(),a}return Jn(n,[{key:"invoke",value:function(e){this._createEvents(e),ja(nr(n.prototype),"invoke",this).call(this,e)}},{key:"_createEvents",value:function(e){var t=this.transport.getTicksAtTime(e);t>=this.time&&t>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new N9(this.context,this._nextTick).toSeconds()))}},{key:"_restart",value:function(e){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;var t=this.transport.getTicksAtTime(e);t>this.time&&(this._nextTick=this.time+Math.ceil((t-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new N9(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new N9(this.context,this._nextTick).toSeconds())}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}],[{key:"getDefaults",value:function(){return Object.assign({},B9.getDefaults(),{duration:1/0,interval:1,once:!1})}}]),n}(B9),V9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="Transport",e._loop=new z9(!1),e._loopStart=0,e._loopEnd=0,e._scheduledEvents={},e._timeline=new T7,e._repeatedEvents=new P9,e._syncedSignals=[],e._swingAmount=0;var r=m7(n.getDefaults(),arguments);return e._ppq=r.ppq,e._clock=new C9({callback:e._processTick.bind(ir(e)),context:e.context,frequency:0,units:"bpm"}),e._bindClockEvents(),e.bpm=e._clock.frequency,e._clock.frequency.multiplier=r.ppq,e.bpm.setValueAtTime(r.bpm,0),L7(ir(e),"bpm"),e._timeSignature=r.timeSignature,e._swingTicks=r.ppq/2,e}return Jn(n,[{key:"_processTick",value:function(e,t){if(this._loop.get(e)&&t>=this._loopEnd&&(this.emit("loopEnd",e),this._clock.setTicksAtTime(this._loopStart,e),t=this._loopStart,this.emit("loopStart",e,this._clock.getSecondsAtTime(e)),this.emit("loop",e)),this._swingAmount>0&&t%this._ppq!==0&&t%(2*this._swingTicks)!==0){var n=t%(2*this._swingTicks)/(2*this._swingTicks),r=Math.sin(n*Math.PI)*this._swingAmount;e+=new N9(this.context,2*this._swingTicks/3).toSeconds()*r}this._timeline.forEachAtTime(t,(function(t){return t.invoke(e)}))}},{key:"schedule",value:function(e,t){var n=new B9(this,{callback:e,time:new u9(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}},{key:"scheduleRepeat",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0,a=new U9(this,{callback:e,duration:new n9(this.context,r).toTicks(),interval:new n9(this.context,t).toTicks(),time:new u9(this.context,n).toTicks()});return this._addEvent(a,this._repeatedEvents)}},{key:"scheduleOnce",value:function(e,t){var n=new B9(this,{callback:e,once:!0,time:new u9(this.context,t).toTicks()});return this._addEvent(n,this._timeline)}},{key:"clear",value:function(e){if(this._scheduledEvents.hasOwnProperty(e)){var t=this._scheduledEvents[e.toString()];t.timeline.remove(t.event),t.event.dispose(),delete this._scheduledEvents[e.toString()]}return this}},{key:"_addEvent",value:function(e,t){return this._scheduledEvents[e.id.toString()]={event:e,timeline:t},t.add(e),e.id}},{key:"cancel",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=this.toTicks(t);return this._timeline.forEachFrom(n,(function(t){return e.clear(t.id)})),this._repeatedEvents.forEachFrom(n,(function(t){return e.clear(t.id)})),this}},{key:"_bindClockEvents",value:function(){var e=this;this._clock.on("start",(function(t,n){n=new N9(e.context,n).toSeconds(),e.emit("start",t,n)})),this._clock.on("stop",(function(t){e.emit("stop",t)})),this._clock.on("pause",(function(t){e.emit("pause",t)}))}},{key:"state",get:function(){return this._clock.getStateAtTime(this.now())}},{key:"start",value:function(e,t){var n;return K8(t)&&(n=this.toTicks(t)),this._clock.start(e,n),this}},{key:"stop",value:function(e){return this._clock.stop(e),this}},{key:"pause",value:function(e){return this._clock.pause(e),this}},{key:"toggle",value:function(e){return e=this.toSeconds(e),"started"!==this._clock.getStateAtTime(e)?this.start(e):this.stop(e),this}},{key:"timeSignature",get:function(){return this._timeSignature},set:function(e){$8(e)&&(e=e[0]/e[1]*4),this._timeSignature=e}},{key:"loopStart",get:function(){return new n9(this.context,this._loopStart,"i").toSeconds()},set:function(e){this._loopStart=this.toTicks(e)}},{key:"loopEnd",get:function(){return new n9(this.context,this._loopEnd,"i").toSeconds()},set:function(e){this._loopEnd=this.toTicks(e)}},{key:"loop",get:function(){return this._loop.get(this.now())},set:function(e){this._loop.set(e,this.now())}},{key:"setLoopPoints",value:function(e,t){return this.loopStart=e,this.loopEnd=t,this}},{key:"swing",get:function(){return this._swingAmount},set:function(e){this._swingAmount=e}},{key:"swingSubdivision",get:function(){return new N9(this.context,this._swingTicks).toNotation()},set:function(e){this._swingTicks=this.toTicks(e)}},{key:"position",get:function(){var e=this.now(),t=this._clock.getTicksAtTime(e);return new N9(this.context,t).toBarsBeatsSixteenths()},set:function(e){var t=this.toTicks(e);this.ticks=t}},{key:"seconds",get:function(){return this._clock.seconds},set:function(e){var t=this.now(),n=this._clock.frequency.timeToTicks(e,t);this.ticks=n}},{key:"progress",get:function(){if(this.loop){var e=this.now();return(this._clock.getTicksAtTime(e)-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}},{key:"ticks",get:function(){return this._clock.ticks},set:function(e){if(this._clock.ticks!==e){var t=this.now();if("started"===this.state){var n=this._clock.getTicksAtTime(t),r=t+this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,t);this.emit("stop",r),this._clock.setTicksAtTime(e,r),this.emit("start",r,this._clock.getSecondsAtTime(r))}else this._clock.setTicksAtTime(e,t)}}},{key:"getTicksAtTime",value:function(e){return Math.round(this._clock.getTicksAtTime(e))}},{key:"getSecondsAtTime",value:function(e){return this._clock.getSecondsAtTime(e)}},{key:"PPQ",get:function(){return this._clock.frequency.multiplier},set:function(e){this._clock.frequency.multiplier=e}},{key:"nextSubdivision",value:function(e){if(e=this.toTicks(e),"started"!==this.state)return 0;var t=this.now(),n=e-this.getTicksAtTime(t)%e;return this._clock.nextTickTime(n,t)}},{key:"syncSignal",value:function(e,t){if(!t){var n=this.now();if(0!==e.getValueAtTime(n)){var r=1/(60/this.bpm.getValueAtTime(n)/this.PPQ);t=e.getValueAtTime(n)/r}else t=0}var a=new g9(t);return this.bpm.connect(a),a.connect(e._param),this._syncedSignals.push({initial:e.value,ratio:a,signal:e}),e.value=0,this}},{key:"unsyncSignal",value:function(e){for(var t=this._syncedSignals.length-1;t>=0;t--){var n=this._syncedSignals[t];n.signal===e&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(t,1))}return this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._clock.dispose(),F7(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(l9.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}}]),n}(l9);R7.mixin(V9),I7((function(e){e.transport=new V9({context:e})})),M7((function(e){e.transport.dispose()}));var W9=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).input=void 0,r._state=new h9("stopped"),r._synced=!1,r._scheduled=[],r._syncedStart=z7,r._syncedStop=z7,r._state.memory=100,r._state.increasing=!0,r._volume=r.output=new L9({context:r.context,mute:e.mute,volume:e.volume}),r.volume=r._volume.volume,L7(ir(r),"volume"),r.onstop=e.onstop,r}return Jn(n,[{key:"state",get:function(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}},{key:"mute",get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}},{key:"_clampToCurrentTime",value:function(e){return this._synced?e:Math.max(e,this.context.currentTime)}},{key:"start",value:function(e,t,n){var r=this,a=X8(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(a=this._clampToCurrentTime(a),this._synced||"started"!==this._state.getValueAtTime(a))if(this.log("start",a),this._state.setStateAtTime("started",a),this._synced){var i=this._state.get(a);i&&(i.offset=this.toSeconds(g7(t,0)),i.duration=n?this.toSeconds(n):void 0);var o=this.context.transport.schedule((function(e){r._start(e,t,n)}),a);this._scheduled.push(o),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>a&&this._syncedStart(this.now(),this.context.transport.seconds)}else W8(this.context),this._start(a,t,n);else U8(k7(a,this._state.get(a).time),"Start time must be strictly greater than previous start time"),this._state.cancel(a),this._state.setStateAtTime("started",a),this.log("restart",a),this.restart(a,t,n);return this}},{key:"stop",value:function(e){var t=X8(e)&&this._synced?this.context.transport.seconds:this.toSeconds(e);if(t=this._clampToCurrentTime(t),"started"===this._state.getValueAtTime(t)||K8(this._state.getNextState("started",t))){if(this.log("stop",t),this._synced){var n=this.context.transport.schedule(this._stop.bind(this),t);this._scheduled.push(n)}else this._stop(t);this._state.cancel(t),this._state.setStateAtTime("stopped",t)}return this}},{key:"restart",value:function(e,t,n){return e=this.toSeconds(e),"started"===this._state.getValueAtTime(e)&&(this._state.cancel(e),this._restart(e,t,n)),this}},{key:"sync",value:function(){var e=this;return this._synced||(this._synced=!0,this._syncedStart=function(t,n){if(n>0){var r=e._state.get(n);if(r&&"started"===r.state&&r.time!==n){var a,i=n-e.toSeconds(r.time);r.duration&&(a=e.toSeconds(r.duration)-i),e._start(t,e.toSeconds(r.offset)+i,a)}}},this._syncedStop=function(t){var n=e.context.transport.getSecondsAtTime(Math.max(t-e.sampleTime,0));"started"===e._state.getValueAtTime(n)&&e._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}},{key:"unsync",value:function(){var e=this;return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((function(t){return e.context.transport.clear(t)})),this._scheduled=[],this._state.cancel(0),this._stop(0),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.onstop=z7,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{mute:!1,onstop:z7,volume:0})}}]),n}(d9),G9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["url","onload"]))).name="ToneBufferSource",e._source=e.context.createBufferSource(),e._internalChannels=[e._source],e._sourceStarted=!1,e._sourceStopped=!1;var r=m7(n.getDefaults(),arguments,["url","onload"]);return v9(e._source,e._gainNode),e._source.onended=function(){return e._stopSource()},e.playbackRate=new f9({context:e.context,param:e._source.playbackRate,units:"positive",value:r.playbackRate}),e.loop=r.loop,e.loopStart=r.loopStart,e.loopEnd=r.loopEnd,e._buffer=new B7(r.url,r.onload,r.onerror),e._internalChannels.push(e._source),e}return Jn(n,[{key:"fadeIn",get:function(){return this._fadeIn},set:function(e){this._fadeIn=e}},{key:"fadeOut",get:function(){return this._fadeOut},set:function(e){this._fadeOut=e}},{key:"curve",get:function(){return this._curve},set:function(e){this._curve=e}},{key:"start",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;U8(this.buffer.loaded,"buffer is either not set or not loaded");var a=this.toSeconds(e);this._startGain(a,r),t=this.loop?g7(t,this.loopStart):g7(t,0);var i=Math.max(this.toSeconds(t),0);if(this.loop){var o=this.toSeconds(this.loopEnd)||this.buffer.duration,s=this.toSeconds(this.loopStart),u=o-s;w7(i,o)&&(i=(i-s)%u+s),S7(i,this.buffer.duration)&&(i=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,_7(i,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(a,i)),K8(n)){var c=this.toSeconds(n);c=Math.max(c,0),this.stop(a+c)}return this}},{key:"_stopSource",value:function(e){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(e)),this._onended())}},{key:"loopStart",get:function(){return this._source.loopStart},set:function(e){this._source.loopStart=this.toSeconds(e)}},{key:"loopEnd",get:function(){return this._source.loopEnd},set:function(e){this._source.loopEnd=this.toSeconds(e)}},{key:"buffer",get:function(){return this._buffer},set:function(e){this._buffer.set(e)}},{key:"loop",get:function(){return this._source.loop},set:function(e){this._source.loop=e,this._sourceStarted&&this.cancelStop()}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(y9.getDefaults(),{url:new B7,loop:!1,loopEnd:0,loopStart:0,onload:z7,onerror:z7,playbackRate:1})}}]),n}(y9),j9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["type"]))).name="Noise",e._source=null;var r=m7(n.getDefaults(),arguments,["type"]);return e._playbackRate=r.playbackRate,e.type=r.type,e._fadeIn=r.fadeIn,e._fadeOut=r.fadeOut,e}return Jn(n,[{key:"type",get:function(){return this._type},set:function(e){if(U8(e in X9,"Noise: invalid type: "+e),this._type!==e&&(this._type=e,"started"===this.state)){var t=this.now();this._stop(t),this._start(t)}}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this._source&&(this._source.playbackRate.value=e)}},{key:"_start",value:function(e){var t=this,n=X9[this._type];this._source=new G9({url:n,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:function(){return t.onstop(t)},playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(e),Math.random()*(n.duration-.001))}},{key:"_stop",value:function(e){this._source&&(this._source.stop(this.toSeconds(e)),this._source=null)}},{key:"fadeIn",get:function(){return this._fadeIn},set:function(e){this._fadeIn=e,this._source&&(this._source.fadeIn=this._fadeIn)}},{key:"fadeOut",get:function(){return this._fadeOut},set:function(e){this._fadeOut=e,this._source&&(this._source.fadeOut=this._fadeOut)}},{key:"_restart",value:function(e){this._stop(e),this._start(e)}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._source&&this._source.disconnect(),this}}],[{key:"getDefaults",value:function(){return Object.assign(W9.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}}]),n}(W9),q9=220500,H9={brown:null,pink:null,white:null},X9={get brown(){if(!H9.brown){for(var e=[],t=0;t<2;t++){var n=new Float32Array(q9);e[t]=n;for(var r=0,a=0;a<q9;a++){var i=2*Math.random()-1;n[a]=(r+.02*i)/1.02,r=n[a],n[a]*=3.5}}H9.brown=(new B7).fromArray(e)}return H9.brown},get pink(){if(!H9.pink){for(var e=[],t=0;t<2;t++){var n=new Float32Array(q9);e[t]=n;var r=void 0,a=void 0,i=void 0,o=void 0,s=void 0,u=void 0,c=void 0;r=a=i=o=s=u=c=0;for(var l=0;l<q9;l++){var h=2*Math.random()-1;r=.99886*r+.0555179*h,a=.99332*a+.0750759*h,i=.969*i+.153852*h,o=.8665*o+.3104856*h,s=.55*s+.5329522*h,u=-.7616*u-.016898*h,n[l]=r+a+i+o+s+u+c+.5362*h,n[l]*=.11,c=.115926*h}}H9.pink=(new B7).fromArray(e)}return H9.pink},get white(){if(!H9.white){for(var e=[],t=0;t<2;t++){var n=new Float32Array(q9);e[t]=n;for(var r=0;r<q9;r++)n[r]=2*Math.random()-1}H9.white=(new B7).fromArray(e)}return H9.white}},K9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["volume"]))).name="UserMedia";var r=m7(n.getDefaults(),arguments,["volume"]);return e._volume=e.output=new L9({context:e.context,volume:r.volume}),e.volume=e._volume.volume,L7(ir(e),"volume"),e.mute=r.mute,e}return Jn(n,[{key:"open",value:function(e){return s7(this,void 0,void 0,es().mark((function t(){var r,a,i,o;return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return U8(n.supported,"UserMedia is not supported"),"started"===this.state&&this.close(),t.next=4,n.enumerateDevices();case 4:return r=t.sent,Q8(e)?this._device=r[e]:(this._device=r.find((function(t){return t.label===e||t.deviceId===e})),!this._device&&r.length>0&&(this._device=r[0]),U8(K8(this._device),"No matching device ".concat(e))),a={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}},this._device&&(a.audio.deviceId=this._device.deviceId),t.next=10,navigator.mediaDevices.getUserMedia(a);case 10:return i=t.sent,this._stream||(this._stream=i,v9(o=this.context.createMediaStreamSource(i),this.output),this._mediaStream=o),t.abrupt("return",this);case 13:case"end":return t.stop()}}),t,this)})))}},{key:"close",value:function(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach((function(e){e.stop()})),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}},{key:"state",get:function(){return this._stream&&this._stream.active?"started":"stopped"}},{key:"deviceId",get:function(){return this._device?this._device.deviceId:void 0}},{key:"groupId",get:function(){return this._device?this._device.groupId:void 0}},{key:"label",get:function(){return this._device?this._device.label:void 0}},{key:"mute",get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.close(),this._volume.dispose(),this.volume.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{mute:!1,volume:0})}},{key:"enumerateDevices",value:function(){return s7(this,void 0,void 0,es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,navigator.mediaDevices.enumerateDevices();case 2:return t=e.sent,e.abrupt("return",t.filter((function(e){return"audioinput"===e.kind})));case 4:case"end":return e.stop()}}),e)})))}},{key:"supported",get:function(){return K8(navigator.mediaDevices)&&K8(navigator.mediaDevices.getUserMedia)}}]),n}(d9);function Y9(e,t){return s7(this,void 0,void 0,es().mark((function n(){var r,a,i;return es().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return r=t/e.context.sampleRate,a=new U7(1,r,e.context.sampleRate),new e.constructor(Object.assign(e.get(),{frequency:2/r,detune:0,context:a})).toDestination().start(0),n.next=6,a.render();case 6:return i=n.sent,n.abrupt("return",i.getChannelData(0));case 8:case"end":return n.stop()}}),n)})))}var Q9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","type"]))).name="ToneOscillatorNode",e._oscillator=e.context.createOscillator(),e._internalChannels=[e._oscillator];var r=m7(n.getDefaults(),arguments,["frequency","type"]);return v9(e._oscillator,e._gainNode),e.type=r.type,e.frequency=new f9({context:e.context,param:e._oscillator.frequency,units:"frequency",value:r.frequency}),e.detune=new f9({context:e.context,param:e._oscillator.detune,units:"cents",value:r.detune}),L7(ir(e),["frequency","detune"]),e}return Jn(n,[{key:"start",value:function(e){var t=this.toSeconds(e);return this.log("start",t),this._startGain(t),this._oscillator.start(t),this}},{key:"_stopSource",value:function(e){this._oscillator.stop(e)}},{key:"setPeriodicWave",value:function(e){return this._oscillator.setPeriodicWave(e),this}},{key:"type",get:function(){return this._oscillator.type},set:function(e){this._oscillator.type=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(y9.getDefaults(),{detune:0,frequency:440,type:"sine"})}}]),n}(y9),Z9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","type"]))).name="Oscillator",e._oscillator=null;var r=m7(n.getDefaults(),arguments,["frequency","type"]);return e.frequency=new x9({context:e.context,units:"frequency",value:r.frequency}),L7(ir(e),"frequency"),e.detune=new x9({context:e.context,units:"cents",value:r.detune}),L7(ir(e),"detune"),e._partials=r.partials,e._partialCount=r.partialCount,e._type=r.type,r.partialCount&&"custom"!==r.type&&(e._type=e.baseType+r.partialCount.toString()),e.phase=r.phase,e}return Jn(n,[{key:"_start",value:function(e){var t=this,n=this.toSeconds(e),r=new Q9({context:this.context,onended:function(){return t.onstop(t)}});this._oscillator=r,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(n)}},{key:"_stop",value:function(e){var t=this.toSeconds(e);this._oscillator&&this._oscillator.stop(t)}},{key:"_restart",value:function(e){var t=this.toSeconds(e);return this.log("restart",t),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(t),this}},{key:"syncFrequency",value:function(){return this.context.transport.syncSignal(this.frequency),this}},{key:"unsyncFrequency",value:function(){return this.context.transport.unsyncSignal(this.frequency),this}},{key:"_getCachedPeriodicWave",value:function(){var e=this;if("custom"===this._type)return n._periodicWaveCache.find((function(t){return t.phase===e._phase&&(n=t.partials,r=e._partials,n.length===r.length&&n.every((function(e,t){return r[t]===e})));var n,r}));var t=n._periodicWaveCache.find((function(t){return t.type===e._type&&t.phase===e._phase}));return this._partialCount=t?t.partialCount:this._partialCount,t}},{key:"type",get:function(){return this._type},set:function(e){this._type=e;var t=-1!==["sine","square","sawtooth","triangle"].indexOf(e);if(0===this._phase&&t)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=e);else{var r=this._getCachedPeriodicWave();if(K8(r)){var a=r.partials,i=r.wave;this._wave=i,this._partials=a,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{var o=f(this._getRealImaginary(e,this._phase),2),s=o[0],u=o[1],c=this.context.createPeriodicWave(s,u);this._wave=c,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),n._periodicWaveCache.push({imag:u,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:s,type:this._type,wave:this._wave}),n._periodicWaveCache.length>100&&n._periodicWaveCache.shift()}}}},{key:"baseType",get:function(){return this._type.replace(this.partialCount.toString(),"")},set:function(e){this.partialCount&&"custom"!==this._type&&"custom"!==e?this.type=e+this.partialCount:this.type=e}},{key:"partialCount",get:function(){return this._partialCount},set:function(e){V8(e,0);var t=this._type,n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(t=n[1]),"custom"!==this._type)this.type=0===e?t:t+e.toString();else{var r=new Float32Array(e);this._partials.forEach((function(e,t){return r[t]=e})),this._partials=Array.from(r),this.type=this._type}}},{key:"_getRealImaginary",value:function(e,t){var n=2048,r=new Float32Array(n),a=new Float32Array(n),i=1;if("custom"===e){if(i=this._partials.length+1,this._partialCount=this._partials.length,n=i,0===this._partials.length)return[r,a]}else{var o=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(e);o?(i=parseInt(o[2],10)+1,this._partialCount=parseInt(o[2],10),e=o[1],n=i=Math.max(i,2)):this._partialCount=0,this._partials=[]}for(var s=1;s<n;++s){var u=2/(s*Math.PI),c=void 0;switch(e){case"sine":c=s<=i?1:0,this._partials[s-1]=c;break;case"square":c=1&s?2*u:0,this._partials[s-1]=c;break;case"sawtooth":c=u*(1&s?1:-1),this._partials[s-1]=c;break;case"triangle":c=1&s?u*u*2*(s-1>>1&1?-1:1):0,this._partials[s-1]=c;break;case"custom":c=this._partials[s-1];break;default:throw new TypeError("Oscillator: invalid type: "+e)}0!==c?(r[s]=-c*Math.sin(t*s),a[s]=c*Math.cos(t*s)):(r[s]=0,a[s]=0)}return[r,a]}},{key:"_inverseFFT",value:function(e,t,n){for(var r=0,a=e.length,i=0;i<a;i++)r+=e[i]*Math.cos(i*n)+t[i]*Math.sin(i*n);return r}},{key:"getInitialValue",value:function(){for(var e=f(this._getRealImaginary(this._type,0),2),t=e[0],n=e[1],r=0,a=2*Math.PI,i=0;i<32;i++)r=Math.max(this._inverseFFT(t,n,i/32*a),r);return C7(-this._inverseFFT(t,n,this._phase)/r,-1,1)}},{key:"partials",get:function(){return this._partials.slice(0,this.partialCount)},set:function(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this.type="custom")}},{key:"phase",get:function(){return this._phase*(180/Math.PI)},set:function(e){this._phase=e*Math.PI/180,this.type=this._type}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return s7(this,void 0,void 0,es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Y9(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(W9.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}}]),n}(W9);Z9._periodicWaveCache=[];var J9=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.call(this,Object.assign(m7(n.getDefaults(),arguments,["context"])))}return Jn(n,[{key:"connect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return k9(this,e,t,n),this}}]),n}(d9),$9=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments,["mapping","length"])))).name="WaveShaper",e._shaper=e.context.createWaveShaper(),e.input=e._shaper,e.output=e._shaper;var r=m7(n.getDefaults(),arguments,["mapping","length"]);return $8(r.mapping)||r.mapping instanceof Float32Array?e.curve=Float32Array.from(r.mapping):Y8(r.mapping)&&e.setMap(r.mapping,r.length),e}return Jn(n,[{key:"setMap",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024,n=new Float32Array(t),r=0,a=t;r<a;r++){var i=r/(a-1)*2-1;n[r]=e(i,r)}return this.curve=n,this}},{key:"curve",get:function(){return this._shaper.curve},set:function(e){this._shaper.curve=e}},{key:"oversample",get:function(){return this._shaper.oversample},set:function(e){U8(["none","2x","4x"].some((function(t){return t.includes(e)})),"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._shaper.disconnect(),this}}],[{key:"getDefaults",value:function(){return Object.assign(x9.getDefaults(),{length:1024})}}]),n}(J9),eee=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).name="AudioToGain",e._norm=new $9({context:e.context,mapping:function(e){return(e+1)/2}}),e.input=e._norm,e.output=e._norm,e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._norm.dispose(),this}}]),n}(J9),tee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments,["value"])))).name="Multiply",e.override=!1;var r=m7(n.getDefaults(),arguments,["value"]);return e._mult=e.input=e.output=new g9({context:e.context,minValue:r.minValue,maxValue:r.maxValue}),e.factor=e._param=e._mult.gain,e.factor.setValueAtTime(r.value,0),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._mult.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(x9.getDefaults(),{value:0})}}]),n}(x9),nee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","type","modulationType"]))).name="AMOscillator",e._modulationScale=new eee({context:e.context}),e._modulationNode=new g9({context:e.context});var r=m7(n.getDefaults(),arguments,["frequency","type","modulationType"]);return e._carrier=new Z9({context:e.context,detune:r.detune,frequency:r.frequency,onstop:function(){return e.onstop(ir(e))},phase:r.phase,type:r.type}),e.frequency=e._carrier.frequency,e.detune=e._carrier.detune,e._modulator=new Z9({context:e.context,phase:r.phase,type:r.modulationType}),e.harmonicity=new tee({context:e.context,units:"positive",value:r.harmonicity}),e.frequency.chain(e.harmonicity,e._modulator.frequency),e._modulator.chain(e._modulationScale,e._modulationNode.gain),e._carrier.chain(e._modulationNode,e.output),L7(ir(e),["frequency","detune","harmonicity"]),e}return Jn(n,[{key:"_start",value:function(e){this._modulator.start(e),this._carrier.start(e)}},{key:"_stop",value:function(e){this._modulator.stop(e),this._carrier.stop(e)}},{key:"_restart",value:function(e){this._modulator.restart(e),this._carrier.restart(e)}},{key:"type",get:function(){return this._carrier.type},set:function(e){this._carrier.type=e}},{key:"baseType",get:function(){return this._carrier.baseType},set:function(e){this._carrier.baseType=e}},{key:"partialCount",get:function(){return this._carrier.partialCount},set:function(e){this._carrier.partialCount=e}},{key:"modulationType",get:function(){return this._modulator.type},set:function(e){this._modulator.type=e}},{key:"phase",get:function(){return this._carrier.phase},set:function(e){this._carrier.phase=e,this._modulator.phase=e}},{key:"partials",get:function(){return this._carrier.partials},set:function(e){this._carrier.partials=e}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return s7(this,void 0,void 0,es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Y9(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Z9.getDefaults(),{harmonicity:1,modulationType:"square"})}}]),n}(W9),ree=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","type","modulationType"]))).name="FMOscillator",e._modulationNode=new g9({context:e.context,gain:0});var r=m7(n.getDefaults(),arguments,["frequency","type","modulationType"]);return e._carrier=new Z9({context:e.context,detune:r.detune,frequency:0,onstop:function(){return e.onstop(ir(e))},phase:r.phase,type:r.type}),e.detune=e._carrier.detune,e.frequency=new x9({context:e.context,units:"frequency",value:r.frequency}),e._modulator=new Z9({context:e.context,phase:r.phase,type:r.modulationType}),e.harmonicity=new tee({context:e.context,units:"positive",value:r.harmonicity}),e.modulationIndex=new tee({context:e.context,units:"positive",value:r.modulationIndex}),e.frequency.connect(e._carrier.frequency),e.frequency.chain(e.harmonicity,e._modulator.frequency),e.frequency.chain(e.modulationIndex,e._modulationNode),e._modulator.connect(e._modulationNode.gain),e._modulationNode.connect(e._carrier.frequency),e._carrier.connect(e.output),e.detune.connect(e._modulator.detune),L7(ir(e),["modulationIndex","frequency","detune","harmonicity"]),e}return Jn(n,[{key:"_start",value:function(e){this._modulator.start(e),this._carrier.start(e)}},{key:"_stop",value:function(e){this._modulator.stop(e),this._carrier.stop(e)}},{key:"_restart",value:function(e){return this._modulator.restart(e),this._carrier.restart(e),this}},{key:"type",get:function(){return this._carrier.type},set:function(e){this._carrier.type=e}},{key:"baseType",get:function(){return this._carrier.baseType},set:function(e){this._carrier.baseType=e}},{key:"partialCount",get:function(){return this._carrier.partialCount},set:function(e){this._carrier.partialCount=e}},{key:"modulationType",get:function(){return this._modulator.type},set:function(e){this._modulator.type=e}},{key:"phase",get:function(){return this._carrier.phase},set:function(e){this._carrier.phase=e,this._modulator.phase=e}},{key:"partials",get:function(){return this._carrier.partials},set:function(e){this._carrier.partials=e}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return s7(this,void 0,void 0,es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Y9(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Z9.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}}]),n}(W9),aee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","width"]))).name="PulseOscillator",e._widthGate=new g9({context:e.context,gain:0}),e._thresh=new $9({context:e.context,mapping:function(e){return e<=0?-1:1}});var r=m7(n.getDefaults(),arguments,["frequency","width"]);return e.width=new x9({context:e.context,units:"audioRange",value:r.width}),e._triangle=new Z9({context:e.context,detune:r.detune,frequency:r.frequency,onstop:function(){return e.onstop(ir(e))},phase:r.phase,type:"triangle"}),e.frequency=e._triangle.frequency,e.detune=e._triangle.detune,e._triangle.chain(e._thresh,e.output),e.width.chain(e._widthGate,e._thresh),L7(ir(e),["width","frequency","detune"]),e}return Jn(n,[{key:"_start",value:function(e){e=this.toSeconds(e),this._triangle.start(e),this._widthGate.gain.setValueAtTime(1,e)}},{key:"_stop",value:function(e){e=this.toSeconds(e),this._triangle.stop(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(0,e)}},{key:"_restart",value:function(e){this._triangle.restart(e),this._widthGate.gain.cancelScheduledValues(e),this._widthGate.gain.setValueAtTime(1,e)}},{key:"phase",get:function(){return this._triangle.phase},set:function(e){this._triangle.phase=e}},{key:"type",get:function(){return"pulse"}},{key:"baseType",get:function(){return"pulse"}},{key:"partials",get:function(){return[]}},{key:"partialCount",get:function(){return 0}},{key:"carrierType",set:function(e){this._triangle.type=e}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return s7(this,void 0,void 0,es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Y9(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(W9.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}}]),n}(W9),iee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","type","spread"]))).name="FatOscillator",e._oscillators=[];var r=m7(n.getDefaults(),arguments,["frequency","type","spread"]);return e.frequency=new x9({context:e.context,units:"frequency",value:r.frequency}),e.detune=new x9({context:e.context,units:"cents",value:r.detune}),e._spread=r.spread,e._type=r.type,e._phase=r.phase,e._partials=r.partials,e._partialCount=r.partialCount,e.count=r.count,L7(ir(e),["frequency","detune"]),e}return Jn(n,[{key:"_start",value:function(e){e=this.toSeconds(e),this._forEach((function(t){return t.start(e)}))}},{key:"_stop",value:function(e){e=this.toSeconds(e),this._forEach((function(t){return t.stop(e)}))}},{key:"_restart",value:function(e){this._forEach((function(t){return t.restart(e)}))}},{key:"_forEach",value:function(e){for(var t=0;t<this._oscillators.length;t++)e(this._oscillators[t],t)}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._forEach((function(t){return t.type=e}))}},{key:"spread",get:function(){return this._spread},set:function(e){if(this._spread=e,this._oscillators.length>1){var t=-e/2,n=e/(this._oscillators.length-1);this._forEach((function(e,r){return e.detune.value=t+n*r}))}}},{key:"count",get:function(){return this._oscillators.length},set:function(e){var t=this;if(V8(e,1),this._oscillators.length!==e){this._forEach((function(e){return e.dispose()})),this._oscillators=[];for(var n=0;n<e;n++){var r=new Z9({context:this.context,volume:-6-1.1*e,type:this._type,phase:this._phase+n/e*360,partialCount:this._partialCount,onstop:0===n?function(){return t.onstop(t)}:z7});"custom"===this.type&&(r.partials=this._partials),this.frequency.connect(r.frequency),this.detune.connect(r.detune),r.detune.overridden=!1,r.connect(this.output),this._oscillators[n]=r}this.spread=this._spread,"started"===this.state&&this._forEach((function(e){return e.start()}))}}},{key:"phase",get:function(){return this._phase},set:function(e){var t=this;this._phase=e,this._forEach((function(e,n){return e.phase=t._phase+n/t.count*360}))}},{key:"baseType",get:function(){return this._oscillators[0].baseType},set:function(e){this._forEach((function(t){return t.baseType=e})),this._type=this._oscillators[0].type}},{key:"partials",get:function(){return this._oscillators[0].partials},set:function(e){this._partials=e,this._partialCount=this._partials.length,e.length&&(this._type="custom",this._forEach((function(t){return t.partials=e})))}},{key:"partialCount",get:function(){return this._oscillators[0].partialCount},set:function(e){this._partialCount=e,this._forEach((function(t){return t.partialCount=e})),this._type=this._oscillators[0].type}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return s7(this,void 0,void 0,es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Y9(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.frequency.dispose(),this.detune.dispose(),this._forEach((function(e){return e.dispose()})),this}}],[{key:"getDefaults",value:function(){return Object.assign(Z9.getDefaults(),{count:3,spread:20,type:"sawtooth"})}}]),n}(W9),oee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","modulationFrequency"]))).name="PWMOscillator",e.sourceType="pwm",e._scale=new tee({context:e.context,value:2});var r=m7(n.getDefaults(),arguments,["frequency","modulationFrequency"]);return e._pulse=new aee({context:e.context,frequency:r.modulationFrequency}),e._pulse.carrierType="sine",e.modulationFrequency=e._pulse.frequency,e._modulator=new Z9({context:e.context,detune:r.detune,frequency:r.frequency,onstop:function(){return e.onstop(ir(e))},phase:r.phase}),e.frequency=e._modulator.frequency,e.detune=e._modulator.detune,e._modulator.chain(e._scale,e._pulse.width),e._pulse.connect(e.output),L7(ir(e),["modulationFrequency","frequency","detune"]),e}return Jn(n,[{key:"_start",value:function(e){e=this.toSeconds(e),this._modulator.start(e),this._pulse.start(e)}},{key:"_stop",value:function(e){e=this.toSeconds(e),this._modulator.stop(e),this._pulse.stop(e)}},{key:"_restart",value:function(e){this._modulator.restart(e),this._pulse.restart(e)}},{key:"type",get:function(){return"pwm"}},{key:"baseType",get:function(){return"pwm"}},{key:"partials",get:function(){return[]}},{key:"partialCount",get:function(){return 0}},{key:"phase",get:function(){return this._modulator.phase},set:function(e){this._modulator.phase=e}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return s7(this,void 0,void 0,es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Y9(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(W9.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}}]),n}(W9),see={am:nee,fat:iee,fm:ree,oscillator:Z9,pulse:aee,pwm:oee},uee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","type"]))).name="OmniOscillator";var r=m7(n.getDefaults(),arguments,["frequency","type"]);return e.frequency=new x9({context:e.context,units:"frequency",value:r.frequency}),e.detune=new x9({context:e.context,units:"cents",value:r.detune}),L7(ir(e),["frequency","detune"]),e.set(r),e}return Jn(n,[{key:"_start",value:function(e){this._oscillator.start(e)}},{key:"_stop",value:function(e){this._oscillator.stop(e)}},{key:"_restart",value:function(e){return this._oscillator.restart(e),this}},{key:"type",get:function(){var e=this,t="";return["am","fm","fat"].some((function(t){return e._sourceType===t}))&&(t=this._sourceType),t+this._oscillator.type},set:function(e){"fm"===e.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):"am"===e.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(2)):"fat"===e.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=e.substr(3)):"pwm"===e?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===e?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=e)}},{key:"partials",get:function(){return this._oscillator.partials},set:function(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=e)}},{key:"partialCount",get:function(){return this._oscillator.partialCount},set:function(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=e)}},{key:"set",value:function(e){return Reflect.has(e,"type")&&e.type&&(this.type=e.type),ja(nr(n.prototype),"set",this).call(this,e),this}},{key:"_createNewOscillator",value:function(e){var t=this;if(e!==this._sourceType){this._sourceType=e;var n=see[e],r=this.now();if(this._oscillator){var a=this._oscillator;a.stop(r),this.context.setTimeout((function(){return a.dispose()}),this.blockTime)}this._oscillator=new n({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=function(){return t.onstop(t)},"started"===this.state&&this._oscillator.start(r)}}},{key:"phase",get:function(){return this._oscillator.phase},set:function(e){this._oscillator.phase=e}},{key:"sourceType",get:function(){return this._sourceType},set:function(e){var t="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(t=this._oscillator.type),"fm"===e?this.type="fm"+t:"am"===e?this.type="am"+t:"fat"===e?this.type="fat"+t:"oscillator"===e?this.type=t:"pulse"===e?this.type="pulse":"pwm"===e&&(this.type="pwm")}},{key:"_getOscType",value:function(e,t){return e instanceof see[t]}},{key:"baseType",get:function(){return this._oscillator.baseType},set:function(e){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===e||"pwm"===e||(this._oscillator.baseType=e)}},{key:"width",get:function(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}},{key:"count",get:function(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0},set:function(e){this._getOscType(this._oscillator,"fat")&&Q8(e)&&(this._oscillator.count=e)}},{key:"spread",get:function(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0},set:function(e){this._getOscType(this._oscillator,"fat")&&Q8(e)&&(this._oscillator.spread=e)}},{key:"modulationType",get:function(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0},set:function(e){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&e7(e)&&(this._oscillator.modulationType=e)}},{key:"modulationIndex",get:function(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}},{key:"harmonicity",get:function(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}},{key:"modulationFrequency",get:function(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return s7(this,void 0,void 0,es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",Y9(this,e));case 1:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Z9.getDefaults(),ree.getDefaults(),nee.getDefaults(),iee.getDefaults(),aee.getDefaults(),oee.getDefaults())}}]),n}(W9),cee=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments,["value"])))).override=!1,e.name="Add",e._sum=new g9({context:e.context}),e.input=e._sum,e.output=e._sum,e.addend=e._param,p9(e._constantSource,e._sum),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._sum.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(x9.getDefaults(),{value:0})}}]),n}(x9),lee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments,["min","max"])))).name="Scale";var r=m7(n.getDefaults(),arguments,["min","max"]);return e._mult=e.input=new tee({context:e.context,value:r.max-r.min}),e._add=e.output=new cee({context:e.context,value:r.min}),e._min=r.min,e._max=r.max,e.input.connect(e.output),e}return Jn(n,[{key:"min",get:function(){return this._min},set:function(e){this._min=e,this._setRange()}},{key:"max",get:function(){return this._max},set:function(e){this._max=e,this._setRange()}},{key:"_setRange",value:function(){this._add.value=this._min,this._mult.value=this._max-this._min}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._add.dispose(),this._mult.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(J9.getDefaults(),{max:1,min:0})}}]),n}(J9),hee=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments)))).name="Zero",e._gain=new g9({context:e.context}),e.output=e._gain,e.input=void 0,v9(e.context.getConstant(0),e._gain),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),m9(this.context.getConstant(0),this._gain),this}}]),n}(J9),fee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","min","max"]))).name="LFO",e._stoppedValue=0,e._units="number",e.convert=!0,e._fromType=f9.prototype._fromType,e._toType=f9.prototype._toType,e._is=f9.prototype._is,e._clampValue=f9.prototype._clampValue;var r=m7(n.getDefaults(),arguments,["frequency","min","max"]);return e._oscillator=new Z9(r),e.frequency=e._oscillator.frequency,e._amplitudeGain=new g9({context:e.context,gain:r.amplitude,units:"normalRange"}),e.amplitude=e._amplitudeGain.gain,e._stoppedSignal=new x9({context:e.context,units:"audioRange",value:0}),e._zeros=new hee({context:e.context}),e._a2g=new eee({context:e.context}),e._scaler=e.output=new lee({context:e.context,max:r.max,min:r.min}),e.units=r.units,e.min=r.min,e.max=r.max,e._oscillator.chain(e._amplitudeGain,e._a2g,e._scaler),e._zeros.connect(e._a2g),e._stoppedSignal.connect(e._a2g),L7(ir(e),["amplitude","frequency"]),e.phase=r.phase,e}return Jn(n,[{key:"start",value:function(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(0,e),this._oscillator.start(e),this}},{key:"stop",value:function(e){return e=this.toSeconds(e),this._stoppedSignal.setValueAtTime(this._stoppedValue,e),this._oscillator.stop(e),this}},{key:"sync",value:function(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}},{key:"unsync",value:function(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}},{key:"_setStoppedValue",value:function(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}},{key:"min",get:function(){return this._toType(this._scaler.min)},set:function(e){e=this._fromType(e),this._scaler.min=e}},{key:"max",get:function(){return this._toType(this._scaler.max)},set:function(e){e=this._fromType(e),this._scaler.max=e}},{key:"type",get:function(){return this._oscillator.type},set:function(e){this._oscillator.type=e,this._setStoppedValue()}},{key:"partials",get:function(){return this._oscillator.partials},set:function(e){this._oscillator.partials=e,this._setStoppedValue()}},{key:"phase",get:function(){return this._oscillator.phase},set:function(e){this._oscillator.phase=e,this._setStoppedValue()}},{key:"units",get:function(){return this._units},set:function(e){var t=this.min,n=this.max;this._units=e,this.min=t,this.max=n}},{key:"state",get:function(){return this._oscillator.state}},{key:"connect",value:function(e,t,n){return(e instanceof f9||e instanceof x9)&&(this.convert=e.convert,this.units=e.units),k9(this,e,t,n),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Z9.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}}]),n}(d9);function dee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=new WeakMap;return function(r,a){Reflect.defineProperty(r,a,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(r){V8(r,e,t),n.set(this,r)}})}}function pee(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=new WeakMap;return function(r,a){Reflect.defineProperty(r,a,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(r){V8(this.toSeconds(r),e,t),n.set(this,r)}})}}var vee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["url","onload"]))).name="Player",e._activeSources=new Set;var r=m7(n.getDefaults(),arguments,["url","onload"]);return e._buffer=new B7({onload:e._onload.bind(ir(e),r.onload),onerror:r.onerror,reverse:r.reverse,url:r.url}),e.autostart=r.autostart,e._loop=r.loop,e._loopStart=r.loopStart,e._loopEnd=r.loopEnd,e._playbackRate=r.playbackRate,e.fadeIn=r.fadeIn,e.fadeOut=r.fadeOut,e}return Jn(n,[{key:"load",value:function(e){return s7(this,void 0,void 0,es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._buffer.load(e);case 2:return this._onload(),t.abrupt("return",this);case 4:case"end":return t.stop()}}),t,this)})))}},{key:"_onload",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:z7;e(),this.autostart&&this.start()}},{key:"_onSourceEnd",value:function(e){this.onstop(this),this._activeSources.delete(e),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}},{key:"start",value:function(e,t,r){return ja(nr(n.prototype),"start",this).call(this,e,t,r),this}},{key:"_start",value:function(e,t,n){t=this._loop?g7(t,this._loopStart):g7(t,0);var r=this.toSeconds(t),a=n;n=g7(n,Math.max(this._buffer.duration-r,0));var i=this.toSeconds(n);i/=this._playbackRate,e=this.toSeconds(e);var o=new G9({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(e+i),this._state.setStateAtTime("stopped",e+i,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&X8(a)?o.start(e,r):o.start(e,r,i-this.toSeconds(this.fadeOut))}},{key:"_stop",value:function(e){var t=this.toSeconds(e);this._activeSources.forEach((function(e){return e.stop(t)}))}},{key:"restart",value:function(e,t,r){return ja(nr(n.prototype),"restart",this).call(this,e,t,r),this}},{key:"_restart",value:function(e,t,n){this._stop(e),this._start(e,t,n)}},{key:"seek",value:function(e,t){var n=this.toSeconds(t);if("started"===this._state.getValueAtTime(n)){var r=this.toSeconds(e);this._stop(n),this._start(n,r)}return this}},{key:"setLoopPoints",value:function(e,t){return this.loopStart=e,this.loopEnd=t,this}},{key:"loopStart",get:function(){return this._loopStart},set:function(e){this._loopStart=e,this.buffer.loaded&&V8(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach((function(t){t.loopStart=e}))}},{key:"loopEnd",get:function(){return this._loopEnd},set:function(e){this._loopEnd=e,this.buffer.loaded&&V8(this.toSeconds(e),0,this.buffer.duration),this._activeSources.forEach((function(t){t.loopEnd=e}))}},{key:"buffer",get:function(){return this._buffer},set:function(e){this._buffer.set(e)}},{key:"loop",get:function(){return this._loop},set:function(e){if(this._loop!==e&&(this._loop=e,this._activeSources.forEach((function(t){t.loop=e})),e)){var t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(e){this._playbackRate=e;var t=this.now(),n=this._state.getNextState("stopped",t);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach((function(e){return e.cancelStop()}))),this._activeSources.forEach((function(n){n.playbackRate.setValueAtTime(e,t)}))}},{key:"reverse",get:function(){return this._buffer.reverse},set:function(e){this._buffer.reverse=e}},{key:"loaded",get:function(){return this._buffer.loaded}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._activeSources.forEach((function(e){return e.dispose()})),this._activeSources.clear(),this._buffer.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(W9.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:z7,onerror:z7,playbackRate:1,reverse:!1})}}]),n}(W9);o7([pee(0)],vee.prototype,"fadeIn",void 0),o7([pee(0)],vee.prototype,"fadeOut",void 0);var mee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["urls","onload"],"urls"))).name="Players",e.input=void 0,e._players=new Map;var r=m7(n.getDefaults(),arguments,["urls","onload"],"urls");return e._volume=e.output=new L9({context:e.context,volume:r.volume}),e.volume=e._volume.volume,L7(ir(e),"volume"),e._buffers=new I9({urls:r.urls,onload:r.onload,baseUrl:r.baseUrl,onerror:r.onerror}),e.mute=r.mute,e._fadeIn=r.fadeIn,e._fadeOut=r.fadeOut,e}return Jn(n,[{key:"mute",get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}},{key:"fadeIn",get:function(){return this._fadeIn},set:function(e){this._fadeIn=e,this._players.forEach((function(t){t.fadeIn=e}))}},{key:"fadeOut",get:function(){return this._fadeOut},set:function(e){this._fadeOut=e,this._players.forEach((function(t){t.fadeOut=e}))}},{key:"state",get:function(){return Array.from(this._players).some((function(e){var t=f(e,2);t[0];return"started"===t[1].state}))?"started":"stopped"}},{key:"has",value:function(e){return this._buffers.has(e)}},{key:"player",value:function(e){if(U8(this.has(e),"No Player with the name ".concat(e," exists on this object")),!this._players.has(e)){var t=new vee({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(e)}).connect(this.output);this._players.set(e,t)}return this._players.get(e)}},{key:"loaded",get:function(){return this._buffers.loaded}},{key:"add",value:function(e,t,n){return U8(!this._buffers.has(e),"A buffer with that name already exists on this object"),this._buffers.add(e,t,n),this}},{key:"stopAll",value:function(e){return this._players.forEach((function(t){return t.stop(e)})),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._volume.dispose(),this.volume.dispose(),this._players.forEach((function(e){return e.dispose()})),this._buffers.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(W9.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:z7,onerror:z7,urls:{},volume:0})}}]),n}(d9),gee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["url","onload"]))).name="GrainPlayer",e._loopStart=0,e._loopEnd=0,e._activeSources=[];var r=m7(n.getDefaults(),arguments,["url","onload"]);return e.buffer=new B7({onload:r.onload,onerror:r.onerror,reverse:r.reverse,url:r.url}),e._clock=new C9({context:e.context,callback:e._tick.bind(ir(e)),frequency:1/r.grainSize}),e._playbackRate=r.playbackRate,e._grainSize=r.grainSize,e._overlap=r.overlap,e.detune=r.detune,e.overlap=r.overlap,e.loop=r.loop,e.playbackRate=r.playbackRate,e.grainSize=r.grainSize,e.loopStart=r.loopStart,e.loopEnd=r.loopEnd,e.reverse=r.reverse,e._clock.on("stop",e._onstop.bind(ir(e))),e}return Jn(n,[{key:"_start",value:function(e,t,n){t=g7(t,0),t=this.toSeconds(t),e=this.toSeconds(e);var r=1/this._clock.frequency.getValueAtTime(e);this._clock.start(e,t/r),n&&this.stop(e+this.toSeconds(n))}},{key:"restart",value:function(e,t,r){return ja(nr(n.prototype),"restart",this).call(this,e,t,r),this}},{key:"_restart",value:function(e,t,n){this._stop(e),this._start(e,t,n)}},{key:"_stop",value:function(e){this._clock.stop(e)}},{key:"_onstop",value:function(e){this._activeSources.forEach((function(t){t.fadeOut=0,t.stop(e)})),this.onstop(this)}},{key:"_tick",value:function(e){var t=this,n=this._clock.getTicksAtTime(e),r=n*this._grainSize;if(this.log("offset",r),!this.loop&&r>this.buffer.duration)this.stop(e);else{var a=r<this._overlap?0:this._overlap,i=new G9({context:this.context,url:this.buffer,fadeIn:a,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:Q7(this.detune/100)}).connect(this.output);i.start(e,this._grainSize*n),i.stop(e+this._grainSize/this.playbackRate),this._activeSources.push(i),i.onended=function(){var e=t._activeSources.indexOf(i);-1!==e&&t._activeSources.splice(e,1)}}}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(e){V8(e,.001),this._playbackRate=e,this.grainSize=this._grainSize}},{key:"loopStart",get:function(){return this._loopStart},set:function(e){this.buffer.loaded&&V8(this.toSeconds(e),0,this.buffer.duration),this._loopStart=this.toSeconds(e)}},{key:"loopEnd",get:function(){return this._loopEnd},set:function(e){this.buffer.loaded&&V8(this.toSeconds(e),0,this.buffer.duration),this._loopEnd=this.toSeconds(e)}},{key:"reverse",get:function(){return this.buffer.reverse},set:function(e){this.buffer.reverse=e}},{key:"grainSize",get:function(){return this._grainSize},set:function(e){this._grainSize=this.toSeconds(e),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}},{key:"overlap",get:function(){return this._overlap},set:function(e){var t=this.toSeconds(e);V8(t,0),this._overlap=t}},{key:"loaded",get:function(){return this.buffer.loaded}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach((function(e){return e.dispose()})),this}}],[{key:"getDefaults",value:function(){return Object.assign(W9.getDefaults(),{onload:z7,onerror:z7,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}}]),n}(W9),yee=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).name="Abs",e._abs=new $9({context:e.context,mapping:function(e){return Math.abs(e)<.001?0:Math.abs(e)}}),e.input=e._abs,e.output=e._abs,e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._abs.dispose(),this}}]),n}(J9),bee=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).name="GainToAudio",e._norm=new $9({context:e.context,mapping:function(e){return 2*Math.abs(e)-1}}),e.input=e._norm,e.output=e._norm,e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._norm.dispose(),this}}]),n}(J9),xee=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).name="Negate",e._multiply=new tee({context:e.context,value:-1}),e.input=e._multiply,e.output=e._multiply,e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._multiply.dispose(),this}}]),n}(J9),kee=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments,["value"])))).override=!1,e.name="Subtract",e._sum=new g9({context:e.context}),e.input=e._sum,e.output=e._sum,e._neg=new xee({context:e.context}),e.subtrahend=e._param,p9(e._constantSource,e._neg,e._sum),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._neg.dispose(),this._sum.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(x9.getDefaults(),{value:0})}}]),n}(x9),wee=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments)))).name="GreaterThanZero",e._thresh=e.output=new $9({context:e.context,length:127,mapping:function(e){return e<=0?0:1}}),e._scale=e.input=new tee({context:e.context,value:1e4}),e._scale.connect(e._thresh),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._scale.dispose(),this._thresh.dispose(),this}}]),n}(J9),_ee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments,["value"])))).name="GreaterThan",e.override=!1;var r=m7(n.getDefaults(),arguments,["value"]);return e._subtract=e.input=new kee({context:e.context,value:r.value}),e._gtz=e.output=new wee({context:e.context}),e.comparator=e._param=e._subtract.subtrahend,L7(ir(e),"comparator"),e._subtract.connect(e._gtz),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(x9.getDefaults(),{value:0})}}]),n}(x9),See=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments,["value"])))).name="Pow";var r=m7(n.getDefaults(),arguments,["value"]);return e._exponentScaler=e.input=e.output=new $9({context:e.context,mapping:e._expFunc(r.value),length:8192}),e._exponent=r.value,e}return Jn(n,[{key:"_expFunc",value:function(e){return function(t){return Math.pow(Math.abs(t),e)}}},{key:"value",get:function(){return this._exponent},set:function(e){this._exponent=e,this._exponentScaler.setMap(this._expFunc(this._exponent))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._exponentScaler.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(J9.getDefaults(),{value:1})}}]),n}(J9),Cee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments,["min","max","exponent"])))).name="ScaleExp";var r=m7(n.getDefaults(),arguments,["min","max","exponent"]);return e.input=e._exp=new See({context:e.context,value:r.exponent}),e._exp.connect(e._mult),e}return Jn(n,[{key:"exponent",get:function(){return this._exp.value},set:function(e){this._exp.value=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._exp.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(lee.getDefaults(),{exponent:1})}}]),n}(lee),Tee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(x9.getDefaults(),arguments,["value","units"]))).name="SyncedSignal",e.override=!1;var r=m7(x9.getDefaults(),arguments,["value","units"]);return e._lastVal=r.value,e._synced=e.context.transport.scheduleRepeat(e._onTick.bind(ir(e)),"1i"),e._syncedCallback=e._anchorValue.bind(ir(e)),e.context.transport.on("start",e._syncedCallback),e.context.transport.on("pause",e._syncedCallback),e.context.transport.on("stop",e._syncedCallback),e._constantSource.disconnect(),e._constantSource.stop(0),e._constantSource=e.output=new b9({context:e.context,offset:r.value,units:r.units}).start(0),e.setValueAtTime(r.value,0),e}return Jn(n,[{key:"_onTick",value:function(e){var t=ja(nr(n.prototype),"getValueAtTime",this).call(this,this.context.transport.seconds);this._lastVal!==t&&(this._lastVal=t,this._constantSource.offset.setValueAtTime(t,e))}},{key:"_anchorValue",value:function(e){var t=ja(nr(n.prototype),"getValueAtTime",this).call(this,this.context.transport.seconds);this._lastVal=t,this._constantSource.offset.cancelAndHoldAtTime(e),this._constantSource.offset.setValueAtTime(t,e)}},{key:"getValueAtTime",value:function(e){var t=new u9(this.context,e).toSeconds();return ja(nr(n.prototype),"getValueAtTime",this).call(this,t)}},{key:"setValueAtTime",value:function(e,t){var r=new u9(this.context,t).toSeconds();return ja(nr(n.prototype),"setValueAtTime",this).call(this,e,r),this}},{key:"linearRampToValueAtTime",value:function(e,t){var r=new u9(this.context,t).toSeconds();return ja(nr(n.prototype),"linearRampToValueAtTime",this).call(this,e,r),this}},{key:"exponentialRampToValueAtTime",value:function(e,t){var r=new u9(this.context,t).toSeconds();return ja(nr(n.prototype),"exponentialRampToValueAtTime",this).call(this,e,r),this}},{key:"setTargetAtTime",value:function(e,t,r){var a=new u9(this.context,t).toSeconds();return ja(nr(n.prototype),"setTargetAtTime",this).call(this,e,a,r),this}},{key:"cancelScheduledValues",value:function(e){var t=new u9(this.context,e).toSeconds();return ja(nr(n.prototype),"cancelScheduledValues",this).call(this,t),this}},{key:"setValueCurveAtTime",value:function(e,t,r,a){var i=new u9(this.context,t).toSeconds();return r=this.toSeconds(r),ja(nr(n.prototype),"setValueCurveAtTime",this).call(this,e,i,r,a),this}},{key:"cancelAndHoldAtTime",value:function(e){var t=new u9(this.context,e).toSeconds();return ja(nr(n.prototype),"cancelAndHoldAtTime",this).call(this,t),this}},{key:"setRampPoint",value:function(e){var t=new u9(this.context,e).toSeconds();return ja(nr(n.prototype),"setRampPoint",this).call(this,t),this}},{key:"exponentialRampTo",value:function(e,t,r){var a=new u9(this.context,r).toSeconds();return ja(nr(n.prototype),"exponentialRampTo",this).call(this,e,t,a),this}},{key:"linearRampTo",value:function(e,t,r){var a=new u9(this.context,r).toSeconds();return ja(nr(n.prototype),"linearRampTo",this).call(this,e,t,a),this}},{key:"targetRampTo",value:function(e,t,r){var a=new u9(this.context,r).toSeconds();return ja(nr(n.prototype),"targetRampTo",this).call(this,e,t,a),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}}]),n}(x9),Eee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["attack","decay","sustain","release"]))).name="Envelope",e._sig=new x9({context:e.context,value:0}),e.output=e._sig,e.input=void 0;var r=m7(n.getDefaults(),arguments,["attack","decay","sustain","release"]);return e.attack=r.attack,e.decay=r.decay,e.sustain=r.sustain,e.release=r.release,e.attackCurve=r.attackCurve,e.releaseCurve=r.releaseCurve,e.decayCurve=r.decayCurve,e}return Jn(n,[{key:"value",get:function(){return this.getValueAtTime(this.now())}},{key:"_getCurve",value:function(e,t){if(e7(e))return e;var n;for(n in Iee)if(Iee[n][t]===e)return n;return e}},{key:"_setCurve",value:function(e,t,n){if(e7(n)&&Reflect.has(Iee,n)){var r=Iee[n];Z8(r)?"_decayCurve"!==e&&(this[e]=r[t]):this[e]=r}else{if(!$8(n)||"_decayCurve"===e)throw new Error("Envelope: invalid curve: "+n);this[e]=n}}},{key:"attackCurve",get:function(){return this._getCurve(this._attackCurve,"In")},set:function(e){this._setCurve("_attackCurve","In",e)}},{key:"releaseCurve",get:function(){return this._getCurve(this._releaseCurve,"Out")},set:function(e){this._setCurve("_releaseCurve","Out",e)}},{key:"decayCurve",get:function(){return this._decayCurve},set:function(e){U8(["linear","exponential"].some((function(t){return t===e})),"Invalid envelope curve: ".concat(e)),this._decayCurve=e}},{key:"triggerAttack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;this.log("triggerAttack",e,t),e=this.toSeconds(e);var n=this.toSeconds(this.attack),r=n,a=this.toSeconds(this.decay),i=this.getValueAtTime(e);if(i>0){var o=1/r,s=1-i;r=s/o}if(r<this.sampleTime)this._sig.cancelScheduledValues(e),this._sig.setValueAtTime(t,e);else if("linear"===this._attackCurve)this._sig.linearRampTo(t,r,e);else if("exponential"===this._attackCurve)this._sig.targetRampTo(t,r,e);else{this._sig.cancelAndHoldAtTime(e);for(var u=this._attackCurve,c=1;c<u.length;c++)if(u[c-1]<=i&&i<=u[c]){(u=this._attackCurve.slice(c))[0]=i;break}this._sig.setValueCurveAtTime(u,e,r,t)}if(a&&this.sustain<1){var l=t*this.sustain,h=e+r;this.log("decay",h),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(l,a+h):this._sig.exponentialApproachValueAtTime(l,h,a)}return this}},{key:"triggerRelease",value:function(e){this.log("triggerRelease",e),e=this.toSeconds(e);var t=this.getValueAtTime(e);if(t>0){var n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,e):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,e):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,e):(U8($8(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(e),this._sig.setValueCurveAtTime(this._releaseCurve,e,n,t))}return this}},{key:"getValueAtTime",value:function(e){return this._sig.getValueAtTime(e)}},{key:"triggerAttackRelease",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t=this.toSeconds(t),this.triggerAttack(t,n),this.triggerRelease(t+this.toSeconds(e)),this}},{key:"cancel",value:function(e){return this._sig.cancelScheduledValues(this.toSeconds(e)),this}},{key:"connect",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return k9(this,e,t,n),this}},{key:"asArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1024;return s7(this,void 0,void 0,es().mark((function t(){var n,r,a,i,o,s,u,c;return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e/this.context.sampleRate,r=new U7(1,n,this.context.sampleRate),a=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=a+this.toSeconds(this.release),s=i+(o=.1*i),(u=new this.constructor(Object.assign(this.get(),{attack:n*this.toSeconds(this.attack)/s,decay:n*this.toSeconds(this.decay)/s,release:n*this.toSeconds(this.release)/s,context:r})))._sig.toDestination(),u.triggerAttackRelease(n*(a+o)/s,0),t.next=11,r.render();case 11:return c=t.sent,t.abrupt("return",c.getChannelData(0));case 13:case"end":return t.stop()}}),t,this)})))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._sig.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}}]),n}(d9);o7([pee(0)],Eee.prototype,"attack",void 0),o7([pee(0)],Eee.prototype,"decay",void 0),o7([dee(0,1)],Eee.prototype,"sustain",void 0),o7([pee(0)],Eee.prototype,"release",void 0);var Iee=function(){var e,t,n=128,r=[];for(e=0;e<n;e++)r[e]=Math.sin(e/127*(Math.PI/2));var a=[];for(e=0;e<127;e++){t=e/127;var i=Math.sin(t*(2*Math.PI)*6.4-Math.PI/2)+1;a[e]=i/10+.83*t}a[127]=1;var o=[];for(e=0;e<n;e++)o[e]=Math.ceil(e/127*5)/5;var s=[];for(e=0;e<n;e++)t=e/127,s[e]=.5*(1-Math.cos(Math.PI*t));var u,c=[];for(e=0;e<n;e++){t=e/127;var l=4*Math.pow(t,3)+.2,h=Math.cos(l*Math.PI*2*t);c[e]=Math.abs(h*(1-t))}function f(e){for(var t=new Array(e.length),n=0;n<e.length;n++)t[n]=1-e[n];return t}return{bounce:{In:f(c),Out:c},cosine:{In:r,Out:(u=r,u.slice(0).reverse())},exponential:"exponential",linear:"linear",ripple:{In:a,Out:f(a)},sine:{In:s,Out:f(s)},step:{In:o,Out:f(o)}}}(),Aee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments)))._scheduledEvents=[],e._synced=!1,e._original_triggerAttack=e.triggerAttack,e._original_triggerRelease=e.triggerRelease;var r=m7(n.getDefaults(),arguments);return e._volume=e.output=new L9({context:e.context,volume:r.volume}),e.volume=e._volume.volume,L7(ir(e),"volume"),e}return Jn(n,[{key:"sync",value:function(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}},{key:"_syncState",value:function(){var e=!1;return this._synced||(this._synced=!0,e=!0),e}},{key:"_syncMethod",value:function(e,t){var n=this,r=this["_original_"+e]=this[e];this[e]=function(){for(var e=arguments.length,a=new Array(e),i=0;i<e;i++)a[i]=arguments[i];var o=a[t],s=n.context.transport.schedule((function(e){a[t]=e,r.apply(n,a)}),o);n._scheduledEvents.push(s)}}},{key:"unsync",value:function(){var e=this;return this._scheduledEvents.forEach((function(t){return e.context.transport.clear(t)})),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}},{key:"triggerAttackRelease",value:function(e,t,n,r){var a=this.toSeconds(n),i=this.toSeconds(t);return this.triggerAttack(e,a,r),this.triggerRelease(a+i),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{volume:0})}}]),n}(d9),Mee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),e=t.call(this,m7(n.getDefaults(),arguments));var r=m7(n.getDefaults(),arguments);return e.portamento=r.portamento,e.onsilence=r.onsilence,e}return Jn(n,[{key:"triggerAttack",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.log("triggerAttack",e,t,n);var r=this.toSeconds(t);return this._triggerEnvelopeAttack(r,n),this.setNote(e,r),this}},{key:"triggerRelease",value:function(e){this.log("triggerRelease",e);var t=this.toSeconds(e);return this._triggerEnvelopeRelease(t),this}},{key:"setNote",value:function(e,t){var n=this.toSeconds(t),r=e instanceof a9?e.toFrequency():e;if(this.portamento>0&&this.getLevelAtTime(n)>.05){var a=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(r,a,n)}else this.frequency.setValueAtTime(r,n);return this}}],[{key:"getDefaults",value:function(){return Object.assign(Aee.getDefaults(),{detune:0,onsilence:z7,portamento:0})}}]),n}(Aee);o7([pee(0)],Mee.prototype,"portamento",void 0);var Nee=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["attack","decay","sustain","release"]))).name="AmplitudeEnvelope",e._gainNode=new g9({context:e.context,gain:0}),e.output=e._gainNode,e.input=e._gainNode,e._sig.connect(e._gainNode.gain),e.output=e._gainNode,e.input=e._gainNode,e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._gainNode.dispose(),this}}]),n}(Eee),Ree=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="Synth";var r=m7(n.getDefaults(),arguments);return e.oscillator=new uee(Object.assign({context:e.context,detune:r.detune,onstop:function(){return e.onsilence(ir(e))}},r.oscillator)),e.frequency=e.oscillator.frequency,e.detune=e.oscillator.detune,e.envelope=new Nee(Object.assign({context:e.context},r.envelope)),e.oscillator.chain(e.envelope,e.output),L7(ir(e),["oscillator","frequency","detune","envelope"]),e}return Jn(n,[{key:"_triggerEnvelopeAttack",value:function(e,t){if(this.envelope.triggerAttack(e,t),this.oscillator.start(e),0===this.envelope.sustain){var n=this.toSeconds(this.envelope.attack),r=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+r)}}},{key:"_triggerEnvelopeRelease",value:function(e){this.envelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}},{key:"getLevelAtTime",value:function(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.oscillator.dispose(),this.envelope.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Mee.getDefaults(),{envelope:Object.assign(y7(Eee.getDefaults(),Object.keys(d9.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(y7(uee.getDefaults(),[].concat(Tt(Object.keys(W9.getDefaults())),["frequency","detune"])),{type:"triangle"})})}}]),n}(Mee),Dee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="ModulationSynth";var r=m7(n.getDefaults(),arguments);return e._carrier=new Ree({context:e.context,oscillator:r.oscillator,envelope:r.envelope,onsilence:function(){return e.onsilence(ir(e))},volume:-10}),e._modulator=new Ree({context:e.context,oscillator:r.modulation,envelope:r.modulationEnvelope,volume:-10}),e.oscillator=e._carrier.oscillator,e.envelope=e._carrier.envelope,e.modulation=e._modulator.oscillator,e.modulationEnvelope=e._modulator.envelope,e.frequency=new x9({context:e.context,units:"frequency"}),e.detune=new x9({context:e.context,value:r.detune,units:"cents"}),e.harmonicity=new tee({context:e.context,value:r.harmonicity,minValue:0}),e._modulationNode=new g9({context:e.context,gain:0}),L7(ir(e),["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"]),e}return Jn(n,[{key:"_triggerEnvelopeAttack",value:function(e,t){this._carrier._triggerEnvelopeAttack(e,t),this._modulator._triggerEnvelopeAttack(e,t)}},{key:"_triggerEnvelopeRelease",value:function(e){return this._carrier._triggerEnvelopeRelease(e),this._modulator._triggerEnvelopeRelease(e),this}},{key:"getLevelAtTime",value:function(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Mee.getDefaults(),{harmonicity:3,oscillator:Object.assign(y7(uee.getDefaults(),[].concat(Tt(Object.keys(W9.getDefaults())),["frequency","detune"])),{type:"sine"}),envelope:Object.assign(y7(Eee.getDefaults(),Object.keys(d9.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(y7(uee.getDefaults(),[].concat(Tt(Object.keys(W9.getDefaults())),["frequency","detune"])),{type:"square"}),modulationEnvelope:Object.assign(y7(Eee.getDefaults(),Object.keys(d9.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}}]),n}(Mee),Pee=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="AMSynth",e._modulationScale=new eee({context:e.context}),e.frequency.connect(e._carrier.frequency),e.frequency.chain(e.harmonicity,e._modulator.frequency),e.detune.fan(e._carrier.detune,e._modulator.detune),e._modulator.chain(e._modulationScale,e._modulationNode.gain),e._carrier.chain(e._modulationNode,e.output),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._modulationScale.dispose(),this}}]),n}(Dee),Oee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","type"]))).name="BiquadFilter";var r=m7(n.getDefaults(),arguments,["frequency","type"]);return e._filter=e.context.createBiquadFilter(),e.input=e.output=e._filter,e.Q=new f9({context:e.context,units:"number",value:r.Q,param:e._filter.Q}),e.frequency=new f9({context:e.context,units:"frequency",value:r.frequency,param:e._filter.frequency}),e.detune=new f9({context:e.context,units:"cents",value:r.detune,param:e._filter.detune}),e.gain=new f9({context:e.context,units:"decibels",convert:!1,value:r.gain,param:e._filter.gain}),e.type=r.type,e}return Jn(n,[{key:"type",get:function(){return this._filter.type},set:function(e){U8(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e),"Invalid filter type: ".concat(e)),this._filter.type=e}},{key:"getFrequencyResponse",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128,t=new Float32Array(e),n=0;n<e;n++){var r=Math.pow(n/e,2),a=19980*r+20;t[n]=a}var i=new Float32Array(e),o=new Float32Array(e),s=this.context.createBiquadFilter();return s.type=this.type,s.Q.value=this.Q.value,s.frequency.value=this.frequency.value,s.gain.value=this.gain.value,s.getFrequencyResponse(t,i,o),i}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}}]),n}(d9),Lee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","type","rolloff"]))).name="Filter",e.input=new g9({context:e.context}),e.output=new g9({context:e.context}),e._filters=[];var r=m7(n.getDefaults(),arguments,["frequency","type","rolloff"]);return e._filters=[],e.Q=new x9({context:e.context,units:"positive",value:r.Q}),e.frequency=new x9({context:e.context,units:"frequency",value:r.frequency}),e.detune=new x9({context:e.context,units:"cents",value:r.detune}),e.gain=new x9({context:e.context,units:"decibels",convert:!1,value:r.gain}),e._type=r.type,e.rolloff=r.rolloff,L7(ir(e),["detune","frequency","gain","Q"]),e}return Jn(n,[{key:"type",get:function(){return this._type},set:function(e){U8(-1!==["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"].indexOf(e),"Invalid filter type: ".concat(e)),this._type=e,this._filters.forEach((function(t){return t.type=e}))}},{key:"rolloff",get:function(){return this._rolloff},set:function(e){var t=Q8(e)?e:parseInt(e,10),n=[-12,-24,-48,-96],r=n.indexOf(t);U8(-1!==r,"rolloff can only be ".concat(n.join(", "))),r+=1,this._rolloff=t,this.input.disconnect(),this._filters.forEach((function(e){return e.disconnect()})),this._filters=new Array(r);for(var a=0;a<r;a++){var i=new Oee({context:this.context});i.type=this._type,this.frequency.connect(i.frequency),this.detune.connect(i.detune),this.Q.connect(i.Q),this.gain.connect(i.gain),this._filters[a]=i}this._internalChannels=this._filters,p9.apply(void 0,[this.input].concat(Tt(this._internalChannels),[this.output]))}},{key:"getFrequencyResponse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128,t=new Oee({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),n=new Float32Array(e).map((function(){return 1}));return this._filters.forEach((function(){t.getFrequencyResponse(e).forEach((function(e,t){return n[t]*=e}))})),t.dispose(),n}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._filters.forEach((function(e){e.dispose()})),F7(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}}]),n}(d9),Fee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["attack","decay","sustain","release"]))).name="FrequencyEnvelope";var r=m7(n.getDefaults(),arguments,["attack","decay","sustain","release"]);return e._octaves=r.octaves,e._baseFrequency=e.toFrequency(r.baseFrequency),e._exponent=e.input=new See({context:e.context,value:r.exponent}),e._scale=e.output=new lee({context:e.context,min:e._baseFrequency,max:e._baseFrequency*Math.pow(2,e._octaves)}),e._sig.chain(e._exponent,e._scale),e}return Jn(n,[{key:"baseFrequency",get:function(){return this._baseFrequency},set:function(e){var t=this.toFrequency(e);V8(t,0),this._baseFrequency=t,this._scale.min=this._baseFrequency,this.octaves=this._octaves}},{key:"octaves",get:function(){return this._octaves},set:function(e){this._octaves=e,this._scale.max=this._baseFrequency*Math.pow(2,e)}},{key:"exponent",get:function(){return this._exponent.value},set:function(e){this._exponent.value=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._exponent.dispose(),this._scale.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Eee.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}}]),n}(Eee),zee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="MonoSynth";var r=m7(n.getDefaults(),arguments);return e.oscillator=new uee(Object.assign(r.oscillator,{context:e.context,detune:r.detune,onstop:function(){return e.onsilence(ir(e))}})),e.frequency=e.oscillator.frequency,e.detune=e.oscillator.detune,e.filter=new Lee(Object.assign(r.filter,{context:e.context})),e.filterEnvelope=new Fee(Object.assign(r.filterEnvelope,{context:e.context})),e.envelope=new Nee(Object.assign(r.envelope,{context:e.context})),e.oscillator.chain(e.filter,e.envelope,e.output),e.filterEnvelope.connect(e.filter.frequency),L7(ir(e),["oscillator","frequency","detune","filter","filterEnvelope","envelope"]),e}return Jn(n,[{key:"_triggerEnvelopeAttack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this.envelope.triggerAttack(e,t),this.filterEnvelope.triggerAttack(e),this.oscillator.start(e),0===this.envelope.sustain){var n=this.toSeconds(this.envelope.attack),r=this.toSeconds(this.envelope.decay);this.oscillator.stop(e+n+r)}}},{key:"_triggerEnvelopeRelease",value:function(e){this.envelope.triggerRelease(e),this.filterEnvelope.triggerRelease(e),this.oscillator.stop(e+this.toSeconds(this.envelope.release))}},{key:"getLevelAtTime",value:function(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Mee.getDefaults(),{envelope:Object.assign(y7(Eee.getDefaults(),Object.keys(d9.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(y7(Lee.getDefaults(),Object.keys(d9.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(y7(Fee.getDefaults(),Object.keys(d9.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(y7(uee.getDefaults(),Object.keys(W9.getDefaults())),{type:"sawtooth"})})}}]),n}(Mee),Bee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="DuoSynth";var r=m7(n.getDefaults(),arguments);return e.voice0=new zee(Object.assign(r.voice0,{context:e.context,onsilence:function(){return e.onsilence(ir(e))}})),e.voice1=new zee(Object.assign(r.voice1,{context:e.context})),e.harmonicity=new tee({context:e.context,units:"positive",value:r.harmonicity}),e._vibrato=new fee({frequency:r.vibratoRate,context:e.context,min:-50,max:50}),e._vibrato.start(),e.vibratoRate=e._vibrato.frequency,e._vibratoGain=new g9({context:e.context,units:"normalRange",gain:r.vibratoAmount}),e.vibratoAmount=e._vibratoGain.gain,e.frequency=new x9({context:e.context,units:"frequency",value:440}),e.detune=new x9({context:e.context,units:"cents",value:r.detune}),e.frequency.connect(e.voice0.frequency),e.frequency.chain(e.harmonicity,e.voice1.frequency),e._vibrato.connect(e._vibratoGain),e._vibratoGain.fan(e.voice0.detune,e.voice1.detune),e.detune.fan(e.voice0.detune,e.voice1.detune),e.voice0.connect(e.output),e.voice1.connect(e.output),L7(ir(e),["voice0","voice1","frequency","vibratoAmount","vibratoRate"]),e}return Jn(n,[{key:"getLevelAtTime",value:function(e){return e=this.toSeconds(e),this.voice0.envelope.getValueAtTime(e)+this.voice1.envelope.getValueAtTime(e)}},{key:"_triggerEnvelopeAttack",value:function(e,t){this.voice0._triggerEnvelopeAttack(e,t),this.voice1._triggerEnvelopeAttack(e,t)}},{key:"_triggerEnvelopeRelease",value:function(e){return this.voice0._triggerEnvelopeRelease(e),this.voice1._triggerEnvelopeRelease(e),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}],[{key:"getDefaults",value:function(){return v7(Mee.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:v7(y7(zee.getDefaults(),Object.keys(Mee.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:v7(y7(zee.getDefaults(),Object.keys(Mee.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}}]),n}(Mee),Uee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="FMSynth";var r=m7(n.getDefaults(),arguments);return e.modulationIndex=new tee({context:e.context,value:r.modulationIndex}),e.frequency.connect(e._carrier.frequency),e.frequency.chain(e.harmonicity,e._modulator.frequency),e.frequency.chain(e.modulationIndex,e._modulationNode),e.detune.fan(e._carrier.detune,e._modulator.detune),e._modulator.connect(e._modulationNode.gain),e._modulationNode.connect(e._carrier.frequency),e._carrier.connect(e.output),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.modulationIndex.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Dee.getDefaults(),{modulationIndex:10})}}]),n}(Dee),Vee=[1,1.483,1.932,2.546,2.63,3.897],Wee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="MetalSynth",e._oscillators=[],e._freqMultipliers=[];var r=m7(n.getDefaults(),arguments);e.detune=new x9({context:e.context,units:"cents",value:r.detune}),e.frequency=new x9({context:e.context,units:"frequency"}),e._amplitude=new g9({context:e.context,gain:0}).connect(e.output),e._highpass=new Lee({Q:0,context:e.context,type:"highpass"}).connect(e._amplitude);for(var a=0;a<Vee.length;a++){var i=new ree({context:e.context,harmonicity:r.harmonicity,modulationIndex:r.modulationIndex,modulationType:"square",onstop:0===a?function(){return e.onsilence(ir(e))}:z7,type:"square"});i.connect(e._highpass),e._oscillators[a]=i;var o=new tee({context:e.context,value:Vee[a]});e._freqMultipliers[a]=o,e.frequency.chain(o,i.frequency),e.detune.connect(i.detune)}return e._filterFreqScaler=new lee({context:e.context,max:7e3,min:e.toFrequency(r.resonance)}),e.envelope=new Eee({attack:r.envelope.attack,attackCurve:"linear",context:e.context,decay:r.envelope.decay,release:r.envelope.release,sustain:0}),e.envelope.chain(e._filterFreqScaler,e._highpass.frequency),e.envelope.connect(e._amplitude.gain),e._octaves=r.octaves,e.octaves=r.octaves,e}return Jn(n,[{key:"_triggerEnvelopeAttack",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return this.envelope.triggerAttack(e,n),this._oscillators.forEach((function(t){return t.start(e)})),0===this.envelope.sustain&&this._oscillators.forEach((function(n){n.stop(e+t.toSeconds(t.envelope.attack)+t.toSeconds(t.envelope.decay))})),this}},{key:"_triggerEnvelopeRelease",value:function(e){var t=this;return this.envelope.triggerRelease(e),this._oscillators.forEach((function(n){return n.stop(e+t.toSeconds(t.envelope.release))})),this}},{key:"getLevelAtTime",value:function(e){return e=this.toSeconds(e),this.envelope.getValueAtTime(e)}},{key:"modulationIndex",get:function(){return this._oscillators[0].modulationIndex.value},set:function(e){this._oscillators.forEach((function(t){return t.modulationIndex.value=e}))}},{key:"harmonicity",get:function(){return this._oscillators[0].harmonicity.value},set:function(e){this._oscillators.forEach((function(t){return t.harmonicity.value=e}))}},{key:"resonance",get:function(){return this._filterFreqScaler.min},set:function(e){this._filterFreqScaler.min=this.toFrequency(e),this.octaves=this._octaves}},{key:"octaves",get:function(){return this._octaves},set:function(e){this._octaves=e,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,e)}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._oscillators.forEach((function(e){return e.dispose()})),this._freqMultipliers.forEach((function(e){return e.dispose()})),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}],[{key:"getDefaults",value:function(){return v7(Mee.getDefaults(),{envelope:Object.assign(y7(Eee.getDefaults(),Object.keys(d9.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}}]),n}(Mee),Gee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="MembraneSynth",e.portamento=0;var r=m7(n.getDefaults(),arguments);return e.pitchDecay=r.pitchDecay,e.octaves=r.octaves,L7(ir(e),["oscillator","envelope"]),e}return Jn(n,[{key:"setNote",value:function(e,t){var n=this.toSeconds(t),r=this.toFrequency(e instanceof a9?e.toFrequency():e),a=r*this.octaves;return this.oscillator.frequency.setValueAtTime(a,n),this.oscillator.frequency.exponentialRampToValueAtTime(r,n+this.toSeconds(this.pitchDecay)),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this}}],[{key:"getDefaults",value:function(){return v7(Mee.getDefaults(),Ree.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}}]),n}(Ree);o7([dee(0)],Gee.prototype,"octaves",void 0),o7([pee(0)],Gee.prototype,"pitchDecay",void 0);var jee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="NoiseSynth";var r=m7(n.getDefaults(),arguments);return e.noise=new j9(Object.assign({context:e.context},r.noise)),e.envelope=new Nee(Object.assign({context:e.context},r.envelope)),e.noise.chain(e.envelope,e.output),e}return Jn(n,[{key:"triggerAttack",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e=this.toSeconds(e),this.envelope.triggerAttack(e,t),this.noise.start(e),0===this.envelope.sustain&&this.noise.stop(e+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}},{key:"triggerRelease",value:function(e){return e=this.toSeconds(e),this.envelope.triggerRelease(e),this.noise.stop(e+this.toSeconds(this.envelope.release)),this}},{key:"sync",value:function(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}},{key:"triggerAttackRelease",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return t=this.toSeconds(t),e=this.toSeconds(e),this.triggerAttack(t,n),this.triggerRelease(t+e),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.noise.dispose(),this.envelope.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Aee.getDefaults(),{envelope:Object.assign(y7(Eee.getDefaults(),Object.keys(d9.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(y7(j9.getDefaults(),Object.keys(W9.getDefaults())),{type:"white"})})}}]),n}(Aee),qee=new Set;function Hee(e){qee.add(e)}function Xee(e,t){var n='registerProcessor("'.concat(e,'", ').concat(t,")");qee.add(n)}var Kee=function(e){tr(n,e);var t=sr(n);function n(e){var r;$n(this,n),(r=t.call(this,e)).name="ToneAudioWorklet",r.workletOptions={},r.onprocessorerror=z7;var a=URL.createObjectURL(new Blob([Array.from(qee).join("\n")],{type:"text/javascript"})),i=r._audioWorkletName();return r._dummyGain=r.context.createGain(),r._dummyParam=r._dummyGain.gain,r.context.addAudioWorkletModule(a,i).then((function(){r.disposed||(r._worklet=r.context.createAudioWorkletNode(i,r.workletOptions),r._worklet.onprocessorerror=r.onprocessorerror.bind(ir(r)),r.onReady(r._worklet))})),r}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}]),n}(d9);Hee('\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n');Hee("\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n");Hee("\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n");var Yee="feedback-comb-filter";Xee(Yee,'\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n');var Qee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["delayTime","resonance"]))).name="FeedbackCombFilter";var r=m7(n.getDefaults(),arguments,["delayTime","resonance"]);return e.input=new g9({context:e.context}),e.output=new g9({context:e.context}),e.delayTime=new f9({context:e.context,value:r.delayTime,units:"time",minValue:0,maxValue:1,param:e._dummyParam,swappable:!0}),e.resonance=new f9({context:e.context,value:r.resonance,units:"normalRange",param:e._dummyParam,swappable:!0}),L7(ir(e),["resonance","delayTime"]),e}return Jn(n,[{key:"_audioWorkletName",value:function(){return Yee}},{key:"onReady",value:function(e){p9(this.input,e,this.output);var t=e.parameters.get("delayTime");this.delayTime.setParam(t);var n=e.parameters.get("feedback");this.resonance.setParam(n)}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{delayTime:.1,resonance:.5})}}]),n}(Kee),Zee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","type"]))).name="OnePoleFilter";var r=m7(n.getDefaults(),arguments,["frequency","type"]);return e._frequency=r.frequency,e._type=r.type,e.input=new g9({context:e.context}),e.output=new g9({context:e.context}),e._createFilter(),e}return Jn(n,[{key:"_createFilter",value:function(){var e=this,t=this._filter,n=this.toFrequency(this._frequency),r=1/(2*Math.PI*n);if("lowpass"===this._type){var a=1/(r*this.context.sampleRate),i=a-1;this._filter=this.context.createIIRFilter([a,0],[1,i])}else{var o=1/(r*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,o])}this.input.chain(this._filter,this.output),t&&this.context.setTimeout((function(){e.disposed||(e.input.disconnect(t),t.disconnect())}),this.blockTime)}},{key:"frequency",get:function(){return this._frequency},set:function(e){this._frequency=e,this._createFilter()}},{key:"type",get:function(){return this._type},set:function(e){this._type=e,this._createFilter()}},{key:"getFrequencyResponse",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:128,t=new Float32Array(e),n=0;n<e;n++){var r=Math.pow(n/e,2),a=19980*r+20;t[n]=a}var i=new Float32Array(e),o=new Float32Array(e);return this._filter.getFrequencyResponse(t,i,o),i}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{frequency:880,type:"lowpass"})}}]),n}(d9),Jee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["delayTime","resonance","dampening"]))).name="LowpassCombFilter";var r=m7(n.getDefaults(),arguments,["delayTime","resonance","dampening"]);return e._combFilter=e.output=new Qee({context:e.context,delayTime:r.delayTime,resonance:r.resonance}),e.delayTime=e._combFilter.delayTime,e.resonance=e._combFilter.resonance,e._lowpass=e.input=new Zee({context:e.context,frequency:r.dampening,type:"lowpass"}),e._lowpass.connect(e._combFilter),e}return Jn(n,[{key:"dampening",get:function(){return this._lowpass.frequency},set:function(e){this._lowpass.frequency=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._combFilter.dispose(),this._lowpass.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}}]),n}(d9),$ee=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="PluckSynth";var r=m7(n.getDefaults(),arguments);return e._noise=new j9({context:e.context,type:"pink"}),e.attackNoise=r.attackNoise,e._lfcf=new Jee({context:e.context,dampening:r.dampening,resonance:r.resonance}),e.resonance=r.resonance,e.release=r.release,e._noise.connect(e._lfcf),e._lfcf.connect(e.output),e}return Jn(n,[{key:"dampening",get:function(){return this._lfcf.dampening},set:function(e){this._lfcf.dampening=e}},{key:"triggerAttack",value:function(e,t){var n=this.toFrequency(e);t=this.toSeconds(t);var r=1/n;return this._lfcf.delayTime.setValueAtTime(r,t),this._noise.start(t),this._noise.stop(t+r*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(t),this._lfcf.resonance.setValueAtTime(this.resonance,t),this}},{key:"triggerRelease",value:function(e){return this._lfcf.resonance.linearRampTo(0,this.release,e),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._noise.dispose(),this._lfcf.dispose(),this}}],[{key:"getDefaults",value:function(){return v7(Aee.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}}]),n}(Aee),ete=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["voice","options"]))).name="PolySynth",e._availableVoices=[],e._activeVoices=[],e._voices=[],e._gcTimeout=-1,e._averageActiveVoices=0;var r=m7(n.getDefaults(),arguments,["voice","options"]);U8(!Q8(r.voice),"DEPRECATED: The polyphony count is no longer the first argument.");var a=r.voice.getDefaults();e.options=Object.assign(a,r.options),e.voice=r.voice,e.maxPolyphony=r.maxPolyphony,e._dummyVoice=e._getNextAvailableVoice();var i=e._voices.indexOf(e._dummyVoice);return e._voices.splice(i,1),e._gcTimeout=e.context.setInterval(e._collectGarbage.bind(ir(e)),1),e}return Jn(n,[{key:"activeVoices",get:function(){return this._activeVoices.length}},{key:"_makeVoiceAvailable",value:function(e){this._availableVoices.push(e);var t=this._activeVoices.findIndex((function(t){return t.voice===e}));this._activeVoices.splice(t,1)}},{key:"_getNextAvailableVoice",value:function(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){var e=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return e.connect(this.output),this._voices.push(e),e}H8("Max polyphony exceeded. Note dropped.")}},{key:"_collectGarbage",value:function(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){var e=this._availableVoices.shift(),t=this._voices.indexOf(e);this._voices.splice(t,1),this.context.isOffline||e.dispose()}}},{key:"_triggerAttack",value:function(e,t,n){var r=this;e.forEach((function(e){var a=new A9(r.context,e).toMidi(),i=r._getNextAvailableVoice();i&&(i.triggerAttack(e,t,n),r._activeVoices.push({midi:a,voice:i,released:!1}),r.log("triggerAttack",e,t))}))}},{key:"_triggerRelease",value:function(e,t){var n=this;e.forEach((function(e){var r=new A9(n.context,e).toMidi(),a=n._activeVoices.find((function(e){var t=e.midi,n=e.released;return t===r&&!n}));a&&(a.voice.triggerRelease(t),a.released=!0,n.log("triggerRelease",e,t))}))}},{key:"_scheduleEvent",value:function(e,t,n,r){var a=this;U8(!this.disposed,"Synth was already disposed"),n<=this.now()?"attack"===e?this._triggerAttack(t,n,r):this._triggerRelease(t,n):this.context.setTimeout((function(){a._scheduleEvent(e,t,n,r)}),n-this.now())}},{key:"triggerAttack",value:function(e,t,n){Array.isArray(e)||(e=[e]);var r=this.toSeconds(t);return this._scheduleEvent("attack",e,r,n),this}},{key:"triggerRelease",value:function(e,t){Array.isArray(e)||(e=[e]);var n=this.toSeconds(t);return this._scheduleEvent("release",e,n),this}},{key:"triggerAttackRelease",value:function(e,t,n,r){var a=this.toSeconds(n);if(this.triggerAttack(e,a,r),$8(t)){U8($8(e),"If the duration is an array, the notes must also be an array");for(var i=0;i<e.length;i++){var o=t[Math.min(i,t.length-1)],s=this.toSeconds(o);U8(s>0,"The duration must be greater than 0"),this.triggerRelease(e[i],a+s)}}else{var u=this.toSeconds(t);U8(u>0,"The duration must be greater than 0"),this.triggerRelease(e,a+u)}return this}},{key:"sync",value:function(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}},{key:"set",value:function(e){var t=y7(e,["onsilence","context"]);return this.options=v7(this.options,t),this._voices.forEach((function(e){return e.set(t)})),this._dummyVoice.set(t),this}},{key:"get",value:function(){return this._dummyVoice.get()}},{key:"releaseAll",value:function(e){var t=this.toSeconds(e);return this._activeVoices.forEach((function(e){e.voice.triggerRelease(t)})),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._dummyVoice.dispose(),this._voices.forEach((function(e){return e.dispose()})),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}],[{key:"getDefaults",value:function(){return Object.assign(Aee.getDefaults(),{maxPolyphony:32,options:{},voice:Ree})}}]),n}(Aee),tte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"))).name="Sampler",e._activeSources=new Map;var r=m7(n.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),a={};return Object.keys(r.urls).forEach((function(t){var n=parseInt(t,10);if(U8(t7(t)||Q8(n)&&isFinite(n),"url key is neither a note or midi pitch: ".concat(t)),t7(t)){var i=new a9(e.context,t).toMidi();a[i]=r.urls[t]}else Q8(n)&&isFinite(n)&&(a[n]=r.urls[n])})),e._buffers=new I9({urls:a,onload:r.onload,baseUrl:r.baseUrl,onerror:r.onerror}),e.attack=r.attack,e.release=r.release,e.curve=r.curve,e._buffers.loaded&&Promise.resolve().then(r.onload),e}return Jn(n,[{key:"_findClosest",value:function(e){for(var t=0;t<96;){if(this._buffers.has(e+t))return-t;if(this._buffers.has(e-t))return t;t++}throw new Error("No available buffers for note: ".concat(e))}},{key:"triggerAttack",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return this.log("triggerAttack",e,t,r),Array.isArray(e)||(e=[e]),e.forEach((function(e){var a=$7(new a9(n.context,e).toFrequency()),i=Math.round(a),o=a-i,s=n._findClosest(i),u=i-s,c=n._buffers.get(u),l=Q7(s+o),h=new G9({url:c,context:n.context,curve:n.curve,fadeIn:n.attack,fadeOut:n.release,playbackRate:l}).connect(n.output);h.start(t,0,c.duration/l,r),$8(n._activeSources.get(i))||n._activeSources.set(i,[]),n._activeSources.get(i).push(h),h.onended=function(){if(n._activeSources&&n._activeSources.has(i)){var e=n._activeSources.get(i),t=e.indexOf(h);-1!==t&&e.splice(t,1)}}})),this}},{key:"triggerRelease",value:function(e,t){var n=this;return this.log("triggerRelease",e,t),Array.isArray(e)||(e=[e]),e.forEach((function(e){var r=new a9(n.context,e).toMidi();if(n._activeSources.has(r)&&n._activeSources.get(r).length){var a=n._activeSources.get(r);t=n.toSeconds(t),a.forEach((function(e){e.stop(t)})),n._activeSources.set(r,[])}})),this}},{key:"releaseAll",value:function(e){var t=this.toSeconds(e);return this._activeSources.forEach((function(e){for(;e.length;){e.shift().stop(t)}})),this}},{key:"sync",value:function(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}},{key:"triggerAttackRelease",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=this.toSeconds(n);return this.triggerAttack(e,i,a),$8(t)?(U8($8(e),"notes must be an array when duration is array"),e.forEach((function(e,n){var a=t[Math.min(n,t.length-1)];r.triggerRelease(e,i+r.toSeconds(a))}))):this.triggerRelease(e,i+this.toSeconds(t)),this}},{key:"add",value:function(e,t,n){if(U8(t7(e)||isFinite(e),"note must be a pitch or midi: ".concat(e)),t7(e)){var r=new a9(this.context,e).toMidi();this._buffers.add(r,t,n)}else this._buffers.add(e,t,n);return this}},{key:"loaded",get:function(){return this._buffers.loaded}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._buffers.dispose(),this._activeSources.forEach((function(e){e.forEach((function(e){return e.dispose()}))})),this._activeSources.clear(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Aee.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:z7,onerror:z7,release:.1,urls:{}})}}]),n}(Aee);o7([pee(0)],tte.prototype,"attack",void 0),o7([pee(0)],tte.prototype,"release",void 0);var nte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["callback","value"]))).name="ToneEvent",e._state=new h9("stopped"),e._startOffset=0;var r=m7(n.getDefaults(),arguments,["callback","value"]);return e._loop=r.loop,e.callback=r.callback,e.value=r.value,e._loopStart=e.toTicks(r.loopStart),e._loopEnd=e.toTicks(r.loopEnd),e._playbackRate=r.playbackRate,e._probability=r.probability,e._humanize=r.humanize,e.mute=r.mute,e._playbackRate=r.playbackRate,e._state.increasing=!0,e._rescheduleEvents(),e}return Jn(n,[{key:"_rescheduleEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;this._state.forEachFrom(t,(function(t){var n;if("started"===t.state){-1!==t.id&&e.context.transport.clear(t.id);var r=t.time+Math.round(e.startOffset/e._playbackRate);if(!0===e._loop||Q8(e._loop)&&e._loop>1){n=1/0,Q8(e._loop)&&(n=e._loop*e._getLoopDuration());var a=e._state.getAfter(r);null!==a&&(n=Math.min(n,a.time-r)),n!==1/0&&(e._state.setStateAtTime("stopped",r+n+1,{id:-1}),n=new N9(e.context,n));var i=new N9(e.context,e._getLoopDuration());t.id=e.context.transport.scheduleRepeat(e._tick.bind(e),i,new N9(e.context,r),n)}else t.id=e.context.transport.schedule(e._tick.bind(e),new N9(e.context,r))}}))}},{key:"state",get:function(){return this._state.getValueAtTime(this.context.transport.ticks)}},{key:"startOffset",get:function(){return this._startOffset},set:function(e){this._startOffset=e}},{key:"probability",get:function(){return this._probability},set:function(e){this._probability=e}},{key:"humanize",get:function(){return this._humanize},set:function(e){this._humanize=e}},{key:"start",value:function(e){var t=this.toTicks(e);return"stopped"===this._state.getValueAtTime(t)&&(this._state.add({id:-1,state:"started",time:t}),this._rescheduleEvents(t)),this}},{key:"stop",value:function(e){this.cancel(e);var t=this.toTicks(e);if("started"===this._state.getValueAtTime(t)){this._state.setStateAtTime("stopped",t,{id:-1});var n=this._state.getBefore(t),r=t;null!==n&&(r=n.time),this._rescheduleEvents(r)}return this}},{key:"cancel",value:function(e){var t=this;e=g7(e,-1/0);var n=this.toTicks(e);return this._state.forEachFrom(n,(function(e){t.context.transport.clear(e.id)})),this._state.cancel(n),this}},{key:"_tick",value:function(e){var t=this.context.transport.getTicksAtTime(e);if(!this.mute&&"started"===this._state.getValueAtTime(t)){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){var n=.02;J8(this.humanize)||(n=this.toSeconds(this.humanize)),e+=(2*Math.random()-1)*n}this.callback(e,this.value)}}},{key:"_getLoopDuration",value:function(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)}},{key:"loop",get:function(){return this._loop},set:function(e){this._loop=e,this._rescheduleEvents()}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this._rescheduleEvents()}},{key:"loopEnd",get:function(){return new N9(this.context,this._loopEnd).toSeconds()},set:function(e){this._loopEnd=this.toTicks(e),this._loop&&this._rescheduleEvents()}},{key:"loopStart",get:function(){return new N9(this.context,this._loopStart).toSeconds()},set:function(e){this._loopStart=this.toTicks(e),this._loop&&this._rescheduleEvents()}},{key:"progress",get:function(){if(this._loop){var e=this.context.transport.ticks,t=this._state.get(e);if(null!==t&&"started"===t.state){var n=this._getLoopDuration();return(e-t.time)%n/n}return 0}return 0}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.cancel(),this._state.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(l9.getDefaults(),{callback:z7,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}}]),n}(l9),rte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["callback","interval"]))).name="Loop";var r=m7(n.getDefaults(),arguments,["callback","interval"]);return e._event=new nte({context:e.context,callback:e._tick.bind(ir(e)),loop:!0,loopEnd:r.interval,playbackRate:r.playbackRate,probability:r.probability}),e.callback=r.callback,e.iterations=r.iterations,e}return Jn(n,[{key:"start",value:function(e){return this._event.start(e),this}},{key:"stop",value:function(e){return this._event.stop(e),this}},{key:"cancel",value:function(e){return this._event.cancel(e),this}},{key:"_tick",value:function(e){this.callback(e)}},{key:"state",get:function(){return this._event.state}},{key:"progress",get:function(){return this._event.progress}},{key:"interval",get:function(){return this._event.loopEnd},set:function(e){this._event.loopEnd=e}},{key:"playbackRate",get:function(){return this._event.playbackRate},set:function(e){this._event.playbackRate=e}},{key:"humanize",get:function(){return this._event.humanize},set:function(e){this._event.humanize=e}},{key:"probability",get:function(){return this._event.probability},set:function(e){this._event.probability=e}},{key:"mute",get:function(){return this._event.mute},set:function(e){this._event.mute=e}},{key:"iterations",get:function(){return!0===this._event.loop?1/0:this._event.loop},set:function(e){this._event.loop=e===1/0||e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._event.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(l9.getDefaults(),{interval:"4n",callback:z7,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}}]),n}(l9),ate=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["callback","events"]))).name="Part",e._state=new h9("stopped"),e._events=new Set;var r=m7(n.getDefaults(),arguments,["callback","events"]);return e._state.increasing=!0,r.events.forEach((function(t){$8(t)?e.add(t[0],t[1]):e.add(t)})),e}return Jn(n,[{key:"start",value:function(e,t){var n=this,r=this.toTicks(e);if("started"!==this._state.getValueAtTime(r)){t=g7(t,this._loop?this._loopStart:0),t=this._loop?g7(t,this._loopStart):g7(t,0);var a=this.toTicks(t);this._state.add({id:-1,offset:a,state:"started",time:r}),this._forEach((function(e){n._startNote(e,r,a)}))}return this}},{key:"_startNote",value:function(e,t,n){t-=n,this._loop?e.startOffset>=this._loopStart&&e.startOffset<this._loopEnd?(e.startOffset<n&&(t+=this._getLoopDuration()),e.start(new N9(this.context,t))):e.startOffset<this._loopStart&&e.startOffset>=n&&(e.loop=!1,e.start(new N9(this.context,t))):e.startOffset>=n&&e.start(new N9(this.context,t))}},{key:"startOffset",get:function(){return this._startOffset},set:function(e){var t=this;this._startOffset=e,this._forEach((function(e){e.startOffset+=t._startOffset}))}},{key:"stop",value:function(e){var t=this.toTicks(e);return this._state.cancel(t),this._state.setStateAtTime("stopped",t),this._forEach((function(t){t.stop(e)})),this}},{key:"at",value:function(e,t){for(var n=new u9(this.context,e).toTicks(),r=new N9(this.context,1).toSeconds(),a=this._events.values(),i=a.next();!i.done;){var o=i.value;if(Math.abs(n-o.startOffset)<r)return K8(t)&&(o.value=t),o;i=a.next()}return K8(t)?(this.add(e,t),this.at(e)):null}},{key:"add",value:function(e,t){e instanceof Object&&Reflect.has(e,"time")&&(e=(t=e).time);var n,r=this.toTicks(e);return t instanceof nte?(n=t).callback=this._tick.bind(this):n=new nte({callback:this._tick.bind(this),context:this.context,value:t}),n.startOffset=r,n.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(n),this._restartEvent(n),this}},{key:"_restartEvent",value:function(e){var t=this;this._state.forEach((function(n){"started"===n.state?t._startNote(e,n.time,n.offset):e.stop(new N9(t.context,n.time))}))}},{key:"remove",value:function(e,t){var n=this;return Z8(e)&&e.hasOwnProperty("time")&&(e=(t=e).time),e=this.toTicks(e),this._events.forEach((function(r){r.startOffset===e&&(X8(t)||K8(t)&&r.value===t)&&(n._events.delete(r),r.dispose())})),this}},{key:"clear",value:function(){return this._forEach((function(e){return e.dispose()})),this._events.clear(),this}},{key:"cancel",value:function(e){return this._forEach((function(t){return t.cancel(e)})),this._state.cancel(this.toTicks(e)),this}},{key:"_forEach",value:function(e){return this._events&&this._events.forEach((function(t){t instanceof n?t._forEach(e):e(t)})),this}},{key:"_setAll",value:function(e,t){this._forEach((function(n){n[e]=t}))}},{key:"_tick",value:function(e,t){this.mute||this.callback(e,t)}},{key:"_testLoopBoundries",value:function(e){this._loop&&(e.startOffset<this._loopStart||e.startOffset>=this._loopEnd)?e.cancel(0):"stopped"===e.state&&this._restartEvent(e)}},{key:"probability",get:function(){return this._probability},set:function(e){this._probability=e,this._setAll("probability",e)}},{key:"humanize",get:function(){return this._humanize},set:function(e){this._humanize=e,this._setAll("humanize",e)}},{key:"loop",get:function(){return this._loop},set:function(e){var t=this;this._loop=e,this._forEach((function(n){n.loopStart=t.loopStart,n.loopEnd=t.loopEnd,n.loop=e,t._testLoopBoundries(n)}))}},{key:"loopEnd",get:function(){return new N9(this.context,this._loopEnd).toSeconds()},set:function(e){var t=this;this._loopEnd=this.toTicks(e),this._loop&&this._forEach((function(n){n.loopEnd=e,t._testLoopBoundries(n)}))}},{key:"loopStart",get:function(){return new N9(this.context,this._loopStart).toSeconds()},set:function(e){var t=this;this._loopStart=this.toTicks(e),this._loop&&this._forEach((function(e){e.loopStart=t.loopStart,t._testLoopBoundries(e)}))}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(e){this._playbackRate=e,this._setAll("playbackRate",e)}},{key:"length",get:function(){return this._events.size}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.clear(),this}}],[{key:"getDefaults",value:function(){return Object.assign(nte.getDefaults(),{events:[]})}}]),n}(nte),ite=es().mark(vte),ote=es().mark(mte),ste=es().mark(gte),ute=es().mark(bte),cte=es().mark(xte),lte=es().mark(kte),hte=es().mark(wte),fte=es().mark(_te),dte=es().mark(Ste),pte=es().mark(Cte);function vte(e){var t;return es().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=0;case 1:if(!(t<e.length)){n.next=8;break}return t=yte(t,e),n.next=5,e[t];case 5:t++,n.next=1;break;case 8:case"end":return n.stop()}}),ite)}function mte(e){var t;return es().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=e.length-1;case 1:if(!(t>=0)){n.next=8;break}return t=yte(t,e),n.next=5,e[t];case 5:t--,n.next=1;break;case 8:case"end":return n.stop()}}),ote)}function gte(e,t){return es().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.delegateYield(t(e),"t0",2);case 2:n.next=0;break;case 4:case"end":return n.stop()}}),ste)}function yte(e,t){return C7(e,0,t.length-1)}function bte(e,t){var n;return es().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:n=t?0:e.length-1;case 1:return n=yte(n,e),r.next=5,e[n];case 5:t?++n>=e.length-1&&(t=!1):--n<=0&&(t=!0),r.next=1;break;case 8:case"end":return r.stop()}}),ute)}function xte(e){var t,n;return es().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=0,n=0;case 2:if(!(t<e.length)){r.next=10;break}return t=yte(t,e),r.next=6,e[t];case 6:n++,t+=n%2?2:-1,r.next=2;break;case 10:case"end":return r.stop()}}),cte)}function kte(e){var t,n;return es().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=e.length-1,n=0;case 2:if(!(t>=0)){r.next=10;break}return t=yte(t,e),r.next=6,e[t];case 6:n++,t+=n%2?-2:1,r.next=2;break;case 10:case"end":return r.stop()}}),lte)}function wte(e){var t;return es().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return t=Math.floor(Math.random()*e.length),n.next=4,e[t];case 4:n.next=0;break;case 6:case"end":return n.stop()}}),hte)}function _te(e){var t,n,r,a;return es().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:for(t=[],n=0;n<e.length;n++)t.push(n);case 2:if(!(t.length>0)){i.next=9;break}return r=t.splice(Math.floor(t.length*Math.random()),1),a=yte(r[0],e),i.next=7,e[a];case 7:i.next=2;break;case 9:case"end":return i.stop()}}),fte)}function Ste(e){var t;return es().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:t=Math.floor(Math.random()*e.length);case 1:return 0===t?t++:t===e.length-1||Math.random()<.5?t--:t++,n.next=5,e[t];case 5:n.next=1;break;case 7:case"end":return n.stop()}}),dte)}function Cte(e){var t,n=arguments;return es().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:t=n.length>1&&void 0!==n[1]?n[1]:"up",n.length>2&&void 0!==n[2]?n[2]:0,U8(e.length>0,"The array must have more than one value in it"),r.t0=t,r.next="up"===r.t0?6:"down"===r.t0?7:"upDown"===r.t0?8:"downUp"===r.t0?9:"alternateUp"===r.t0?10:"alternateDown"===r.t0?11:"random"===r.t0?12:"randomOnce"===r.t0?13:"randomWalk"===r.t0?14:15;break;case 6:return r.delegateYield(gte(e,vte),"t1",7);case 7:return r.delegateYield(gte(e,mte),"t2",8);case 8:return r.delegateYield(bte(e,!0),"t3",9);case 9:return r.delegateYield(bte(e,!1),"t4",10);case 10:return r.delegateYield(gte(e,xte),"t5",11);case 11:return r.delegateYield(gte(e,kte),"t6",12);case 12:return r.delegateYield(wte(e),"t7",13);case 13:return r.delegateYield(gte(e,_te),"t8",14);case 14:return r.delegateYield(Ste(e),"t9",15);case 15:case"end":return r.stop()}}),pte)}var Tte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["callback","values","pattern"]))).name="Pattern";var r=m7(n.getDefaults(),arguments,["callback","values","pattern"]);return e.callback=r.callback,e._values=r.values,e._pattern=Cte(r.values,r.pattern),e._type=r.pattern,e}return Jn(n,[{key:"_tick",value:function(e){var t=this._pattern.next();this._value=t.value,this.callback(e,this._value)}},{key:"values",get:function(){return this._values},set:function(e){this._values=e,this.pattern=this._type}},{key:"value",get:function(){return this._value}},{key:"pattern",get:function(){return this._type},set:function(e){this._type=e,this._pattern=Cte(this._values,this._type)}}],[{key:"getDefaults",value:function(){return Object.assign(rte.getDefaults(),{pattern:"up",values:[],callback:z7})}}]),n}(rte),Ete=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["callback","events","subdivision"]))).name="Sequence",e._part=new ate({callback:e._seqCallback.bind(ir(e)),context:e.context}),e._events=[],e._eventsArray=[];var r=m7(n.getDefaults(),arguments,["callback","events","subdivision"]);return e._subdivision=e.toTicks(r.subdivision),e.events=r.events,e.loop=r.loop,e.loopStart=r.loopStart,e.loopEnd=r.loopEnd,e.playbackRate=r.playbackRate,e.probability=r.probability,e.humanize=r.humanize,e.mute=r.mute,e.playbackRate=r.playbackRate,e}return Jn(n,[{key:"_seqCallback",value:function(e,t){null!==t&&this.callback(e,t)}},{key:"events",get:function(){return this._events},set:function(e){this.clear(),this._eventsArray=e,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}},{key:"start",value:function(e,t){return this._part.start(e,t?this._indexTime(t):t),this}},{key:"stop",value:function(e){return this._part.stop(e),this}},{key:"subdivision",get:function(){return new N9(this.context,this._subdivision).toSeconds()}},{key:"_createSequence",value:function(e){var t=this;return new Proxy(e,{get:function(e,t){return e[t]},set:function(e,n,r){return e7(n)&&isFinite(parseInt(n,10))&&$8(r)?e[n]=t._createSequence(r):e[n]=r,t._eventsUpdated(),!0}})}},{key:"_eventsUpdated",value:function(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}},{key:"_rescheduleSequence",value:function(e,t,n){var r=this;e.forEach((function(e,a){var i=a*t+n;if($8(e))r._rescheduleSequence(e,t/e.length,i);else{var o=new N9(r.context,i,"i").toSeconds();r._part.add(o,e)}}))}},{key:"_indexTime",value:function(e){return new N9(this.context,e*this._subdivision+this.startOffset).toSeconds()}},{key:"clear",value:function(){return this._part.clear(),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._part.dispose(),this}},{key:"loop",get:function(){return this._part.loop},set:function(e){this._part.loop=e}},{key:"loopStart",get:function(){return this._loopStart},set:function(e){this._loopStart=e,this._part.loopStart=this._indexTime(e)}},{key:"loopEnd",get:function(){return this._loopEnd},set:function(e){this._loopEnd=e,this._part.loopEnd=0===e?this._indexTime(this._eventsArray.length):this._indexTime(e)}},{key:"startOffset",get:function(){return this._part.startOffset},set:function(e){this._part.startOffset=e}},{key:"playbackRate",get:function(){return this._part.playbackRate},set:function(e){this._part.playbackRate=e}},{key:"probability",get:function(){return this._part.probability},set:function(e){this._part.probability=e}},{key:"progress",get:function(){return this._part.progress}},{key:"humanize",get:function(){return this._part.humanize},set:function(e){this._part.humanize=e}},{key:"length",get:function(){return this._part.length}}],[{key:"getDefaults",value:function(){return Object.assign(y7(nte.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}}]),n}(nte),Ite=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments,["fade"])))).name="CrossFade",e._panner=e.context.createStereoPanner(),e._split=e.context.createChannelSplitter(2),e._g2a=new bee({context:e.context}),e.a=new g9({context:e.context,gain:0}),e.b=new g9({context:e.context,gain:0}),e.output=new g9({context:e.context}),e._internalChannels=[e.a,e.b];var r=m7(n.getDefaults(),arguments,["fade"]);return e.fade=new x9({context:e.context,units:"normalRange",value:r.fade}),L7(ir(e),"fade"),e.context.getConstant(1).connect(e._panner),e._panner.connect(e._split),e._panner.channelCount=1,e._panner.channelCountMode="explicit",v9(e._split,e.a.gain,0),v9(e._split,e.b.gain,1),e.fade.chain(e._g2a,e._panner.pan),e.a.connect(e.output),e.b.connect(e.output),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{fade:.5})}}]),n}(d9),Ate=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).name="Effect",r._dryWet=new Ite({context:r.context}),r.wet=r._dryWet.fade,r.effectSend=new g9({context:r.context}),r.effectReturn=new g9({context:r.context}),r.input=new g9({context:r.context}),r.output=r._dryWet,r.input.fan(r._dryWet.a,r.effectSend),r.effectReturn.connect(r._dryWet.b),r.wet.setValueAtTime(e.wet,0),r._internalChannels=[r.effectReturn,r.effectSend],L7(ir(r),"wet"),r}return Jn(n,[{key:"connectEffect",value:function(e){return this._internalChannels.push(e),this.effectSend.chain(e,this.effectReturn),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{wet:1})}}]),n}(d9),Mte=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).name="LFOEffect",r._lfo=new fee({context:r.context,frequency:e.frequency,amplitude:e.depth}),r.depth=r._lfo.amplitude,r.frequency=r._lfo.frequency,r.type=e.type,L7(ir(r),["frequency","depth"]),r}return Jn(n,[{key:"start",value:function(e){return this._lfo.start(e),this}},{key:"stop",value:function(e){return this._lfo.stop(e),this}},{key:"sync",value:function(){return this._lfo.sync(),this}},{key:"unsync",value:function(){return this._lfo.unsync(),this}},{key:"type",get:function(){return this._lfo.type},set:function(e){this._lfo.type=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Ate.getDefaults(),{frequency:1,type:"sine",depth:1})}}]),n}(Ate),Nte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","baseFrequency","octaves"]))).name="AutoFilter";var r=m7(n.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);return e.filter=new Lee(Object.assign(r.filter,{context:e.context})),e.connectEffect(e.filter),e._lfo.connect(e.filter.frequency),e.octaves=r.octaves,e.baseFrequency=r.baseFrequency,e}return Jn(n,[{key:"baseFrequency",get:function(){return this._lfo.min},set:function(e){this._lfo.min=this.toFrequency(e),this.octaves=this._octaves}},{key:"octaves",get:function(){return this._octaves},set:function(e){this._octaves=e,this._lfo.max=this._lfo.min*Math.pow(2,e)}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.filter.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Mte.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}}]),n}(Mte),Rte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments,["pan"])))).name="Panner",e._panner=e.context.createStereoPanner(),e.input=e._panner,e.output=e._panner;var r=m7(n.getDefaults(),arguments,["pan"]);return e.pan=new f9({context:e.context,param:e._panner.pan,value:r.pan,minValue:-1,maxValue:1}),e._panner.channelCount=r.channelCount,e._panner.channelCountMode="explicit",L7(ir(e),"pan"),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._panner.disconnect(),this.pan.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{pan:0,channelCount:1})}}]),n}(d9),Dte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency"]))).name="AutoPanner";var r=m7(n.getDefaults(),arguments,["frequency"]);return e._panner=new Rte({context:e.context,channelCount:r.channelCount}),e.connectEffect(e._panner),e._lfo.connect(e._panner.pan),e._lfo.min=-1,e._lfo.max=1,e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._panner.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Mte.getDefaults(),{channelCount:1})}}]),n}(Mte),Pte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["smoothing"]))).name="Follower";var r=m7(n.getDefaults(),arguments,["smoothing"]);return e._abs=e.input=new yee({context:e.context}),e._lowpass=e.output=new Zee({context:e.context,frequency:1/e.toSeconds(r.smoothing),type:"lowpass"}),e._abs.connect(e._lowpass),e._smoothing=r.smoothing,e}return Jn(n,[{key:"smoothing",get:function(){return this._smoothing},set:function(e){this._smoothing=e,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._abs.dispose(),this._lowpass.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{smoothing:.05})}}]),n}(d9),Ote=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]))).name="AutoWah";var r=m7(n.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);return e._follower=new Pte({context:e.context,smoothing:r.follower}),e._sweepRange=new Cee({context:e.context,min:0,max:1,exponent:.5}),e._baseFrequency=e.toFrequency(r.baseFrequency),e._octaves=r.octaves,e._inputBoost=new g9({context:e.context}),e._bandpass=new Lee({context:e.context,rolloff:-48,frequency:0,Q:r.Q}),e._peaking=new Lee({context:e.context,type:"peaking"}),e._peaking.gain.value=r.gain,e.gain=e._peaking.gain,e.Q=e._bandpass.Q,e.effectSend.chain(e._inputBoost,e._follower,e._sweepRange),e._sweepRange.connect(e._bandpass.frequency),e._sweepRange.connect(e._peaking.frequency),e.effectSend.chain(e._bandpass,e._peaking,e.effectReturn),e._setSweepRange(),e.sensitivity=r.sensitivity,L7(ir(e),["gain","Q"]),e}return Jn(n,[{key:"octaves",get:function(){return this._octaves},set:function(e){this._octaves=e,this._setSweepRange()}},{key:"follower",get:function(){return this._follower.smoothing},set:function(e){this._follower.smoothing=e}},{key:"baseFrequency",get:function(){return this._baseFrequency},set:function(e){this._baseFrequency=this.toFrequency(e),this._setSweepRange()}},{key:"sensitivity",get:function(){return Y7(1/this._inputBoost.gain.value)},set:function(e){this._inputBoost.gain.value=1/K7(e)}},{key:"_setSweepRange",value:function(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Ate.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}}]),n}(Ate),Lte="bit-crusher";Xee(Lte,"\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n");var Fte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["bits"]))).name="BitCrusher";var r=m7(n.getDefaults(),arguments,["bits"]);return e._bitCrusherWorklet=new zte({context:e.context,bits:r.bits}),e.connectEffect(e._bitCrusherWorklet),e.bits=e._bitCrusherWorklet.bits,e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._bitCrusherWorklet.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Ate.getDefaults(),{bits:4})}}]),n}(Ate),zte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="BitCrusherWorklet";var r=m7(n.getDefaults(),arguments);return e.input=new g9({context:e.context}),e.output=new g9({context:e.context}),e.bits=new f9({context:e.context,value:r.bits,units:"positive",minValue:1,maxValue:16,param:e._dummyParam,swappable:!0}),e}return Jn(n,[{key:"_audioWorkletName",value:function(){return Lte}},{key:"onReady",value:function(e){p9(this.input,e,this.output);var t=e.parameters.get("bits");this.bits.setParam(t)}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Kee.getDefaults(),{bits:12})}}]),n}(Kee),Bte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["order"]))).name="Chebyshev";var r=m7(n.getDefaults(),arguments,["order"]);return e._shaper=new $9({context:e.context,length:4096}),e._order=r.order,e.connectEffect(e._shaper),e.order=r.order,e.oversample=r.oversample,e}return Jn(n,[{key:"_getCoefficient",value:function(e,t,n){return n.has(t)||(0===t?n.set(t,0):1===t?n.set(t,e):n.set(t,2*e*this._getCoefficient(e,t-1,n)-this._getCoefficient(e,t-2,n))),n.get(t)}},{key:"order",get:function(){return this._order},set:function(e){var t=this;this._order=e,this._shaper.setMap((function(n){return t._getCoefficient(n,e,new Map)}))}},{key:"oversample",get:function(){return this._shaper.oversample},set:function(e){this._shaper.oversample=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._shaper.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Ate.getDefaults(),{order:1,oversample:"none"})}}]),n}(Ate),Ute=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["channels"]))).name="Split";var r=m7(n.getDefaults(),arguments,["channels"]);return e._splitter=e.input=e.output=e.context.createChannelSplitter(r.channels),e._internalChannels=[e._splitter],e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._splitter.disconnect(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{channels:2})}}]),n}(d9),Vte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["channels"]))).name="Merge";var r=m7(n.getDefaults(),arguments,["channels"]);return e._merger=e.output=e.input=e.context.createChannelMerger(r.channels),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._merger.disconnect(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{channels:2})}}]),n}(d9),Wte=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).name="StereoEffect",r.input=new g9({context:r.context}),r.input.channelCount=2,r.input.channelCountMode="explicit",r._dryWet=r.output=new Ite({context:r.context,fade:e.wet}),r.wet=r._dryWet.fade,r._split=new Ute({context:r.context,channels:2}),r._merge=new Vte({context:r.context,channels:2}),r.input.connect(r._split),r.input.connect(r._dryWet.a),r._merge.connect(r._dryWet.b),L7(ir(r),["wet"]),r}return Jn(n,[{key:"connectEffectLeft",value:function(){var e;this._split.connect(arguments.length<=0?void 0:arguments[0],0,0),p9.apply(void 0,arguments),v9((e=arguments.length-1)<0||arguments.length<=e?void 0:arguments[e],this._merge,0,0)}},{key:"connectEffectRight",value:function(){var e;this._split.connect(arguments.length<=0?void 0:arguments[0],1,0),p9.apply(void 0,arguments),v9((e=arguments.length-1)<0||arguments.length<=e?void 0:arguments[e],this._merge,0,1)}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{wet:1})}}]),n}(d9),Gte=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).feedback=new x9({context:r.context,value:e.feedback,units:"normalRange"}),r._feedbackL=new g9({context:r.context}),r._feedbackR=new g9({context:r.context}),r._feedbackSplit=new Ute({context:r.context,channels:2}),r._feedbackMerge=new Vte({context:r.context,channels:2}),r._merge.connect(r._feedbackSplit),r._feedbackMerge.connect(r._split),r._feedbackSplit.connect(r._feedbackL,0,0),r._feedbackL.connect(r._feedbackMerge,0,0),r._feedbackSplit.connect(r._feedbackR,1,0),r._feedbackR.connect(r._feedbackMerge,0,1),r.feedback.fan(r._feedbackL.gain,r._feedbackR.gain),L7(ir(r),["feedback"]),r}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Wte.getDefaults(),{feedback:.5})}}]),n}(Wte),jte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","delayTime","depth"]))).name="Chorus";var r=m7(n.getDefaults(),arguments,["frequency","delayTime","depth"]);return e._depth=r.depth,e._delayTime=r.delayTime/1e3,e._lfoL=new fee({context:e.context,frequency:r.frequency,min:0,max:1}),e._lfoR=new fee({context:e.context,frequency:r.frequency,min:0,max:1,phase:180}),e._delayNodeL=new T9({context:e.context}),e._delayNodeR=new T9({context:e.context}),e.frequency=e._lfoL.frequency,L7(ir(e),["frequency"]),e._lfoL.frequency.connect(e._lfoR.frequency),e.connectEffectLeft(e._delayNodeL),e.connectEffectRight(e._delayNodeR),e._lfoL.connect(e._delayNodeL.delayTime),e._lfoR.connect(e._delayNodeR.delayTime),e.depth=e._depth,e.type=r.type,e.spread=r.spread,e}return Jn(n,[{key:"depth",get:function(){return this._depth},set:function(e){this._depth=e;var t=this._delayTime*e;this._lfoL.min=Math.max(this._delayTime-t,0),this._lfoL.max=this._delayTime+t,this._lfoR.min=Math.max(this._delayTime-t,0),this._lfoR.max=this._delayTime+t}},{key:"delayTime",get:function(){return 1e3*this._delayTime},set:function(e){this._delayTime=e/1e3,this.depth=this._depth}},{key:"type",get:function(){return this._lfoL.type},set:function(e){this._lfoL.type=e,this._lfoR.type=e}},{key:"spread",get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}},{key:"start",value:function(e){return this._lfoL.start(e),this._lfoR.start(e),this}},{key:"stop",value:function(e){return this._lfoL.stop(e),this._lfoR.stop(e),this}},{key:"sync",value:function(){return this._lfoL.sync(),this._lfoR.sync(),this}},{key:"unsync",value:function(){return this._lfoL.unsync(),this._lfoR.unsync(),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Gte.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}}]),n}(Gte),qte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["distortion"]))).name="Distortion";var r=m7(n.getDefaults(),arguments,["distortion"]);return e._shaper=new $9({context:e.context,length:4096}),e._distortion=r.distortion,e.connectEffect(e._shaper),e.distortion=r.distortion,e.oversample=r.oversample,e}return Jn(n,[{key:"distortion",get:function(){return this._distortion},set:function(e){this._distortion=e;var t=100*e,n=Math.PI/180;this._shaper.setMap((function(e){return Math.abs(e)<.001?0:(3+t)*e*20*n/(Math.PI+t*Math.abs(e))}))}},{key:"oversample",get:function(){return this._shaper.oversample},set:function(e){this._shaper.oversample=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._shaper.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Ate.getDefaults(),{distortion:.4,oversample:"none"})}}]),n}(Ate),Hte=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).name="FeedbackEffect",r._feedbackGain=new g9({context:r.context,gain:e.feedback,units:"normalRange"}),r.feedback=r._feedbackGain.gain,L7(ir(r),"feedback"),r.effectReturn.chain(r._feedbackGain,r.effectSend),r}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._feedbackGain.dispose(),this.feedback.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Ate.getDefaults(),{feedback:.125})}}]),n}(Ate),Xte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["delayTime","feedback"]))).name="FeedbackDelay";var r=m7(n.getDefaults(),arguments,["delayTime","feedback"]);return e._delayNode=new T9({context:e.context,delayTime:r.delayTime,maxDelay:r.maxDelay}),e.delayTime=e._delayNode.delayTime,e.connectEffect(e._delayNode),L7(ir(e),"delayTime"),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._delayNode.dispose(),this.delayTime.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Hte.getDefaults(),{delayTime:.25,maxDelay:1})}}]),n}(Hte),Kte=function(e){tr(n,e);var t=sr(n);function n(e){var r;$n(this,n),(r=t.call(this,e)).name="PhaseShiftAllpass",r.input=new g9({context:r.context}),r.output=new g9({context:r.context}),r.offset90=new g9({context:r.context});return r._bank0=r._createAllPassFilterBank([.6923878,.9360654322959,.988229522686,.9987488452737]),r._bank1=r._createAllPassFilterBank([.4021921162426,.856171088242,.9722909545651,.9952884791278]),r._oneSampleDelay=r.context.createIIRFilter([0,1],[1,0]),p9.apply(void 0,[r.input].concat(Tt(r._bank0),[r._oneSampleDelay,r.output])),p9.apply(void 0,[r.input].concat(Tt(r._bank1),[r.offset90])),r}return Jn(n,[{key:"_createAllPassFilterBank",value:function(e){var t=this;return e.map((function(e){var n=[[e*e,0,-1],[1,0,-e*e]];return t.context.createIIRFilter(n[0],n[1])}))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach((function(e){return e.disconnect()})),this._bank1.forEach((function(e){return e.disconnect()})),this._oneSampleDelay.disconnect(),this}}]),n}(d9),Yte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency"]))).name="FrequencyShifter";var r=m7(n.getDefaults(),arguments,["frequency"]);e.frequency=new x9({context:e.context,units:"frequency",value:r.frequency,minValue:-e.context.sampleRate/2,maxValue:e.context.sampleRate/2}),e._sine=new Q9({context:e.context,type:"sine"}),e._cosine=new Z9({context:e.context,phase:-90,type:"sine"}),e._sineMultiply=new tee({context:e.context}),e._cosineMultiply=new tee({context:e.context}),e._negate=new xee({context:e.context}),e._add=new cee({context:e.context}),e._phaseShifter=new Kte({context:e.context}),e.effectSend.connect(e._phaseShifter),e.frequency.fan(e._sine.frequency,e._cosine.frequency),e._phaseShifter.offset90.connect(e._cosineMultiply),e._cosine.connect(e._cosineMultiply.factor),e._phaseShifter.connect(e._sineMultiply),e._sine.connect(e._sineMultiply.factor),e._sineMultiply.connect(e._negate),e._cosineMultiply.connect(e._add),e._negate.connect(e._add.addend),e._add.connect(e.effectReturn);var a=e.immediate();return e._sine.start(a),e._cosine.start(a),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Ate.getDefaults(),{frequency:0})}}]),n}(Ate),Qte=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],Zte=[225,556,441,341],Jte=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["roomSize","dampening"]))).name="Freeverb",e._combFilters=[],e._allpassFiltersL=[],e._allpassFiltersR=[];var r=m7(n.getDefaults(),arguments,["roomSize","dampening"]);return e.roomSize=new x9({context:e.context,value:r.roomSize,units:"normalRange"}),e._allpassFiltersL=Zte.map((function(t){var n=e.context.createBiquadFilter();return n.type="allpass",n.frequency.value=t,n})),e._allpassFiltersR=Zte.map((function(t){var n=e.context.createBiquadFilter();return n.type="allpass",n.frequency.value=t,n})),e._combFilters=Qte.map((function(t,n){var a,i,o=new Jee({context:e.context,dampening:r.dampening,delayTime:t});n<Qte.length/2?(a=e).connectEffectLeft.apply(a,[o].concat(Tt(e._allpassFiltersL))):(i=e).connectEffectRight.apply(i,[o].concat(Tt(e._allpassFiltersR)));return e.roomSize.connect(o.resonance),o})),L7(ir(e),["roomSize"]),e}return Jn(n,[{key:"dampening",get:function(){return this._combFilters[0].dampening},set:function(e){this._combFilters.forEach((function(t){return t.dampening=e}))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._allpassFiltersL.forEach((function(e){return e.disconnect()})),this._allpassFiltersR.forEach((function(e){return e.disconnect()})),this._combFilters.forEach((function(e){return e.dispose()})),this.roomSize.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Wte.getDefaults(),{roomSize:.7,dampening:3e3})}}]),n}(Wte),$te=[.06748,.06404,.08212,.09004],ene=[.773,.802,.753,.733],tne=[347,113,37],nne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["roomSize"]))).name="JCReverb",e._allpassFilters=[],e._feedbackCombFilters=[];var r=m7(n.getDefaults(),arguments,["roomSize"]);return e.roomSize=new x9({context:e.context,value:r.roomSize,units:"normalRange"}),e._scaleRoomSize=new lee({context:e.context,min:-.733,max:.197}),e._allpassFilters=tne.map((function(t){var n=e.context.createBiquadFilter();return n.type="allpass",n.frequency.value=t,n})),e._feedbackCombFilters=$te.map((function(t,n){var r,a,i=new Qee({context:e.context,delayTime:t});(e._scaleRoomSize.connect(i.resonance),i.resonance.value=ene[n],n<$te.length/2)?(r=e).connectEffectLeft.apply(r,Tt(e._allpassFilters).concat([i])):(a=e).connectEffectRight.apply(a,Tt(e._allpassFilters).concat([i]));return i})),e.roomSize.connect(e._scaleRoomSize),L7(ir(e),["roomSize"]),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._allpassFilters.forEach((function(e){return e.disconnect()})),this._feedbackCombFilters.forEach((function(e){return e.dispose()})),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Wte.getDefaults(),{roomSize:.5})}}]),n}(Wte),rne=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e))._feedbackL.disconnect(),r._feedbackL.connect(r._feedbackMerge,0,1),r._feedbackR.disconnect(),r._feedbackR.connect(r._feedbackMerge,0,0),L7(ir(r),["feedback"]),r}return Jn(n)}(Gte),ane=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["delayTime","feedback"]))).name="PingPongDelay";var r=m7(n.getDefaults(),arguments,["delayTime","feedback"]);return e._leftDelay=new T9({context:e.context,maxDelay:r.maxDelay}),e._rightDelay=new T9({context:e.context,maxDelay:r.maxDelay}),e._rightPreDelay=new T9({context:e.context,maxDelay:r.maxDelay}),e.delayTime=new x9({context:e.context,units:"time",value:r.delayTime}),e.connectEffectLeft(e._leftDelay),e.connectEffectRight(e._rightPreDelay,e._rightDelay),e.delayTime.fan(e._leftDelay.delayTime,e._rightDelay.delayTime,e._rightPreDelay.delayTime),e._feedbackL.disconnect(),e._feedbackL.connect(e._rightDelay),L7(ir(e),["delayTime"]),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(rne.getDefaults(),{delayTime:.25,maxDelay:1})}}]),n}(rne),ine=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["pitch"]))).name="PitchShift";var r=m7(n.getDefaults(),arguments,["pitch"]);e._frequency=new x9({context:e.context}),e._delayA=new T9({maxDelay:1,context:e.context}),e._lfoA=new fee({context:e.context,min:0,max:.1,type:"sawtooth"}).connect(e._delayA.delayTime),e._delayB=new T9({maxDelay:1,context:e.context}),e._lfoB=new fee({context:e.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(e._delayB.delayTime),e._crossFade=new Ite({context:e.context}),e._crossFadeLFO=new fee({context:e.context,min:0,max:1,type:"triangle",phase:90}).connect(e._crossFade.fade),e._feedbackDelay=new T9({delayTime:r.delayTime,context:e.context}),e.delayTime=e._feedbackDelay.delayTime,L7(ir(e),"delayTime"),e._pitch=r.pitch,e._windowSize=r.windowSize,e._delayA.connect(e._crossFade.a),e._delayB.connect(e._crossFade.b),e._frequency.fan(e._lfoA.frequency,e._lfoB.frequency,e._crossFadeLFO.frequency),e.effectSend.fan(e._delayA,e._delayB),e._crossFade.chain(e._feedbackDelay,e.effectReturn);var a=e.now();return e._lfoA.start(a),e._lfoB.start(a),e._crossFadeLFO.start(a),e.windowSize=e._windowSize,e}return Jn(n,[{key:"pitch",get:function(){return this._pitch},set:function(e){this._pitch=e;var t=0;e<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,t=Q7(e-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,t=Q7(e)-1),this._frequency.value=t*(1.2/this._windowSize)}},{key:"windowSize",get:function(){return this._windowSize},set:function(e){this._windowSize=this.toSeconds(e),this.pitch=this._pitch}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Hte.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}}]),n}(Hte),one=function(e){tr(n,e);var t=sr(n);function n(){var e,r,a;$n(this,n),(a=t.call(this,m7(n.getDefaults(),arguments,["frequency","octaves","baseFrequency"]))).name="Phaser";var i=m7(n.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);return a._lfoL=new fee({context:a.context,frequency:i.frequency,min:0,max:1}),a._lfoR=new fee({context:a.context,frequency:i.frequency,min:0,max:1,phase:180}),a._baseFrequency=a.toFrequency(i.baseFrequency),a._octaves=i.octaves,a.Q=new x9({context:a.context,value:i.Q,units:"positive"}),a._filtersL=a._makeFilters(i.stages,a._lfoL),a._filtersR=a._makeFilters(i.stages,a._lfoR),a.frequency=a._lfoL.frequency,a.frequency.value=i.frequency,(e=a).connectEffectLeft.apply(e,Tt(a._filtersL)),(r=a).connectEffectRight.apply(r,Tt(a._filtersR)),a._lfoL.frequency.connect(a._lfoR.frequency),a.baseFrequency=i.baseFrequency,a.octaves=i.octaves,a._lfoL.start(),a._lfoR.start(),L7(ir(a),["frequency","Q"]),a}return Jn(n,[{key:"_makeFilters",value:function(e,t){for(var n=[],r=0;r<e;r++){var a=this.context.createBiquadFilter();a.type="allpass",this.Q.connect(a.Q),t.connect(a.frequency),n.push(a)}return n}},{key:"octaves",get:function(){return this._octaves},set:function(e){this._octaves=e;var t=this._baseFrequency*Math.pow(2,e);this._lfoL.max=t,this._lfoR.max=t}},{key:"baseFrequency",get:function(){return this._baseFrequency},set:function(e){this._baseFrequency=this.toFrequency(e),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach((function(e){return e.disconnect()})),this._filtersR.forEach((function(e){return e.disconnect()})),this.frequency.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Wte.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}}]),n}(Wte),sne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["decay"]))).name="Reverb",e._convolver=e.context.createConvolver(),e.ready=Promise.resolve();var r=m7(n.getDefaults(),arguments,["decay"]);return e._decay=r.decay,e._preDelay=r.preDelay,e.generate(),e.connectEffect(e._convolver),e}return Jn(n,[{key:"decay",get:function(){return this._decay},set:function(e){V8(e=this.toSeconds(e),.001),this._decay=e,this.generate()}},{key:"preDelay",get:function(){return this._preDelay},set:function(e){V8(e=this.toSeconds(e),0),this._preDelay=e,this.generate()}},{key:"generate",value:function(){return s7(this,void 0,void 0,es().mark((function e(){var t,n,r,a,i,o,s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.ready,n=new U7(2,this._decay+this._preDelay,this.context.sampleRate),r=new j9({context:n}),a=new j9({context:n}),i=new Vte({context:n}),r.connect(i,0,0),a.connect(i,0,1),o=new g9({context:n}).toDestination(),i.connect(o),r.start(0),a.start(0),o.gain.setValueAtTime(0,0),o.gain.setValueAtTime(1,this._preDelay),o.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay),s=n.render(),this.ready=s.then(z7),e.next=18,t;case 18:return e.next=20,s;case 20:return this._convolver.buffer=e.sent.get(),e.abrupt("return",this);case 22:case"end":return e.stop()}}),e,this)})))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._convolver.disconnect(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Ate.getDefaults(),{decay:1.5,preDelay:.01})}}]),n}(Ate),une=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="MidSideSplit",e._split=e.input=new Ute({channels:2,context:e.context}),e._midAdd=new cee({context:e.context}),e.mid=new tee({context:e.context,value:Math.SQRT1_2}),e._sideSubtract=new kee({context:e.context}),e.side=new tee({context:e.context,value:Math.SQRT1_2}),e._split.connect(e._midAdd,0),e._split.connect(e._midAdd.addend,1),e._split.connect(e._sideSubtract,0),e._split.connect(e._sideSubtract.subtrahend,1),e._midAdd.connect(e.mid),e._sideSubtract.connect(e.side),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}}]),n}(d9),cne=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="MidSideMerge",e.mid=new g9({context:e.context}),e.side=new g9({context:e.context}),e._left=new cee({context:e.context}),e._leftMult=new tee({context:e.context,value:Math.SQRT1_2}),e._right=new kee({context:e.context}),e._rightMult=new tee({context:e.context,value:Math.SQRT1_2}),e._merge=e.output=new Vte({context:e.context}),e.mid.fan(e._left),e.side.connect(e._left.addend),e.mid.connect(e._right),e.side.connect(e._right.subtrahend),e._left.connect(e._leftMult),e._right.connect(e._rightMult),e._leftMult.connect(e._merge,0,0),e._rightMult.connect(e._merge,0,1),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}}]),n}(d9),lne=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).name="MidSideEffect",r._midSideMerge=new cne({context:r.context}),r._midSideSplit=new une({context:r.context}),r._midSend=r._midSideSplit.mid,r._sideSend=r._midSideSplit.side,r._midReturn=r._midSideMerge.mid,r._sideReturn=r._midSideMerge.side,r.effectSend.connect(r._midSideSplit),r._midSideMerge.connect(r.effectReturn),r}return Jn(n,[{key:"connectEffectMid",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this._midSend).chain.apply(e,n.concat([this._midReturn]))}},{key:"connectEffectSide",value:function(){for(var e,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];(e=this._sideSend).chain.apply(e,n.concat([this._sideReturn]))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}}]),n}(Ate),hne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["width"]))).name="StereoWidener";var r=m7(n.getDefaults(),arguments,["width"]);return e.width=new x9({context:e.context,value:r.width,units:"normalRange"}),L7(ir(e),["width"]),e._twoTimesWidthMid=new tee({context:e.context,value:2}),e._twoTimesWidthSide=new tee({context:e.context,value:2}),e._midMult=new tee({context:e.context}),e._twoTimesWidthMid.connect(e._midMult.factor),e.connectEffectMid(e._midMult),e._oneMinusWidth=new kee({context:e.context}),e._oneMinusWidth.connect(e._twoTimesWidthMid),v9(e.context.getConstant(1),e._oneMinusWidth),e.width.connect(e._oneMinusWidth.subtrahend),e._sideMult=new tee({context:e.context}),e.width.connect(e._twoTimesWidthSide),e._twoTimesWidthSide.connect(e._sideMult.factor),e.connectEffectSide(e._sideMult),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(lne.getDefaults(),{width:.5})}}]),n}(lne),fne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","depth"]))).name="Tremolo";var r=m7(n.getDefaults(),arguments,["frequency","depth"]);return e._lfoL=new fee({context:e.context,type:r.type,min:1,max:0}),e._lfoR=new fee({context:e.context,type:r.type,min:1,max:0}),e._amplitudeL=new g9({context:e.context}),e._amplitudeR=new g9({context:e.context}),e.frequency=new x9({context:e.context,value:r.frequency,units:"frequency"}),e.depth=new x9({context:e.context,value:r.depth,units:"normalRange"}),L7(ir(e),["frequency","depth"]),e.connectEffectLeft(e._amplitudeL),e.connectEffectRight(e._amplitudeR),e._lfoL.connect(e._amplitudeL.gain),e._lfoR.connect(e._amplitudeR.gain),e.frequency.fan(e._lfoL.frequency,e._lfoR.frequency),e.depth.fan(e._lfoR.amplitude,e._lfoL.amplitude),e.spread=r.spread,e}return Jn(n,[{key:"start",value:function(e){return this._lfoL.start(e),this._lfoR.start(e),this}},{key:"stop",value:function(e){return this._lfoL.stop(e),this._lfoR.stop(e),this}},{key:"sync",value:function(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}},{key:"unsync",value:function(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}},{key:"type",get:function(){return this._lfoL.type},set:function(e){this._lfoL.type=e,this._lfoR.type=e}},{key:"spread",get:function(){return this._lfoR.phase-this._lfoL.phase},set:function(e){this._lfoL.phase=90-e/2,this._lfoR.phase=e/2+90}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Wte.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}}]),n}(Wte),dne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["frequency","depth"]))).name="Vibrato";var r=m7(n.getDefaults(),arguments,["frequency","depth"]);return e._delayNode=new T9({context:e.context,delayTime:0,maxDelay:r.maxDelay}),e._lfo=new fee({context:e.context,type:r.type,min:0,max:r.maxDelay,frequency:r.frequency,phase:-90}).start().connect(e._delayNode.delayTime),e.frequency=e._lfo.frequency,e.depth=e._lfo.amplitude,e.depth.value=r.depth,L7(ir(e),["frequency","depth"]),e.effectSend.chain(e._delayNode,e.effectReturn),e}return Jn(n,[{key:"type",get:function(){return this._lfo.type},set:function(e){this._lfo.type=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(Ate.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}}]),n}(Ate),pne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["type","size"]))).name="Analyser",e._analysers=[],e._buffers=[];var r=m7(n.getDefaults(),arguments,["type","size"]);e.input=e.output=e._gain=new g9({context:e.context}),e._split=new Ute({context:e.context,channels:r.channels}),e.input.connect(e._split),V8(r.channels,1);for(var a=0;a<r.channels;a++)e._analysers[a]=e.context.createAnalyser(),e._split.connect(e._analysers[a],a,0);return e.size=r.size,e.type=r.type,e}return Jn(n,[{key:"getValue",value:function(){var e=this;return this._analysers.forEach((function(t,n){var r=e._buffers[n];"fft"===e._type?t.getFloatFrequencyData(r):"waveform"===e._type&&t.getFloatTimeDomainData(r)})),1===this.channels?this._buffers[0]:this._buffers}},{key:"size",get:function(){return this._analysers[0].frequencyBinCount},set:function(e){var t=this;this._analysers.forEach((function(n,r){n.fftSize=2*e,t._buffers[r]=new Float32Array(e)}))}},{key:"channels",get:function(){return this._analysers.length}},{key:"type",get:function(){return this._type},set:function(e){U8("waveform"===e||"fft"===e,"Analyser: invalid type: ".concat(e)),this._type=e}},{key:"smoothing",get:function(){return this._analysers[0].smoothingTimeConstant},set:function(e){this._analysers.forEach((function(t){return t.smoothingTimeConstant=e}))}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._analysers.forEach((function(e){return e.disconnect()})),this._split.dispose(),this._gain.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}}]),n}(d9),vne=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="MeterBase",e.input=e.output=e._analyser=new pne({context:e.context,size:256,type:"waveform"}),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._analyser.dispose(),this}}]),n}(d9),mne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["smoothing"]))).name="Meter",e._rms=0;var r=m7(n.getDefaults(),arguments,["smoothing"]);return e.input=e.output=e._analyser=new pne({context:e.context,size:256,type:"waveform",channels:r.channels}),e.smoothing=r.smoothing,e.normalRange=r.normalRange,e}return Jn(n,[{key:"getLevel",value:function(){return H8("'getLevel' has been changed to 'getValue'"),this.getValue()}},{key:"getValue",value:function(){var e=this,t=this._analyser.getValue(),n=(1===this.channels?[t]:t).map((function(t){var n=t.reduce((function(e,t){return e+t*t}),0),r=Math.sqrt(n/t.length);return e._rms=Math.max(r,e._rms*e.smoothing),e.normalRange?e._rms:Y7(e._rms)}));return 1===this.channels?n[0]:n}},{key:"channels",get:function(){return this._analyser.channels}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._analyser.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(vne.getDefaults(),{smoothing:.8,normalRange:!1,channels:1})}}]),n}(vne),gne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["size"]))).name="FFT";var r=m7(n.getDefaults(),arguments,["size"]);return e.normalRange=r.normalRange,e._analyser.type="fft",e.size=r.size,e}return Jn(n,[{key:"getValue",value:function(){var e=this;return this._analyser.getValue().map((function(t){return e.normalRange?K7(t):t}))}},{key:"size",get:function(){return this._analyser.size},set:function(e){this._analyser.size=e}},{key:"smoothing",get:function(){return this._analyser.smoothing},set:function(e){this._analyser.smoothing=e}},{key:"getFrequencyOfIndex",value:function(e){return U8(0<=e&&e<this.size,"index must be greater than or equal to 0 and less than ".concat(this.size)),e*this.context.sampleRate/(2*this.size)}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}}]),n}(vne),yne=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="DCMeter",e._analyser.type="waveform",e._analyser.size=256,e}return Jn(n,[{key:"getValue",value:function(){return this._analyser.getValue()[0]}}]),n}(vne),bne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["size"]))).name="Waveform";var r=m7(n.getDefaults(),arguments,["size"]);return e._analyser.type="waveform",e.size=r.size,e}return Jn(n,[{key:"getValue",value:function(){return this._analyser.getValue()}},{key:"size",get:function(){return this._analyser.size},set:function(e){this._analyser.size=e}}],[{key:"getDefaults",value:function(){return Object.assign(vne.getDefaults(),{size:1024})}}]),n}(vne),xne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["solo"]))).name="Solo";var r=m7(n.getDefaults(),arguments,["solo"]);return e.input=e.output=new g9({context:e.context}),n._allSolos.has(e.context)||n._allSolos.set(e.context,new Set),n._allSolos.get(e.context).add(ir(e)),e.solo=r.solo,e}return Jn(n,[{key:"solo",get:function(){return this._isSoloed()},set:function(e){e?this._addSolo():this._removeSolo(),n._allSolos.get(this.context).forEach((function(e){return e._updateSolo()}))}},{key:"muted",get:function(){return 0===this.input.gain.value}},{key:"_addSolo",value:function(){n._soloed.has(this.context)||n._soloed.set(this.context,new Set),n._soloed.get(this.context).add(this)}},{key:"_removeSolo",value:function(){n._soloed.has(this.context)&&n._soloed.get(this.context).delete(this)}},{key:"_isSoloed",value:function(){return n._soloed.has(this.context)&&n._soloed.get(this.context).has(this)}},{key:"_noSolos",value:function(){return!n._soloed.has(this.context)||n._soloed.has(this.context)&&0===n._soloed.get(this.context).size}},{key:"_updateSolo",value:function(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),n._allSolos.get(this.context).delete(this),this._removeSolo(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{solo:!1})}}]),n}(d9);xne._allSolos=new Map,xne._soloed=new Map;var kne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["pan","volume"]))).name="PanVol";var r=m7(n.getDefaults(),arguments,["pan","volume"]);return e._panner=e.input=new Rte({context:e.context,pan:r.pan,channelCount:r.channelCount}),e.pan=e._panner.pan,e._volume=e.output=new L9({context:e.context,volume:r.volume}),e.volume=e._volume.volume,e._panner.connect(e._volume),e.mute=r.mute,L7(ir(e),["pan","volume"]),e}return Jn(n,[{key:"mute",get:function(){return this._volume.mute},set:function(e){this._volume.mute=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}}]),n}(d9),wne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["volume","pan"]))).name="Channel";var r=m7(n.getDefaults(),arguments,["volume","pan"]);return e._solo=e.input=new xne({solo:r.solo,context:e.context}),e._panVol=e.output=new kne({context:e.context,pan:r.pan,volume:r.volume,mute:r.mute,channelCount:r.channelCount}),e.pan=e._panVol.pan,e.volume=e._panVol.volume,e._solo.connect(e._panVol),L7(ir(e),["pan","volume"]),e}return Jn(n,[{key:"solo",get:function(){return this._solo.solo},set:function(e){this._solo.solo=e}},{key:"muted",get:function(){return this._solo.muted||this.mute}},{key:"mute",get:function(){return this._panVol.mute},set:function(e){this._panVol.mute=e}},{key:"_getBus",value:function(e){return n.buses.has(e)||n.buses.set(e,new g9({context:this.context})),n.buses.get(e)}},{key:"send",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this._getBus(e),r=new g9({context:this.context,units:"decibels",gain:t});return this.connect(r),r.connect(n),r}},{key:"receive",value:function(e){return this._getBus(e).connect(this),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}}]),n}(d9);wne.buses=new Map;var _ne=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="Mono",e.input=new g9({context:e.context}),e._merge=e.output=new Vte({channels:2,context:e.context}),e.input.connect(e._merge,0,0),e.input.connect(e._merge,0,1),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._merge.dispose(),this.input.dispose(),this}}]),n}(d9),Sne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["lowFrequency","highFrequency"]))).name="MultibandSplit",e.input=new g9({context:e.context}),e.output=void 0,e.low=new Lee({context:e.context,frequency:0,type:"lowpass"}),e._lowMidFilter=new Lee({context:e.context,frequency:0,type:"highpass"}),e.mid=new Lee({context:e.context,frequency:0,type:"lowpass"}),e.high=new Lee({context:e.context,frequency:0,type:"highpass"}),e._internalChannels=[e.low,e.mid,e.high];var r=m7(n.getDefaults(),arguments,["lowFrequency","highFrequency"]);return e.lowFrequency=new x9({context:e.context,units:"frequency",value:r.lowFrequency}),e.highFrequency=new x9({context:e.context,units:"frequency",value:r.highFrequency}),e.Q=new x9({context:e.context,units:"positive",value:r.Q}),e.input.fan(e.low,e.high),e.input.chain(e._lowMidFilter,e.mid),e.lowFrequency.fan(e.low.frequency,e._lowMidFilter.frequency),e.highFrequency.fan(e.mid.frequency,e.high.frequency),e.Q.connect(e.low.Q),e.Q.connect(e._lowMidFilter.Q),e.Q.connect(e.mid.Q),e.Q.connect(e.high.Q),L7(ir(e),["high","mid","low","highFrequency","lowFrequency"]),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),F7(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}}]),n}(d9),Cne=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).name="Listener",e.positionX=new f9({context:e.context,param:e.context.rawContext.listener.positionX}),e.positionY=new f9({context:e.context,param:e.context.rawContext.listener.positionY}),e.positionZ=new f9({context:e.context,param:e.context.rawContext.listener.positionZ}),e.forwardX=new f9({context:e.context,param:e.context.rawContext.listener.forwardX}),e.forwardY=new f9({context:e.context,param:e.context.rawContext.listener.forwardY}),e.forwardZ=new f9({context:e.context,param:e.context.rawContext.listener.forwardZ}),e.upX=new f9({context:e.context,param:e.context.rawContext.listener.upX}),e.upY=new f9({context:e.context,param:e.context.rawContext.listener.upY}),e.upZ=new f9({context:e.context,param:e.context.rawContext.listener.upZ}),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}}]),n}(d9);I7((function(e){e.listener=new Cne({context:e})})),M7((function(e){e.listener.dispose()}));var Tne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["positionX","positionY","positionZ"]))).name="Panner3D";var r=m7(n.getDefaults(),arguments,["positionX","positionY","positionZ"]);return e._panner=e.input=e.output=e.context.createPanner(),e.panningModel=r.panningModel,e.maxDistance=r.maxDistance,e.distanceModel=r.distanceModel,e.coneOuterGain=r.coneOuterGain,e.coneOuterAngle=r.coneOuterAngle,e.coneInnerAngle=r.coneInnerAngle,e.refDistance=r.refDistance,e.rolloffFactor=r.rolloffFactor,e.positionX=new f9({context:e.context,param:e._panner.positionX,value:r.positionX}),e.positionY=new f9({context:e.context,param:e._panner.positionY,value:r.positionY}),e.positionZ=new f9({context:e.context,param:e._panner.positionZ,value:r.positionZ}),e.orientationX=new f9({context:e.context,param:e._panner.orientationX,value:r.orientationX}),e.orientationY=new f9({context:e.context,param:e._panner.orientationY,value:r.orientationY}),e.orientationZ=new f9({context:e.context,param:e._panner.orientationZ,value:r.orientationZ}),e}return Jn(n,[{key:"setPosition",value:function(e,t,n){return this.positionX.value=e,this.positionY.value=t,this.positionZ.value=n,this}},{key:"setOrientation",value:function(e,t,n){return this.orientationX.value=e,this.orientationY.value=t,this.orientationZ.value=n,this}},{key:"panningModel",get:function(){return this._panner.panningModel},set:function(e){this._panner.panningModel=e}},{key:"refDistance",get:function(){return this._panner.refDistance},set:function(e){this._panner.refDistance=e}},{key:"rolloffFactor",get:function(){return this._panner.rolloffFactor},set:function(e){this._panner.rolloffFactor=e}},{key:"distanceModel",get:function(){return this._panner.distanceModel},set:function(e){this._panner.distanceModel=e}},{key:"coneInnerAngle",get:function(){return this._panner.coneInnerAngle},set:function(e){this._panner.coneInnerAngle=e}},{key:"coneOuterAngle",get:function(){return this._panner.coneOuterAngle},set:function(e){this._panner.coneOuterAngle=e}},{key:"coneOuterGain",get:function(){return this._panner.coneOuterGain},set:function(e){this._panner.coneOuterGain=e}},{key:"maxDistance",get:function(){return this._panner.maxDistance},set:function(e){this._panner.maxDistance=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}}]),n}(d9),Ene=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments))).name="Recorder";var r=m7(n.getDefaults(),arguments);return e.input=new g9({context:e.context}),U8(n.supported,"Media Recorder API is not available"),e._stream=e.context.createMediaStreamDestination(),e.input.connect(e._stream),e._recorder=new MediaRecorder(e._stream.stream,{mimeType:r.mimeType}),e}return Jn(n,[{key:"mimeType",get:function(){return this._recorder.mimeType}},{key:"state",get:function(){return"inactive"===this._recorder.state?"stopped":"paused"===this._recorder.state?"paused":"started"}},{key:"start",value:function(){return s7(this,void 0,void 0,es().mark((function e(){var t,n=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return U8("started"!==this.state,"Recorder is already started"),t=new Promise((function(e){n._recorder.addEventListener("start",(function t(){n._recorder.removeEventListener("start",t,!1),e()}),!1)})),this._recorder.start(),e.next=5,t;case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"stop",value:function(){return s7(this,void 0,void 0,es().mark((function e(){var t,n=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return U8("stopped"!==this.state,"Recorder is not started"),t=new Promise((function(e){n._recorder.addEventListener("dataavailable",(function t(r){n._recorder.removeEventListener("dataavailable",t,!1),e(r.data)}),!1)})),this._recorder.stop(),e.next=5,t;case 5:return e.abrupt("return",e.sent);case 6:case"end":return e.stop()}}),e,this)})))}},{key:"pause",value:function(){return U8("started"===this.state,"Recorder must be started"),this._recorder.pause(),this}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.input.dispose(),this._stream.disconnect(),this}}],[{key:"getDefaults",value:function(){return d9.getDefaults()}},{key:"supported",get:function(){return null!==a7&&Reflect.has(a7,"MediaRecorder")}}]),n}(d9),Ine=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["threshold","ratio"]))).name="Compressor",e._compressor=e.context.createDynamicsCompressor(),e.input=e._compressor,e.output=e._compressor;var r=m7(n.getDefaults(),arguments,["threshold","ratio"]);return e.threshold=new f9({minValue:e._compressor.threshold.minValue,maxValue:e._compressor.threshold.maxValue,context:e.context,convert:!1,param:e._compressor.threshold,units:"decibels",value:r.threshold}),e.attack=new f9({minValue:e._compressor.attack.minValue,maxValue:e._compressor.attack.maxValue,context:e.context,param:e._compressor.attack,units:"time",value:r.attack}),e.release=new f9({minValue:e._compressor.release.minValue,maxValue:e._compressor.release.maxValue,context:e.context,param:e._compressor.release,units:"time",value:r.release}),e.knee=new f9({minValue:e._compressor.knee.minValue,maxValue:e._compressor.knee.maxValue,context:e.context,convert:!1,param:e._compressor.knee,units:"decibels",value:r.knee}),e.ratio=new f9({minValue:e._compressor.ratio.minValue,maxValue:e._compressor.ratio.maxValue,context:e.context,convert:!1,param:e._compressor.ratio,units:"positive",value:r.ratio}),L7(ir(e),["knee","release","attack","ratio","threshold"]),e}return Jn(n,[{key:"reduction",get:function(){return this._compressor.reduction}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}}]),n}(d9),Ane=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments,["threshold","smoothing"])))).name="Gate";var r=m7(n.getDefaults(),arguments,["threshold","smoothing"]);return e._follower=new Pte({context:e.context,smoothing:r.smoothing}),e._gt=new _ee({context:e.context,value:K7(r.threshold)}),e.input=new g9({context:e.context}),e._gate=e.output=new g9({context:e.context}),e.input.connect(e._gate),e.input.chain(e._follower,e._gt,e._gate.gain),e}return Jn(n,[{key:"threshold",get:function(){return Y7(this._gt.value)},set:function(e){this._gt.value=K7(e)}},{key:"smoothing",get:function(){return this._follower.smoothing},set:function(e){this._follower.smoothing=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{smoothing:.1,threshold:-40})}}]),n}(d9),Mne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments,["threshold"])))).name="Limiter";var r=m7(n.getDefaults(),arguments,["threshold"]);return e._compressor=e.input=e.output=new Ine({context:e.context,ratio:20,attack:.003,release:.01,threshold:r.threshold}),e.threshold=e._compressor.threshold,L7(ir(e),"threshold"),e}return Jn(n,[{key:"reduction",get:function(){return this._compressor.reduction}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._compressor.dispose(),this.threshold.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{threshold:-12})}}]),n}(d9),Nne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments)))).name="MidSideCompressor";var r=m7(n.getDefaults(),arguments);return e._midSideSplit=e.input=new une({context:e.context}),e._midSideMerge=e.output=new cne({context:e.context}),e.mid=new Ine(Object.assign(r.mid,{context:e.context})),e.side=new Ine(Object.assign(r.side,{context:e.context})),e._midSideSplit.mid.chain(e.mid,e._midSideMerge.mid),e._midSideSplit.side.chain(e.side,e._midSideMerge.side),L7(ir(e),["mid","side"]),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}}]),n}(d9),Rne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,Object.assign(m7(n.getDefaults(),arguments)))).name="MultibandCompressor";var r=m7(n.getDefaults(),arguments);return e._splitter=e.input=new Sne({context:e.context,lowFrequency:r.lowFrequency,highFrequency:r.highFrequency}),e.lowFrequency=e._splitter.lowFrequency,e.highFrequency=e._splitter.highFrequency,e.output=new g9({context:e.context}),e.low=new Ine(Object.assign(r.low,{context:e.context})),e.mid=new Ine(Object.assign(r.mid,{context:e.context})),e.high=new Ine(Object.assign(r.high,{context:e.context})),e._splitter.low.chain(e.low,e.output),e._splitter.mid.chain(e.mid,e.output),e._splitter.high.chain(e.high,e.output),L7(ir(e),["high","mid","low","highFrequency","lowFrequency"]),e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}}]),n}(d9),Dne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["low","mid","high"]))).name="EQ3",e.output=new g9({context:e.context}),e._internalChannels=[];var r=m7(n.getDefaults(),arguments,["low","mid","high"]);return e.input=e._multibandSplit=new Sne({context:e.context,highFrequency:r.highFrequency,lowFrequency:r.lowFrequency}),e._lowGain=new g9({context:e.context,gain:r.low,units:"decibels"}),e._midGain=new g9({context:e.context,gain:r.mid,units:"decibels"}),e._highGain=new g9({context:e.context,gain:r.high,units:"decibels"}),e.low=e._lowGain.gain,e.mid=e._midGain.gain,e.high=e._highGain.gain,e.Q=e._multibandSplit.Q,e.lowFrequency=e._multibandSplit.lowFrequency,e.highFrequency=e._multibandSplit.highFrequency,e._multibandSplit.low.chain(e._lowGain,e.output),e._multibandSplit.mid.chain(e._midGain,e.output),e._multibandSplit.high.chain(e._highGain,e.output),L7(ir(e),["low","mid","high","lowFrequency","highFrequency"]),e._internalChannels=[e._multibandSplit],e}return Jn(n,[{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),F7(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}}]),n}(d9),Pne=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this,m7(n.getDefaults(),arguments,["url","onload"]))).name="Convolver",e._convolver=e.context.createConvolver();var r=m7(n.getDefaults(),arguments,["url","onload"]);return e._buffer=new B7(r.url,(function(t){e.buffer=t,r.onload()})),e.input=new g9({context:e.context}),e.output=new g9({context:e.context}),e._buffer.loaded&&(e.buffer=e._buffer),e.normalize=r.normalize,e.input.chain(e._convolver,e.output),e}return Jn(n,[{key:"load",value:function(e){return s7(this,void 0,void 0,es().mark((function t(){return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,this._buffer.load(e);case 2:this.buffer=t.sent;case 3:case"end":return t.stop()}}),t,this)})))}},{key:"buffer",get:function(){return this._buffer.length?this._buffer:null},set:function(e){e&&this._buffer.set(e),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));var t=this._buffer.get();this._convolver.buffer=t||null}},{key:"normalize",get:function(){return this._convolver.normalize},set:function(e){this._convolver.normalize=e}},{key:"dispose",value:function(){return ja(nr(n.prototype),"dispose",this).call(this),this._buffer.dispose(),this._convolver.disconnect(),this}}],[{key:"getDefaults",value:function(){return Object.assign(d9.getDefaults(),{normalize:!0,onload:z7})}}]),n}(d9);function One(){return G7().now()}function Lne(){return G7().immediate()}var Fne=G7().transport;function zne(){return G7().transport}var Bne=G7().destination,Une=G7().destination;function Vne(){return G7().destination}var Wne=G7().listener;function Gne(){return G7().listener}var jne=G7().draw;function qne(){return G7().draw}var Hne=G7();function Xne(){return B7.loaded()}var Kne=B7,Yne=I9,Qne=G9;__webpack_require__(1493),Error;function Zne(e,t){return e.quantizedStartStep<t.quantizedStartStep?-1:e.quantizedStartStep>t.quantizedStartStep?1:e.pitch<t.pitch?-1:1}var Jne=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],n=arguments.length>1?arguments[1]:void 0;$n(this,e),this.playClick=t,this.callbackObject=n,this.desiredQPM=void 0}return Jn(e,[{key:"setTempo",value:function(e){this.desiredQPM=e,"started"===Fne.state&&(Fne.bpm.value=e)}},{key:"makeClickSequence",value:function(e){for(var t=_2(e),n=t.notes.map((function(e){return e.quantizedEndStep})),r=Math.max.apply(Math,Tt(n)),a=0;a<r;a+=4){var i={pitch:a%16===0?89:90,quantizedStartStep:a,isDrum:!0,quantizedEndStep:a+1};t.notes.push(i)}return t.notes.sort(Zne),t}},{key:"resumeContext",value:function(){Hne.resume()}},{key:"start",value:function(e,t){var n=this,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if("started"===this.getPlayState())throw new Error("Cannot start playback; player is already playing.");if("paused"===this.getPlayState())throw new Error("Cannot `start()` a paused player; use `resume()`.");if("stopped"!==Fne.state)throw new Error("Cannot start playback while `Tone.Transport` is in use.");this.resumeContext();var a=I2(e);if(this.playClick&&a&&(e=this.makeClickSequence(e)),t?Fne.bpm.value=t:e.tempos&&e.tempos.length>0&&e.tempos[0].qpm>0?Fne.bpm.value=e.tempos[0].qpm:Fne.bpm.value=Y1,a)e=R2(e,t);else if(t)throw new Error("Cannot specify a `qpm` for a non-quantized sequence.");var i=new ate((function(e,t){n.currentPart===i&&(n.playNote(e,t),n.callbackObject&&jne.schedule((function(){n.callbackObject.run(t,e)}),e))}),e.notes.map((function(e){return[e.startTime,e]})));return this.currentPart=i,this.desiredQPM&&(Fne.bpm.value=this.desiredQPM),this.currentPart.start(void 0,r),"started"!==Fne.state&&Fne.start(),new Promise((function(t){n.scheduledStop=Fne.schedule((function(){n.stop(),t(),n.callbackObject&&n.callbackObject.stop()}),"+".concat(e.totalTime))}))}},{key:"stop",value:function(){this.isPlaying()&&(this.currentPart.stop(),Fne.stop(),this.currentPart=null),Fne.clear(this.scheduledStop),this.scheduledStop=void 0,this.desiredQPM=void 0}},{key:"pause",value:function(){if(!this.isPlaying())throw new Error("Cannot pause playback while the player is stopped.");Fne.pause()}},{key:"resume",value:function(){if("paused"!==this.getPlayState())throw new Error('Cannot resume playback while "'.concat(this.getPlayState(),'".'));Fne.start()}},{key:"seekTo",value:function(e){if(!this.isPlaying())throw new Error("Cannot seek while the player is stopped.");Fne.seconds=e}},{key:"isPlaying",value:function(){return!!this.currentPart}},{key:"getPlayState",value:function(){return this.isPlaying()?Fne.state:"stopped"}}]),e}(),$ne=function(){function e(){var t=this;$n(this,e),this.DRUM_PITCH_TO_CLASS=new Map,this.kick=(new Gee).toDestination(),this.tomLow=new Gee({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.tomMid=new Gee({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.tomHigh=new Gee({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.closedHihat=new Wee({frequency:400,envelope:{attack:.001,decay:.1,release:.8},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toDestination(),this.openHihat=new Wee({frequency:400,envelope:{attack:.001,decay:.5,release:.8,sustain:1},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toDestination(),this.ride=(new Wee).toDestination(),this.crash=new Wee({frequency:300,envelope:{attack:.001,decay:1,release:3},harmonicity:5.1,modulationIndex:64,resonance:4e3,octaves:1.5}).toDestination(),this.snare=new jee({noise:{type:"white"},envelope:{attack:.005,decay:.05,sustain:.1,release:.4}}).toDestination(),this.loClick=new Gee({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new Gee({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.pitchPlayers=[function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.kick.triggerAttackRelease("C2","8n",e,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.snare.triggerAttackRelease("16n",e,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.closedHihat.triggerAttack(e,.3,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.openHihat.triggerAttack(e,.3,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t.tomLow.triggerAttack("G3",e,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t.tomMid.triggerAttack("C4",e,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t.tomHigh.triggerAttack("F4",e,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.crash.triggerAttack(e,1,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t.ride.triggerAttack(e,.5,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t.loClick.triggerAttack("G5",e,n)},function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5;return t.hiClick.triggerAttack("C6",e,n)}];for(var n=function(e){Q1[e].forEach((function(n){t.DRUM_PITCH_TO_CLASS.set(n,e)}))},r=0;r<Q1.length;++r)n(r);this.DRUM_PITCH_TO_CLASS.set(89,9),this.DRUM_PITCH_TO_CLASS.set(90,10)}return Jn(e,[{key:"playNote",value:function(e,t,n){this.pitchPlayers[this.DRUM_PITCH_TO_CLASS.get(e)](t,n)}}],[{key:"getInstance",value:function(){return e.instance||(e.instance=new e),e.instance}}]),e}(),ere=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.apply(this,arguments)).drumKit=$ne.getInstance(),e.bassSynth=new Ree({volume:5,oscillator:{type:"triangle"}}).toDestination(),e.polySynth=(new ete).toDestination(),e}return Jn(n,[{key:"playNote",value:function(e,t){var n=t.hasOwnProperty("velocity")?t.velocity/Z1:void 0;if(t.isDrum)this.drumKit.playNote(t.pitch,e,n);else{var r=s9(t.pitch,"midi").toFrequency(),a=t.endTime-t.startTime;this.getSynth(t.instrument,t.program).triggerAttackRelease(r,a,e,n)}}},{key:"getSynth",value:function(e,t){return void 0!==t&&t>=32&&t<=39?this.bassSynth:this.polySynth}}]),n}(Jne);ere.tone=r;var tre;__webpack_require__(6105);!function(e){e[e.PAGE=0]="PAGE",e[e.NOTE=1]="NOTE",e[e.BAR=2]="BAR"}(tre||(tre={}));var nre=function(){function e(t,n){$n(this,e),this.backend=t,this.dataMover=n,this.data=new WeakMap,this.dataIdsCount=0}return Jn(e,[{key:"get",value:function(e){return this.data.has(e)||this.dataMover.moveData(this.backend,e),this.data.get(e)}},{key:"set",value:function(e,t){this.dataIdsCount++,this.data.set(e,t)}},{key:"has",value:function(e){return this.data.has(e)}},{key:"delete",value:function(e){return this.dataIdsCount--,this.data.delete(e)}},{key:"numDataIds",value:function(){return this.dataIdsCount}}]),e}(),rre=function(){function e(){$n(this,e)}return Jn(e,[{key:"refCount",value:function(e){return are("refCount")}},{key:"incRef",value:function(e){return are("incRef")}},{key:"timerAvailable",value:function(){return!0}},{key:"time",value:function(e){return are("time")}},{key:"read",value:function(e){return are("read")}},{key:"readSync",value:function(e){return are("readSync")}},{key:"readToGPU",value:function(e,t){return are("readToGPU")}},{key:"numDataIds",value:function(){return are("numDataIds")}},{key:"disposeData",value:function(e,t){return are("disposeData")}},{key:"write",value:function(e,t,n){return are("write")}},{key:"move",value:function(e,t,n,r,a){return are("move")}},{key:"memory",value:function(){return are("memory")}},{key:"floatPrecision",value:function(){return are("floatPrecision")}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"dispose",value:function(){return are("dispose")}}]),e}();function are(e){throw new Error("'".concat(e,"' not yet implemented or not found in the registry. ")+"This kernel may not be supported by the tfjs backend you have chosen")}function ire(e){return e%2===0?e:e+1}function ore(e){for(var t=0,n=0;n<e.length;n++)t+=e[n];return t}function sre(e,t){if(!e)throw new Error("string"===typeof t?t:t())}function ure(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";sre(fre(e,t),(function(){return n+" Shapes ".concat(e," and ").concat(t," must match")}))}function cre(e){sre(null!=e,(function(){return"The input to the tensor constructor must be a non-null value."}))}function lre(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(null==t&&(t=[]),Array.isArray(e)||kre(e)&&!n)for(var r=0;r<e.length;++r)lre(e[r],t,n);else t.push(e);return t}function hre(e){if(0===e.length)return 1;for(var t=e[0],n=1;n<e.length;n++)t*=e[n];return t}function fre(e,t){if(e===t)return!0;if(null==e||null==t)return!1;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++)if(e[n]!==t[n])return!1;return!0}function dre(e){return e%1===0}function pre(e){var t=Math.ceil(Math.sqrt(e));return[t,Math.ceil(e/t)]}function vre(e,t){return t<=e.length?e:e+" ".repeat(t-e.length)}function mre(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return 0},n=arguments.length>2?arguments[2]:void 0;return new Promise((function(r,a){var i=0;!function o(){if(e())r();else{i++;var s=t(i);null!=n&&i>=n?a():setTimeout(o,s)}}()}))}function gre(e,t){var n=t.length;return e=null==e?t.map((function(e,t){return t})):[].concat(e),sre(e.every((function(e){return e>=-n&&e<n})),(function(){return"All values in axis param must be in range [-".concat(n,", ").concat(n,") but ")+"got axis ".concat(e)})),sre(e.every((function(e){return dre(e)})),(function(){return"All values in axis param must be integers but "+"got axis ".concat(e)})),e.map((function(e){return e<0?n+e:e}))}function yre(e,t){for(var n=[],r=[],a=null!=t&&Array.isArray(t)&&0===t.length,i=null==t||a?null:gre(t,e).sort(),o=0,s=0;s<e.length;++s){if(null!=i){if(i[o]===s&&1!==e[s])throw new Error("Can't squeeze axis ".concat(s," since its dim '").concat(e[s],"' is not 1"));(null==i[o]||i[o]>s)&&1===e[s]&&(n.push(e[s]),r.push(s)),i[o]<=s&&o++}1!==e[s]&&(n.push(e[s]),r.push(s))}return{newShape:n,keptDims:r}}function bre(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else{if("bool"!==e)throw new Error("Unknown data type ".concat(e));n=new Uint8Array(t)}return n}function xre(e,t){var n=null;if(null==e||"float32"===e)n=new Float32Array(t);else if("int32"===e)n=new Int32Array(t);else if("bool"===e)n=new Uint8Array(t);else{if("string"!==e)throw new Error("Unknown data type ".concat(e));n=new Array(t)}return n}function kre(e){return e instanceof Float32Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray}function wre(e){if("float32"===e||"int32"===e)return 4;if("complex64"===e)return 8;if("bool"===e)return 1;throw new Error("Unknown dtype ".concat(e))}function _re(e){return"string"===typeof e||e instanceof String}function Sre(e){return Array.isArray(e)?Sre(e[0]):e instanceof Float32Array?"float32":e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray?"int32":"number"===typeof e?"float32":_re(e)?"string":function(e){return"boolean"===typeof e}(e)?"bool":"float32"}function Cre(e){return!!(e&&e.constructor&&e.call&&e.apply)}function Tre(e,t){for(var n=t;n<e;++n)if(e%n===0)return n;return e}function Ere(e){var t=e.length;if(t<2)return[];var n=new Array(t-1);n[t-2]=e[t-1];for(var r=t-3;r>=0;--r)n[r]=n[r+1]*e[r+1];return n}function Ire(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=new Array;if(1===t.length)for(var i=t[0]*(r?2:1),o=0;o<i;o++)a[o]=n[e+o];else for(var s=t[0],u=t.slice(1),c=u.reduce((function(e,t){return e*t}))*(r?2:1),l=0;l<s;l++)a[l]=Ire(e+l*c,u,n,r);return a}function Are(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(0===e.length)return t[0];var r=e.reduce((function(e,t){return e*t}))*(n?2:1);if(0===r)return[];if(r!==t.length)throw new Error("[".concat(e,"] does not match the input size ").concat(t.length).concat(n?" for a complex tensor":"","."));return Ire(0,e,t,n)}function Mre(e,t){for(var n=Nre(e,t),r=0;r<n.length;r++)n[r]=1;return n}function Nre(e,t){if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t)return new Uint8Array(e);throw new Error("Unknown data type ".concat(t))}function Rre(e){e.forEach((function(t){sre(Number.isInteger(t)&&t>=0,(function(){return"Tensor must have a shape comprised of positive integers but got "+"shape [".concat(e,"].")}))}))}function Dre(e){return e&&e.then&&"function"===typeof e.then}var Pre="tfjsflags",Ore=function(){function e(t){$n(this,e),this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.getQueryParams=Lre,this.populateURLFlags()}return Jn(e,[{key:"setPlatform",value:function(e,t){null!=this.platform&&(zre().getBool("IS_TEST")||zre().getBool("PROD")||console.warn("Platform ".concat(this.platformName," has already been set. ")+"Overwriting the platform with ".concat(e,"."))),this.platformName=e,this.platform=t}},{key:"registerFlag",value:function(e,t,n){if(this.flagRegistry[e]={evaluationFn:t,setHook:n},null!=this.urlFlags[e]){var r=this.urlFlags[e];zre().getBool("IS_TEST")||zre().getBool("PROD")||console.warn("Setting feature override from URL ".concat(e,": ").concat(r,".")),this.set(e,r)}}},{key:"getAsync",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t in this.flags)){e.next=2;break}return e.abrupt("return",this.flags[t]);case 2:return e.next=4,this.evaluateFlag(t);case 4:return this.flags[t]=e.sent,e.abrupt("return",this.flags[t]);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"get",value:function(e){if(e in this.flags)return this.flags[e];var t=this.evaluateFlag(e);if(Dre(t))throw new Error("Flag ".concat(e," cannot be synchronously evaluated. ")+"Please use getAsync() instead.");return this.flags[e]=t,this.flags[e]}},{key:"getNumber",value:function(e){return this.get(e)}},{key:"getBool",value:function(e){return this.get(e)}},{key:"getFlags",value:function(){return this.flags}},{key:"features",get:function(){return this.flags}},{key:"set",value:function(e,t){if(null==this.flagRegistry[e])throw new Error("Cannot set flag ".concat(e," as it has not been registered."));this.flags[e]=t,null!=this.flagRegistry[e].setHook&&this.flagRegistry[e].setHook(t)}},{key:"evaluateFlag",value:function(e){if(null==this.flagRegistry[e])throw new Error("Cannot evaluate flag '".concat(e,"': no evaluation function found."));return this.flagRegistry[e].evaluationFn()}},{key:"setFlags",value:function(e){this.flags=Object.assign({},e)}},{key:"reset",value:function(){this.flags={},this.urlFlags={},this.populateURLFlags()}},{key:"populateURLFlags",value:function(){var e=this;if("undefined"!==typeof this.global&&"undefined"!==typeof this.global.location&&"undefined"!==typeof this.global.location.search){var t=this.getQueryParams(this.global.location.search);if(Pre in t)t.tfjsflags.split(",").forEach((function(t){var n=f(t.split(":"),2),r=n[0],a=n[1];e.urlFlags[r]=function(e,t){if("true"===(t=t.toLowerCase())||"false"===t)return"true"===t;if("".concat(+t)===t)return+t;throw new Error("Could not parse value flag value ".concat(t," for flag ").concat(e,"."))}(r,a)}))}}}]),e}();function Lre(e){var t={};return e.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,(function(e){for(var n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];return Fre(t,r[0],r[1]),r.join("=")})),t}function Fre(e,t,n){e[decodeURIComponent(t)]=decodeURIComponent(n||"")}function zre(){return Ure}var Bre,Ure=null;function Vre(){if(null==Bre){var e;if("undefined"!==typeof window)e=window;else if("undefined"!==typeof __webpack_require__.g)e=__webpack_require__.g;else if("undefined"!==typeof process)e=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");e=self}Bre=e}return Bre}function Wre(e,t){var n=function(){var e=Vre();return null==e._tfGlobals&&(e._tfGlobals=new Map),e._tfGlobals}();if(n.has(e))return n.get(e);var r=t();return n.set(e,r),n.get(e)}var Gre="Add",jre="BatchMatMul",qre="Bincount",Hre="Cast",Xre="Complex",Kre="ComplexAbs",Yre="Concat",Qre="CropAndResize",Zre="RealDiv",Jre="ExpandDims",$re="Fill",eae="FlipLeftRight",tae="FloorDiv",nae="Greater",rae="GreaterEqual",aae="Identity",iae="IFFT",oae="Imag",sae="LeakyRelu",uae="LessEqual",cae="Log1p",lae="LogicalAnd",hae="Max",fae="Mean",dae="Min",pae="Minimum",vae="Multiply",mae="NotEqual",gae="NonMaxSuppressionV3",yae="NonMaxSuppressionV4",bae="NonMaxSuppressionV5",xae="Pack",kae="Prelu",wae="Range",_ae="Real",Sae="Relu",Cae="Reshape",Tae="ResizeNearestNeighbor",Eae="ResizeBilinear",Iae="Relu6",Aae="Reverse",Mae="Round",Nae="Select",Rae="Slice",Dae="Sigmoid",Pae="Sqrt",Oae="Sum",Lae="SplitV",Fae="SquaredDifference",zae="StringSplit",Bae="Tile",Uae="Transform",Vae="Transpose",Wae="Unpack",Gae="ZerosLike",jae="Step",qae="RotateWithOffset";function Hae(){var e;zre().getBool("IS_TEST")||zre().getBool("PROD")||(e=console).warn.apply(e,arguments)}var Xae=Wre("kernelRegistry",(function(){return new Map})),Kae=Wre("gradRegistry",(function(){return new Map}));function Yae(e,t){var n=$ae(e,t);return Xae.get(n)}function Qae(e){return Kae.get(e)}function Zae(e){for(var t=Xae.entries(),n=[];;){var r=t.next(),a=r.done,i=r.value;if(a)break;var o=f(i,2),s=o[0],u=o[1];f(s.split("_"),1)[0]===e&&n.push(u)}return n}function Jae(e){var t=e.kernelName,n=e.backendName,r=$ae(t,n);Xae.has(r)&&Hae("The kernel '".concat(t,"' for backend ")+"'".concat(n,"' is already registered")),Xae.set(r,e)}function $ae(e,t){return"".concat(t,"_").concat(e)}var eie=__webpack_require__(8987),tie=__webpack_require__.n(eie)()||eie;function nie(e){return tie.fromString(e,!0,16)}nie("c3a5c85c97cb3127"),nie("b492b66fbe98f273"),nie("9ae16a3b2f90404f");function rie(e,t){return"string"===t?oie(e):aie([e],t)}function aie(e,t){if("string"===t)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(e)&&(e=lre(e)),zre().getBool("DEBUG")&&function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(isNaN(r)||!isFinite(r))throw Error("A tensor of type ".concat(t," being uploaded contains ").concat(r,"."))}}(e,t),function(e,t){return e instanceof Float32Array&&"float32"===t||e instanceof Int32Array&&"int32"===t||e instanceof Uint8Array&&"bool"===t}(e,t))return e;if(null==t||"float32"===t||"complex64"===t)return new Float32Array(e);if("int32"===t)return new Int32Array(e);if("bool"===t){for(var n=new Uint8Array(e.length),r=0;r<n.length;++r)0!==Math.round(e[r])&&(n[r]=1);return n}throw new Error("Unknown data type ".concat(t))}function iie(){return zre().platform.now()}function oie(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",zre().platform.encode(e,t)}function sie(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"utf-8";return t=t||"utf-8",zre().platform.decode(e,t)}var uie=function(){function e(t,n){$n(this,e),this.backendTimer=t,this.logger=n,null==n&&(this.logger=new cie)}return Jn(e,[{key:"profileKernel",value:function(e,t,n){var r,a,i=function(){r=n()},o=iie();if(this.backendTimer.timerAvailable())a=this.backendTimer.time(i);else{i();var s,u=al(r);try{for(u.s();!(s=u.n()).done;){s.value.dataSync()}}catch($Pe){u.e($Pe)}finally{u.f()}a=Promise.resolve({kernelMs:iie()-o})}if(zre().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(var c=function(t){var n=r[t];n.data().then((function(t){!function(e,t,n){if("float32"!==t)return!1;for(var r=0;r<e.length;r++){var a=e[r];if(isNaN(a)||!isFinite(a))return console.warn("Found ".concat(a," in the result of '").concat(n,"'")),!0}}(t,n.dtype,e)}))},l=0;l<r.length;l++)c(l);return{kernelName:e,outputs:r,inputs:t,timeMs:a.then((function(e){return e.kernelMs})),extraInfo:a.then((function(e){return null!=e.getExtraProfileInfo?e.getExtraProfileInfo():""}))}}},{key:"logKernelProfile",value:function(e){var t=this,n=e.kernelName,r=e.outputs,a=e.timeMs,i=e.inputs,o=e.extraInfo;r.forEach((function(e){Promise.all([e.data(),a,o]).then((function(r){t.logger.logKernelProfile(n,e,r[0],r[1],i,r[2])}))}))}}]),e}();var cie=function(){function e(){$n(this,e)}return Jn(e,[{key:"logKernelProfile",value:function(e,t,n,r,a,i){var o="number"===typeof r?vre("".concat(r,"ms"),9):r.error,s=vre(e,25),u=t.rank,c=t.size,l=vre(t.shape.toString(),14),h="";for(var f in a){var d=a[f];if(null!=d){var p=d.shape||t.shape,v=p.length;h+="".concat(f,": ").concat(v,"D ").concat(v>0?p:""," ")}}console.log("%c".concat(s,"\t%c").concat(o,"\t%c").concat(u,"D ").concat(l,"\t%c").concat(c,"\t%c").concat(h,"\t%c").concat(i),"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}]),e}();function lie(e,t,n){for(var r={},a={},i=0;i<t.length;i++)r[t[i].id]=!0;for(var o=0;o<e.length;o++){var s=e[o],u=s.inputs;for(var c in u){for(var l=u[c],h=!1,f=0;f<t.length;f++)if(r[l.id]){s.outputs.forEach((function(e){return r[e.id]=!0})),h=!0,a[s.id]=!0;break}if(h)break}}var d={};d[n.id]=!0;for(var p={},v=e.length-1;v>=0;v--)for(var m=e[v],g=m.inputs,y=0;y<m.outputs.length;y++)if(d[m.outputs[y].id]){for(var b in g)d[g[b].id]=!0,p[m.id]=!0;break}for(var x=[],k=0;k<e.length;k++){var w=e[k];if(a[w.id]&&p[w.id]){var _={};for(var S in w.inputs){var C=w.inputs[S];r[C.id]&&(_[S]=C)}var T=Object.assign({},w);T.inputs=_,T.outputs=w.outputs,x.push(T)}}return x}function hie(e,t,n,r){for(var a=function(a){var i=t[a],o=[];if(i.outputs.forEach((function(t){var n=e[t.id];null!=n?o.push(n):o.push(null)})),null==i.gradient)throw new Error("Cannot compute gradient: gradient function not found "+"for ".concat(i.kernelName,"."));var s=i.gradient(o),u=function(t){if(!(t in s))throw new Error("Cannot backprop through input ".concat(t,". ")+"Available gradients found: ".concat(Object.keys(s),"."));var a=n((function(){return s[t]()}));if("float32"!==a.dtype)throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"".concat(t," must have 'float32' dtype, but has '").concat(a.dtype,"'"));var o=i.inputs[t];if(!fre(a.shape,o.shape))throw new Error("Error in gradient for op ".concat(i.kernelName,". The gradient of input ")+"'".concat(t,"' has shape '").concat(a.shape,"', which does not match ")+"the shape of the input '".concat(o.shape,"'"));if(null==e[o.id])e[o.id]=a;else{var u=e[o.id];e[o.id]=r(u,a),u.dispose()}};for(var c in i.inputs)u(c)},i=t.length-1;i>=0;i--)a(i)}function fie(e,t,n,r){var a=Ere(t),i=function(e,t,n,r){var a=hre(t),i=r[r.length-1],o=new Array(i).fill(0),s=t.length,u="complex64"===n?mie(e):e;if(s>1)for(var c=0;c<a/i;c++)for(var l=c*i,h=0;h<i;h++)o[h]=Math.max(o[h],die(u[l+h],0,n).length);return o}(e,t,n,a),o=t.length,s=vie(e,t,n,a,i),u=["Tensor"];return r&&(u.push("  dtype: ".concat(n)),u.push("  rank: ".concat(o)),u.push("  shape: [".concat(t,"]")),u.push("  values:")),u.push(s.map((function(e){return"    "+e})).join("\n")),u.join("\n")}function die(e,t,n){return vre(Array.isArray(e)?"".concat(parseFloat(e[0].toFixed(7))," + ")+"".concat(parseFloat(e[1].toFixed(7)),"j"):_re(e)?"'".concat(e,"'"):"bool"===n?pie(e):parseFloat(e.toFixed(7)).toString(),t)}function pie(e){return 0===e?"false":"true"}function vie(e,t,n,r,a){var i=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],o="complex64"===n?2:1,s=t[0],u=t.length;if(0===u){if("complex64"===n){var c=mie(e);return[die(c[0],0,n)]}return"bool"===n?[pie(e[0])]:[e[0].toString()]}if(1===u){if(s>20){var l=3*o,h=Array.from(e.slice(0,l)),f=Array.from(e.slice((s-3)*o,s*o));return"complex64"===n&&(h=mie(h),f=mie(f)),["["+h.map((function(e,t){return die(e,a[t],n)})).join(", ")+", ..., "+f.map((function(e,t){return die(e,a[s-3+t],n)})).join(", ")+"]"]}var d="complex64"===n?mie(e):Array.from(e);return["["+d.map((function(e,t){return die(e,a[t],n)})).join(", ")+"]"]}var p=t.slice(1),v=r.slice(1),m=r[0]*o,g=[];if(s>20){for(var y=0;y<3;y++){var b=y*m,x=b+m;g.push.apply(g,Tt(vie(e.slice(b,x),p,n,v,a,!1)))}g.push("...");for(var k=s-3;k<s;k++){var w=k*m,_=w+m;g.push.apply(g,Tt(vie(e.slice(w,_),p,n,v,a,k===s-1)))}}else for(var S=0;S<s;S++){var C=S*m,T=C+m;g.push.apply(g,Tt(vie(e.slice(C,T),p,n,v,a,S===s-1)))}var E=2===u?",":"";g[0]="["+g[0]+E;for(var I=1;I<g.length-1;I++)g[I]=" "+g[I]+E;for(var A=",\n",M=2;M<u;M++)A+="\n";return g[g.length-1]=" "+g[g.length-1]+"]"+(i?"":A),g}function mie(e){for(var t=[],n=0;n<e.length;n+=2)t.push([e[n],e[n+1]]);return t}var gie=function(){function e(t,n,r){var a=this;if($n(this,e),this.dtype=n,this.shape=t.slice(),this.size=hre(t),null!=r){var i=r.length;sre(i===this.size,(function(){return"Length of values '".concat(i,"' does not match the size ")+"inferred by the shape '".concat(a.size,"'.")}))}if("complex64"===n)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=r||xre(n,this.size),this.strides=Ere(t)}return Jn(e,[{key:"set",value:function(e){for(var t=this,n=arguments.length,r=new Array(n>1?n-1:0),a=1;a<n;a++)r[a-1]=arguments[a];0===r.length&&(r=[0]),sre(r.length===this.rank,(function(){return"The number of provided coordinates (".concat(r.length,") must ")+"match the rank (".concat(t.rank,")")}));var i=this.locToIndex(r);this.values[i]=e}},{key:"get",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];0===t.length&&(t=[0]);for(var r=0,a=0,i=t;a<i.length;a++){var o=i[a];if(o<0||o>=this.shape[r]){var s="Requested out of range element at ".concat(t,". ")+"  Buffer shape=".concat(this.shape);throw new Error(s)}r++}for(var u=t[t.length-1],c=0;c<t.length-1;++c)u+=this.strides[c]*t[c];return this.values[u]}},{key:"locToIndex",value:function(e){if(0===this.rank)return 0;if(1===this.rank)return e[0];for(var t=e[e.length-1],n=0;n<e.length-1;++n)t+=this.strides[n]*e[n];return t}},{key:"indexToLoc",value:function(e){if(0===this.rank)return[];if(1===this.rank)return[e];for(var t=new Array(this.shape.length),n=0;n<t.length-1;++n)t[n]=Math.floor(e/this.strides[n]),e-=t[n]*this.strides[n];return t[t.length-1]=e,t}},{key:"rank",get:function(){return this.shape.length}},{key:"toTensor",value:function(){return yie().makeTensor(this.values,this.shape,this.dtype)}}]),e}(),yie=null,bie=null;var xie=function(){function e(t,n,r,a){$n(this,e),this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=n||"float32",this.size=hre(t),this.strides=Ere(t),this.dataId=r,this.id=a,this.rankType=this.rank<5?this.rank.toString():"higher"}return Jn(e,[{key:"rank",get:function(){return this.shape.length}},{key:"buffer",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",bie.buffer(this.shape,this.dtype,t));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(){return bie.buffer(this.shape,this.dtype,this.dataSync())}},{key:"array",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.data();case 2:return t=e.sent,e.abrupt("return",Are(this.shape,t,"complex64"===this.dtype));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"arraySync",value:function(){return Are(this.shape,this.dataSync(),"complex64"===this.dtype)}},{key:"data",value:function(){var e=ns(es().mark((function e(){var t,n;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.throwIfDisposed(),t=yie().read(this.dataId),"string"!==this.dtype){e.next=13;break}return e.next=5,t;case 5:return n=e.sent,e.prev=6,e.abrupt("return",n.map((function(e){return sie(e)})));case 10:throw e.prev=10,e.t0=e.catch(6),new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().");case 13:return e.abrupt("return",t);case 14:case"end":return e.stop()}}),e,this,[[6,10]])})));return function(){return e.apply(this,arguments)}}()},{key:"dataToGPU",value:function(e){return this.throwIfDisposed(),yie().readToGPU(this.dataId,e)}},{key:"dataSync",value:function(){this.throwIfDisposed();var e=yie().readSync(this.dataId);if("string"===this.dtype)try{return e.map((function(e){return sie(e)}))}catch(t){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return e}},{key:"bytes",value:function(){var e=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.throwIfDisposed(),e.next=3,yie().read(this.dataId);case 3:if(t=e.sent,"string"!==this.dtype){e.next=8;break}return e.abrupt("return",t);case 8:return e.abrupt("return",new Uint8Array(t.buffer));case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"dispose",value:function(){this.isDisposed||(yie().disposeTensor(this),this.isDisposedInternal=!0)}},{key:"isDisposed",get:function(){return this.isDisposedInternal}},{key:"throwIfDisposed",value:function(){if(this.isDisposed)throw new Error("Tensor is disposed.")}},{key:"print",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return bie.print(this,e)}},{key:"clone",value:function(){return this.throwIfDisposed(),bie.clone(this)}},{key:"toString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.dataSync();return fie(t,this.shape,this.dtype,e)}},{key:"cast",value:function(e){return this.throwIfDisposed(),bie.cast(this,e)}},{key:"variable",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=arguments.length>1?arguments[1]:void 0,n=arguments.length>2?arguments[2]:void 0;return this.throwIfDisposed(),yie().makeVariable(this,e,t,n)}}]),e}();Object.defineProperty(xie,Symbol.hasInstance,{value:function(e){return!!e&&null!=e.data&&null!=e.dataSync&&null!=e.throwIfDisposed}}),Wre("Tensor",(function(){return xie}));var kie,wie,_ie,Sie,Cie,Tie=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i){var o;return $n(this,n),(o=t.call(this,e.shape,e.dtype,e.dataId,i)).trainable=r,o.name=a,o}return Jn(n,[{key:"assign",value:function(e){if(e.dtype!==this.dtype)throw new Error("dtype of the new value (".concat(e.dtype,") and ")+"previous value (".concat(this.dtype,") must match"));if(!fre(e.shape,this.shape))throw new Error("shape of the new value (".concat(e.shape,") and ")+"previous value (".concat(this.shape,") must match"));yie().disposeTensor(this),this.dataId=e.dataId,yie().incRef(this,null)}},{key:"dispose",value:function(){yie().disposeVariable(this),this.isDisposedInternal=!0}}]),n}(xie);Object.defineProperty(Tie,Symbol.hasInstance,{value:function(e){return e instanceof xie&&null!=e.assign&&e.assign instanceof Function}}),function(e){e.R0="R0",e.R1="R1",e.R2="R2",e.R3="R3",e.R4="R4",e.R5="R5",e.R6="R6"}(kie||(kie={})),function(e){e.float32="float32",e.int32="int32",e.bool="int32",e.complex64="complex64"}(wie||(wie={})),function(e){e.float32="float32",e.int32="int32",e.bool="bool",e.complex64="complex64"}(_ie||(_ie={})),function(e){e.float32="float32",e.int32="float32",e.bool="float32",e.complex64="complex64"}(Sie||(Sie={})),function(e){e.float32="complex64",e.int32="complex64",e.bool="complex64",e.complex64="complex64"}(Cie||(Cie={}));var Eie={float32:Sie,int32:wie,bool:_ie,complex64:Cie};function Iie(e,t){if("string"===e||"string"===t){if("string"===e&&"string"===t)return"string";throw new Error("Can not upcast ".concat(e," with ").concat(t))}return Eie[e][t]}function Aie(e){return Iie(e,"int32")}function Mie(e,t){if(e.dtype===t.dtype)return[e,t];var n=Iie(e.dtype,t.dtype);return[e.cast(n),t.cast(n)]}function Nie(e){var t=[];return Rie(e,t,new Set),t}function Rie(e,t,n){if(null!=e)if(e instanceof xie)t.push(e);else if(r=e,Array.isArray(r)||"object"===typeof r){var r,a=e;for(var i in a){var o=a[i];n.has(o)||(n.add(o),Rie(o,t,n))}}}function Die(e){return null!=e.kernelName}var Pie=function(){function e(){$n(this,e),this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((function(e){return e.name}))))}}}return Jn(e,[{key:"dispose",value:function(){for(var e in this.registeredVariables)this.registeredVariables[e].dispose()}}]),e}(),Oie=function(){function e(t){$n(this,e),this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new Pie}return Jn(e,[{key:"ready",value:function(){var e=ns(es().mark((function e(){var t,n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==this.pendingBackendInit){e.next=2;break}return e.abrupt("return",this.pendingBackendInit.then((function(){})));case 2:if(null==this.backendInstance){e.next=4;break}return e.abrupt("return");case 4:t=this.getSortedBackends(),n=0;case 6:if(!(n<t.length)){e.next=18;break}return r=t[n],e.next=10,this.initializeBackend(r).success;case 10:if(!e.sent){e.next=15;break}return e.next=14,this.setBackend(r);case 14:return e.abrupt("return");case 15:n++,e.next=6;break;case 18:throw new Error("Could not initialize any backends, all backend initializations failed.");case 19:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"backend",get:function(){if(null!=this.pendingBackendInit)throw new Error("Backend '".concat(this.backendName,"' has not yet been initialized. Make ")+"sure to await tf.ready() or await tf.setBackend() before calling other methods");if(null==this.backendInstance){var e=this.initializeBackendsAndReturnBest(),t=e.name;if(e.asyncInit)throw new Error("The highest priority backend '".concat(t,"' has not yet been ")+"initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods");this.setBackend(t)}return this.backendInstance}},{key:"backendNames",value:function(){return Object.keys(this.registryFactory)}},{key:"findBackend",value:function(e){if(!(e in this.registry)){if(!(e in this.registryFactory))return null;if(this.initializeBackend(e).asyncInit)return null}return this.registry[e]}},{key:"findBackendFactory",value:function(e){return e in this.registryFactory?this.registryFactory[e].factory:null}},{key:"registerBackend",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return e in this.registryFactory?(Hae("".concat(e," backend was already registered. ")+"Reusing existing backend factory."),!1):(this.registryFactory[e]={factory:t,priority:n},!0)}},{key:"setBackend",value:function(){var e=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this.registryFactory[t]){e.next=2;break}throw new Error("Backend name '".concat(t,"' not found in registry"));case 2:if(this.backendName=t,null!=this.registry[t]){e.next=16;break}if(this.backendInstance=null,n=this.initializeBackend(t),r=n.success,!n.asyncInit){e.next=12;break}return e.next=9,r;case 9:e.t0=e.sent,e.next=13;break;case 12:e.t0=r;case 13:if(e.t0){e.next=16;break}return e.abrupt("return",!1);case 16:return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new uie(this.backendInstance),e.abrupt("return",!0);case 20:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"setupRegisteredKernels",value:function(){var e=this;Zae(this.backendName).forEach((function(t){null!=t.setupFunc&&t.setupFunc(e.backendInstance)}))}},{key:"disposeRegisteredKernels",value:function(e){var t=this;Zae(e).forEach((function(n){null!=n.disposeFunc&&n.disposeFunc(t.registry[e])}))}},{key:"initializeBackend",value:function(e){var t=this,n=this.registryFactory[e];if(null==n)throw new Error("Cannot initialize backend ".concat(e,", no registration found."));try{var r=n.factory();if(!r||r instanceof rre||"function"!==typeof r.then)return this.registry[e]=r,{success:!0,asyncInit:!1};var a=++this.pendingBackendInitId,i=r.then((function(n){return!(a<t.pendingBackendInitId)&&(t.registry[e]=n,t.pendingBackendInit=null,!0)})).catch((function(n){return a<t.pendingBackendInitId||(t.pendingBackendInit=null,Hae("Initialization of backend ".concat(e," failed")),Hae(n.stack||n.message)),!1}));return this.pendingBackendInit=i,{success:i,asyncInit:!0}}catch($Pe){return Hae("Initialization of backend ".concat(e," failed")),Hae($Pe.stack||$Pe.message),{success:!1,asyncInit:!1}}}},{key:"removeBackend",value:function(e){if(!(e in this.registryFactory))throw new Error("".concat(e," backend not found in registry"));this.backendName===e&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,e in this.registry&&(this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e]),delete this.registryFactory[e],this.backendName===e&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}},{key:"getSortedBackends",value:function(){var e=this;if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort((function(t,n){return e.registryFactory[n].priority-e.registryFactory[t].priority}))}},{key:"initializeBackendsAndReturnBest",value:function(){for(var e=this.getSortedBackends(),t=0;t<e.length;t++){var n=e[t],r=this.initializeBackend(n),a=r.success,i=r.asyncInit;if(i||a)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}},{key:"moveData",value:function(e,t){var n=this.state.tensorInfo.get(t),r=n.backend,a=this.readSync(t),i=r.refCount(t);r.disposeData(t,!0),n.backend=e,e.move(t,a,n.shape,n.dtype,i),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}},{key:"tidy",value:function(e,t){var n,r=this,a=null;if(null==t){if("function"!==typeof e)throw new Error("Please provide a function to tidy()");t=e}else{if("string"!==typeof e&&!(e instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof t)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");a=e}return this.scopedRun((function(){return r.startScope(a)}),(function(){return r.endScope(n)}),(function(){return(n=t())instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n}))}},{key:"scopedRun",value:function(e,t,n){e();try{var r=n();return t(),r}catch(a){throw t(),a}}},{key:"nextTensorId",value:function(){return e.nextTensorId++}},{key:"nextVariableId",value:function(){return e.nextVariableId++}},{key:"clone",value:function(e){var t=Bie.runKernel(aae,{x:e}),n={x:e};return this.addTapeNode(this.state.activeScope.name,n,[t],(function(e){return{x:function(){var t={x:e},n={dtype:"float32"};return Bie.runKernel(Hre,t,n)}}}),[],{}),t}},{key:"runKernel",value:function(e,t,n){if(null==this.backendName&&this.backend,!(null!=Yae(e,this.backendName)))throw new Error("Kernel '".concat(e,"' not registered for backend '").concat(this.backendName,"'"));return this.runKernelFunc({kernelName:e,inputs:t,attrs:n})}},{key:"shouldCheckForMemLeaks",value:function(){return this.ENV.getBool("IS_TEST")}},{key:"checkKernelForMemLeak",value:function(e,t,n){var r=this.backend.numDataIds(),a=0;n.forEach((function(e){a+="complex64"===e.dtype?3:1}));var i=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=r-t-a-i;if(o>0)throw new Error("Backend '".concat(this.backendName,"' has an internal memory leak ")+"(".concat(o," data ids) after running '").concat(e,"'"))}},{key:"runKernelFunc",value:function(e){var t,n,r,a=this,i=[],o=this.isTapeOn(),s=this.state.numBytes,u=this.state.numTensors;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;var c=Die(e)?e.kernelName:null!=this.state.activeScope?this.state.activeScope.name:"";if(Die(e)){var l=e.kernelName,h=e.inputs,f=e.attrs;null==this.backendName&&this.backend;var d=Yae(l,this.backendName);sre(null!=d,(function(){return"Cannot find registered kernel '".concat(l,"' for backend '").concat(a.backendName,"'")})),n=function(){var e=a.backend.numDataIds();r=d.kernelFunc({inputs:h,attrs:f,backend:a.backend});var t=Array.isArray(r)?r:[r];a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(l,e,t);var n=t.map((function(e){return null!=e.rank?e:a.makeTensorFromTensorInfo(e)}));if(o){var s=a.getTensorsForGradient(l,h,n);i=a.saveTensorsForBackwardMode(s)}return n}}else{var p=e.forwardFunc,v=function(e){o&&(i=e.map((function(e){return a.keep(a.clone(e))})))};n=function(){var e=a.backend.numDataIds();r=a.tidy((function(){return p(a.backend,v)}));var t=Array.isArray(r)?r:[r];return a.shouldCheckForMemLeaks()&&a.checkKernelForMemLeak(c,e,t),t}}var m,g=e.inputs,y=e.attrs,b=Die(e)?null:e.backwardsFunc;return this.scopedRun((function(){return a.state.kernelDepth++}),(function(){return a.state.kernelDepth--}),(function(){a.ENV.getBool("DEBUG")||a.state.profiling?(m=a.profiler.profileKernel(c,g,(function(){return n()})),a.ENV.getBool("DEBUG")&&a.profiler.logKernelProfile(m),t=m.outputs):t=n()})),o&&this.addTapeNode(c,g,t,b,i,y),this.state.profiling&&this.state.activeProfile.kernels.push({name:c,bytesAdded:this.state.numBytes-s,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-u,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(g).map((function(e){return null!=g[e]?g[e].shape:null})),outputShapes:t.map((function(e){return e.shape})),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(r)?t:t[0]}},{key:"saveTensorsForBackwardMode",value:function(e){var t=this;return e.map((function(e){return t.keep(t.clone(e))}))}},{key:"getTensorsForGradient",value:function(e,t,n){var r=Qae(e);if(null!=r){var a,i=r.inputsToSave||[],o=r.outputsToSave||[];r.saveAllInputs?(sre(Array.isArray(t),(function(){return"saveAllInputs is true, expected inputs to be an array."})),a=Object.keys(t).map((function(e){return t[e]}))):a=i.map((function(e){return t[e]}));var s=n.filter((function(e,t){return o[t]}));return a.concat(s)}return[]}},{key:"makeTensor",value:function(e,t,n,r){if(null==e)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",r=r||this.backend;var a=e;"string"===n&&_re(e[0])&&(a=e.map((function(e){return oie(e)})));var i=r.write(a,t,n),o=new xie(t,n,i,this.nextTensorId());if(this.trackTensor(o,r),"string"===n){var s=this.state.tensorInfo.get(i),u=function(e){if(null==e)return 0;var t=0;return e.forEach((function(e){return t+=e.length})),t}(a);this.state.numBytes+=u-s.bytes,s.bytes=u}return o}},{key:"makeTensorFromDataId",value:function(e,t,n,r){var a={dataId:e,shape:t,dtype:n=n||"float32"};return this.makeTensorFromTensorInfo(a,r)}},{key:"makeTensorFromTensorInfo",value:function(e,t){var n=e.dataId,r=e.shape,a=e.dtype,i=new xie(r,a,n,this.nextTensorId());return this.trackTensor(i,t),i}},{key:"makeVariable",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=arguments.length>3?arguments[3]:void 0;n=n||this.nextVariableId().toString(),null!=r&&r!==e.dtype&&(e=e.cast(r));var a=new Tie(e,t,n,this.nextTensorId());if(null!=this.state.registeredVariables[a.name])throw new Error("Variable with name ".concat(a.name," was already registered"));return this.state.registeredVariables[a.name]=a,this.incRef(a,this.backend),a}},{key:"trackTensor",value:function(e,t){this.state.numTensors++,"string"===e.dtype&&this.state.numStringTensors++;var n=0;"complex64"!==e.dtype&&"string"!==e.dtype&&(n=e.size*wre(e.dtype)),this.state.numBytes+=n,this.state.tensorInfo.has(e.dataId)||(this.state.numDataBuffers++,this.state.tensorInfo.set(e.dataId,{backend:t||this.backend,dtype:e.dtype,shape:e.shape,bytes:n})),e instanceof Tie||this.track(e)}},{key:"incRef",value:function(e,t){this.trackTensor(e,t),this.backend.incRef(e.dataId)}},{key:"removeDataId",value:function(e,t){this.state.tensorInfo.has(e)&&this.state.tensorInfo.get(e).backend===t&&(this.state.tensorInfo.delete(e),this.state.numDataBuffers--)}},{key:"disposeTensor",value:function(e){if(this.state.tensorInfo.has(e.dataId)){var t=this.state.tensorInfo.get(e.dataId);if(this.state.numTensors--,"string"===e.dtype&&(this.state.numStringTensors--,this.state.numBytes-=t.bytes),"complex64"!==e.dtype&&"string"!==e.dtype){var n=e.size*wre(e.dtype);this.state.numBytes-=n}t.backend.disposeData(e.dataId)&&this.removeDataId(e.dataId,t.backend)}}},{key:"disposeVariables",value:function(){for(var e in this.state.registeredVariables){var t=this.state.registeredVariables[e];this.disposeVariable(t)}}},{key:"disposeVariable",value:function(e){this.disposeTensor(e),null!=this.state.registeredVariables[e.name]&&delete this.state.registeredVariables[e.name]}},{key:"memory",value:function(){var e=this.backend.memory();return e.numTensors=this.state.numTensors,e.numDataBuffers=this.state.numDataBuffers,e.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(e.unreliable=!0,null==e.reasons&&(e.reasons=[]),e.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),e}},{key:"profile",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.state.profiling=!0,n=this.state.numBytes,r=this.state.numTensors,this.state.activeProfile.kernels=[],e.next=6,t();case 6:this.state.activeProfile.result=e.sent,this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max.apply(Math,Tt(this.state.activeProfile.kernels.map((function(e){return e.totalBytesSnapshot})))),this.state.activeProfile.newBytes=this.state.numBytes-n,this.state.activeProfile.newTensors=this.state.numTensors-r,a=al(this.state.activeProfile.kernels),e.prev=12,a.s();case 14:if((i=a.n()).done){e.next=24;break}return o=i.value,e.next=18,o.kernelTimeMs;case 18:return o.kernelTimeMs=e.sent,e.next=21,o.extraInfo;case 21:o.extraInfo=e.sent;case 22:e.next=14;break;case 24:e.next=29;break;case 26:e.prev=26,e.t0=e.catch(12),a.e(e.t0);case 29:return e.prev=29,a.f(),e.finish(29);case 32:return e.abrupt("return",this.state.activeProfile);case 33:case"end":return e.stop()}}),e,this,[[12,26,29,32]])})));return function(t){return e.apply(this,arguments)}}()},{key:"isTapeOn",value:function(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}},{key:"addTapeNode",value:function(e,t,n,r,a,i){var o=this,s={id:this.state.nextTapeNodeId++,kernelName:e,inputs:t,outputs:n,saved:a},u=Qae(e);null!=u&&(r=u.gradFunc),null!=r&&(s.gradient=function(e){return e=e.map((function(e,t){if(null==e){var r=n[t],a=Nre(r.size,r.dtype);return o.makeTensor(a,r.shape,r.dtype)}return e})),r(e.length>1?e:e[0],a,i)}),this.state.activeTape.push(s)}},{key:"keep",value:function(e){return e.kept=!0,e}},{key:"startTape",value:function(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}},{key:"endTape",value:function(){this.state.gradientDepth--}},{key:"startScope",value:function(e){var t={track:[],name:"unnamed scope",id:this.state.nextScopeId++};e&&(t.name=e),this.state.scopeStack.push(t),this.state.activeScope=t}},{key:"endScope",value:function(e){for(var t=this,n=Nie(e),r=new Set(n.map((function(e){return e.id}))),a=0;a<this.state.activeScope.track.length;a++){var i=this.state.activeScope.track[a];i.kept||r.has(i.id)||i.dispose()}var o=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],n.forEach((function(e){e.kept||e.scopeId!==o.id||t.track(e)}))}},{key:"gradients",value:function(e,t,n){var r=this,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(sre(t.length>0,(function(){return"gradients() received an empty list of xs."})),null!=n&&"float32"!==n.dtype)throw new Error("dy must have 'float32' dtype, but has '".concat(n.dtype,"'"));var i=this.scopedRun((function(){return r.startTape()}),(function(){return r.endTape()}),(function(){return r.tidy("forward",e)}));sre(i instanceof xie,(function(){return"The result y returned by f() must be a tensor."}));var o=lie(this.state.activeTape,t,i);if(!a&&0===o.length&&t.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(function(){var e={};e[i.id]=null==n?Lie(i.shape):n,hie(e,o,(function(e){return r.tidy(e)}),Uie);var a=t.map((function(t){return e[t.id]}));return 0===r.state.gradientDepth&&(r.state.activeTape.forEach((function(e){var t,n=al(e.saved);try{for(n.s();!(t=n.n()).done;){t.value.dispose()}}catch($Pe){n.e($Pe)}finally{n.f()}})),r.state.activeTape=null),{value:i,grads:a}}))}},{key:"customGrad",value:function(e){var t=this;return sre(Cre(e),(function(){return"The f passed in customGrad(f) must be a function."})),function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];var i;sre(r.every((function(e){return e instanceof xie})),(function(){return"The args passed in customGrad(f)(x1, x2,...) must all be tensors"}));var o={};r.forEach((function(e,t){o[t]=e}));var s=function(t,n){return sre((i=e.apply(void 0,[].concat(r,[n]))).value instanceof xie,(function(){return"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor"})),sre(Cre(i.gradFunc),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function."})),i.value},u=function(e,t){var n=i.gradFunc(e,t),a=Array.isArray(n)?n:[n];sre(a.length===r.length,(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...)."})),sre(a.every((function(e){return e instanceof xie})),(function(){return"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."}));var o={};return a.forEach((function(e,t){o[t]=function(){return e}})),o};return t.runKernelFunc({forwardFunc:s,backwardsFunc:u,inputs:o})}}},{key:"readSync",value:function(e){return this.state.tensorInfo.get(e).backend.readSync(e)}},{key:"read",value:function(e){return this.state.tensorInfo.get(e).backend.read(e)}},{key:"readToGPU",value:function(e,t){return this.state.tensorInfo.get(e).backend.readToGPU(e,t)}},{key:"time",value:function(){var e=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=iie(),e.next=3,this.backend.time(t);case 3:return(r=e.sent).wallMs=iie()-n,e.abrupt("return",r);case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"track",value:function(e){return null!=this.state.activeScope&&(e.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(e)),e}},{key:"registeredVariables",get:function(){return this.state.registeredVariables}},{key:"reset",value:function(){for(var e in this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new Pie,this.registry)this.disposeRegisteredKernels(e),this.registry[e].dispose(),delete this.registry[e];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}]),e}();function Lie(e){var t=Mre(hre(e),"float32");return Bie.makeTensor(t,e,"float32")}function Fie(){var e=Vre();if(null==e._tfengine){var t=new Ore(e);e._tfengine=new Oie(t)}return function(e){Ure=e}(e._tfengine.ENV),function(e){yie=e}((function(){return e._tfengine})),e._tfengine}Oie.nextTensorId=0,Oie.nextVariableId=0;var zie,Bie=Fie();function Uie(e,t){var n={a:e,b:t};return Bie.runKernel(Gre,n)}function Vie(e){if(void 0!==zie)return zie;if(e||"undefined"!==typeof navigator&&null!=navigator){if(e||(e=navigator),"ReactNative"===e.product)return!0;var t=e.userAgent||e.vendor||("undefined"!==typeof window?window.opera:"");if(!t){var n=e;return n.userAgentData&&n.userAgentData.mobile}return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function Wie(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}var Gie=zre();Gie.registerFlag("DEBUG",(function(){return!1}),(function(e){e&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),Gie.registerFlag("IS_BROWSER",(function(){return Wie()})),Gie.registerFlag("IS_NODE",(function(){return"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node})),Gie.registerFlag("IS_CHROME",(function(){return"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor)})),Gie.registerFlag("PROD",(function(){return!1})),Gie.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(function(){return Gie.getBool("DEBUG")})),Gie.registerFlag("DEPRECATION_WARNINGS_ENABLED",(function(){return!0})),Gie.registerFlag("IS_TEST",(function(){return!1})),Gie.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(function(){return!0})),Gie.registerFlag("WRAP_TO_IMAGEBITMAP",(function(){return!1})),Gie.registerFlag("ENGINE_COMPILE_ONLY",(function(){return!1}));var jie="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function qie(e){return jie?Buffer.byteLength(e):new Blob([e]).size}function Hie(e){if(jie)return Buffer.from(e).toString("base64");for(var t=new Uint8Array(e),n="",r=0,a=t.length;r<a;r++)n+=String.fromCharCode(t[r]);return btoa(n)}function Xie(e){if(jie){var t=Buffer.from(e,"base64");return t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)}for(var n=atob(e),r=new Uint8Array(n.length),a=0;a<n.length;++a)r.set([n.charCodeAt(a)],a);return r.buffer}function Kie(e){if(1===e.length)return e[0];var t=0;e.forEach((function(e){t+=e.byteLength}));var n=new Uint8Array(t),r=0;return e.forEach((function(e){n.set(new Uint8Array(e),r),r+=e.byteLength})),n.buffer}function Yie(e,t){var n={modelTopology:e.modelTopology,format:e.format,generatedBy:e.generatedBy,convertedBy:e.convertedBy,weightsManifest:t};return null!=e.signature&&(n.signature=e.signature),null!=e.userDefinedMetadata&&(n.userDefinedMetadata=e.userDefinedMetadata),null!=e.modelInitializer&&(n.modelInitializer=e.modelInitializer),null!=e.trainingConfig&&(n.trainingConfig=e.trainingConfig),n}function Qie(e,t){return Zie.apply(this,arguments)}function Zie(){return Zie=ns(es().mark((function e(t,n){var r,a,i,o,s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy},null!=t.trainingConfig&&(r.trainingConfig=t.trainingConfig),null==t.weightsManifest){e.next=11;break}return e.next=5,n(t.weightsManifest);case 5:a=e.sent,i=f(a,2),o=i[0],s=i[1],r.weightSpecs=o,r.weightData=s;case 11:return null!=t.signature&&(r.signature=t.signature),null!=t.userDefinedMetadata&&(r.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(r.modelInitializer=t.modelInitializer),e.abrupt("return",r);case 15:case"end":return e.stop()}}),e)}))),Zie.apply(this,arguments)}function Jie(e){if(e.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==e.modelTopology?0:qie(JSON.stringify(e.modelTopology)),weightSpecsBytes:null==e.weightSpecs?0:qie(JSON.stringify(e.weightSpecs)),weightDataBytes:null==e.weightData?0:e.weightData.byteLength}}var $ie=function(){function e(){$n(this,e),this.saveRouters=[],this.loadRouters=[]}return Jn(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerSaveRouter",value:function(t){e.getInstance().saveRouters.push(t)}},{key:"registerLoadRouter",value:function(t){e.getInstance().loadRouters.push(t)}},{key:"getSaveHandlers",value:function(t){return e.getHandlers(t,"save")}},{key:"getLoadHandlers",value:function(t,n){return e.getHandlers(t,"load",n)}},{key:"getHandlers",value:function(t,n,r){var a=[];return("load"===n?e.getInstance().loadRouters:e.getInstance().saveRouters).forEach((function(e){var n=e(t,r);null!==n&&a.push(n)})),a}}]),e}(),eoe="tensorflowjs",toe="models_store",noe="model_info_store";function roe(){if(!zre().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");var e="undefined"===typeof window?self:window,t=e.indexedDB||e.mozIndexedDB||e.webkitIndexedDB||e.msIndexedDB||e.shimIndexedDB;if(null==t)throw new Error("The current browser does not appear to support IndexedDB.");return t}function aoe(e){var t=e.result;t.createObjectStore(toe,{keyPath:"modelPath"}),t.createObjectStore(noe,{keyPath:"modelPath"})}var ioe=function(){function e(t){if($n(this,e),this.indexedDB=roe(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}return Jn(e,[{key:"save",value:function(){var e=ns(es().mark((function e(t){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 2:return e.abrupt("return",this.databaseAction(this.modelPath,t));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=ns(es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",this.databaseAction(this.modelPath));case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"databaseAction",value:function(e,t){var n=this;return new Promise((function(e,r){var a=n.indexedDB.open(eoe,1);a.onupgradeneeded=function(){return aoe(a)},a.onsuccess=function(){var i=a.result;if(null==t){var o=i.transaction(toe,"readonly"),s=o.objectStore(toe).get(n.modelPath);s.onsuccess=function(){if(null==s.result)return i.close(),r(new Error("Cannot find model with path '".concat(n.modelPath,"' ")+"in IndexedDB."));e(s.result.modelArtifacts)},s.onerror=function(e){return i.close(),r(s.error)},o.oncomplete=function(){return i.close()}}else{var u,c=Jie(t),l=i.transaction(noe,"readwrite"),h=l.objectStore(noe),f=h.put({modelPath:n.modelPath,modelArtifactsInfo:c});f.onsuccess=function(){var a=(u=i.transaction(toe,"readwrite")).objectStore(toe).put({modelPath:n.modelPath,modelArtifacts:t,modelArtifactsInfo:c});a.onsuccess=function(){return e({modelArtifactsInfo:c})},a.onerror=function(e){var t=(h=l.objectStore(noe)).delete(n.modelPath);t.onsuccess=function(){return i.close(),r(a.error)},t.onerror=function(e){return i.close(),r(a.error)}}},f.onerror=function(e){return i.close(),r(f.error)},l.oncomplete=function(){null==u?i.close():u.oncomplete=function(){return i.close()}}}},a.onerror=function(e){return r(a.error)}}))}}]),e}();ioe.URL_SCHEME="indexeddb://";var ooe=function(e){return zre().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(ioe.URL_SCHEME)?(t=e.slice(ioe.URL_SCHEME.length),new ioe(t)):null;var t};$ie.registerSaveRouter(ooe),$ie.registerLoadRouter(ooe);var soe=function(){function e(){$n(this,e),this.indexedDB=roe()}return Jn(e,[{key:"listModels",value:function(){var e=ns(es().mark((function e(){var t=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise((function(e,n){var r=t.indexedDB.open(eoe,1);r.onupgradeneeded=function(){return aoe(r)},r.onsuccess=function(){var t=r.result,a=t.transaction(noe,"readonly"),i=a.objectStore(noe).getAll();i.onsuccess=function(){var t,n={},r=al(i.result);try{for(r.s();!(t=r.n()).done;){var a=t.value;n[a.modelPath]=a.modelArtifactsInfo}}catch($Pe){r.e($Pe)}finally{r.f()}e(n)},i.onerror=function(e){return t.close(),n(i.error)},a.oncomplete=function(){return t.close()}},r.onerror=function(e){return n(r.error)}})));case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=ns(es().mark((function e(t){var n=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=(r=t).startsWith(ioe.URL_SCHEME)?r.slice(ioe.URL_SCHEME.length):r,e.abrupt("return",new Promise((function(e,r){var a=n.indexedDB.open(eoe,1);a.onupgradeneeded=function(){return aoe(a)},a.onsuccess=function(){var n,i=a.result,o=i.transaction(noe,"readwrite"),s=o.objectStore(noe),u=s.get(t);u.onsuccess=function(){if(null==u.result)return i.close(),r(new Error("Cannot find model with path '".concat(t,"' ")+"in IndexedDB."));var a=s.delete(t),o=function(){var a=(n=i.transaction(toe,"readwrite")).objectStore(toe).delete(t);a.onsuccess=function(){return e(u.result.modelArtifactsInfo)},a.onerror=function(e){return r(u.error)}};a.onsuccess=o,a.onerror=function(e){return o(),i.close(),r(u.error)}},u.onerror=function(e){return i.close(),r(u.error)},o.oncomplete=function(){null==n?i.close():n.oncomplete=function(){return i.close()}}},a.onerror=function(e){return r(a.error)}})));case 2:case"end":return e.stop()}var r}),e)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),uoe="/",coe="tensorflowjs_models",loe="info",hoe="model_topology",foe="weight_specs",doe="weight_data",poe="model_metadata";function voe(e){return{info:[coe,e,loe].join(uoe),topology:[coe,e,hoe].join(uoe),weightSpecs:[coe,e,foe].join(uoe),weightData:[coe,e,doe].join(uoe),modelMetadata:[coe,e,poe].join(uoe)}}function moe(e){for(var t=0,n=Object.values(e);t<n.length;t++){var r=n[t];window.localStorage.removeItem(r)}}function goe(e){var t=e.split(uoe);if(t.length<3)throw new Error("Invalid key format: ".concat(e));return t.slice(1,t.length-1).join(uoe)}var yoe=function(){function e(t){if($n(this,e),!zre().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=voe(this.modelPath)}return Jn(e,[{key:"save",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=4;break}throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");case 4:return n=JSON.stringify(t.modelTopology),r=JSON.stringify(t.weightSpecs),a=Jie(t),e.prev=7,this.LS.setItem(this.keys.info,JSON.stringify(a)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,r),this.LS.setItem(this.keys.weightData,Hie(t.weightData)),i={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,signature:null!=t.signature?t.signature:void 0,userDefinedMetadata:null!=t.userDefinedMetadata?t.userDefinedMetadata:void 0,modelInitializer:null!=t.modelInitializer?t.modelInitializer:void 0,trainingConfig:null!=t.trainingConfig?t.trainingConfig:void 0},this.LS.setItem(this.keys.modelMetadata,JSON.stringify(i)),e.abrupt("return",{modelArtifactsInfo:a});case 17:throw e.prev=17,e.t0=e.catch(7),moe(this.keys),new Error("Failed to save model '".concat(this.modelPath,"' to local storage: ")+"size quota being exceeded is a possible cause of this failure: "+"modelTopologyBytes=".concat(a.modelTopologyBytes,", ")+"weightSpecsBytes=".concat(a.weightSpecsBytes,", ")+"weightDataBytes=".concat(a.weightDataBytes,"."));case 21:case"end":return e.stop()}}),e,this,[[7,17]])})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=ns(es().mark((function e(){var t,n,r,a,i,o,s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(t=JSON.parse(this.LS.getItem(this.keys.info)))){e.next=3;break}throw new Error("In local storage, there is no model with name '".concat(this.modelPath,"'"));case 3:if("JSON"===t.modelTopologyType){e.next=5;break}throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");case 5:if(n={},null!=(r=JSON.parse(this.LS.getItem(this.keys.topology)))){e.next=9;break}throw new Error("In local storage, the topology of model '".concat(this.modelPath,"' ")+"is missing.");case 9:if(n.modelTopology=r,null!=(a=JSON.parse(this.LS.getItem(this.keys.weightSpecs)))){e.next=13;break}throw new Error("In local storage, the weight specs of model '".concat(this.modelPath,"' ")+"are missing.");case 13:if(n.weightSpecs=a,null!=(i=this.LS.getItem(this.keys.modelMetadata))&&(o=JSON.parse(i),n.format=o.format,n.generatedBy=o.generatedBy,n.convertedBy=o.convertedBy,null!=o.signature&&(n.signature=o.signature),null!=o.userDefinedMetadata&&(n.userDefinedMetadata=o.userDefinedMetadata),null!=o.modelInitializer&&(n.modelInitializer=o.modelInitializer),null!=o.trainingConfig&&(n.trainingConfig=o.trainingConfig)),null!=(s=this.LS.getItem(this.keys.weightData))){e.next=19;break}throw new Error("In local storage, the binary weight values of model "+"'".concat(this.modelPath,"' are missing."));case 19:return n.weightData=Xie(s),e.abrupt("return",n);case 21:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),e}();yoe.URL_SCHEME="localstorage://";var boe=function(e){return zre().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(yoe.URL_SCHEME)?(t=e.slice(yoe.URL_SCHEME.length),new yoe(t)):null;var t};$ie.registerSaveRouter(boe),$ie.registerLoadRouter(boe);var xoe=function(){function e(){$n(this,e),sre(zre().getBool("IS_BROWSER"),(function(){return"Current environment is not a web browser"})),sre("undefined"===typeof window||"undefined"!==typeof window.localStorage,(function(){return"Current browser does not appear to support localStorage"})),this.LS=window.localStorage}return Jn(e,[{key:"listModels",value:function(){var e=ns(es().mark((function e(){var t,n,r,a,i,o;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:for(t={},n=coe+uoe,r=uoe+loe,a=0;a<this.LS.length;++a)(i=this.LS.key(a)).startsWith(n)&&i.endsWith(r)&&(o=goe(i),t[o]=JSON.parse(this.LS.getItem(i)));return e.abrupt("return",t);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"removeModel",value:function(){var e=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=(a=t).startsWith(yoe.URL_SCHEME)?a.slice(yoe.URL_SCHEME.length):a,n=voe(t),null!=this.LS.getItem(n.info)){e.next=4;break}throw new Error("Cannot find model at path '".concat(t,"'"));case 4:return r=JSON.parse(this.LS.getItem(n.info)),moe(n),e.abrupt("return",r);case 7:case"end":return e.stop()}var a}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}(),koe="://",woe=function(){function e(){$n(this,e),this.managers={}}return Jn(e,null,[{key:"getInstance",value:function(){return null==e.instance&&(e.instance=new e),e.instance}},{key:"registerManager",value:function(t,n){sre(null!=t,(function(){return"scheme must not be undefined or null."})),t.endsWith(koe)&&(t=t.slice(0,t.indexOf(koe))),sre(t.length>0,(function(){return"scheme must not be an empty string."}));var r=e.getInstance();sre(null==r.managers[t],(function(){return"A model store manager is already registered for scheme '".concat(t,"'.")})),r.managers[t]=n}},{key:"getManager",value:function(e){var t=this.getInstance().managers[e];if(null==t)throw new Error("Cannot find model manager for scheme '".concat(e,"'"));return t}},{key:"getSchemes",value:function(){return Object.keys(this.getInstance().managers)}}]),e}();var _oe=function(){function e(){$n(this,e)}return Jn(e,[{key:"fetch",value:function(e){function t(t,n){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e,t){return fetch(e,t)}))},{key:"now",value:function(){return performance.now()}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Browser's encoder only supports utf-8, but got ".concat(t));return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return new TextDecoder(t).decode(e)}}]),e}();if(zre().get("IS_BROWSER")){zre().setPlatform("browser",new _oe);try{woe.registerManager(yoe.URL_SCHEME,new xoe)}catch($Pe){}try{woe.registerManager(ioe.URL_SCHEME,new soe)}catch($Pe){}}var Soe,Coe=function(){return __webpack_require__(5410)};var Toe=function(){function e(){$n(this,e),this.util=__webpack_require__(8628),this.textEncoder=new this.util.TextEncoder}return Jn(e,[{key:"fetch",value:function(e,t){return null!=zre().global.fetch?zre().global.fetch(e,t):(null==Soe&&(Soe=Coe()),Soe(e,t))}},{key:"now",value:function(){var e=process.hrtime();return 1e3*e[0]+e[1]/1e6}},{key:"encode",value:function(e,t){if("utf-8"!==t&&"utf8"!==t)throw new Error("Node built-in encoder only supports utf-8, but got ".concat(t));return this.textEncoder.encode(e)}},{key:"decode",value:function(e,t){return 0===e.length?"":new this.util.TextDecoder(t).decode(e)}}]),e}();function Eoe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32",n=arguments.length>2?arguments[2]:void 0;return t=t||"float32",Rre(e),new gie(e,t,n)}function Ioe(e,t){var n=e;if(kre(e))return"string"===t?[]:[e.length];if(!Array.isArray(e))return[];for(var r=[];Array.isArray(n)||kre(n)&&"string"!==t;)r.push(n.length),n=n[0];return Array.isArray(e)&&zre().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&Aoe(e,r,[]),r}function Aoe(e,t,n){if(n=n||[],Array.isArray(e)||kre(e)){sre(t.length>0,(function(){return"Element arr[".concat(n.join("]["),"] should be a primitive, ")+"but is an array of ".concat(e.length," elements")})),sre(e.length===t[0],(function(){return"Element arr[".concat(n.join("]["),"] should have ").concat(t[0]," ")+"elements, but has ".concat(e.length," elements")}));for(var r=t.slice(1),a=0;a<e.length;++a)Aoe(e[a],r,n.concat(a))}else sre(0===t.length,(function(){return"Element arr[".concat(n.join("]["),"] is a primitive, ")+"but should be an array/TypedArray of ".concat(t[0]," elements")}))}function Moe(e,t,n,r){if("string_or_numeric"!==e){if(null==e)throw new Error("Expected dtype cannot be null.");if("numeric"!==e&&e!==t||"numeric"===e&&"string"===t)throw new Error("Argument '".concat(n,"' passed to '").concat(r,"' must ")+"be ".concat(e," tensor, but got ").concat(t," tensor"))}}function Noe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(e instanceof xie)return Moe(r,e.dtype,t,n),e;var a=Sre(e);if("string"!==a&&["bool","int32","float32"].indexOf(r)>=0&&(a=r),Moe(r,a,t,n),null==e||!kre(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e){var i=null==e?"null":e.constructor.name;throw new Error("Argument '".concat(t,"' passed to '").concat(n,"' must be a ")+"Tensor or TensorLike, but got '".concat(i,"'"))}var o=Ioe(e,a);kre(e)||Array.isArray(e)||(e=[e]);var s=!0,u="string"!==a?aie(e,a):lre(e,[],s);return Bie.makeTensor(u,o,a)}function Roe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"numeric";if(!Array.isArray(e))throw new Error("Argument ".concat(t," passed to ").concat(n," must be a ")+"`Tensor[]` or `TensorLike[]`");var a=e;return a.map((function(e,a){return Noe(e,"".concat(t,"[").concat(a,"]"),n,r)}))}zre().get("IS_NODE")&&!zre().get("IS_BROWSER")&&zre().setPlatform("node",new Toe);function Doe(e){var t=Object.keys(e);if(1!==t.length)throw new Error("Please provide an object with a single key (operation name) mapping to a function. Got an object with "+"".concat(t.length," keys."));var n=t[0],r=e[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+="__op";var a=function(){Bie.startScope(n);try{var e=r.apply(void 0,arguments);return Dre(e)&&console.error("Cannot return a Promise inside of tidy."),Bie.endScope(e),e}catch(t){throw Bie.endScope(null),t}};return Object.defineProperty(a,"name",{value:n,configurable:!0}),a}var Poe=Doe({cast_:function(e,t){var n=Noe(e,"x","cast");if(!function(e){return"bool"===e||"complex64"===e||"float32"===e||"int32"===e||"string"===e}(t))throw new Error("Failed to cast to unknown dtype ".concat(t));if("string"===t&&"string"!==n.dtype||"string"!==t&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");var r={x:n},a={dtype:t};return Bie.runKernel(Hre,r,a)}});var Ooe=Doe({clone_:function(e){var t={x:Noe(e,"x","clone","string_or_numeric")};return Bie.runKernel(aae,t)}});Fie();var Loe={buffer:Eoe,cast:Poe,clone:Ooe,print:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];console.log(e.toString(t))}};!function(e){bie=e}(Loe);function Foe(e){return new Promise((function(e){return setTimeout(e)})).then(e)}var zoe=function(){function e(t){if($n(this,e),!zre().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(e.URL_SCHEME)&&(t=t.slice(e.URL_SCHEME.length)),null!=t&&0!==t.length||(t="model"),this.modelJsonFileName=t+".json",this.weightDataFileName=t+".weights.bin"}return Jn(e,[{key:"save",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,s;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("undefined"!==typeof document){e.next=2;break}throw new Error("Browser downloads are not supported in this environment since `document` is not present");case 2:if(n=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"})),!(t.modelTopology instanceof ArrayBuffer)){e.next=7;break}throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");case 7:return r=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],a=Yie(t,r),i=window.URL.createObjectURL(new Blob([JSON.stringify(a)],{type:"application/json"})),(o=null==this.modelJsonAnchor?document.createElement("a"):this.modelJsonAnchor).download=this.modelJsonFileName,o.href=i,e.next=15,Foe((function(){return o.dispatchEvent(new MouseEvent("click"))}));case 15:if(null==t.weightData){e.next=21;break}return(s=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor).download=this.weightDataFileName,s.href=n,e.next=21,Foe((function(){return s.dispatchEvent(new MouseEvent("click"))}));case 21:return e.abrupt("return",{modelArtifactsInfo:Jie(t)});case 22:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();zoe.URL_SCHEME="downloads://";function Boe(e,t,n,r){!function(e){sre(null!=e&&Array.isArray(e)&&e.length>0,(function(){return"promises must be a none empty array"}))}(e),function(e,t){sre(e>=0&&e<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got startFraction ".concat(e)})),sre(t>=0&&t<=1,(function(){return"Progress fraction must be in range [0, 1], but "+"got endFraction ".concat(t)})),sre(t>=e,(function(){return"startFraction must be no more than endFraction, but "+"got startFraction ".concat(e," and endFraction ")+"".concat(t)}))}(n=null==n?0:n,r=null==r?1:r);var a=0;return Promise.all(e.map((function(i){return i.then((function(i){var o=n+ ++a/e.length*(r-n);return t(o),i})),i})))}function Uoe(e,t){return Voe.apply(this,arguments)}function Voe(){return(Voe=ns(es().mark((function e(t,n){var r,a,i,o,s,u,c,l,h;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null==n&&(n={}),r=null==n.fetchFunc?zre().platform.fetch:n.fetchFunc,a=t.map((function(e){return r(e,n.requestInit,{isBinary:!0})})),i=0,o=.5,null!=n.onProgress){e.next=11;break}return e.next=8,Promise.all(a);case 8:e.t0=e.sent,e.next=14;break;case 11:return e.next=13,Boe(a,n.onProgress,i,o);case 13:e.t0=e.sent;case 14:if(s=e.t0,u=s.map((function(e){return e.arrayBuffer()})),c=.5,l=1,null!=n.onProgress){e.next=24;break}return e.next=21,Promise.all(u);case 21:e.t1=e.sent,e.next=27;break;case 24:return e.next=26,Boe(u,n.onProgress,c,l);case 26:e.t1=e.sent;case 27:return h=e.t1,e.abrupt("return",h);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}$ie.registerSaveRouter((function(e){return zre().getBool("IS_BROWSER")&&!Array.isArray(e)&&e.startsWith(zoe.URL_SCHEME)?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"model";return new zoe(e)}(e.slice(zoe.URL_SCHEME.length)):null}));var Woe=function(){function e(t,n){if($n(this,e),this.DEFAULT_METHOD="POST",null==n&&(n={}),this.weightPathPrefix=n.weightPathPrefix,this.onProgress=n.onProgress,this.weightUrlConverter=n.weightUrlConverter,null!=n.fetchFunc?(sre("function"===typeof n.fetchFunc,(function(){return"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)"})),this.fetch=n.fetchFunc):this.fetch=zre().platform.fetch,sre(null!=t&&t.length>0,(function(){return"URL path for http must not be null, undefined or empty."})),Array.isArray(t)&&sre(2===t.length,(function(){return"URL paths for http must have a length of 2, "+"(actual length is ".concat(t.length,").")})),this.path=t,null!=n.requestInit&&null!=n.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=n.requestInit||{}}return Jn(e,[{key:"save",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.modelTopology instanceof ArrayBuffer)){e.next=2;break}throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");case 2:return(n=Object.assign({method:this.DEFAULT_METHOD},this.requestInit)).body=new FormData,r=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],a=Yie(t,r),n.body.append("model.json",new Blob([JSON.stringify(a)],{type:"application/json"}),"model.json"),null!=t.weightData&&n.body.append("model.weights.bin",new Blob([t.weightData],{type:"application/octet-stream"}),"model.weights.bin"),e.next=10,this.fetch(this.path,n);case 10:if(!(i=e.sent).ok){e.next=15;break}return e.abrupt("return",{modelArtifactsInfo:Jie(t),responses:[i]});case 15:throw new Error("BrowserHTTPRequest.save() failed due to HTTP response status "+"".concat(i.status,"."));case 16:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"load",value:function(){var e=ns(es().mark((function e(){var t,n,r,a,i,o=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.fetch(this.path,this.requestInit);case 2:if((t=e.sent).ok){e.next=5;break}throw new Error("Request to ".concat(this.path," failed with status code ")+"".concat(t.status,". Please verify this URL points to ")+"the model JSON of the model to load.");case 5:return e.prev=5,e.next=8,t.json();case 8:n=e.sent,e.next=16;break;case 11:throw e.prev=11,e.t0=e.catch(5),r="Failed to parse model JSON of response from ".concat(this.path,"."),this.path.endsWith(".pb")?r+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":r+=" Please make sure the server is serving valid JSON for this request.",new Error(r);case 16:if(a=n.modelTopology,i=n.weightsManifest,null!=a||null!=i){e.next=20;break}throw new Error("The JSON from HTTP path ".concat(this.path," contains neither model ")+"topology or manifest for weights.");case 20:return e.abrupt("return",Qie(n,(function(e){return o.loadWeights(e)})));case 21:case"end":return e.stop()}}),e,this,[[5,11]])})));return function(){return e.apply(this,arguments)}}()},{key:"loadWeights",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,s,u,c,l,h,d,p,v,m,g,y,b,x,k;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=Array.isArray(this.path)?this.path[1]:this.path,r=Goe(n),a=f(r,2),i=a[0],o=a[1],s=this.weightPathPrefix||i,u=[],c=al(t);try{for(c.s();!(l=c.n()).done;)h=l.value,u.push.apply(u,Tt(h.weights))}catch($Pe){c.e($Pe)}finally{c.f()}d=[],p=[],v=al(t);try{for(v.s();!(m=v.n()).done;){g=m.value,y=al(g.paths);try{for(y.s();!(b=y.n()).done;)x=b.value,null!=this.weightUrlConverter?p.push(this.weightUrlConverter(x)):d.push(s+x+o)}catch($Pe){y.e($Pe)}finally{y.f()}}}catch($Pe){v.e($Pe)}finally{v.f()}if(!this.weightUrlConverter){e.next=19;break}return e.t0=d.push,e.t1=d,e.t2=Tt,e.next=16,Promise.all(p);case 16:e.t3=e.sent,e.t4=(0,e.t2)(e.t3),e.t0.apply.call(e.t0,e.t1,e.t4);case 19:return e.next=21,Uoe(d,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});case 21:return k=e.sent,e.abrupt("return",[u,Kie(k)]);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()}]),e}();function Goe(e){var t=e.lastIndexOf("/"),n=e.lastIndexOf("?");return[e.substring(0,t)+"/",n>t?e.substring(n):""]}function joe(e){return null!=e.match(Woe.URL_SCHEME_REGEX)}Woe.URL_SCHEME_REGEX=/^https?:\/\//;var qoe=function(e,t){if("undefined"===typeof fetch&&(null==t||null==t.fetchFunc))return null;return(Array.isArray(e)?e.every((function(e){return joe(e)})):joe(e))?Hoe(e,t):null};function Hoe(e,t){return new Woe(e,t)}$ie.registerSaveRouter(qoe),$ie.registerLoadRouter(qoe);function Xoe(e,t,n,r,a,i,o,s,u){var c;if(null==r?(c=new Array(t.length)).fill(1):c=r,null!=o&&0!==(o&o-1))throw new Error("Multiple ellipses in slice is not allowed.");for(var l=!1,h={dims:c.length,numAddAxisAfterEllipsis:0,begin:t.slice(),end:n.slice(),strides:c.slice(),beginMask:a,endMask:i,ellipsisMask:o,newAxisMask:s,shrinkAxisMask:u},f=0;f<h.dims;f++)l&&0!==(1<<f&s)&&h.numAddAxisAfterEllipsis++,1<<f&o&&(l=!0);l||(h.ellipsisMask|=1<<h.dims,h.dims++);var d={dims:e.length,beginMask:0,endMask:0,beginValid:!1,endValid:!1};!function(e,t){t.beginMask=0,t.endMask=0,t.shrinkAxisMask=0;var n=0;t.beginValid=null!=e.begin,t.endValid=null!=e.end,t.begin=new Array(t.dims),t.end=new Array(t.dims),t.strides=new Array(t.dims),t.finalShapeGatherIndices=[],t.finalShapeGatherIndicesSparse=[],t.inputShapeGatherIndicesSparse=new Array(t.dims);for(var r=0;r<e.dims;r++)if(1<<r&e.ellipsisMask)for(var a=Math.min(t.dims-(e.dims-r)+1+e.numAddAxisAfterEllipsis,t.dims);n<a;n++)t.begin[n]=0,t.end[n]=0,t.strides[n]=1,t.beginMask|=1<<n,t.endMask|=1<<n,t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(-1),t.inputShapeGatherIndicesSparse[n]=r;else if(1<<r&e.newAxisMask)t.finalShapeGatherIndices.push(-2),t.finalShapeGatherIndicesSparse.push(-1);else{if(n===t.begin.length)throw Error("Index out of range using input dim ".concat(n,"; input ")+"has only ".concat(t.dims," dims, ").concat(t.begin.length,"."));null!=e.begin&&(t.begin[n]=e.begin[r]),null!=e.end&&(t.end[n]=e.end[r]),t.strides[n]=e.strides[r],e.beginMask&1<<r&&(t.beginMask|=1<<n),e.endMask&1<<r&&(t.endMask|=1<<n),e.shrinkAxisMask&1<<r?(t.finalShapeGatherIndices.push(-1),t.finalShapeGatherIndicesSparse.push(-1),t.shrinkAxisMask|=1<<n):(t.finalShapeGatherIndices.push(n),t.finalShapeGatherIndicesSparse.push(r)),t.inputShapeGatherIndicesSparse[n]=r,n++}}(h,d);for(var p=!0,v=!0,m=!0,g=[],y=[],b=0;b<e.length;++b){if(0===d.strides[b])throw Error("strides[".concat(b,"] must be non-zero"));var x=!!(d.shrinkAxisMask&1<<b),k=e[b];if(-1!==k){var w=[d.beginMask&1<<b,d.endMask&1<<b],_=[d.strides[b]>0?0:-1,d.strides[b]>0?k:k-1];if(x&&d.strides[b]<=0)throw Error("only stride 1 allowed on non-range indexing.");m=m&&1===d.strides[b];var S=!!(d.beginMask&1<<b&&d.endMask&1<<b);if(d.beginValid&&d.endValid){if(x){var C=d.begin[b]<0?k+d.begin[b]:d.begin[b];if(d.begin[b]=C,d.end[b]=d.begin[b]+1,C<0||C>=k)throw Error("slice index ".concat(d.begin[b]," of dimension ").concat(b," out of bounds."))}else d.begin[b]=Koe(d.begin[b],0,d.strides[b],k,w,_),d.end[b]=Koe(d.end[b],1,d.strides[b],k,w,_);var T=1===d.strides[b]&&0===d.begin[b]&&d.end[b]===k;p=p&&T,v=v&&(0===b&&1===d.strides[b]||T)}else p=p&&1===d.strides[b]&&S,v=v&&(0===b&&1===d.strides[b]||S);var E=void 0,I=!1;if(d.beginValid&&d.endValid?(E=d.end[b]-d.begin[b],I=!0):x?(E=1,I=!0):S&&k>=0&&(E=d.strides[b]<0?-k:k,I=!0),I){var A=void 0;A=0===E||E<0!==d.strides[b]<0?0:Math.trunc(E/d.strides[b])+(E%d.strides[b]!==0?1:0),g.push(A)}else g.push(-1)}else g.push(x?1:-1)}for(var M=0;M<d.finalShapeGatherIndices.length;++M){var N=d.finalShapeGatherIndices[M];N>=0?y.push(g[N]):-2===N&&y.push(1)}var R=y.filter((function(e,t){return-2!==d.finalShapeGatherIndices[t]}));return{finalShapeSparse:R,finalShape:y,isIdentity:p,sliceDim0:v,isSimpleSlice:m,begin:d.begin,end:d.end,strides:d.strides}}function Koe(e,t,n,r,a,i){if(a[t])return n>0?i[t]:i[t+1&1];var o=e<0?r+e:e;return o<i[0]?i[0]:o>i[1]?i[1]:o}function Yoe(e,t,n,r){if(null==r&&(r=Sre(e)),"complex64"===r)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!kre(e)&&!Array.isArray(e)&&"number"!==typeof e&&"boolean"!==typeof e&&"string"!==typeof e)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=t){Rre(t);var a=hre(t),i=hre(n);sre(a===i,(function(){return"Based on the provided shape, [".concat(t,"], the tensor should have ")+"".concat(a," values but has ").concat(i)}));for(var o=0;o<n.length;++o){var s=n[o],u=o!==n.length-1||s!==hre(t.slice(o));sre(n[o]===t[o]||!u,(function(){return"Error creating a new Tensor. Inferred shape "+"(".concat(n,") does not match the provided ")+"shape (".concat(t,"). ")}))}}return kre(e)||Array.isArray(e)||(e=[e]),t=t||n,e="string"!==r?aie(e,r):lre(e,[],!0),Bie.makeTensor(e,t,r)}function Qoe(e,t){if((kre(e)&&"string"!==t||Array.isArray(e))&&"complex64"!==t)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===t&&kre(e)&&!(e instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");return Yoe(e,[],[],t)}var Zoe=Doe({complex_:function(e,t){var n=Noe(e,"real","complex"),r=Noe(t,"imag","complex");ure(n.shape,r.shape,"real and imag shapes, ".concat(n.shape," and ").concat(r.shape,", ")+"must match in call to tf.complex().");var a={real:n,imag:r};return Bie.runKernel(Xre,a)}});function Joe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=Joe(e,"float32"),r=Joe(e,"float32");return Zoe(n,r)}var a=Nre(hre(e),t);return Bie.makeTensor(a,e,t)}var $oe=Doe({concat_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;sre(e.length>=1,(function(){return"Pass at least one tensor to concat"}));var n=Roe(e,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((function(e){if("complex64"!==e.dtype)throw new Error("Cannot concatenate complex64 tensors with a tensor\n          with dtype ".concat(e.dtype,". "))})),1===n.length)return Ooe(n[0]);var r=n,a={axis:t};return Bie.runKernel(Yre,r,a)}});var ese=Doe({imag_:function(e){var t={input:Noe(e,"input","imag")};return Bie.runKernel(oae,t)}});var tse=Doe({real_:function(e){var t={input:Noe(e,"input","real")};return Bie.runKernel(_ae,t)}});var nse=Doe({reshape_:function(e,t){var n={x:Noe(e,"x","reshape","string_or_numeric")},r={shape:t};return Bie.runKernel(Cae,n,r)}});var rse=Doe({slice_:function(e,t,n){var r=Noe(e,"x","slice","string_or_numeric");if(0===r.rank)throw new Error("Slicing scalar is not possible");var a={x:r},i={begin:t,size:n};return Bie.runKernel(Rae,a,i)}});var ase=Doe({split_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Noe(e,"x","split"),a={x:r},i={numOrSizeSplits:t,axis:n};return Bie.runKernel(Lae,a,i)}});var ise=Doe({zerosLike_:function(e){var t={x:Noe(e,"x","zerosLike")};return Bie.runKernel(Gae,t)}});var ose=Doe({fft_:function(e){sre("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.fft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return Bie.runKernel("FFT",t)}});var sse=Doe({rfft_:function(e,t){sre("float32"===e.dtype,(function(){return"The dtype for rfft() must be real value but got ".concat(e.dtype)}));var n,r=e.shape[e.shape.length-1],a=e.size/r;if(null!=t&&t<r){var i=e.shape.map((function(e){return 0})),o=e.shape.map((function(e){return e}));o[e.shape.length-1]=t,n=rse(e,i,o),r=t}else if(null!=t&&t>r){var s=e.shape.map((function(e){return e}));s[e.shape.length-1]=t-r,n=$oe([e,Joe(s)],e.shape.length-1),r=t}else n=e;var u=ise(n),c=nse(Zoe(n,u),[a,r]),l=ose(c),h=Math.floor(r/2)+1,f=tse(l),d=ese(l),p=ase(f,[h,r-h],f.shape.length-1),v=ase(d,[h,r-h],d.shape.length-1),m=n.shape.slice();return m[n.shape.length-1]=h,nse(Zoe(p[0],v[0]),m)}});var use=Doe({ifft_:function(e){sre("complex64"===e.dtype,(function(){return"The dtype for tf.spectral.ifft() must be complex64 "+"but got ".concat(e.dtype,".")}));var t={input:e};return Bie.runKernel(iae,t)}});var cse=Doe({mul_:function(e,t){var n=Noe(e,"a","mul"),r=Noe(t,"b","mul"),a=f(Mie(n,r),2),i={a:n=a[0],b:r=a[1]};return Bie.runKernel(vae,i)}});var lse=Doe({reverse_:function(e,t){var n={x:Noe(e,"x","reverse")},r={dims:t};return Bie.runKernel(Aae,n,r)}});Doe({irfft_:function(e){var t,n=e.shape[e.shape.length-1],r=e.size/n;if(n<=2){var a=nse(e,[r,n]);t=use(a)}else{var i=[r,2*(n-1)],o=nse(tse(e),[r,n]),s=nse(ese(e),[r,n]),u=lse(rse(o,[0,1],[r,n-2]),1),c=cse(lse(rse(s,[0,1],[r,n-2]),1),Qoe(-1)),l=$oe([o,u],1),h=$oe([s,c],1),f=nse(Zoe(l,h),[i[0],i[1]]);t=use(f)}if(t=tse(t),3===e.rank&&0!==e.shape[0]){var d=t,p=e.shape[0];t=nse(t,[p,t.shape[0]/p,t.shape[1]]),d.dispose()}return t}});function hse(e,t){cre(e);var n=Ioe(e,t);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");return Yoe(e,null,n,t)}function fse(e){return Math.floor(Math.pow(2,Math.ceil(Math.log(e)/Math.log(2))))}function dse(e,t,n){for(var r=1-e%2,a=new Float32Array(e),i=0;i<e;++i){var o=2*Math.PI*i/(e+r-1);a[i]=t-n*Math.cos(o)}return hse(a,"float32")}Doe({hammingWindow_:function(e){return dse(e,.54,.46)}});var pse=Doe({hannWindow_:function(e){return dse(e,.5,.5)}});function vse(e,t,n){var r={shape:e,value:t,dtype:n};return Bie.runKernel($re,{},r)}function mse(e,t,n){if(cre(e),null!=t&&2!==t.length)throw new Error("tensor2d() requires shape to have two numbers");var r=Ioe(e,n);if(2!==r.length&&1!==r.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===r.length&&null==t)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Yoe(e,t,r,n)}var gse=Doe({frame_:function(e,t,n){for(var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=0,o=[];i+t<=e.size;)o.push(rse(e,i,t)),i+=n;if(r)for(;i<e.size;){var s=i+t-e.size,u=$oe([rse(e,i,t-s),vse([s],a)]);o.push(u),i+=n}return 0===o.length?mse([],[0,t]):nse($oe(o),[o.length,t])}});Doe({stft_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:pse;null==r&&(r=fse(t));var i=gse(e,t,n),o=cse(i,a(t));return sse(o,r)}});Doe({cropAndResize_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"bilinear",i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Noe(e,"image","cropAndResize"),s=Noe(t,"boxes","cropAndResize","float32"),u=Noe(n,"boxInd","cropAndResize","int32"),c=s.shape[0];sre(4===o.rank,(function(){return"Error in cropAndResize: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),sre(2===s.rank&&4===s.shape[1],(function(){return"Error in cropAndResize: boxes must be have size [".concat(c,",4] ")+"but had shape ".concat(s.shape,".")})),sre(1===u.rank&&u.shape[0]===c,(function(){return"Error in cropAndResize: boxInd must be have size [".concat(c,"] ")+"but had shape ".concat(s.shape,".")})),sre(2===r.length,(function(){return"Error in cropAndResize: cropSize must be of length 2, but got "+"length ".concat(r.length,".")})),sre(r[0]>=1&&r[1]>=1,(function(){return"cropSize must be atleast [1,1], but was ".concat(r)})),sre("bilinear"===a||"nearest"===a,(function(){return"method must be bilinear or nearest, but was ".concat(a)}));var l={image:o,boxes:s,boxInd:u},h={method:a,extrapolationValue:i,cropSize:r},f=Bie.runKernel(Qre,l,h);return f}});Doe({flipLeftRight_:function(e){var t=Noe(e,"image","flipLeftRight","float32");sre(4===t.rank,(function(){return"Error in flipLeftRight: image must be rank 4,"+"but got rank ".concat(t.rank,".")}));var n={image:t};return Bie.runKernel(eae,n,{})}});var yse=Doe({tile_:function(e,t){var n=Noe(e,"x","tile","string_or_numeric");sre(n.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(n.rank," ")+"must match length of reps ".concat(t,".")}));var r={x:n},a={reps:t};return Bie.runKernel(Bae,r,a)}});Doe({grayscaleToRGB_:function(e){var t=Noe(e,"image","grayscaleToRGB"),n=t.rank-1,r=t.shape[n];sre(t.rank>=2,(function(){return"Error in grayscaleToRGB: images must be at least rank 2, "+"but got rank ".concat(t.rank,".")})),sre(1===r,(function(){return"Error in grayscaleToRGB: last dimension of a grayscale image "+"should be size 1, but got size ".concat(r,".")}));var a=new Array(t.rank);return a.fill(1,0,n),a[n]=3,yse(t,a)}});Doe({rotateWithOffset_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=Noe(e,"image","rotateWithOffset","float32");sre(4===a.rank,(function(){return"Error in rotateWithOffset: image must be rank 4,"+"but got rank ".concat(a.rank,".")}));var i={image:a},o={radians:t,fillValue:n,center:r},s=Bie.runKernel(qae,i,o);return s}});function bse(e,t,n,r,a,i){null==r&&(r=.5),null==a&&(a=Number.NEGATIVE_INFINITY),null==i&&(i=0);var o=e.shape[0];return n=Math.min(n,o),sre(0<=r&&r<=1,(function(){return"iouThreshold must be in [0, 1], but was '".concat(r,"'")})),sre(2===e.rank,(function(){return"boxes must be a 2D tensor, but was of rank '".concat(e.rank,"'")})),sre(4===e.shape[1],(function(){return"boxes must have 4 columns, but 2nd dimension was ".concat(e.shape[1])})),sre(1===t.rank,(function(){return"scores must be a 1D tensor"})),sre(t.shape[0]===o,(function(){return"scores has incompatible shape with boxes. Expected ".concat(o,", ")+"but was ".concat(t.shape[0])})),sre(0<=i&&i<=1,(function(){return"softNmsSigma must be in [0, 1], but was '".concat(i,"'")})),{maxOutputSize:n,iouThreshold:r,scoreThreshold:a,softNmsSigma:i}}Doe({nonMaxSuppression_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=Noe(e,"boxes","nonMaxSuppression","float32"),o=Noe(t,"scores","nonMaxSuppression","float32"),s=bse(i,o,n,r,a),u={maxOutputSize:n=s.maxOutputSize,iouThreshold:r=s.iouThreshold,scoreThreshold:a=s.scoreThreshold};return Bie.runKernel(gae,{boxes:i,scores:o},u)}});function xse(e,t,n){var r=function(e,t,n){return function(e,t,n){var r=0,a=e.length,i=0,o=!1;for(;r<a;){var s=n(t,e[i=r+(a-r>>>1)]);s>0?r=i+1:(a=i,o=!s)}return o?r:-r-1}(e,t,n||kse)}(e,t,n),a=r<0?-(r+1):r;e.splice(a,0,t)}function kse(e,t){return e>t?1:e<t?-1:0}function wse(e,t,n,r,a){return Cse(e,t,n,r,a,0)}function _se(e,t,n,r,a,i){return Cse(e,t,n,r,a,0,!1,i,!0)}function Sse(e,t,n,r,a,i){return Cse(e,t,n,r,a,i,!0)}function Cse(e,t,n,r,a,i){for(var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]&&arguments[7],u=arguments.length>8&&void 0!==arguments[8]&&arguments[8],c=[],l=0;l<t.length;l++)t[l]>a&&c.push({score:t[l],boxIndex:l,suppressBeginIndex:0});c.sort(Ise);for(var h=i>0?-.5/i:0,f=[],d=[];f.length<n&&c.length>0;){var p=c.pop(),v=p.score,m=p.boxIndex,g=p.suppressBeginIndex;if(v<a)break;for(var y=!1,b=f.length-1;b>=g;--b){var x=Tse(e,m,f[b]);if(x>=r){y=!0;break}if(p.score=p.score*Ese(r,h,x),p.score<=a)break}p.suppressBeginIndex=f.length,y||(p.score===v?(f.push(m),d.push(p.score)):p.score>a&&xse(c,p,Ise))}var k=f.length,w=n-k;s&&w>0&&(f.push.apply(f,Tt(new Array(w).fill(0))),d.push.apply(d,Tt(new Array(w).fill(0))));var _={selectedIndices:f};return o&&(_.selectedScores=d),u&&(_.validOutputs=k),_}function Tse(e,t,n){var r=e.subarray(4*t,4*t+4),a=e.subarray(4*n,4*n+4),i=Math.min(r[0],r[2]),o=Math.min(r[1],r[3]),s=Math.max(r[0],r[2]),u=Math.max(r[1],r[3]),c=Math.min(a[0],a[2]),l=Math.min(a[1],a[3]),h=Math.max(a[0],a[2]),f=Math.max(a[1],a[3]),d=(s-i)*(u-o),p=(h-c)*(f-l);if(d<=0||p<=0)return 0;var v=Math.max(i,c),m=Math.max(o,l),g=Math.min(s,h),y=Math.min(u,f),b=Math.max(g-v,0)*Math.max(y-m,0);return b/(d+p-b)}function Ese(e,t,n){var r=Math.exp(t*n*n);return n<=e?r:0}function Ise(e,t){return e.score-t.score||e.score===t.score&&t.boxIndex-e.boxIndex}Doe({nonMaxSuppressionWithScore_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=Noe(e,"boxes","nonMaxSuppression"),s=Noe(t,"scores","nonMaxSuppression"),u=bse(o,s,n,r,a,i),c={boxes:o,scores:s},l={maxOutputSize:n=u.maxOutputSize,iouThreshold:r=u.iouThreshold,scoreThreshold:a=u.scoreThreshold,softNmsSigma:i=u.softNmsSigma},h=Bie.runKernel(bae,c,l);return{selectedIndices:h[0],selectedScores:h[1]}}});Doe({nonMaxSuppressionPadded_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Number.NEGATIVE_INFINITY,i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=Noe(e,"boxes","nonMaxSuppression"),s=Noe(t,"scores","nonMaxSuppression"),u=bse(o,s,n,r,a,null),c=u.maxOutputSize,l=u.iouThreshold,h=u.scoreThreshold,f={boxes:o,scores:s},d={maxOutputSize:c,iouThreshold:l,scoreThreshold:h,padToMaxOutputSize:i},p=Bie.runKernel(yae,f,d);return{selectedIndices:p[0],validOutputs:p[1]}}});Doe({resizeBilinear_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Noe(e,"images","resizeBilinear");sre(3===a.rank||4===a.rank,(function(){return"Error in resizeBilinear: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),sre(2===t.length,(function(){return"Error in resizeBilinear: new shape must 2D, but got shape "+"".concat(t,".")})),sre(!1===r||!1===n,(function(){return"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=nse(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Mb(t);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=Bie.runKernel(Eae,s,u);return o?nse(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});Doe({resizeNearestNeighbor_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Noe(e,"images","resizeNearestNeighbor");sre(3===a.rank||4===a.rank,(function(){return"Error in resizeNearestNeighbor: x must be rank 3 or 4, but got "+"rank ".concat(a.rank,".")})),sre(2===t.length,(function(){return"Error in resizeNearestNeighbor: new shape must 2D, but got shape "+"".concat(t,".")})),sre("float32"===a.dtype||"int32"===a.dtype,(function(){return"`images` must have `int32` or `float32` as dtype"})),sre(!1===r||!1===n,(function(){return"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."}));var i=a,o=!1;3===a.rank&&(o=!0,i=nse(a,[1,a.shape[0],a.shape[1],a.shape[2]])),Mb(t);var s={images:i},u={alignCorners:n,halfPixelCenters:r,size:t},c=Bie.runKernel(Tae,s,u);return o?nse(c,[c.shape[1],c.shape[2],c.shape[3]]):c}});var Ase=Doe({bincount_:function(e,t,n){var r=Noe(e,"x","bincount"),a=Noe(t,"weights","bincount");sre("int32"===r.dtype,(function(){return"Error in bincount: input "+"dtype must be int32, but got ".concat(r.dtype)})),sre(n>=0,(function(){return"size must be non-negative, but got ".concat(n,".")})),sre(a.size===r.size||0===a.size,(function(){return"Error in bincount: weights must have the same size as input or"+"0-length, but got input shape: ".concat(r.shape,", weights shape: ")+"".concat(a.shape,".")}));var i={x:r,weights:a},o={size:n};return Bie.runKernel(qre,i,o)}});function Mse(e,t){for(var n=[],r=Math.max(e.length,t.length),a=0;a<r;a++){var i=e[e.length-a-1];null==i&&(i=1);var o=t[t.length-a-1];if(null==o&&(o=1),1===i)n.unshift(o);else if(1===o)n.unshift(i);else{if(i!==o){var s="Operands could not be broadcast together with shapes "+"".concat(e," and ").concat(t,".");throw Error(s)}n.unshift(i)}}return n}var Nse=Doe({lessEqual_:function(e,t){var n=Noe(e,"a","lessEqual","string_or_numeric"),r=Noe(t,"b","lessEqual","string_or_numeric"),a=f(Mie(n,r),2);n=a[0],r=a[1],Mse(n.shape,r.shape);var i={a:n,b:r};return Bie.runKernel(uae,i)}});var Rse=Doe({greater_:function(e,t){var n=Noe(e,"a","greater","string_or_numeric"),r=Noe(t,"b","greater","string_or_numeric"),a=f(Mie(n,r),2);n=a[0],r=a[1],Mse(n.shape,r.shape);var i={a:n,b:r};return Bie.runKernel(nae,i)}});var Dse=Doe({sum_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Noe(e,"x","sum");"bool"===r.dtype&&(r=Poe(r,"int32"));var a={x:r},i={axis:t,keepDims:n};return Bie.runKernel(Oae,a,i)}});var Pse=Doe({add_:function(e,t){var n=Noe(e,"a","add"),r=Noe(t,"b","add"),a=f(Mie(n,r),2),i={a:n=a[0],b:r=a[1]};return Bie.runKernel(Gre,i)}});var Ose=Doe({floorDiv_:function(e,t){var n=Noe(e,"a","floorDiv"),r=Noe(t,"b","floorDiv"),a=f(Mie(n,r),2),i={a:n=a[0],b:r=a[1]};return Bie.runKernel(tae,i)}});var Lse=Doe({div_:function(e,t){var n=Noe(e,"a","div"),r=Noe(t,"b","div"),a=f(Mie(n,r),2);if(n=a[0],r=a[1],"int32"===n.dtype&&"int32"===r.dtype)return Ose(n,r);var i={a:n,b:r};return Bie.runKernel(Zre,i,{})}});var Fse=Doe({sub_:function(e,t){var n=Noe(e,"a","sub"),r=Noe(t,"b","sub"),a=f(Mie(n,r),2),i={a:n=a[0],b:r=a[1]};return Bie.runKernel("Sub",i)}});var zse=Doe({round_:function(e){var t={x:Noe(e,"x","round")};return Bie.runKernel(Mae,t)}});var Bse=Doe({broadcastTo_:function(e,t){var n=Noe(e,"broadcastTo","x"),r=n.shape;if(t.some((function(e){return!(e>0)||e%1!==0})))throw new Error("broadcastTo(): Invalid broadcast shape [".concat(t,"]."));if(t.length<n.rank)throw new Error("broadcastTo(): shape.length=".concat(t.length," < input.rank=").concat(n.rank,"."));if(t.length>n.rank){for(var a=n.shape.slice();a.length<t.length;)a.unshift(1);n=nse(n,a)}for(var i=n.shape,o=Array.from(t),s=t.length-1;s>=0;s--)if(i[s]===t[s])o[s]=1;else if(1!==n.shape[s])throw new Error("broadcastTo(): [".concat(r,"] cannot be broadcast to [").concat(t,"]."));var u=o.map((function(e,t){return e>1?t:-1})).filter((function(e){return e>=0}));if(0===u.length)return Ooe(n);var c={x:n},l={reps:o};return Bie.runKernel(Bae,c,l)}});var Use=Doe({where_:function(e,t,n){var r=Noe(t,"a","where"),a=Noe(n,"b","where"),i=Noe(e,"condition","where","bool"),o=Mse(Mse(i.shape,r.shape),a.shape),s={condition:Bse(i,o),t:Bse(r,o),e:Bse(a,o)};return Bie.runKernel(Nae,s)}});function Vse(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";if(0===n)throw new Error("Cannot have a step of zero");var a={start:e,stop:t,step:n,dtype:r};return Bie.runKernel(wae,{},a)}function Wse(e,t,n){return Yoe(e,t,Ioe(e,n),n)}function Gse(e,t){for(var n,r,a,i,o,s,u=hse([-1]),c=hse([0]),l=hse([0]),h=0;h<e.size-1;h++){n=rse(e,0,h+1),r=rse(e,h+1),o=Lse(Dse(n),t),s=Lse(Dse(r),t);var f=Dse(cse(n,Vse(0,n.size)));a=Lse(f,Dse(n));var d=vse(r.shape,n.size),p=Pse(Vse(0,r.size),d),v=cse(r,p);i=Lse(Dse(v),Dse(r));var m=Fse(a,i),g=Fse(a,i),y=cse(o,s);l=cse(cse(y,m),g);var b=Rse(l,c);c=Use(b,l,c),u=Use(b,hse([h]),u)}return u}Doe({threshold_:function(e){var t,n,r,a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"binary",o=arguments.length>2&&void 0!==arguments[2]&&arguments[2],s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5,u=Noe(e,"image","threshold"),c=.2989,l=.587,h=.114,d=u.shape[0]*u.shape[1],p=cse(hse([s]),255);if(sre(3===u.rank,(function(){return"Error in threshold: image must be rank 3,"+"but got rank ".concat(u.rank,".")})),sre(3===u.shape[2]||1===u.shape[2],(function(){return"Error in threshold: image color channel must be equal to 3 or 1"+"but got ".concat(u.shape[2],".")})),sre("int32"===u.dtype||"float32"===u.dtype,(function(){return"Error in dtype: image dtype must be int32 or float32,"+"but got dtype ".concat(u.dtype,".")})),sre("otsu"===i||"binary"===i,(function(){return"Method must be binary or otsu, but was ".concat(i)})),3===u.shape[2]){var v=ase(u,[1,1,1],-1),m=f(v,3);t=m[0],n=m[1],r=m[2];var g=cse(t,c),y=cse(n,l),b=cse(r,h);a=Pse(Pse(g,y),b)}else a=e;if("otsu"===i){var x=Ase(Poe(zse(a),"int32"),Wse([]),256);p=Gse(x,d)}var k=o?Nse(a,p):Rse(a,p),w=Poe(cse(k,255),"int32");return w}});Doe({transform_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"nearest",r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"constant",a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=arguments.length>5?arguments[5]:void 0,o=Noe(e,"image","transform","float32"),s=Noe(t,"transforms","transform","float32");sre(4===o.rank,(function(){return"Error in transform: image must be rank 4,"+"but got rank ".concat(o.rank,".")})),sre(2===s.rank&&(s.shape[0]===o.shape[0]||1===s.shape[0])&&8===s.shape[1],(function(){return"Error in transform: Input transform should be batch x 8 or 1 x 8"})),sre(null==i||2===i.length,(function(){return"Error in transform: outputShape must be [height, width] or null, "+"but got ".concat(i,".")}));var u={image:o,transforms:s},c={interpolation:n,fillMode:r,fillValue:a,outputShape:i};return Bie.runKernel(Uae,u,c)}});var jse=Doe({greaterEqual_:function(e,t){var n=Noe(e,"a","greaterEqual","string_or_numeric"),r=Noe(t,"b","greaterEqual","string_or_numeric"),a=f(Mie(n,r),2);n=a[0],r=a[1],Mse(n.shape,r.shape);var i={a:n,b:r};return Bie.runKernel(rae,i)}});var qse=Doe({logicalAnd_:function(e,t){var n=Noe(e,"a","logicalAnd","bool"),r=Noe(t,"b","logicalAnd","bool");Mse(n.shape,r.shape);var a={a:n,b:r};return Bie.runKernel(lae,a)}});var Hse=Doe({stack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Roe(e,"tensors","stack","string_or_numeric");sre(n.length>=1,(function(){return"Pass at least one tensor to tf.stack"})),n.length>0&&sre(t<=n[0].rank,(function(){return"Axis must be <= rank of the tensor"}));var r=n,a={axis:t};return Bie.runKernel(xae,r,a)}});var Xse=Doe({unstack_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Noe(e,"x","unstack","string_or_numeric");sre(t>=-n.shape.length&&t<n.shape.length,(function(){return"Axis = ".concat(t," is not in [-").concat(n.shape.length,", ").concat(n.shape.length,")")}));var r={value:n},a={axis:t};return Bie.runKernel(Wae,r,a)}});Doe({bandPart_:function(e,t,n){sre(t%1===0,(function(){return"bandPart(): numLower must be an integer, got ".concat(t,".")})),sre(n%1===0,(function(){return"bandPart(): numUpper must be an integer, got ".concat(n,".")}));var r=Noe(e,"a","bandPart");sre(r.rank>=2,(function(){return"bandPart(): Rank must be at least 2, got ".concat(r.rank,".")}));var a=r.shape,i=f(r.shape.slice(-2),2),o=i[0],s=i[1];if(!(t<=o))throw new Error("bandPart(): numLower (".concat(t,")")+" must not be greater than the number of rows (".concat(o,")."));if(!(n<=s))throw new Error("bandPart(): numUpper (".concat(n,")")+" must not be greater than the number of columns (".concat(s,")."));t<0&&(t=o),n<0&&(n=s);var u=nse(Vse(0,o,1,"int32"),[-1,1]),c=Vse(0,s,1,"int32"),l=Fse(u,c),h=qse(Nse(l,Qoe(+t,"int32")),jse(l,Qoe(-n,"int32"))),d=Joe([o,s],r.dtype);return nse(Hse(Xse(nse(r,[-1,o,s])).map((function(e){return Use(h,e,d)}))),a)}});var Kse=Doe({abs_:function(e){var t=Noe(e,"x","abs");if("complex64"===t.dtype){var n={x:t};return Bie.runKernel(Kre,n)}var r={x:t};return Bie.runKernel("Abs",r)}});function Yse(e,t){for(var n=0;n<e.length;++n)if(e[e.length-n-1]!==t-1-n)return!1;return!0}function Qse(e,t){for(var n=[],r=e.length,a=0;a<r;a++)-1===t.indexOf(a)&&n.push(e[a]);var i=t.map((function(t){return e[t]}));return[n,i]}function Zse(e,t){return function(e,t,n){for(var r=e.length+t.length,a=[],i=0,o=0,s=0;s<r;s++)-1===n.indexOf(s)?a.push(e[i++]):a.push(t[o++]);return a}(e,t.map((function(e){return 1})),t)}function Jse(e,t,n){sre(Yse(t,n),(function(){return"".concat(e," supports only inner-most axes for now. ")+"Got axes ".concat(t," and rank-").concat(n," input.")}))}function $se(e,t){if(Yse(e,t))return null;for(var n=[],r=0;r<t;++r)-1===e.indexOf(r)&&n.push(r);return e.forEach((function(e){return n.push(e)})),n}function eue(e){return e.map((function(e,t){return[t,e]})).sort((function(e,t){return e[1]-t[1]})).map((function(e){return e[0]}))}function tue(e,t){for(var n=[],r=t-e;r<t;++r)n.push(r);return n}var nue=Doe({max_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Noe(e,"x","max"),a={x:r},i={reductionIndices:t,keepDims:n};return Bie.runKernel(hae,a,i)}});var rue=Doe({min_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Noe(e,"x","min"),a={x:r},i={axis:t,keepDims:n};return Bie.runKernel(dae,a,i)}});var aue=Doe({pow_:function(e,t){var n=Noe(e,"base","pow"),r=Noe(t,"exp","pow"),a=f(Mie(n,r),2),i={a:n=a[0],b:r=a[1]};return Bie.runKernel("Pow",i)}});var iue=Doe({sqrt_:function(e){var t={x:Noe(e,"x","sqrt","float32")};return Bie.runKernel(Pae,t)}});var oue=Doe({square_:function(e){var t=Noe(e,"x","square");return Bie.runKernel("Square",{x:t},{})}});function sue(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(0===e.rank)return Kse(e);if(1!==e.rank&&null===n)return sue(nse(e,[-1]),t,n);if(1===e.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===t)return Dse(Kse(e),n);if(t===1/0)return nue(Kse(e),n);if(t===-1/0)return rue(Kse(e),n);if("euclidean"===t||2===t)return iue(Dse(aue(Kse(e),Qoe(2,"int32")),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}if(Array.isArray(n)&&2===n.length){if(1===t)return nue(Dse(Kse(e),n[0]),n[1]-1);if(t===1/0)return nue(Dse(Kse(e),n[1]),n[0]);if(t===-1/0)return rue(Dse(Kse(e),n[1]),n[0]);if("fro"===t||"euclidean"===t)return iue(Dse(oue(e),n));throw new Error("Error in norm: invalid ord value: ".concat(t))}throw new Error("Error in norm: invalid axis: ".concat(n))}var uue=Doe({norm_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"euclidean",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=sue(e=Noe(e,"x","norm"),t,n),i=a.shape;if(r){var o=gre(n,e.shape);i=Zse(a.shape,o)}return nse(a,i)}});var cue=Doe({squeeze_:function(e,t){var n=Noe(e,"x","squeeze");return nse(n,yre(n.shape,t).newShape)}});Doe({gramSchmidt_:function(e){var t;Array.isArray(e)?function(){t=!1,sre(null!=e&&e.length>0,(function(){return"Gram-Schmidt process: input must not be null, undefined, or empty"}));for(var n=e[0].shape[0],r=function(t){sre(e[t].shape[0]===n,(function(){return"Gram-Schmidt: Non-unique lengths found in the input vectors: "+"(".concat(e[t].shape[0]," vs. ").concat(n,")")}))},a=1;a<e.length;++a)r(a)}():(t=!0,e=ase(e,e.shape[0],0).map((function(e){return cue(e,[0])}))),sre(e.length<=e[0].shape[0],(function(){return"Gram-Schmidt: Number of vectors (".concat(e.length,") exceeds ")+"number of dimensions (".concat(e[0].shape[0],").")}));for(var n=[],r=e,a=function(e){n.push(Bie.tidy((function(){var t=r[e];if(e>0)for(var a=0;a<e;++a){var i=cse(Dse(cse(n[a],t)),n[a]);t=Fse(t,i)}return Lse(t,uue(t,"euclidean"))})))},i=0;i<e.length;++i)a(i);return t?Hse(n,0):n}});function lue(){return Bie}function hue(e,t){return Bie.tidy(e,t)}function fue(e){Nie(e).forEach((function(e){return e.dispose()}))}!function(e){e}((function(e){zre().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(e+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}));var due=Doe({expandDims_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Noe(e,"x","expandDims","string_or_numeric");sre(t<=n.rank,(function(){return"Axis must be <= rank of the tensor"}));var r={input:n},a={dim:t};return Bie.runKernel(Jre,r,a)}});var pue=Doe({eye_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"float32";null==t&&(t=e);for(var a=Eoe([e,t],r),i=e<=t?e:t,o=0;o<i;++o)a.set(1,o,o);var s=nse(a.toTensor(),[e,t]);if(null==n)return s;if(1===n.length)return yse(due(s,0),[n[0],1,1]);if(2===n.length)return yse(due(due(s,0),0),[n[0],n[1],1,1]);if(3===n.length)return yse(due(due(due(s,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error("eye() currently supports only 1D and 2D "+"batchShapes, but received ".concat(n.length,"D."))}});var vue=Doe({matMul_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],a=Noe(e,"a","matMul"),i=Noe(t,"b","matMul"),o=Mie(a,i),s=f(o,2),u={a:a=s[0],b:i=s[1]},c={transposeA:n,transposeB:r};return Bie.runKernel(jre,u,c)}});var mue=Doe({neg_:function(e){var t={x:Noe(e,"x","neg")};return Bie.runKernel("Neg",t)}});var gue=Doe({transpose_:function(e,t,n){var r=Noe(e,"x","transpose");if(null==t&&(t=r.shape.map((function(e,t){return t})).reverse()),sre(r.rank===t.length,(function(){return"Error in transpose: rank of input ".concat(r.rank," ")+"must match length of perm ".concat(t,".")})),t.forEach((function(e){sre(e>=0&&e<r.rank,(function(){return"All entries in 'perm' must be between 0 and ".concat(r.rank-1)+" but got ".concat(t)}))})),r.rank<=1)return r.clone();var a={x:r},i={perm:t};return"complex64"===r.dtype?hue((function(){var e=tse(r),t=ese(r);return e=Bie.runKernel(Vae,{x:e},i),t=Bie.runKernel(Vae,{x:t},i),n&&(t=mue(t)),Zoe(e,t)})):Bie.runKernel(Vae,a,i)}});function yue(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return Bie.tidy((function(){sre(2===e.shape.length,(function(){return"qr2d() requires a 2D Tensor, but got a ".concat(e.shape.length,"D Tensor.")}));for(var n=e.shape[0],r=e.shape[1],a=pue(n),i=Ooe(e),o=mse([[1]],[1,1]),s=Ooe(o),u=n>=r?r:n,c=function(e){var t=i,u=s,c=a,l=f(Bie.tidy((function(){var t=rse(i,[e,e],[n-e,1]),u=uue(t),c=rse(i,[e,e],[1,1]),l=Use(Rse(c,0),mse([[-1]]),mse([[1]])),h=Fse(c,cse(l,u)),f=Lse(t,h);s=1===f.shape[0]?Ooe(o):$oe([o,rse(f,[1,0],[f.shape[0]-1,f.shape[1]])],0);var d=mue(Lse(vue(l,h),u)),p=rse(i,[e,0],[n-e,r]),v=cse(d,s),m=gue(s);if(0===e)i=Fse(p,vue(v,vue(m,p)));else{var g=Fse(p,vue(v,vue(m,p)));i=$oe([rse(i,[0,0],[e,r]),g],0)}var y=gue(v),b=rse(a,[0,e],[n,a.shape[1]-e]);if(0===e)a=Fse(b,vue(vue(b,s),y));else{var x=Fse(b,vue(vue(b,s),y));a=$oe([rse(a,[0,0],[n,e]),x],1)}return[s,i,a]})),3);s=l[0],i=l[1],a=l[2],fue([t,u,c])},l=0;l<u;++l)c(l);return!t&&n>r&&(a=rse(a,[0,0],[n,r]),i=rse(i,[0,0],[r,r])),[a,i]}))}var bue;Doe({qr_:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(sre(e.rank>=2,(function(){return"qr() requires input tensor to have a rank >= 2, but got rank ".concat(e.rank)})),2===e.rank)return yue(e,t);var n=e.shape.slice(0,e.shape.length-2).reduce((function(e,t){return e*t})),r=Xse(nse(e,[n,e.shape[e.shape.length-2],e.shape[e.shape.length-1]]),0),a=[],i=[];r.forEach((function(e){var n=f(yue(e,t),2),r=n[0],o=n[1];a.push(r),i.push(o)}));var o=nse(Hse(a,0),e.shape),s=nse(Hse(i,0),e.shape);return[o,s]}});!function(e){e[e.NONE=0]="NONE",e[e.MEAN=1]="MEAN",e[e.SUM=2]="SUM",e[e.SUM_BY_NONZERO_WEIGHTS=3]="SUM_BY_NONZERO_WEIGHTS"}(bue||(bue={}));var xue=Doe({mean_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Noe(e,"x","mean"),a={x:r},i={axis:t,keepDims:n};return Bie.runKernel(fae,a,i)}});var kue=Doe({notEqual_:function(e,t){var n=Noe(e,"a","notEqual","string_or_numeric"),r=Noe(t,"b","notEqual","string_or_numeric"),a=f(Mie(n,r),2);n=a[0],r=a[1],Mse(n.shape,r.shape);var i={a:n,b:r};return Bie.runKernel(mae,i)}});function wue(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"float32";if("complex64"===t){var n=wue(e,"float32"),r=Joe(e,"float32");return Zoe(n,r)}var a=Mre(hre(e),t);return Bie.makeTensor(a,e,t)}var _ue=Doe({computeWeightedLoss_:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:bue.SUM_BY_NONZERO_WEIGHTS,r=Noe(e,"losses","computeWeightedLoss"),a=null;null!=t&&(a=Noe(t,"weights","computeWeightedLoss"));var i=null==a?r:cse(r,a);if(n===bue.NONE)return i;if(n===bue.SUM)return Dse(i);if(n===bue.MEAN){if(null==a)return xue(i);var o=r.size/a.size,s=Lse(Dse(i),Dse(a));return o>1?Lse(s,Qoe(o)):s}if(n===bue.SUM_BY_NONZERO_WEIGHTS){if(null==a)return Lse(Dse(i),Qoe(r.size));var u=cse(a,wue(r.shape)),c=Poe(Dse(kue(u,Qoe(0))),"float32");return Lse(Dse(i),c)}throw Error("Unknown reduction: ".concat(n))}});Doe({absoluteDifference_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bue.SUM_BY_NONZERO_WEIGHTS,a=Noe(e,"labels","absoluteDifference"),i=Noe(t,"predictions","absoluteDifference"),o=null;null!=n&&(o=Noe(n,"weights","absoluteDifference")),ure(a.shape,i.shape,"Error in absoluteDifference: ");var s=Kse(Fse(a,i));return _ue(s,o,r)}});Doe({cosineDistance_:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bue.SUM_BY_NONZERO_WEIGHTS,i=Noe(e,"labels","cosineDistance"),o=Noe(t,"predictions","cosineDistance"),s=null;null!=r&&(s=Noe(r,"weights","cosineDistance")),ure(i.shape,o.shape,"Error in cosineDistance: ");var u=Qoe(1),c=Fse(u,Dse(cse(i,o),n,!0));return _ue(c,s,a)}});var Sue=Doe({relu_:function(e){var t={x:Noe(e,"x","relu")};return Bie.runKernel(Sae,t)}});Doe({hingeLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bue.SUM_BY_NONZERO_WEIGHTS,a=Noe(e,"labels","hingeLoss"),i=Noe(t,"predictions","hingeLoss"),o=null;null!=n&&(o=Noe(n,"weights","hingeLoss")),ure(a.shape,i.shape,"Error in hingeLoss: ");var s=Qoe(1);a=Fse(cse(Qoe(2),a),s);var u=Sue(Fse(s,cse(a,i)));return _ue(u,o,r)}});var Cue=Doe({minimum_:function(e,t){var n=Noe(e,"a","minimum"),r=Noe(t,"b","minimum"),a=f(Mie(n,r),2);n=a[0],r=a[1],"bool"===n.dtype&&(n=Poe(n,"int32"),r=Poe(r,"int32")),Mse(n.shape,r.shape);var i={a:n,b:r};return Bie.runKernel(pae,i)}});Doe({huberLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bue.SUM_BY_NONZERO_WEIGHTS,i=Noe(e,"labels","huberLoss"),o=Noe(t,"predictions","huberLoss"),s=null;null!=n&&(s=Noe(n,"weights","huberLoss")),ure(i.shape,o.shape,"Error in huberLoss: ");var u=Qoe(r),c=Kse(Fse(o,i)),l=Cue(c,u),h=Fse(c,l),f=Pse(cse(Qoe(.5),oue(l)),cse(u,h));return _ue(f,s,a)}});var Tue=Doe({log_:function(e){var t={x:Noe(e,"x","log","float32")};return Bie.runKernel("Log",t)}});Doe({logLoss_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1e-7,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bue.SUM_BY_NONZERO_WEIGHTS,i=Noe(e,"labels","logLoss"),o=Noe(t,"predictions","logLoss"),s=null;null!=n&&(s=Noe(n,"weights","logLoss")),ure(i.shape,o.shape,"Error in logLoss: ");var u=Qoe(1),c=Qoe(r),l=mue(cse(i,Tue(Pse(o,c)))),h=cse(Fse(u,i),Tue(Pse(Fse(u,o),c))),f=Fse(l,h);return _ue(f,s,a)}});var Eue=Doe({squaredDifference_:function(e,t){var n=Noe(e,"a","squaredDifference"),r=Noe(t,"b","squaredDifference"),a=f(Mie(n,r),2);n=a[0],r=a[1],Mse(n.shape,r.shape);var i={a:n,b:r};return Bie.runKernel(Fae,i,{})}});Doe({meanSquaredError_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:bue.SUM_BY_NONZERO_WEIGHTS,a=Noe(e,"labels","meanSquaredError"),i=Noe(t,"predictions","meanSquaredError"),o=null;null!=n&&(o=Noe(n,"weights","meanSquaredError")),ure(a.shape,i.shape,"Error in meanSquaredError: ");var s=Eue(a,i);return _ue(s,o,r)}});var Iue=Doe({exp_:function(e){var t={x:Noe(e,"x","exp")};return Bie.runKernel("Exp",t)}});var Aue=Doe({log1p_:function(e){var t={x:Noe(e,"x","log1p")};return Bie.runKernel(cae,t)}});function Mue(e,t){var n=Noe(e,"labels","sigmoidCrossEntropyWithLogits"),r=Noe(t,"logits","sigmoidCrossEntropyWithLogits");ure(n.shape,r.shape,"Error in sigmoidCrossEntropyWithLogits: ");var a=Sue(r),i=cse(r,n),o=Aue(Iue(mue(Kse(r))));return Pse(Fse(a,i),o)}Doe({sigmoidCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bue.SUM_BY_NONZERO_WEIGHTS,i=Noe(e,"multiClassLabels","sigmoidCrossEntropy"),o=Noe(t,"logits","sigmoidCrossEntropy"),s=null;if(null!=n&&(s=Noe(n,"weights","sigmoidCrossEntropy")),ure(i.shape,o.shape,"Error in sigmoidCrossEntropy: "),r>0){var u=Qoe(r),c=Qoe(1),l=Qoe(.5);i=Pse(cse(i,Fse(c,u)),cse(l,u))}var h=Mue(i,o);return _ue(h,s,a)}});function Nue(e){return Bie.customGrad(e)}var Rue=Doe({logSumExp_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r=Noe(e,"x","logSumExp"),a=gre(t,r.shape),i=nue(r,a,!0),o=Fse(r,i),s=Iue(o),u=Dse(s,a),c=Tue(u),l=Pse(nse(i,c.shape),c);if(n){var h=Zse(l.shape,a);return nse(l,h)}return l}});function Due(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;if(-1===n&&(n=t.rank-1),n!==t.rank-1)throw Error("Softmax cross entropy along a non-last dimension is not yet "+"supported. Labels / logits was rank ".concat(t.rank," ")+"and dim was ".concat(n));var r=Nue((function(e,t,r){var a=Rue(t,[n],!0),i=Fse(Poe(t,"float32"),a);r([e,i]);var o=mue(cse(i,e));return{value:Dse(o,[n]),gradFunc:function(e,t){var r=f(t,2),a=r[0],i=r[1],o=Zse(e.shape,[n]);return[cse(nse(e,o),Fse(Poe(a,"float32"),Iue(i))),cse(nse(e,o),Fse(Iue(i),Poe(a,"float32")))]}}}));return r(e,t)}Doe({softmaxCrossEntropy_:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:bue.SUM_BY_NONZERO_WEIGHTS,i=Noe(e,"onehotLabels","softmaxCrossEntropy"),o=Noe(t,"logits","softmaxCrossEntropy"),s=null;if(null!=n&&(s=Noe(n,"weights","softmaxCrossEntropy")),ure(i.shape,o.shape,"Error in softmaxCrossEntropy: "),r>0){var u=Qoe(r),c=Qoe(1),l=Qoe(i.shape[1]);i=Pse(cse(i,Fse(c,u)),Lse(u,l))}var h=Due(i,o);return _ue(h,s,a)}});Doe({sparseFillEmptyRows_:function(e,t,n,r){var a=Noe(e,"indices","sparseFillEmptyRows","int32"),i=Noe(t,"values","sparseFillEmptyRows"),o=Noe(n,"denseShape","sparseFillEmptyRows","int32"),s=Noe(r,"defaultValue","sparseFillEmptyRows",i.dtype);if(2!==a.rank)throw new Error("Indices should be Tensor2D but received shape\n        ".concat(a.shape));if(1!==i.rank)throw new Error("Values should be Tensor1D but received shape ".concat(i.shape));if(1!==o.rank)throw new Error("Dense shape should be Tensor1D but received shape ".concat(o.shape));if(0!==s.rank)throw new Error("Default value should be a scalar but received shape ".concat(s.shape));var u={indices:a,values:i,denseShape:o,defaultValue:s},c=Bie.runKernel("SparseFillEmptyRows",u);return{outputIndices:c[0],outputValues:c[1],emptyRowIndicator:c[2],reverseIndexMap:c[3]}}});Doe({sparseReshape_:function(e,t,n){var r=Noe(e,"inputIndices","sparseReshape","int32"),a=Noe(t,"inputShape","sparseReshape","int32"),i=Noe(n,"newShape","sparseReshape","int32");if(2!==r.rank)throw new Error("Input indices should be Tensor2D but received shape\n        ".concat(r.shape));if(1!==a.rank)throw new Error("Input shape should be Tensor1D but received shape ".concat(a.shape));if(1!==i.rank)throw new Error("New shape should be Tensor1D but received shape ".concat(i.shape));var o={inputIndices:r,inputShape:a,newShape:i},s=Bie.runKernel("SparseReshape",o);return{outputIndices:s[0],outputShape:s[1]}}});Doe({sparseSegmentMean_:function(e,t,n){var r=Noe(e,"data","sparseSegmentMean"),a=Noe(t,"indices","sparseSegmentMean","int32"),i=Noe(n,"segmentIds","sparseSegmentMean","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n          ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n          ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Bie.runKernel("SparseSegmentMean",o)}});Doe({sparseSegmentSum_:function(e,t,n){var r=Noe(e,"data","sparseSegmentSum"),a=Noe(t,"indices","sparseSegmentSum","int32"),i=Noe(n,"segmentIds","sparseSegmentSum","int32");if(r.rank<1)throw new Error("Data should be at least 1 dimensional but received scalar");if(1!==a.rank)throw new Error("Indices should be Tensor1D but received shape\n         ".concat(a.shape));if(1!==i.rank)throw new Error("Segment ids should be Tensor1D but received shape\n         ".concat(i.shape));var o={data:r,indices:a,segmentIds:i};return Bie.runKernel("SparseSegmentSum",o)}});Doe({stringNGrams_:function(e,t,n,r,a,i,o,s){var u=Noe(e,"data","stringNGrams","string");if("string"!==u.dtype)throw new Error("Data must be of datatype string");if(1!==u.shape.length)throw new Error("Data must be a vector, saw: ".concat(u.shape));var c=Noe(t,"dataSplits","stringNGrams");if("int32"!==c.dtype)throw new Error("Data splits must be of datatype int32");var l={separator:n,nGramWidths:r,leftPad:a,rightPad:i,padWidth:o,preserveShortSequences:s},h={data:u,dataSplits:c},f=Bie.runKernel("StringNGrams",h,l);return{nGrams:f[0],nGramsSplits:f[1]}}});Doe({stringSplit_:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=Noe(e,"input","stringSplit","string"),a=Noe(t,"delimiter","stringSplit","string");if(1!==r.rank)throw new Error("Input should be Tensor1D but received shape ".concat(r.shape));if(0!==a.rank)throw new Error("Delimiter should be a scalar but received shape ".concat(a.shape));var i={skipEmpty:n},o={input:r,delimiter:a},s=Bie.runKernel(zae,o,i);return{indices:s[0],values:s[1],shape:s[2]}}});Doe({stringToHashBucketFast_:function(e,t){var n=Noe(e,"input","stringToHashBucketFast","string"),r={numBuckets:t};if(t<=0)throw new Error("Number of buckets must be at least 1");var a={input:n};return Bie.runKernel("StringToHashBucketFast",a,r)}});function Pue(e,t){for(var n=e[0].slice(),r=1;r<e.length;r++)n[t]+=e[r][t];return n}function Oue(e,t,n,r,a,i){var o,s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",u=Uue(t),c=f(u,2),l=c[0],h=c[1];if("channelsLast"===s)o=[l,h,e[3],e[3]];else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));o=[l,h,e[1],e[1]]}return Fue(e,o,n,r,a,i,!1,s)}function Lue(e,t,n,r,a,i){var o,s,u=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"NDHWC",c=Vue(t),l=f(c,3),h=l[0],d=l[1],p=l[2];if("NDHWC"===u)s="channelsLast",o=[h,d,p,e[4],e[4]];else{if("NCDHW"!==u)throw new Error("Unknown dataFormat ".concat(u));s="channelsFirst",o=[h,d,p,e[1],e[1]]}return zue(e,o,n,r,a,!1,s,i)}function Fue(e,t,n,r,a,i){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=arguments.length>7&&void 0!==arguments[7]?arguments[7]:"channelsLast",u=-1,c=-1,l=-1,h=-1;if("channelsLast"===s){var d=f(e,4);u=d[0],c=d[1],l=d[2],h=d[3]}else{if("channelsFirst"!==s)throw new Error("Unknown dataFormat ".concat(s));var p=f(e,4);u=p[0],h=p[1],c=p[2],l=p[3]}var v,m=f(t,4),g=m[0],y=m[1],b=m[3],x=Uue(n),k=f(x,2),w=k[0],_=k[1],S=Uue(r),C=f(S,2),T=C[0],E=C[1],I=Wue(g,T),A=Wue(y,E),M=Gue(a,c,l,w,_,I,A,i,s),N=M.padInfo,R=M.outHeight,D=M.outWidth,P=o?b*h:b;return"channelsFirst"===s?v=[u,P,R,D]:"channelsLast"===s&&(v=[u,R,D,P]),{batchSize:u,dataFormat:s,inHeight:c,inWidth:l,inChannels:h,outHeight:R,outWidth:D,outChannels:P,padInfo:N,strideHeight:w,strideWidth:_,filterHeight:g,filterWidth:y,effectiveFilterHeight:I,effectiveFilterWidth:A,dilationHeight:T,dilationWidth:E,inShape:e,outShape:v,filterShape:t}}function zue(e,t,n,r,a){var i=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"channelsLast",s=arguments.length>7?arguments[7]:void 0,u=-1,c=-1,l=-1,h=-1,d=-1;if("channelsLast"===o){var p=f(e,5);u=p[0],c=p[1],l=p[2],h=p[3],d=p[4]}else{if("channelsFirst"!==o)throw new Error("Unknown dataFormat ".concat(o));var v=f(e,5);u=v[0],d=v[1],c=v[2],l=v[3],h=v[4]}var m,g=f(t,5),y=g[0],b=g[1],x=g[2],k=g[4],w=Vue(n),_=f(w,3),S=_[0],C=_[1],T=_[2],E=Vue(r),I=f(E,3),A=I[0],M=I[1],N=I[2],R=Wue(y,A),D=Wue(b,M),P=Wue(x,N),O=jue(a,c,l,h,S,C,T,R,D,P,s),L=O.padInfo,F=O.outDepth,z=O.outHeight,B=O.outWidth,U=i?k*d:k;return"channelsFirst"===o?m=[u,U,F,z,B]:"channelsLast"===o&&(m=[u,F,z,B,U]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:h,inChannels:d,outDepth:F,outHeight:z,outWidth:B,outChannels:U,padInfo:L,strideDepth:S,strideHeight:C,strideWidth:T,filterDepth:y,filterHeight:b,filterWidth:x,effectiveFilterDepth:R,effectiveFilterHeight:D,effectiveFilterWidth:P,dilationDepth:A,dilationHeight:M,dilationWidth:N,inShape:e,outShape:m,filterShape:t}}function Bue(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,a=Wue(t,r);return Math.floor((e[0]*(n-1)-n+a)/2)}function Uue(e){return"number"===typeof e?[e,e,e]:2===e.length?[e[0],e[1],1]:e}function Vue(e){return"number"===typeof e?[e,e,e]:e}function Wue(e,t){return t<=1?e:e+(e-1)*(t-1)}function Gue(e,t,n,r,a,i,o,s,u){var c,l,h;if("number"===typeof e){c={top:e,bottom:e,left:e,right:e,type:0===e?"VALID":"NUMBER"};var f=function(e,t,n,r,a){null==r&&(r=Bue(e,t,n));var i=e[0],o=e[1];return[que((i-t+2*r)/n+1,a),que((o-t+2*r)/n+1,a)]}([t,n],i,r,e,s);l=f[0],h=f[1]}else if("same"===e){l=Math.ceil(t/r),h=Math.ceil(n/a);var d=Math.max(0,(l-1)*r+i-t),p=Math.max(0,(h-1)*a+o-n),v=Math.floor(d/2),m=d-v,g=Math.floor(p/2);c={top:v,bottom:m,left:g,right:p-g,type:"SAME"}}else if("valid"===e)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((t-i+1)/r),h=Math.ceil((n-o+1)/a);else{if("object"!==typeof e)throw Error("Unknown padding parameter: ".concat(e));var y="channelsLast"===u?e[1][0]:e[2][0],b="channelsLast"===u?e[1][1]:e[2][1],x="channelsLast"===u?e[2][0]:e[3][0],k="channelsLast"===u?e[2][1]:e[3][1];c={top:y,bottom:b,left:x,right:k,type:0===y&&0===b&&0===x&&0===k?"VALID":"EXPLICIT"},l=que((t-i+y+b)/r+1,s),h=que((n-o+x+k)/a+1,s)}return{padInfo:c,outHeight:l,outWidth:h}}function jue(e,t,n,r,a,i,o,s,u,c,l){var h,f,d,p;if("number"===typeof e){h={top:e,bottom:e,left:e,right:e,front:e,back:e,type:0===e?"VALID":"NUMBER"};var v=function(e,t,n,r,a,i){null==a&&(a=Bue(e,t,r));var o=e[0],s=e[1],u=e[2];return[que((o-t+2*a)/r+1,i),que((s-t+2*a)/r+1,i),que((u-t+2*a)/r+1,i),n]}([t,n,r,1],s,1,a,e,l);f=v[0],d=v[1],p=v[2]}else if("same"===e){var m=((f=Math.ceil(t/a))-1)*a+s-t,g=((d=Math.ceil(n/i))-1)*i+u-n,y=((p=Math.ceil(r/o))-1)*o+c-r,b=Math.floor(m/2),x=m-b,k=Math.floor(g/2),w=g-k,_=Math.floor(y/2);h={top:k,bottom:w,left:_,right:y-_,front:b,back:x,type:"SAME"}}else{if("valid"!==e)throw Error("Unknown padding parameter: ".concat(e));h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},f=Math.ceil((t-s+1)/a),d=Math.ceil((n-u+1)/i),p=Math.ceil((r-c+1)/o)}return{padInfo:h,outDepth:f,outHeight:d,outWidth:p}}function que(e,t){if(!t)return Math.trunc(e);switch(t){case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"floor":return Math.floor(e);default:throw new Error("Unknown roundingMode ".concat(t))}}function Hue(e){var t=f(Uue(e),3),n=t[0],r=t[1],a=t[2];return 1===n&&1===r&&1===a}function Xue(e,t){return Hue(e)||Hue(t)}function Kue(e){if("NHWC"===e)return"channelsLast";if("NCHW"===e)return"channelsFirst";throw new Error("Unknown dataFormat ".concat(e))}Doe({elu_:function(e){var t={x:Noe(e,"x","elu","float32")};return Bie.runKernel("Elu",t)}});Doe({leakyRelu_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2,n=Noe(e,"x","leakyRelu"),r={x:n},a={alpha:t};return Bie.runKernel(sae,r,a)}});Doe({prelu_:function(e,t){var n={x:Noe(e,"x","prelu"),alpha:Noe(t,"alpha","prelu")};return Bie.runKernel(kae,n)}});Doe({relu6_:function(e){var t={x:Noe(e,"x","relu6")};return Bie.runKernel(Iae,t)}});Doe({sigmoid_:function(e){var t={x:Noe(e,"x","sigmoid","float32")};return Bie.runKernel(Dae,t)}});Doe({step_:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=Noe(e,"x","step"),r={x:n},a={alpha:t};return Bie.runKernel(jae,r,a)}});function Yue(e){return e<=30?e:Tre(e,Math.floor(Math.sqrt(e)))}function Que(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];if(r)(a=a.concat(t.slice(0))).push(e[0]/n),a=a.concat(e.slice(1));else{a=a.concat(e[0]);for(var i=t.length,o=0;o<i;++o)a=a.concat([e[o+1]/t[o],t[o]]);a=a.concat(e.slice(i+1))}return a}function Zue(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=[];if(n){r.push(t);for(var a=t+1;a<e;++a)a<=2*t?(r.push(a),r.push(a-(t+1))):r.push(a)}else{for(var i=[],o=[],s=1;s<e;++s)s>=2*t+1||s%2===1?o.push(s):i.push(s);r.push.apply(r,i),r.push(0),r.push.apply(r,o)}return r}function Jue(e,t,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],a=[];r?a.push(e[0]/n):a.push(e[0]*n);for(var i=1;i<e.length;++i)i<=t.length?r?a.push(t[i-1]*e[i]):a.push(e[i]/t[i-1]):a.push(e[i]);return a}function $ue(e,t,n){for(var r=t.shape.length,a=r>1?t.shape[r-1]:1,i=n.length,o=1,s=a;s<i;++s)o*=n[s];var u=a<1?1:a;return{sliceRank:a,numUpdates:hre(t.shape)/u,sliceSize:o,strides:[].concat(Tt(Ere(n.slice(0,a))),[1]),outputSize:hre(n)}}function ece(e,t){if(e.length!==t.length)throw new Error("Cannot merge real and imag arrays of different lengths. real:"+"".concat(e.length,", imag: ").concat(t.length,"."));for(var n=new Float32Array(2*e.length),r=0;r<n.length;r+=2)n[r]=e[r/2],n[r+1]=t[r/2];return n}/iPad|iPhone|iPod/.test(navigator.userAgent);var tce=Jn((function e(t,n){if($n(this,e),void 0===t)throw Error("`kernel` is undefined.");if(void 0===n)throw Error("`bias` is undefined.");this.kernel=t,this.bias=n}));function nce(e,t){return t.matMul(e.kernel).add(e.bias)}var rce=Jn((function e(){$n(this,e)})),ace=function(){function e(t,n){$n(this,e),this.lstmFwVars=t,this.lstmBwVars=n}return Jn(e,[{key:"process",value:function(e){var t=this;return bm((function(){return[t.singleDirection(e,!0),t.singleDirection(e,!1)]}))}},{key:"singleDirection",value:function(e,t){var n,r=e.shape[0],a=e.shape[1],i=t?this.lstmFwVars:this.lstmBwVars,o=[iy([r,i.bias.shape[0]/4]),iy([r,i.bias.shape[0]/4])],s=_m(1),u=function(e,t){return $m(s,i.kernel,i.bias,e,t[0],t[1])},c=Ey(e.toFloat(),a,1),l=[],h=al(t?c:c.reverse());try{for(h.s();!(n=h.n()).done;){o=u(n.value.squeeze([1]),o),l.push(o[1])}}catch($Pe){h.e($Pe)}finally{h.f()}return t?l:l.reverse()}}]),e}(),ice=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;return $n(this,n),(i=t.call(this)).bidirectionalLstm=new ace(e,r),i.muVars=a,i.zDims=a?i.muVars.bias.shape[0]:null,i}return Jn(n,[{key:"encode",value:function(e,t){var n=this;if(t)throw new Error("Variable-length segments not supported in flat encoder");return bm((function(){var t=f(n.bidirectionalLstm.process(e),2),r=t[0],a=t[1],i=Xm([r[r.length-1],a[0]],1);return n.muVars?nce(n.muVars,i):i}))}}]),n}(rce),oce=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;return $n(this,n),(i=t.call(this)).baseEncoders=e,i.numSteps=r,i.muVars=a,i.zDims=i.muVars.bias.shape[0],i}return Jn(n,[{key:"encode",value:function(e,t){var n=this;if(t){if(1!==e.shape[0])throw new Error("When using variable-length segments, batch size must be 1.");if(t.length!==this.numSteps[0])throw new Error("Must provide length for all variable-length segments.")}return bm((function(){for(var r=e,a=0;a<n.baseEncoders.length;++a){for(var i=n.numSteps[a],o=Ey(r,i,1),s=[],u=0;u<i;++u)s.push(n.baseEncoders[a].encode(0===a&&t?_y(o[u],[0,0,0],[1,t[u],-1]):o[u]));r=My(s,1)}return nce(n.muVars,r.squeeze([1]))}))}}]),n}(rce);function sce(e,t,n){for(var r=[],a=[],i=[],o=Ey(nce(n,e).tanh(),2*t.length,1),s=function(e){var n=t[e],s=_m(1);r.push((function(e,t,r){return $m(s,n.kernel,n.bias,e,t,r)})),a.push(o[2*e]),i.push(o[2*e+1])},u=0;u<t.length;++u)s(u);return{cell:r,c:a,h:i}}var uce=Jn((function e(){$n(this,e)})),cce=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i,o,s){var u;return $n(this,n),(u=t.call(this)).lstmCellVars=e,u.zToInitStateVars=r,u.outputProjectVars=a,u.zDims=u.zToInitStateVars.kernel.shape[0],u.outputDims=i||a.bias.shape[0],o&&s&&(u.controlBidirectionalLstm=new ace(o,s)),u}return Jn(n,[{key:"decode",value:function(e,t,n,r,a){var i=this,o=e.shape[0];return bm((function(){var s=sce(e,i.lstmCellVars,i.zToInitStateVars),u=a?wg(a,0):void 0,c=[],l=n||iy([o,i.outputDims]);if(i.controlBidirectionalLstm){var h=f(i.controlBidirectionalLstm.process(u),2),d=h[0],p=h[1];u=Xm([My(d,1),My(p,1)],2)}for(var v=u?Ey(_g(u,[o,1,1]),a.shape[0],1):void 0,m=0;m<t;++m){var g=v?[l,e,Ay(v[m],[1])]:[l,e],y=f(ey(s.cell,Xm(g,1),s.c,s.h),2);s.c=y[0],s.h=y[1];var b=nce(i.outputProjectVars,s.h[s.h.length-1]);l=i.sample(b,r),c.push(l)}return My(c,1)}))}}]),n}(uce),lce=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"sample",value:function(e,t){var n=e;return(t?Ag(Qm(n.div(_m(t))),vy(n.shape)):Ag(n,0)).toFloat()}}]),n}(cce),hce=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"sample",value:function(e,t){var n=e,r=t?ty(n.div(_m(t)),1).as1D():n.argMax(1).as1D();return ay(r,this.outputDims).toFloat()}}]),n}(cce),fce=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i,o,s){var u;return $n(this,n),(u=t.call(this,e,r,a,i.numDims,o,s)).nade=i,u}return Jn(n,[{key:"sample",value:function(e,t){var n=f(Ey(e,[this.nade.numHidden,this.nade.numDims],1),2),r=n[0],a=n[1];return this.nade.sample(r,a)}}]),n}(cce),dce=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"sample",value:function(e,t){var n=f(Ey(e,3,1),3),r=n[0],a=n[1],i=n[2];if(a=Qm(a),i=Jm(i),t){r=Qm(r.div(_m(t)));var o=vy(r.shape,0,1);r=Ig(r,o).toFloat()}else r=Ig(Qm(r),.5).toFloat();return Xm([r,a,i],1)}}]),n}(cce),pce=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).coreDecoders=e,r.numDecoders=r.coreDecoders.length,r.zDims=r.coreDecoders[0].zDims,r.outputDims=r.coreDecoders.reduce((function(e,t){return e+t.outputDims}),0),r}return Jn(n,[{key:"decodeSeparately",value:function(e,t,n,r,a){for(var i=[],o=0;o<this.coreDecoders.length;++o)i.push(this.coreDecoders[o].decode(e,t,n[o],r,a));return i}},{key:"decode",value:function(e,t,n,r,a){var i=this;return bm((function(){var o=i.decodeSeparately(e,t,i.coreDecoders.map((function(e){return n})),r,a);return Xm(o,-1)}))}}]),n}(uce),vce=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i){var o;return $n(this,n),(o=t.call(this)).splitDecoder=new pce(e),o.lstmCellVars=r,o.zToInitStateVars=a,o.numSteps=i,o.zDims=o.zToInitStateVars.kernel.shape[0],o.outputDims=o.splitDecoder.outputDims,o}return Jn(n,[{key:"decode",value:function(e,t,n,r,a){var i=this,o=e.shape[0];return bm((function(){for(var n=sce(e,i.lstmCellVars,i.zToInitStateVars),s=[],u=new Array(i.splitDecoder.numDecoders).fill(void 0),c=iy([o,1]),l=a?Ey(a,i.numSteps):void 0,h=0;h<i.numSteps;++h){var d=f(ey(n.cell,c,n.c,n.h),2);n.c=d[0],n.h=d[1];var p=i.splitDecoder.decodeSeparately(n.h[n.h.length-1],t/i.numSteps,u,r,l?l[h]:void 0);s.push(Xm(p,-1)),u=p.map((function(e){return e.slice([0,e.shape[1]-1,0],[o,1,e.shape[e.rank-1]]).squeeze([1]).toFloat()}))}return Xm(s,1)}))}}]),n}(uce),mce=function(){function e(t,n){$n(this,e),this.numDims=t.shape[0],this.numHidden=t.shape[2],this.encWeights=t.as2D(this.numDims,this.numHidden),this.decWeightsT=n.as2D(this.numDims,this.numHidden)}return Jn(e,[{key:"sample",value:function(e,t){var n=this,r=e.shape[0];return bm((function(){for(var a=[],i=e.clone(),o=0;o<n.numDims;o++){var s=Qm(i),u=n.encWeights.slice([o,0],[1,n.numHidden]).as1D(),c=n.decWeightsT.slice([o,0],[1,n.numHidden]),l=t.slice([0,o],[r,1]).add(Km(s,c,!1,!0)).sigmoid().greaterEqual(_m(.5)).toFloat().as1D();o<n.numDims-1&&(i=i.add(uy(l.toFloat(),u))),a.push(l)}return My(a,1)}))}}]),e}(),gce=function(){function e(t,n){$n(this,e),this.initialized=!1,this.checkpointURL=t,this.spec=n}return Jn(e,[{key:"instantiateFromSpec",value:function(){this.dataConverter=function(e){switch(e.type){case"MelodyConverter":return new W2(e.args);case"MelodyRhythmConverter":return new j2(e.args);case"MelodyShapeConverter":return new q2(e.args);case"DrumsConverter":return new B2(e.args);case"DrumRollConverter":return new U2(e.args);case"TrioConverter":return new H2(e.args);case"TrioRhythmConverter":return new X2(e.args);case"DrumsOneHotConverter":return new V2(e.args);case"MultitrackConverter":return new K2(e.args);case"GrooveConverter":return new Y2(e.args);default:throw new Error("Unknown DataConverter type: ".concat(e))}}(this.spec.dataConverter),this.chordEncoder=this.spec.chordEncoder?function(e){switch(e){case"MajorMinorChordEncoder":return new i2;case"TriadChordEncoder":return new o2;case"PitchChordEncoder":return new s2;default:throw new Error("Unknown chord encoder type: ".concat(e))}}(this.spec.chordEncoder):void 0}},{key:"dispose",value:function(){var e=this;void 0!==this.rawVars&&Object.keys(this.rawVars).forEach((function(t){return e.rawVars[t].dispose()})),this.encoder=void 0,this.decoder=void 0,this.initialized=!1}},{key:"getLstmLayers",value:function(e,t){for(var n=[],r=0;;){var a=e.replace("%d",r.toString());if(!(a+"kernel"in t))break;n.push(new tce(t[a+"kernel"],t[a+"bias"])),++r}return n}},{key:"initialize",value:function(){var e=ns(es().mark((function e(){var t,n,r,a,i,o,s,u,c,l,h,f,d,p,v,m,g,y,b,x,k,w,_,S,C=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.dispose(),t=v2.now(),this.spec){e.next=5;break}return e.next=5,p2("".concat(this.checkpointURL,"/config.json")).then((function(e){return e.json()})).then((function(e){if("MusicVAE"!==e.type)throw new Error("Attempted to instantiate MusicVAE model with incorrect type:\n                  ".concat(e.type));C.spec=e}));case 5:return this.instantiateFromSpec(),r="multi_rnn_cell/".concat(n="cell_%d/lstm_cell/"),a="decoder/hierarchical_level_0/",o="encoder/".concat(i="cell_%d/bidirectional_rnn/%s/multi_rnn_cell/cell_0/lstm_cell/"),s="encoder/hierarchical_level_%d/".concat(i.replace("%d","0")),u="control_preprocessing/".concat(i),e.next=15,p2("".concat(this.checkpointURL,"/weights_manifest.json")).then((function(e){return e.json()})).then((function(e){return qv(e,C.checkpointURL)}));case 15:if(c=e.sent,this.rawVars=c,l=new tce(c["encoder/mu/kernel"],c["encoder/mu/bias"]),!this.dataConverter.numSegments){e.next=27;break}if(h=this.getLstmLayers(s.replace("%s","fw"),c),f=this.getLstmLayers(s.replace("%s","bw"),c),h.length===f.length&&2===h.length){e.next=23;break}throw Error("Only 2 hierarchical encoder levels are supported. "+"Got ".concat(h.length," forward and ").concat(f.length," ")+"backward.");case 23:d=[0,1].map((function(e){return new ice(h[e],f[e])})),this.encoder=new oce(d,[this.dataConverter.numSegments,1],l),e.next=32;break;case 27:if(p=this.getLstmLayers(o.replace("%s","fw"),c),v=this.getLstmLayers(o.replace("%s","bw"),c),p.length===v.length&&1===p.length){e.next=31;break}throw Error("Only single-layer bidirectional encoders are supported. "+"Got ".concat(p.length," forward and ").concat(v.length," ")+"backward.");case 31:this.encoder=new ice(p[0],v[0],l);case 32:if(m="".concat(u.replace("%s","fw").replace("%d","0"),"kernel")in c,g=this.dataConverter.numSegments?"core_decoder/":"",y=[],this.dataConverter.NUM_SPLITS)for(b=0;b<this.dataConverter.NUM_SPLITS;++b)y.push("".concat(g,"core_decoder_").concat(b,"/decoder/"));else y.push("".concat(g,"decoder/"));if(x=[null],k=[null],!m){e.next=43;break}if(x=this.getLstmLayers(u.replace("%s","fw"),c),k=this.getLstmLayers(u.replace("%s","bw"),c),x.length===k.length&&1===x.length){e.next=43;break}throw Error("Only single-layer bidirectional control preprocessing is supported. Got "+"".concat(x.length," forward and ").concat(k.length," backward."));case 43:w=y.map((function(e){var t=C.getLstmLayers(e+r,c),n=new tce(c["".concat(e,"z_to_initial_state/kernel")],c["".concat(e,"z_to_initial_state/bias")]),a=new tce(c["".concat(e,"output_projection/kernel")],c["".concat(e,"output_projection/bias")]);return"".concat(e,"nade/w_enc")in c?new fce(t,n,a,new mce(c["".concat(e,"nade/w_enc")],c["".concat(e,"nade/w_dec_t")]),x[0],k[0]):"GrooveConverter"===C.spec.dataConverter.type?new dce(t,n,a,void 0,x[0],k[0]):C.spec.useBooleanDecoder?new lce(t,n,a,void 0,x[0],k[0]):new hce(t,n,a,void 0,x[0],k[0])})),this.dataConverter.numSegments?(_=this.getLstmLayers(a+n,c),S=new tce(c["".concat(a,"initial_state/kernel")],c["".concat(a,"initial_state/bias")]),this.decoder=new vce(w,_,S,this.dataConverter.numSegments)):1===w.length?this.decoder=w[0]:this.decoder=new pce(w),this.zDims=this.decoder.zDims,this.initialized=!0,g2("Initialized model",t,"MusicVAE");case 48:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isInitialized",value:function(){return this.initialized}},{key:"checkControlArgs",value:function(e){var t=(e=e||{}).extraControls||{};if(this.chordEncoder&&!e.chordProgression)throw new Error("Chord progression expected but not provided.");if(!this.chordEncoder&&e.chordProgression)throw new Error("Unexpected chord progression provided.");if(this.chordEncoder&&this.dataConverter.endTensor&&e.chordProgression.length>1)throw new Error("Multiple chords not supported when using variable-length segments.");if(this.spec.conditionOnKey&&null==e.key)throw new Error("Key expected but not provided.");if(!this.spec.conditionOnKey&&null!=e.key)throw new Error("Unexpected key provided.");if(this.spec.extraControls){var n,r=al(this.spec.extraControls);try{for(r.s();!(n=r.n()).done;){var a=n.value;if(!(a.name in t))throw new Error("Missing control signal: ".concat(a.name));if(t[a.name].shape[1]!==a.depth)throw new Error("Control signal ".concat(a.name," has invalid depth: ").concat(t[a.name].shape[1]," != ").concat(a.depth))}}catch($Pe){r.e($Pe)}finally{r.f()}}var i=this.spec.extraControls?new Set(this.spec.extraControls.map((function(e){return e.name}))):new Set;for(var o in t)i.has(o)||m2("Unspecified control signal provided: ".concat(o),"MusicVAE",5)}},{key:"controlArgsToTensor",value:function(e){var t=this;return e=e||{},bm((function(){var n=[];if(e.chordProgression){var r=t.encodeChordProgression(e.chordProgression);n.push(r)}if(null!=e.key){var a=ay(Cg([t.dataConverter.numSteps],e.key,"int32"),12);n.push(a)}if(e.extraControls){var i,o=al(t.spec.extraControls);try{for(o.s();!(i=o.n()).done;){var s=i.value;n.push(e.extraControls[s.name])}}catch($Pe){o.e($Pe)}finally{o.f()}}return n.length?sg(n,1):void 0}))}},{key:"interpolateTensors",value:function(){var e=ns(es().mark((function e(t,n,r,a){var i,o,s,u=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initialized){e.next=3;break}return e.next=3,this.initialize();case 3:return e.next=5,this.encodeTensors(t,a);case 5:return i=e.sent,o=bm((function(){return u.getInterpolatedZs(i,n)})),i.dispose(),e.next=10,this.decodeTensors(o,r,a);case 10:return s=e.sent,o.dispose(),e.abrupt("return",s);case 13:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"interpolate",value:function(){var e=ns(es().mark((function e(t,n,r,a){var i,o,s,u,c=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkControlArgs(a),this.initialized){e.next=4;break}return e.next=4,this.initialize();case 4:return i=0,e.next=7,this.encode(t,a);case 7:return o=e.sent,s=bm((function(){return c.getInterpolatedZs(o,n)})),o.dispose(),u=this.decode(s,r,a),s.dispose(),u.then((function(){return g2("Interpolation completed",i,"MusicVAE",20)})),e.abrupt("return",u);case 14:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a){return e.apply(this,arguments)}}()},{key:"getSegmentLengths",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,s,u,c,l=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t.shape[0]>1)){e.next=2;break}throw new Error("Variable-length segments not supported for batch size > 1.");case 2:return n=this.dataConverter.numSteps,r=this.dataConverter.numSegments,a=bm((function(){return Gg(kg(t.squeeze([0]),l.dataConverter.endTensor.expandDims(0)),1)})),e.next=7,a.data();case 7:for(i=e.sent,a.dispose(),o=n/r,s=[],u=0,c=i.indexOf(1);-1!==c;)s.push(c-u+1),u+=o,c=i.indexOf(1,u);if(s.length===r){e.next=16;break}throw new Error("Incorrect number of segments: ".concat(s.length," != ").concat(r));case 16:return e.abrupt("return",s);case 17:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"encodeChordProgression",value:function(e){var t=this.dataConverter.numSteps,n=this.dataConverter.numSegments,r=this.dataConverter.SEGMENTED_BY_TRACK?t/n:t,a=this.dataConverter.SEGMENTED_BY_TRACK?sg([this.chordEncoder.encode(J1).expandDims(0),this.chordEncoder.encodeProgression(e,r-1)],0):this.chordEncoder.encodeProgression(e,r);return this.dataConverter.SEGMENTED_BY_TRACK?_g(a,[n,1]):a}},{key:"encodeTensors",value:function(){var e=ns(es().mark((function e(t,n){var r,a=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkControlArgs(n),this.initialized){e.next=4;break}return e.next=4,this.initialize();case 4:if(!this.dataConverter.endTensor){e.next=10;break}return e.next=7,this.getSegmentLengths(t);case 7:e.t0=e.sent,e.next=11;break;case 10:e.t0=void 0;case 11:return r=e.t0,e.abrupt("return",bm((function(){var e=a.controlArgsToTensor(n),i=[t];if(e){var o=_g(wg(e,0),[t.shape[0],1,1]);i.push(o)}var s=ug(i,2);return a.encoder.encode(s,r)})));case 13:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"encode",value:function(){var e=ns(es().mark((function e(t,n){var r,a,i,o=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.initialized){e.next=3;break}return e.next=3,this.initialize();case 3:return r=v2.now(),a=bm((function(){return My(t.map((function(e){return o.dataConverter.toTensor(e)})))})),e.next=7,this.encodeTensors(a,n);case 7:return i=e.sent,a.dispose(),g2("Encoding completed",r,"MusicVAE",20),e.abrupt("return",i);case 11:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"decodeTensors",value:function(){var e=ns(es().mark((function e(t,n,r){var a=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkControlArgs(r),this.initialized){e.next=4;break}return e.next=4,this.initialize();case 4:return e.abrupt("return",bm((function(){var e=a.controlArgsToTensor(r);return a.decoder.decode(t,a.dataConverter.numSteps,void 0,n,e)})));case 5:case"end":return e.stop()}}),e,this)})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"decode",value:function(){var e=ns(es().mark((function e(t,n,r){var a,i,o,s,u,c,l,h,f,d=arguments;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=d.length>3&&void 0!==d[3]?d[3]:4,i=d.length>4&&void 0!==d[4]?d[4]:Y1,this.initialized){e.next=5;break}return e.next=5,this.initialize();case 5:return o=v2.now(),e.next=8,this.decodeTensors(t,n,r);case 8:s=e.sent,u=bm((function(){return Ey(s,s.shape[0]).map((function(e){return e.squeeze([0])}))})),c=[],l=al(u),e.prev=12,l.s();case 14:if((h=l.n()).done){e.next=24;break}return f=h.value,e.t0=c,e.next=19,this.dataConverter.toNoteSequence(f,a,i);case 19:e.t1=e.sent,e.t0.push.call(e.t0,e.t1),f.dispose();case 22:e.next=14;break;case 24:e.next=29;break;case 26:e.prev=26,e.t2=e.catch(12),l.e(e.t2);case 29:return e.prev=29,l.f(),e.finish(29);case 32:return s.dispose(),g2("Decoding completed",o,"MusicVAE",20),e.abrupt("return",c);case 35:case"end":return e.stop()}}),e,this,[[12,26,29,32]])})));return function(t,n,r){return e.apply(this,arguments)}}()},{key:"getInterpolatedZs",value:function(e,t){if("number"===typeof t&&(t=[t]),2!==e.shape[0]&&4!==e.shape[0])throw new Error("Invalid number of input sequences. Requires length 2, or 4");if(1!==t.length&&2!==t.length)throw new Error("Invalid number of dimensions. Requires length 1, or 2.");var n=t[0],r=2===t.length?t[1]:n;return bm((function(){var t=Ng(0,1,n),a=e.slice([0,0],[1,e.shape[1]]).as1D(),i=e.slice([1,0],[1,e.shape[1]]).as1D();if(2===e.shape[0]){var o=i.sub(a);return uy(t,o).add(a)}if(4===e.shape[0]){var s=Ng(0,1,r),u=e.slice([2,0],[1,e.shape[1]]).as1D(),c=e.slice([3,0],[1,e.shape[1]]).as1D(),l=_m(1).sub(t),h=_m(1).sub(s),f=a.mul(uy(h,l).as3D(r,n,1));return f=Vy(f,i.mul(uy(s,l).as3D(r,n,1))),f=Vy(f,u.mul(uy(h,t).as3D(r,n,1))),(f=Vy(f,c.mul(uy(s,t).as3D(r,n,1)))).as2D(n*r,e.shape[1])}throw new Error("Invalid number of note sequences. Requires length 2, or 4")}))}},{key:"sampleTensors",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o=this,s=arguments;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=s.length>1&&void 0!==s[1]?s[1]:.5,r=s.length>2?s[2]:void 0,this.checkControlArgs(r),this.initialized){e.next=6;break}return e.next=6,this.initialize();case 6:return a=bm((function(){return py([t,o.decoder.zDims])})),e.next=9,this.decodeTensors(a,n,r);case 9:return i=e.sent,a.dispose(),e.abrupt("return",i);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"sample",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,s,u,c=this,l=arguments;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=l.length>1&&void 0!==l[1]?l[1]:.5,r=l.length>2?l[2]:void 0,a=l.length>3&&void 0!==l[3]?l[3]:4,i=l.length>4&&void 0!==l[4]?l[4]:Y1,this.checkControlArgs(r),this.initialized){e.next=8;break}return e.next=8,this.initialize();case 8:return o=v2.now(),s=bm((function(){return py([t,c.decoder.zDims])})),u=this.decode(s,n,r,a,i),s.dispose(),u.then((function(){return g2("Sampling completed",o,"MusicVAE",20)})),e.abrupt("return",u);case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"similarTensors",value:function(){var e=ns(es().mark((function e(t,n,r,a,i){var o,s,u,c,l=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r<0||r>1)){e.next=2;break}throw new Error("Similarity must be between 0 and 1.");case 2:if(this.initialized){e.next=5;break}return e.next=5,this.initialize();case 5:return o=wg(t,0),e.next=8,this.encodeTensors(o,i);case 8:return s=e.sent,o.dispose(),u=bm((function(){var e=py([n,l.decoder.zDims]);return Tm(s.mul(r),e.mul(1-r))})),s.dispose(),e.next=14,this.decodeTensors(u,a,i);case 14:return c=e.sent,u.dispose(),e.abrupt("return",c);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,i){return e.apply(this,arguments)}}()},{key:"similar",value:function(){var e=ns(es().mark((function e(t,n,r,a,i){var o,s,u,c,l=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.checkControlArgs(i),!(r<0||r>1)){e.next=3;break}throw new Error("Similarity must be between 0 and 1.");case 3:if(this.initialized){e.next=6;break}return e.next=6,this.initialize();case 6:return o=0,e.next=9,this.encode([t],i);case 9:return s=e.sent,u=bm((function(){var e=py([n,l.decoder.zDims]);return Tm(s.mul(r),e.mul(1-r))})),s.dispose(),c=this.decode(u,a,i),u.dispose(),c.then((function(){return g2("Similar sequence generation completed",o,"MusicVAE",20)})),e.abrupt("return",c);case 16:case"end":return e.stop()}}),e,this)})));return function(t,n,r,a,i){return e.apply(this,arguments)}}()}]),e}();var yce,bce;!function(e){e[e.None=0]="None",e[e.C=1]="C",e[e.Cs=2]="Cs",e[e.D=3]="D",e[e.Eb=4]="Eb",e[e.E=5]="E",e[e.F=6]="F",e[e.Fs=7]="Fs",e[e.G=8]="G",e[e.Ab=9]="Ab",e[e.A=10]="A",e[e.Bb=11]="Bb",e[e.B=12]="B"}(yce||(yce={})),function(e){e[e.None=0]="None",e[e.Maj=1]="Maj",e[e.Min=2]="Min",e[e.Aug=3]="Aug",e[e.Dim=4]="Dim",e[e.Seven=5]="Seven",e[e.Maj7=6]="Maj7",e[e.Min7=7]="Min7",e[e.Min7b5=8]="Min7b5"}(bce||(bce={}));__webpack_require__(567),__webpack_require__(8383),__webpack_require__(6800);var xce=16e3;!function(e){if(e=l2?44100:e,h2)throw new Error("Cannot use offline audio context in a web worker.");var t=c2.webkitOfflineAudioContext;l2?new t(1,e,e):new c2.OfflineAudioContext(1,e,e)}(xce);var kce,wce,_ce,Sce={},Cce={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function Tce(e){if(!(e in Sce)){var t=function(e){if(1!==e&&2!==e)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");var t=function(e){if("undefined"!==typeof OffscreenCanvas&&2===e)return new OffscreenCanvas(300,150);if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}(e);if(t.addEventListener("webglcontextlost",(function(t){t.preventDefault(),delete Sce[e]}),!1),1===e)return t.getContext("webgl",Cce)||t.getContext("experimental-webgl",Cce);return t.getContext("webgl2",Cce)}(e);if(null===t)return console.log("Could not get context for WebGL version",e),null;Sce[e]=t}var n=Sce[e];return n.isContextLost()?(delete Sce[e],Tce(e)):(n.disable(n.DEPTH_TEST),n.disable(n.STENCIL_TEST),n.disable(n.BLEND),n.disable(n.DITHER),n.disable(n.POLYGON_OFFSET_FILL),n.disable(n.SAMPLE_COVERAGE),n.enable(n.SCISSOR_TEST),n.enable(n.CULL_FACE),n.cullFace(n.BACK),Sce[e])}function Ece(e,t){return[t,e]}function Ice(e){var t=hre(e);return pre(Math.ceil(t/4))}function Ace(e,t){return[Math.max(1,Math.ceil(t/2)),Math.max(1,Math.ceil(e/2))]}function Mce(e,t){var n,r,a,i,o,s,u,c,l,h=e;return 2===zre().getNumber("WEBGL_VERSION")?(n=h.R32F,r=h.R16F,a=h.RGBA16F,i=h.RGBA32F,o=h.RED,s=4,u=1,c=h.HALF_FLOAT,l=h.FLOAT):(n=e.RGBA,r=e.RGBA,a=e.RGBA,i=h.RGBA,o=e.RGBA,s=4,u=4,c=null!=t?t.HALF_FLOAT_OES:null,l=e.FLOAT),{internalFormatFloat:n,internalFormatHalfFloat:r,internalFormatPackedHalfFloat:a,internalFormatPackedFloat:i,textureFormatFloat:o,downloadTextureFormat:e.RGBA,downloadUnpackNumChannels:s,defaultNumChannels:u,textureTypeHalfFloat:c,textureTypeFloat:l}}function Nce(e,t){var n=t();return zre().getBool("DEBUG")&&function(e){var t=e.getError();if(t!==e.NO_ERROR)throw new Error("WebGL Error: "+function(e,t){switch(t){case e.NO_ERROR:return"NO_ERROR";case e.INVALID_ENUM:return"INVALID_ENUM";case e.INVALID_VALUE:return"INVALID_VALUE";case e.INVALID_OPERATION:return"INVALID_OPERATION";case e.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case e.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case e.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return"Unknown error code ".concat(t)}}(e,t))}(e),n}!function(e){e[e.DENSE=0]="DENSE",e[e.SHARED_BATCH=1]="SHARED_BATCH"}(kce||(kce={})),function(e){e[e.RENDER=0]="RENDER",e[e.UPLOAD=1]="UPLOAD",e[e.PIXELS=2]="PIXELS",e[e.DOWNLOAD=3]="DOWNLOAD"}(wce||(wce={})),function(e){e[e.UNPACKED_FLOAT16=0]="UNPACKED_FLOAT16",e[e.UNPACKED_FLOAT32=1]="UNPACKED_FLOAT32",e[e.PACKED_4X1_UNSIGNED_BYTE=2]="PACKED_4X1_UNSIGNED_BYTE",e[e.PACKED_2X2_FLOAT32=3]="PACKED_2X2_FLOAT32",e[e.PACKED_2X2_FLOAT16=4]="PACKED_2X2_FLOAT16"}(_ce||(_ce={}));function Rce(e){return!!(zre().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===e||5.96e-8<Math.abs(e)&&Math.abs(e)<65504)}function Dce(e,t){return Hce(e,(function(){return e.getExtension(t)}),'Extension "'+t+'" not supported on this browser.')}function Pce(e,t){var n=Hce(e,(function(){return e.createShader(e.FRAGMENT_SHADER)}),"Unable to create fragment WebGLShader.");if(Nce(e,(function(){return e.shaderSource(n,t)})),Nce(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw function(e,t){var n=Fce.exec(t);if(null==n)return console.log("Couldn't parse line number in error: ".concat(t)),void console.log(e);for(var r=+n[1],a=e.split("\n"),i=a.length.toString().length+2,o=a.map((function(e,t){return vre((t+1).toString(),i)+e})),s=0,u=0;u<o.length;u++)s=Math.max(o[u].length,s);var c=o.slice(0,r-1),l=o.slice(r-1,r),h=o.slice(r);console.log(c.join("\n")),console.log(t.split("\n")[0]),console.log("%c ".concat(vre(l[0],s)),"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(h.join("\n"))}(t,e.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}var Oce,Lce,Fce=/ERROR: [0-9]+:([0-9]+):/g;function zce(e,t){if(Nce(e,(function(){return e.validateProgram(t)})),!1===e.getProgramParameter(t,e.VALIDATE_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Shader program validation failed.")}function Bce(e,t,n,r,a,i,o){var s=e.getAttribLocation(t,n);return-1!==s&&(Nce(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,r)})),Nce(e,(function(){return e.vertexAttribPointer(s,a,e.FLOAT,!1,i,o)})),Nce(e,(function(){return e.enableVertexAttribArray(s)})),!0)}function Uce(e,t,n){return Hce(e,(function(){return e.getUniformLocation(t,n)}),'uniform "'+n+'" not present in program.')}function Vce(e,t,n){return e.getUniformLocation(t,n)}function Wce(e,t,n,r){Nce(e,(function(){return function(e,t,n){Xce(e,n),Nce(e,(function(){return e.activeTexture(e.TEXTURE0+n)})),Nce(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)}))}(e,t,r)})),Nce(e,(function(){return e.uniform1i(n,r)}))}function Gce(e,t,n){Nce(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,n)})),Nce(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0)}))}function jce(e,t){Nce(e,(function(){return e.bindFramebuffer(e.FRAMEBUFFER,t)})),Nce(e,(function(){return e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,null,0)}))}function qce(e){var t=e.checkFramebufferStatus(e.FRAMEBUFFER);if(t!==e.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+function(e,t){switch(t){case e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case e.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return"unknown error ".concat(t)}}(e,t))}function Hce(e,t,n){var r=Nce(e,(function(){return t()}));if(null==r)throw new Error(n);return r}function Xce(e,t){var n=e.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,r=t+e.TEXTURE0;if(r<e.TEXTURE0||r>n){var a="[gl.TEXTURE0, gl.TEXTURE".concat(n,"]");throw new Error("textureUnit must be in ".concat(a,"."))}}function Kce(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return hre(e.slice(0,e.length-t))}function Yce(e){if(0===e.length)throw Error("Cannot get rows and columns of an empty shape array.");return[e.length>1?e[e.length-2]:1,e[e.length-1]]}function Qce(e){var t=[1,1,1];return 0===e.length||1===e.length&&1===e[0]||(t=[Kce(e)].concat(Tt(Yce(e)))),t}function Zce(e){return e%2===0}function Jce(e,t){if(fre(e=e.slice(-2),t=t.slice(-2)))return!0;if(!e.length||!t.length)return!0;if(0===e[0]||0===e[1]||0===t[0]||0===t[1])return!0;if(e.length!==t.length){var n=e.slice(-1)[0],r=t.slice(-1)[0];if(n===r)return!0;if(Zce(n)&&Zce(r)&&(1===e[0]||1===t[0]))return!0}return e[1]===t[1]&&Zce(e[0])&&Zce(t[0])}function $ce(e,t){return null!=e.getExtension(t)}function ele(e){try{if(null!=Tce(e))return!0}catch(t){return console.log("Error when getting WebGL context: ",t),!1}return!1}function tle(e){if(0===e)return!1;var t=Tce(e);if(1!==e){if($ce(t,"EXT_color_buffer_float"))return nle(t);var n="EXT_color_buffer_half_float";if($ce(t,n)){var r=t.getExtension(n);return function(e,t){var n=Mce(e,t),r=e.createTexture();e.bindTexture(e.TEXTURE_2D,r);var a=1,i=1;e.texImage2D(e.TEXTURE_2D,0,n.internalFormatHalfFloat,a,i,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);var o=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,o),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,r,0);var s=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(r),e.deleteFramebuffer(o),s}(t,r)}return!1}return!!$ce(t,"OES_texture_float")&&(!!$ce(t,"WEBGL_color_buffer_float")&&nle(t))}function nle(e){var t=Mce(e),n=e.createTexture();e.bindTexture(e.TEXTURE_2D,n);e.texImage2D(e.TEXTURE_2D,0,t.internalFormatFloat,1,1,0,t.textureFormatFloat,t.textureTypeFloat,null);var r=e.createFramebuffer();e.bindFramebuffer(e.FRAMEBUFFER,r),e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,n,0);var a=e.checkFramebufferStatus(e.FRAMEBUFFER)===e.FRAMEBUFFER_COMPLETE;return e.bindTexture(e.TEXTURE_2D,null),e.bindFramebuffer(e.FRAMEBUFFER,null),e.deleteTexture(n),e.deleteFramebuffer(r),a}function rle(e,t){Array.isArray(e)||(e=[e]),e.forEach((function(e){null!=e&&sre("complex64"!==e.dtype,(function(){return"".concat(t," does not support complex64 tensors ")+"in the WebGL backend."}))}))}var ale=zre();function ile(){var e,t,n,r,a,i,o,s,u,c;return 2===zre().getNumber("WEBGL_VERSION")?(e="#version 300 es",t="in",n="out",r="in",a="texture",i="outputColor",o="out vec4 outputColor;",s="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(e="",t="attribute",n="varying",r="varying",a="texture2D",i="gl_FragColor",o="",s="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:e,attribute:t,varyingVs:n,varyingFs:r,texture2D:a,output:i,defineOutput:o,defineSpecialNaN:s,defineSpecialInf:u,defineRound:c}}function ole(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"index",r=Ere(t);return r.map((function(t,a){var i="int ".concat(e[a]," = ").concat(n," / ").concat(t),o=a===r.length-1?"int ".concat(e[a+1]," = ").concat(n," - ").concat(e[a]," * ").concat(t):"index -= ".concat(e[a]," * ").concat(t);return"".concat(i,"; ").concat(o,";")})).join("")}function sle(e){var t=Ere(e).map((function(e){return e.toString()}));return"\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ".concat(t[0]," + coords.y * ").concat(t[1]," + coords.z;\n  }\n")}ale.registerFlag("HAS_WEBGL",(function(){return ale.getNumber("WEBGL_VERSION")>0})),ale.registerFlag("WEBGL_VERSION",(function(){return ele(2)?2:ele(1)?1:0})),ale.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(function(){return!1})),ale.registerFlag("WEBGL_BUFFER_SUPPORTED",(function(){return 2===ale.get("WEBGL_VERSION")})),ale.registerFlag("WEBGL_CPU_FORWARD",(function(){return!0})),ale.registerFlag("WEBGL_FORCE_F16_TEXTURES",(function(){return!1})),ale.registerFlag("WEBGL_PACK",(function(){return ale.getBool("HAS_WEBGL")})),ale.registerFlag("WEBGL_PACK_NORMALIZATION",(function(){return ale.getBool("WEBGL_PACK")})),ale.registerFlag("WEBGL_PACK_CLIP",(function(){return ale.getBool("WEBGL_PACK")})),ale.registerFlag("WEBGL_PACK_DEPTHWISECONV",(function(){return!1})),ale.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(function(){return ale.getBool("WEBGL_PACK")})),ale.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(function(){return ale.getBool("WEBGL_PACK")})),ale.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(function(){return ale.getBool("WEBGL_PACK")})),ale.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(function(){return ale.getBool("WEBGL_PACK")})),ale.registerFlag("WEBGL_PACK_REDUCE",(function(){return ale.getBool("WEBGL_PACK")})),ale.registerFlag("WEBGL_LAZILY_UNPACK",(function(){return ale.getBool("WEBGL_PACK")})),ale.registerFlag("WEBGL_CONV_IM2COL",(function(){return ale.getBool("WEBGL_PACK")})),ale.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(function(){return function(e){if(null==Oce){var t=Tce(e);Oce=t.getParameter(t.MAX_TEXTURE_SIZE)}return Oce}(ale.getNumber("WEBGL_VERSION"))})),ale.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(function(){return function(e){if(null==Lce){var t=Tce(e);Lce=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,Lce)}(ale.getNumber("WEBGL_VERSION"))})),ale.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(function(){var e=ale.getNumber("WEBGL_VERSION");return 0===e?0:function(e){if(0===e)return 0;var t=Tce(e);return $ce(t,"EXT_disjoint_timer_query_webgl2")&&2===e?2:$ce(t,"EXT_disjoint_timer_query")?1:0}(e)})),ale.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(function(){return ale.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!Vie()})),ale.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(function(){return function(e){if(0===e)return!1;var t=Tce(e);if(1===e){if(!$ce(t,"OES_texture_float"))return!1}else if(!$ce(t,"EXT_color_buffer_float"))return!1;return nle(t)}(ale.getNumber("WEBGL_VERSION"))})),ale.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(function(){return!ale.getBool("WEBGL_FORCE_F16_TEXTURES")&&ale.getBool("WEBGL_RENDER_FLOAT32_CAPABLE")})),ale.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(function(){return tle(ale.getNumber("WEBGL_VERSION"))})),ale.registerFlag("WEBGL_FENCE_API_ENABLED",(function(){return 2===(e=ale.getNumber("WEBGL_VERSION"))&&null!=Tce(e).fenceSync;var e})),ale.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(function(){return ale.getBool("WEBGL_RENDER_FLOAT32_ENABLED")?4:0})),ale.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(function(){return-1}),(function(e){if(e<0&&-1!==e)throw new Error("WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never "+"delete) or at least 0, but got ".concat(e,"."))}));var ule="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n",cle=Jn((function e(t){$n(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=kce.DENSE;var n=Ice(t),r=ile();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(ole(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(n[0],", ").concat(n[1],"));\n        int index = 4 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")})),lle=Jn((function e(t){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=kce.DENSE;var n=Ice(t),r=ile();this.outputShape=t,this.userCode="\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ".concat(ole(["r","c","d"],t),"\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(").concat(n[0],", ").concat(n[1],"));\n        int index = 4 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ").concat(r.output," = result;\n      }\n    ")})),hle=Jn((function e(t){$n(this,e),this.variableNames=["A"],this.outTexUsage=wce.DOWNLOAD;var n=ile();this.outputShape=t,this.userCode="\n      ".concat(ule,"\n\n      void main() {\n        float x = getAAtOutCoords();\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),fle=Jn((function e(t){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=wce.DOWNLOAD;var n=ile();this.outputShape=t,this.userCode="\n      ".concat(ule,"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ").concat(n.output," = encode_float(x);\n      }\n    ")})),dle=Jn((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];$n(this,e),this.variableNames=["A"];var a=ile(),i=f(n,2),o=i[0],s=i[1];this.outputShape=t;var u="result";r&&(u="floor(result * 255. + 0.5)"),this.userCode="\n      ".concat(sle(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / ").concat(s,";\n        int c = imod(flatIndex, ").concat(s,");\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n        vec4 values = ").concat(a.texture2D,"(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ").concat(a.output," = vec4(").concat(u,", 0., 0., 0.);\n      }\n    ")})),ple=Jn((function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];$n(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var a=ile(),i=f(n,2),o=i[0],s=i[1];this.outputShape=t;var u="",c="result";r&&(c="floor(result * 255. + 0.5)");for(var l=0;l<=1;l++)for(var h=0;h<=1;h++){var d=2*l+h;u+="\n          localCoords = coords;\n          if(localCoords[2] + ".concat(h," < ").concat(t[2],") {\n            localCoords[2] += ").concat(h,";\n            if(localCoords[1] + ").concat(l," < ").concat(t[1],") {\n              localCoords[1] += ").concat(l,";\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ").concat(s,";\n              c = imod(flatIndex, ").concat(s,");\n              uv = (vec2(c, r) + halfCR) / vec2(").concat(s,".0, ").concat(o,".0);\n              values = ").concat(a.texture2D,"(A, uv);\n\n              if(offset == 0) {\n                result[").concat(d,"] = values[0];\n              } else if(offset == 1) {\n                result[").concat(d,"] = values[1];\n              } else if(offset == 2) {\n                result[").concat(d,"] = values[2];\n              } else {\n                result[").concat(d,"] = values[3];\n              }\n            }\n          }\n        ")}this.userCode="\n      ".concat(sle(t),"\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ").concat(u,"\n\n        ").concat(a.output," = ").concat(c,";\n      }\n    ")}));function vle(e){var t=ile();return function(e,t){var n=Hce(e,(function(){return e.createShader(e.VERTEX_SHADER)}),"Unable to create vertex WebGLShader.");if(Nce(e,(function(){return e.shaderSource(n,t)})),Nce(e,(function(){return e.compileShader(n)})),!1===e.getShaderParameter(n,e.COMPILE_STATUS))throw console.log(e.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}(e,"".concat(t.version,"\n    precision highp float;\n    ").concat(t.attribute," vec3 clipSpacePos;\n    ").concat(t.attribute," vec2 uv;\n    ").concat(t.varyingVs," vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }"))}function mle(e){return function(e,t){var n=Hce(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Nce(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),Nce(e,(function(){return e.bufferData(e.ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]))}function gle(e){return function(e,t){var n=Hce(e,(function(){return e.createBuffer()}),"Unable to create WebGLBuffer");return Nce(e,(function(){return e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,n)})),Nce(e,(function(){return e.bufferData(e.ELEMENT_ARRAY_BUFFER,t,e.STATIC_DRAW)})),n}(e,new Uint16Array([0,1,2,2,1,3]))}function yle(e,t,n,r,a,i){!function(e,t){var n=zre().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e<=0||t<=0){var r="[".concat(e,"x").concat(t,"]");throw new Error("Requested texture size "+r+" is invalid.")}if(e>n||t>n){var a="[".concat(e,"x").concat(t,"]"),i="[".concat(n,"x").concat(n,"]");throw new Error("Requested texture size "+a+" greater than WebGL maximum on this browser / GPU "+i+".")}}(t,n);var o=function(e){return Hce(e,(function(){return e.createTexture()}),"Unable to create WebGLTexture.")}(e),s=e.TEXTURE_2D;return Nce(e,(function(){return e.bindTexture(s,o)})),Nce(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_S,e.CLAMP_TO_EDGE)})),Nce(e,(function(){return e.texParameteri(s,e.TEXTURE_WRAP_T,e.CLAMP_TO_EDGE)})),Nce(e,(function(){return e.texParameteri(s,e.TEXTURE_MIN_FILTER,e.NEAREST)})),Nce(e,(function(){return e.texParameteri(s,e.TEXTURE_MAG_FILTER,e.NEAREST)})),Nce(e,(function(){return e.texImage2D(s,0,r,t,n,0,a,i,null)})),Nce(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)})),o}function ble(e){return e.internalFormatFloat}function xle(e){return e.internalFormatHalfFloat}function kle(e){return e.downloadTextureFormat}function wle(e){return e.internalFormatPackedFloat}function _le(e){return e.internalFormatPackedHalfFloat}function Sle(e,t,n,r,a,i,o,s){var u=e,c=new Float32Array(function(e,t){var n=f(Ace(e,t),2);return n[0]*n[1]*4}(i,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,t),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}var Cle=function(){function e(t){$n(this,e),this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];var n=zre().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,function(e,t){Sce[e]=t}(n,t)):this.gl=Tce(n);var r="WEBGL_color_buffer_float",a="EXT_color_buffer_half_float";if(1===zre().getNumber("WEBGL_VERSION")){var i="OES_texture_half_float";if(this.textureFloatExtension=Dce(this.gl,"OES_texture_float"),$ce(this.gl,i))this.textureHalfFloatExtension=Dce(this.gl,i);else if(zre().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(r),$ce(this.gl,a))this.colorBufferHalfFloatExtension=Dce(this.gl,a);else if(zre().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(r="EXT_color_buffer_float",$ce(this.gl,r))this.colorBufferFloatExtension=this.gl.getExtension(r);else{if(!$ce(this.gl,a))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(a)}this.vertexBuffer=mle(this.gl),this.indexBuffer=gle(this.gl),this.framebuffer=function(e){return Hce(e,(function(){return e.createFramebuffer()}),"Unable to create WebGLFramebuffer.")}(this.gl),this.textureConfig=Mce(this.gl,this.textureHalfFloatExtension)}return Jn(e,[{key:"debug",get:function(){return zre().getBool("DEBUG")}},{key:"dispose",value:function(){var e=this;if(!this.disposed){null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");var t=this.gl;Nce(t,(function(){return t.finish()})),Nce(t,(function(){return t.bindFramebuffer(t.FRAMEBUFFER,null)})),Nce(t,(function(){return t.deleteFramebuffer(e.framebuffer)})),Nce(t,(function(){return t.bindBuffer(t.ARRAY_BUFFER,null)})),Nce(t,(function(){return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null)})),Nce(t,(function(){return t.deleteBuffer(e.indexBuffer)})),this.disposed=!0}}},{key:"createFloat32MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=f(Ece(t,n),2);return yle(e,a[0],a[1],ble(r),r.textureFormatFloat,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"createFloat16MatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=f(Ece(t,n),2);return yle(e,a[0],a[1],xle(r),r.textureFormatFloat,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createUnsignedBytesMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=f(Ece(t,n),2);return yle(e,a[0],a[1],kle(r),e.RGBA,e.UNSIGNED_BYTE)}(this.gl,e,t,this.textureConfig)}},{key:"uploadPixelDataToTexture",value:function(e,t){this.throwIfDisposed(),function(e,t,n){Nce(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),n.data instanceof Uint8Array?Nce(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,n.width,n.height,0,e.RGBA,e.UNSIGNED_BYTE,n.data)})):Nce(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,n)})),Nce(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t)}},{key:"uploadDenseMatrixToTexture",value:function(e,t,n,r){this.throwIfDisposed(),function(e,t,n,r,a,i){var o,s,u;Nce(e,(function(){return e.bindTexture(e.TEXTURE_2D,t)})),a instanceof Uint8Array?(o=new Uint8Array(n*r*4),s=e.UNSIGNED_BYTE,u=e.RGBA):(o=new Float32Array(n*r*4),s=e.FLOAT,u=i.internalFormatPackedFloat),o.set(a),Nce(e,(function(){return e.texImage2D(e.TEXTURE_2D,0,u,n,r,0,e.RGBA,s,o)})),Nce(e,(function(){return e.bindTexture(e.TEXTURE_2D,null)}))}(this.gl,e,t,n,r,this.textureConfig)}},{key:"createFloat16PackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=f(Ace(t,n),2);return yle(e,a[0],a[1],_le(r),e.RGBA,r.textureTypeHalfFloat)}(this.gl,e,t,this.textureConfig)}},{key:"createPackedMatrixTexture",value:function(e,t){return this.throwIfDisposed(),function(e,t,n,r){var a=f(Ace(t,n),2);return yle(e,a[0],a[1],wle(r),e.RGBA,e.FLOAT)}(this.gl,e,t,this.textureConfig)}},{key:"deleteMatrixTexture",value:function(e){var t=this;this.throwIfDisposed(),this.outputTexture===e&&(jce(this.gl,this.framebuffer),this.outputTexture=null),Nce(this.gl,(function(){return t.gl.deleteTexture(e)}))}},{key:"downloadByteEncodedFloatMatrixFromOutputTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n,r){var a=f(Ece(t,n),2),i=a[0],o=a[1],s=new Uint8Array(t*n*4);return Nce(e,(function(){return e.readPixels(0,0,i,o,r.downloadTextureFormat,e.UNSIGNED_BYTE,s)})),new Float32Array(s.buffer)}(r.gl,t,n,r.textureConfig)}))}},{key:"downloadPackedMatrixFromBuffer",value:function(e,t,n,r,a,i){return Sle(this.gl,e,0,0,0,a,i,this.textureConfig)}},{key:"downloadFloat32MatrixFromBuffer",value:function(e,t){return function(e,t,n){var r=e,a=new Float32Array(n);return r.bindBuffer(r.PIXEL_PACK_BUFFER,t),r.getBufferSubData(r.PIXEL_PACK_BUFFER,0,a),r.bindBuffer(r.PIXEL_PACK_BUFFER,null),a}(this.gl,e,t)}},{key:"createBufferFromTexture",value:function(e,t,n){this.bindTextureToFrameBuffer(e);var r=function(e,t,n,r){var a=e.createBuffer();Nce(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,a)}));var i=16*t*n;return Nce(e,(function(){return e.bufferData(e.PIXEL_PACK_BUFFER,i,e.STREAM_READ)})),Nce(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,0)})),Nce(e,(function(){return e.bindBuffer(e.PIXEL_PACK_BUFFER,null)})),a}(this.gl,t,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),r}},{key:"createAndWaitForFence",value:function(){var e=this.createFence(this.gl);return this.pollFence(e)}},{key:"createFence",value:function(e){var t,n,r=this;if(zre().getBool("WEBGL_FENCE_API_ENABLED")){var a=e,i=a.fenceSync(a.SYNC_GPU_COMMANDS_COMPLETE,0);e.flush(),n=function(){var e=a.clientWaitSync(i,0,0);return e===a.ALREADY_SIGNALED||e===a.CONDITION_SATISFIED},t=i}else zre().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(t=this.beginQuery(),this.endQuery(),n=function(){return r.isQueryAvailable(t,zre().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}):n=function(){return!0};return{query:t,isFencePassed:n}}},{key:"downloadMatrixFromPackedTexture",value:function(e,t,n){var r=this;return this.downloadMatrixDriver(e,(function(){return function(e,t,n){var r=new Float32Array(t*n*4);return Nce(e,(function(){return e.readPixels(0,0,n,t,e.RGBA,e.FLOAT,r)})),r}(r.gl,t,n)}))}},{key:"createProgram",value:function(e){this.throwIfDisposed();var t=this.gl,n=Pce(t,e),r=vle(t),a=function(e){return Hce(e,(function(){return e.createProgram()}),"Unable to create WebGLProgram.")}(t);return Nce(t,(function(){return t.attachShader(a,r)})),Nce(t,(function(){return t.attachShader(a,n)})),function(e,t){if(Nce(e,(function(){return e.linkProgram(t)})),!1===e.getProgramParameter(t,e.LINK_STATUS))throw console.log(e.getProgramInfoLog(t)),new Error("Failed to link vertex and fragment shaders.")}(t,a),this.debug&&zce(t,a),this.vertexAttrsAreBound||(this.setProgram(a),this.vertexAttrsAreBound=function(e,t,n){return Nce(e,(function(){return e.bindBuffer(e.ARRAY_BUFFER,n)})),Bce(e,t,"clipSpacePos",n,3,20,0)&&Bce(e,t,"uv",n,2,20,12)}(t,this.program,this.vertexBuffer)),a}},{key:"deleteProgram",value:function(e){var t=this;this.throwIfDisposed(),e===this.program&&(this.program=null),null!=e&&Nce(this.gl,(function(){return t.gl.deleteProgram(e)}))}},{key:"setProgram",value:function(e){var t=this;this.throwIfDisposed(),this.program=e,null!=this.program&&this.debug&&zce(this.gl,this.program),Nce(this.gl,(function(){return t.gl.useProgram(e)}))}},{key:"getUniformLocation",value:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];return this.throwIfDisposed(),n?Uce(this.gl,e,t):Vce(this.gl,e,t)}},{key:"getAttributeLocation",value:function(e,t){var n=this;return this.throwIfDisposed(),Nce(this.gl,(function(){return n.gl.getAttribLocation(e,t)}))}},{key:"getUniformLocationNoThrow",value:function(e,t){return this.throwIfDisposed(),this.gl.getUniformLocation(e,t)}},{key:"setInputMatrixTexture",value:function(e,t,n){this.throwIfDisposed(),this.throwIfNoProgram(),Wce(this.gl,e,t,n)}},{key:"setOutputMatrixTexture",value:function(e,t,n){this.setOutputMatrixTextureDriver(e,n,t)}},{key:"setOutputPackedMatrixTexture",value:function(e,t,n){this.throwIfDisposed();var r=f(Ace(t,n),2),a=r[0],i=r[1];this.setOutputMatrixTextureDriver(e,a,i)}},{key:"setOutputMatrixWriteRegion",value:function(e,t,n,r){this.setOutputMatrixWriteRegionDriver(n,e,r,t)}},{key:"setOutputPackedMatrixWriteRegion",value:function(e,t,n,r){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}},{key:"debugValidate",value:function(){null!=this.program&&zce(this.gl,this.program),qce(this.gl)}},{key:"executeProgram",value:function(){this.throwIfDisposed(),this.throwIfNoProgram();var e=this.gl;this.debug&&this.debugValidate(),Nce(e,(function(){return e.drawElements(e.TRIANGLES,6,e.UNSIGNED_SHORT,0)}))}},{key:"blockUntilAllProgramsCompleted",value:function(){var e=this;this.throwIfDisposed(),Nce(this.gl,(function(){return e.gl.finish()}))}},{key:"getQueryTimerExtension",value:function(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=Dce(this.gl,2===zre().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}},{key:"getQueryTimerExtensionWebGL2",value:function(){return this.getQueryTimerExtension()}},{key:"getQueryTimerExtensionWebGL1",value:function(){return this.getQueryTimerExtension()}},{key:"beginQuery",value:function(){if(2===zre().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.gl,t=this.getQueryTimerExtensionWebGL2(),n=e.createQuery();return e.beginQuery(t.TIME_ELAPSED_EXT,n),n}var r=this.getQueryTimerExtensionWebGL1(),a=r.createQueryEXT();return r.beginQueryEXT(r.TIME_ELAPSED_EXT,a),a}},{key:"endQuery",value:function(){if(2!==zre().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){var e=this.getQueryTimerExtensionWebGL1();e.endQueryEXT(e.TIME_ELAPSED_EXT)}else{var t=this.gl,n=this.getQueryTimerExtensionWebGL2();t.endQuery(n.TIME_ELAPSED_EXT)}}},{key:"waitForQueryAndGetTime",value:function(){var e=ns(es().mark((function e(t){var n=this;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,mre((function(){return n.disposed||n.isQueryAvailable(t,zre().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}));case 2:return e.abrupt("return",this.getQueryTime(t,zre().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")));case 3:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"getQueryTime",value:function(e,t){if(0===t)return null;if(2===t){var n=this.gl;return n.getQueryParameter(e,n.QUERY_RESULT)/1e6}var r=this.getQueryTimerExtensionWebGL1();return r.getQueryObjectEXT(e,r.QUERY_RESULT_EXT)/1e6}},{key:"isQueryAvailable",value:function(e,t){if(0===t)return!0;if(2===t){var n=this.gl,r=this.getQueryTimerExtensionWebGL2(),a=n.getQueryParameter(e,n.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(r.GPU_DISJOINT_EXT)),a&&!this.disjoint}var i=this.getQueryTimerExtensionWebGL1(),o=i.getQueryObjectEXT(e,i.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(i.GPU_DISJOINT_EXT)),o&&!this.disjoint}},{key:"pollFence",value:function(e){var t=this;return new Promise((function(n){t.addItemToPoll((function(){return e.isFencePassed()}),(function(){return n()}))}))}},{key:"pollItems",value:function(){for(var e=function(e){for(var t=0;t<e.length;++t){if(!e[t]())break}return t-1}(this.itemsToPoll.map((function(e){return e.isDoneFn}))),t=0;t<=e;++t){(0,this.itemsToPoll[t].resolveFn)()}this.itemsToPoll=this.itemsToPoll.slice(e+1)}},{key:"addItemToPoll",value:function(e,t){var n=this;this.itemsToPoll.push({isDoneFn:e,resolveFn:t}),this.itemsToPoll.length>1||mre((function(){return n.pollItems(),0===n.itemsToPoll.length}))}},{key:"bindTextureToFrameBuffer",value:function(e){this.throwIfDisposed(),Gce(this.gl,e,this.framebuffer),this.debug&&qce(this.gl)}},{key:"unbindTextureToFrameBuffer",value:function(){null!=this.outputTexture?(Gce(this.gl,this.outputTexture,this.framebuffer),this.debug&&qce(this.gl)):jce(this.gl,this.framebuffer)}},{key:"downloadMatrixDriver",value:function(e,t){this.bindTextureToFrameBuffer(e);var n=t();return this.unbindTextureToFrameBuffer(),n}},{key:"setOutputMatrixTextureDriver",value:function(e,t,n){this.throwIfDisposed();var r=this.gl;Gce(r,e,this.framebuffer),this.debug&&qce(r),this.outputTexture=e,Nce(r,(function(){return r.viewport(0,0,t,n)})),Nce(r,(function(){return r.scissor(0,0,t,n)}))}},{key:"setOutputMatrixWriteRegionDriver",value:function(e,t,n,r){var a=this;this.throwIfDisposed(),Nce(this.gl,(function(){return a.gl.scissor(e,t,n,r)}))}},{key:"throwIfDisposed",value:function(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}},{key:"throwIfNoProgram",value:function(){if(null==this.program)throw new Error("No GPU program is currently set.")}}]),e}();var Tle=function(e,t){for(var n=e.length,r=[],a=0;a<n;a++){var i=n-1-a,o=e[i]||1;(t[t.length-1-a]||1)>1&&1===o&&r.unshift(i)}return r};function Ele(e,t,n,r){var a=[];e.forEach((function(e){var t=hre(e.shapeInfo.logicalShape);e.shapeInfo.isUniform?a.push("uniform float ".concat(e.name).concat(t>1?"[".concat(t,"]"):"",";")):(a.push("uniform sampler2D ".concat(e.name,";")),a.push("uniform int offset".concat(e.name,";")))}));var i,o,s=a.join("\n"),u=e.map((function(e){return function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],r="";r+=n?Ale(e):Ile(e);var a=e.shapeInfo.logicalShape,i=t.logicalShape;a.length<=i.length&&(r+=n?Lle(e,t):Fle(e,t));return r}(e,t,r)})).join("\n"),c=t.texShape,l=ile(),h=function(e){return"\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ".concat(e.texture2D,"(textureSampler, uv).r;\n    }\n  ")}(l),f=function(e){return"".concat(e.version,"\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ").concat(e.varyingFs," vec2 resultUV;\n    ").concat(e.defineOutput,"\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ").concat(e.defineSpecialNaN,"\n    ").concat(e.defineSpecialInf,"\n    ").concat(e.defineRound,"\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ").concat(Mle,"\n    ").concat(Nle,"\n    ").concat(Rle,"\n  ")}(l);return t.isPacked?(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(1===n[0])return"\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ".concat(n[1],".0);\n      }\n    ");if(1===n[1])return"\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ".concat(n[0],".0);\n      }\n    ");return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      return 2 * (resTexRC.x * ").concat(n[1]," + resTexRC.y);\n    }\n  ")}(0,t);case 2:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)];if(fre(e,t))return"\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(".concat(n[0],", ").concat(n[1],"));\n      }\n    ");var r=Math.ceil(e[1]/2);return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[2]/2),a=r*Math.ceil(e[1]/2);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec3(b, r, c);\n    }\n  ")}(e,t);default:return function(e,t){for(var n=[Math.ceil(t[0]/2),Math.ceil(t[1]/2)],r=Math.ceil(e[e.length-1]/2),a=r*Math.ceil(e[e.length-2]/2),i=a,o="",s="b, r, c",u=2;u<e.length-1;u++)i*=e[e.length-u-1],o="\n      int b".concat(u," = index / ").concat(i,";\n      index -= b").concat(u," * ").concat(i,";\n    ")+o,s="b".concat(u,", ")+s;return"\n    ivec".concat(e.length," getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(").concat(n[0],", ").concat(n[1],"));\n      int index = resTexRC.x * ").concat(n[1]," + resTexRC.y;\n\n      ").concat(o,"\n\n      int b = index / ").concat(a,";\n      index -= b * ").concat(a,";\n\n      int r = 2 * (index / ").concat(r,");\n      int c = imod(index, ").concat(r,") * 2;\n\n      return ivec").concat(e.length,"(").concat(s,");\n    }\n  ")}(e,t)}}(t.logicalShape,c),o=function(e){return"\n    void setOutput(vec4 val) {\n      ".concat(e.output," = val;\n    }\n  ")}(l)):(i=function(e,t){switch(e.length){case 0:return"\n    int getOutputCoords() {\n      return 0;\n    }\n  ";case 1:return function(e,t){if(1===t[0])return"\n      int getOutputCoords() {\n        return int(resultUV.x * ".concat(t[1],".0);\n      }\n    ");if(1===t[1])return"\n      int getOutputCoords() {\n        return int(resultUV.y * ".concat(t[0],".0);\n      }\n    ");return"\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      return resTexRC.x * ").concat(t[1]," + resTexRC.y;\n    }\n  ")}(0,t);case 2:return function(e,t){if(fre(e,t))return"\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(".concat(t[0],", ").concat(t[1],"));\n      }\n    ");if(1===e[1])return"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    ");if(1===e[0])return"\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(".concat(t[0],", ").concat(t[1],"));\n        int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n        return ivec2(0, index);\n      }\n    ");return"\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      int r = index / ").concat(e[1],";\n      int c = index - r * ").concat(e[1],";\n      return ivec2(r, c);\n    }\n  ")}(e,t);case 3:return function(e,t){var n=ole(["r","c","d"],e);return"\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec3(r, c, d);\n    }\n  ")}(e,t);case 4:return function(e,t){var n=ole(["r","c","d","d2"],e);return"\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n      ").concat(n,"\n      return ivec4(r, c, d, d2);\n    }\n  ")}(e,t);case 5:return function(e,t){var n=ole(["r","c","d","d2","d3"],e);return"\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(".concat(t[0],",\n                             ").concat(t[1],"));\n\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  ")}(e,t);case 6:return function(e,t){var n=ole(["r","c","d","d2","d3","d4"],e);return"\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(".concat(t[0],", ").concat(t[1],"));\n      int index = resTexRC.x * ").concat(t[1]," + resTexRC.y;\n\n      ").concat(n,"\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  ")}(e,t);default:throw new Error("".concat(e.length,"-D output sampling is not yet supported"))}}(t.logicalShape,c),o=function(e){return"\n    void setOutput(float val) {\n      ".concat(e.output," = vec4(val, 0, 0, 0);\n    }\n  ")}(l)),r&&(f+=Dle),[f,h,o,s,i,u,n].join("\n")}function Ile(e){var t=e.shapeInfo.logicalShape;switch(t.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"float ".concat(n,"() {return ").concat(t,";}");var r=f(e.shapeInfo.texShape,2),a=r[0],i=r[1];if(1===a&&1===i)return"\n      float ".concat(n,"() {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var o=f(e.shapeInfo.texShape,2),s=o[0],u=o[1],c=Ple(t);return"\n    float ".concat(n,"() {\n      vec2 uv = uvFromFlat(").concat(s,", ").concat(u,", ").concat(c,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1);if(e.shapeInfo.isUniform)return"\n      float ".concat(n,"(int index) {\n        ").concat(Ole(e),"\n      }\n    ");var r=e.shapeInfo.texShape,a=r[0],i=r[1];if(1===i&&1===a)return"\n      float ".concat(n,"(int index) {\n        return sampleTexture(").concat(t,", halfCR);\n      }\n    ");var o=Ple(t);if(1===i)return"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2(0.5, (float(index + ").concat(o,") + 0.5) / ").concat(a,".0);\n        return sampleTexture(").concat(t,", uv);\n      }\n    ");if(1===a)return"\n      float ".concat(n,"(int index) {\n        vec2 uv = vec2((float(index + ").concat(o,") + 0.5) / ").concat(i,".0, 0.5);\n        return sampleTexture(").concat(t,", uv);\n      }\n    ");return"\n    float ".concat(n,"(int index) {\n      vec2 uv = uvFromFlat(").concat(a,", ").concat(i,", index + ").concat(o,");\n      return sampleTexture(").concat(t,", uv);\n    }\n  ")}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape;if(null!=a&&fre(t,a)){var i=a[0],o=a[1];return"\n    float ".concat(r,"(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(o,".0, ").concat(i,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}var s=yre(t),u=s.newShape,c=s.keptDims,l=u;if(l.length<t.length){var h=Ble(e,l),f=["row","col"];return"\n      ".concat(Ile(h),"\n      float ").concat(r,"(int row, int col) {\n        return ").concat(r,"(").concat(Ule(f,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(").concat(t[1],", 1)));\n        ").concat(Ole(e),"\n      }\n    ");var d=a[0],p=a[1],v=Ple(n);if(1===p)return"\n    float ".concat(r,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(t[1],", 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ").concat(d,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");if(1===d)return"\n    float ".concat(r,"(int row, int col) {\n      float index = dot(vec3(row, col, ").concat(v,"), vec3(").concat(t[1],", 1, 1));\n      vec2 uv = vec2((index + 0.5) / ").concat(p,".0, 0.5);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");return"\n  float ".concat(r,"(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ").concat(t[1]," + col + ").concat(v,";\n    vec2 uv = uvFromFlat(").concat(d,", ").concat(p,", index);\n    return sampleTexture(").concat(n,", uv);\n  }\n")}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[1]*t[2],i=t[2],o=yre(t),s=o.newShape,u=o.keptDims,c=s;if(c.length<t.length){var l=Ble(e,c),h=["row","col","depth"];return"\n        ".concat(Ile(l),"\n        float ").concat(r,"(int row, int col, int depth) {\n          return ").concat(r,"(").concat(Ule(h,u),");\n        }\n      ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(").concat(a,", ").concat(i,", 1)));\n        ").concat(Ole(e),"\n      }\n    ");var f=e.shapeInfo.texShape,d=f[0],p=f[1],v=e.shapeInfo.flatOffset;if(p===a&&null==v)return"\n        float ".concat(r,"(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(").concat(i,", 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(").concat(p,".0, ").concat(d,".0);\n          return sampleTexture(").concat(n,", uv);\n        }\n      ");if(p===i&&null==v)return"\n    float ".concat(r,"(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(").concat(t[1],", 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(p,".0, ").concat(d,".0);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ");var m=Ple(n);return"\n      float ".concat(r,"(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ").concat(a," + col * ").concat(i," + depth + ").concat(m,";\n        vec2 uv = uvFromFlat(").concat(d,", ").concat(p,", index);\n        return sampleTexture(").concat(n,", uv);\n      }\n  ")}(e);case 4:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[3],i=t[2]*a,o=t[1]*i,s=yre(t),u=s.newShape,c=s.keptDims;if(u.length<t.length){var l=Ble(e,u),h=["row","col","depth","depth2"];return"\n      ".concat(Ile(l),"\n      float ").concat(r,"(int row, int col, int depth, int depth2) {\n        return ").concat(r,"(").concat(Ule(h,c),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(").concat(o,", ").concat(i,", ").concat(a,", 1)));\n        ").concat(Ole(e),"\n      }\n    ");var f=e.shapeInfo.flatOffset,d=e.shapeInfo.texShape,p=d[0],v=d[1];if(v===o&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(v,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(v===a&&null==f)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(").concat(t[1]*t[2],", ").concat(t[2],", 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(v,".0, ").concat(p,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var m=Ple(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(o," + col * ").concat(i," +\n          depth * ").concat(a," + depth2;\n      vec2 uv = uvFromFlat(").concat(p,", ").concat(v,", index + ").concat(m,");\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 5:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=t[4],i=t[3]*a,o=t[2]*i,s=t[1]*o,u=yre(t),c=u.newShape,l=u.keptDims;if(c.length<t.length){var h=Ble(e,c),f=["row","col","depth","depth2","depth3"];return"\n      ".concat(Ile(h),"\n      float ").concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        return ").concat(r,"(").concat(Ule(f,l),");\n      }\n    ")}if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(s,", ").concat(o,", ").concat(i,", ").concat(a,")) +\n          depth3;\n        ").concat(Ole(e),"\n      }\n    ");var d=e.shapeInfo.flatOffset,p=e.shapeInfo.texShape,v=p[0],m=p[1];if(m===s&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(").concat(o,", ").concat(i,", ").concat(a,", 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(m,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(m===a&&null==d)return"\n      float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3],",\n               ").concat(t[2]*t[3],", ").concat(t[3],", 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(m,".0, ").concat(v,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var g=Ple(n);return"\n    float ".concat(r,"(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(s," + col * ").concat(o," + depth * ").concat(i," +\n          depth2 * ").concat(a," + depth3 + ").concat(g,";\n      vec2 uv = uvFromFlat(").concat(v,", ").concat(m,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);case 6:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=yre(t),i=a.newShape,o=a.keptDims;if(i.length<t.length){var s=Ble(e,i),u=["row","col","depth","depth2","depth3","depth4"];return"\n      ".concat(Ile(s),"\n      float ").concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ").concat(r,"(").concat(Ule(u,o),");\n      }\n    ")}var c=t[5],l=t[4]*c,h=t[3]*l,f=t[2]*h,d=t[1]*f;if(e.shapeInfo.isUniform)return"\n      float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(").concat(d,", ").concat(f,", ").concat(h,", ").concat(l,")) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(").concat(c,", 1)));\n        ").concat(Ole(e),"\n      }\n    ");var p=e.shapeInfo.flatOffset,v=e.shapeInfo.texShape,m=v[0],g=v[1];if(g===d&&null==p)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(").concat(f,", ").concat(h,", ").concat(l,", ").concat(c,")) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(").concat(g,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");if(g===c&&null==p)return"\n      float ".concat(r,"(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(").concat(t[1]*t[2]*t[3]*t[4],",\n               ").concat(t[2]*t[3]*t[4],",\n               ").concat(t[3]*t[4],",\n               ").concat(t[4],")) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(").concat(g,".0, ").concat(m,".0);\n        return sampleTexture(").concat(n,", uv);\n      }\n    ");var y=Ple(n);return"\n    float ".concat(r,"(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ").concat(d," + col * ").concat(f," + depth * ").concat(h," +\n          depth2 * ").concat(l," + depth3 * ").concat(c," + depth4 + ").concat(y,";\n      vec2 uv = uvFromFlat(").concat(m,", ").concat(g,", index);\n      return sampleTexture(").concat(n,", uv);\n    }\n  ")}(e);default:throw new Error("".concat(t.length,"-D input sampling")+" is not yet supported")}}function Ale(e){switch(e.shapeInfo.logicalShape.length){case 0:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=ile();return"\n    vec4 ".concat(n,"() {\n      return ").concat(r.texture2D,"(").concat(t,", halfCR);\n    }\n  ")}(e);case 1:return function(e){var t=e.name,n="get"+t.charAt(0).toUpperCase()+t.slice(1),r=e.shapeInfo.texShape,a=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],i=ile();return"\n    vec4 ".concat(n,"(int index) {\n      vec2 uv = packedUVfrom1D(\n        ").concat(a[0],", ").concat(a[1],", index);\n      return ").concat(i.texture2D,"(").concat(t,", uv);\n    }\n  ")}(e);case 2:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=a[0],o=a[1],s=ile();if(null!=a&&fre(t,a))return"\n      vec4 ".concat(r,"(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(").concat(o,".0, ").concat(i,".0);\n\n        return ").concat(s.texture2D,"(").concat(n,", uv);\n      }\n    ");var u=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)],c=Math.ceil(t[1]/2);return"\n    vec4 ".concat(r,"(int row, int col) {\n      vec2 uv = packedUVfrom2D(").concat(c,", ").concat(u[0],", ").concat(u[1],", row, col);\n      return ").concat(s.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e);case 3:return function(e){var t=e.shapeInfo.logicalShape,n=e.name,r="get"+n.charAt(0).toUpperCase()+n.slice(1),a=e.shapeInfo.texShape,i=[Math.ceil(a[0]/2),Math.ceil(a[1]/2)];if(1===t[0]){var o=[1,2],s=Ble(e,t.slice(1)),u=["b","row","col"];return"\n        ".concat(Ale(s),"\n        vec4 ").concat(r,"(int b, int row, int col) {\n          return ").concat(r,"(").concat(Ule(u,o),");\n        }\n      ")}var c=i[0],l=i[1],h=Math.ceil(t[2]/2),f=h*Math.ceil(t[1]/2),d=ile();return"\n    vec4 ".concat(r,"(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ").concat(c,", ").concat(l,", ").concat(f,", ").concat(h,", b, row, col);\n      return ").concat(d.texture2D,"(").concat(n,", uv);\n    }\n  ")}(e);default:return function(e){for(var t=e.shapeInfo.logicalShape,n=t.length,r=e.name,a="get"+r.charAt(0).toUpperCase()+r.slice(1),i=e.shapeInfo.texShape,o=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],s=o[0],u=o[1],c=Math.ceil(t[n-1]/2),l=c*Math.ceil(t[n-2]/2),h="int b, int row, int col",f="b * ".concat(l," + (row / 2) * ").concat(c," + (col / 2)"),d=2;d<n-1;d++)h="int b".concat(d,", ")+h,l*=t[n-d-1],f="b".concat(d," * ").concat(l," + ")+f;var p=ile();return"\n    vec4 ".concat(a,"(").concat(h,") {\n      int index = ").concat(f,";\n      int texR = index / ").concat(u,";\n      int texC = index - texR * ").concat(u,";\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(").concat(u,", ").concat(s,");\n      return ").concat(p.texture2D,"(").concat(r,", uv);\n    }\n  ")}(e)}}var Mle="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Nle="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Rle="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",Dle="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function Ple(e){return"offset".concat(e)}function Ole(e){var t=e.name,n=hre(e.shapeInfo.logicalShape);return n<2?"return ".concat(t,";"):"\n    for (int i = 0; i < ".concat(n,"; i++) {\n      if (i == index) {\n        return ").concat(t,"[i];\n      }\n    }\n  ")}function Lle(e,t){var n,r=e.name,a=r.charAt(0).toUpperCase()+r.slice(1),i="get"+a+"AtOutCoords",o=e.shapeInfo.logicalShape.length,s=t.logicalShape.length,u=Tle(e.shapeInfo.logicalShape,t.logicalShape),c=zle(s),l=s-o,h=["x","y","z","w","u","v"];n=0===o?"":s<2&&u.length>=1?"coords = 0;":u.map((function(e){return"coords.".concat(h[e+l]," = 0;")})).join("\n");var f="";f=s<2&&o>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(h[t+l])})).join(", ");var d="return outputValue;",p=1===hre(e.shapeInfo.logicalShape),v=1===hre(t.logicalShape);if(1!==o||p||v){if(p&&!v)d=1===s?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(u.length){var m=o-2,g=o-1;u.indexOf(m)>-1&&u.indexOf(g)>-1?d="return vec4(outputValue.x);":u.indexOf(m)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":u.indexOf(g)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}}else d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return"\n    vec4 ".concat(i,"() {\n      ").concat(c," coords = getOutputCoords();\n      ").concat(n,"\n      vec4 outputValue = get").concat(a,"(").concat(f,");\n      ").concat(d,"\n    }\n  ")}function Fle(e,t){var n=e.name,r=n.charAt(0).toUpperCase()+n.slice(1),a="get"+r+"AtOutCoords",i=t.texShape,o=e.shapeInfo.texShape,s=e.shapeInfo.logicalShape.length,u=t.logicalShape.length;if(!e.shapeInfo.isUniform&&s===u&&null==e.shapeInfo.flatOffset&&fre(o,i))return"\n      float ".concat(a,"() {\n        return sampleTexture(").concat(n,", resultUV);\n      }\n    ");var c,l=zle(u),h=Tle(e.shapeInfo.logicalShape,t.logicalShape),f=u-s,d=["x","y","z","w","u","v"];c=0===s?"":u<2&&h.length>=1?"coords = 0;":h.map((function(e){return"coords.".concat(d[e+f]," = 0;")})).join("\n");var p="";return p=u<2&&s>0?"coords":e.shapeInfo.logicalShape.map((function(e,t){return"coords.".concat(d[t+f])})).join(", "),"\n    float ".concat(a,"() {\n      ").concat(l," coords = getOutputCoords();\n      ").concat(c,"\n      return get").concat(r,"(").concat(p,");\n    }\n  ")}function zle(e){if(e<=1)return"int";if(2===e)return"ivec2";if(3===e)return"ivec3";if(4===e)return"ivec4";if(5===e)return"ivec5";if(6===e)return"ivec6";throw Error("GPU for rank ".concat(e," is not yet supported"))}function Ble(e,t){var n=JSON.parse(JSON.stringify(e));return n.shapeInfo.logicalShape=t,n}function Ule(e,t){return t.map((function(t){return e[t]})).join(", ")}function Vle(e,t,n,r){var a=t.userCode,i=n.map((function(e,n){var r={logicalShape:e.shape,texShape:e.isUniform?null:e.texData.texShape,isUniform:e.isUniform,isPacked:!e.isUniform&&e.texData.isPacked,flatOffset:null};return null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0&&(r.flatOffset=e.texData.slice.flatOffset),{name:t.variableNames[n],shapeInfo:r}})),o=i.map((function(e){return e.shapeInfo})),s={logicalShape:r.shape,texShape:r.texData.texShape,isUniform:!1,isPacked:r.texData.isPacked,flatOffset:null},u=Ele(i,s,a,t.packedInputs),c=e.createProgram(u),l=null,h=e.getUniformLocation(c,"NAN",!1);1===zre().getNumber("WEBGL_VERSION")&&(l=e.getUniformLocation(c,"INFINITY",!1));for(var f={},d=0;d<t.variableNames.length;d++){var p=t.variableNames[d];f[p]=e.getUniformLocation(c,p,false),f["offset".concat(p)]=e.getUniformLocation(c,"offset".concat(p),false)}return{program:t,source:u,webGLProgram:c,uniformLocations:f,inShapeInfos:o,outShapeInfo:s,infLoc:l,nanLoc:h}}function Wle(e,t){if(e.length!==t.length)throw Error("Binary was compiled with ".concat(e.length," inputs, but ")+"was executed with ".concat(t.length," inputs"));e.forEach((function(e,n){var r=e.logicalShape,a=t[n],i=a.shape;if(!fre(r,i))throw Error("Binary was compiled with different shapes than "+"the current args. Shapes ".concat(r," and ").concat(i," must match"));if(!e.isUniform||!a.isUniform){var o=e.texShape,s=a.isUniform?null:a.texData.texShape;if(!fre(o,s))throw Error("Binary was compiled with different texture shapes than the"+" current args. Shape ".concat(o," and ").concat(s," must match"))}}))}function Gle(e,t,n,r,a){Wle(t.inShapeInfos,n),Wle([t.outShapeInfo],[r]);var i=r.texData.texture,o=r.texData.texShape;r.texData.isPacked?e.setOutputPackedMatrixTexture(i,o[0],o[1]):e.setOutputMatrixTexture(i,o[0],o[1]),e.setProgram(t.webGLProgram),1===zre().getNumber("WEBGL_VERSION")&&null!==t.infLoc&&e.gl.uniform1f(t.infLoc,1/0),null!==t.nanLoc&&e.gl.uniform1f(t.nanLoc,NaN),n.forEach((function(n,r){var a=t.program.variableNames[r],i=t.uniformLocations[a],o=t.uniformLocations["offset".concat(a)];if(null!=i)if(n.isUniform)if(hre(n.shape)<2)e.gl.uniform1f(i,n.uniformValues[0]);else{var s=n.uniformValues;s instanceof Float32Array||(s=new Float32Array(s)),e.gl.uniform1fv(i,s)}else null!=n.texData.slice&&null!=o&&e.gl.uniform1i(o,n.texData.slice.flatOffset),e.setInputMatrixTexture(n.texData.texture,i,r)})),null!=a&&a(e,t.webGLProgram),e.executeProgram()}function jle(e,t,n){var r="";t.concat(n).forEach((function(e){var t=null!=e.texData&&null!=e.texData.slice&&e.texData.slice.flatOffset>0,n=e.isUniform?"uniform":e.texData.texShape;r+="".concat(e.shape,"_").concat(n,"_").concat(t)}));var a=e.userCode,i=e.constructor.name;return i+="_"+r+"_"+a}var qle=TV,Hle=yW,Xle=bW,Kle=wW,Yle=IW,Qle=uG,Zle=dG,Jle=PG,$le=GG,ehe=qG,the=aj,nhe=lj,rhe=fj,ahe=Ej,ihe=Mj,ohe=Wj,she=mG,uhe=Jj,che=bq,lhe=kq,hhe=Dq,fhe=OV,dhe=pW,phe=cH,vhe=_G,mhe=pH,ghe=mH,yhe=WV,bhe=yH;function xhe(e,t){return["x","y","z","w","u","v"].slice(0,t).map((function(t){return"".concat(e,".").concat(t)}))}function khe(e,t){return 1===t?[e]:xhe(e,t)}var whe=Jn((function e(t){$n(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;var n=t.length;if(0===n)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{var r=khe("rc",n),a=zle(n),i=function(e,t,n){if(1===e)return"rc > ".concat(t[0]);for(var r="",a=e-2;a<e;a++)r+="".concat(n[a]," >= ").concat(t[a]),a<e-1&&(r+="||");return r}(n,t,r),o=function(e,t,n,r){if(1===e)return"";var a=r.slice(-2);return"\n    int r = ".concat(a[0],";\n    int c = ").concat(a[1],";\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ").concat(t,";\n    bool rEdge = rp1 >= ").concat(n,";\n  ")}(n,t[t.length-1],t[t.length-2],r),s=function(e,t){var n=e.length,r=function(e,t){for(var n=[],r=0;r<=1;r++)for(var a=0;a<=1;a++){for(var i="".concat(0===r?"r":"rp1",", ").concat(0===a?"c":"cp1"),o=2;o<e;o++)i="".concat(t[t.length-1-o],",")+i;n.push(i)}return n}(n,t);if(1===n)return"getA(rc),\n            rc + 1 >= ".concat(e[0]," ? 0. : getA(rc + 1),\n            0, 0");return"getA(".concat(r[0],"),\n          cEdge ? 0. : getA(").concat(r[1],"),\n          rEdge ? 0. : getA(").concat(r[2],"),\n          rEdge || cEdge ? 0. : getA(").concat(r[3],")")}(t,r);this.userCode="\n        void main() {\n          ".concat(a," rc = getOutputCoords();\n\n          if(").concat(i,") {\n            setOutput(vec4(0));\n          } else {\n            ").concat(o,"\n\n            setOutput(vec4(").concat(s,"));\n          }\n        }\n      ")}}));var _he=Jn((function e(t,n){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var r="",a=0;a<4;a++){var i="thisRC = rc;";a%2===1&&(i+="thisRC.z += 1;"),a>1&&(i+="thisRC.y += 1;"),r+="\n        ".concat(i,"\n        ").concat(a>0?"if(thisRC.y < rows && thisRC.z < cols){":"","\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[").concat(a,"] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ").concat(a>0?"}":"","\n      ")}this.userCode="\n      ".concat(function(e){var t=ole(["r","c","d"],e);return"\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ".concat(t,"\n      return ivec3(r, c, d);\n    }\n  ")}(n),"\n      ").concat(sle(t),"\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ").concat(t[1],";\n        int cols = ").concat(t[2],";\n\n        ").concat(r,"\n\n        setOutput(result);\n      }\n    ")}));var She=function(){function e(t){$n(this,e),this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}return Jn(e,[{key:"acquireTexture",value:function(e,t,n){var r=The(t,n),a=Ehe(e,r,n);a in this.freeTextures||(this.freeTextures[a]=[]),a in this.usedTextures||(this.usedTextures[a]=[]);var i,o=Che(e,r,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[a].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=o,this.log();var s=this.freeTextures[a].shift();return this.usedTextures[a].push(s),s}return r===_ce.PACKED_2X2_FLOAT32?i=this.gpgpu.createPackedMatrixTexture(e[0],e[1]):r===_ce.PACKED_2X2_FLOAT16?i=this.gpgpu.createFloat16PackedMatrixTexture(e[0],e[1]):r===_ce.UNPACKED_FLOAT32?i=this.gpgpu.createFloat32MatrixTexture(e[0],e[1]):r===_ce.UNPACKED_FLOAT16?i=this.gpgpu.createFloat16MatrixTexture(e[0],e[1]):r===_ce.PACKED_4X1_UNSIGNED_BYTE&&(i=this.gpgpu.createUnsignedBytesMatrixTexture(e[0],e[1])),this.usedTextures[a].push(i),this.numUsedTextures++,this._numBytesAllocated+=o,this.log(),i}},{key:"releaseTexture",value:function(e,t,n,r){if(null!=this.freeTextures){var a=The(n,r),i=Ehe(t,a,r);i in this.freeTextures||(this.freeTextures[i]=[]);var o=Che(t,a,this.gpgpu.gl,this.gpgpu.textureConfig,r),s=zre().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==s&&this._numBytesAllocated>s?(this.gpgpu.deleteMatrixTexture(e),this._numBytesAllocated-=o):(this.freeTextures[i].push(e),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;var u=this.usedTextures[i],c=u.indexOf(e);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}}},{key:"log",value:function(){if(this.logEnabled){var e=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used","".concat(this.numFreeTextures," / ").concat(this.numUsedTextures),"(".concat(e,")"));var t=this._numBytesFree/this._numBytesAllocated;console.log("Bytes allocated: ".concat(this._numBytesAllocated)),console.log("Bytes unused: ".concat(this._numBytesFree," (").concat(Math.round(100*t),"%)"))}}},{key:"numBytesAllocated",get:function(){return this._numBytesAllocated}},{key:"numBytesFree",get:function(){return this._numBytesFree}},{key:"getNumUsedTextures",value:function(){return this.numUsedTextures}},{key:"getNumFreeTextures",value:function(){return this.numFreeTextures}},{key:"dispose",value:function(){var e=this;if(null!=this.freeTextures){for(var t in this.freeTextures)this.freeTextures[t].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));for(var n in this.usedTextures)this.usedTextures[n].forEach((function(t){e.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}]),e}();function Che(e,t,n,r,a){var i,o=function(e,t){switch(e){case _ce.PACKED_2X2_FLOAT32:return wle(t);case _ce.PACKED_2X2_FLOAT16:return _le(t);case _ce.UNPACKED_FLOAT32:return ble(t);case _ce.UNPACKED_FLOAT16:return xle(t);case _ce.PACKED_4X1_UNSIGNED_BYTE:return kle(t);default:throw new Error("Unknown physical texture type ".concat(e))}}(t,r);if(a){var s=f(Ace(e[0],e[1]),2);i=s[0]*s[1]}else{var u=f(Ece(e[0],e[1]),2);i=u[0]*u[1]}var c=function(e,t){var n=e;if(t===n.R32F)return 4;if(t===n.R16F)return 2;if(t===n.RGBA32F)return 16;if(t===e.RGBA)return 16;if(t===n.RGBA16F)return 8;throw new Error("Unknown internal format ".concat(t))}(n,o);return i*c}function The(e,t){if(e===wce.UPLOAD)return _ce.PACKED_2X2_FLOAT32;if(e===wce.RENDER||null==e)return function(e){return zre().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?e?_ce.PACKED_2X2_FLOAT32:_ce.UNPACKED_FLOAT32:e?_ce.PACKED_2X2_FLOAT16:_ce.UNPACKED_FLOAT16}(t);if(e===wce.DOWNLOAD||e===wce.PIXELS)return _ce.PACKED_4X1_UNSIGNED_BYTE;throw new Error("Unknown logical texture type ".concat(e))}function Ehe(e,t,n){return"".concat(e[0],"_").concat(e[1],"_").concat(t,"_").concat(n)}var Ihe=Jn((function e(t,n){$n(this,e),this.variableNames=["A"],this.outputShape=t,this.userCode="\n      float unaryOperation(float x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),Ahe="if (isnan(x)) return x;",Mhe="return x;",Nhe="return abs(x);";var Rhe="return (x >= 0.0) ? x : (exp(x) - 1.0);",Dhe="if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",Phe="if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",Ohe="return x;",Lhe="return x;",Fhe="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",zhe="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Bhe="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",Uhe=Jn((function e(t,n){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      vec4 unaryOperation(vec4 x) {\n        ".concat(n,"\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    ")})),Vhe=Jn((function e(t){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;var n=t.length,r=khe("rc",n),a=zle(n),i=function(e,t){if(1===e)return"rc";for(var n="",r=0;r<e;r++)n+=t[r],r<e-1&&(n+=",");return n}(n,r),o=r.slice(-2),s=n<=1?"rc":"vec2(".concat(o.join(","),")");this.userCode="\n      void main() {\n        ".concat(a," rc = getOutputCoords();\n        vec4 packedInput = getA(").concat(i,");\n\n        setOutput(getChannel(packedInput, ").concat(s,"));\n      }\n    ")})),Whe=function(e,t){for(var n=[],r=0;r<t.length;r++)t[r]&&n.push(r);for(var a=Eoe(e,"int32"),i=Eoe([n.length,e.length],"int32"),o=0;o<n.length;o++){var s=a.indexToLoc(n[o]),u=o*e.length;i.values.set(s,u)}return i.toTensor()},Ghe={};var jhe=function(e){tr(n,e);var t=sr(n);function n(e){var r,a;if($n(this,n),(r=t.call(this)).pendingRead=new WeakMap,r.pendingDisposal=new WeakSet,r.dataRefCount=new WeakMap,r.numBytesInGPU=0,r.uploadWaitMs=0,r.downloadWaitMs=0,r.warnedAboutMemory=!1,r.warnedAboutCPUBackend=!1,r.pendingDeletes=0,r.disposed=!1,!zre().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==e){var i=Tce(zre().getNumber("WEBGL_VERSION"));r.binaryCache=((a=zre().getNumber("WEBGL_VERSION"))in Ghe||(Ghe[a]={}),Ghe[a]),r.gpgpu=new Cle(i),r.canvas=i.canvas,r.gpgpuCreatedLocally=!0}else r.gpgpu=e,r.binaryCache={},r.gpgpuCreatedLocally=!1,r.canvas=e.gl.canvas;return r.textureManager=new She(r.gpgpu),r.numMBBeforeWarning=null==zre().global.screen?1024:zre().global.screen.height*zre().global.screen.width*window.devicePixelRatio*600/1024/1024,r.texData=new nre(ir(r),lue()),r}return Jn(n,[{key:"numDataIds",value:function(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}},{key:"write",value:function(e,t,n){if((zre().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||zre().getBool("DEBUG"))&&this.checkNumericalProblems(e),"complex64"===n&&null!=e)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");var r={};return this.texData.set(r,{shape:t,dtype:n,values:e,usage:wce.UPLOAD,refCount:1,complexParentRefCount:0}),r}},{key:"incRef",value:function(e){this.texData.get(e).refCount++}},{key:"decRef",value:function(e){this.texData.has(e)&&this.texData.get(e).refCount--}},{key:"decComplexRef",value:function(e){if(this.texData.has(e)){var t=this.texData.get(e);t.complexParentRefCount>0&&t.refCount--}}},{key:"move",value:function(e,t,n,r){if(zre().getBool("DEBUG")&&this.checkNumericalProblems(t),"complex64"===r)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(e,{shape:n,dtype:r,values:t,usage:wce.UPLOAD,refCount:1,complexParentRefCount:0})}},{key:"disposeIntermediateTensorInfo",value:function(e){var t=e.dataId;if(this.texData.has(t)){var n=this.texData.get(t);n.refCount--,n.refCount<1&&this.disposeData(t)}}},{key:"readSync",value:function(e){var t=this.texData.get(e),n=t.values,r=t.dtype,a=t.complexTensorInfos,i=t.slice,o=t.shape,s=t.isPacked;if(null!=i){var u;u=s?new Uhe(o,Ohe):new Ihe(o,Ohe);var c=this.runWebGLProgram(u,[{dataId:e,shape:o,dtype:r}],r),l=this.readSync(c.dataId);return this.disposeIntermediateTensorInfo(c),l}if(null!=n)return this.convertAndCacheOnCPU(e);if("string"===r)return n;var h,f,d=null!=this.activeTimers;(d&&(h=iie()),"complex64"===r)?f=ece(this.readSync(a.real.dataId),this.readSync(a.imag.dataId)):f=this.getValuesFromTexture(e);return d&&(this.downloadWaitMs+=iie()-h),this.convertAndCacheOnCPU(e,f)}},{key:"read",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,s,u,c,l,h,f,d,p,v,m,g,y,b,x,k,w,_;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!this.pendingRead.has(t)){e.next=3;break}return n=this.pendingRead.get(t),e.abrupt("return",new Promise((function(e){return n.push(e)})));case 3:if(r=this.texData.get(t),a=r.values,i=r.shape,o=r.slice,s=r.dtype,u=r.complexTensorInfos,c=r.isPacked,null==o){e.next=11;break}return l=c?new Uhe(i,Ohe):new Ihe(i,Ohe),h=this.runWebGLProgram(l,[{dataId:t,shape:i,dtype:s}],s),f=this.read(h.dataId),this.disposeIntermediateTensorInfo(h),e.abrupt("return",f);case 11:if(null==a){e.next=13;break}return e.abrupt("return",this.convertAndCacheOnCPU(t));case 13:if(zre().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")||2!==zre().getNumber("WEBGL_VERSION")){e.next=15;break}throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");case 15:if(d=null,"complex64"!==s&&zre().get("WEBGL_BUFFER_SUPPORTED")&&(p=this.decode(t),m=this.texData.get(p.dataId),d=(v=this.gpgpu).createBufferFromTexture.apply(v,[m.texture].concat(Tt(Ice(i))))),this.pendingRead.set(t,[]),"complex64"===s){e.next=21;break}return e.next=21,this.gpgpu.createAndWaitForFence();case 21:if("complex64"!==s){e.next=30;break}return e.next=24,Promise.all([this.read(u.real.dataId),this.read(u.imag.dataId)]);case 24:y=e.sent,b=y[0],x=y[1],g=ece(b,x),e.next=31;break;case 30:null==d?g=this.getValuesFromTexture(t):(k=hre(i),g=this.gpgpu.downloadFloat32MatrixFromBuffer(d,k));case 31:return null!=p&&this.disposeIntermediateTensorInfo(p),w=this.convertAndCacheOnCPU(t,g),_=this.pendingRead.get(t),this.pendingRead.delete(t),_.forEach((function(e){return e(w)})),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),e.abrupt("return",w);case 38:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"bufferSync",value:function(e){var t=this.readSync(e.dataId),n=t;if("string"===e.dtype)try{n=t.map((function(e){return sie(e)}))}catch(r){throw new Error("Failed to decode encoded string bytes into utf-8")}return Eoe(e.shape,e.dtype,n)}},{key:"checkNumericalProblems",value:function(e){if(null!=e)for(var t=0;t<e.length;t++){var n=e[t];if(!Rce(n)){if(zre().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error("The value ".concat(n," cannot be represented with your ")+"current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'");throw Error("The value ".concat(n," cannot be represented on this device."))}}}},{key:"getValuesFromTexture",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.isPacked,i=hre(n);if(zre().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){var o,s=this.decode(e),u=this.texData.get(s.dataId),c=(o=this.gpgpu).downloadMatrixFromPackedTexture.apply(o,[u.texture].concat(Tt(Ice(n)))).subarray(0,i);return this.disposeIntermediateTensorInfo(s),c}var l=zre().getBool("WEBGL_PACK")&&!0===a,h=l?Qce(n):n,f=l?new fle(h):new hle(h),d=this.runWebGLProgram(f,[{shape:h,dtype:r,dataId:e}],"float32"),p=this.texData.get(d.dataId),v=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(p.texture,p.texShape[0],p.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(d),v}},{key:"time",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,s,u;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.activeTimers,r=[],a=!1,null==this.programTimersStack?(this.programTimersStack=r,a=!0):this.activeTimers.push(r),this.activeTimers=r,t(),i=lre(this.activeTimers.map((function(e){return e.query}))).filter((function(e){return null!=e})),o=lre(this.activeTimers.map((function(e){return e.name}))).filter((function(e){return null!=e})),this.activeTimers=n,a&&(this.programTimersStack=null),s={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null},!(zre().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=19;break}return e.next=14,Promise.all(i);case 14:u=e.sent,s.kernelMs=ore(u),s.getExtraProfileInfo=function(){return u.map((function(e,t){return{name:o[t],ms:e}})).map((function(e){return"".concat(e.name,": ").concat(e.ms)})).join(", ")},e.next=20;break;case 19:s.kernelMs={error:"WebGL query timers are not supported in this environment."};case 20:return this.uploadWaitMs=0,this.downloadWaitMs=0,e.abrupt("return",s);case 23:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"memory",value:function(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}},{key:"startTimer",value:function(){return zre().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:iie(),endMs:null}}},{key:"endTimer",value:function(e){return zre().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),e):(e.endMs=iie(),e)}},{key:"getQueryTime",value:function(){var e=ns(es().mark((function e(t){var n;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(zre().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)){e.next=2;break}return e.abrupt("return",this.gpgpu.waitForQueryAndGetTime(t));case 2:return n=t,e.abrupt("return",n.endMs-n.startMs);case 4:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"disposeData",value:function(e){if(!this.pendingDisposal.has(e)){if(this.pendingRead.has(e))return this.pendingDisposal.add(e),void this.pendingDeletes++;if(this.texData.has(e))if(this.texData.get(e).complexParentRefCount>0)this.texData.get(e).refCount--;else{this.releaseGPUData(e);var t=this.texData.get(e).complexTensorInfos;null!=t&&(this.texData.get(t.real.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.real),this.texData.get(t.imag.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(t.imag)),this.texData.delete(e)}}}},{key:"releaseGPUData",value:function(e){var t=this.texData.get(e),n=t.texture,r=t.dtype,a=t.texShape,i=t.usage,o=t.isPacked,s=t.slice,u=s&&s.origDataId||e,c=this.dataRefCount.get(u);c>1?this.dataRefCount.set(u,c-1):(this.dataRefCount.delete(u),null!=n&&(this.numBytesInGPU-=this.computeBytes(a,r),this.textureManager.releaseTexture(n,a,i,o)));var l=this.texData.get(e);l.texture=null,l.texShape=null,l.isPacked=!1,l.slice=null}},{key:"getTexture",value:function(e){return this.uploadToGPU(e),this.texData.get(e).texture}},{key:"getDataInfo",value:function(e){return this.texData.get(e)}},{key:"getCPUBackend",value:function(){return zre().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=lue().findBackend("cpu")),this.cpuBackend):null}},{key:"shouldExecuteOnCPU",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:128,r=this.getCPUBackend();return zre().getBool("IS_TEST")||this.warnedAboutCPUBackend||null!=r||(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),null!=r&&e.every((function(e){return null==t.texData.get(e.dataId).texture&&hre(e.shape)<n}))}},{key:"getGPGPUContext",value:function(){return this.gpgpu}},{key:"where",value:function(e){Hae("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");var t=e.dataSync();return Whe(e.shape,t)}},{key:"packedUnaryOp",value:function(e,t,n){var r=new Uhe(e.shape,t);return this.compileAndRun(r,[e],n)}},{key:"abs",value:function(e){if(this.shouldExecuteOnCPU([e])&&"complex64"!==e.dtype){var t=fhe(this.texData.get(e.dataId).values);return this.makeOutput(e.shape,e.dtype,t)}if(zre().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(e,Nhe,e.dtype);var n=new Ihe(e.shape,Nhe);return this.compileAndRun(n,[e])}},{key:"makeTensorInfo",value:function(e,t,n){var r;if("string"===t&&null!=n&&n.length>0&&_re(n[0])){var a=n.map((function(e){return oie(e)}));r=this.write(a,e,t)}else r=this.write(n,e,t);return this.texData.get(r).usage=null,{dataId:r,shape:e,dtype:t}}},{key:"makeOutput",value:function(e,t,n){var r=this.makeTensorInfo(e,t,n).dataId;return lue().makeTensorFromDataId(r,e,t,this)}},{key:"unpackTensor",value:function(e){var t=new Vhe(e.shape);return this.runWebGLProgram(t,[e],e.dtype)}},{key:"packTensor",value:function(e){var t=new whe(e.shape);return this.runWebGLProgram(t,[e],e.dtype,null,!0)}},{key:"packedReshape",value:function(e,t){var n=[Kce(e.shape)].concat(Tt(Yce(e.shape))),r={dtype:e.dtype,shape:n,dataId:e.dataId},a=[Kce(t)].concat(Tt(Yce(t))),i=new _he(a,n),o=this.runWebGLProgram(i,[r],e.dtype,null,!0);return{dataId:o.dataId,shape:t,dtype:o.dtype}}},{key:"decode",value:function(e){var t,n=this.texData.get(e),r=n.isPacked,a=n.shape,i=n.dtype,o=Qce(a);t=r?new lle(o):new cle(o);return{dtype:i,shape:a,dataId:this.runWebGLProgram(t,[{shape:o,dtype:i,dataId:e}],i,null,!0).dataId}}},{key:"runWebGLProgram",value:function(e,t,n,r){var a=this,i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=this.makeTensorInfo(e.outputShape,n),s=this.texData.get(o.dataId);if(e.packedOutput&&(s.isPacked=!0),e.outPackingScheme===kce.DENSE){var u=Ice(e.outputShape);s.texShape=u.map((function(e){return 2*e}))}if(null!=e.outTexUsage&&(s.usage=e.outTexUsage),0===hre(o.shape))return s.values=bre(o.dtype,0),o;var c=[],l=t.map((function(t){if("complex64"===t.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");var n=a.texData.get(t.dataId);if(null==n.texture){if(!e.packedInputs&&hre(t.shape)<=zre().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:t.shape,texData:null,isUniform:!0,uniformValues:n.values};e.packedInputs&&(n.isPacked=!0,n.shape=t.shape)}else if(!!n.isPacked!==!!e.packedInputs)t=n.isPacked?a.unpackTensor(t):a.packTensor(t),c.push(t),n=a.texData.get(t.dataId);else if(n.isPacked&&!Jce(n.shape,t.shape)){var r=t,i=t.shape;t.shape=n.shape,t=a.packedReshape(t,i),c.push(t),n=a.texData.get(t.dataId),r.shape=i}return a.uploadToGPU(t.dataId),{shape:t.shape,texData:n,isUniform:!1}}));this.uploadToGPU(o.dataId);var h,f={shape:o.shape,texData:s,isUniform:!1},d=jle(e,l,f),p=this.getAndSaveBinary(d,(function(){return Vle(a.gpgpu,e,l,f)})),v=null!=this.activeTimers;if(v&&(h=this.startTimer()),Gle(this.gpgpu,p,l,f,r),c.forEach((function(e){return a.disposeIntermediateTensorInfo(e)})),v&&(h=this.endTimer(h),this.activeTimers.push({name:e.constructor.name,query:this.getQueryTime(h)})),!zre().getBool("WEBGL_LAZILY_UNPACK")&&s.isPacked&&!1===i){var m=this.unpackTensor(o);return this.disposeIntermediateTensorInfo(o),m}return o}},{key:"compileAndRun",value:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]&&arguments[4];n=n||t[0].dtype;var i=this.runWebGLProgram(e,t,n,r,a);return lue().makeTensorFromDataId(i.dataId,i.shape,i.dtype)}},{key:"getAndSaveBinary",value:function(e,t){return e in this.binaryCache||(this.binaryCache[e]=t()),this.binaryCache[e]}},{key:"getTextureManager",value:function(){return this.textureManager}},{key:"dispose",value:function(){var e=this;if(!this.disposed){if(!zre().getBool("IS_TEST"))Object.keys(this.binaryCache).forEach((function(t){e.gpgpu.deleteProgram(e.binaryCache[t].webGLProgram),delete e.binaryCache[t]}));this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}},{key:"floatPrecision",value:function(){var e=this;return null==this.floatPrecisionValue&&(this.floatPrecisionValue=hue((function(){if(!zre().get("WEBGL_RENDER_FLOAT32_ENABLED")){var t=zre().getBool("DEBUG");zre().set("DEBUG",!1);var n=e.abs(Qoe(1e-8)).dataSync()[0];if(zre().set("DEBUG",t),n>0)return 32}return 16}))),this.floatPrecisionValue}},{key:"epsilon",value:function(){return 32===this.floatPrecision()?1e-7:1e-4}},{key:"uploadToGPU",value:function(e){var t=this.texData.get(e),n=t.shape,r=t.dtype,a=t.values,i=t.texture,o=t.usage,s=t.isPacked;if(null==i){var u,c=null!=this.activeTimers;c&&(u=iie());var l=t.texShape;if(null==l&&(l=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=zre().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t&&(n*=2,e=e.map((function(t,n){return n>=e.length-2?ire(e[n]):e[n]})),1===e.length&&(e=[2,e[0]])),2!==e.length){var r=yre(e);e=r.newShape}var a=hre(e);if(e.length<=1&&a<=n)return[1,a];if(2===e.length&&e[0]<=n&&e[1]<=n)return e;if(3===e.length&&e[0]*e[1]<=n&&e[2]<=n)return[e[0]*e[1],e[2]];if(3===e.length&&e[0]<=n&&e[1]*e[2]<=n)return[e[0],e[1]*e[2]];if(4===e.length&&e[0]*e[1]*e[2]<=n&&e[3]<=n)return[e[0]*e[1]*e[2],e[3]];if(4===e.length&&e[0]<=n&&e[1]*e[2]*e[3]<=n)return[e[0],e[1]*e[2]*e[3]];if(t){var i=Kce(e),o=2,s=2;if(e.length){var u=f(Yce(e),2);o=u[0],s=u[1]}return pre(a=i*(o/2)*(s/2)).map((function(e){return 2*e}))}return pre(a)}(n,s),t.texShape=l),null!=a){var h,d=Qce(n),p=l[1],v=l[0],m=a instanceof Uint8Array;if(s){var g=f(Ace(l[0],l[1]),2);p=g[0],v=g[1],h=new ple(d,[v,p],m)}else h=new dle(d,[v,p],m);var y=this.makeTensorInfo([v,p],r);this.texData.get(y.dataId).usage=m?wce.PIXELS:wce.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(y.dataId),p,v,a);var b=this.runWebGLProgram(h,[y],r,null,!0),x=this.texData.get(b.dataId);t.texture=x.texture,t.texShape=x.texShape,t.isPacked=x.isPacked,t.usage=x.usage,this.disposeIntermediateTensorInfo(y),this.texData.delete(b.dataId),t.values=null,c&&(this.uploadWaitMs+=iie()-u)}else{var k=this.acquireTexture(l,o,r,s);t.texture=k}}}},{key:"convertAndCacheOnCPU",value:function(e,t){var n=this.texData.get(e),r=n.dtype;return this.releaseGPUData(e),null!=t&&(n.values=function(e,t){if("float32"===t||"complex64"===t)return e;if("int32"===t||"bool"===t){for(var n="int32"===t?new Int32Array(e.length):new Uint8Array(e.length),r=0;r<n.length;++r)n[r]=Math.round(e[r]);return n}throw new Error("Unknown dtype ".concat(t))}(t,r)),n.values}},{key:"acquireTexture",value:function(e,t,n,r){if(this.numBytesInGPU+=this.computeBytes(e,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){var a=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn("High memory usage in GPU: ".concat(a," MB, ")+"most likely due to a memory leak")}return this.textureManager.acquireTexture(e,t,r)}},{key:"computeBytes",value:function(e,t){return e[0]*e[1]*wre(t)}}]),n}(rre);Wie()&&function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;Bie.registerBackend(e,t,n)}("webgl",(function(){return new jhe}),2);var qhe=Jn((function e(t,n,r){$n(this,e),this.variableNames=["A","B"],this.outputShape=Mse(n,r),this.userCode="\n      float binaryOperation(float a, float b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    ")})),Hhe=Jn((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];$n(this,e),this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=Mse(n,r);var i=this.outputShape.length,o="";if(a)if(0===i||1===hre(this.outputShape))o="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{var s=zle(i);if(o="\n          ".concat(s," coords = getOutputCoords();\n        "),1===i)o+="\n            result.y = (coords + 1) >= ".concat(this.outputShape[0]," ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          ");else{var u=khe("coords",i);o+="\n            bool nextRowOutOfBounds =\n              (".concat(u[i-2]," + 1) >= ").concat(this.outputShape[i-2],";\n            bool nextColOutOfBounds =\n              (").concat(u[i-1]," + 1) >= ").concat(this.outputShape[i-1],";\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          ")}}this.userCode="\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ".concat(t,"\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ").concat(o,"\n\n        setOutput(result);\n      }\n    ")}));function Xhe(e){var t=e.inputs,n=e.backend,r=t.x;return n.incRef(r.dataId),{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}var Khe={kernelName:aae,backendName:"webgl",kernelFunc:Xhe};function Yhe(e){var t=e.inputs,n=e.backend,r=t.real,a=t.imag,i=n.makeTensorInfo(r.shape,"complex64"),o=n.texData.get(i.dataId),s=Xhe({inputs:{x:r},backend:n});n.texData.get(s.dataId).complexParentRefCount++;var u=Xhe({inputs:{x:a},backend:n});return n.texData.get(u.dataId).complexParentRefCount++,o.complexTensorInfos={real:s,imag:u},i}var Qhe={kernelName:Xre,backendName:"webgl",kernelFunc:Yhe},Zhe="return (a < 0.) ? b * a : a;",Jhe="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var $he={kernelName:sae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.alpha,o=n.makeTensorInfo([],"float32",rie(i,"float32")),s=zre().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Hhe(Jhe,a.shape,o.shape):new qhe(Zhe,a.shape,o.shape),u=n.runWebGLProgram(s,[a,o],a.dtype);return n.disposeIntermediateTensorInfo(o),u}},efe="return (a < 0.) ? b * a : a;",tfe="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";var nfe={kernelName:kae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=t.alpha,i=zre().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Hhe(tfe,r.shape,a.shape):new qhe(efe,r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}};function rfe(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.cpuKernelImpl,a=e.dtype;return function(e){var i,o=e.inputs,s=e.backend,u=o.x,c=s,l=a||u.dtype;if(c.shouldExecuteOnCPU([u])&&null!=r){var h=c.texData.get(u.dataId),f=r(h.values,l);return c.makeTensorInfo(u.shape,l,f)}return i=zre().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=n?new Uhe(u.shape,n):new Ihe(u.shape,t),c.runWebGLProgram(i,[u],l)}}function afe(e){var t=e.opSnippet,n=e.packedOpSnippet,r=e.checkOutOfBounds,a=void 0!==r&&r,i=e.supportsComplex,o=void 0!==i&&i,s=e.cpuKernelImpl,u=e.dtype;return function(e){var r=e.inputs,i=e.backend,c=r.a,l=r.b,h=i;if(o&&"complex64"===c.dtype){var d=h.texData.get(c.dataId),p=h.texData.get(l.dataId),v=[[d.complexTensorInfos.real,p.complexTensorInfos.real],[d.complexTensorInfos.imag,p.complexTensorInfos.imag]].map((function(e){var n=f(e,2),r=n[0],a=n[1],i={dataId:r.dataId,dtype:r.dtype,shape:c.shape},o={dataId:a.dataId,dtype:a.dtype,shape:l.shape},s=new qhe(t,c.shape,l.shape);return h.runWebGLProgram(s,[i,o],Iie(r.dtype,a.dtype))})),m=f(v,2),g=m[0],y=m[1],b=Yhe({inputs:{real:g,imag:y},backend:h});return h.disposeIntermediateTensorInfo(g),h.disposeIntermediateTensorInfo(y),b}var x,k=u||Iie(c.dtype,l.dtype);if(h.shouldExecuteOnCPU([c,l])&&null!=s){var w=h.texData.get(c.dataId),_=h.texData.get(l.dataId),S=f(s(c.shape,l.shape,w.values,_.values,k),2),C=S[0],T=S[1],E=h.makeTensorInfo(T,k);return h.texData.get(E.dataId).values=C,E}return x=zre().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=n?new Hhe(n,c.shape,l.shape,a):new qhe(t,c.shape,l.shape),h.runWebGLProgram(x,[c,l],k)}}function ife(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("linear"===e)return t?Lhe:Mhe;if("relu"===e)return t?zhe:Dhe;if("elu"===e)return t?Fhe:Rhe;if("relu6"===e)return t?Bhe:Phe;if("prelu"===e)return t?tfe:efe;if("leakyrelu"===e)return t?Jhe:Zhe;throw new Error("Activation ".concat(e," has not been implemented for the WebGL backend."))}var ofe=Jn((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],o=arguments.length>5&&void 0!==arguments[5]&&arguments[5],s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,u=arguments.length>7&&void 0!==arguments[7]&&arguments[7],c=arguments.length>8&&void 0!==arguments[8]&&arguments[8];$n(this,e),this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=r;var l=a?t[1]:t[2],h=Math.ceil(l/2),f=a?"i * 2, rc.y":"rc.y, i * 2",d=i?"rc.z, i * 2":"i * 2, rc.z",p=a?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],v=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"],m="",g="";s&&(m=u?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(s,"\n        }"):c?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(s,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(s,"\n        }"),g="result = activation(result);");var y=o?"result += getBiasAtOutCoords();":"";o&&this.variableNames.push("bias"),u&&this.variableNames.push("preluActivationWeights"),c&&this.variableNames.push("leakyreluAlpha");var b="rc.x",x="rc.x";t[0]<n[0]?b="int(min(float(rc.x), ".concat(t[0]-1,".))"):n[0]<t[0]&&(x="int(min(float(rc.x), ".concat(n[0]-1,".))")),this.userCode="\n      ".concat(m,"\n\n      const float sharedDimension = ").concat(h,".0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ").concat(h,"; i++) {\n          int batchA = ").concat(b,";\n          int batchB = ").concat(x,";\n          vec4 a = getMatrixA(batchA, ").concat(f,");\n          vec4 b = getMatrixB(batchB, ").concat(d,");\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (").concat(p[0]," * ").concat(v[0],");\n          result += (").concat(p[1]," * ").concat(v[1],");\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ").concat(y,"\n\n        ").concat(g,"\n\n        setOutput(result);\n      }\n    ")})),sfe="return areal * breal - aimag * bimag;",ufe="return areal * bimag + aimag * breal;",cfe=Jn((function e(t,n,r){$n(this,e),this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=Mse(n,r),this.userCode="\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ".concat(t,"\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    ")})),lfe="return a * b;";function hfe(e){var t,n=e.inputs,r=e.backend,a=n.a,i=n.b,o=Iie(a.dtype,i.dtype);if("complex64"===a.dtype){var s=r.texData.get(a.dataId),u=r.texData.get(i.dataId),c=new cfe(sfe,a.shape,i.shape),l=new cfe(ufe,a.shape,i.shape),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:a.shape},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:a.shape},{dataId:u.complexTensorInfos.real.dataId,dtype:u.complexTensorInfos.real.dtype,shape:i.shape},{dataId:u.complexTensorInfos.imag.dataId,dtype:u.complexTensorInfos.imag.dtype,shape:i.shape}],d=r.runWebGLProgram(c,h,"float32"),p=r.runWebGLProgram(l,h,"float32"),v=Yhe({inputs:{real:d,imag:p},backend:r});return r.disposeIntermediateTensorInfo(d),r.disposeIntermediateTensorInfo(p),v}if(r.shouldExecuteOnCPU([a,i])){var m=r.texData.get(a.dataId),g=r.texData.get(i.dataId),y=f(she(a.shape,i.shape,m.values,g.values,o),2),b=y[0],x=y[1],k=r.makeTensorInfo(x,o);return r.texData.get(k.dataId).values=b,k}return t=zre().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Hhe(lfe,a.shape,i.shape):new qhe(lfe,a.shape,i.shape),r.runWebGLProgram(t,[a,i],o)}var ffe={kernelName:vae,backendName:"webgl",kernelFunc:hfe};function dfe(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.shape,o=n,s=hre(a.shape),u=function(e,t){for(var n=1,r=-1,a=0;a<e.length;++a)if(e[a]>=0)n*=e[a];else if(-1===e[a]){if(-1!==r)throw Error("Shapes can only have 1 implicit size. "+"Found -1 at dim ".concat(r," and dim ").concat(a));r=a}else if(e[a]<0)throw Error("Shapes can not be < 0. Found ".concat(e[a]," at dim ").concat(a));if(-1===r){if(t>0&&t!==n)throw Error("Size(".concat(t,") must match the product of shape ").concat(e));return e}if(0===n)throw Error("Cannot infer the missing size in [".concat(e,"] when ")+"there are 0 elements");if(t%n!==0)throw Error("The implicit shape can't be a fractional number. "+"Got ".concat(t," / ").concat(n));var i=e.slice();return i[r]=t/n,i}(i,s),c=hre(u);sre(s===c,(function(){return"The new shape (".concat(u,") has ").concat(c," elements and the old ")+"shape (".concat(a.shape,") has ").concat(s," elements. The new shape and old ")+"shape must have the same number of elements."}));var l=o.texData.get(a.dataId);return!l.isPacked||Jce(a.shape,u)||null!==l.texture&&Jce(l.shape,u)?(o.incRef(a.dataId),{dataId:a.dataId,shape:u,dtype:a.dtype}):function(e,t,n){var r=[Kce(e.shape)].concat(Tt(Yce(e.shape))),a={dtype:e.dtype,shape:r,dataId:e.dataId},i=[Kce(t)].concat(Tt(Yce(t))),o=new _he(i,r),s=n.runWebGLProgram(o,[a],e.dtype,null,!0);return{dataId:s.dataId,shape:t,dtype:s.dtype}}(a,u,o)}var pfe={kernelName:Cae,backendName:"webgl",kernelFunc:dfe},vfe=Jn((function e(t,n){$n(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s=4*Math.floor(r/4),u=r%4,c="sumValue += dot(values, ones);";if(null!=n){var l=1/n;c="sumValue += dot(values * ".concat(dre(l)?l.toPrecision(2):l,", ones);")}var h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return 0.0;\n        }\n      ")),this.userCode="\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ".concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(s,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(c,"\n        }\n\n        int inIdx = inOffset + ").concat(s,";\n        if (").concat(1===u,") {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(2===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ").concat(c,"\n        } else if (").concat(3===u,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ").concat(c,"\n        }\n        setOutput(sumValue);\n      }\n    ")})),mfe=Jn((function e(t,n){$n(this,e),this.variableNames=["x"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.outSize;this.outputShape=[a,o];var s="0.0",u="";"prod"===n?s="1.0":"min"===n?(s="1.0 / 1e-20",u="min"):"max"===n&&(s="-1.0 / 1e-20",u="max");var c="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"sum"===n?c="sumValue":"prod"===n?c="prodValue":"all"===n?c="allValue":"any"===n&&(c="anyValue");var l=4*Math.floor(r/4),h=r%4,f="\n      if (".concat("sum"===n,") {\n        sumValue += dot(values, ones);\n      } else if (").concat("prod"===n,") {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ").concat(u,"(values, minMaxValue);\n      }\n    "),d="vec4";"all"===n?(s="1.0",f="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",d="bvec4"):"any"===n&&(s="0.0",f="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",d="bvec4");var p="";i%r>0&&(p="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat(s,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ").concat(p,"\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ").concat(r,";\n\n        vec4 minMaxValue = vec4(").concat(s,");\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ").concat(l,"; i += 4) {\n          int inIdx = inOffset + i;\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ").concat(f,"\n        }\n\n        int inIdx = inOffset + ").concat(l,";\n        if (").concat(1===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(f,"\n        } else if (").concat(2===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ").concat(f,"\n        } else if (").concat(3===h,") {\n          ").concat(d," values = ").concat(d,"(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ").concat(f,"\n        }\n        setOutput(").concat(c,");\n      }\n    ")}));function gfe(e,t,n,r){for(var a=function(e){for(var t=[];0===t.length||1!==t[t.length-1].outSize;){var n=t.length?t[t.length-1].outSize:e[1],r=Yue(n);t.push({inSize:n,windowSize:r,outSize:Math.ceil(n/r)})}return t}(e.shape),i=e,o=0;o<a.length;o++){var s,u=a[o],c=u.inSize,l=u.windowSize,h=u.outSize,f=void 0;f="mean"===n?0===o?new vfe({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:h},c):new vfe({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:h}):new mfe({windowSize:l,inSize:c,batchSize:e.shape[0],outSize:h},n),s=i,i=r.runWebGLProgram(f,[i],t),s.dataId!==e.dataId&&r.disposeIntermediateTensorInfo(s)}return i}var yfe=Jn((function e(t,n){$n(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];this.outputShape=r,this.rank=r.length;var i=zle(this.rank),o=function(e){var t=e.length;if(t>6)throw Error("Transpose for rank ".concat(t," is not yet supported"));for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],r=new Array(t),a=0;a<e.length;a++)r[e[a]]=n[a];return r.join()}(n);this.userCode="\n    void main() {\n      ".concat(i," resRC = getOutputCoords();\n      setOutput(getA(").concat(o,"));\n    }\n    ")}));var bfe=Jn((function e(t,n){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[n[a]];if(this.outputShape=r,this.rank=r.length,this.rank>6)throw Error("Packed transpose for rank ".concat(this.rank," is not yet supported."));for(var i=zle(this.rank),o=xhe("rc",this.rank),s=new Array(this.rank),u=0;u<n.length;u++)s[n[u]]=o[u];var c="vec2(".concat(s.slice(-2).join(),")"),l="++".concat(o[this.rank-1]," < ").concat(r[this.rank-1]),h="getChannel(getA(".concat(s.join(),"), ").concat(c,")");this.userCode="\n    void main() {\n      ".concat(i," rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ").concat(h,";\n      if(").concat(l,") {\n        result[1] = ").concat(h,";\n      }\n      --").concat(o[this.rank-1],";\n      if(++").concat(o[this.rank-2]," < ").concat(r[this.rank-2],") {\n        result[2] = ").concat(h,";\n        if(").concat(l,") {\n          result[3] = ").concat(h,";\n        }\n      }\n      setOutput(result);\n    }\n    ")}));function xfe(e,t,n){var r=zre().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new bfe(e.shape,t):new yfe(e.shape,t);return n.runWebGLProgram(r,[e],e.dtype)}function kfe(e){var t=e.inputs,n=e.backend,r=e.attrs;return function(e,t,n,r){var a=t,i=e.shape.length,o=gre(a,e.shape),s=o,u=$se(s,i),c=null!=u,l=e;c&&(l=xfe(e,u,r),s=tue(s.length,i)),Jse("sum",s,i);var h=f(Qse(l.shape,s),2),d=h[0],p=h[1],v=d;n&&(v=Zse(d,o));var m=hre(p),g=dfe({inputs:{x:l},attrs:{shape:[hre(e.shape)/m,m]},backend:r}),y=gfe(g,Aie(e.dtype),"sum",r),b=dfe({inputs:{x:y},attrs:{shape:v},backend:r});return r.disposeIntermediateTensorInfo(g),r.disposeIntermediateTensorInfo(y),c&&r.disposeIntermediateTensorInfo(l),b}(t.x,r.axis,r.keepDims,n)}var wfe={kernelName:Oae,backendName:"webgl",kernelFunc:kfe};function _fe(e){for(var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.perm,s=r,u=i.shape.length,c=new Array(u),l=0;l<c.length;l++)c[l]=i.shape[o[l]];if(s.shouldExecuteOnCPU([i])){var h=s.texData.get(i.dataId).values,f=yhe(h,i.shape,i.dtype,o,c);t=s.makeTensorInfo(c,i.dtype),s.texData.get(t.dataId).values=f}else t=xfe(i,o,s);return t}var Sfe={kernelName:Vae,backendName:"webgl",kernelFunc:_fe};function Cfe(e){var t=e.a,n=e.b,r=e.transposeA,a=e.transposeB,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,h=void 0===l?0:l,f=e.activation,d=void 0===f?null:f,p=t.shape.length,v=n.shape.length,m=r?t.shape[p-2]:t.shape[p-1],g=a?n.shape[v-1]:n.shape[v-2],y=r?t.shape[p-1]:t.shape[p-2],b=a?n.shape[v-2]:n.shape[v-1],x=t.shape.slice(0,-2),k=n.shape.slice(0,-2),w=hre(x),_=hre(k);sre(p>=2&&v>=2&&(w===_||1===w||1===_),(function(){return"Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input "+"batch dimensions of (".concat(x,") and (").concat(k,").")}));var S=(w>_?t.shape.slice(0,-2):n.shape.slice(0,-2)).concat([y,b]);sre(m===g,(function(){return"Error in matMul: inner shapes (".concat(m,") and (")+"".concat(g,") of Tensors with shapes ").concat(t.shape," and ")+"".concat(n.shape," and transposeA=").concat(r)+" and transposeB=".concat(a," must match.")}));var C,T=r?[w,m,y]:[w,y,m],E=a?[_,b,g]:[_,g,b],I=dfe({inputs:{x:t},backend:i,attrs:{shape:T}}),A=dfe({inputs:{x:n},backend:i,attrs:{shape:E}}),M=[I,A],N=Math.max(w,_),R=r?I.shape[1]:I.shape[2],D=null!=s,P=null!=c,O="leakyrelu"===d,L=null!=d?ife(d,!0):null;if((1===y||1===b)&&R>1e3&&!1===(D||P||O||null!=L)){var F=I,z=A;r&&(F=_fe({inputs:{x:I},backend:i,attrs:{perm:[0,2,1]}}),M.push(F)),a&&(z=_fe({inputs:{x:A},backend:i,attrs:{perm:[0,2,1]}}),M.push(z));var B=1===b,U=F;1!==b&&(U=dfe({inputs:{x:F},backend:i,attrs:{shape:[N,R,1]}}),M.push(U));var V=1===b?2:1,W=z;B&&(W=dfe({inputs:{x:z},backend:i,attrs:{shape:[N,1,R]}}),M.push(W));var G=hfe({inputs:{a:U,b:W},backend:i});C=kfe({inputs:{x:G},backend:i,attrs:{axis:V,keepDims:!0}}),M.push(G)}else{var j=Iie(t.dtype,n.dtype),q=new ofe(T,E,[N,y,b],r,a,D,L,P,O),H=[I,A];if(null!=s&&H.push(s),P&&H.push(c),O){var X=i.makeTensorInfo([],"float32",rie(h,"float32"));H.push(X),M.push(X)}C=i.runWebGLProgram(q,H,j)}var K=dfe({inputs:{x:C},backend:i,attrs:{shape:S}});M.push(C);for(var Y=0,Q=M;Y<Q.length;Y++){var Z=Q[Y];i.disposeIntermediateTensorInfo(Z)}return K}var Tfe={kernelName:"_FusedMatMul",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.a,i=t.b,o=t.bias,s=t.preluActivationWeights,u=r.transposeA,c=r.transposeB,l=r.activation;return Cfe({a:a,b:i,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:s,leakyreluAlpha:r.leakyreluAlpha,activation:l})}},Efe="return abs(x);";var Ife={kernelName:"Abs",backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])&&"complex64"!==a.dtype){var i=r.texData.get(a.dataId),o=fhe(i.values);return r.makeTensorInfo(a.shape,a.dtype,o)}return t=zre().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Uhe(a.shape,Efe):new Ihe(a.shape,Efe),r.runWebGLProgram(t,[a],a.dtype)}},Afe={kernelName:"Acos",backendName:"webgl",kernelFunc:rfe({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n"})},Mfe={kernelName:"Acosh",backendName:"webgl",kernelFunc:rfe({opSnippet:"if (isnan(x)) return x;\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));"})},Nfe="return a + b;",Rfe=afe({opSnippet:Nfe,packedOpSnippet:Nfe,supportsComplex:!0,cpuKernelImpl:qle}),Dfe={kernelName:Gre,backendName:"webgl",kernelFunc:Rfe},Pfe=Jn((function e(t,n){$n(this,e),this.outputShape=[],this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("float v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        float result = ").concat(a,";\n        setOutput(result);\n      }\n    ")})),Ofe=Jn((function e(t,n){$n(this,e),this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=n.map((function(e,t){return"T".concat(t)}));var r=[];this.variableNames.forEach((function(e){r.push("vec4 v".concat(e," = get").concat(e,"AtOutCoords();"))}));var a=this.variableNames.map((function(e){return"v".concat(e)})).join(" + ");this.userCode="\n      void main() {\n        ".concat(r.join("\n        "),"\n\n        vec4 result = ").concat(a,";\n        setOutput(result);\n      }\n    ")}));var Lfe={kernelName:"AddN",backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n;if(1===a.length)return Xhe({inputs:{x:a[0]},backend:r});if(a.length>zre().get("WEBGL_MAX_TEXTURES_IN_SHADER")){var i=Math.floor(a.length/2),o=e({inputs:a.slice(0,i),backend:r}),s=e({inputs:a.slice(i),backend:r});return e({inputs:[o,s],backend:r})}var u=a.map((function(e){return e.dtype})).reduce((function(e,t){return Iie(e,t)})),c=a.map((function(e){return e.shape})),l=zre().getBool("WEBGL_PACK")?new Ofe(a[0].shape,c):new Pfe(a[0].shape,c);return r.runWebGLProgram(l,a,u)}};var Ffe={kernelName:"All",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=gre(i,a.shape),c=u,l=$se(c,s),h=a;null!=l&&(h=_fe({inputs:{x:a},backend:n,attrs:{perm:l}}),c=tue(c.length,s)),Jse("all",c,s);var d,p=f(Qse(h.shape,c),2),v=p[0],m=dfe({inputs:{x:h},backend:n,attrs:{shape:[-1,hre(p[1])]}}),g=gfe(m,m.dtype,"all",n);return d=dfe(o?{inputs:{x:g},backend:n,attrs:{shape:Zse(v,u)}}:{inputs:{x:g},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(h),d}};var zfe={kernelName:"Any",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=gre(i,a.shape),c=u,l=$se(c,s),h=a;null!=l&&(h=_fe({inputs:{x:a},backend:n,attrs:{perm:l}}),c=tue(c.length,s)),Jse("any",c,s);var d,p=f(Qse(h.shape,c),2),v=p[0],m=dfe({inputs:{x:h},backend:n,attrs:{shape:[-1,hre(p[1])]}}),g=gfe(m,m.dtype,"any",n);return d=dfe(o?{inputs:{x:g},backend:n,attrs:{shape:Zse(v,u)}}:{inputs:{x:g},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(h),d}},Bfe=Jn((function e(t,n,r){$n(this,e),this.variableNames=["A"];var a=t.windowSize,i=t.batchSize,o=t.outSize;r||this.variableNames.push("bestIndicesA"),this.outputShape=[i,o];var s="max"===n?">":"<",u=r?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ".concat(a,";\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          int inIdx = ").concat(u,";\n          float candidate = getA(batch, inIdx);\n          if (candidate ").concat(s," bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    ")})),Ufe=Jn((function e(t,n,r,a){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,sre(t.length>2,(function(){return"Packed arg".concat(r.charAt(0).toUpperCase()+r.slice(1)," supports only inputs with rank above 2.")}));var i=t[t.length-1],o=Math.ceil(i/n);this.outputShape=t.slice(0,-1),o>1&&this.outputShape.push(o),a||this.variableNames.push("bestIndicesA");var s,u,c=this.outputShape,l=c.length,h=zle(l),f=khe("coords",l);if(1===o){var d=zle(u=l+1);s="\n        ".concat(d," sourceLocR = ").concat(d,"(").concat(f.join(),", 0);\n        ++").concat(f[l-1],";\n        ").concat(d," sourceLocG = ").concat(d,"(").concat(f.join(),", 0);\n        ++").concat(f[l-2],";\n        ").concat(d," sourceLocA = ").concat(d,"(").concat(f.join(),", 0);\n        --").concat(f[l-1],";\n        ").concat(d," sourceLocB = ").concat(d,"(").concat(f.join(),", 0);\n        --").concat(f[l-2],";")}else u=l,s="\n        ".concat(h," sourceLocR = coords;\n        ++").concat(f[l-1],";\n        ").concat(h," sourceLocG = coords;\n        ++").concat(f[l-2],";\n        ").concat(h," sourceLocA = coords;\n        --").concat(f[l-1],";\n        ").concat(h," sourceLocB = coords;\n        --").concat(f[l-2],";");var p=["x","y","z","w","u","v"].slice(0,u),v="."+p[u-1],m=p.map((function(e){return"int "+e})),g=khe("sourceLocR",u-1).concat("inIdx.r"),y=khe("sourceLocG",u-1).concat("inIdx.g"),b=khe("sourceLocB",u-1).concat("inIdx.b"),x=khe("sourceLocA",u-1).concat("inIdx.a"),k="max"===r?"greaterThan":"lessThan",w=a?"":"\n          inIdx = round(vec4(getBestIndicesAChannel(".concat(g.join(),"),\n                             getBestIndicesAChannel(").concat(y.join(),"),\n                             getBestIndicesAChannel(").concat(b.join(),"),\n                             getBestIndicesAChannel(").concat(x.join(),")));"),_="vec4(\n            getAChannel(".concat(g.join(),"),\n            hasNextCol ? getAChannel(").concat(y.join(),") : 0.,\n            hasNextRow ? getAChannel(").concat(b.join(),") : 0.,\n            hasNextRow && hasNextCol ? getAChannel(").concat(x.join(),") : 0.)"),S=a?"":"\n      float getBestIndicesAChannel(".concat(m.join(),") {\n        return getChannel(getBestIndicesA(").concat(p.join(),"),\n                                          vec2(").concat(p.slice(-2).join(),"));\n      }");this.userCode="\n      float getAChannel(".concat(m.join(),") {\n        return getChannel(getA(").concat(p.join(),"),\n                               vec2(").concat(p.slice(-2).join(),"));\n      }\n      ").concat(S,"\n      void main() {\n        ").concat(h," coords = getOutputCoords();\n        bool hasNextCol = ").concat(f[l-1]," < ").concat(c[l-1]-1,";\n        bool hasNextRow = ").concat(f[l-2]," < ").concat(c[l-2]-1,";\n        ").concat(s,"\n        ivec4 srcIdx = ivec4(sourceLocR").concat(v,", sourceLocG").concat(v,",\n          sourceLocB").concat(v,", sourceLocA").concat(v,") * ").concat(n,";\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ").concat(_,";\n\n        for (int i = 0; i < ").concat(n,"; i++) {\n          inIdx = srcIdx;\n          ").concat(w,"\n          vec4 candidate = ").concat(_,";\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(").concat(k,"(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    ")}));function Vfe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=t.shape[0],i=t.shape[1];null!=r&&(a=r.shape[0],i=r.shape[1]);var o=Yue(i),s={windowSize:o,inSize:i,batchSize:a,outSize:Math.ceil(i/o)},u=new Bfe(s,n,null==r),c=[t];null!=r&&c.push(r);var l=e.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;var h=Vfe(e,t,n,l);return e.disposeIntermediateTensorInfo(l),h}function Wfe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null,a=null!=r?r.shape:t.shape,i=a[a.length-1],o=Yue(i),s=new Ufe(a,o,n,null==r),u=null==r?[t]:[t,r],c=e.runWebGLProgram(s,u,"int32");if(c.shape.length===t.shape.length){var l=Wfe(e,t,n,c);return e.disposeIntermediateTensorInfo(c),l}return c}function Gfe(e,t,n,r){var a=[n];if(Jse("arg"+r.charAt(0).toUpperCase()+r.slice(1),a,t.shape.length),!zre().getBool("WEBGL_PACK_REDUCE")||t.shape.length<=2){var i=[],o=f(Qse(t.shape,a),2),s=o[0],u=hre(o[1]),c=dfe({inputs:{x:t},backend:e,attrs:{shape:[-1,u]}});i.push(c);var l=Vfe(e,c,r);i.push(l);var h=dfe({inputs:{x:l},backend:e,attrs:{shape:s}});return i.forEach((function(t){return e.disposeIntermediateTensorInfo(t)})),h}return Wfe(e,t,r)}var jfe={kernelName:"ArgMax",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=gre(r.axis,a.shape),o=$se(i,a.shape.length),s=a,u=[];null!=o&&(s=_fe({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=tue(i.length,s.shape.length)),Jse("argMax",[i[0]],s.shape.length);var c=Gfe(n,s,i[0],"max");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}};var qfe={kernelName:"ArgMin",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=gre(r.axis,a.shape),o=$se(i,a.shape.length),s=a,u=[];null!=o&&(s=_fe({inputs:{x:a},backend:n,attrs:{perm:o}}),u.push(s),i=tue(i.length,s.shape.length)),Jse("argMin",[i[0]],s.shape.length);var c=Gfe(n,s,i[0],"min");return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),c}},Hfe={kernelName:"Asin",backendName:"webgl",kernelFunc:rfe({opSnippet:"if (isnan(x)) return x;\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n"})},Xfe={kernelName:"Asinh",backendName:"webgl",kernelFunc:rfe({opSnippet:"if (isnan(x)) return x;return log(x + sqrt(x * x + 1.0));"})},Kfe={kernelName:"Atan",backendName:"webgl",kernelFunc:rfe({opSnippet:"if (isnan(x)) return x;\n  return atan(x);\n"})},Yfe={kernelName:"Atan2",backendName:"webgl",kernelFunc:afe({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return atan(a, b);\n",packedOpSnippet:"\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})},Qfe={kernelName:"Atanh",backendName:"webgl",kernelFunc:rfe({opSnippet:"if (isnan(x)) return x;\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;"})},Zfe=Jn((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if($n(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterHeight,f=t.effectiveFilterWidth,d=t.padInfo.top,p=t.padInfo.left;this.outputShape=t.outShape;var v="avg"===n,m="((batch  * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),g="(xR * ".concat(t.inWidth," + xC) * ").concat(t.inChannels," + d"),y="0.0";if(v||(y="-1.0 / 1e-20"),r){var b=">=";this.userCode="\n        const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n        const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ").concat(h,";\n              wR += ").concat(c,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(f,";\n                wC += ").concat(l,") {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ").concat(b," currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ").concat(a?i?m:g:"wR * ".concat(f," + wC"),";\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var x="max",k="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(k="avgValue / count");var w=4*Math.floor(o/4),_=o%4,S="\n      if (".concat(v,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(x,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec2 strides = ivec2(".concat(s,", ").concat(u,");\n      const ivec2 pads = ivec2(").concat(d,", ").concat(p,");\n      const float initializationValue = ").concat(y,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(y,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ").concat(h,";\n            wR += ").concat(c,") {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(w,"; wC += 4) {\n            int xC = xCCorner + wC * ").concat(l,";\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              getValue(batch, xR, xC + 3 * ").concat(l,", d)\n            );\n\n            ").concat(S,"\n          }\n\n          int xC = xCCorner + ").concat(w,";\n          if (").concat(1===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(S,"\n          } else if (").concat(2===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              initializationValue,\n              initializationValue\n            );\n\n            ").concat(S,"\n          } else if (").concat(3===_,") {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ").concat(l,", d),\n              getValue(batch, xR, xC + 2 * ").concat(l,", d),\n              initializationValue\n            );\n\n            ").concat(S,"\n          }\n        }\n        setOutput(").concat(k,");\n      }\n    ")}})),Jfe=Jn((function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if($n(this,e),this.variableNames=["x"],"avg"===n&&r)throw new Error("Cannot compute positions for average pool.");var o=t.filterWidth,s=t.strideDepth,u=t.strideHeight,c=t.strideWidth,l=t.dilationDepth,h=t.dilationHeight,f=t.dilationWidth,d=t.effectiveFilterDepth,p=t.effectiveFilterHeight,v=t.effectiveFilterWidth,m=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;var b="avg"===n,x="0.0";if(b||(x="-1.0 / 1e-20"),r){var k=">=";this.userCode="\n        const ivec3 strides =\n            ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n        const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(y,");\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ").concat(d,";\n              wD += ").concat(l,") {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int wR = 0; wR < ").concat(p,";\n                wR += ").concat(h,") {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int wC = 0; wC < ").concat(v,";\n                  wC += ").concat(f,") {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ").concat(k," currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ").concat(a?i?"(((batch * ".concat(t.inDepth," + xD) * ").concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"((xD * ".concat(t.inHeight," + xR) * ").concat(t.inWidth," + xC) * ").concat(t.inChannels," + ch"):"wD * ".concat(p," * ").concat(v," +\n                      wR * ").concat(v," + wC"),";\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      ")}else{var w="max",_="".concat(n,"(").concat(n,"(").concat(n,"(")+"minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])";"avg"===n&&(_="avgValue / count");var S=4*Math.floor(o/4),C=o%4,T="\n      if (".concat(b,") {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ").concat(w,"(values, minMaxValue);\n      }\n    ");this.userCode="\n      const ivec3 strides =\n        ivec3(".concat(s,", ").concat(u,", ").concat(c,");\n      const ivec3 pads = ivec3(").concat(m,", ").concat(g,", ").concat(y,");\n      const float initializationValue = ").concat(x,";\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ").concat(t.inWidth,") {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(").concat(x,");\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ").concat(d,";\n            wD += ").concat(l,") {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(p,";\n            wR += ").concat(h,") {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(S,"; wC += 4) {\n              int xC = xCCorner + wC * ").concat(f,";\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 3 * ").concat(f,", ch)\n              );\n\n              ").concat(T,"\n            }\n\n            int xC = xCCorner + ").concat(S,";\n            if (").concat(1===C,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(T,"\n            } else if (").concat(2===C,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ").concat(T,"\n            } else if (").concat(3===C,") {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ").concat(f,", ch),\n                getValue(batch, xD, xR, xC + 2 * ").concat(f,", ch),\n                initializationValue\n              );\n\n              ").concat(T,"\n            }\n          }\n          setOutput(").concat(_,");\n        }\n      }\n    ")}}));var $fe={kernelName:"AvgPool",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;rle(a,"avgPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;sre(Xue(o,1),(function(){return"Error in avgPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Oue(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&fre(c.inShape,c.outShape))return Xhe({inputs:{x:a},backend:n});var l=new Zfe(c,"avg",!1);return n.runWebGLProgram(l,[a],"float32")}};var ede={kernelName:"AvgPool3D",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode,c=r.dataFormat,l=Lue(a.shape,i,o,[1,1,1],s,u,c),h=new Jfe(l,"avg",!1);return n.runWebGLProgram(h,[a],"float32")}},tde=Jn((function e(t){$n(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=u-1-t.padInfo.top,h=c-1-t.padInfo.left,f=1/(n*r);this.userCode="\n      const ivec2 pads = ivec2(".concat(l,", ").concat(h,");\n      const float avgMultiplier = float(").concat(f,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(u,";\n            wR += ").concat(o,") {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(c,";\n            wC+= ").concat(s,") {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),nde=Jn((function e(t){$n(this,e),this.variableNames=["dy"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,h=t.effectiveFilterDepth,f=t.effectiveFilterHeight,d=t.effectiveFilterWidth,p=h-1-t.padInfo.front,v=f-1-t.padInfo.top,m=d-1-t.padInfo.left,g=1/(n*r*a);this.userCode="\n      const ivec3 pads = ivec3(".concat(p,", ").concat(v,", ").concat(m,");\n      const float avgMultiplier = float(").concat(g,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(h,";\n            wD += ").concat(u,") {\n          float dyD = float(dyDCorner + wD) / ").concat(i,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(f,";\n              wR += ").concat(c,") {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(d,";\n                wC += ").concat(l,") {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var rde={kernelName:"AvgPool3DGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Lue(i.shape,o,s,[1,1,1],u,c),h=new nde(l);return n.runWebGLProgram(h,[a],i.dtype)}};var ade={kernelName:"AvgPoolGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;rle([a,i],"avgPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=Oue(o.shape,s,u,1,c),h=new tde(l);return n.runWebGLProgram(h,[a],o.dtype)}};var ide={kernelName:jre,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs;return Cfe({a:t.a,b:t.b,transposeA:r.transposeA,transposeB:r.transposeB,backend:n})}},ode=Jn((function e(t,n,r,a,i,o){$n(this,e),this.outputShape=[],this.variableNames=["x","mean","variance"],Mse(t,n),Mse(t,r);var s="0.0";null!=a&&(Mse(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="1.0";null!=i&&(Mse(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ".concat(s,";\n        float scale = ").concat(u,";\n        float inv = scale * inversesqrt(variance + float(").concat(o,"));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    ")})),sde=Jn((function e(t,n,r,a,i,o){$n(this,e),this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],Mse(t,n),Mse(t,r);var s="vec4(0.0)";null!=a&&(Mse(t,a),this.variableNames.push("offset"),s="getOffsetAtOutCoords()");var u="vec4(1.0)";null!=i&&(Mse(t,i),this.variableNames.push("scale"),u="getScaleAtOutCoords()"),this.outputShape=t,this.userCode="\n      void main() {\n        vec4 offset = ".concat(s,";\n        vec4 scale = ").concat(u,";\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(").concat(o,"));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    ")})),ude={kernelName:"FusedBatchNorm",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.mean,o=t.variance,s=t.offset,u=t.scale;sre(i.shape.length===o.shape.length,(function(){return"Batch normalization gradient requires mean and variance to have equal ranks."})),sre(null==s||i.shape.length===s.shape.length,(function(){return"Batch normalization gradient requires mean and offset to have equal ranks."})),sre(null==u||i.shape.length===u.shape.length,(function(){return"Batch normalization gradient requires mean and scale to have equal ranks."}));var c=r.varianceEpsilon;null==c&&(c=.001);var l=[a,i,o],h=null;null!=s&&(h=s.shape,l.push(s));var f=null;null!=u&&(f=u.shape,l.push(u));var d=zre().getBool("WEBGL_PACK_NORMALIZATION")?new sde(a.shape,i.shape,o.shape,h,f,c):new ode(a.shape,i.shape,o.shape,h,f,c);return n.runWebGLProgram(d,l,l[0].dtype)}},cde=function(){function e(t){$n(this,e),this.variableNames=["source"],this.outputShape=t,this.rank=t.length;var n,r=zle(this.rank),a="uniform int start[".concat(this.rank,"];"),i=function(e){if(1===e)return"sourceLoc";if(e<=6)return lde.slice(0,e).map((function(e){return"sourceLoc."+e})).join(",");throw Error("Slicing for rank ".concat(e," is not yet supported"))}(this.rank),o=t.map((function(e,t){return"sourceLoc.".concat(lde[t]," = start[").concat(t,"] + coords.").concat(lde[t],";")}));n="\n        ".concat(r," sourceLoc;\n        ").concat(r," coords = getOutputCoords();\n        ").concat(o.join("\n"),"\n      "),this.userCode="\n      ".concat(a,"\n      void main() {\n        ").concat(n,"\n        setOutput(getSource(").concat(i,"));\n      }\n    ")}return Jn(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the ")+"length of start (".concat(e.length,")"));return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}}}]),e}(),lde=["x","y","z","w","u","v"];var hde=function(){function e(t){$n(this,e),this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;var n=zle(this.rank),r=khe("coords",this.rank),a=khe("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":"vec2(".concat(a.slice(-2).join(),")"),o="getChannel(getSource(".concat(a.join(),"), ").concat(i,")"),s="\n      result.x = ".concat(o,";\n      if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n        ++").concat(a[this.rank-1],";\n        result.y = ").concat(o,";\n        --").concat(a[this.rank-1],";\n      }\n    "),u=1===this.rank?"":"\n      --".concat(r[this.rank-1],";\n      if (++").concat(r[this.rank-2]," < ").concat(t[this.rank-2],") {\n        ++").concat(a[this.rank-2],";\n        result.z = ").concat(o,";\n        if (++").concat(r[this.rank-1]," < ").concat(t[this.rank-1],") {\n          ++").concat(a[this.rank-1],";\n          result.w = ").concat(o,";\n        }\n      }\n    "),c=this.rank<=4?"sourceLoc = coords +\n            ".concat(n,"(").concat(t.map((function(e,t){return"start[".concat(t,"]")})).join(),");"):t.map((function(e,t){return"".concat(a[t]," = ").concat(r[t]," + start[").concat(t,"];")})).join("\n");this.userCode="\n      uniform int start[".concat(this.rank,"];\n      void main() {\n        ").concat(n," coords = getOutputCoords();\n        ").concat(n," sourceLoc;\n        ").concat(c,"\n        vec4 result = vec4(0.);\n        ").concat(s,"\n        ").concat(u,"\n        setOutput(result);\n      }\n    ")}return Jn(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;if(e.length!==this.rank)throw Error("The rank (".concat(this.rank,") of the program must match the ")+"length of start (".concat(e.length,")"));return function(n,r){null==t.startLoc&&(t.startLoc=n.getUniformLocationNoThrow(r,"start"),null==t.startLoc)||n.gl.uniform1iv(t.startLoc,e)}}}]),e}();function fde(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=function(e,t,n){var r,a,i=e.shape.length;return(r="number"===typeof t?[t].concat(Tt(new Array(i-1).fill(0))):t.length<i?t.concat(new Array(i-t.length).fill(0)):t.slice()).forEach((function(e){sre(-1!==e,(function(){return"slice() does not support negative begin indexing."}))})),a=(a=null==n?new Array(i).fill(-1):"number"===typeof n?[n].concat(Tt(new Array(i-1).fill(-1))):n.length<i?n.concat(new Array(i-n.length).fill(-1)):n).map((function(t,n){return t>=0?t:(sre(-1===t,(function(){return"Negative size values should be exactly -1 but got "+"".concat(t," for the slice() size at index ").concat(n,".")})),e.shape[n]-r[n])})),[r,a]}(a,r.begin,r.size),o=f(i,2),s=o[0],u=o[1];if(function(e,t,n){var r=e.shape.length;sre(r===t.length,(function(){return"Error in slice".concat(r,"D: Length of begin ").concat(t," must ")+"match the rank of the array (".concat(r,").")})),sre(r===n.length,(function(){return"Error in slice".concat(r,"D: Length of size ").concat(n," must ")+"match the rank of the array (".concat(r,").")}));for(var a=function(a){sre(t[a]+n[a]<=e.shape[a],(function(){return"Error in slice".concat(r,"D: begin[").concat(a,"] + size[").concat(a,"] ")+"(".concat(t[a]+n[a],") would overflow input.shape[").concat(a,"] (").concat(e.shape[a],")")}))},i=0;i<r;++i)a(i)}(a,s,u),0===hre(u))return n.makeTensorInfo(u,a.dtype,[]);if(n.shouldExecuteOnCPU([a])||"string"===a.dtype){var c=n.texData.get(a.dataId),l=dhe(c.values,s,u,a.shape,a.dtype);return n.makeTensorInfo(u,a.dtype,l)}var h=n.texData.get(a.dataId).isPacked,d=function(e,t,n){for(var r=n.length,a=0;a<n.length;a++)if(n[a]>1){r=a;break}for(var i=r+1;i<n.length;i++)if(t[i]>0||n[i]!==e[i])return!1;return!0}(a.shape,s,u);if(h||!d){var p=zre().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new hde(u):new cde(u),v=p.getCustomSetupFunc(s);return n.runWebGLProgram(p,[a],a.dtype,v)}return n.uploadToGPU(a.dataId),function(e,t,n,r){var a=r.texData.get(e.dataId),i=r.makeTensorInfo(n,e.dtype),o=r.texData.get(i.dataId);Object.assign(o,a),o.complexParentRefCount=0,o.refCount=1,o.shape=n,o.dtype=e.dtype;var s=function(e,t){for(var n=e.length>0?e[e.length-1]:1,r=0;r<e.length-1;r++)n+=e[r]*t[r];return n}(t,Ere(e.shape));a.slice&&(s+=a.slice.flatOffset),o.slice={flatOffset:s,origDataId:a.slice&&a.slice.origDataId||e.dataId};var u=r.dataRefCount.get(o.slice.origDataId)||1;return r.dataRefCount.set(o.slice.origDataId,u+1),i}(a,s,u,n)}var dde={kernelName:Rae,backendName:"webgl",kernelFunc:fde},pde={kernelName:"BatchToSpaceND",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.crops;sre(a.shape.length<=4,(function(){return"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=Que(a.shape,i,s),c=Zue(u.length,i.length),l=Jue(a.shape,i,s),h=function(e,t){for(var n=[0],r=0;r<t;++r)n.push(e[r][0]);return n}(o,i.length),f=function(e,t,n){for(var r=e.slice(0,1),a=0;a<n;++a)r.push(e[a+1]-t[a][0]-t[a][1]);return r}(l,o,i.length),d=[],p=dfe({inputs:{x:a},backend:n,attrs:{shape:u}}),v=_fe({inputs:{x:p},backend:n,attrs:{perm:c}}),m=dfe({inputs:{x:v},backend:n,attrs:{shape:l}}),g=fde({inputs:{x:m},backend:n,attrs:{begin:h,size:f}});return d.push(p),d.push(v),d.push(m),d.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var vde={kernelName:qre,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=n.readSync(a.dataId),u=n.readSync(i.dataId),c=Hle(s,u,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,c)}},mde=afe({opSnippet:"return float(a != b);",dtype:"bool"}),gde={kernelName:mae,backendName:"webgl",kernelFunc:mde};function yde(e){var t=e.inputs,n=e.backend,r=t.input;return Xhe({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.real},backend:n})}var bde={kernelName:_ae,backendName:"webgl",kernelFunc:yde};var xde={kernelName:Hre,backendName:"webgl",kernelFunc:function e(t){var n,r,a=t.inputs,i=t.backend,o=t.attrs,s=a.x,u=o.dtype;if("complex64"===u){if("complex64"===s.dtype)return Xhe({inputs:{x:s},backend:i});var c=Joe(s.shape),l=e({inputs:{x:s},backend:i,attrs:{dtype:"float32"}}),h=Yhe({inputs:{real:l,imag:c},backend:i});return c.dispose(),i.disposeIntermediateTensorInfo(l),h}if("complex64"===s.dtype){var f=yde({inputs:{input:s},backend:i}),d=e({inputs:{x:f},backend:i,attrs:{dtype:u}});return i.disposeIntermediateTensorInfo(f),d}if(n=s.dtype,"complex64"===(r=u)||"float32"===r&&"complex64"!==n||"int32"===r&&"float32"!==n&&"complex64"!==n||"bool"===r&&"bool"===n){var p=Xhe({inputs:{x:s},backend:i});return{dataId:p.dataId,shape:p.shape,dtype:u}}if("int32"===u)return function(e,t){var n=new Ihe(e.shape,"return float(int(x));"),r=t.runWebGLProgram(n,[e],"int32");return{dataId:r.dataId,shape:r.shape,dtype:r.dtype}}(s,i);if("bool"===u){var v=i.makeTensorInfo([],"bool",bre("bool",1)),m=mde({inputs:{a:s,b:v},backend:i});return i.disposeIntermediateTensorInfo(v),m}throw new Error("Error in Cast: failed to cast ".concat(s.dtype," to ").concat(u))}},kde="return ceil(x);",wde={kernelName:"Ceil",backendName:"webgl",kernelFunc:rfe({opSnippet:kde,packedOpSnippet:kde,cpuKernelImpl:Kle})},_de=function(){function e(t){$n(this,e),this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}return Jn(e,[{key:"getCustomSetupFunc",value:function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}}}]),e}(),Sde=function(){function e(t){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}return Jn(e,[{key:"getCustomSetupFunc",value:function(e,t){var n=this;return function(r,a){null==n.minLoc&&(n.minLoc=r.getUniformLocationNoThrow(a,"minVal"),n.maxLoc=r.getUniformLocationNoThrow(a,"maxVal")),r.gl.uniform1f(n.minLoc,e),r.gl.uniform1f(n.maxLoc,t)}}}]),e}();var Cde={kernelName:"ClipByValue",backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.clipValueMin,s=a.clipValueMax,u=(t=zre().getBool("WEBGL_PACK_CLIP")?new Sde(i.shape):new _de(i.shape)).getCustomSetupFunc(o,s);return r.runWebGLProgram(t,[i],i.dtype,u)}},Tde=Jn((function e(t){$n(this,e),this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}));function Ede(e,t){return{dataId:t.dataId,dtype:t.dtype,shape:e.shape}}var Ide={kernelName:Kre,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=n.texData.get(r.dataId),i=new Tde(r.shape),o=[Ede(r,a.complexTensorInfos.real),Ede(r,a.complexTensorInfos.imag)];return n.runWebGLProgram(i,o,o[0].dtype)}},Ade=Jn((function e(t){$n(this,e),this.outputShape=[],this.outputShape=Pue(t,1),this.variableNames=t.map((function(e,t){return"T".concat(t)}));var n=new Array(t.length-1);n[0]=t[0][1];for(var r=1;r<n.length;r++)n[r]=n[r-1]+t[r][1];for(var a=["if (yC < ".concat(n[0],") setOutput(getT0(yR, yC));")],i=1;i<n.length;i++){var o=n[i-1];a.push("else if (yC < ".concat(n[i],") ")+"setOutput(getT".concat(i,"(yR, yC-").concat(o,"));"))}var s=n.length,u=n[n.length-1];a.push("else setOutput(getT".concat(s,"(yR, yC-").concat(u,"));")),this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ".concat(a.join("\n        "),"\n      }\n    ")})),Mde=Jn((function e(t,n){$n(this,e),this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=Pue(t,n);var r=this.outputShape,a=r.length,i=zle(a),o=khe("coords",a),s=["x","y","z","w","u","v"].slice(0,a);this.variableNames=t.map((function(e,t){return"T".concat(t)}));var u=new Array(t.length-1);u[0]=t[0][n];for(var c=1;c<u.length;c++)u[c]=u[c-1]+t[c][n];for(var l=s[n],h=s.slice(-2),f=s.join(),d="if (".concat(l," < ").concat(u[0],") {\n        return getChannel(\n            getT0(").concat(f,"), vec2(").concat(h.join(),"));\n        }"),p=1;p<u.length;p++){var v=u[p-1];d+="\n        if (".concat(l," < ").concat(u[p],"  && ").concat(l," >= ").concat(u[p-1],") {\n          return getChannel(\n            getT").concat(p,"(").concat(Nde(s,l,v),"),\n            vec2(").concat(Nde(h,l,v),"));\n        }")}var m=u.length,g=u[u.length-1];d+="\n        return getChannel(\n          getT".concat(m,"(").concat(Nde(s,l,g),"),\n          vec2(").concat(Nde(h,l,g),"));"),this.userCode="\n      float getValue(".concat(s.map((function(e){return"int "+e})),") {\n        ").concat(d,"\n      }\n\n      void main() {\n        ").concat(i," coords = getOutputCoords();\n        vec4 result = vec4(getValue(").concat(o,"), 0., 0., 0.);\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," + 1;\n        if (").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.g = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-2]," = ").concat(o[a-2]," + 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2],") {\n          result.a = getValue(").concat(o,");\n        }\n\n        ").concat(o[a-1]," = ").concat(o[a-1]," - 1;\n        if (").concat(o[a-2]," < ").concat(r[a-2]," &&\n            ").concat(o[a-1]," < ").concat(r[a-1],") {\n          result.b = getValue(").concat(o,");\n        }\n        setOutput(result);\n      }\n    ")}));function Nde(e,t,n){var r=e.indexOf(t);return e.map((function(e,t){return t===r?"".concat(e," - ").concat(n):e})).join()}function Rde(e){var t=e.inputs,n=e.backend,r=t.input;return Xhe({inputs:{x:n.texData.get(r.dataId).complexTensorInfos.imag},backend:n})}var Dde={kernelName:oae,backendName:"webgl",kernelFunc:Rde};function Pde(e,t,n){var r=e[0].dtype;if("complex64"===r){var a=e.map((function(e){return yde({inputs:{input:e},backend:n})})),i=e.map((function(e){return Rde({inputs:{input:e},backend:n})})),o=Pde(a,t,n),s=Pde(i,t,n),u=Yhe({inputs:{real:o,imag:s},backend:n});return a.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),i.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}if("string"===r){var c=Ode(e,t,n),l=c.tensors2D,h=c.outShape,f=l.map((function(e){return{vals:n.readSync(e.dataId),shape:e.shape}})),d=1===l[0].shape[0],p=Yle(f,h,r,d),v=Pue(e.map((function(e){return e.shape})),t),m=n.makeTensorInfo(v,r,p);return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),m}if(e.length>zre().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){var g=Math.floor(e.length/2),y=Pde(e.slice(0,g),t,n),b=Pde(e.slice(g),t,n),x=Pde([y,b],t,n);return n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(b),x}if(zre().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&e[0].shape.length>1){var k=new Mde(e.map((function(e){return e.shape})),t);return n.runWebGLProgram(k,e,r)}var w=Ode(e,t,n),_=w.tensors2D,S=w.outShape,C=new Ade(_.map((function(e){return e.shape}))),T=n.runWebGLProgram(C,_,r);_.forEach((function(e){return n.disposeIntermediateTensorInfo(e)}));var E=dfe({inputs:{x:T},attrs:{shape:S},backend:n});return n.disposeIntermediateTensorInfo(T),E}function Ode(e,t,n){var r=Pue(e.map((function(e){return e.shape})),t),a=e.map((function(e){return dfe({inputs:{x:e},attrs:{shape:[-1,hre(e.shape.slice(t))]},backend:n})}));return{tensors2D:a,outShape:r}}function Lde(e){var t=e.inputs,n=e.backend,r=gre(e.attrs.axis,t[0].shape)[0],a=Pue(t.map((function(e){return e.shape})),r);if(0===hre(a))return n.makeTensorInfo(a,t[0].dtype,[]);var i=t.filter((function(e){return hre(e.shape)>0}));return 1===i.length?Xhe({inputs:{x:i[0]},backend:n}):(function(e,t){var n=e[0].length;e.forEach((function(e,t){sre(e.length===n,(function(){return"Error in concat".concat(n,"D: rank of tensors[").concat(t,"] must be the same ")+"as the rank of the rest (".concat(n,")")}))})),sre(t>=0&&t<n,(function(){return"Error in concat".concat(n,"D: axis must be between 0 and ").concat(n-1,".")}));var r=e[0];e.forEach((function(e,a){for(var i=0;i<n;i++)sre(i===t||e[i]===r[i],(function(){return"Error in concat".concat(n,"D: Shape of tensors[").concat(a,"] (").concat(e,") ")+"does not match the shape of the rest (".concat(r,") ")+"along the non-concatenated axis ".concat(a,".")}))}))}(i.map((function(e){return e.shape})),r),Pde(i,r,n))}var Fde={kernelName:Yre,backendName:"webgl",kernelFunc:Lde},zde=Jn((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];$n(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.padInfo.top,s=t.padInfo.left,u=t.strideHeight,c=t.strideWidth,l=t.dilationHeight,h=t.dilationWidth,f=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),v=t.inChannels%4,m="channelsLast"===t.dataFormat,g=m?1:2,y=m?2:3,b=m?3:1,x="",k="";r&&(x=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),k="result = activation(result);");var w=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(x,"\n\n      const ivec2 strides = ivec2(").concat(u,", ").concat(c,");\n      const ivec2 pads = ivec2(").concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[").concat(b,"];\n\n        ivec2 xRCCorner =\n            ivec2(coords[").concat(g,"], coords[").concat(y,"]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(f,"; wR++) {\n          int xR = xRCorner + wR * ").concat(l,";\n\n          if (xR < 0 || xR >= ").concat(t.inHeight,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(d,"; wC++) {\n            int xC = xCCorner + wC * ").concat(h,";\n\n            if (xC < 0 || xC >= ").concat(t.inWidth,") {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ").concat(p,"; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (").concat(m,") {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (").concat(1===v,") {\n\n              if (").concat(m,") {\n                dotProd +=\n                    getX(batch, xR, xC, ").concat(p,") *\n                    getW(wR, wC, ").concat(p,", d2);\n              } else {\n                dotProd +=\n                    getX(batch, ").concat(p,", xR, xC) *\n                    getW(wR, wC, ").concat(p,", d2);\n              }\n\n            } else if (").concat(2===v,") {\n              vec2 wValues = vec2(\n                getW(wR, wC, ").concat(p,", d2),\n                getW(wR, wC, ").concat(p," + 1, d2)\n              );\n\n              if (").concat(m,") {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ").concat(p,"),\n                  getX(batch, xR, xC, ").concat(p," + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ").concat(p,", xR, xC),\n                  getX(batch, ").concat(p," + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (").concat(3===v,") {\n              vec3 wValues = vec3(\n                getW(wR, wC, ").concat(p,", d2),\n                getW(wR, wC, ").concat(p," + 1, d2),\n                getW(wR, wC, ").concat(p," + 2, d2)\n              );\n\n              if (").concat(m,") {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ").concat(p,"),\n                  getX(batch, xR, xC, ").concat(p," + 1),\n                  getX(batch, xR, xC, ").concat(p," + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ").concat(p,", xR, xC),\n                  getX(batch, ").concat(p," + 1, xR, xC),\n                  getX(batch, ").concat(p," + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ").concat(w,"\n        ").concat(k,"\n        setOutput(result);\n      }\n    ")})),Bde=Jn((function e(t){$n(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.padInfo.front,r=t.padInfo.top,a=t.padInfo.left,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=t.dilationDepth,c=t.dilationHeight,l=t.dilationWidth,h=t.filterDepth,f=t.filterHeight,d=t.filterWidth,p=4*Math.floor(t.inChannels/4),v=t.inChannels%4;this.userCode="\n      const ivec3 strides = ivec3(".concat(i,", ").concat(o,", ").concat(s,");\n      const ivec3 pads = ivec3(").concat(n,", ").concat(r,", ").concat(a,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(h,"; wF++) {\n          int xF = xFCorner + wF * ").concat(u,";\n\n          if (xF < 0 || xF >= ").concat(t.inDepth,") {\n            continue;\n          }\n\n          for (int wR = 0; wR < ").concat(f,"; wR++) {\n            int xR = xRCorner + wR * ").concat(c,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int wC = 0; wC < ").concat(d,"; wC++) {\n              int xC = xCCorner + wC * ").concat(l,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ").concat(p,"; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (").concat(1===v,") {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ").concat(p,") *\n                  getW(wF, wR, wC, ").concat(p,", d2);\n              } else if (").concat(2===v,") {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (").concat(3===v,") {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ").concat(p,"),\n                  getX(batch, xF, xR, xC, ").concat(p," + 1),\n                  getX(batch, xF, xR, xC, ").concat(p," + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ").concat(p,", d2),\n                  getW(wF, wR, wC, ").concat(p," + 1, d2),\n                  getW(wF, wR, wC, ").concat(p," + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),Ude=Jn((function e(t,n,r){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;for(var a=r.filterWidth,i=r.inChannels,o=r.strideWidth,s=r.strideHeight,u=r.padInfo,c=r.outWidth,l=r.dilationWidth,h=r.dilationHeight,f=r.dataFormat,d=u.left,p=u.top,v=i*a,m=ile(),g="channelsLast"===f,y=g?0:1,b=g?1:2,x="",k=0;k<=1;k++)for(var w=0;w<=1;w++)x+="\n          blockIndex = rc.y + ".concat(w,";\n          pos = rc.x + ").concat(k,";\n\n          if(blockIndex < ").concat(t[1]," && pos < ").concat(t[0],") {\n            offsetY = int(blockIndex / (").concat(c,")) * ").concat(s," - ").concat(p,";\n            d0 = offsetY + ").concat(h," * (pos / ").concat(v,");\n\n            if(d0 < ").concat(n[y]," && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ").concat(c,".) * ").concat(o,". - ").concat(d,".);\n              d1 = offsetX + ").concat(l," * (int(mod(float(pos), ").concat(v,".) / ").concat(i,".));\n\n              if(d1 < ").concat(n[b]," && d1 >= 0) {\n\n                ch = int(mod(float(pos), ").concat(i,".));\n\n                if (").concat(g,") {\n                  innerDims = vec2(d1, ch);\n                  result[").concat(2*k+w,"] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[").concat(2*k+w,"] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        ");this.userCode="\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ".concat(x,"\n\n        ").concat(m.output," = result;\n      }\n    ")}));function Vde(e){var t,n=e.x,r=e.filter,a=e.convInfo,i=e.backend,o=e.bias,s=void 0===o?null:o,u=e.preluActivationWeights,c=void 0===u?null:u,l=e.leakyreluAlpha,h=void 0===l?0:l,f=e.activation,d=void 0===f?null:f,p=n.shape,v=i.texData.get(n.dataId),m=a.inChannels,g=p[0]*p[1]*p[2],y=a.outChannels,b="channelsLast"===a.dataFormat,x=[],k=(1===g||1===y)&&m>1e3,w=p[2]%2!==0&&!!v.isPacked;if(!k&&zre().getBool("WEBGL_LAZILY_UNPACK")&&zre().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&w){var _=b?p[0]*p[1]*(p[2]+1):p[0]*p[2]*(p[3]+1),S={dataId:n.dataId,shape:[1,_,a.inChannels],dtype:n.dtype},C=v.shape;v.shape=v.shape.slice(),v.shape[v.shape.length-2]++,sre(Jce(v.shape,S.shape),(function(){return"packed reshape ".concat(v.shape," to ").concat(S.shape," isn't free")}));var T=dfe({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}});x.push(T);var E=Cfe({a:S,b:T,backend:i,transposeA:false,transposeB:false,bias:s,activation:d,preluActivationWeights:c,leakyreluAlpha:h}),I=i.texData.get(E.dataId);sre(I.isPacked,(function(){return"batchMatMul result is expected to be packed"})),v.shape=C,I.shape=a.outShape,(t=Xhe({inputs:{x:E},backend:i})).shape=a.outShape,x.push(E)}else{var A=dfe({inputs:{x:n},backend:i,attrs:{shape:[1,b?p[0]*p[1]*p[2]:p[0]*p[2]*p[3],a.inChannels]}}),M=dfe({inputs:{x:r},backend:i,attrs:{shape:[1,a.inChannels,a.outChannels]}}),N=Cfe({a:A,b:M,transposeA:false,transposeB:false,backend:i,bias:s,activation:d,preluActivationWeights:c,leakyreluAlpha:h});t=dfe({inputs:{x:N},backend:i,attrs:{shape:a.outShape}}),x.push(A),x.push(M),x.push(N)}for(var R=0,D=x;R<D.length;R++){var P=D[R];i.disposeIntermediateTensorInfo(P)}return t}function Wde(e){var t=e.x,n=e.filter,r=e.convInfo,a=e.backend,i=e.bias,o=void 0===i?null:i,s=e.preluActivationWeights,u=void 0===s?null:s,c=e.leakyreluAlpha,l=void 0===c?0:c,h=e.activation,f=void 0===h?null:h,d=r.filterWidth,p=r.filterHeight,v=r.inChannels,m=r.outWidth,g=r.outHeight,y="channelsLast"===r.dataFormat,b=d*p*v,x=g*m,k=[b,x],w=[],_=dfe({inputs:{x:t},backend:a,attrs:{shape:t.shape.slice(1)}}),S=dfe({inputs:{x:n},backend:a,attrs:{shape:[1,b,hre(n.shape)/b]}});w.push(_),w.push(S);var C=new Ude(k,_.shape,r),T=a.runWebGLProgram(C,[_],"float32"),E=dfe({inputs:{x:T},backend:a,attrs:{shape:[1,k[0],k[1]]}});w.push(T),w.push(E);var I=null!=o,A=null!=u,M="leakyrelu"===f,N=f?ife(f,!0):null,R=new ofe(E.shape,S.shape,[1,x,r.outChannels],!0,!1,I,N,A,M),D=[E,S];if(o&&D.push(o),A&&D.push(u),M){var P=a.makeTensorInfo([],"float32",rie(l,"float32"));D.push(P),w.push(P)}var O=a.runWebGLProgram(R,D,"float32"),L=dfe({inputs:{x:O},backend:a,attrs:{shape:y?[1,g,m,r.outChannels]:[1,r.outChannels,g,m]}});w.push(O);for(var F=0,z=w;F<z.length;F++){var B=z[F];a.disposeIntermediateTensorInfo(B)}return L}var Gde={kernelName:"Conv2D",backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dataFormat,l=a.dilations,h=a.dimRoundingMode,f=Kue(c),d=Fue(i.shape,o.shape,s,l,u,h,!1,f);if(1!==d.filterHeight||1!==d.filterWidth||1!==d.dilationHeight||1!==d.dilationWidth||1!==d.strideHeight||1!==d.strideWidth||"SAME"!==d.padInfo.type&&"VALID"!==d.padInfo.type)if(zre().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])t=Wde({x:i,filter:o,convInfo:d,backend:r});else{var p=new zde(d);t=r.runWebGLProgram(p,[i,o],"float32")}else t=Vde({x:i,filter:o,convInfo:d,backend:r});var v=dfe({inputs:{x:t},backend:r,attrs:{shape:d.outShape}});return r.disposeIntermediateTensorInfo(t),v}},jde=Jn((function e(t){$n(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o="channelsLast"===t.dataFormat;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              if (").concat(o,") {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),qde=Jn((function e(t){$n(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o="channelsLast"===t.dataFormat,s=n-1-t.padInfo.top,u=r-1-t.padInfo.left,c=o?1:2,l=o?2:3,h=o?3:1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[").concat(h,"];\n\n        ivec2 dyCorner = ivec2(coords[").concat(c,"], coords[").concat(l,"]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n\n              if (").concat(o,") {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),Hde=Jn((function e(t){$n(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.padInfo.front,o=t.padInfo.top,s=t.padInfo.left;this.userCode="\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ".concat(t.batchSize,"; b++) {\n          for (int yF = 0; yF < ").concat(t.outDepth,"; yF++) {\n            int xF = wF + yF * ").concat(n," - ").concat(i,";\n\n            if (xF < 0 || xF >= ").concat(t.inDepth,") {\n              continue;\n            }\n\n            for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n              int xR = wR + yR * ").concat(r," - ").concat(o,";\n\n              if (xR < 0 || xR >= ").concat(t.inHeight,") {\n                continue;\n              }\n\n              for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n                int xC = wC + yC * ").concat(a," - ").concat(s,";\n\n                if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),Xde=Jn((function e(t){$n(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterDepth,r=t.filterHeight,a=t.filterWidth,i=t.strideDepth,o=t.strideHeight,s=t.strideWidth,u=n-1-t.padInfo.front,c=r-1-t.padInfo.top,l=a-1-t.padInfo.left;this.userCode="\n      const ivec3 pads = ivec3(".concat(u,", ").concat(c,", ").concat(l,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ").concat(n,"; wF++) {\n          float dyF = float(dyFCorner + wF) / ").concat(i,".0;\n\n          if (dyF < 0.0 || dyF >= ").concat(t.outDepth,".0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ").concat(n," - 1 - wF;\n\n          for (int wR = 0; wR < ").concat(r,"; wR++) {\n            float dyR = float(dyRCorner + wR) / ").concat(o,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ").concat(r," - 1 - wR;\n\n            for (int wC = 0; wC < ").concat(a,"; wC++) {\n              float dyC = float(dyCCorner + wC) / ").concat(s,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ").concat(a," - 1 - wC;\n\n              for (int d2 = 0; d2 < ").concat(t.outChannels,"; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var Kde={kernelName:"Conv2DBackpropFilter",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=r.filterShape,h=Kue(u),f=Fue(a.shape,l,o,1,s,c,!1,h),d=new jde(f);return n.runWebGLProgram(d,[a,i],"float32")}};var Yde={kernelName:"Conv2DBackpropInput",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.inputShape,s=r.strides,u=r.pad,c=r.dataFormat,l=r.dimRoundingMode,h=Kue(c),f=Fue(o,i.shape,s,1,u,l,!1,h),d=new qde(f);return n.runWebGLProgram(d,[a,i],"float32")}};var Qde={kernelName:"Conv3D",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=zue(a.shape,i.shape,o,u,s),l=new Bde(c);return n.runWebGLProgram(l,[a,i],"float32")}};var Zde={kernelName:"Conv3DBackpropFilterV2",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.pad,u=r.filterShape,c=zue(a.shape,u,o,1,s),l=new Hde(c);return n.runWebGLProgram(l,[a,i],"float32")}};var Jde={kernelName:"Conv3DBackpropInputV2",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.pad,s=r.strides,u=zue(r.inputShape,i.shape,s,1,o),c=new Xde(u);return n.runWebGLProgram(c,[a,i],"float32")}},$de={kernelName:"Cos",backendName:"webgl",kernelFunc:rfe({opSnippet:"if (isnan(x)) return x;\n  return cos(x);\n"})},epe={kernelName:"Cosh",backendName:"webgl",kernelFunc:rfe({opSnippet:"\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n"})},tpe=Jn((function e(t,n,r,a,i){$n(this,e),this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];var o=f(t,4),s=o[0],u=o[1],c=o[2],l=o[3],h=f(n,1)[0],d=f(r,2),p=d[0],v=d[1];this.outputShape=[h,p,v,l];var m="bilinear"===a?1:0,g="".concat(u-1,".0"),y="".concat(c-1,".0"),b=f(p>1?["".concat((u-1)/(p-1)),"(y2-y1) * height_ratio","y1*".concat(g," + float(y)*(height_scale)")]:["0.0","0.0","0.5 * (y1+y2) * ".concat(g)],3),x=b[0],k=b[1],w=b[2],_=f(v>1?["".concat((c-1)/(v-1)),"(x2-x1) * width_ratio","x1*".concat(y," + float(x)*(width_scale)")]:["0.0","0.0","0.5 * (x1+x2) * ".concat(y)],3),S=_[0],C=_[1],T=_[2];this.userCode="\n      const float height_ratio = float(".concat(x,");\n      const float width_ratio = float(").concat(S,");\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ").concat(s,") {\n          return;\n        }\n\n        float height_scale = ").concat(k,";\n        float width_scale = ").concat(C,";\n\n        float in_y = ").concat(w,";\n        if( in_y < 0.0 || in_y > ").concat(g," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n        float in_x = ").concat(T,";\n        if( in_x < 0.0 || in_x > ").concat(y," ) {\n          setOutput(float(").concat(i,"));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(").concat(m," == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    ")})),npe={kernelName:Qre,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.image,i=t.boxes,o=t.boxInd,s=r.cropSize,u=r.method,c=r.extrapolationValue,l=new tpe(a.shape,i.shape,s,u,c);return n.runWebGLProgram(l,[a,i,o],"float32")}},rpe=function(){function e(t,n,r){$n(this,e),this.variableNames=["x"],this.outputShape=t;var a=t.length,i=n?"0.0":"getX(".concat(ape(a,"coords"),")"),o=t[t.length-1],s="",u="";n?(s=r?"end != ".concat(o-1):"end != 0",u=r?"end + 1":"end - 1"):(s=r?"end + pow2 < ".concat(o):"end >= pow2",u=r?"end + pow2":"end - pow2"),this.userCode="\n      uniform float index;\n      void main() {\n        ".concat(zle(a)," coords = getOutputCoords();\n        int end = ").concat(ipe(a,"coords"),";\n        float val = ").concat(i,";\n        int pow2 = int(pow(2.0, index));\n        if (").concat(s,") {\n          int idx = ").concat(u,";\n          ").concat(ipe(a,"coords")," = idx;\n          val += getX(").concat(ape(a,"coords"),");\n        }\n        setOutput(val);\n      }\n    ")}return Jn(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.index&&(t.index=n.getUniformLocation(r,"index")),n.gl.uniform1f(t.index,e)}}}]),e}();function ape(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".x, ").concat(t,".y");if(3===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z");if(4===e)return"".concat(t,".x, ").concat(t,".y, ").concat(t,".z, ").concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}function ipe(e,t){if(1===e)return"".concat(t);if(2===e)return"".concat(t,".y");if(3===e)return"".concat(t,".z");if(4===e)return"".concat(t,".w");throw Error("Cumulative sum for rank ".concat(e," is not yet supported"))}var ope={kernelName:"Cumsum",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.exclusive,s=r.reverse,u=a.shape.length,c=$se([i],u),l=a;null!=c&&(l=_fe({inputs:{x:a},backend:n,attrs:{perm:c}}));var h=tue(1,u)[0];if(h!==u-1)throw new Error("WebGL cumsum shader expects an inner-most axis=".concat(a.shape.length-1," ")+"but got axis=".concat(i));for(var f=l.shape[h],d=Xhe({inputs:{x:l},backend:n}),p=0;p<=Math.ceil(Math.log2(f))-1;p++){var v=new rpe(l.shape,!1,s),m=v.getCustomSetupFunc(p),g=d;d=n.runWebGLProgram(v,[d],d.dtype,m),n.disposeIntermediateTensorInfo(g)}if(o){var y=new rpe(l.shape,o,s),b=d;d=n.runWebGLProgram(y,[d],d.dtype),n.disposeIntermediateTensorInfo(b)}if(null!=c){var x=_fe({inputs:{x:d},backend:n,attrs:{perm:eue(c)}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(l),x}return d}};var spe={kernelName:"DenseBincount",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.weights,o=r.size,s=r.binaryOutput;if(1===a.shape.length){var u=n.readSync(a.dataId),c=n.readSync(i.dataId),l=Hle(u,c,i.dtype,i.shape,o);return n.makeTensorInfo([o],i.dtype,l)}if(2===a.shape.length){var h=n.bufferSync(a),f=n.bufferSync(i),d=Xle(h,f,o,s);return n.makeTensorInfo(d.shape,i.dtype,d.values)}throw new Error("Error in denseBincount: input must be at most rank 2, but got rank"+"".concat(a.shape.length,"."))}},upe=function(){function e(t,n,r){$n(this,e),this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=n,this.dataFormat=r,this.userCode="\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ".concat(this.getHeightCoordString(),";\n      int w = ").concat(this.getWidthCoordString(),";\n      int d = ").concat(this.getDepthCoordString(),";\n\n      int in_h = h / ").concat(n,";\n      int offset_h = imod(h, ").concat(n,");\n      int in_w = w / ").concat(n,";\n      int offset_w = imod(w, ").concat(n,");\n      int offset_d = (offset_h * ").concat(n," + offset_w) *\n        ").concat(this.getOutputDepthSize(),";\n      int in_d = d + offset_d;\n\n      float result = ").concat(this.getInputSamplingString(),";\n      setOutput(result);\n    }\n  ")}return Jn(e,[{key:"getHeightCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}},{key:"getWidthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}},{key:"getDepthCoordString",value:function(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}},{key:"getOutputDepthSize",value:function(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}},{key:"getInputSamplingString",value:function(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}]),e}();var cpe={kernelName:"DepthToSpace",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockSize,o=r.dataFormat;sre(i>1,(function(){return"blockSize should be > 1 for depthToSpace, but was: ".concat(i)}));var s=a.shape[0],u="NHWC"===o?a.shape[1]:a.shape[2],c="NHWC"===o?a.shape[2]:a.shape[3],l="NHWC"===o?a.shape[3]:a.shape[1],h=u*i,f=c*i,d=l/(i*i),p=new upe("NHWC"===o?[s,h,f,d]:[s,d,h,f],i,o);return n.runWebGLProgram(p,[a],a.dtype)}},lpe=Jn((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];$n(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var o=t.inHeight,s=t.inWidth,u=t.padInfo.top,c=t.padInfo.left,l=t.strideHeight,h=t.strideWidth,f=t.dilationHeight,d=t.dilationWidth,p=t.filterHeight,v=t.filterWidth,m=t.outChannels/t.inChannels,g="",y="";r&&(g=a?"float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"\n          float activation(float x) {\n            ".concat(r,"\n          }\n        "),y="result = activation(result);");var b=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(g,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(h,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(c,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ").concat(m,";\n        int q = d2 - d1 * ").concat(m,";\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ").concat(p,"; wR++) {\n          int xR = xRCorner + wR * ").concat(f,";\n\n          if (xR < 0 || xR >= ").concat(o,") {\n            continue;\n          }\n\n          for (int wC = 0; wC < ").concat(v,"; wC++) {\n            int xC = xCCorner + wC * ").concat(d,";\n\n            if (xC < 0 || xC >= ").concat(s,") {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ").concat(b,"\n        ").concat(y,"\n        setOutput(result);\n      }\n    ")})),hpe=Jn((function e(t){var n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];$n(this,e),this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;for(var o=t.inHeight,s=t.inWidth,u=t.padInfo.top,c=t.padInfo.left,l=t.strideHeight,h=t.strideWidth,f=t.dilationHeight,d=t.dilationWidth,p=t.filterHeight,v=t.filterWidth,m=v,g="int xR; int xC; int xCOffset;",y=0;y<p;y++)for(var b=0;b<v;b++)g+="\n          vec4 xTexelR".concat(y,"C").concat(2*b," = vec4(0.);\n          vec4 wR").concat(y,"C").concat(b," = vec4(0.);\n          vec4 xR").concat(y,"C").concat(b," = vec4(0.);");for(var x=0;x<p;x++)for(var k=0;k<m;k++){var w=2*k;if(g+="\n          xR = xRCorner + ".concat(x*f,";\n          xC = xCCorner + ").concat(w*d,";\n        "),1===h){if(w<v&&(g+=c%2===1?"\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < ".concat(o," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(x,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    xTexelR").concat(x,"C").concat(w,".zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR").concat(x,"C").concat(w," = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < ").concat(o," && xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ").concat(s,") {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR").concat(x,"C").concat(w," = vec4(previous.zw, xTexelR").concat(x,"C").concat(w,".xy);\n                } else {\n                  xR").concat(x,"C").concat(w," = vec4(0, 0, xTexelR").concat(x,"C").concat(w,".xy);\n                }\n              "):"\n                if(xR >= 0 && xR < ".concat(o," && xC >= 0 && xC < ").concat(s,") {\n                  xTexelR").concat(x,"C").concat(w," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(w," = vec4(0.);\n                }\n\n                xR").concat(x,"C").concat(w," = xTexelR").concat(x,"C").concat(w,";\n              "),w+1<v)){var _=c%2===0?ire(d):d;d%2===0&&c%2===1||d%2!==0&&c%2!==1?(g+="\n                  xCOffset = xC + ".concat(c%2," + ").concat(_,";\n\n                  if(xR >= 0 && xR < ").concat(o," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(x,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                  }\n                "),d>1&&(g+="\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < ".concat(o," &&\n                      xCOffset >= 0 && xCOffset < ").concat(s,") {\n                      xTexelR").concat(x,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR").concat(x,"C").concat(w," = vec4(0.);\n                    }\n                  ")),g+="\n                  xR".concat(x,"C").concat(w+1," = vec4(\n                    xTexelR").concat(x,"C").concat(w,".zw, xTexelR").concat(x,"C").concat(w+2,".xy);\n                ")):g+="\n                  xCOffset = xC + ".concat(_,";\n\n                  if(xR >= 0 && xR < ").concat(o," &&\n                    xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    xTexelR").concat(x,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR").concat(x,"C").concat(w+1," = xTexelR").concat(x,"C").concat(w+2,";\n                ")}}else w<v&&(g+="\n              if(xR >= 0 && xR < ".concat(o,") {\n            "),c%2===1?(g+="\n                xCOffset = xC + 1 - ".concat(h,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(x,"C").concat(w," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(w," = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ").concat(s,") {\n                  xTexelR").concat(x,"C").concat(w+2," = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(w+2," = vec4(0.);\n                }\n\n                xR").concat(x,"C").concat(w," = vec4(\n                  xTexelR").concat(x,"C").concat(w,".zw, xTexelR").concat(x,"C").concat(w+2,".zw);\n              "),w+1<v&&(g+="\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + ".concat(h,";\n                  if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR").concat(x,"C").concat(w+1," = vec4(xTexelR").concat(x,"C").concat(w+2,".xy, final.xy);\n                "))):(g+="\n                if(xC >= 0 && xC < ".concat(s,") {\n                  xTexelR").concat(x,"C").concat(w," = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(w," = vec4(0.);\n                }\n\n                xCOffset = xC + ").concat(h,";\n                if(xCOffset >= 0 && xCOffset < ").concat(s,") {\n                  xTexelR").concat(x,"C").concat(w+2," = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR").concat(x,"C").concat(w+2," = vec4(0.);\n                }\n\n                xR").concat(x,"C").concat(w," = vec4(\n                  xTexelR").concat(x,"C").concat(w,".xy, xTexelR").concat(x,"C").concat(w+2,".xy);\n              "),w+1<v&&(g+="\n                  xR".concat(x,"C").concat(w+1," = vec4(\n                    xTexelR").concat(x,"C").concat(w,".zw, xTexelR").concat(x,"C").concat(w+2,".zw);\n                "))),g+="}");w<v&&(g+="\n            vec4 wTexelR".concat(x,"C").concat(w," = getW(").concat(x,", ").concat(w,", d1, q);\n            wR").concat(x,"C").concat(w," = vec4(wTexelR").concat(x,"C").concat(w,".xz, wTexelR").concat(x,"C").concat(w,".xz);\n          "),w+1<v&&(g+="\n              vec4 wTexelR".concat(x,"C").concat(w+1," = getW(").concat(x,", ").concat(w+1,", d1, q);\n              wR").concat(x,"C").concat(w+1," =\n                vec4(wTexelR").concat(x,"C").concat(w+1,".xz, wTexelR").concat(x,"C").concat(w+1,".xz);")))}for(var S=0;S<p;S++)for(var C=0;C<v;C++)g+="dotProd += xR".concat(S,"C").concat(C," * wR").concat(S,"C").concat(C,";");var T="",E="";r&&(T=a?"vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ".concat(r,"\n        }"):i?"vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ".concat(r,"\n        }"):"vec4 activation(vec4 x) {\n          ".concat(r,"\n        }"),E="result = activation(result);");var I=n?"result += getBiasAtOutCoords();":"";n&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode="\n      ".concat(T,"\n\n      const ivec2 strides = ivec2(").concat(l,", ").concat(h,");\n      const ivec2 pads = ivec2(").concat(u,", ").concat(c,");\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        ").concat(g,"\n\n        vec4 result = dotProd;\n        ").concat(I,"\n        ").concat(E,"\n        setOutput(result);\n      }\n    ")}));var fpe={kernelName:"DepthwiseConv2dNative",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=r.strides,s=r.pad,u=r.dilations,c=r.dimRoundingMode,l=u;null==l&&(l=[1,1]),sre(Xue(o,l),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(o," and dilations '").concat(l,"'")}));var h,f=Fue(a.shape,i.shape,o,l,s,c,!0);return h=zre().getBool("WEBGL_PACK_DEPTHWISECONV")&&f.strideWidth<=2&&f.outChannels/f.inChannels===1?new hpe(f):new lpe(f),n.runWebGLProgram(h,[a,i],"float32")}},dpe=Jn((function e(t){$n(this,e),this.variableNames=["x","dy"],this.outputShape=t.filterShape;var n=t.strideHeight,r=t.strideWidth,a=t.padInfo.top,i=t.padInfo.left,o=t.outChannels/t.inChannels;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ".concat(o," + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ").concat(t.batchSize,"; b++) {\n          for (int yR = 0; yR < ").concat(t.outHeight,"; yR++) {\n            int xR = wR + yR * ").concat(n," - ").concat(a,";\n\n            if (xR < 0 || xR >= ").concat(t.inHeight,") {\n              continue;\n            }\n\n            for (int yC = 0; yC < ").concat(t.outWidth,"; yC++) {\n              int xC = wC + yC * ").concat(r," - ").concat(i,";\n\n              if (xC < 0 || xC >= ").concat(t.inWidth,") {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),ppe=Jn((function e(t){$n(this,e),this.variableNames=["dy","W"],this.outputShape=t.inShape;var n=t.filterHeight,r=t.filterWidth,a=t.strideHeight,i=t.strideWidth,o=n-1-t.padInfo.top,s=r-1-t.padInfo.left,u=t.outChannels/t.inChannels;this.userCode="\n      const ivec2 pads = ivec2(".concat(o,", ").concat(s,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ").concat(n,"; wR++) {\n          float dyR = float(dyRCorner + wR) / ").concat(a,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ").concat(n," - 1 - wR;\n\n          for (int wC = 0; wC < ").concat(r,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(i,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ").concat(r," - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ").concat(u,"; dm++) {\n              int d2 = d1 * ").concat(u," + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var vpe={kernelName:"DepthwiseConv2dNativeBackpropFilter",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.dy,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=r.filterShape,h=Fue(a.shape,l,o,s,u,c,!0),f=new dpe(h);return n.runWebGLProgram(f,[a,i],"float32")}};var mpe={kernelName:"DepthwiseConv2dNativeBackpropInput",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.filter,o=r.strides,s=r.dilations,u=r.pad,c=r.dimRoundingMode,l=Fue(r.inputShape,i.shape,o,s,u,c,!0),h=new ppe(l);return n.runWebGLProgram(h,[a,i],"float32")}},gpe=Jn((function e(t){$n(this,e),this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}));var ype={kernelName:"Diag",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.x,a=[].concat(Tt(r.shape),Tt(r.shape)),i=hre(r.shape),o=dfe({inputs:{x:r},backend:n,attrs:{shape:[i]}}),s=new gpe(i),u=n.runWebGLProgram(s,[o],o.dtype),c=dfe({inputs:{x:u},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),c}},bpe=Jn((function e(t){$n(this,e),this.variableNames=["x","W"],this.outputShape=t.outShape;var n=t.inHeight,r=t.inWidth,a=t.padInfo,i=t.strideHeight,o=t.strideWidth,s=t.filterHeight,u=t.filterWidth,c=t.dilationHeight,l=t.dilationWidth,h=a.top,f=a.left;this.userCode="\n      const ivec2 strides = ivec2(".concat(i,", ").concat(o,");\n      const ivec2 pads = ivec2(").concat(h,", ").concat(f,");\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ").concat(s,"; h++) {\n          int hIn = hBeg + h * ").concat(c,";\n\n          if (hIn >= 0 && hIn < ").concat(n,") {\n            for (int w = 0; w < ").concat(u,"; w++) {\n              int wIn = wBeg + w * ").concat(l,";\n\n              if (wIn >= 0 && wIn < ").concat(r,") {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    ")}));var xpe={kernelName:"Dilation2D",backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=a.strides,u=a.pad,c=a.dilations,l=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"NHWC",i=arguments.length>5?arguments[5]:void 0,o=e[3],s=[].concat(Tt(t),[o]),u=Kue(a);return Fue(e,s,n,i,r,null,null,u)}(i.shape,o.shape,s,u,"NHWC",c),h=new bpe(l),f=dfe({inputs:{x:t=r.runWebGLProgram(h,[i,o],"float32")},backend:r,attrs:{shape:l.outShape}});return r.disposeIntermediateTensorInfo(t),f}},kpe={kernelName:"Elu",backendName:"webgl",kernelFunc:rfe({opSnippet:"return (x >= 0.0) ? x : (exp(x) - 1.0);",packedOpSnippet:"\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n"})},wpe={kernelName:"EluGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.dy,a=t.y,i=zre().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new Hhe("\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",r.shape,a.shape):new qhe("return (b >= 1.0) ? a : a * (b + 1.0);",r.shape,a.shape);return n.runWebGLProgram(i,[r,a],r.dtype)}},_pe={kernelName:"Equal",backendName:"webgl",kernelFunc:afe({opSnippet:"return float(a == b);",packedOpSnippet:"\n  return vec4(equal(a, b));\n",dtype:"bool"})},Spe={kernelName:"Erf",backendName:"webgl",kernelFunc:rfe({opSnippet:'\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = '.concat(.3275911,";\n  float a1 = ").concat(.254829592,";\n  float a2 = ").concat(-.284496736,";\n  float a3 = ").concat(1.421413741,";\n  float a4 = ").concat(-1.453152027,";\n  float a5 = ").concat(1.061405429,";\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n")})},Cpe="return exp(x);",Tpe=rfe({opSnippet:Cpe,packedOpSnippet:Cpe,cpuKernelImpl:Qle}),Epe={kernelName:"Exp",backendName:"webgl",kernelFunc:Tpe};function Ipe(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.dim,i=t.input,o=i.shape.length,s=i.shape.slice(),u=a;return a<0&&(sre(-(o+1)<=a,(function(){return"Axis must be in the interval [".concat(-(o+1),", ").concat(o,"]")})),u=o+a+1),s.splice(u,0,1),dfe({inputs:{x:i},backend:r,attrs:{shape:s}})}var Ape={kernelName:Jre,backendName:"webgl",kernelFunc:Ipe},Mpe="return exp(x) - 1.0;",Npe={kernelName:"Expm1",backendName:"webgl",kernelFunc:rfe({opSnippet:Mpe,packedOpSnippet:Mpe,cpuKernelImpl:Zle})},Rpe=Jn((function e(t,n,r){$n(this,e),this.variableNames=["real","imag"];var a=n[1];this.outputShape=n;var i,o=r?"2.0 * ".concat(Math.PI):"-2.0 * ".concat(Math.PI),s=r?"".concat(a,".0"):"1.0";if("real"===t)i="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error('FFT component must be either "real" or "imag", got '.concat(t,"."));i="return real * expI + imag * expR;"}this.userCode="\n      const float exponentMultiplier = ".concat(o,";\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ").concat(i,"\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(").concat(a,");\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ").concat(a,"; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ").concat(s,";\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    ")}));function Dpe(e,t,n){var r=n.texData.get(e.dataId),a=hre(e.shape),i=e.shape[e.shape.length-1],o=dfe({inputs:{x:e},backend:n,attrs:{shape:[a/i,i]}}),s=o.shape,u=new Rpe("real",s,t),c=new Rpe("imag",s,t),l=[{dataId:r.complexTensorInfos.real.dataId,dtype:r.complexTensorInfos.real.dtype,shape:s},{dataId:r.complexTensorInfos.imag.dataId,dtype:r.complexTensorInfos.imag.dtype,shape:s}],h=n.runWebGLProgram(u,l,"float32"),f=n.runWebGLProgram(c,l,"float32"),d=Yhe({inputs:{real:h,imag:f},backend:n});n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f);var p=dfe({inputs:{x:d},backend:n,attrs:{shape:e.shape}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(d),p}var Ppe={kernelName:"FFT",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return Dpe(t.input,!1,n)}},Ope=function(){function e(t,n){$n(this,e),this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}return Jn(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.valueLoc&&(t.valueLoc=n.getUniformLocationNoThrow(r,"value")),n.gl.uniform1f(t.valueLoc,e)}}}]),e}();function Lpe(e){var t=e.backend,n=e.attrs,r=n.shape,a=n.value,i=n.dtype;if("string"===(i=i||Sre(a))){var o=xre(i,hre(r));return o.fill(a),t.makeTensorInfo(r,i,o)}var s=new Ope(r,a),u=s.getCustomSetupFunc(a);return t.runWebGLProgram(s,[],i,u)}var Fpe,zpe={kernelName:$re,backendName:"webgl",kernelFunc:Lpe},Bpe=Jn((function e(t){$n(this,e),this.variableNames=["Image"],this.outputShape=[];var n=t[2];this.outputShape=t,this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ".concat(n," - x;\n          float outputValue;\n          if(coordX >= 0 && coordX < ").concat(n,") {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),Upe={kernelName:eae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.image,a=n,i=new Bpe(r.shape);return a.runWebGLProgram(i,[r],r.dtype)}},Vpe="return floor(x);",Wpe={kernelName:"Floor",backendName:"webgl",kernelFunc:rfe({opSnippet:Vpe,packedOpSnippet:Vpe,cpuKernelImpl:Jle})},Gpe=afe({opSnippet:"\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",packedOpSnippet:"\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",dtype:"int32"}),jpe={kernelName:tae,backendName:"webgl",kernelFunc:Gpe},qpe=Jn((function e(t){$n(this,e),this.variableNames=["A"];var n=ile(),r=f(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(".concat(i,".0, ").concat(a,".0);\n\n        vec4 values = ").concat(n.texture2D,"(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    ")})),Hpe=Jn((function e(t){$n(this,e),this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;var n=ile(),r=f(t,2),a=r[0],i=r[1];this.outputShape=t,this.userCode="\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(".concat(i,".0, ").concat(a,".0);\n            vec4 values = ").concat(n.texture2D,"(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ").concat(n.output," = result;\n      }\n    ")})),Xpe={kernelName:"FromPixels",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.pixels,i=r.numChannels,o="undefined"!==typeof HTMLVideoElement&&a instanceof HTMLVideoElement,s="undefined"!==typeof HTMLImageElement&&a instanceof HTMLImageElement,u="undefined"!==typeof ImageBitmap&&a instanceof ImageBitmap,c=f(o?[a.videoWidth,a.videoHeight]:[a.width,a.height],2),l=c[0],h=c[1],d=[h,l],p=[h,l,i];(s||o||u)&&(null==Fpe&&(Fpe=document.createElement("canvas").getContext("2d")),Fpe.canvas.width=l,Fpe.canvas.height=h,Fpe.drawImage(a,0,0,l,h),a=Fpe.canvas);var v=n.makeTensorInfo(d,"int32");n.texData.get(v.dataId).usage=wce.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(v.dataId),a);var m=zre().getBool("WEBGL_PACK")?new Hpe(p):new qpe(p),g=n.runWebGLProgram(m,[v],"int32");return n.disposeData(v.dataId),g}};var Kpe={kernelName:"FusedConv2D",backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=n.filter,s=n.bias,u=n.preluActivationWeights,c=a.strides,l=a.pad,h=a.dataFormat,f=a.dilations,d=a.dimRoundingMode,p=a.activation,v=a.leakyreluAlpha,m=Kue(h),g=Fue(i.shape,o.shape,c,f,l,d,!1,m),y=[];if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(zre().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])t=Wde({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:p,preluActivationWeights:u,leakyreluAlpha:v});else{var b=null!=s,x=null!=u,k="leakyrelu"===p,w=p?ife(p,!1):null,_=new zde(g,b,w,x,k),S=[i,o];if(s&&S.push(s),u&&S.push(u),k){var C=r.makeTensorInfo([],"float32",rie(v,"float32"));S.push(C),y.push(C)}t=r.runWebGLProgram(_,S,"float32")}else t=Vde({x:i,filter:o,convInfo:g,backend:r,bias:s,activation:p,preluActivationWeights:u,leakyreluAlpha:v});var T=dfe({inputs:{x:t},backend:r,attrs:{shape:g.outShape}});return y.push(t),y.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),T}};var Ype={kernelName:"FusedDepthwiseConv2D",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.filter,o=t.bias,s=t.preluActivationWeights,u=r.strides,c=r.pad,l=r.dilations,h=r.dimRoundingMode,f=r.activation,d=r.leakyreluAlpha,p=[],v=l;null==v&&(v=[1,1]),sre(Xue(u,v),(function(){return"Error in depthwiseConv2d: Either strides or dilations must be "+"1. Got strides ".concat(u," and dilations '").concat(v,"'")}));var m,g=Fue(a.shape,i.shape,u,v,c,h,!0),y=zre().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=f?ife(f,y):null,x=[a,i],k=null!=o,w=null!=s,_="leakyrelu"===f;if(k&&x.push(o),w&&x.push(s),_){var S=n.makeTensorInfo([],"float32",rie(d,"float32"));x.push(S),p.push(S)}m=y?new hpe(g,k,b,w,_):new lpe(g,k,b,w,_);var C=n.runWebGLProgram(m,x,"float32");return p.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),C}},Qpe=Jn((function e(t,n,r){$n(this,e),this.sliceDim=t,this.strides=n,this.variableNames=["x","indices"],this.outputShape=r;var a=zle(n.length),i=zle(r.length),o=this.sliceDim>1?"strides[j]":"strides";this.userCode="\n        ".concat(a," strides = ").concat(a,"(").concat(this.strides,");\n         void main() {\n          ").concat(i," coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ").concat(this.sliceDim,"; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ").concat(o,";\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      ")}));var Zpe={kernelName:"GatherNd",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.params,a=t.indices,i=a.shape,o=i[i.length-1],s=function(e,t){var n=e.shape.length,r=t.shape.length;if(n<1)throw new Error("tf.gatherND() expects the input to be rank 1 or higher,"+" but the rank was ".concat(n,"."));if(r<1)throw new Error("tf.gatherND() expects the indices to be rank 1 or higher,"+" but the rank was ".concat(r,"."));if("int32"!==t.dtype)throw new Error("tf.gatherND() expects the indices to be int32 type,"+" but the dtype was ".concat(t.dtype,"."));if(t.shape[r-1]>n)throw new Error("index innermost dimension length must be <= tensor rank; saw: "+"".concat(t.shape[r-1]," vs. ").concat(n));if(0===hre(e.shape))throw new Error("Requested more than 0 entries, but input is empty."+" Input shape: ".concat(e.shape,"."));for(var a=t.shape,i=a[a.length-1],o=1,s=0;s<a.length-1;++s)o*=a[s];var u=e.shape,c=a.slice();c.pop();for(var l=1,h=i;h<n;++h)l*=u[h],c.push(u[h]);var f=[].concat(Tt(Ere(e.shape).map((function(e){return e/l}))),[1]).slice(0,i);return[c,o,l,f]}(r,a),u=f(s,4),c=u[0],l=u[1],h=u[2],d=u[3],p=dfe({inputs:{x:a},backend:n,attrs:{shape:[l,o]}}),v=dfe({inputs:{x:r},backend:n,attrs:{shape:[hre(r.shape)/h,h]}}),m=new Qpe(o,d,[l,h]),g=n.runWebGLProgram(m,[v,p],v.dtype),y=dfe({inputs:{x:g},backend:n,attrs:{shape:c}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(g),y}},Jpe=Jn((function e(t,n){$n(this,e),this.variableNames=["A","indices"],this.outputShape=n,this.rank=n.length;var r=zle(this.rank),a=function(e,t){for(var n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],a=0;a<e.length;a++)2===a?r.push("int(getIndices(resRC.x, resRC.z))"):r.push("".concat(n[a]));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(r," resRC = getOutputCoords();\n        setOutput(getA(").concat(a,"));\n      }\n    ")}));var $pe={kernelName:"GatherV2",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.indices,o=r.axis,s=r.batchDims,u=function(e,t,n,r){var a=t.shape.length,i=e.shape.length;if(0!==r&&(r<-a||r>a))throw new Error("Expect batchDims in the range of [-".concat(a,", ").concat(a,"], but got ").concat(r));if(r<0&&(r+=a),r>i)throw new Error("batchDims (".concat(r,") must be less than rank(x) (\n    ").concat(i,")."));if(n<r)throw new Error("batchDims (".concat(r,") must be less than or equal to axis (").concat(n,")."));for(var o=0;o<r;++o)if(e.shape[o]!==t.shape[o])throw new Error("x.shape[".concat(o,"]: ").concat(e.shape[o]," should be equal to indices.shape[").concat(o,"]: ").concat(t.shape[o],"."));for(var s=e.shape[n],u=[],c=1,l=1,h=1,f=0;f<r;++f)u.push(e.shape[f]),c*=e.shape[f];for(var d=r;d<n;d++)u.push(e.shape[d]),l*=e.shape[d];for(var p=r;p<a;p++)u.push(t.shape[p]);for(var v=n+1;v<i;v++)u.push(e.shape[v]),h*=e.shape[v];return{batchSize:c,sliceSize:h,outerSize:l,dimSize:s,outputShape:u}}(a,i,gre(o,a.shape)[0],s),c=hre(i.shape),l=[],h=dfe({inputs:{x:a},backend:n,attrs:{shape:[u.batchSize,u.outerSize,u.dimSize,u.sliceSize]}}),f=dfe({inputs:{x:i},backend:n,attrs:{shape:[u.batchSize,c/u.batchSize]}});l.push(h),l.push(f);var d=[u.batchSize,u.outerSize,c/u.batchSize,u.sliceSize];if(n.shouldExecuteOnCPU([a,i])||"string"===a.dtype){var p=n.bufferSync(f),v=n.bufferSync(h),m=$le(v,p,d);return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),n.makeTensorInfo(u.outputShape,m.dtype,m.values)}var g=new Jpe(h.shape,d),y=n.runWebGLProgram(g,[h,f],h.dtype);l.push(y);var b=dfe({inputs:{x:y},backend:n,attrs:{shape:u.outputShape}});return l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),b}},eve=afe({opSnippet:"return float(a > b);",packedOpSnippet:"\n  return vec4(greaterThan(a, b));\n",cpuKernelImpl:ehe,dtype:"bool"}),tve={kernelName:nae,backendName:"webgl",kernelFunc:eve},nve=afe({opSnippet:"return float(a >= b);",packedOpSnippet:"\n  return vec4(greaterThanEqual(a, b));\n",dtype:"bool"}),rve={kernelName:rae,backendName:"webgl",kernelFunc:nve};var ave={kernelName:iae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend;return Dpe(t.input,!0,n)}},ive={kernelName:"IsFinite",backendName:"webgl",kernelFunc:rfe({opSnippet:"return float(!isnan(x) && !isinf(x));",dtype:"bool"})},ove={kernelName:"IsInf",backendName:"webgl",kernelFunc:rfe({opSnippet:"return float(isinf(x));",dtype:"bool"})},sve={kernelName:"IsNan",backendName:"webgl",kernelFunc:rfe({opSnippet:"return float(isnan(x));",dtype:"bool"})},uve={kernelName:"Less",backendName:"webgl",kernelFunc:afe({opSnippet:"return float(a < b);",packedOpSnippet:"\n  return vec4(lessThan(a, b));\n",cpuKernelImpl:the,dtype:"bool"})},cve=afe({opSnippet:"return float(a <= b);",packedOpSnippet:"\n  return vec4(lessThanEqual(a, b));\n",dtype:"bool"}),lve={kernelName:uae,backendName:"webgl",kernelFunc:cve};var hve={kernelName:"LinSpace",backendName:"webgl",kernelFunc:function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.num,o=nhe(r,a,i);return t.makeTensorInfo([o.length],"float32",o)}},fve={kernelName:"Log",backendName:"webgl",kernelFunc:rfe({opSnippet:"if (x < 0.0) return NAN;\n  return log(x);",packedOpSnippet:"\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:rhe})},dve=rfe({opSnippet:"return log(1.0 + x);"}),pve={kernelName:cae,backendName:"webgl",kernelFunc:dve},vve=afe({opSnippet:"return float(a >= 1.0 && b >= 1.0);",packedOpSnippet:"\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",dtype:"bool"}),mve={kernelName:lae,backendName:"webgl",kernelFunc:vve},gve={kernelName:"LogicalNot",backendName:"webgl",kernelFunc:rfe({opSnippet:"return float(!(x >= 1.0));"})},yve={kernelName:"LogicalOr",backendName:"webgl",kernelFunc:afe({opSnippet:"return float(a >= 1.0 || b >= 1.0);",packedOpSnippet:"\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",dtype:"bool"})},bve=Jn((function e(t,n,r,a,i){$n(this,e),this.variableNames=["x"],this.outputShape=[];var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -".concat(s,"; j <= ").concat(s,"; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ").concat(u,") {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ").concat(o,";\n        setOutput(val);\n      }\n    ")})),xve=Jn((function e(t,n,r,a,i){$n(this,e),this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;var o,s=n,u=t[3]-1;this.outputShape=t;var c="float(".concat(r,") + float(").concat(a,") * sum");o=.5===i?"inversesqrt(".concat(c,")"):1===i?"1.0/(".concat(c,")"):"exp(log(".concat(c,") * float(-").concat(i,"));"),this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ".concat(this.outputShape[3],";\n        bool hasNextRow = c < ").concat(this.outputShape[2],";\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ").concat(s,";\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ").concat(s,"; j <= ").concat(s,"; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(").concat(u,"));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ").concat(o,";\n        setOutput(result);\n      }\n    ")})),kve={kernelName:"LRN",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.depthRadius,o=r.bias,s=r.alpha,u=r.beta,c=zre().getBool("WEBGL_PACK_NORMALIZATION")?new xve(a.shape,i,o,s,u):new bve(a.shape,i,o,s,u);return n.runWebGLProgram(c,[a],a.dtype)}},wve=Jn((function e(t,n,r,a,i){$n(this,e),this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=n,this.bias=r,this.alpha=a,this.beta=i,this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ".concat(this.depth,"; ++d) {\n          int depthBegin = int(max(0.0, float(d - ").concat(n,")));\n          int depthEnd = int(min(float(").concat(this.depth,"),\n              float(d + ").concat(n," + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ").concat(this.depth,";\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(").concat(a,") * norm + float(").concat(r,");\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(").concat(a,")\n                * float(").concat(i,")\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ").concat(i,");\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    ")})),_ve={kernelName:"LRNGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.y,o=t.dy,s=r.depthRadius,u=r.bias,c=r.alpha,l=r.beta,h=new wve(a.shape,s,u,c,l);return n.runWebGLProgram(h,[a,i,o],a.dtype)}};function Sve(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reductionIndices,o=r.keepDims,s=a.shape.length,u=gre(i,a.shape),c=u,l=$se(c,s),h=null!=l,d=n.shouldExecuteOnCPU([a]),p=a;if(h){if(d){for(var v=n.texData.get(p.dataId).values,m=new Array(s),g=0;g<m.length;g++)m[g]=a.shape[l[g]];var y=yhe(v,a.shape,a.dtype,l,m);p=n.makeTensorInfo(m,a.dtype),n.texData.get(p.dataId).values=y}else p=xfe(a,l,n);c=tue(c.length,s)}Jse("max",c,s);var b,x=f(Qse(p.shape,c),2),k=x[0],w=x[1],_=k;if(o&&(_=Zse(k,u)),d){v=n.texData.get(p.dataId).values;var S=ahe(v,hre(w),_,a.dtype);b=n.makeTensorInfo(_,a.dtype),n.texData.get(b.dataId).values=S}else b=function(e,t,n,r){var a=hre(t),i=dfe({inputs:{x:e},attrs:{shape:[hre(e.shape)/a,a]},backend:r}),o=gfe(i,e.dtype,"max",r),s=dfe({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(p,w,_,n);return h&&n.disposeIntermediateTensorInfo(p),b}var Cve={kernelName:hae,backendName:"webgl",kernelFunc:Sve},Tve={kernelName:"Maximum",backendName:"webgl",kernelFunc:afe({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return max(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:ihe})};var Eve={kernelName:"MaxPool",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x;rle(a,"maxPool");var i=r.filterSize,o=r.strides,s=r.pad,u=r.dimRoundingMode;sre(Xue(o,1),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(1,"'")}));var c=Oue(a.shape,i,o,1,s,u);if(1===c.filterWidth&&1===c.filterHeight&&fre(c.inShape,c.outShape))return Xhe({inputs:{x:a},backend:n});var l=new Zfe(c,"max",!1);return n.runWebGLProgram(l,[a],a.dtype)}};var Ive={kernelName:"MaxPool3D",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.filterSize,o=r.strides,s=r.pad,u=r.dataFormat,c=r.dimRoundingMode,l=Lue(a.shape,i,o,[1,1,1],s,c,u),h=new Jfe(l,"max",!1);return n.runWebGLProgram(h,[a],a.dtype)}},Ave=Jn((function e(t){$n(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideHeight,r=t.strideWidth,a=t.dilationHeight,i=t.effectiveFilterHeight,o=t.effectiveFilterWidth,s=i-1-t.padInfo.top,u=o-1-t.padInfo.left,c=i*o-1;this.userCode="\n      const ivec2 pads = ivec2(".concat(s,", ").concat(u,");\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ").concat(i,";\n          wR += ").concat(a,") {\n          float dyR = float(dyRCorner + wR) / ").concat(n,".0;\n\n          if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ").concat(o,"; wC++) {\n            float dyC = float(dyCCorner + wC) / ").concat(r,".0;\n\n            if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ").concat(c," - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ").concat(o," + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")})),Mve=Jn((function e(t){$n(this,e),this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;var n=t.strideDepth,r=t.strideHeight,a=t.strideWidth,i=t.dilationDepth,o=t.dilationHeight,s=t.dilationWidth,u=t.effectiveFilterDepth,c=t.effectiveFilterHeight,l=t.effectiveFilterWidth,h=u-1-t.padInfo.front,f=c-1-t.padInfo.top,d=l-1-t.padInfo.left,p=u*c*l-1;this.userCode="\n      const ivec3 pads = ivec3(".concat(h,", ").concat(f,", ").concat(d,");\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ").concat(u,";\n           wD += ").concat(i,") {\n          float dyD = float(dyDCorner + wD) / ").concat(n,".0;\n\n          if (dyD < 0.0 || dyD >= ").concat(t.outDepth,".0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ").concat(c,";\n              wR += ").concat(o,") {\n            float dyR = float(dyRCorner + wR) / ").concat(r,".0;\n\n            if (dyR < 0.0 || dyR >= ").concat(t.outHeight,".0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ").concat(l,";\n                wC += ").concat(s,") {\n              float dyC = float(dyCCorner + wC) / ").concat(a,".0;\n\n              if (dyC < 0.0 || dyC >= ").concat(t.outWidth,".0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ").concat(p," -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ").concat(c," * ").concat(l," +\n                  wR * ").concat(l," + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    ")}));var Nve={kernelName:"MaxPool3DGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=r.filterSize,s=r.strides,u=r.pad,c=r.dimRoundingMode,l=Lue(i.shape,o,s,[1,1,1],u,c),h=new Jfe(l,"max",!0),f=n.runWebGLProgram(h,[i],i.dtype),d=new Mve(l),p=n.runWebGLProgram(d,[a,f],i.dtype);return n.disposeIntermediateTensorInfo(f),p}};var Rve={kernelName:"MaxPoolGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.dy,i=t.input,o=i;rle([i,t.output],"maxPoolGrad");var s=r.filterSize,u=r.strides,c=r.pad,l=r.dimRoundingMode,h=Oue(o.shape,s,u,1,c,l),f=new Zfe(h,"max",!0),d=n.runWebGLProgram(f,[o],o.dtype),p=new Ave(h),v=n.runWebGLProgram(p,[a,d],o.dtype);return n.disposeIntermediateTensorInfo(d),v}};var Dve={kernelName:"MaxPoolWithArgmax",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.filterSize,o=n.strides,s=n.pad,u=n.includeBatchInIndex,c=r;sre(4===a.shape.length,(function(){return"Error in maxPool: input must be rank 4 but got rank ".concat(a.shape.length,".")}));var l=[1,1];sre(Xue(o,l),(function(){return"Error in maxPool: Either strides or dilations must be 1. "+"Got strides ".concat(o," and dilations '").concat(l,"'")}));var h=Oue(a.shape,i,o,l,s),d=function(e,t,n,r){var a=new Zfe(n,"max",!1),i=r.runWebGLProgram(a,[e],"float32");return a=new Zfe(n,"max",!0,!0,t),[i,r.runWebGLProgram(a,[e],"float32")]}(a,u,h,c),p=f(d,2);return[p[0],p[1]]}};var Pve={kernelName:fae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=n.keepDims,o=n.axis,s=r,u=a.shape.length,c=gre(o,a.shape),l=c,h=$se(l,u),d=null!=h,p=s.shouldExecuteOnCPU([a]),v=[],m=a;if(d){if(p){for(var g=s.texData.get(m.dataId).values,y=new Array(u),b=0;b<y.length;b++)y[b]=a.shape[h[b]];var x=yhe(g,a.shape,a.dtype,h,y);m=s.makeTensorInfo(y,a.dtype),s.texData.get(m.dataId).values=x}else m=xfe(a,h,s);v.push(m),l=tue(l.length,u)}Jse("sum",l,u);var k=f(Qse(m.shape,l),2),w=k[0],_=k[1],S=w;i&&(S=Zse(w,c));for(var C=function(e,t,n,r){var a=hre(t),i=dfe({inputs:{x:e},attrs:{shape:[hre(e.shape)/a,a]},backend:r}),o=gfe(i,"float32","mean",r),s=dfe({inputs:{x:o},attrs:{shape:n},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),s}(m,_,S,s),T=0,E=v;T<E.length;T++){b=E[T];s.disposeIntermediateTensorInfo(b)}return C}};var Ove={kernelName:dae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.axis,o=r.keepDims,s=a.shape.length,u=gre(i,a.shape),c=u,l=$se(c,s),h=a;null!=l&&(h=_fe({inputs:{x:a},backend:n,attrs:{perm:l}}),c=tue(c.length,a.shape.length)),Jse("min",c,s);var d,p=f(Qse(h.shape,c),2),v=p[0],m=dfe({inputs:{x:h},backend:n,attrs:{shape:[-1,hre(p[1])]}}),g=gfe(m,m.dtype,"min",n);return d=dfe(o?{inputs:{x:g},backend:n,attrs:{shape:Zse(v,u)}}:{inputs:{x:g},backend:n,attrs:{shape:v}}),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(h),d}},Lve=afe({opSnippet:"\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n\n  return min(a, b);\n",packedOpSnippet:"\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n",cpuKernelImpl:ohe}),Fve={kernelName:pae,backendName:"webgl",kernelFunc:Lve},zve=Jn((function e(t,n,r){$n(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=zle(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a),c="reflect"===r?0:1;this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        for (int i = 0; i < ").concat(a,"; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ").concat(c,";\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ").concat(c,";\n          }\n        }\n        ").concat(i," coords = outC - start;\n        setOutput(getX(").concat(u,"));\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ").concat(c,";\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ").concat(c,";\n          }\n          setOutput(getX(outC - start));\n        }\n      ")})),Bve=Jn((function e(t,n,r){$n(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=zle(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=khe("rc",a),c=khe("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),f="reflect"===r?0:1,d="";if(1===a){var p="\n        ".concat(i," source = rc;\n        if (source < start) {\n          source = start * 2 - source - ").concat(f,";\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ").concat(f,";\n        }\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(p,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(p,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ")}else{var v="\n        ".concat(i," source = rc;\n        ").concat(i," lt = ").concat(i,"(lessThan(source, start));\n        ").concat(i," gte = ").concat(i,"(greaterThanEqual(source, end));\n        ").concat(i," orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ").concat(f,") +\n                gte * ((end - 1) * 2 - source + ").concat(f,");\n        source -= start;\n      ");d="\n        ".concat(i," rc = outputLoc;\n        ").concat(v,"\n        result[0] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        ").concat(u[a-1]," += 1;\n        if(").concat(l,") {\n          ").concat(v,"\n          result[1] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n        rc = outputLoc;\n        ").concat(u[a-2]," += 1;\n        if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {\n          ").concat(v,"\n          result[2] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          ").concat(u[a-1]," += 1;\n          if(").concat(l,") {\n            ").concat(v,"\n            result[3] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n          }\n        }\n      ")}this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(d,"\n        setOutput(result);\n      }\n    ")})),Uve={kernelName:"MirrorPad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.mode,s=zre().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Bve(a.shape,i,o):new zve(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)}},Vve={kernelName:"Mod",backendName:"webgl",kernelFunc:afe({opSnippet:"if (b == 0.0) return NAN;\n  return mod(a, b);",packedOpSnippet:"\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})},Wve=function(){function e(t,n,r){$n(this,e),this.variableNames=["probs"],this.outputShape=[t,r],this.userCode="\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ".concat(n-1,"; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(").concat(n-1,"));\n      }\n    ")}return Jn(e,[{key:"getCustomSetupFunc",value:function(e){var t=this;return function(n,r){null==t.seedLoc&&(t.seedLoc=n.getUniformLocation(r,"seed")),n.gl.uniform1f(t.seedLoc,e)}}}]),e}(),Gve=afe({opSnippet:"\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",packedOpSnippet:"\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",checkOutOfBounds:!0}),jve={kernelName:Zre,backendName:"webgl",kernelFunc:Gve},qve="return a - b;",Hve=afe({opSnippet:qve,packedOpSnippet:qve,supportsComplex:!0,cpuKernelImpl:vhe}),Xve={kernelName:"Sub",backendName:"webgl",kernelFunc:Hve};function Kve(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=gre([r.dim],a.shape),o=Sve({inputs:{x:a},backend:n,attrs:{reductionIndices:i,keepDims:!1}}),s=Zse(o.shape,i),u=dfe({inputs:{x:o},backend:n,attrs:{shape:s}}),c=Hve({inputs:{a:a,b:u},backend:n}),l=Tpe({inputs:{x:c},backend:n}),h=kfe({inputs:{x:l},backend:n,attrs:{axis:i,keepDims:!1}}),f=dfe({inputs:{x:h},backend:n,attrs:{shape:s}}),d=Gve({inputs:{a:l,b:f},backend:n});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(f),d}var Yve={kernelName:"Softmax",backendName:"webgl",kernelFunc:Kve};var Qve={kernelName:"Multinomial",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.logits,i=r.numSamples,o=r.seed,s=r.normalized,u=s?a:Kve({inputs:{logits:a},backend:n,attrs:{dim:a.shape.length-1}}),c=u.shape[0],l=u.shape[1],h=new Wve(c,l,i),f=h.getCustomSetupFunc(o),d=n.runWebGLProgram(h,[u],"int32",f);return s||n.disposeIntermediateTensorInfo(u),d}},Zve="return -x;";var Jve={kernelName:"Neg",backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=n.x;if(r.shouldExecuteOnCPU([a])){var i=r.texData.get(a.dataId),o=f(uhe(i.values,a.shape,a.dtype),2),s=o[0],u=o[1];return r.makeTensorInfo(u,a.dtype,s)}return t=zre().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new Uhe(a.shape,Zve):new Ihe(a.shape,Zve),r.runWebGLProgram(t,[a],a.dtype)}},$ve=wse;var eme={kernelName:gae,backendName:"webgl",kernelFunc:function(e){Hae("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=n.readSync(a.dataId),l=n.readSync(i.dataId),h=$ve(c,l,o,s,u).selectedIndices;return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}},tme=_se;var nme={kernelName:yae,backendName:"webgl",kernelFunc:function(e){Hae("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.padToMaxOutputSize,l=n.readSync(a.dataId),h=n.readSync(i.dataId),f=tme(l,h,o,s,u,c),d=f.selectedIndices,p=f.validOutputs;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([],"int32",new Int32Array([p]))]}},rme=Sse;var ame={kernelName:bae,backendName:"webgl",kernelFunc:function(e){Hae("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");var t=e.inputs,n=e.backend,r=e.attrs,a=t.boxes,i=t.scores,o=r.maxOutputSize,s=r.iouThreshold,u=r.scoreThreshold,c=r.softNmsSigma,l=n.readSync(a.dataId),h=n.readSync(i.dataId),f=rme(l,h,o,s,u,c),d=f.selectedIndices,p=f.selectedScores;return[n.makeTensorInfo([d.length],"int32",new Int32Array(d)),n.makeTensorInfo([p.length],"float32",new Float32Array(p))]}},ime=Jn((function e(t,n,r,a){$n(this,e),this.variableNames=["indices"],this.outputShape=[t,n],this.userCode="\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(".concat(a,"), float(").concat(r,"),\n                      float(index == coords.y)));\n      }\n    ")})),ome={kernelName:"OneHot",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=r.depth,o=r.onValue,s=r.offValue,u=hre(a.shape),c=new ime(u,i,o,s),l=dfe({inputs:{x:a},backend:n,attrs:{shape:[u]}}),h=n.runWebGLProgram(c,[l],a.dtype);n.disposeIntermediateTensorInfo(l);var f=dfe({inputs:{x:h},backend:n,attrs:{shape:[].concat(Tt(a.shape),[i])}});return n.disposeIntermediateTensorInfo(h),f}};function sme(e){var t=e.inputs,n=e.backend,r=t.x;if("complex64"===r.dtype){var a=yde({inputs:{input:r},backend:n}),i=sme({inputs:{x:a},backend:n}),o=Rde({inputs:{input:r},backend:n}),s=sme({inputs:{x:o},backend:n}),u=Yhe({inputs:{real:i,imag:s},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(s),u}return Lpe({attrs:{shape:r.shape,dtype:r.dtype,value:"string"===r.dtype?"":0},backend:n})}var ume={kernelName:Gae,backendName:"webgl",kernelFunc:sme};var cme={kernelName:"OnesLike",backendName:"webgl",kernelFunc:function e(t){var n=t.inputs,r=t.backend,a=n.x;if("string"===a.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===a.dtype){var i=yde({inputs:{input:a},backend:r}),o=e({inputs:{x:i},backend:r}),s=Rde({inputs:{input:a},backend:r}),u=sme({inputs:{x:s},backend:r}),c=Yhe({inputs:{real:o,imag:u},backend:r});return r.disposeIntermediateTensorInfo(i),r.disposeIntermediateTensorInfo(o),r.disposeIntermediateTensorInfo(s),r.disposeIntermediateTensorInfo(u),c}return Lpe({attrs:{shape:a.shape,dtype:a.dtype,value:1},backend:r})}};var lme={kernelName:xae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs.axis;if(1===t.length)return Ipe({inputs:{input:t[0]},backend:n,attrs:{dim:r}});var a=t[0].shape,i=t[0].dtype;t.forEach((function(e){ure(a,e.shape,"All tensors passed to stack must have matching shapes"),sre(i===e.dtype,(function(){return"All tensors passed to stack must have matching dtypes"}))}));var o=[],s=Lde({inputs:t.map((function(e){var t=Ipe({inputs:{input:e},backend:n,attrs:{dim:r}});return o.push(t),t})),backend:n,attrs:{axis:r}});return o.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),s}},hme=Jn((function e(t,n,r){$n(this,e),this.variableNames=["x"],this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));var a=t.length,i=zle(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,a);this.userCode=1!==a?"\n      ".concat(i," start = ").concat(i,"(").concat(o,");\n      ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float(").concat(r,"));\n        } else {\n          ").concat(i," coords = outC - start;\n          setOutput(getX(").concat(u,"));\n        }\n      }\n    "):"\n        int start = ".concat(o,";\n        int end = ").concat(s,";\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float(").concat(r,"));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      ")})),fme=Jn((function e(t,n,r){$n(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n.map((function(e,n){return e[0]+t[n]+e[1]}));for(var a=t.length,i=zle(a),o=n.map((function(e){return e[0]})).join(","),s=n.map((function(e,n){return e[0]+t[n]})).join(","),u=khe("rc",a),c=khe("source",a),l="".concat(u[a-1]," < ").concat(this.outputShape[a-1]),h=1===a?"source":"vec2(".concat(c.slice(-2).join(),")"),f=["".concat(i," rc = outputLoc;"),"".concat(u[a-1]," += 1;\n       if(").concat(l,") {\n      "),1===a?"":"}\n       rc = outputLoc;\n       ".concat(u[a-2]," += 1;\n       if(").concat(u[a-2]," < ").concat(this.outputShape[a-2],") {"),1===a?"":"  ".concat(u[a-1]," += 1;\n         if(").concat(l,") {")],d=1===a?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))",p="",v=0,m=1===a?2:4;v<m;v++)p+="\n        ".concat(f[v],"\n        if (").concat(d,") {\n          result[").concat(v,"] = float(").concat(r,");\n        } else {\n          ").concat(i," source = rc - start;\n          result[").concat(v,"] = getChannel(getX(").concat(c.join(),"), ").concat(h,");\n        }\n      ");p+=1===a?"} ":"}}",this.userCode="\n      const ".concat(i," start = ").concat(i,"(").concat(o,");\n      const ").concat(i," end = ").concat(i,"(").concat(s,");\n\n      void main() {\n        ").concat(i," outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ").concat(p,"\n        setOutput(result);\n      }\n    ")})),dme=function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.paddings,o=r.constantValue,s=zre().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new fme(a.shape,i,o):new hme(a.shape,i,o);return n.runWebGLProgram(s,[a],a.dtype)},pme={kernelName:"PadV2",backendName:"webgl",kernelFunc:dme},vme={kernelName:"Pow",backendName:"webgl",kernelFunc:afe({opSnippet:"\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",packedOpSnippet:"\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  \n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n\n  return result;\n"})};var mme={kernelName:"Prod",backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.axis,s=a.keepDims,u=i.shape.length,c=[],l=gre(o,i.shape),h=l,d=$se(h,u),p=i;if(null!=d&&(p=_fe({inputs:{x:i},backend:r,attrs:{perm:d}}),h=tue(h.length,u),c.push(p)),Jse("prod",h,u),r.shouldExecuteOnCPU([p])){var v=r.texData.get(p.dataId).values,m=che(p.shape,p.dtype,v,h),g=m.outVals,y=m.outShape,b=m.outDtype;t=r.makeTensorInfo(y,b,g)}else{var x=f(Qse(p.shape,h),2),k=x[0],w=hre(x[1]),_=dfe({inputs:{x:p},backend:r,attrs:{shape:[-1,w]}}),S=gfe(_,Aie(i.dtype),"prod",r);t=dfe({inputs:{x:S},backend:r,attrs:{shape:k}}),c.push(_),c.push(S)}if(s){c.push(t);var C=Zse(t.shape,l);t=dfe({inputs:{x:t},backend:r,attrs:{shape:C}})}return c.forEach((function(e){return r.disposeIntermediateTensorInfo(e)})),t}},gme=function(e){var t=e.backend,n=e.attrs,r=n.start,a=n.stop,i=n.step,o=n.dtype,s=lhe(r,a,i,o);return t.makeTensorInfo([s.length],o,s)},yme={kernelName:wae,backendName:"webgl",kernelFunc:gme},bme={kernelName:"Reciprocal",backendName:"webgl",kernelFunc:rfe({opSnippet:"return 1.0 / x;"})},xme=rfe({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : x;\n",packedOpSnippet:"\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),kme={kernelName:Sae,backendName:"webgl",kernelFunc:xme},wme=rfe({opSnippet:"if (isnan(x)) return x;\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",packedOpSnippet:"\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n"}),_me={kernelName:Iae,backendName:"webgl",kernelFunc:wme},Sme=Jn((function e(t,n,r,a,i){$n(this,e),this.variableNames=["A"],this.outputShape=[];var o=f(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var h,d=[a&&n>1?u-1:u,a&&r>1?c-1:c],p=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(d[0]/p[0],",\n          ").concat(d[1]/p[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    ")})),Cme=Jn((function e(t,n,r,a,i){$n(this,e),this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];var o=f(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var h,d=[a&&n>1?u-1:u,a&&r>1?c-1:c],p=[a&&n>1?n-1:n,a&&r>1?r-1:r];h=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ".concat(d[0]/p[0],",\n          ").concat(d[1]/p[1],",\n          ").concat(d[1]/p[1],");\n      const vec3 inputShapeRC = vec3(").concat(u,".0, ").concat(c,".0,\n                                     ").concat(c,".0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ").concat(l-1,";\n        bool hasNextRow = coords.z < ").concat(r-1,";\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    ")}));var Tme={kernelName:Eae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=f(r.size,2),u=s[0],c=s[1],l=zre().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new Cme(a.shape,u,c,i,o):new Sme(a.shape,u,c,i,o);return n.runWebGLProgram(l,[a],"float32")}},Eme=Jn((function e(t,n,r){$n(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=f(n,3),i=a[1],o=a[2],s=f(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],h=[r&&u>1?u-1:u,r&&c>1?c-1:c],d=l[0]/h[0],p=l[1]/h[1],v=1/d,m=1/p,g=2*Math.ceil(v)+2,y=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(d,");\n        const float widthScale = float(").concat(p,");\n\n        const float invHeightScale = float(").concat(v,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(g,");\n        const int winWidth = int(").concat(y,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ").concat(i-1,".0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ").concat(o-1,".0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var Ime={kernelName:"ResizeBilinearGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new Eme(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},Ame=Jn((function e(t,n,r,a,i){$n(this,e),this.variableNames=["A"],this.outputShape=[];var o=f(t,4),s=o[0],u=o[1],c=o[2],l=o[3];this.outputShape=[s,n,r,l];var h,d=[a&&n>1?u-1:u,a&&r>1?c-1:c],p=[a&&n>1?n-1:n,a&&r>1?r-1:r],v=a?"0.5":"0.0";h=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode="\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ".concat(d[0]/p[0],",\n          ").concat(d[1]/p[1],");\n      const vec2 inputShapeRC = vec2(").concat(u,".0, ").concat(c,".0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ").concat(h,";\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ").concat(v,")));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    ")}));var Mme={kernelName:Tae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=r.alignCorners,o=r.halfPixelCenters,s=f(r.size,2),u=s[0],c=s[1],l=new Ame(a.shape,u,c,i,o);return n.runWebGLProgram(l,[a],a.dtype)}},Nme=Jn((function e(t,n,r){$n(this,e),this.variableNames=["dy"],this.outputShape=[],this.outputShape=n;var a=f(n,3),i=a[1],o=a[2],s=f(t,3),u=s[1],c=s[2],l=[r&&u>1?i-1:i,r&&c>1?o-1:o],h=[r&&u>1?u-1:u,r&&c>1?c-1:c],d=l[0]/h[0],p=l[1]/h[1],v=1/d,m=1/p,g=2*Math.ceil(v)+2,y=2*Math.ceil(m)+2;this.userCode="\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(".concat(d,");\n        const float widthScale = float(").concat(p,");\n\n        const float invHeightScale = float(").concat(v,");\n        const float invWidthScale = float(").concat(m,");\n\n        const int winHeight = int(").concat(g,");\n        const int winWidth = int(").concat(y,");\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ").concat(u,") {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ").concat(c,") {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(").concat(l[0],") *\n                (float(dyR) / float(").concat(h[0],"));\n\n            float sourceFracCol =\n                float(").concat(l[1],") *\n                  (float(dyC) / float(").concat(h[1],"));\n\n            int sourceNearestRow = int(min(\n                float(int(").concat(i,") - 1),\n                ").concat(r," ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(").concat(o,") - 1),\n                ").concat(r," ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    ")}));var Rme={kernelName:"ResizeNearestNeighborGrad",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.images,i=t.dy,o=r.alignCorners,s=new Nme(i.shape,a.shape,o);return n.runWebGLProgram(s,[i],i.dtype)}},Dme=Jn((function e(t,n){$n(this,e),this.variableNames=["x"];var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));if(this.outputShape=t,1!==r){var a=t.map((function(e,r){return function(e){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - coords[").concat(e,"] - 1"):"coords[".concat(e,"]")}(r)})).join(","),i=zle(r);this.userCode="\n      void main() {\n        ".concat(i," coords = getOutputCoords();\n        setOutput(getX(").concat(a,"));\n      }\n    ")}else this.userCode="\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(".concat(t[0]," - coord - 1));\n        }\n      ")})),Pme=Jn((function e(t,n){$n(this,e),this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;var r=t.length;if(r>4)throw new Error("WebGL backend: Reverse of rank-".concat(r," tensor is not yet supported"));this.outputShape=t;var a=khe("rc",r),i="".concat(a[r-1]," + 1 < ").concat(this.outputShape[r-1]),o="".concat(a[r-2]," + 1 < ").concat(this.outputShape[r-2]),s=zle(r);function u(e){var r=t.map((function(r,a){return function(e,r){return-1!==n.indexOf(e)&&1!==t[e]?"".concat(t[e]," - ").concat(r[e]," - 1"):"".concat(r[e])}(a,e)})),a=r.join(","),i=r.slice(-2).join(",");return"getChannel(getX(".concat(a,"), vec2(").concat(i,"))")}this.userCode=1===r?"\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(".concat(t[0]," - rc - 1),\n            ").concat(t[0]," - rc - 1);\n          if(").concat(i,"){\n              result.g = getChannel(getX(").concat(t[0]," - (rc  + 1) - 1),\n                ").concat(t[0]," - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      "):"\n        void main() {\n          ".concat(s," rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ").concat(function(e){return u(e)}(a.slice()),";\n          if(").concat(i,"){\n            result.g = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",u(e)}(a.slice()),";\n          }\n          if(").concat(o,") {\n            result.b = ").concat(function(e){return e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            if(").concat(i,") {\n              result.a = ").concat(function(e){return e[r-1]="("+e[r-1]+" + 1)",e[r-2]="("+e[r-2]+" + 1)",u(e)}(a.slice()),";\n            }\n          }\n          setOutput(result);\n        }\n    ")}));var Ome={kernelName:Aae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.dims,o=a.shape.length,s=gre(i,a.shape);if(0===o)return Xhe({inputs:{x:a},backend:n});var u=zre().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new Pme(a.shape,s):new Dme(a.shape,s);return n.runWebGLProgram(u,[a],a.dtype)}},Lme=Jn((function e(t,n,r,a){$n(this,e),this.variableNames=["Image"],this.outputShape=[];var i=t[1],o=t[2],s=Math.sin(n).toFixed(3),u=Math.cos(n).toFixed(3);this.outputShape=t;var c=function(e,t,n){return[n*("number"===typeof e?e:e[0]),t*("number"===typeof e?e:e[1])]}(a,i,o),l=f(c,2),h=l[0],d=l[1],p=h.toFixed(3),v=d.toFixed(3),m="";m="number"===typeof r?"float outputValue = ".concat(r.toFixed(2),";"):"\n        vec3 fill = vec3(".concat(r.join(","),");\n        float outputValue = fill[coords[3]];"),this.userCode="\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - ".concat(p,") * ").concat(u," - (float(y) - ").concat(v,") * ").concat(s,";\n          float coordYFloat = (float(x) - ").concat(p,") * ").concat(s," + (float(y) - ").concat(v,") * ").concat(u,";\n          int coordX = int(round(coordXFloat + ").concat(p,"));\n          int coordY = int(round(coordYFloat + ").concat(v,"));\n          ").concat(m,"\n          if(coordX >= 0 && coordX < ").concat(o," && coordY >= 0 && coordY < ").concat(i,") {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    ")})),Fme={kernelName:qae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.image,i=n.radians,o=n.fillValue,s=n.center,u=r,c=new Lme(a.shape,i,o,s);return u.runWebGLProgram(c,[a],a.dtype)}},zme=rfe({opSnippet:"\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n"}),Bme={kernelName:Mae,backendName:"webgl",kernelFunc:zme},Ume={kernelName:"Rsqrt",backendName:"webgl",kernelFunc:rfe({opSnippet:"return inversesqrt(x);",cpuKernelImpl:hhe})},Vme=Jn((function e(t,n,r,a,i,o){$n(this,e),this.variableNames=["updates","indices","defaultValue"],this.outputShape=o;var s=zle(i.length),u=zle(o.length),c="";1===r?c="i":2===r&&(c="i, j");var l="getIndices(".concat(c,")"),h="";1===a?h="i":2===a&&(h="i, coords[1]");var f="getUpdates(".concat(h,")"),d=n>1?"strides[j]":"strides";this.userCode="\n        ".concat(s," strides = ").concat(s,"(").concat(i,");\n\n        void main() {\n          ").concat(u," coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ").concat(t,"; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ").concat(n,"; j++) {\n              int index = round(").concat(l,");\n              flattenedIndex += index * ").concat(d,";\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ").concat(f,";\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      ")}));var Wme={kernelName:"ScatterNd",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.indices,i=t.updates,o=r.shape,s=$ue(0,a,o),u=s.sliceRank,c=s.numUpdates,l=s.sliceSize,h=s.strides,f=s.outputSize,d=[f/l,l];if(0===f)return n.makeTensorInfo(o,a.dtype);var p=dfe({inputs:{x:a},backend:n,attrs:{shape:[c,u]}}),v=dfe({inputs:{x:i},backend:n,attrs:{shape:[c,l]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new Vme(c,u,p.shape.length,v.shape.length,h,d),y=n.runWebGLProgram(g,[v,p,m],v.dtype),b=dfe({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),b}},Gme=Jn((function e(t,n,r){var a,i;if($n(this,e),this.variableNames=["c","a","b"],this.outputShape=n,r>4)throw Error("Where for rank ".concat(r," is not yet supported"));if(1===r)i="resRC",a="resRC";else{for(var o=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[],u=[],c=0;c<n.length;c++)u.push("".concat(o[c])),c<t&&s.push("".concat(o[c]));a=s.join(),i=u.join()}var l=zle(r);this.userCode="\n      void main() {\n        ".concat(l," resRC = getOutputCoords();\n        float cVal = getC(").concat(a,");\n        if (cVal >= 1.0) {\n          setOutput(getA(").concat(i,"));\n        } else {\n          setOutput(getB(").concat(i,"));\n        }\n      }\n    ")}));var jme={kernelName:Nae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=t.condition,a=t.t,i=t.e,o=new Gme(r.shape.length,a.shape,a.shape.length);return n.runWebGLProgram(o,[r,a,i],Iie(a.dtype,i.dtype))}},qme={kernelName:"Selu",backendName:"webgl",kernelFunc:rfe({opSnippet:"\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ".concat(1.7580993408473768,";\n  float scale = ").concat(1.0507009873554805,";\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n")})},Hme=rfe({opSnippet:"return 1.0 / (1.0 + exp(-1.0 * x));"}),Xme={kernelName:Dae,backendName:"webgl",kernelFunc:Hme},Kme={kernelName:"Sign",backendName:"webgl",kernelFunc:rfe({opSnippet:"\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n"})},Yme={kernelName:"Sin",backendName:"webgl",kernelFunc:rfe({opSnippet:"if (isnan(x)) return x;\n  return sin(x);\n"})},Qme={kernelName:"Sinh",backendName:"webgl",kernelFunc:rfe({opSnippet:"\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n"})},Zme={kernelName:"Softplus",backendName:"webgl",kernelFunc:rfe({opSnippet:"\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n"})},Jme={kernelName:"SpaceToBatchND",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.blockShape,o=r.paddings;sre(a.shape.length<=4,(function(){return"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"}));var s=i.reduce((function(e,t){return e*t})),u=[[0,0]];u.push.apply(u,Tt(o));for(var c=1+i.length;c<a.shape.length;++c)u.push([0,0]);var l=[],h=dme({inputs:{x:a},backend:n,attrs:{paddings:u,constantValue:0}}),f=Que(h.shape,i,s,!1),d=Zue(f.length,i.length,!1),p=Jue(h.shape,i,s,!1),v=dfe({inputs:{x:h},backend:n,attrs:{shape:f}}),m=_fe({inputs:{x:v},backend:n,attrs:{perm:d}}),g=dfe({inputs:{x:m},backend:n,attrs:{shape:p}});return l.push(h),l.push(v),l.push(m),l.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}};var $me={kernelName:"SparseToDense",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.sparseIndices,i=t.sparseValues,o=t.defaultValue,s=r.outputShape,u=$ue(0,a,s),c=u.sliceRank,l=u.numUpdates,h=u.strides,f=u.outputSize,d=new Vme(l,c,a.shape.length,i.shape.length,h,[f,1],!1),p=n.runWebGLProgram(d,[i,a,o],i.dtype),v=dfe({inputs:{x:p},backend:n,attrs:{shape:s}});return n.disposeIntermediateTensorInfo(p),v}};var ege={kernelName:Lae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.numOrSizeSplits,o=gre(r.axis,a.shape)[0],s=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=[];if("number"===typeof t)sre(e.shape[n]%t===0,(function(){return"Number of splits must evenly divide the axis."})),r=new Array(t).fill(e.shape[n]/t);else{var a=t.reduce((function(e,t){return-1===t&&(e+=1),e}),0);sre(a<=1,(function(){return"There should be only one negative value in split array."}));var i=t.indexOf(-1);if(-1!==i){var o=t.reduce((function(e,t){return t>0?e+t:e}));t[i]=e.shape[n]-o}sre(e.shape[n]===t.reduce((function(e,t){return e+t})),(function(){return"The sum of sizes must match the size of the axis dimension."})),r=t}return r}(a,i,o),u=a.shape.length,c=new Array(u).fill(0),l=a.shape.slice();return s.map((function(e){var t=Tt(l);t[o]=e;var r=fde({inputs:{x:a},backend:n,attrs:{begin:c,size:t}});return c[o]+=e,r}))}},tge=rfe({opSnippet:"return sqrt(x);"}),nge={kernelName:Pae,backendName:"webgl",kernelFunc:tge},rge={kernelName:"Square",backendName:"webgl",kernelFunc:rfe({opSnippet:"return x * x;"})},age="return (a - b) * (a - b);",ige=afe({opSnippet:age,packedOpSnippet:age}),oge={kernelName:Fae,backendName:"webgl",kernelFunc:ige};var sge={kernelName:jae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=t.x,i=Ahe+"\n    return x > 0.0 ? 1.0 : float(".concat(n.alpha,");\n  "),o=new Ihe(a.shape,i);return r.runWebGLProgram(o,[a],a.dtype)}},uge=Jn((function e(t,n,r){$n(this,e),this.variableNames=["x"],this.outputShape=r;var a=r.length,i=zle(r.length),o=zle(r.length),s="";if(1===a)s="coords * strides + begin";else{var u=0;s=r.map((function(e,t){return u++,1===r.length?"coords * strides[".concat(t,"] + begin[").concat(t,"]"):"coords[".concat(u-1,"] * strides[").concat(t,"] + begin[").concat(t,"]")})).join(",")}this.userCode="\n      ".concat(i," begin = ").concat(i,"(").concat(t,");\n      ").concat(i," strides = ").concat(i,"(").concat(n,");\n\n      void main() {\n        ").concat(o," coords = getOutputCoords();\n        setOutput(getX(").concat(s,"));\n      }\n    ")}));var cge={kernelName:"StridedSlice",backendName:"webgl",kernelFunc:function(e){var t,n=e.inputs,r=e.backend,a=e.attrs,i=n.x,o=a.begin,s=a.end,u=a.strides,c=a.beginMask,l=a.endMask,h=a.ellipsisMask,f=a.newAxisMask,d=a.shrinkAxisMask,p=Xoe(i.shape,o,s,u,c,l,h,f,d),v=p.nonStrided,m=p.$begin,g=p.$strides,y=p.size,b=p.newShape,x=p.outShape,k=dfe({inputs:{x:i},backend:r,attrs:{shape:b}});if(v){var w=fde({inputs:{x:k},backend:r,attrs:{begin:m,size:y}});t=dfe({inputs:{x:w},backend:r,attrs:{shape:x}}),r.disposeIntermediateTensorInfo(w)}else if(x.some((function(e){return 0===e})))t=r.makeTensorInfo(x,i.dtype,[]);else{if(r.shouldExecuteOnCPU([k])){var _=r.texData.get(k.dataId).values,S=Eoe(k.shape,k.dtype,_),C=phe(x,S,g,m);t=r.makeTensorInfo(x,k.dtype,C.values)}else{var T=new uge(m,g,x);t=r.runWebGLProgram(T,[k],k.dtype)}}var E=dfe({inputs:{x:t},backend:r,attrs:{shape:x}});return r.disposeIntermediateTensorInfo(k),r.disposeIntermediateTensorInfo(t),E}},lge={kernelName:"Tan",backendName:"webgl",kernelFunc:rfe({opSnippet:"return tan(x);"})},hge={kernelName:"Tanh",backendName:"webgl",kernelFunc:rfe({opSnippet:"\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n"})},fge=Jn((function e(t,n){$n(this,e),this.variableNames=["A"];for(var r=new Array(t.length),a=0;a<r.length;a++)r[a]=t[a]*n[a];this.outputShape=r,this.rank=r.length;var i=zle(this.rank),o=function(e){var t=e.length;if(t>5)throw Error("Tile for rank ".concat(t," is not yet supported"));if(1===t)return"imod(resRC, ".concat(e[0],")");for(var n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],r=[],a=0;a<e.length;a++)r.push("imod(".concat(n[a],", ").concat(e[a],")"));return r.join()}(t);this.userCode="\n      void main() {\n        ".concat(i," resRC = getOutputCoords();\n        setOutput(getA(").concat(o,"));\n      }\n    ")}));function dge(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.reps;if("string"===a.dtype){var o=n.readSync(a.dataId).map((function(e){return sie(e)})),s=Eoe(a.shape,a.dtype,o),u=mhe(s,i);return n.makeTensorInfo(u.shape,u.dtype,u.values)}var c=new fge(a.shape,i);return n.runWebGLProgram(c,[a],a.dtype)}var pge={kernelName:Bae,backendName:"webgl",kernelFunc:dge};var vge={kernelName:"TopK",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=r.k,o=r.sorted,s=n.readSync(a.dataId),u=f(ghe(s,a.shape,a.dtype,i,o),2),c=u[0],l=u[1];return[n.makeTensorInfo(c.shape,c.dtype,c.values),n.makeTensorInfo(l.shape,l.dtype,l.values)]}};var mge={kernelName:"Unique",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.attrs,r=e.backend,a=n.axis,i=t.x;rle(i,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");var o=r.readSync(i.dataId),s=bhe(o,a,i.shape,i.dtype),u=s.outputValues,c=s.outputShape,l=s.indices;return[r.makeTensorInfo(c,i.dtype,u),r.makeTensorInfo([l.length],"int32",l)]}};var gge={kernelName:Wae,backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.value,i=r.axis;i<0&&(i+=a.shape.length);for(var o=a,s=o.shape.length,u=a.shape[i],c=new Array(s-1),l=0,h=0;h<s;h++)h!==i&&(c[l++]=o.shape[h]);var f=[],d=new Array(s).fill(0),p=o.shape.slice();p[i]=1;for(var v=new Array(u),m=0;m<v.length;m++){d[i]=m;var g=fde({inputs:{x:o},backend:n,attrs:{begin:d,size:p}}),y=dfe({inputs:{x:g},backend:n,attrs:{shape:c}});v[m]=y,f.push(g)}return f.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),v}},yge=Jn((function e(t,n){$n(this,e),this.variableNames=["x","segmentIds"];var r=t.windowSize,a=t.batchSize,i=t.inSize,o=t.numSegments,s=o*Math.ceil(i/r);this.outputShape=[a,s];var u=4*Math.floor(r/4),c=r%4,l="\n        sumValue += dot(values, segFilter);\n    ",h="";i%r>0&&(h="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return initializationValue;\n        }\n      "));var f="";i%r>0&&(f="\n        if (inIdx < 0 || inIdx >= ".concat(i,") {\n          return -1.0;\n        }\n      ")),this.userCode="\n      const float initializationValue = ".concat("0.0",";\n\n      float getValue(int batch, int inIdx) {\n        ").concat(h,"\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ").concat(f,"\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ").concat(o,")) * float(").concat(r,"));\n        int currentSeg = int(mod(float(outIdx), float(").concat(o,")));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ").concat(u,"; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ").concat(l,"\n        }\n\n        int inIdx = inOffset + ").concat(u,";\n        if (").concat(1===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ").concat(l,"\n        } else if (").concat(2===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ").concat(l,"\n        } else if (").concat(3===c,") {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ").concat(l,"\n        }\n        setOutput(").concat("sumValue",");\n      }\n    ")}));for(var bge={kernelName:"UnsortedSegmentSum",backendName:"webgl",kernelFunc:function(e){var t=e.inputs,n=e.backend,r=e.attrs,a=t.x,i=t.segmentIds,o=r.numSegments,s=a.shape.length,u=[],c=0,l=$se([c],s),h=a;null!=l&&(h=_fe({inputs:{x:a},backend:n,attrs:{perm:l}}),u.push(h),c=tue(1,s)[0]);var f=function(e,t,n){for(var r=[],a=e.length,i=0;i<a;i++)i!==t?r.push(e[i]):r.push(n);return r}(h.shape,c,o),d=hre([h.shape[c]]),p=dfe({inputs:{x:h},backend:n,attrs:{shape:[-1,d]}});u.push(p);var v=function e(t,r,a,i,o){var s=t.shape[0],c=t.shape[1],l=function(e,t){var n,r=!1;for(e<=30?(n=e,r=!0):n=Tre(e,Math.floor(Math.sqrt(e)));!r;)n>t||n===e?r=!0:n=Tre(e,n+1);return n}(c,o),h=new yge({windowSize:l,inSize:c,batchSize:s,numSegments:o},r),f=n.compileAndRun(h,[t,a],i);if(u.push(f),f.shape[1]===o)return f;var d=gme({backend:n,attrs:{start:0,stop:o,step:1,dtype:"float32"}}),p=dge({inputs:{x:d},backend:n,attrs:{reps:[c/l]}});return u.push(d),u.push(p),e(f,r,p,i,o)}(p,"unsortedSegmentSum",i,Aie(a.dtype),o),m=dfe({inputs:{x:v},backend:n,attrs:{shape:f}}),g=m;if(null!=l){u.push(m);var y=eue(l);g=_fe({inputs:{x:g},backend:n,attrs:{perm:y}})}return u.forEach((function(e){return n.disposeIntermediateTensorInfo(e)})),g}},xge=0,kge=[kve,_ve,Tfe,Ife,Afe,Mfe,Dfe,Lfe,Ffe,zfe,jfe,qfe,Hfe,Xfe,Yfe,Kfe,Qfe,ede,$fe,rde,ade,ide,ude,pde,vde,xde,wde,Cde,Ide,Qhe,Fde,Kde,Yde,Gde,Zde,Jde,Qde,$de,epe,npe,ope,spe,cpe,vpe,mpe,fpe,ype,xpe,kpe,wpe,_pe,Spe,Epe,Ape,Npe,Ppe,zpe,Upe,Wpe,jpe,Xpe,Kpe,Ype,Zpe,$pe,tve,rve,Khe,ave,Dde,ive,ove,sve,$he,uve,lve,hve,pve,fve,mve,gve,yve,Cve,Ive,Eve,Nve,Rve,Dve,Tve,Pve,Ove,Fve,Uve,Vve,Qve,ffe,Jve,eme,nme,ame,gde,ome,cme,lme,pme,vme,nfe,mme,yme,bde,jve,bme,_me,kme,pfe,Tme,Ime,Mme,Rme,Ome,Fme,Bme,Ume,Wme,jme,qme,Xme,Kme,Yme,Qme,dde,Yve,Zme,Jme,$me,ege,nge,rge,oge,sge,cge,Xve,wfe,lge,hge,pge,vge,Sfe,mge,gge,bge,ume];xge<kge.length;xge++){Jae(kge[xge])}var wge,_ge,Sge,Cge,Tge,Ege,Ige,Age=function(){var e=f((0,i.useState)(!1),2),t=e[0],n=e[1];(0,i.useEffect)((function(){t&&function(){o.apply(this,arguments)}()}),[t]);var r=(0,i.useRef)(null),a=(0,i.useRef)(null);function o(){return o=ns(es().mark((function e(){var t,n;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new gce("https://storage.googleapis.com/magentadata/js/checkpoints/music_vae/mel_16bar_small_q2"),n=new ere,e.next=4,t.initialize();case 4:r.current=t,a.current=n,s();case 7:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)}function s(){r.current.sample(1).then((function(e){a.current.isPlaying()&&a.current.stop(),a.current.resumeContext(),a.current.start(e[0])})).then(s)}return(0,Wt.jsx)(rl,{onClick:function(){return n(!0)},children:"MagentaTest"})},Mge=je.div(wge||(wge=Et(["\n  ",";\n  ",";\n  flex-direction: column;\n  background: hsl(200, 50%, 70%);\n"])),Pt,Dt),Nge=je.div(_ge||(_ge=Et([""]))),Rge=je.div(Sge||(Sge=Et([""]))),Dge=je.label(Cge||(Cge=Et([""]))),Pge=je.input(Tge||(Tge=Et([""]))),Oge=je.div(Ege||(Ege=Et([""]))),Lge=je.div(Ige||(Ige=Et([""])));var Fge,zge=function(){var e=f((0,i.useState)((new Date).getFullYear()),2),t=e[0],n=(e[1],f((0,i.useState)((new Date).getMonth()),2)),r=n[0],a=(n[1],f((0,i.useState)((new Date).getDate()),2)),o=a[0],s=(a[1],f((0,i.useState)(""),2)),u=s[0],c=s[1],l=f((0,i.useState)(""),2),h=l[0],d=l[1];function p(e){return e<10?"0"+e:e}var v=f((0,i.useState)(!1),2),m=v[0],g=v[1];return(0,i.useEffect)((function(){}),[m]),(0,Wt.jsxs)(Mge,{children:["When is your birthday?",(0,Wt.jsxs)(Nge,{children:[(0,Wt.jsxs)(Rge,{children:[(0,Wt.jsx)(Dge,{children:"Month"}),(0,Wt.jsx)(Pge,{type:"number",value:u,onChange:function(e){return c(e.target.value)}})]}),(0,Wt.jsxs)(Rge,{children:[(0,Wt.jsx)(Dge,{children:"Day"}),(0,Wt.jsx)(Pge,{type:"number",value:h,onChange:function(e){return d(e.target.value)}})]}),(0,Wt.jsx)(Oge,{onClick:function(){return g(!0)},children:"Submit"})]}),(0,Wt.jsxs)(Lge,{children:["Today ",p(o),"-",p(r),"-",t]})]})},Bge=je.div(Fge||(Fge=Et(["\n  ",";\n  ",";\n\n  img {\n    max-width: 100%;\n    max-height: 100%;\n  }\n"])),Pt,Dt),Uge=__webpack_require__.p+"static/media/Bascilica.3a5e299148dbabf8a5f5.jpeg",Vge=function(e,t){return Math.random()*(t-e)+e};var Wge,Gge,jge=function(){function e(){var t=this;$n(this,e),this.wrapper=document.getElementById("CanvasWrapper"),this.canvas=document.createElement("canvas"),this.wrapper.appendChild(this.canvas),this.ctx=this.canvas.getContext("2d"),this.imgSource=document.getElementById("source"),this.resize(),window.addEventListener("resize",this.resize.bind(this)),this.imgSource.addEventListener("load",(function(){t.init()}))}return Jn(e,[{key:"resize",value:function(){this.time=0,console.log("resized"),window.addEventListener("resize",this.resize.bind(this)),this.stageWidth=this.wrapper.clientWidth,this.stageHeight=this.wrapper.clientHeight,console.log(this.wrapper.clientWidth,this.wrapper.clientHeight),console.log(this.stageWidth,this.stageHeight),this.canvas.width=this.stageWidth,this.canvas.height=this.stageHeight,this.ctx.scale(1,1),this.init(),this.interval=this.stageWidth,this.cropper=20*this.interval,this.overflow=10}},{key:"init",value:function(){this.imgWidth=this.imgSource.width,this.imgHeight=this.imgSource.height,console.log(this.imgWidth,this.imgHeight),this.widthRatio=this.stageWidth/this.imgWidth,this.heightRatio=this.stageHeight/this.imgHeight,this.resizeRatio=Math.max(this.widthRatio,this.heightRatio),this.widthAdjuster=(this.imgWidth*this.resizeRatio-this.stageWidth)/2,this.heightAdjuster=(this.imgHeight*this.resizeRatio-this.stageHeight)/2,this.animate()}},{key:"animate",value:function(){this.time++,this.vibration-=this.vibration*this.vibrationSpeed;for(var e=-this.interval*this.overflow;e<this.imgWidth+this.interval*this.overflow;e+=this.interval)for(var t=-this.interval*(this.overflow+10);t<this.imgHeight+this.interval*this.overflow;t+=this.interval){var n=Vge(-10,10);this.ctx.globalAlpha=Vge(0,.6),this.ctx.translate(e*this.resizeRatio-this.widthAdjuster,t*this.resizeRatio-this.heightAdjuster),this.ctx.rotate(n*Math.PI/180),this.ctx.drawImage(this.imgSource,e,t,this.cropper*Vge(.3,Vge(.5,3)),this.cropper*Vge(.3,Vge(.5,3)),0,0,this.cropper*this.resizeRatio,6*this.cropper*this.resizeRatio),this.ctx.rotate(-n*Math.PI/180),this.ctx.translate(-e*this.resizeRatio+this.widthAdjuster,-t*this.resizeRatio+this.heightAdjuster)}}}]),e}(),qge=function(){var e=f((0,i.useState)(null),2),t=(e[0],e[1]);return(0,i.useEffect)((function(){t(new jge)}),[]),(0,Wt.jsx)(Bge,{id:"CanvasWrapper",children:(0,Wt.jsx)("img",{id:"source",src:Uge})})},Hge=je.div(Wge||(Wge=Et(["\n  ",";\n  ",";\n"])),Dt,Pt),Xge="142",Kge={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},Yge={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},Qge=0,Zge=1,Jge=2,$ge=3,eye=0,tye=1,nye=2,rye=3,aye=0,iye=1,oye=2,sye=1,uye=2,cye=0,lye=1,hye=2,fye=3,dye=4,pye=5,vye=100,mye=101,gye=102,yye=103,bye=104,xye=200,kye=201,wye=202,_ye=203,Sye=204,Cye=205,Tye=206,Eye=207,Iye=208,Aye=209,Mye=210,Nye=0,Rye=1,Dye=2,Pye=3,Oye=4,Lye=5,Fye=6,zye=7,Bye=0,Uye=1,Vye=2,Wye=0,Gye=1,jye=2,qye=3,Hye=4,Xye=5,Kye=300,Yye=301,Qye=302,Zye=303,Jye=304,$ye=306,ebe=1e3,tbe=1001,nbe=1002,rbe=1003,abe=1004,ibe=1004,obe=1005,sbe=1005,ube=1006,cbe=1007,lbe=1007,hbe=1008,fbe=1008,dbe=1009,pbe=1010,vbe=1011,mbe=1012,gbe=1013,ybe=1014,bbe=1015,xbe=1016,kbe=1017,wbe=1018,_be=1020,Sbe=1021,Cbe=1022,Tbe=1023,Ebe=1024,Ibe=1025,Abe=1026,Mbe=1027,Nbe=1028,Rbe=1029,Dbe=1030,Pbe=1031,Obe=1033,Lbe=33776,Fbe=33777,zbe=33778,Bbe=33779,Ube=35840,Vbe=35841,Wbe=35842,Gbe=35843,jbe=36196,qbe=37492,Hbe=37496,Xbe=37808,Kbe=37809,Ybe=37810,Qbe=37811,Zbe=37812,Jbe=37813,$be=37814,exe=37815,txe=37816,nxe=37817,rxe=37818,axe=37819,ixe=37820,oxe=37821,sxe=36492,uxe=2200,cxe=2201,lxe=2202,hxe=2300,fxe=2301,dxe=2302,pxe=2400,vxe=2401,mxe=2402,gxe=2500,yxe=2501,bxe=0,xxe=1,kxe=2,wxe=3e3,_xe=3001,Sxe=3200,Cxe=3201,Txe=0,Exe=1,Ixe="",Axe="srgb",Mxe="srgb-linear",Nxe=0,Rxe=7680,Dxe=7681,Pxe=7682,Oxe=7683,Lxe=34055,Fxe=34056,zxe=5386,Bxe=512,Uxe=513,Vxe=514,Wxe=515,Gxe=516,jxe=517,qxe=518,Hxe=519,Xxe=35044,Kxe=35048,Yxe=35040,Qxe=35045,Zxe=35049,Jxe=35041,$xe=35046,eke=35050,tke=35042,nke="100",rke="300 es",ake=1035,ike=function(){function e(){$n(this,e)}return Jn(e,[{key:"addEventListener",value:function(e,t){void 0===this._listeners&&(this._listeners={});var n=this._listeners;void 0===n[e]&&(n[e]=[]),-1===n[e].indexOf(t)&&n[e].push(t)}},{key:"hasEventListener",value:function(e,t){if(void 0===this._listeners)return!1;var n=this._listeners;return void 0!==n[e]&&-1!==n[e].indexOf(t)}},{key:"removeEventListener",value:function(e,t){if(void 0!==this._listeners){var n=this._listeners[e];if(void 0!==n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}}}},{key:"dispatchEvent",value:function(e){if(void 0!==this._listeners){var t=this._listeners[e.type];if(void 0!==t){e.target=this;for(var n=t.slice(0),r=0,a=n.length;r<a;r++)n[r].call(this,e);e.target=null}}}}]),e}(),oke=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"],ske=1234567,uke=Math.PI/180,cke=180/Math.PI;function lke(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,n=4294967295*Math.random()|0,r=4294967295*Math.random()|0;return(oke[255&e]+oke[e>>8&255]+oke[e>>16&255]+oke[e>>24&255]+"-"+oke[255&t]+oke[t>>8&255]+"-"+oke[t>>16&15|64]+oke[t>>24&255]+"-"+oke[63&n|128]+oke[n>>8&255]+"-"+oke[n>>16&255]+oke[n>>24&255]+oke[255&r]+oke[r>>8&255]+oke[r>>16&255]+oke[r>>24&255]).toLowerCase()}function hke(e,t,n){return Math.max(t,Math.min(n,e))}function fke(e,t){return(e%t+t)%t}function dke(e,t,n){return(1-n)*e+n*t}function pke(e){return 0===(e&e-1)&&0!==e}function vke(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))}function mke(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))}var gke=Object.freeze({__proto__:null,DEG2RAD:uke,RAD2DEG:cke,generateUUID:lke,clamp:hke,euclideanModulo:fke,mapLinear:function(e,t,n,r,a){return r+(e-t)*(a-r)/(n-t)},inverseLerp:function(e,t,n){return e!==t?(n-e)/(t-e):0},lerp:dke,damp:function(e,t,n,r){return dke(e,t,1-Math.exp(-n*r))},pingpong:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return t-Math.abs(fke(e,2*t)-t)},smoothstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*(3-2*e)},smootherstep:function(e,t,n){return e<=t?0:e>=n?1:(e=(e-t)/(n-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},seededRandom:function(e){void 0!==e&&(ske=e);var t=ske+=1831565813;return t=Math.imul(t^t>>>15,1|t),(((t^=t+Math.imul(t^t>>>7,61|t))^t>>>14)>>>0)/4294967296},degToRad:function(e){return e*uke},radToDeg:function(e){return e*cke},isPowerOfTwo:pke,ceilPowerOfTwo:vke,floorPowerOfTwo:mke,setQuaternionFromProperEuler:function(e,t,n,r,a){var i=Math.cos,o=Math.sin,s=i(n/2),u=o(n/2),c=i((t+r)/2),l=o((t+r)/2),h=i((t-r)/2),f=o((t-r)/2),d=i((r-t)/2),p=o((r-t)/2);switch(a){case"XYX":e.set(s*l,u*h,u*f,s*c);break;case"YZY":e.set(u*f,s*l,u*h,s*c);break;case"ZXZ":e.set(u*h,u*f,s*l,s*c);break;case"XZX":e.set(s*l,u*p,u*d,s*c);break;case"YXY":e.set(u*d,s*l,u*p,s*c);break;case"ZYZ":e.set(u*p,u*d,s*l,s*c);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+a)}},normalize:function(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return Math.round(65535*e);case Uint8Array:return Math.round(255*e);case Int16Array:return Math.round(32767*e);case Int8Array:return Math.round(127*e);default:throw new Error("Invalid component type.")}},denormalize:function(e,t){switch(t.constructor){case Float32Array:return e;case Uint16Array:return e/65535;case Uint8Array:return e/255;case Int16Array:return Math.max(e/32767,-1);case Int8Array:return Math.max(e/127,-1);default:throw new Error("Invalid component type.")}}}),yke=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;$n(this,t),t.prototype.isVector2=!0,this.x=e,this.y=n}return Jn(t,[{key:"width",get:function(){return this.x},set:function(e){this.x=e}},{key:"height",get:function(){return this.y},set:function(e){this.y=e}},{key:"set",value:function(e,t){return this.x=e,this.y=t,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=e.elements;return this.x=r[0]*t+r[3]*n+r[6],this.y=r[1]*t+r[4]*n+r[7],this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y}},{key:"cross",value:function(e){return this.x*e.y-this.y*e.x}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"angle",value:function(){var e=Math.atan2(-this.y,-this.x)+Math.PI;return e}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y;return t*t+n*n}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this}},{key:"rotateAround",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),a=this.x-e.x,i=this.y-e.y;return this.x=a*n-i*r+e.x,this.y=a*r+i*n+e.y,this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this}},{key:Symbol.iterator,value:es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:case"end":return e.stop()}}),e,this)}))}]),t}(),bke=function(){function e(){$n(this,e),e.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}return Jn(e,[{key:"set",value:function(e,t,n,r,a,i,o,s,u){var c=this.elements;return c[0]=e,c[1]=r,c[2]=o,c[3]=t,c[4]=a,c[5]=s,c[6]=n,c[7]=i,c[8]=u,this}},{key:"identity",value:function(){return this.set(1,0,0,0,1,0,0,0,1),this}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}},{key:"setFromMatrix4",value:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}},{key:"multiply",value:function(e){return this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,a=this.elements,i=n[0],o=n[3],s=n[6],u=n[1],c=n[4],l=n[7],h=n[2],f=n[5],d=n[8],p=r[0],v=r[3],m=r[6],g=r[1],y=r[4],b=r[7],x=r[2],k=r[5],w=r[8];return a[0]=i*p+o*g+s*x,a[3]=i*v+o*y+s*k,a[6]=i*m+o*b+s*w,a[1]=u*p+c*g+l*x,a[4]=u*v+c*y+l*k,a[7]=u*m+c*b+l*w,a[2]=h*p+f*g+d*x,a[5]=h*v+f*y+d*k,a[8]=h*m+f*b+d*w,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],u=e[7],c=e[8];return t*i*c-t*o*u-n*a*c+n*o*s+r*a*u-r*i*s}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],u=e[7],c=e[8],l=c*i-o*u,h=o*s-c*a,f=u*a-i*s,d=t*l+n*h+r*f;if(0===d)return this.set(0,0,0,0,0,0,0,0,0);var p=1/d;return e[0]=l*p,e[1]=(r*u-c*n)*p,e[2]=(o*n-r*i)*p,e[3]=h*p,e[4]=(c*t-r*s)*p,e[5]=(r*a-o*t)*p,e[6]=f*p,e[7]=(n*s-u*t)*p,e[8]=(i*t-n*a)*p,this}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}},{key:"getNormalMatrix",value:function(e){return this.setFromMatrix4(e).invert().transpose()}},{key:"transposeIntoArray",value:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}},{key:"setUvTransform",value:function(e,t,n,r,a,i,o){var s=Math.cos(a),u=Math.sin(a);return this.set(n*s,n*u,-n*(s*i+u*o)+i+e,-r*u,r*s,-r*(-u*i+s*o)+o+t,0,0,1),this}},{key:"scale",value:function(e,t){var n=this.elements;return n[0]*=e,n[3]*=e,n[6]*=e,n[1]*=t,n[4]*=t,n[7]*=t,this}},{key:"rotate",value:function(e){var t=Math.cos(e),n=Math.sin(e),r=this.elements,a=r[0],i=r[3],o=r[6],s=r[1],u=r[4],c=r[7];return r[0]=t*a+n*s,r[3]=t*i+n*u,r[6]=t*o+n*c,r[1]=-n*a+t*s,r[4]=-n*i+t*u,r[7]=-n*o+t*c,this}},{key:"translate",value:function(e,t){var n=this.elements;return n[0]+=e*n[2],n[3]+=e*n[5],n[6]+=e*n[8],n[1]+=t*n[2],n[4]+=t*n[5],n[7]+=t*n[8],this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<9;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<9;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}},{key:"clone",value:function(){return(new this.constructor).fromArray(this.elements)}}]),e}();function xke(e){for(var t=e.length-1;t>=0;--t)if(e[t]>65535)return!0;return!1}var kke={Int8Array:Int8Array,Uint8Array:Uint8Array,Uint8ClampedArray:Uint8ClampedArray,Int16Array:Int16Array,Uint16Array:Uint16Array,Int32Array:Int32Array,Uint32Array:Uint32Array,Float32Array:Float32Array,Float64Array:Float64Array};function wke(e,t){return new kke[e](t)}function _ke(e){return document.createElementNS("http://www.w3.org/1999/xhtml",e)}function Ske(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function Cke(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}var Tke=(IE(Gge={},Axe,IE({},Mxe,Ske)),IE(Gge,Mxe,IE({},Axe,Cke)),Gge),Eke={legacyMode:!0,get workingColorSpace(){return Mxe},set workingColorSpace(e){console.warn("THREE.ColorManagement: .workingColorSpace is readonly.")},convert:function(e,t,n){if(this.legacyMode||t===n||!t||!n)return e;if(Tke[t]&&void 0!==Tke[t][n]){var r=Tke[t][n];return e.r=r(e.r),e.g=r(e.g),e.b=r(e.b),e}throw new Error("Unsupported color space conversion.")},fromWorkingColorSpace:function(e,t){return this.convert(e,this.workingColorSpace,t)},toWorkingColorSpace:function(e,t){return this.convert(e,t,this.workingColorSpace)}},Ike={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ake={r:0,g:0,b:0},Mke={h:0,s:0,l:0},Nke={h:0,s:0,l:0};function Rke(e,t,n){return n<0&&(n+=1),n>1&&(n-=1),n<1/6?e+6*(t-e)*n:n<.5?t:n<2/3?e+6*(t-e)*(2/3-n):e}function Dke(e,t){return t.r=e.r,t.g=e.g,t.b=e.b,t}var Pke,Oke=function(e){function t(e,n,r){return $n(this,t),this.isColor=!0,this.r=1,this.g=1,this.b=1,void 0===n&&void 0===r?this.set(e):this.setRGB(e,n,r)}return Jn(t,[{key:"set",value:function(e){return e&&e.isColor?this.copy(e):"number"===typeof e?this.setHex(e):"string"===typeof e&&this.setStyle(e),this}},{key:"setScalar",value:function(e){return this.r=e,this.g=e,this.b=e,this}},{key:"setHex",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Axe;return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,Eke.toWorkingColorSpace(this,t),this}},{key:"setRGB",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Mxe;return this.r=e,this.g=t,this.b=n,Eke.toWorkingColorSpace(this,r),this}},{key:"setHSL",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Mxe;if(e=fke(e,1),t=hke(t,0,1),n=hke(n,0,1),0===t)this.r=this.g=this.b=n;else{var a=n<=.5?n*(1+t):n+t-n*t,i=2*n-a;this.r=Rke(i,a,e+1/3),this.g=Rke(i,a,e),this.b=Rke(i,a,e-1/3)}return Eke.toWorkingColorSpace(this,r),this}},{key:"setStyle",value:function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Axe;function r(t){void 0!==t&&parseFloat(t)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}if(t=/^((?:rgb|hsl)a?)\(([^\)]*)\)/.exec(e)){var a,i=t[1],o=t[2];switch(i){case"rgb":case"rgba":if(a=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(255,parseInt(a[1],10))/255,this.g=Math.min(255,parseInt(a[2],10))/255,this.b=Math.min(255,parseInt(a[3],10))/255,Eke.toWorkingColorSpace(this,n),r(a[4]),this;if(a=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o))return this.r=Math.min(100,parseInt(a[1],10))/100,this.g=Math.min(100,parseInt(a[2],10))/100,this.b=Math.min(100,parseInt(a[3],10))/100,Eke.toWorkingColorSpace(this,n),r(a[4]),this;break;case"hsl":case"hsla":if(a=/^\s*(\d*\.?\d+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(o)){var s=parseFloat(a[1])/360,u=parseInt(a[2],10)/100,c=parseInt(a[3],10)/100;return r(a[4]),this.setHSL(s,u,c,n)}}}else if(t=/^\#([A-Fa-f\d]+)$/.exec(e)){var l=t[1],h=l.length;if(3===h)return this.r=parseInt(l.charAt(0)+l.charAt(0),16)/255,this.g=parseInt(l.charAt(1)+l.charAt(1),16)/255,this.b=parseInt(l.charAt(2)+l.charAt(2),16)/255,Eke.toWorkingColorSpace(this,n),this;if(6===h)return this.r=parseInt(l.charAt(0)+l.charAt(1),16)/255,this.g=parseInt(l.charAt(2)+l.charAt(3),16)/255,this.b=parseInt(l.charAt(4)+l.charAt(5),16)/255,Eke.toWorkingColorSpace(this,n),this}return e&&e.length>0?this.setColorName(e,n):this}},{key:"setColorName",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Axe,n=Ike[e.toLowerCase()];return void 0!==n?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}},{key:"clone",value:function(){return new this.constructor(this.r,this.g,this.b)}},{key:"copy",value:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}},{key:"copySRGBToLinear",value:function(e){return this.r=Ske(e.r),this.g=Ske(e.g),this.b=Ske(e.b),this}},{key:"copyLinearToSRGB",value:function(e){return this.r=Cke(e.r),this.g=Cke(e.g),this.b=Cke(e.b),this}},{key:"convertSRGBToLinear",value:function(){return this.copySRGBToLinear(this),this}},{key:"convertLinearToSRGB",value:function(){return this.copyLinearToSRGB(this),this}},{key:"getHex",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Axe;return Eke.fromWorkingColorSpace(Dke(this,Ake),e),hke(255*Ake.r,0,255)<<16^hke(255*Ake.g,0,255)<<8^hke(255*Ake.b,0,255)<<0}},{key:"getHexString",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Axe;return("000000"+this.getHex(e).toString(16)).slice(-6)}},{key:"getHSL",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mxe;Eke.fromWorkingColorSpace(Dke(this,Ake),t);var n,r,a=Ake.r,i=Ake.g,o=Ake.b,s=Math.max(a,i,o),u=Math.min(a,i,o),c=(u+s)/2;if(u===s)n=0,r=0;else{var l=s-u;switch(r=c<=.5?l/(s+u):l/(2-s-u),s){case a:n=(i-o)/l+(i<o?6:0);break;case i:n=(o-a)/l+2;break;case o:n=(a-i)/l+4}n/=6}return e.h=n,e.s=r,e.l=c,e}},{key:"getRGB",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mxe;return Eke.fromWorkingColorSpace(Dke(this,Ake),t),e.r=Ake.r,e.g=Ake.g,e.b=Ake.b,e}},{key:"getStyle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Axe;return Eke.fromWorkingColorSpace(Dke(this,Ake),e),e!==Axe?"color(".concat(e," ").concat(Ake.r," ").concat(Ake.g," ").concat(Ake.b,")"):"rgb(".concat(255*Ake.r|0,",").concat(255*Ake.g|0,",").concat(255*Ake.b|0,")")}},{key:"offsetHSL",value:function(e,t,n){return this.getHSL(Mke),Mke.h+=e,Mke.s+=t,Mke.l+=n,this.setHSL(Mke.h,Mke.s,Mke.l),this}},{key:"add",value:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}},{key:"addColors",value:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}},{key:"addScalar",value:function(e){return this.r+=e,this.g+=e,this.b+=e,this}},{key:"sub",value:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}},{key:"multiply",value:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}},{key:"multiplyScalar",value:function(e){return this.r*=e,this.g*=e,this.b*=e,this}},{key:"lerp",value:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}},{key:"lerpColors",value:function(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}},{key:"lerpHSL",value:function(e,t){this.getHSL(Mke),e.getHSL(Nke);var n=dke(Mke.h,Nke.h,t),r=dke(Mke.s,Nke.s,t),a=dke(Mke.l,Nke.l,t);return this.setHSL(n,r,a),this}},{key:"equals",value:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}},{key:"fromBufferAttribute",value:function(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),!0===e.normalized&&(this.r/=255,this.g/=255,this.b/=255),this}},{key:"toJSON",value:function(){return this.getHex()}},{key:Symbol.iterator,value:es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.r;case 2:return e.next=4,this.g;case 4:return e.next=6,this.b;case 6:case"end":return e.stop()}}),e,this)}))}]),t}();Oke.NAMES=Ike;var Lke=function(){function e(){$n(this,e)}return Jn(e,null,[{key:"getDataURL",value:function(e){if(/^data:/i.test(e.src))return e.src;if("undefined"==typeof HTMLCanvasElement)return e.src;var t;if(e instanceof HTMLCanvasElement)t=e;else{void 0===Pke&&(Pke=_ke("canvas")),Pke.width=e.width,Pke.height=e.height;var n=Pke.getContext("2d");e instanceof ImageData?n.putImageData(e,0,0):n.drawImage(e,0,0,e.width,e.height),t=Pke}return t.width>2048||t.height>2048?(console.warn("THREE.ImageUtils.getDataURL: Image converted to jpg for performance reasons",e),t.toDataURL("image/jpeg",.6)):t.toDataURL("image/png")}},{key:"sRGBToLinear",value:function(e){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var t=_ke("canvas");t.width=e.width,t.height=e.height;var n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);for(var r=n.getImageData(0,0,e.width,e.height),a=r.data,i=0;i<a.length;i++)a[i]=255*Ske(a[i]/255);return n.putImageData(r,0,0),t}if(e.data){for(var o=e.data.slice(0),s=0;s<o.length;s++)o instanceof Uint8Array||o instanceof Uint8ClampedArray?o[s]=Math.floor(255*Ske(o[s]/255)):o[s]=Ske(o[s]);return{data:o,width:e.width,height:e.height}}return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}]),e}(),Fke=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;$n(this,e),this.isSource=!0,this.uuid=lke(),this.data=t,this.version=0}return Jn(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.images[this.uuid])return e.images[this.uuid];var n={uuid:this.uuid,url:""},r=this.data;if(null!==r){var a;if(Array.isArray(r)){a=[];for(var i=0,o=r.length;i<o;i++)r[i].isDataTexture?a.push(zke(r[i].image)):a.push(zke(r[i]))}else a=zke(r);n.url=a}return t||(e.images[this.uuid]=n),n}}]),e}();function zke(e){return"undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap?Lke.getDataURL(e):e.data?{data:Array.from(e.data),width:e.width,height:e.height,type:e.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}var Bke=0,Uke=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n.DEFAULT_IMAGE,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:n.DEFAULT_MAPPING,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:tbe,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:tbe,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:ube,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:hbe,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Tbe,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:dbe,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:1,f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:wxe;return $n(this,n),(e=t.call(this)).isTexture=!0,Object.defineProperty(ir(e),"id",{value:Bke++}),e.uuid=lke(),e.name="",e.source=new Fke(r),e.mipmaps=[],e.mapping=a,e.wrapS=i,e.wrapT=o,e.magFilter=s,e.minFilter=u,e.anisotropy=h,e.format=c,e.internalFormat=null,e.type=l,e.offset=new yke(0,0),e.repeat=new yke(1,1),e.center=new yke(0,0),e.rotation=0,e.matrixAutoUpdate=!0,e.matrix=new bke,e.generateMipmaps=!0,e.premultiplyAlpha=!1,e.flipY=!0,e.unpackAlignment=4,e.encoding=f,e.userData={},e.version=0,e.onUpdate=null,e.isRenderTargetTexture=!1,e.needsPMREMUpdate=!1,e}return Jn(n,[{key:"image",get:function(){return this.source.data},set:function(e){this.source.data=e}},{key:"updateMatrix",value:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;if(!t&&void 0!==e.textures[this.uuid])return e.textures[this.uuid];var n={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"transformUv",value:function(e){if(this.mapping!==Kye)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case ebe:e.x=e.x-Math.floor(e.x);break;case tbe:e.x=e.x<0?0:1;break;case nbe:1===Math.abs(Math.floor(e.x)%2)?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||e.y>1)switch(this.wrapT){case ebe:e.y=e.y-Math.floor(e.y);break;case tbe:e.y=e.y<0?0:1;break;case nbe:1===Math.abs(Math.floor(e.y)%2)?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}},{key:"needsUpdate",set:function(e){!0===e&&(this.version++,this.source.needsUpdate=!0)}}]),n}(ike);Uke.DEFAULT_IMAGE=null,Uke.DEFAULT_MAPPING=Kye;var Vke=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;$n(this,t),t.prototype.isVector4=!0,this.x=e,this.y=n,this.z=r,this.w=a}return Jn(t,[{key:"width",get:function(){return this.z},set:function(e){this.z=e}},{key:"height",get:function(){return this.w},set:function(e){this.w=e}},{key:"set",value:function(e,t,n,r){return this.x=e,this.y=t,this.z=n,this.w=r,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setW",value:function(e){return this.w=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z,this.w)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=void 0!==e.w?e.w:1,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}},{key:"multiply",value:function(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,a=this.w,i=e.elements;return this.x=i[0]*t+i[4]*n+i[8]*r+i[12]*a,this.y=i[1]*t+i[5]*n+i[9]*r+i[13]*a,this.z=i[2]*t+i[6]*n+i[10]*r+i[14]*a,this.w=i[3]*t+i[7]*n+i[11]*r+i[15]*a,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"setAxisAngleFromQuaternion",value:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}},{key:"setAxisAngleFromRotationMatrix",value:function(e){var t,n,r,a,i=.01,o=.1,s=e.elements,u=s[0],c=s[4],l=s[8],h=s[1],f=s[5],d=s[9],p=s[2],v=s[6],m=s[10];if(Math.abs(c-h)<i&&Math.abs(l-p)<i&&Math.abs(d-v)<i){if(Math.abs(c+h)<o&&Math.abs(l+p)<o&&Math.abs(d+v)<o&&Math.abs(u+f+m-3)<o)return this.set(1,0,0,0),this;t=Math.PI;var g=(u+1)/2,y=(f+1)/2,b=(m+1)/2,x=(c+h)/4,k=(l+p)/4,w=(d+v)/4;return g>y&&g>b?g<i?(n=0,r=.707106781,a=.707106781):(r=x/(n=Math.sqrt(g)),a=k/n):y>b?y<i?(n=.707106781,r=0,a=.707106781):(n=x/(r=Math.sqrt(y)),a=w/r):b<i?(n=.707106781,r=.707106781,a=0):(n=k/(a=Math.sqrt(b)),r=w/a),this.set(n,r,a,t),this}var _=Math.sqrt((v-d)*(v-d)+(l-p)*(l-p)+(h-c)*(h-c));return Math.abs(_)<.001&&(_=1),this.x=(v-d)/_,this.y=(l-p)/_,this.z=(h-c)/_,this.w=Math.acos((u+f+m-1)/2),this}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}},{key:Symbol.iterator,value:es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:return e.next=8,this.w;case 8:case"end":return e.stop()}}),e,this)}))}]),t}(),Wke=function(e){tr(n,e);var t=sr(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};$n(this,n),(a=t.call(this)).isWebGLRenderTarget=!0,a.width=e,a.height=r,a.depth=1,a.scissor=new Vke(0,0,e,r),a.scissorTest=!1,a.viewport=new Vke(0,0,e,r);var o={width:e,height:r,depth:1};return a.texture=new Uke(o,i.mapping,i.wrapS,i.wrapT,i.magFilter,i.minFilter,i.format,i.type,i.anisotropy,i.encoding),a.texture.isRenderTargetTexture=!0,a.texture.flipY=!1,a.texture.generateMipmaps=void 0!==i.generateMipmaps&&i.generateMipmaps,a.texture.internalFormat=void 0!==i.internalFormat?i.internalFormat:null,a.texture.minFilter=void 0!==i.minFilter?i.minFilter:ube,a.depthBuffer=void 0===i.depthBuffer||i.depthBuffer,a.stencilBuffer=void 0!==i.stencilBuffer&&i.stencilBuffer,a.depthTexture=void 0!==i.depthTexture?i.depthTexture:null,a.samples=void 0!==i.samples?i.samples:0,a}return Jn(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;this.width===e&&this.height===t&&this.depth===n||(this.width=e,this.height=t,this.depth=n,this.texture.image.width=e,this.texture.image.height=t,this.texture.image.depth=n,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.texture.isRenderTargetTexture=!0;var t=Object.assign({},e.texture.image);return this.texture.source=new Fke(t),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(ike),Gke=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return $n(this,n),(e=t.call(this,null)).isDataArrayTexture=!0,e.image={data:r,width:a,height:i,depth:o},e.magFilter=rbe,e.minFilter=rbe,e.wrapR=tbe,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return Jn(n)}(Uke),jke=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;return $n(this,n),(i=t.call(this,e,r)).isWebGLArrayRenderTarget=!0,i.depth=a,i.texture=new Gke(null,e,r,a),i.texture.isRenderTargetTexture=!0,i}return Jn(n)}(Wke),qke=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return $n(this,n),(e=t.call(this,null)).isData3DTexture=!0,e.image={data:r,width:a,height:i,depth:o},e.magFilter=rbe,e.minFilter=rbe,e.wrapR=tbe,e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return Jn(n)}(Uke),Hke=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;return $n(this,n),(i=t.call(this,e,r)).isWebGL3DRenderTarget=!0,i.depth=a,i.texture=new qke(null,e,r,a),i.texture.isRenderTargetTexture=!0,i}return Jn(n)}(Wke),Xke=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};$n(this,n),(i=t.call(this,e,r,o)).isWebGLMultipleRenderTargets=!0;var s=i.texture;i.texture=[];for(var u=0;u<a;u++)i.texture[u]=s.clone(),i.texture[u].isRenderTargetTexture=!0;return i}return Jn(n,[{key:"setSize",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(var r=0,a=this.texture.length;r<a;r++)this.texture[r].image.width=e,this.texture[r].image.height=t,this.texture[r].image.depth=n;this.dispose()}return this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t),this}},{key:"copy",value:function(e){this.dispose(),this.width=e.width,this.height=e.height,this.depth=e.depth,this.viewport.set(0,0,this.width,this.height),this.scissor.set(0,0,this.width,this.height),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,null!==e.depthTexture&&(this.depthTexture=e.depthTexture.clone()),this.texture.length=0;for(var t=0,n=e.texture.length;t<n;t++)this.texture[t]=e.texture[t].clone(),this.texture[t].isRenderTargetTexture=!0;return this}}]),n}(Wke),Kke=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;$n(this,t),this.isQuaternion=!0,this._x=e,this._y=n,this._z=r,this._w=a}return Jn(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"w",get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n,r){return this._x=e,this._y=t,this._z=n,this._w=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._w)}},{key:"copy",value:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}},{key:"setFromEuler",value:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var n=e._x,r=e._y,a=e._z,i=e._order,o=Math.cos,s=Math.sin,u=o(n/2),c=o(r/2),l=o(a/2),h=s(n/2),f=s(r/2),d=s(a/2);switch(i){case"XYZ":this._x=h*c*l+u*f*d,this._y=u*f*l-h*c*d,this._z=u*c*d+h*f*l,this._w=u*c*l-h*f*d;break;case"YXZ":this._x=h*c*l+u*f*d,this._y=u*f*l-h*c*d,this._z=u*c*d-h*f*l,this._w=u*c*l+h*f*d;break;case"ZXY":this._x=h*c*l-u*f*d,this._y=u*f*l+h*c*d,this._z=u*c*d+h*f*l,this._w=u*c*l-h*f*d;break;case"ZYX":this._x=h*c*l-u*f*d,this._y=u*f*l+h*c*d,this._z=u*c*d-h*f*l,this._w=u*c*l+h*f*d;break;case"YZX":this._x=h*c*l+u*f*d,this._y=u*f*l+h*c*d,this._z=u*c*d-h*f*l,this._w=u*c*l-h*f*d;break;case"XZY":this._x=h*c*l-u*f*d,this._y=u*f*l-h*c*d,this._z=u*c*d+h*f*l,this._w=u*c*l+h*f*d;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+i)}return!1!==t&&this._onChangeCallback(),this}},{key:"setFromAxisAngle",value:function(e,t){var n=t/2,r=Math.sin(n);return this._x=e.x*r,this._y=e.y*r,this._z=e.z*r,this._w=Math.cos(n),this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=e.elements,n=t[0],r=t[4],a=t[8],i=t[1],o=t[5],s=t[9],u=t[2],c=t[6],l=t[10],h=n+o+l;if(h>0){var f=.5/Math.sqrt(h+1);this._w=.25/f,this._x=(c-s)*f,this._y=(a-u)*f,this._z=(i-r)*f}else if(n>o&&n>l){var d=2*Math.sqrt(1+n-o-l);this._w=(c-s)/d,this._x=.25*d,this._y=(r+i)/d,this._z=(a+u)/d}else if(o>l){var p=2*Math.sqrt(1+o-n-l);this._w=(a-u)/p,this._x=(r+i)/p,this._y=.25*p,this._z=(s+c)/p}else{var v=2*Math.sqrt(1+l-n-o);this._w=(i-r)/v,this._x=(a+u)/v,this._y=(s+c)/v,this._z=.25*v}return this._onChangeCallback(),this}},{key:"setFromUnitVectors",value:function(e,t){var n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}},{key:"angleTo",value:function(e){return 2*Math.acos(Math.abs(hke(this.dot(e),-1,1)))}},{key:"rotateTowards",value:function(e,t){var n=this.angleTo(e);if(0===n)return this;var r=Math.min(1,t/n);return this.slerp(e,r),this}},{key:"identity",value:function(){return this.set(0,0,0,1)}},{key:"invert",value:function(){return this.conjugate()}},{key:"conjugate",value:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}},{key:"dot",value:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}},{key:"lengthSq",value:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}},{key:"length",value:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}},{key:"normalize",value:function(){var e=this.length();return 0===e?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)}},{key:"premultiply",value:function(e){return this.multiplyQuaternions(e,this)}},{key:"multiplyQuaternions",value:function(e,t){var n=e._x,r=e._y,a=e._z,i=e._w,o=t._x,s=t._y,u=t._z,c=t._w;return this._x=n*c+i*o+r*u-a*s,this._y=r*c+i*s+a*o-n*u,this._z=a*c+i*u+n*s-r*o,this._w=i*c-n*o-r*s-a*u,this._onChangeCallback(),this}},{key:"slerp",value:function(e,t){if(0===t)return this;if(1===t)return this.copy(e);var n=this._x,r=this._y,a=this._z,i=this._w,o=i*e._w+n*e._x+r*e._y+a*e._z;if(o<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,o=-o):this.copy(e),o>=1)return this._w=i,this._x=n,this._y=r,this._z=a,this;var s=1-o*o;if(s<=Number.EPSILON){var u=1-t;return this._w=u*i+t*this._w,this._x=u*n+t*this._x,this._y=u*r+t*this._y,this._z=u*a+t*this._z,this.normalize(),this._onChangeCallback(),this}var c=Math.sqrt(s),l=Math.atan2(c,o),h=Math.sin((1-t)*l)/c,f=Math.sin(t*l)/c;return this._w=i*h+this._w*f,this._x=n*h+this._x*f,this._y=r*h+this._y*f,this._z=a*h+this._z*f,this._onChangeCallback(),this}},{key:"slerpQuaternions",value:function(e,t,n){return this.copy(e).slerp(t,n)}},{key:"random",value:function(){var e=Math.random(),t=Math.sqrt(1-e),n=Math.sqrt(e),r=2*Math.PI*Math.random(),a=2*Math.PI*Math.random();return this.set(t*Math.cos(r),n*Math.sin(a),n*Math.cos(a),t*Math.sin(r))}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}},{key:"fromBufferAttribute",value:function(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._w;case 8:case"end":return e.stop()}}),e,this)}))}],[{key:"slerp",value:function(e,t,n,r){return console.warn("THREE.Quaternion: Static .slerp() has been deprecated. Use qm.slerpQuaternions( qa, qb, t ) instead."),n.slerpQuaternions(e,t,r)}},{key:"slerpFlat",value:function(e,t,n,r,a,i,o){var s=n[r+0],u=n[r+1],c=n[r+2],l=n[r+3],h=a[i+0],f=a[i+1],d=a[i+2],p=a[i+3];if(0===o)return e[t+0]=s,e[t+1]=u,e[t+2]=c,void(e[t+3]=l);if(1===o)return e[t+0]=h,e[t+1]=f,e[t+2]=d,void(e[t+3]=p);if(l!==p||s!==h||u!==f||c!==d){var v=1-o,m=s*h+u*f+c*d+l*p,g=m>=0?1:-1,y=1-m*m;if(y>Number.EPSILON){var b=Math.sqrt(y),x=Math.atan2(b,m*g);v=Math.sin(v*x)/b,o=Math.sin(o*x)/b}var k=o*g;if(s=s*v+h*k,u=u*v+f*k,c=c*v+d*k,l=l*v+p*k,v===1-o){var w=1/Math.sqrt(s*s+u*u+c*c+l*l);s*=w,u*=w,c*=w,l*=w}}e[t]=s,e[t+1]=u,e[t+2]=c,e[t+3]=l}},{key:"multiplyQuaternionsFlat",value:function(e,t,n,r,a,i){var o=n[r],s=n[r+1],u=n[r+2],c=n[r+3],l=a[i],h=a[i+1],f=a[i+2],d=a[i+3];return e[t]=o*d+c*l+s*f-u*h,e[t+1]=s*d+c*h+u*l-o*f,e[t+2]=u*d+c*f+o*h-s*l,e[t+3]=c*d-o*l-s*h-u*f,e}}]),t}(),Yke=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;$n(this,t),t.prototype.isVector3=!0,this.x=e,this.y=n,this.z=r}return Jn(t,[{key:"set",value:function(e,t,n){return void 0===n&&(n=this.z),this.x=e,this.y=t,this.z=n,this}},{key:"setScalar",value:function(e){return this.x=e,this.y=e,this.z=e,this}},{key:"setX",value:function(e){return this.x=e,this}},{key:"setY",value:function(e){return this.y=e,this}},{key:"setZ",value:function(e){return this.z=e,this}},{key:"setComponent",value:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}},{key:"getComponent",value:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}},{key:"clone",value:function(){return new this.constructor(this.x,this.y,this.z)}},{key:"copy",value:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}},{key:"add",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)}},{key:"addScalar",value:function(e){return this.x+=e,this.y+=e,this.z+=e,this}},{key:"addVectors",value:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}},{key:"addScaledVector",value:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}},{key:"sub",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)}},{key:"subScalar",value:function(e){return this.x-=e,this.y-=e,this.z-=e,this}},{key:"subVectors",value:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)}},{key:"multiplyScalar",value:function(e){return this.x*=e,this.y*=e,this.z*=e,this}},{key:"multiplyVectors",value:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}},{key:"applyEuler",value:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Zke.setFromEuler(e))}},{key:"applyAxisAngle",value:function(e,t){return this.applyQuaternion(Zke.setFromAxisAngle(e,t))}},{key:"applyMatrix3",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[3]*n+a[6]*r,this.y=a[1]*t+a[4]*n+a[7]*r,this.z=a[2]*t+a[5]*n+a[8]*r,this}},{key:"applyNormalMatrix",value:function(e){return this.applyMatrix3(e).normalize()}},{key:"applyMatrix4",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.elements,i=1/(a[3]*t+a[7]*n+a[11]*r+a[15]);return this.x=(a[0]*t+a[4]*n+a[8]*r+a[12])*i,this.y=(a[1]*t+a[5]*n+a[9]*r+a[13])*i,this.z=(a[2]*t+a[6]*n+a[10]*r+a[14])*i,this}},{key:"applyQuaternion",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.x,i=e.y,o=e.z,s=e.w,u=s*t+i*r-o*n,c=s*n+o*t-a*r,l=s*r+a*n-i*t,h=-a*t-i*n-o*r;return this.x=u*s+h*-a+c*-o-l*-i,this.y=c*s+h*-i+l*-a-u*-o,this.z=l*s+h*-o+u*-i-c*-a,this}},{key:"project",value:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}},{key:"unproject",value:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}},{key:"transformDirection",value:function(e){var t=this.x,n=this.y,r=this.z,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*r,this.y=a[1]*t+a[5]*n+a[9]*r,this.z=a[2]*t+a[6]*n+a[10]*r,this.normalize()}},{key:"divide",value:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}},{key:"divideScalar",value:function(e){return this.multiplyScalar(1/e)}},{key:"min",value:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}},{key:"max",value:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}},{key:"clamp",value:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this}},{key:"clampScalar",value:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this}},{key:"clampLength",value:function(e,t){var n=this.length();return this.divideScalar(n||1).multiplyScalar(Math.max(e,Math.min(t,n)))}},{key:"floor",value:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}},{key:"ceil",value:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}},{key:"round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}},{key:"roundToZero",value:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this}},{key:"negate",value:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}},{key:"dot",value:function(e){return this.x*e.x+this.y*e.y+this.z*e.z}},{key:"lengthSq",value:function(){return this.x*this.x+this.y*this.y+this.z*this.z}},{key:"length",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}},{key:"manhattanLength",value:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}},{key:"normalize",value:function(){return this.divideScalar(this.length()||1)}},{key:"setLength",value:function(e){return this.normalize().multiplyScalar(e)}},{key:"lerp",value:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}},{key:"lerpVectors",value:function(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}},{key:"cross",value:function(e,t){return void 0!==t?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)}},{key:"crossVectors",value:function(e,t){var n=e.x,r=e.y,a=e.z,i=t.x,o=t.y,s=t.z;return this.x=r*s-a*o,this.y=a*i-n*s,this.z=n*o-r*i,this}},{key:"projectOnVector",value:function(e){var t=e.lengthSq();if(0===t)return this.set(0,0,0);var n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}},{key:"projectOnPlane",value:function(e){return Qke.copy(this).projectOnVector(e),this.sub(Qke)}},{key:"reflect",value:function(e){return this.sub(Qke.copy(e).multiplyScalar(2*this.dot(e)))}},{key:"angleTo",value:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(0===t)return Math.PI/2;var n=this.dot(e)/t;return Math.acos(hke(n,-1,1))}},{key:"distanceTo",value:function(e){return Math.sqrt(this.distanceToSquared(e))}},{key:"distanceToSquared",value:function(e){var t=this.x-e.x,n=this.y-e.y,r=this.z-e.z;return t*t+n*n+r*r}},{key:"manhattanDistanceTo",value:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}},{key:"setFromSpherical",value:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}},{key:"setFromSphericalCoords",value:function(e,t,n){var r=Math.sin(t)*e;return this.x=r*Math.sin(n),this.y=Math.cos(t)*e,this.z=r*Math.cos(n),this}},{key:"setFromCylindrical",value:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}},{key:"setFromCylindricalCoords",value:function(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}},{key:"setFromMatrixPosition",value:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}},{key:"setFromMatrixScale",value:function(e){var t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),r=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=r,this}},{key:"setFromMatrixColumn",value:function(e,t){return this.fromArray(e.elements,4*t)}},{key:"setFromMatrix3Column",value:function(e,t){return this.fromArray(e.elements,3*t)}},{key:"setFromEuler",value:function(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}},{key:"equals",value:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}},{key:"fromArray",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}},{key:"fromBufferAttribute",value:function(e,t,n){return void 0!==n&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}},{key:"random",value:function(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}},{key:"randomDirection",value:function(){var e=2*(Math.random()-.5),t=Math.random()*Math.PI*2,n=Math.sqrt(1-Math.pow(e,2));return this.x=n*Math.cos(t),this.y=n*Math.sin(t),this.z=e,this}},{key:Symbol.iterator,value:es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.x;case 2:return e.next=4,this.y;case 4:return e.next=6,this.z;case 6:case"end":return e.stop()}}),e,this)}))}]),t}(),Qke=new Yke,Zke=new Kke,Jke=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yke(1/0,1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yke(-1/0,-1/0,-1/0);$n(this,e),this.isBox3=!0,this.min=t,this.max=n}return Jn(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromArray",value:function(e){for(var t=1/0,n=1/0,r=1/0,a=-1/0,i=-1/0,o=-1/0,s=0,u=e.length;s<u;s+=3){var c=e[s],l=e[s+1],h=e[s+2];c<t&&(t=c),l<n&&(n=l),h<r&&(r=h),c>a&&(a=c),l>i&&(i=l),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(a,i,o),this}},{key:"setFromBufferAttribute",value:function(e){for(var t=1/0,n=1/0,r=1/0,a=-1/0,i=-1/0,o=-1/0,s=0,u=e.count;s<u;s++){var c=e.getX(s),l=e.getY(s),h=e.getZ(s);c<t&&(t=c),l<n&&(n=l),h<r&&(r=h),c>a&&(a=c),l>i&&(i=l),h>o&&(o=h)}return this.min.set(t,n,r),this.max.set(a,i,o),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=ewe.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"setFromObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return this.makeEmpty(),this.expandByObject(e,t)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"expandByObject",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];e.updateWorldMatrix(!1,!1);var n=e.geometry;if(void 0!==n)if(t&&void 0!=n.attributes&&void 0!==n.attributes.position)for(var r=n.attributes.position,a=0,i=r.count;a<i;a++)ewe.fromBufferAttribute(r,a).applyMatrix4(e.matrixWorld),this.expandByPoint(ewe);else null===n.boundingBox&&n.computeBoundingBox(),twe.copy(n.boundingBox),twe.applyMatrix4(e.matrixWorld),this.union(twe);for(var o=e.children,s=0,u=o.length;s<u;s++)this.expandByObject(o[s],t);return this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)}},{key:"intersectsSphere",value:function(e){return this.clampPoint(e.center,ewe),ewe.distanceToSquared(e.center)<=e.radius*e.radius}},{key:"intersectsPlane",value:function(e){var t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}},{key:"intersectsTriangle",value:function(e){if(this.isEmpty())return!1;this.getCenter(uwe),cwe.subVectors(this.max,uwe),nwe.subVectors(e.a,uwe),rwe.subVectors(e.b,uwe),awe.subVectors(e.c,uwe),iwe.subVectors(rwe,nwe),owe.subVectors(awe,rwe),swe.subVectors(nwe,awe);var t=[0,-iwe.z,iwe.y,0,-owe.z,owe.y,0,-swe.z,swe.y,iwe.z,0,-iwe.x,owe.z,0,-owe.x,swe.z,0,-swe.x,-iwe.y,iwe.x,0,-owe.y,owe.x,0,-swe.y,swe.x,0];return!!fwe(t,nwe,rwe,awe,cwe)&&(!!fwe(t=[1,0,0,0,1,0,0,0,1],nwe,rwe,awe,cwe)&&(lwe.crossVectors(iwe,owe),fwe(t=[lwe.x,lwe.y,lwe.z],nwe,rwe,awe,cwe)))}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return ewe.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"getBoundingSphere",value:function(e){return this.getCenter(e.center),e.radius=.5*this.getSize(ewe).length(),e}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"applyMatrix4",value:function(e){return this.isEmpty()||($ke[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),$ke[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),$ke[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),$ke[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),$ke[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),$ke[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),$ke[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),$ke[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints($ke)),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),$ke=[new Yke,new Yke,new Yke,new Yke,new Yke,new Yke,new Yke,new Yke],ewe=new Yke,twe=new Jke,nwe=new Yke,rwe=new Yke,awe=new Yke,iwe=new Yke,owe=new Yke,swe=new Yke,uwe=new Yke,cwe=new Yke,lwe=new Yke,hwe=new Yke;function fwe(e,t,n,r,a){for(var i=0,o=e.length-3;i<=o;i+=3){hwe.fromArray(e,i);var s=a.x*Math.abs(hwe.x)+a.y*Math.abs(hwe.y)+a.z*Math.abs(hwe.z),u=t.dot(hwe),c=n.dot(hwe),l=r.dot(hwe);if(Math.max(-Math.max(u,c,l),Math.min(u,c,l))>s)return!1}return!0}var dwe=new Jke,pwe=new Yke,vwe=new Yke,mwe=new Yke,gwe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yke,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1;$n(this,e),this.center=t,this.radius=n}return Jn(e,[{key:"set",value:function(e,t){return this.center.copy(e),this.radius=t,this}},{key:"setFromPoints",value:function(e,t){var n=this.center;void 0!==t?n.copy(t):dwe.setFromPoints(e).getCenter(n);for(var r=0,a=0,i=e.length;a<i;a++)r=Math.max(r,n.distanceToSquared(e[a]));return this.radius=Math.sqrt(r),this}},{key:"copy",value:function(e){return this.center.copy(e.center),this.radius=e.radius,this}},{key:"isEmpty",value:function(){return this.radius<0}},{key:"makeEmpty",value:function(){return this.center.set(0,0,0),this.radius=-1,this}},{key:"containsPoint",value:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}},{key:"distanceToPoint",value:function(e){return e.distanceTo(this.center)-this.radius}},{key:"intersectsSphere",value:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}},{key:"intersectsBox",value:function(e){return e.intersectsSphere(this)}},{key:"intersectsPlane",value:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}},{key:"clampPoint",value:function(e,t){var n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}},{key:"getBoundingBox",value:function(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}},{key:"applyMatrix4",value:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}},{key:"translate",value:function(e){return this.center.add(e),this}},{key:"expandByPoint",value:function(e){mwe.subVectors(e,this.center);var t=mwe.lengthSq();if(t>this.radius*this.radius){var n=Math.sqrt(t),r=.5*(n-this.radius);this.center.add(mwe.multiplyScalar(r/n)),this.radius+=r}return this}},{key:"union",value:function(e){return!0===this.center.equals(e.center)?vwe.set(0,0,1).multiplyScalar(e.radius):vwe.subVectors(e.center,this.center).normalize().multiplyScalar(e.radius),this.expandByPoint(pwe.copy(e.center).add(vwe)),this.expandByPoint(pwe.copy(e.center).sub(vwe)),this}},{key:"equals",value:function(e){return e.center.equals(this.center)&&e.radius===this.radius}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),ywe=new Yke,bwe=new Yke,xwe=new Yke,kwe=new Yke,wwe=new Yke,_we=new Yke,Swe=new Yke,Cwe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yke,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yke(0,0,-1);$n(this,e),this.origin=t,this.direction=n}return Jn(e,[{key:"set",value:function(e,t){return this.origin.copy(e),this.direction.copy(t),this}},{key:"copy",value:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}},{key:"at",value:function(e,t){return t.copy(this.direction).multiplyScalar(e).add(this.origin)}},{key:"lookAt",value:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this}},{key:"recast",value:function(e){return this.origin.copy(this.at(e,ywe)),this}},{key:"closestPointToPoint",value:function(e,t){t.subVectors(e,this.origin);var n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(n).add(this.origin)}},{key:"distanceToPoint",value:function(e){return Math.sqrt(this.distanceSqToPoint(e))}},{key:"distanceSqToPoint",value:function(e){var t=ywe.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(ywe.copy(this.direction).multiplyScalar(t).add(this.origin),ywe.distanceToSquared(e))}},{key:"distanceSqToSegment",value:function(e,t,n,r){bwe.copy(e).add(t).multiplyScalar(.5),xwe.copy(t).sub(e).normalize(),kwe.copy(this.origin).sub(bwe);var a,i,o,s,u=.5*e.distanceTo(t),c=-this.direction.dot(xwe),l=kwe.dot(this.direction),h=-kwe.dot(xwe),f=kwe.lengthSq(),d=Math.abs(1-c*c);if(d>0)if(i=c*l-h,s=u*d,(a=c*h-l)>=0)if(i>=-s)if(i<=s){var p=1/d;o=(a*=p)*(a+c*(i*=p)+2*l)+i*(c*a+i+2*h)+f}else i=u,o=-(a=Math.max(0,-(c*i+l)))*a+i*(i+2*h)+f;else i=-u,o=-(a=Math.max(0,-(c*i+l)))*a+i*(i+2*h)+f;else i<=-s?o=-(a=Math.max(0,-(-c*u+l)))*a+(i=a>0?-u:Math.min(Math.max(-u,-h),u))*(i+2*h)+f:i<=s?(a=0,o=(i=Math.min(Math.max(-u,-h),u))*(i+2*h)+f):o=-(a=Math.max(0,-(c*u+l)))*a+(i=a>0?u:Math.min(Math.max(-u,-h),u))*(i+2*h)+f;else i=c>0?-u:u,o=-(a=Math.max(0,-(c*i+l)))*a+i*(i+2*h)+f;return n&&n.copy(this.direction).multiplyScalar(a).add(this.origin),r&&r.copy(xwe).multiplyScalar(i).add(bwe),o}},{key:"intersectSphere",value:function(e,t){ywe.subVectors(e.center,this.origin);var n=ywe.dot(this.direction),r=ywe.dot(ywe)-n*n,a=e.radius*e.radius;if(r>a)return null;var i=Math.sqrt(a-r),o=n-i,s=n+i;return o<0&&s<0?null:o<0?this.at(s,t):this.at(o,t)}},{key:"intersectsSphere",value:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}},{key:"distanceToPlane",value:function(e){var t=e.normal.dot(this.direction);if(0===t)return 0===e.distanceToPoint(this.origin)?0:null;var n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}},{key:"intersectPlane",value:function(e,t){var n=this.distanceToPlane(e);return null===n?null:this.at(n,t)}},{key:"intersectsPlane",value:function(e){var t=e.distanceToPoint(this.origin);return 0===t||e.normal.dot(this.direction)*t<0}},{key:"intersectBox",value:function(e,t){var n,r,a,i,o,s,u=1/this.direction.x,c=1/this.direction.y,l=1/this.direction.z,h=this.origin;return u>=0?(n=(e.min.x-h.x)*u,r=(e.max.x-h.x)*u):(n=(e.max.x-h.x)*u,r=(e.min.x-h.x)*u),c>=0?(a=(e.min.y-h.y)*c,i=(e.max.y-h.y)*c):(a=(e.max.y-h.y)*c,i=(e.min.y-h.y)*c),n>i||a>r?null:((a>n||n!==n)&&(n=a),(i<r||r!==r)&&(r=i),l>=0?(o=(e.min.z-h.z)*l,s=(e.max.z-h.z)*l):(o=(e.max.z-h.z)*l,s=(e.min.z-h.z)*l),n>s||o>r?null:((o>n||n!==n)&&(n=o),(s<r||r!==r)&&(r=s),r<0?null:this.at(n>=0?n:r,t)))}},{key:"intersectsBox",value:function(e){return null!==this.intersectBox(e,ywe)}},{key:"intersectTriangle",value:function(e,t,n,r,a){wwe.subVectors(t,e),_we.subVectors(n,e),Swe.crossVectors(wwe,_we);var i,o=this.direction.dot(Swe);if(o>0){if(r)return null;i=1}else{if(!(o<0))return null;i=-1,o=-o}kwe.subVectors(this.origin,e);var s=i*this.direction.dot(_we.crossVectors(kwe,_we));if(s<0)return null;var u=i*this.direction.dot(wwe.cross(kwe));if(u<0)return null;if(s+u>o)return null;var c=-i*kwe.dot(Swe);return c<0?null:this.at(c/o,a)}},{key:"applyMatrix4",value:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}},{key:"equals",value:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),Twe=function(){function e(){$n(this,e),e.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],arguments.length>0&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}return Jn(e,[{key:"set",value:function(e,t,n,r,a,i,o,s,u,c,l,h,f,d,p,v){var m=this.elements;return m[0]=e,m[4]=t,m[8]=n,m[12]=r,m[1]=a,m[5]=i,m[9]=o,m[13]=s,m[2]=u,m[6]=c,m[10]=l,m[14]=h,m[3]=f,m[7]=d,m[11]=p,m[15]=v,this}},{key:"identity",value:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}},{key:"clone",value:function(){return(new e).fromArray(this.elements)}},{key:"copy",value:function(e){var t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}},{key:"copyPosition",value:function(e){var t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}},{key:"setFromMatrix3",value:function(e){var t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}},{key:"extractBasis",value:function(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}},{key:"makeBasis",value:function(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}},{key:"extractRotation",value:function(e){var t=this.elements,n=e.elements,r=1/Ewe.setFromMatrixColumn(e,0).length(),a=1/Ewe.setFromMatrixColumn(e,1).length(),i=1/Ewe.setFromMatrixColumn(e,2).length();return t[0]=n[0]*r,t[1]=n[1]*r,t[2]=n[2]*r,t[3]=0,t[4]=n[4]*a,t[5]=n[5]*a,t[6]=n[6]*a,t[7]=0,t[8]=n[8]*i,t[9]=n[9]*i,t[10]=n[10]*i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromEuler",value:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,n=e.x,r=e.y,a=e.z,i=Math.cos(n),o=Math.sin(n),s=Math.cos(r),u=Math.sin(r),c=Math.cos(a),l=Math.sin(a);if("XYZ"===e.order){var h=i*c,f=i*l,d=o*c,p=o*l;t[0]=s*c,t[4]=-s*l,t[8]=u,t[1]=f+d*u,t[5]=h-p*u,t[9]=-o*s,t[2]=p-h*u,t[6]=d+f*u,t[10]=i*s}else if("YXZ"===e.order){var v=s*c,m=s*l,g=u*c,y=u*l;t[0]=v+y*o,t[4]=g*o-m,t[8]=i*u,t[1]=i*l,t[5]=i*c,t[9]=-o,t[2]=m*o-g,t[6]=y+v*o,t[10]=i*s}else if("ZXY"===e.order){var b=s*c,x=s*l,k=u*c,w=u*l;t[0]=b-w*o,t[4]=-i*l,t[8]=k+x*o,t[1]=x+k*o,t[5]=i*c,t[9]=w-b*o,t[2]=-i*u,t[6]=o,t[10]=i*s}else if("ZYX"===e.order){var _=i*c,S=i*l,C=o*c,T=o*l;t[0]=s*c,t[4]=C*u-S,t[8]=_*u+T,t[1]=s*l,t[5]=T*u+_,t[9]=S*u-C,t[2]=-u,t[6]=o*s,t[10]=i*s}else if("YZX"===e.order){var E=i*s,I=i*u,A=o*s,M=o*u;t[0]=s*c,t[4]=M-E*l,t[8]=A*l+I,t[1]=l,t[5]=i*c,t[9]=-o*c,t[2]=-u*c,t[6]=I*l+A,t[10]=E-M*l}else if("XZY"===e.order){var N=i*s,R=i*u,D=o*s,P=o*u;t[0]=s*c,t[4]=-l,t[8]=u*c,t[1]=N*l+P,t[5]=i*c,t[9]=R*l-D,t[2]=D*l-R,t[6]=o*c,t[10]=P*l+N}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}},{key:"makeRotationFromQuaternion",value:function(e){return this.compose(Awe,e,Mwe)}},{key:"lookAt",value:function(e,t,n){var r=this.elements;return Dwe.subVectors(e,t),0===Dwe.lengthSq()&&(Dwe.z=1),Dwe.normalize(),Nwe.crossVectors(n,Dwe),0===Nwe.lengthSq()&&(1===Math.abs(n.z)?Dwe.x+=1e-4:Dwe.z+=1e-4,Dwe.normalize(),Nwe.crossVectors(n,Dwe)),Nwe.normalize(),Rwe.crossVectors(Dwe,Nwe),r[0]=Nwe.x,r[4]=Rwe.x,r[8]=Dwe.x,r[1]=Nwe.y,r[5]=Rwe.y,r[9]=Dwe.y,r[2]=Nwe.z,r[6]=Rwe.z,r[10]=Dwe.z,this}},{key:"multiply",value:function(e,t){return void 0!==t?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)}},{key:"premultiply",value:function(e){return this.multiplyMatrices(e,this)}},{key:"multiplyMatrices",value:function(e,t){var n=e.elements,r=t.elements,a=this.elements,i=n[0],o=n[4],s=n[8],u=n[12],c=n[1],l=n[5],h=n[9],f=n[13],d=n[2],p=n[6],v=n[10],m=n[14],g=n[3],y=n[7],b=n[11],x=n[15],k=r[0],w=r[4],_=r[8],S=r[12],C=r[1],T=r[5],E=r[9],I=r[13],A=r[2],M=r[6],N=r[10],R=r[14],D=r[3],P=r[7],O=r[11],L=r[15];return a[0]=i*k+o*C+s*A+u*D,a[4]=i*w+o*T+s*M+u*P,a[8]=i*_+o*E+s*N+u*O,a[12]=i*S+o*I+s*R+u*L,a[1]=c*k+l*C+h*A+f*D,a[5]=c*w+l*T+h*M+f*P,a[9]=c*_+l*E+h*N+f*O,a[13]=c*S+l*I+h*R+f*L,a[2]=d*k+p*C+v*A+m*D,a[6]=d*w+p*T+v*M+m*P,a[10]=d*_+p*E+v*N+m*O,a[14]=d*S+p*I+v*R+m*L,a[3]=g*k+y*C+b*A+x*D,a[7]=g*w+y*T+b*M+x*P,a[11]=g*_+y*E+b*N+x*O,a[15]=g*S+y*I+b*R+x*L,this}},{key:"multiplyScalar",value:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}},{key:"determinant",value:function(){var e=this.elements,t=e[0],n=e[4],r=e[8],a=e[12],i=e[1],o=e[5],s=e[9],u=e[13],c=e[2],l=e[6],h=e[10],f=e[14];return e[3]*(+a*s*l-r*u*l-a*o*h+n*u*h+r*o*f-n*s*f)+e[7]*(+t*s*f-t*u*h+a*i*h-r*i*f+r*u*c-a*s*c)+e[11]*(+t*u*l-t*o*f-a*i*l+n*i*f+a*o*c-n*u*c)+e[15]*(-r*o*c-t*s*l+t*o*h+r*i*l-n*i*h+n*s*c)}},{key:"transpose",value:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}},{key:"setPosition",value:function(e,t,n){var r=this.elements;return e.isVector3?(r[12]=e.x,r[13]=e.y,r[14]=e.z):(r[12]=e,r[13]=t,r[14]=n),this}},{key:"invert",value:function(){var e=this.elements,t=e[0],n=e[1],r=e[2],a=e[3],i=e[4],o=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],f=e[11],d=e[12],p=e[13],v=e[14],m=e[15],g=l*v*u-p*h*u+p*s*f-o*v*f-l*s*m+o*h*m,y=d*h*u-c*v*u-d*s*f+i*v*f+c*s*m-i*h*m,b=c*p*u-d*l*u+d*o*f-i*p*f-c*o*m+i*l*m,x=d*l*s-c*p*s-d*o*h+i*p*h+c*o*v-i*l*v,k=t*g+n*y+r*b+a*x;if(0===k)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);var w=1/k;return e[0]=g*w,e[1]=(p*h*a-l*v*a-p*r*f+n*v*f+l*r*m-n*h*m)*w,e[2]=(o*v*a-p*s*a+p*r*u-n*v*u-o*r*m+n*s*m)*w,e[3]=(l*s*a-o*h*a-l*r*u+n*h*u+o*r*f-n*s*f)*w,e[4]=y*w,e[5]=(c*v*a-d*h*a+d*r*f-t*v*f-c*r*m+t*h*m)*w,e[6]=(d*s*a-i*v*a-d*r*u+t*v*u+i*r*m-t*s*m)*w,e[7]=(i*h*a-c*s*a+c*r*u-t*h*u-i*r*f+t*s*f)*w,e[8]=b*w,e[9]=(d*l*a-c*p*a-d*n*f+t*p*f+c*n*m-t*l*m)*w,e[10]=(i*p*a-d*o*a+d*n*u-t*p*u-i*n*m+t*o*m)*w,e[11]=(c*o*a-i*l*a-c*n*u+t*l*u+i*n*f-t*o*f)*w,e[12]=x*w,e[13]=(c*p*r-d*l*r+d*n*h-t*p*h-c*n*v+t*l*v)*w,e[14]=(d*o*r-i*p*r-d*n*s+t*p*s+i*n*v-t*o*v)*w,e[15]=(i*l*r-c*o*r+c*n*s-t*l*s-i*n*h+t*o*h)*w,this}},{key:"scale",value:function(e){var t=this.elements,n=e.x,r=e.y,a=e.z;return t[0]*=n,t[4]*=r,t[8]*=a,t[1]*=n,t[5]*=r,t[9]*=a,t[2]*=n,t[6]*=r,t[10]*=a,t[3]*=n,t[7]*=r,t[11]*=a,this}},{key:"getMaxScaleOnAxis",value:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],r=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,r))}},{key:"makeTranslation",value:function(e,t,n){return this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}},{key:"makeRotationX",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}},{key:"makeRotationY",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}},{key:"makeRotationZ",value:function(e){var t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}},{key:"makeRotationAxis",value:function(e,t){var n=Math.cos(t),r=Math.sin(t),a=1-n,i=e.x,o=e.y,s=e.z,u=a*i,c=a*o;return this.set(u*i+n,u*o-r*s,u*s+r*o,0,u*o+r*s,c*o+n,c*s-r*i,0,u*s-r*o,c*s+r*i,a*s*s+n,0,0,0,0,1),this}},{key:"makeScale",value:function(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}},{key:"makeShear",value:function(e,t,n,r,a,i){return this.set(1,n,a,0,e,1,i,0,t,r,1,0,0,0,0,1),this}},{key:"compose",value:function(e,t,n){var r=this.elements,a=t._x,i=t._y,o=t._z,s=t._w,u=a+a,c=i+i,l=o+o,h=a*u,f=a*c,d=a*l,p=i*c,v=i*l,m=o*l,g=s*u,y=s*c,b=s*l,x=n.x,k=n.y,w=n.z;return r[0]=(1-(p+m))*x,r[1]=(f+b)*x,r[2]=(d-y)*x,r[3]=0,r[4]=(f-b)*k,r[5]=(1-(h+m))*k,r[6]=(v+g)*k,r[7]=0,r[8]=(d+y)*w,r[9]=(v-g)*w,r[10]=(1-(h+p))*w,r[11]=0,r[12]=e.x,r[13]=e.y,r[14]=e.z,r[15]=1,this}},{key:"decompose",value:function(e,t,n){var r=this.elements,a=Ewe.set(r[0],r[1],r[2]).length(),i=Ewe.set(r[4],r[5],r[6]).length(),o=Ewe.set(r[8],r[9],r[10]).length();this.determinant()<0&&(a=-a),e.x=r[12],e.y=r[13],e.z=r[14],Iwe.copy(this);var s=1/a,u=1/i,c=1/o;return Iwe.elements[0]*=s,Iwe.elements[1]*=s,Iwe.elements[2]*=s,Iwe.elements[4]*=u,Iwe.elements[5]*=u,Iwe.elements[6]*=u,Iwe.elements[8]*=c,Iwe.elements[9]*=c,Iwe.elements[10]*=c,t.setFromRotationMatrix(Iwe),n.x=a,n.y=i,n.z=o,this}},{key:"makePerspective",value:function(e,t,n,r,a,i){void 0===i&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var o=this.elements,s=2*a/(t-e),u=2*a/(n-r),c=(t+e)/(t-e),l=(n+r)/(n-r),h=-(i+a)/(i-a),f=-2*i*a/(i-a);return o[0]=s,o[4]=0,o[8]=c,o[12]=0,o[1]=0,o[5]=u,o[9]=l,o[13]=0,o[2]=0,o[6]=0,o[10]=h,o[14]=f,o[3]=0,o[7]=0,o[11]=-1,o[15]=0,this}},{key:"makeOrthographic",value:function(e,t,n,r,a,i){var o=this.elements,s=1/(t-e),u=1/(n-r),c=1/(i-a),l=(t+e)*s,h=(n+r)*u,f=(i+a)*c;return o[0]=2*s,o[4]=0,o[8]=0,o[12]=-l,o[1]=0,o[5]=2*u,o[9]=0,o[13]=-h,o[2]=0,o[6]=0,o[10]=-2*c,o[14]=-f,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this}},{key:"equals",value:function(e){for(var t=this.elements,n=e.elements,r=0;r<16;r++)if(t[r]!==n[r])return!1;return!0}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=0;n<16;n++)this.elements[n]=e[n+t];return this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}]),e}(),Ewe=new Yke,Iwe=new Twe,Awe=new Yke(0,0,0),Mwe=new Yke(1,1,1),Nwe=new Yke,Rwe=new Yke,Dwe=new Yke,Pwe=new Twe,Owe=new Kke,Lwe=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:t.DefaultOrder;$n(this,t),this.isEuler=!0,this._x=e,this._y=n,this._z=r,this._order=a}return Jn(t,[{key:"x",get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},{key:"y",get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},{key:"z",get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},{key:"order",get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}},{key:"set",value:function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this._order;return this._x=e,this._y=t,this._z=n,this._order=r,this._onChangeCallback(),this}},{key:"clone",value:function(){return new this.constructor(this._x,this._y,this._z,this._order)}},{key:"copy",value:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}},{key:"setFromRotationMatrix",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=e.elements,a=r[0],i=r[4],o=r[8],s=r[1],u=r[5],c=r[9],l=r[2],h=r[6],f=r[10];switch(t){case"XYZ":this._y=Math.asin(hke(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-i,a)):(this._x=Math.atan2(h,u),this._z=0);break;case"YXZ":this._x=Math.asin(-hke(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(s,u)):(this._y=Math.atan2(-l,a),this._z=0);break;case"ZXY":this._x=Math.asin(hke(h,-1,1)),Math.abs(h)<.9999999?(this._y=Math.atan2(-l,f),this._z=Math.atan2(-i,u)):(this._y=0,this._z=Math.atan2(s,a));break;case"ZYX":this._y=Math.asin(-hke(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(h,f),this._z=Math.atan2(s,a)):(this._x=0,this._z=Math.atan2(-i,u));break;case"YZX":this._z=Math.asin(hke(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-l,a)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-hke(i,-1,1)),Math.abs(i)<.9999999?(this._x=Math.atan2(h,u),this._y=Math.atan2(o,a)):(this._x=Math.atan2(-c,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,!0===n&&this._onChangeCallback(),this}},{key:"setFromQuaternion",value:function(e,t,n){return Pwe.makeRotationFromQuaternion(e),this.setFromRotationMatrix(Pwe,t,n)}},{key:"setFromVector3",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._order;return this.set(e.x,e.y,e.z,t)}},{key:"reorder",value:function(e){return Owe.setFromEuler(this),this.setFromQuaternion(Owe,e)}},{key:"equals",value:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}},{key:"fromArray",value:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],void 0!==e[3]&&(this._order=e[3]),this._onChangeCallback(),this}},{key:"toArray",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}},{key:"_onChange",value:function(e){return this._onChangeCallback=e,this}},{key:"_onChangeCallback",value:function(){}},{key:Symbol.iterator,value:es().mark((function e(){return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._x;case 2:return e.next=4,this._y;case 4:return e.next=6,this._z;case 6:return e.next=8,this._order;case 8:case"end":return e.stop()}}),e,this)}))},{key:"toVector3",value:function(){console.error("THREE.Euler: .toVector3() has been removed. Use Vector3.setFromEuler() instead")}}]),t}();Lwe.DefaultOrder="XYZ",Lwe.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"];var Fwe=function(){function e(){$n(this,e),this.mask=1}return Jn(e,[{key:"set",value:function(e){this.mask=(1<<e|0)>>>0}},{key:"enable",value:function(e){this.mask|=1<<e|0}},{key:"enableAll",value:function(){this.mask=-1}},{key:"toggle",value:function(e){this.mask^=1<<e|0}},{key:"disable",value:function(e){this.mask&=~(1<<e|0)}},{key:"disableAll",value:function(){this.mask=0}},{key:"test",value:function(e){return 0!==(this.mask&e.mask)}},{key:"isEnabled",value:function(e){return 0!==(this.mask&(1<<e|0))}}]),e}(),zwe=0,Bwe=new Yke,Uwe=new Kke,Vwe=new Twe,Wwe=new Yke,Gwe=new Yke,jwe=new Yke,qwe=new Kke,Hwe=new Yke(1,0,0),Xwe=new Yke(0,1,0),Kwe=new Yke(0,0,1),Ywe={type:"added"},Qwe={type:"removed"},Zwe=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n),(e=t.call(this)).isObject3D=!0,Object.defineProperty(ir(e),"id",{value:zwe++}),e.uuid=lke(),e.name="",e.type="Object3D",e.parent=null,e.children=[],e.up=n.DefaultUp.clone();var r=new Yke,a=new Lwe,i=new Kke,o=new Yke(1,1,1);return a._onChange((function(){i.setFromEuler(a,!1)})),i._onChange((function(){a.setFromQuaternion(i,void 0,!1)})),Object.defineProperties(ir(e),{position:{configurable:!0,enumerable:!0,value:r},rotation:{configurable:!0,enumerable:!0,value:a},quaternion:{configurable:!0,enumerable:!0,value:i},scale:{configurable:!0,enumerable:!0,value:o},modelViewMatrix:{value:new Twe},normalMatrix:{value:new bke}}),e.matrix=new Twe,e.matrixWorld=new Twe,e.matrixAutoUpdate=n.DefaultMatrixAutoUpdate,e.matrixWorldNeedsUpdate=!1,e.layers=new Fwe,e.visible=!0,e.castShadow=!1,e.receiveShadow=!1,e.frustumCulled=!0,e.renderOrder=0,e.animations=[],e.userData={},e}return Jn(n,[{key:"onBeforeRender",value:function(){}},{key:"onAfterRender",value:function(){}},{key:"applyMatrix4",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}},{key:"applyQuaternion",value:function(e){return this.quaternion.premultiply(e),this}},{key:"setRotationFromAxisAngle",value:function(e,t){this.quaternion.setFromAxisAngle(e,t)}},{key:"setRotationFromEuler",value:function(e){this.quaternion.setFromEuler(e,!0)}},{key:"setRotationFromMatrix",value:function(e){this.quaternion.setFromRotationMatrix(e)}},{key:"setRotationFromQuaternion",value:function(e){this.quaternion.copy(e)}},{key:"rotateOnAxis",value:function(e,t){return Uwe.setFromAxisAngle(e,t),this.quaternion.multiply(Uwe),this}},{key:"rotateOnWorldAxis",value:function(e,t){return Uwe.setFromAxisAngle(e,t),this.quaternion.premultiply(Uwe),this}},{key:"rotateX",value:function(e){return this.rotateOnAxis(Hwe,e)}},{key:"rotateY",value:function(e){return this.rotateOnAxis(Xwe,e)}},{key:"rotateZ",value:function(e){return this.rotateOnAxis(Kwe,e)}},{key:"translateOnAxis",value:function(e,t){return Bwe.copy(e).applyQuaternion(this.quaternion),this.position.add(Bwe.multiplyScalar(t)),this}},{key:"translateX",value:function(e){return this.translateOnAxis(Hwe,e)}},{key:"translateY",value:function(e){return this.translateOnAxis(Xwe,e)}},{key:"translateZ",value:function(e){return this.translateOnAxis(Kwe,e)}},{key:"localToWorld",value:function(e){return e.applyMatrix4(this.matrixWorld)}},{key:"worldToLocal",value:function(e){return e.applyMatrix4(Vwe.copy(this.matrixWorld).invert())}},{key:"lookAt",value:function(e,t,n){e.isVector3?Wwe.copy(e):Wwe.set(e,t,n);var r=this.parent;this.updateWorldMatrix(!0,!1),Gwe.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Vwe.lookAt(Gwe,Wwe,this.up):Vwe.lookAt(Wwe,Gwe,this.up),this.quaternion.setFromRotationMatrix(Vwe),r&&(Vwe.extractRotation(r.matrixWorld),Uwe.setFromRotationMatrix(Vwe),this.quaternion.premultiply(Uwe.invert()))}},{key:"add",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(null!==e.parent&&e.parent.remove(e),e.parent=this,this.children.push(e),e.dispatchEvent(Ywe)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}},{key:"remove",value:function(e){if(arguments.length>1){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var n=this.children.indexOf(e);return-1!==n&&(e.parent=null,this.children.splice(n,1),e.dispatchEvent(Qwe)),this}},{key:"removeFromParent",value:function(){var e=this.parent;return null!==e&&e.remove(this),this}},{key:"clear",value:function(){for(var e=0;e<this.children.length;e++){var t=this.children[e];t.parent=null,t.dispatchEvent(Qwe)}return this.children.length=0,this}},{key:"attach",value:function(e){return this.updateWorldMatrix(!0,!1),Vwe.copy(this.matrixWorld).invert(),null!==e.parent&&(e.parent.updateWorldMatrix(!0,!1),Vwe.multiply(e.parent.matrixWorld)),e.applyMatrix4(Vwe),this.add(e),e.updateWorldMatrix(!1,!0),this}},{key:"getObjectById",value:function(e){return this.getObjectByProperty("id",e)}},{key:"getObjectByName",value:function(e){return this.getObjectByProperty("name",e)}},{key:"getObjectByProperty",value:function(e,t){if(this[e]===t)return this;for(var n=0,r=this.children.length;n<r;n++){var a=this.children[n].getObjectByProperty(e,t);if(void 0!==a)return a}}},{key:"getWorldPosition",value:function(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}},{key:"getWorldQuaternion",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Gwe,e,jwe),e}},{key:"getWorldScale",value:function(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Gwe,qwe,e),e}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}},{key:"raycast",value:function(){}},{key:"traverse",value:function(e){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverse(e)}},{key:"traverseVisible",value:function(e){if(!1!==this.visible){e(this);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].traverseVisible(e)}}},{key:"traverseAncestors",value:function(e){var t=this.parent;null!==t&&(e(t),t.traverseAncestors(e))}},{key:"updateMatrix",value:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}},{key:"updateMatrixWorld",value:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),this.matrixWorldNeedsUpdate=!1,e=!0);for(var t=this.children,n=0,r=t.length;n<r;n++)t[n].updateMatrixWorld(e)}},{key:"updateWorldMatrix",value:function(e,t){var n=this.parent;if(!0===e&&null!==n&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),null===this.parent?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),!0===t)for(var r=this.children,a=0,i=r.length;a<i;a++)r[a].updateWorldMatrix(!1,!0)}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e,n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var r={};function a(t,n){return void 0===t[n.uuid]&&(t[n.uuid]=n.toJSON(e)),n.uuid}if(r.uuid=this.uuid,r.type=this.type,""!==this.name&&(r.name=this.name),!0===this.castShadow&&(r.castShadow=!0),!0===this.receiveShadow&&(r.receiveShadow=!0),!1===this.visible&&(r.visible=!1),!1===this.frustumCulled&&(r.frustumCulled=!1),0!==this.renderOrder&&(r.renderOrder=this.renderOrder),"{}"!==JSON.stringify(this.userData)&&(r.userData=this.userData),r.layers=this.layers.mask,r.matrix=this.matrix.toArray(),!1===this.matrixAutoUpdate&&(r.matrixAutoUpdate=!1),this.isInstancedMesh&&(r.type="InstancedMesh",r.count=this.count,r.instanceMatrix=this.instanceMatrix.toJSON(),null!==this.instanceColor&&(r.instanceColor=this.instanceColor.toJSON())),this.isScene)this.background&&(this.background.isColor?r.background=this.background.toJSON():this.background.isTexture&&(r.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&(r.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){r.geometry=a(e.geometries,this.geometry);var i=this.geometry.parameters;if(void 0!==i&&void 0!==i.shapes){var o=i.shapes;if(Array.isArray(o))for(var s=0,u=o.length;s<u;s++){var c=o[s];a(e.shapes,c)}else a(e.shapes,o)}}if(this.isSkinnedMesh&&(r.bindMode=this.bindMode,r.bindMatrix=this.bindMatrix.toArray(),void 0!==this.skeleton&&(a(e.skeletons,this.skeleton),r.skeleton=this.skeleton.uuid)),void 0!==this.material)if(Array.isArray(this.material)){for(var l=[],h=0,f=this.material.length;h<f;h++)l.push(a(e.materials,this.material[h]));r.material=l}else r.material=a(e.materials,this.material);if(this.children.length>0){r.children=[];for(var d=0;d<this.children.length;d++)r.children.push(this.children[d].toJSON(e).object)}if(this.animations.length>0){r.animations=[];for(var p=0;p<this.animations.length;p++){var v=this.animations[p];r.animations.push(a(e.animations,v))}}if(t){var m=S(e.geometries),g=S(e.materials),y=S(e.textures),b=S(e.images),x=S(e.shapes),k=S(e.skeletons),w=S(e.animations),_=S(e.nodes);m.length>0&&(n.geometries=m),g.length>0&&(n.materials=g),y.length>0&&(n.textures=y),b.length>0&&(n.images=b),x.length>0&&(n.shapes=x),k.length>0&&(n.skeletons=k),w.length>0&&(n.animations=w),_.length>0&&(n.nodes=_)}return n.object=r,n;function S(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}}},{key:"clone",value:function(e){return(new this.constructor).copy(this,e)}},{key:"copy",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),!0===t)for(var n=0;n<e.children.length;n++){var r=e.children[n];this.add(r.clone())}return this}}]),n}(ike);Zwe.DefaultUp=new Yke(0,1,0),Zwe.DefaultMatrixAutoUpdate=!0;var Jwe=new Yke,$we=new Yke,e_e=new Yke,t_e=new Yke,n_e=new Yke,r_e=new Yke,a_e=new Yke,i_e=new Yke,o_e=new Yke,s_e=new Yke,u_e=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yke,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yke,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Yke;$n(this,e),this.a=t,this.b=n,this.c=r}return Jn(e,[{key:"set",value:function(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}},{key:"setFromPointsAndIndices",value:function(e,t,n,r){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[r]),this}},{key:"setFromAttributeAndIndices",value:function(e,t,n,r){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,r),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}},{key:"getArea",value:function(){return Jwe.subVectors(this.c,this.b),$we.subVectors(this.a,this.b),.5*Jwe.cross($we).length()}},{key:"getMidpoint",value:function(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}},{key:"getNormal",value:function(t){return e.getNormal(this.a,this.b,this.c,t)}},{key:"getPlane",value:function(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}},{key:"getBarycoord",value:function(t,n){return e.getBarycoord(t,this.a,this.b,this.c,n)}},{key:"getUV",value:function(t,n,r,a,i){return e.getUV(t,this.a,this.b,this.c,n,r,a,i)}},{key:"containsPoint",value:function(t){return e.containsPoint(t,this.a,this.b,this.c)}},{key:"isFrontFacing",value:function(t){return e.isFrontFacing(this.a,this.b,this.c,t)}},{key:"intersectsBox",value:function(e){return e.intersectsTriangle(this)}},{key:"closestPointToPoint",value:function(e,t){var n,r,a=this.a,i=this.b,o=this.c;n_e.subVectors(i,a),r_e.subVectors(o,a),i_e.subVectors(e,a);var s=n_e.dot(i_e),u=r_e.dot(i_e);if(s<=0&&u<=0)return t.copy(a);o_e.subVectors(e,i);var c=n_e.dot(o_e),l=r_e.dot(o_e);if(c>=0&&l<=c)return t.copy(i);var h=s*l-c*u;if(h<=0&&s>=0&&c<=0)return n=s/(s-c),t.copy(a).addScaledVector(n_e,n);s_e.subVectors(e,o);var f=n_e.dot(s_e),d=r_e.dot(s_e);if(d>=0&&f<=d)return t.copy(o);var p=f*u-s*d;if(p<=0&&u>=0&&d<=0)return r=u/(u-d),t.copy(a).addScaledVector(r_e,r);var v=c*d-f*l;if(v<=0&&l-c>=0&&f-d>=0)return a_e.subVectors(o,i),r=(l-c)/(l-c+(f-d)),t.copy(i).addScaledVector(a_e,r);var m=1/(v+p+h);return n=p*m,r=h*m,t.copy(a).addScaledVector(n_e,n).addScaledVector(r_e,r)}},{key:"equals",value:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}],[{key:"getNormal",value:function(e,t,n,r){r.subVectors(n,t),Jwe.subVectors(e,t),r.cross(Jwe);var a=r.lengthSq();return a>0?r.multiplyScalar(1/Math.sqrt(a)):r.set(0,0,0)}},{key:"getBarycoord",value:function(e,t,n,r,a){Jwe.subVectors(r,t),$we.subVectors(n,t),e_e.subVectors(e,t);var i=Jwe.dot(Jwe),o=Jwe.dot($we),s=Jwe.dot(e_e),u=$we.dot($we),c=$we.dot(e_e),l=i*u-o*o;if(0===l)return a.set(-2,-1,-1);var h=1/l,f=(u*s-o*c)*h,d=(i*c-o*s)*h;return a.set(1-f-d,d,f)}},{key:"containsPoint",value:function(e,t,n,r){return this.getBarycoord(e,t,n,r,t_e),t_e.x>=0&&t_e.y>=0&&t_e.x+t_e.y<=1}},{key:"getUV",value:function(e,t,n,r,a,i,o,s){return this.getBarycoord(e,t,n,r,t_e),s.set(0,0),s.addScaledVector(a,t_e.x),s.addScaledVector(i,t_e.y),s.addScaledVector(o,t_e.z),s}},{key:"isFrontFacing",value:function(e,t,n,r){return Jwe.subVectors(n,t),$we.subVectors(e,t),Jwe.cross($we).dot(r)<0}}]),e}(),c_e=0,l_e=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this)).isMaterial=!0,Object.defineProperty(ir(e),"id",{value:c_e++}),e.uuid=lke(),e.name="",e.type="Material",e.blending=lye,e.side=aye,e.vertexColors=!1,e.opacity=1,e.transparent=!1,e.blendSrc=Sye,e.blendDst=Cye,e.blendEquation=vye,e.blendSrcAlpha=null,e.blendDstAlpha=null,e.blendEquationAlpha=null,e.depthFunc=Pye,e.depthTest=!0,e.depthWrite=!0,e.stencilWriteMask=255,e.stencilFunc=Hxe,e.stencilRef=0,e.stencilFuncMask=255,e.stencilFail=Rxe,e.stencilZFail=Rxe,e.stencilZPass=Rxe,e.stencilWrite=!1,e.clippingPlanes=null,e.clipIntersection=!1,e.clipShadows=!1,e.shadowSide=null,e.colorWrite=!0,e.precision=null,e.polygonOffset=!1,e.polygonOffsetFactor=0,e.polygonOffsetUnits=0,e.dithering=!1,e.alphaToCoverage=!1,e.premultipliedAlpha=!1,e.visible=!0,e.toneMapped=!0,e.userData={},e.version=0,e._alphaTest=0,e}return Jn(n,[{key:"alphaTest",get:function(){return this._alphaTest},set:function(e){this._alphaTest>0!==e>0&&this.version++,this._alphaTest=e}},{key:"onBuild",value:function(){}},{key:"onBeforeRender",value:function(){}},{key:"onBeforeCompile",value:function(){}},{key:"customProgramCacheKey",value:function(){return this.onBeforeCompile.toString()}},{key:"setValues",value:function(e){if(void 0!==e)for(var t in e){var n=e[t];if(void 0!==n)if("shading"!==t){var r=this[t];void 0!==r?r&&r.isColor?r.set(n):r&&r.isVector3&&n&&n.isVector3?r.copy(n):this[t]=n:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=n===sye;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}}},{key:"toJSON",value:function(e){var t=void 0===e||"string"===typeof e;t&&(e={textures:{},images:{}});var n={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function r(e){var t=[];for(var n in e){var r=e[n];delete r.metadata,t.push(r)}return t}if(n.uuid=this.uuid,n.type=this.type,""!==this.name&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),void 0!==this.roughness&&(n.roughness=this.roughness),void 0!==this.metalness&&(n.metalness=this.metalness),void 0!==this.sheen&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),void 0!==this.sheenRoughness&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity&&1!==this.emissiveIntensity&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),void 0!==this.specularIntensity&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),void 0!==this.shininess&&(n.shininess=this.shininess),void 0!==this.clearcoat&&(n.clearcoat=this.clearcoat),void 0!==this.clearcoatRoughness&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),void 0!==this.iridescence&&(n.iridescence=this.iridescence),void 0!==this.iridescenceIOR&&(n.iridescenceIOR=this.iridescenceIOR),void 0!==this.iridescenceThicknessRange&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,void 0!==this.combine&&(n.combine=this.combine)),void 0!==this.envMapIntensity&&(n.envMapIntensity=this.envMapIntensity),void 0!==this.reflectivity&&(n.reflectivity=this.reflectivity),void 0!==this.refractionRatio&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),void 0!==this.transmission&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),void 0!==this.thickness&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),void 0!==this.attenuationDistance&&(n.attenuationDistance=this.attenuationDistance),void 0!==this.attenuationColor&&(n.attenuationColor=this.attenuationColor.getHex()),void 0!==this.size&&(n.size=this.size),null!==this.shadowSide&&(n.shadowSide=this.shadowSide),void 0!==this.sizeAttenuation&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==lye&&(n.blending=this.blending),this.side!==aye&&(n.side=this.side),this.vertexColors&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),!0===this.transparent&&(n.transparent=this.transparent),n.depthFunc=this.depthFunc,n.depthTest=this.depthTest,n.depthWrite=this.depthWrite,n.colorWrite=this.colorWrite,n.stencilWrite=this.stencilWrite,n.stencilWriteMask=this.stencilWriteMask,n.stencilFunc=this.stencilFunc,n.stencilRef=this.stencilRef,n.stencilFuncMask=this.stencilFuncMask,n.stencilFail=this.stencilFail,n.stencilZFail=this.stencilZFail,n.stencilZPass=this.stencilZPass,void 0!==this.rotation&&0!==this.rotation&&(n.rotation=this.rotation),!0===this.polygonOffset&&(n.polygonOffset=!0),0!==this.polygonOffsetFactor&&(n.polygonOffsetFactor=this.polygonOffsetFactor),0!==this.polygonOffsetUnits&&(n.polygonOffsetUnits=this.polygonOffsetUnits),void 0!==this.linewidth&&1!==this.linewidth&&(n.linewidth=this.linewidth),void 0!==this.dashSize&&(n.dashSize=this.dashSize),void 0!==this.gapSize&&(n.gapSize=this.gapSize),void 0!==this.scale&&(n.scale=this.scale),!0===this.dithering&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),!0===this.alphaToCoverage&&(n.alphaToCoverage=this.alphaToCoverage),!0===this.premultipliedAlpha&&(n.premultipliedAlpha=this.premultipliedAlpha),!0===this.wireframe&&(n.wireframe=this.wireframe),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),"round"!==this.wireframeLinecap&&(n.wireframeLinecap=this.wireframeLinecap),"round"!==this.wireframeLinejoin&&(n.wireframeLinejoin=this.wireframeLinejoin),!0===this.flatShading&&(n.flatShading=this.flatShading),!1===this.visible&&(n.visible=!1),!1===this.toneMapped&&(n.toneMapped=!1),!1===this.fog&&(n.fog=!1),"{}"!==JSON.stringify(this.userData)&&(n.userData=this.userData),t){var a=r(e.textures),i=r(e.images);a.length>0&&(n.textures=a),i.length>0&&(n.images=i)}return n}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,n=null;if(null!==t){var r=t.length;n=new Array(r);for(var a=0;a!==r;++a)n[a]=t[a].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}}]),n}(ike),h_e=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isMeshBasicMaterial=!0,r.type="MeshBasicMaterial",r.color=new Oke(16777215),r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=Bye,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.fog=!0,r.setValues(e),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),n}(l_e),f_e=new Yke,d_e=new yke,p_e=function(){function e(t,n,r){if($n(this,e),Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,this.name="",this.array=t,this.itemSize=n,this.count=void 0!==t?t.length/n:0,this.normalized=!0===r,this.usage=Xxe,this.updateRange={offset:0,count:-1},this.version=0}return Jn(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.itemSize,n*=t.itemSize;for(var r=0,a=this.itemSize;r<a;r++)this.array[e+r]=t.array[n+r];return this}},{key:"copyArray",value:function(e){return this.array.set(e),this}},{key:"copyColorsArray",value:function(e){for(var t=this.array,n=0,r=0,a=e.length;r<a;r++){var i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",r),i=new Oke),t[n++]=i.r,t[n++]=i.g,t[n++]=i.b}return this}},{key:"copyVector2sArray",value:function(e){for(var t=this.array,n=0,r=0,a=e.length;r<a;r++){var i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",r),i=new yke),t[n++]=i.x,t[n++]=i.y}return this}},{key:"copyVector3sArray",value:function(e){for(var t=this.array,n=0,r=0,a=e.length;r<a;r++){var i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",r),i=new Yke),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z}return this}},{key:"copyVector4sArray",value:function(e){for(var t=this.array,n=0,r=0,a=e.length;r<a;r++){var i=e[r];void 0===i&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",r),i=new Vke),t[n++]=i.x,t[n++]=i.y,t[n++]=i.z,t[n++]=i.w}return this}},{key:"applyMatrix3",value:function(e){if(2===this.itemSize)for(var t=0,n=this.count;t<n;t++)d_e.fromBufferAttribute(this,t),d_e.applyMatrix3(e),this.setXY(t,d_e.x,d_e.y);else if(3===this.itemSize)for(var r=0,a=this.count;r<a;r++)f_e.fromBufferAttribute(this,r),f_e.applyMatrix3(e),this.setXYZ(r,f_e.x,f_e.y,f_e.z);return this}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.count;t<n;t++)f_e.fromBufferAttribute(this,t),f_e.applyMatrix4(e),this.setXYZ(t,f_e.x,f_e.y,f_e.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)f_e.fromBufferAttribute(this,t),f_e.applyNormalMatrix(e),this.setXYZ(t,f_e.x,f_e.y,f_e.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)f_e.fromBufferAttribute(this,t),f_e.transformDirection(e),this.setXYZ(t,f_e.x,f_e.y,f_e.z);return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"getX",value:function(e){return this.array[e*this.itemSize]}},{key:"setX",value:function(e,t){return this.array[e*this.itemSize]=t,this}},{key:"getY",value:function(e){return this.array[e*this.itemSize+1]}},{key:"setY",value:function(e,t){return this.array[e*this.itemSize+1]=t,this}},{key:"getZ",value:function(e){return this.array[e*this.itemSize+2]}},{key:"setZ",value:function(e,t){return this.array[e*this.itemSize+2]=t,this}},{key:"getW",value:function(e){return this.array[e*this.itemSize+3]}},{key:"setW",value:function(e,t){return this.array[e*this.itemSize+3]=t,this}},{key:"setXY",value:function(e,t,n){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this}},{key:"setXYZW",value:function(e,t,n,r,a){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=r,this.array[e+3]=a,this}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"clone",value:function(){return new this.constructor(this.array,this.itemSize).copy(this)}},{key:"toJSON",value:function(){var e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return""!==this.name&&(e.name=this.name),this.usage!==Xxe&&(e.usage=this.usage),0===this.updateRange.offset&&-1===this.updateRange.count||(e.updateRange=this.updateRange),e}}]),e}(),v_e=function(e){tr(n,e);var t=sr(n);function n(e,r,a){return $n(this,n),t.call(this,new Int8Array(e),r,a)}return Jn(n)}(p_e),m_e=function(e){tr(n,e);var t=sr(n);function n(e,r,a){return $n(this,n),t.call(this,new Uint8Array(e),r,a)}return Jn(n)}(p_e),g_e=function(e){tr(n,e);var t=sr(n);function n(e,r,a){return $n(this,n),t.call(this,new Uint8ClampedArray(e),r,a)}return Jn(n)}(p_e),y_e=function(e){tr(n,e);var t=sr(n);function n(e,r,a){return $n(this,n),t.call(this,new Int16Array(e),r,a)}return Jn(n)}(p_e),b_e=function(e){tr(n,e);var t=sr(n);function n(e,r,a){return $n(this,n),t.call(this,new Uint16Array(e),r,a)}return Jn(n)}(p_e),x_e=function(e){tr(n,e);var t=sr(n);function n(e,r,a){return $n(this,n),t.call(this,new Int32Array(e),r,a)}return Jn(n)}(p_e),k_e=function(e){tr(n,e);var t=sr(n);function n(e,r,a){return $n(this,n),t.call(this,new Uint32Array(e),r,a)}return Jn(n)}(p_e),w_e=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;return $n(this,n),(i=t.call(this,new Uint16Array(e),r,a)).isFloat16BufferAttribute=!0,i}return Jn(n)}(p_e),__e=function(e){tr(n,e);var t=sr(n);function n(e,r,a){return $n(this,n),t.call(this,new Float32Array(e),r,a)}return Jn(n)}(p_e),S_e=function(e){tr(n,e);var t=sr(n);function n(e,r,a){return $n(this,n),t.call(this,new Float64Array(e),r,a)}return Jn(n)}(p_e),C_e=0,T_e=new Twe,E_e=new Zwe,I_e=new Yke,A_e=new Jke,M_e=new Jke,N_e=new Yke,R_e=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this)).isBufferGeometry=!0,Object.defineProperty(ir(e),"id",{value:C_e++}),e.uuid=lke(),e.name="",e.type="BufferGeometry",e.index=null,e.attributes={},e.morphAttributes={},e.morphTargetsRelative=!1,e.groups=[],e.boundingBox=null,e.boundingSphere=null,e.drawRange={start:0,count:1/0},e.userData={},e}return Jn(n,[{key:"getIndex",value:function(){return this.index}},{key:"setIndex",value:function(e){return Array.isArray(e)?this.index=new(xke(e)?k_e:b_e)(e,1):this.index=e,this}},{key:"getAttribute",value:function(e){return this.attributes[e]}},{key:"setAttribute",value:function(e,t){return this.attributes[e]=t,this}},{key:"deleteAttribute",value:function(e){return delete this.attributes[e],this}},{key:"hasAttribute",value:function(e){return void 0!==this.attributes[e]}},{key:"addGroup",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.groups.push({start:e,count:t,materialIndex:n})}},{key:"clearGroups",value:function(){this.groups=[]}},{key:"setDrawRange",value:function(e,t){this.drawRange.start=e,this.drawRange.count=t}},{key:"applyMatrix4",value:function(e){var t=this.attributes.position;void 0!==t&&(t.applyMatrix4(e),t.needsUpdate=!0);var n=this.attributes.normal;if(void 0!==n){var r=(new bke).getNormalMatrix(e);n.applyNormalMatrix(r),n.needsUpdate=!0}var a=this.attributes.tangent;return void 0!==a&&(a.transformDirection(e),a.needsUpdate=!0),null!==this.boundingBox&&this.computeBoundingBox(),null!==this.boundingSphere&&this.computeBoundingSphere(),this}},{key:"applyQuaternion",value:function(e){return T_e.makeRotationFromQuaternion(e),this.applyMatrix4(T_e),this}},{key:"rotateX",value:function(e){return T_e.makeRotationX(e),this.applyMatrix4(T_e),this}},{key:"rotateY",value:function(e){return T_e.makeRotationY(e),this.applyMatrix4(T_e),this}},{key:"rotateZ",value:function(e){return T_e.makeRotationZ(e),this.applyMatrix4(T_e),this}},{key:"translate",value:function(e,t,n){return T_e.makeTranslation(e,t,n),this.applyMatrix4(T_e),this}},{key:"scale",value:function(e,t,n){return T_e.makeScale(e,t,n),this.applyMatrix4(T_e),this}},{key:"lookAt",value:function(e){return E_e.lookAt(e),E_e.updateMatrix(),this.applyMatrix4(E_e.matrix),this}},{key:"center",value:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(I_e).negate(),this.translate(I_e.x,I_e.y,I_e.z),this}},{key:"setFromPoints",value:function(e){for(var t=[],n=0,r=e.length;n<r;n++){var a=e[n];t.push(a.x,a.y,a.z||0)}return this.setAttribute("position",new __e(t,3)),this}},{key:"computeBoundingBox",value:function(){null===this.boundingBox&&(this.boundingBox=new Jke);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingBox.set(new Yke(-1/0,-1/0,-1/0),new Yke(1/0,1/0,1/0));if(void 0!==e){if(this.boundingBox.setFromBufferAttribute(e),t)for(var n=0,r=t.length;n<r;n++){var a=t[n];A_e.setFromBufferAttribute(a),this.morphTargetsRelative?(N_e.addVectors(this.boundingBox.min,A_e.min),this.boundingBox.expandByPoint(N_e),N_e.addVectors(this.boundingBox.max,A_e.max),this.boundingBox.expandByPoint(N_e)):(this.boundingBox.expandByPoint(A_e.min),this.boundingBox.expandByPoint(A_e.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}},{key:"computeBoundingSphere",value:function(){null===this.boundingSphere&&(this.boundingSphere=new gwe);var e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute)return console.error('THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere. Alternatively set "mesh.frustumCulled" to "false".',this),void this.boundingSphere.set(new Yke,1/0);if(e){var n=this.boundingSphere.center;if(A_e.setFromBufferAttribute(e),t)for(var r=0,a=t.length;r<a;r++){var i=t[r];M_e.setFromBufferAttribute(i),this.morphTargetsRelative?(N_e.addVectors(A_e.min,M_e.min),A_e.expandByPoint(N_e),N_e.addVectors(A_e.max,M_e.max),A_e.expandByPoint(N_e)):(A_e.expandByPoint(M_e.min),A_e.expandByPoint(M_e.max))}A_e.getCenter(n);for(var o=0,s=0,u=e.count;s<u;s++)N_e.fromBufferAttribute(e,s),o=Math.max(o,n.distanceToSquared(N_e));if(t)for(var c=0,l=t.length;c<l;c++)for(var h=t[c],f=this.morphTargetsRelative,d=0,p=h.count;d<p;d++)N_e.fromBufferAttribute(h,d),f&&(I_e.fromBufferAttribute(e,d),N_e.add(I_e)),o=Math.max(o,n.distanceToSquared(N_e));this.boundingSphere.radius=Math.sqrt(o),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}},{key:"computeTangents",value:function(){var e=this.index,t=this.attributes;if(null!==e&&void 0!==t.position&&void 0!==t.normal&&void 0!==t.uv){var n=e.array,r=t.position.array,a=t.normal.array,i=t.uv.array,o=r.length/3;!1===this.hasAttribute("tangent")&&this.setAttribute("tangent",new p_e(new Float32Array(4*o),4));for(var s=this.getAttribute("tangent").array,u=[],c=[],l=0;l<o;l++)u[l]=new Yke,c[l]=new Yke;var h=new Yke,f=new Yke,d=new Yke,p=new yke,v=new yke,m=new yke,g=new Yke,y=new Yke,b=this.groups;0===b.length&&(b=[{start:0,count:n.length}]);for(var x=0,k=b.length;x<k;++x)for(var w=b[x],_=w.start,S=_,C=_+w.count;S<C;S+=3)L(n[S+0],n[S+1],n[S+2]);for(var T=new Yke,E=new Yke,I=new Yke,A=new Yke,M=0,N=b.length;M<N;++M)for(var R=b[M],D=R.start,P=D,O=D+R.count;P<O;P+=3)F(n[P+0]),F(n[P+1]),F(n[P+2])}else console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");function L(e,t,n){h.fromArray(r,3*e),f.fromArray(r,3*t),d.fromArray(r,3*n),p.fromArray(i,2*e),v.fromArray(i,2*t),m.fromArray(i,2*n),f.sub(h),d.sub(h),v.sub(p),m.sub(p);var a=1/(v.x*m.y-m.x*v.y);isFinite(a)&&(g.copy(f).multiplyScalar(m.y).addScaledVector(d,-v.y).multiplyScalar(a),y.copy(d).multiplyScalar(v.x).addScaledVector(f,-m.x).multiplyScalar(a),u[e].add(g),u[t].add(g),u[n].add(g),c[e].add(y),c[t].add(y),c[n].add(y))}function F(e){I.fromArray(a,3*e),A.copy(I);var t=u[e];T.copy(t),T.sub(I.multiplyScalar(I.dot(t))).normalize(),E.crossVectors(A,t);var n=E.dot(c[e])<0?-1:1;s[4*e]=T.x,s[4*e+1]=T.y,s[4*e+2]=T.z,s[4*e+3]=n}}},{key:"computeVertexNormals",value:function(){var e=this.index,t=this.getAttribute("position");if(void 0!==t){var n=this.getAttribute("normal");if(void 0===n)n=new p_e(new Float32Array(3*t.count),3),this.setAttribute("normal",n);else for(var r=0,a=n.count;r<a;r++)n.setXYZ(r,0,0,0);var i=new Yke,o=new Yke,s=new Yke,u=new Yke,c=new Yke,l=new Yke,h=new Yke,f=new Yke;if(e)for(var d=0,p=e.count;d<p;d+=3){var v=e.getX(d+0),m=e.getX(d+1),g=e.getX(d+2);i.fromBufferAttribute(t,v),o.fromBufferAttribute(t,m),s.fromBufferAttribute(t,g),h.subVectors(s,o),f.subVectors(i,o),h.cross(f),u.fromBufferAttribute(n,v),c.fromBufferAttribute(n,m),l.fromBufferAttribute(n,g),u.add(h),c.add(h),l.add(h),n.setXYZ(v,u.x,u.y,u.z),n.setXYZ(m,c.x,c.y,c.z),n.setXYZ(g,l.x,l.y,l.z)}else for(var y=0,b=t.count;y<b;y+=3)i.fromBufferAttribute(t,y+0),o.fromBufferAttribute(t,y+1),s.fromBufferAttribute(t,y+2),h.subVectors(s,o),f.subVectors(i,o),h.cross(f),n.setXYZ(y+0,h.x,h.y,h.z),n.setXYZ(y+1,h.x,h.y,h.z),n.setXYZ(y+2,h.x,h.y,h.z);this.normalizeNormals(),n.needsUpdate=!0}}},{key:"merge",value:function(e,t){if(e&&e.isBufferGeometry){void 0===t&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var n=this.attributes;for(var r in n)if(void 0!==e.attributes[r])for(var a=n[r].array,i=e.attributes[r],o=i.array,s=i.itemSize*t,u=Math.min(o.length,a.length-s),c=0,l=s;c<u;c++,l++)a[l]=o[c];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)}},{key:"normalizeNormals",value:function(){for(var e=this.attributes.normal,t=0,n=e.count;t<n;t++)N_e.fromBufferAttribute(e,t),N_e.normalize(),e.setXYZ(t,N_e.x,N_e.y,N_e.z)}},{key:"toNonIndexed",value:function(){function e(e,t){for(var n=e.array,r=e.itemSize,a=e.normalized,i=new n.constructor(t.length*r),o=0,s=0,u=0,c=t.length;u<c;u++){o=e.isInterleavedBufferAttribute?t[u]*e.data.stride+e.offset:t[u]*r;for(var l=0;l<r;l++)i[s++]=n[o++]}return new p_e(i,r,a)}if(null===this.index)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;var t=new n,r=this.index.array,a=this.attributes;for(var i in a){var o=e(a[i],r);t.setAttribute(i,o)}var s=this.morphAttributes;for(var u in s){for(var c=[],l=s[u],h=0,f=l.length;h<f;h++){var d=e(l[h],r);c.push(d)}t.morphAttributes[u]=c}t.morphTargetsRelative=this.morphTargetsRelative;for(var p=this.groups,v=0,m=p.length;v<m;v++){var g=p[v];t.addGroup(g.start,g.count,g.materialIndex)}return t}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,""!==this.name&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),void 0!==this.parameters){var t=this.parameters;for(var n in t)void 0!==t[n]&&(e[n]=t[n]);return e}e.data={attributes:{}};var r=this.index;null!==r&&(e.data.index={type:r.array.constructor.name,array:Array.prototype.slice.call(r.array)});var a=this.attributes;for(var i in a){var o=a[i];e.data.attributes[i]=o.toJSON(e.data)}var s={},u=!1;for(var c in this.morphAttributes){for(var l=this.morphAttributes[c],h=[],f=0,d=l.length;f<d;f++){var p=l[f];h.push(p.toJSON(e.data))}h.length>0&&(s[c]=h,u=!0)}u&&(e.data.morphAttributes=s,e.data.morphTargetsRelative=this.morphTargetsRelative);var v=this.groups;v.length>0&&(e.data.groups=JSON.parse(JSON.stringify(v)));var m=this.boundingSphere;return null!==m&&(e.data.boundingSphere={center:m.center.toArray(),radius:m.radius}),e}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;var t={};this.name=e.name;var n=e.index;null!==n&&this.setIndex(n.clone(t));var r=e.attributes;for(var a in r){var i=r[a];this.setAttribute(a,i.clone(t))}var o=e.morphAttributes;for(var s in o){for(var u=[],c=o[s],l=0,h=c.length;l<h;l++)u.push(c[l].clone(t));this.morphAttributes[s]=u}this.morphTargetsRelative=e.morphTargetsRelative;for(var f=e.groups,d=0,p=f.length;d<p;d++){var v=f[d];this.addGroup(v.start,v.count,v.materialIndex)}var m=e.boundingBox;null!==m&&(this.boundingBox=m.clone());var g=e.boundingSphere;return null!==g&&(this.boundingSphere=g.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,void 0!==e.parameters&&(this.parameters=Object.assign({},e.parameters)),this}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(ike),D_e=new Twe,P_e=new Cwe,O_e=new gwe,L_e=new Yke,F_e=new Yke,z_e=new Yke,B_e=new Yke,U_e=new Yke,V_e=new Yke,W_e=new Yke,G_e=new Yke,j_e=new Yke,q_e=new yke,H_e=new yke,X_e=new yke,K_e=new Yke,Y_e=new Yke,Q_e=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new R_e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new h_e;return $n(this,n),(e=t.call(this)).isMesh=!0,e.type="Mesh",e.geometry=r,e.material=a,e.updateMorphTargets(),e}return Jn(n,[{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),void 0!==e.morphTargetInfluences&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),void 0!==e.morphTargetDictionary&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=e.material,this.geometry=e.geometry,this}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=n.length;r<a;r++){var i=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=r}}}}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.material,a=this.matrixWorld;if(void 0!==r&&(null===n.boundingSphere&&n.computeBoundingSphere(),O_e.copy(n.boundingSphere),O_e.applyMatrix4(a),!1!==e.ray.intersectsSphere(O_e)&&(D_e.copy(a).invert(),P_e.copy(e.ray).applyMatrix4(D_e),null===n.boundingBox||!1!==P_e.intersectsBox(n.boundingBox)))){var i,o=n.index,s=n.attributes.position,u=n.morphAttributes.position,c=n.morphTargetsRelative,l=n.attributes.uv,h=n.attributes.uv2,f=n.groups,d=n.drawRange;if(null!==o)if(Array.isArray(r))for(var p=0,v=f.length;p<v;p++)for(var m=f[p],g=r[m.materialIndex],y=Math.max(m.start,d.start),b=Math.min(o.count,Math.min(m.start+m.count,d.start+d.count));y<b;y+=3){var x=o.getX(y),k=o.getX(y+1),w=o.getX(y+2);(i=Z_e(this,g,e,P_e,s,u,c,l,h,x,k,w))&&(i.faceIndex=Math.floor(y/3),i.face.materialIndex=m.materialIndex,t.push(i))}else for(var _=Math.max(0,d.start),S=Math.min(o.count,d.start+d.count);_<S;_+=3){var C=o.getX(_),T=o.getX(_+1),E=o.getX(_+2);(i=Z_e(this,r,e,P_e,s,u,c,l,h,C,T,E))&&(i.faceIndex=Math.floor(_/3),t.push(i))}else if(void 0!==s)if(Array.isArray(r))for(var I=0,A=f.length;I<A;I++)for(var M=f[I],N=r[M.materialIndex],R=Math.max(M.start,d.start),D=Math.min(s.count,Math.min(M.start+M.count,d.start+d.count));R<D;R+=3){(i=Z_e(this,N,e,P_e,s,u,c,l,h,R,R+1,R+2))&&(i.faceIndex=Math.floor(R/3),i.face.materialIndex=M.materialIndex,t.push(i))}else for(var P=Math.max(0,d.start),O=Math.min(s.count,d.start+d.count);P<O;P+=3){(i=Z_e(this,r,e,P_e,s,u,c,l,h,P,P+1,P+2))&&(i.faceIndex=Math.floor(P/3),t.push(i))}}}}]),n}(Zwe);function Z_e(e,t,n,r,a,i,o,s,u,c,l,h){L_e.fromBufferAttribute(a,c),F_e.fromBufferAttribute(a,l),z_e.fromBufferAttribute(a,h);var f=e.morphTargetInfluences;if(i&&f){W_e.set(0,0,0),G_e.set(0,0,0),j_e.set(0,0,0);for(var d=0,p=i.length;d<p;d++){var v=f[d],m=i[d];0!==v&&(B_e.fromBufferAttribute(m,c),U_e.fromBufferAttribute(m,l),V_e.fromBufferAttribute(m,h),o?(W_e.addScaledVector(B_e,v),G_e.addScaledVector(U_e,v),j_e.addScaledVector(V_e,v)):(W_e.addScaledVector(B_e.sub(L_e),v),G_e.addScaledVector(U_e.sub(F_e),v),j_e.addScaledVector(V_e.sub(z_e),v)))}L_e.add(W_e),F_e.add(G_e),z_e.add(j_e)}e.isSkinnedMesh&&(e.boneTransform(c,L_e),e.boneTransform(l,F_e),e.boneTransform(h,z_e));var g=function(e,t,n,r,a,i,o,s){if(null===(t.side===iye?r.intersectTriangle(o,i,a,!0,s):r.intersectTriangle(a,i,o,t.side!==oye,s)))return null;Y_e.copy(s),Y_e.applyMatrix4(e.matrixWorld);var u=n.ray.origin.distanceTo(Y_e);return u<n.near||u>n.far?null:{distance:u,point:Y_e.clone(),object:e}}(e,t,n,r,L_e,F_e,z_e,K_e);if(g){s&&(q_e.fromBufferAttribute(s,c),H_e.fromBufferAttribute(s,l),X_e.fromBufferAttribute(s,h),g.uv=u_e.getUV(K_e,L_e,F_e,z_e,q_e,H_e,X_e,new yke)),u&&(q_e.fromBufferAttribute(u,c),H_e.fromBufferAttribute(u,l),X_e.fromBufferAttribute(u,h),g.uv2=u_e.getUV(K_e,L_e,F_e,z_e,q_e,H_e,X_e,new yke));var y={a:c,b:l,c:h,normal:new Yke,materialIndex:0};u_e.getNormal(L_e,F_e,z_e,y.normal),g.face=y}return g}var J_e=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;$n(this,n),(e=t.call(this)).type="BoxGeometry",e.parameters={width:r,height:a,depth:i,widthSegments:o,heightSegments:s,depthSegments:u};var c=ir(e);o=Math.floor(o),s=Math.floor(s),u=Math.floor(u);var l=[],h=[],f=[],d=[],p=0,v=0;function m(e,t,n,r,a,i,o,s,u,m,g){for(var y=i/u,b=o/m,x=i/2,k=o/2,w=s/2,_=u+1,S=m+1,C=0,T=0,E=new Yke,I=0;I<S;I++)for(var A=I*b-k,M=0;M<_;M++){var N=M*y-x;E[e]=N*r,E[t]=A*a,E[n]=w,h.push(E.x,E.y,E.z),E[e]=0,E[t]=0,E[n]=s>0?1:-1,f.push(E.x,E.y,E.z),d.push(M/u),d.push(1-I/m),C+=1}for(var R=0;R<m;R++)for(var D=0;D<u;D++){var P=p+D+_*R,O=p+D+_*(R+1),L=p+(D+1)+_*(R+1),F=p+(D+1)+_*R;l.push(P,O,F),l.push(O,L,F),T+=6}c.addGroup(v,T,g),v+=T,p+=C}return m("z","y","x",-1,-1,i,a,r,u,s,0),m("z","y","x",1,-1,i,a,-r,u,s,1),m("x","z","y",1,1,r,i,a,o,u,2),m("x","z","y",1,-1,r,i,-a,o,u,3),m("x","y","z",1,-1,r,a,i,o,s,4),m("x","y","z",-1,-1,r,a,-i,o,s,5),e.setIndex(l),e.setAttribute("position",new __e(h,3)),e.setAttribute("normal",new __e(f,3)),e.setAttribute("uv",new __e(d,2)),e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}]),n}(R_e);function $_e(e){var t={};for(var n in e)for(var r in t[n]={},e[n]){var a=e[n][r];a&&(a.isColor||a.isMatrix3||a.isMatrix4||a.isVector2||a.isVector3||a.isVector4||a.isTexture||a.isQuaternion)?t[n][r]=a.clone():Array.isArray(a)?t[n][r]=a.slice():t[n][r]=a}return t}function eSe(e){for(var t={},n=0;n<e.length;n++){var r=$_e(e[n]);for(var a in r)t[a]=r[a]}return t}var tSe={clone:$_e,merge:eSe},nSe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isShaderMaterial=!0,r.type="ShaderMaterial",r.defines={},r.uniforms={},r.vertexShader="void main() {\n\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n}",r.fragmentShader="void main() {\n\tgl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );\n}",r.linewidth=1,r.wireframe=!1,r.wireframeLinewidth=1,r.fog=!1,r.lights=!1,r.clipping=!1,r.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},r.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},r.index0AttributeName=void 0,r.uniformsNeedUpdate=!1,r.glslVersion=null,void 0!==e&&(void 0!==e.attributes&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),r.setValues(e)),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=$_e(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}},{key:"toJSON",value:function(e){var t=ja(nr(n.prototype),"toJSON",this).call(this,e);for(var r in t.glslVersion=this.glslVersion,t.uniforms={},this.uniforms){var a=this.uniforms[r].value;a&&a.isTexture?t.uniforms[r]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[r]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[r]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[r]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[r]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[r]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[r]={type:"m4",value:a.toArray()}:t.uniforms[r]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var i={};for(var o in this.extensions)!0===this.extensions[o]&&(i[o]=!0);return Object.keys(i).length>0&&(t.extensions=i),t}}]),n}(l_e),rSe=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this)).isCamera=!0,e.type="Camera",e.matrixWorldInverse=new Twe,e.projectionMatrix=new Twe,e.projectionMatrixInverse=new Twe,e}return Jn(n,[{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this}},{key:"getWorldDirection",value:function(e){this.updateWorldMatrix(!0,!1);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()}},{key:"updateMatrixWorld",value:function(e){ja(nr(n.prototype),"updateMatrixWorld",this).call(this,e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"updateWorldMatrix",value:function(e,t){ja(nr(n.prototype),"updateWorldMatrix",this).call(this,e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),n}(Zwe),aSe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2e3;return $n(this,n),(e=t.call(this)).isPerspectiveCamera=!0,e.type="PerspectiveCamera",e.fov=r,e.zoom=1,e.near=i,e.far=o,e.focus=10,e.aspect=a,e.view=null,e.filmGauge=35,e.filmOffset=0,e.updateProjectionMatrix(),e}return Jn(n,[{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=null===e.view?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}},{key:"setFocalLength",value:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*cke*Math.atan(t),this.updateProjectionMatrix()}},{key:"getFocalLength",value:function(){var e=Math.tan(.5*uke*this.fov);return.5*this.getFilmHeight()/e}},{key:"getEffectiveFOV",value:function(){return 2*cke*Math.atan(Math.tan(.5*uke*this.fov)/this.zoom)}},{key:"getFilmWidth",value:function(){return this.filmGauge*Math.min(this.aspect,1)}},{key:"getFilmHeight",value:function(){return this.filmGauge/Math.max(this.aspect,1)}},{key:"setViewOffset",value:function(e,t,n,r,a,i){this.aspect=e/t,null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=i,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=this.near,t=e*Math.tan(.5*uke*this.fov)/this.zoom,n=2*t,r=this.aspect*n,a=-.5*r,i=this.view;if(null!==this.view&&this.view.enabled){var o=i.fullWidth,s=i.fullHeight;a+=i.offsetX*r/o,t-=i.offsetY*n/s,r*=i.width/o,n*=i.height/s}var u=this.filmOffset;0!==u&&(a+=e*u/this.getFilmWidth()),this.projectionMatrix.makePerspective(a,a+r,t,t-n,e,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=ja(nr(n.prototype),"toJSON",this).call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,null!==this.view&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}]),n}(rSe),iSe=90,oSe=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;if($n(this,n),(i=t.call(this)).type="CubeCamera",!0!==a.isWebGLCubeRenderTarget)return console.error("THREE.CubeCamera: The constructor now expects an instance of WebGLCubeRenderTarget as third parameter."),or(i);i.renderTarget=a;var o=new aSe(iSe,1,e,r);o.layers=i.layers,o.up.set(0,-1,0),o.lookAt(new Yke(1,0,0)),i.add(o);var s=new aSe(iSe,1,e,r);s.layers=i.layers,s.up.set(0,-1,0),s.lookAt(new Yke(-1,0,0)),i.add(s);var u=new aSe(iSe,1,e,r);u.layers=i.layers,u.up.set(0,0,1),u.lookAt(new Yke(0,1,0)),i.add(u);var c=new aSe(iSe,1,e,r);c.layers=i.layers,c.up.set(0,0,-1),c.lookAt(new Yke(0,-1,0)),i.add(c);var l=new aSe(iSe,1,e,r);l.layers=i.layers,l.up.set(0,-1,0),l.lookAt(new Yke(0,0,1)),i.add(l);var h=new aSe(iSe,1,e,r);return h.layers=i.layers,h.up.set(0,-1,0),h.lookAt(new Yke(0,0,-1)),i.add(h),i}return Jn(n,[{key:"update",value:function(e,t){null===this.parent&&this.updateMatrixWorld();var n=this.renderTarget,r=f(this.children,6),a=r[0],i=r[1],o=r[2],s=r[3],u=r[4],c=r[5],l=e.getRenderTarget(),h=e.toneMapping,d=e.xr.enabled;e.toneMapping=Wye,e.xr.enabled=!1;var p=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0),e.render(t,a),e.setRenderTarget(n,1),e.render(t,i),e.setRenderTarget(n,2),e.render(t,o),e.setRenderTarget(n,3),e.render(t,s),e.setRenderTarget(n,4),e.render(t,u),n.texture.generateMipmaps=p,e.setRenderTarget(n,5),e.render(t,c),e.setRenderTarget(l),e.toneMapping=h,e.xr.enabled=d,n.texture.needsPMREMUpdate=!0}}]),n}(Zwe),sSe=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i,o,s,u,c,l,h){var f;return $n(this,n),e=void 0!==e?e:[],r=void 0!==r?r:Yye,(f=t.call(this,e,r,a,i,o,s,u,c,l,h)).isCubeTexture=!0,f.flipY=!1,f}return Jn(n,[{key:"images",get:function(){return this.image},set:function(e){this.image=e}}]),n}(Uke),uSe=function(e){tr(n,e);var t=sr(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};$n(this,n),(r=t.call(this,e,e,a)).isWebGLCubeRenderTarget=!0;var i={width:e,height:e,depth:1},o=[i,i,i,i,i,i];return r.texture=new sSe(o,a.mapping,a.wrapS,a.wrapT,a.magFilter,a.minFilter,a.format,a.type,a.anisotropy,a.encoding),r.texture.isRenderTargetTexture=!0,r.texture.generateMipmaps=void 0!==a.generateMipmaps&&a.generateMipmaps,r.texture.minFilter=void 0!==a.minFilter?a.minFilter:ube,r}return Jn(n,[{key:"fromEquirectangularTexture",value:function(e,t){this.texture.type=t.type,this.texture.encoding=t.encoding,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;var n={tEquirect:{value:null}},r="\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\tvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\n\t\t\t\t\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n\n\t\t\t\t}\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvWorldDirection = transformDirection( position, modelMatrix );\n\n\t\t\t\t\t#include <begin_vertex>\n\t\t\t\t\t#include <project_vertex>\n\n\t\t\t\t}\n\t\t\t",a="\n\n\t\t\t\tuniform sampler2D tEquirect;\n\n\t\t\t\tvarying vec3 vWorldDirection;\n\n\t\t\t\t#include <common>\n\n\t\t\t\tvoid main() {\n\n\t\t\t\t\tvec3 direction = normalize( vWorldDirection );\n\n\t\t\t\t\tvec2 sampleUV = equirectUv( direction );\n\n\t\t\t\t\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\n\t\t\t\t}\n\t\t\t",i=new J_e(5,5,5),o=new nSe({name:"CubemapFromEquirect",uniforms:$_e(n),vertexShader:r,fragmentShader:a,side:iye,blending:cye});o.uniforms.tEquirect.value=t;var s=new Q_e(i,o),u=t.minFilter;return t.minFilter===hbe&&(t.minFilter=ube),new oSe(1,10,this).update(e,s),t.minFilter=u,s.geometry.dispose(),s.material.dispose(),this}},{key:"clear",value:function(e,t,n,r){for(var a=e.getRenderTarget(),i=0;i<6;i++)e.setRenderTarget(this,i),e.clear(t,n,r);e.setRenderTarget(a)}}]),n}(Wke),cSe=new Yke,lSe=new Yke,hSe=new bke,fSe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yke(1,0,0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;$n(this,e),this.isPlane=!0,this.normal=t,this.constant=n}return Jn(e,[{key:"set",value:function(e,t){return this.normal.copy(e),this.constant=t,this}},{key:"setComponents",value:function(e,t,n,r){return this.normal.set(e,t,n),this.constant=r,this}},{key:"setFromNormalAndCoplanarPoint",value:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}},{key:"setFromCoplanarPoints",value:function(e,t,n){var r=cSe.subVectors(n,t).cross(lSe.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(r,e),this}},{key:"copy",value:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this}},{key:"normalize",value:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}},{key:"negate",value:function(){return this.constant*=-1,this.normal.negate(),this}},{key:"distanceToPoint",value:function(e){return this.normal.dot(e)+this.constant}},{key:"distanceToSphere",value:function(e){return this.distanceToPoint(e.center)-e.radius}},{key:"projectPoint",value:function(e,t){return t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)}},{key:"intersectLine",value:function(e,t){var n=e.delta(cSe),r=this.normal.dot(n);if(0===r)return 0===this.distanceToPoint(e.start)?t.copy(e.start):null;var a=-(e.start.dot(this.normal)+this.constant)/r;return a<0||a>1?null:t.copy(n).multiplyScalar(a).add(e.start)}},{key:"intersectsLine",value:function(e){var t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}},{key:"intersectsBox",value:function(e){return e.intersectsPlane(this)}},{key:"intersectsSphere",value:function(e){return e.intersectsPlane(this)}},{key:"coplanarPoint",value:function(e){return e.copy(this.normal).multiplyScalar(-this.constant)}},{key:"applyMatrix4",value:function(e,t){var n=t||hSe.getNormalMatrix(e),r=this.coplanarPoint(cSe).applyMatrix4(e),a=this.normal.applyMatrix3(n).normalize();return this.constant=-r.dot(a),this}},{key:"translate",value:function(e){return this.constant-=e.dot(this.normal),this}},{key:"equals",value:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),dSe=new gwe,pSe=new Yke,vSe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new fSe,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new fSe,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new fSe,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new fSe,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new fSe,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:new fSe;$n(this,e),this.planes=[t,n,r,a,i,o]}return Jn(e,[{key:"set",value:function(e,t,n,r,a,i){var o=this.planes;return o[0].copy(e),o[1].copy(t),o[2].copy(n),o[3].copy(r),o[4].copy(a),o[5].copy(i),this}},{key:"copy",value:function(e){for(var t=this.planes,n=0;n<6;n++)t[n].copy(e.planes[n]);return this}},{key:"setFromProjectionMatrix",value:function(e){var t=this.planes,n=e.elements,r=n[0],a=n[1],i=n[2],o=n[3],s=n[4],u=n[5],c=n[6],l=n[7],h=n[8],f=n[9],d=n[10],p=n[11],v=n[12],m=n[13],g=n[14],y=n[15];return t[0].setComponents(o-r,l-s,p-h,y-v).normalize(),t[1].setComponents(o+r,l+s,p+h,y+v).normalize(),t[2].setComponents(o+a,l+u,p+f,y+m).normalize(),t[3].setComponents(o-a,l-u,p-f,y-m).normalize(),t[4].setComponents(o-i,l-c,p-d,y-g).normalize(),t[5].setComponents(o+i,l+c,p+d,y+g).normalize(),this}},{key:"intersectsObject",value:function(e){var t=e.geometry;return null===t.boundingSphere&&t.computeBoundingSphere(),dSe.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(dSe)}},{key:"intersectsSprite",value:function(e){return dSe.center.set(0,0,0),dSe.radius=.7071067811865476,dSe.applyMatrix4(e.matrixWorld),this.intersectsSphere(dSe)}},{key:"intersectsSphere",value:function(e){for(var t=this.planes,n=e.center,r=-e.radius,a=0;a<6;a++){if(t[a].distanceToPoint(n)<r)return!1}return!0}},{key:"intersectsBox",value:function(e){for(var t=this.planes,n=0;n<6;n++){var r=t[n];if(pSe.x=r.normal.x>0?e.max.x:e.min.x,pSe.y=r.normal.y>0?e.max.y:e.min.y,pSe.z=r.normal.z>0?e.max.z:e.min.z,r.distanceToPoint(pSe)<0)return!1}return!0}},{key:"containsPoint",value:function(e){for(var t=this.planes,n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}();function mSe(){var e=null,t=!1,n=null,r=null;function a(t,i){n(t,i),r=e.requestAnimationFrame(a)}return{start:function(){!0!==t&&null!==n&&(r=e.requestAnimationFrame(a),t=!0)},stop:function(){e.cancelAnimationFrame(r),t=!1},setAnimationLoop:function(e){n=e},setContext:function(t){e=t}}}function gSe(e,t){var n=t.isWebGL2,r=new WeakMap;return{get:function(e){return e.isInterleavedBufferAttribute&&(e=e.data),r.get(e)},remove:function(t){t.isInterleavedBufferAttribute&&(t=t.data);var n=r.get(t);n&&(e.deleteBuffer(n.buffer),r.delete(t))},update:function(t,a){if(t.isGLBufferAttribute){var i=r.get(t);(!i||i.version<t.version)&&r.set(t,{buffer:t.buffer,type:t.type,bytesPerElement:t.elementSize,version:t.version})}else{t.isInterleavedBufferAttribute&&(t=t.data);var o=r.get(t);void 0===o?r.set(t,function(t,r){var a,i=t.array,o=t.usage,s=e.createBuffer();if(e.bindBuffer(r,s),e.bufferData(r,i,o),t.onUploadCallback(),i instanceof Float32Array)a=5126;else if(i instanceof Uint16Array)if(t.isFloat16BufferAttribute){if(!n)throw new Error("THREE.WebGLAttributes: Usage of Float16BufferAttribute requires WebGL2.");a=5131}else a=5123;else if(i instanceof Int16Array)a=5122;else if(i instanceof Uint32Array)a=5125;else if(i instanceof Int32Array)a=5124;else if(i instanceof Int8Array)a=5120;else if(i instanceof Uint8Array)a=5121;else{if(!(i instanceof Uint8ClampedArray))throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+i);a=5121}return{buffer:s,type:a,bytesPerElement:i.BYTES_PER_ELEMENT,version:t.version}}(t,a)):o.version<t.version&&(!function(t,r,a){var i=r.array,o=r.updateRange;e.bindBuffer(a,t),-1===o.count?e.bufferSubData(a,0,i):(n?e.bufferSubData(a,o.offset*i.BYTES_PER_ELEMENT,i,o.offset,o.count):e.bufferSubData(a,o.offset*i.BYTES_PER_ELEMENT,i.subarray(o.offset,o.offset+o.count)),o.count=-1)}(o.buffer,t,a),o.version=t.version)}}}}var ySe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;$n(this,n),(e=t.call(this)).type="PlaneGeometry",e.parameters={width:r,height:a,widthSegments:i,heightSegments:o};for(var s=r/2,u=a/2,c=Math.floor(i),l=Math.floor(o),h=c+1,f=l+1,d=r/c,p=a/l,v=[],m=[],g=[],y=[],b=0;b<f;b++)for(var x=b*p-u,k=0;k<h;k++){var w=k*d-s;m.push(w,-x,0),g.push(0,0,1),y.push(k/c),y.push(1-b/l)}for(var _=0;_<l;_++)for(var S=0;S<c;S++){var C=S+h*_,T=S+h*(_+1),E=S+1+h*(_+1),I=S+1+h*_;v.push(C,T,I),v.push(T,E,I)}return e.setIndex(v),e.setAttribute("position",new __e(m,3)),e.setAttribute("normal",new __e(g,3)),e.setAttribute("uv",new __e(y,2)),e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.width,e.height,e.widthSegments,e.heightSegments)}}]),n}(R_e),bSe={alphamap_fragment:"#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, vUv ).g;\n#endif",alphamap_pars_fragment:"#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",alphatest_fragment:"#ifdef USE_ALPHATEST\n\tif ( diffuseColor.a < alphaTest ) discard;\n#endif",alphatest_pars_fragment:"#ifdef USE_ALPHATEST\n\tuniform float alphaTest;\n#endif",aomap_fragment:"#ifdef USE_AOMAP\n\tfloat ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;\n\treflectedLight.indirectDiffuse *= ambientOcclusion;\n\t#if defined( USE_ENVMAP ) && defined( STANDARD )\n\t\tfloat dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );\n\t\treflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );\n\t#endif\n#endif",aomap_pars_fragment:"#ifdef USE_AOMAP\n\tuniform sampler2D aoMap;\n\tuniform float aoMapIntensity;\n#endif",begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:"vec3 objectNormal = vec3( normal );\n#ifdef USE_TANGENT\n\tvec3 objectTangent = vec3( tangent.xyz );\n#endif",bsdfs:"vec3 BRDF_Lambert( const in vec3 diffuseColor ) {\n\treturn RECIPROCAL_PI * diffuseColor;\n}\nvec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nfloat F_Schlick( const in float f0, const in float f90, const in float dotVH ) {\n\tfloat fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );\n\treturn f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );\n}\nvec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {\n    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );\n    float x2 = x * x;\n    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );\n    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );\n}\nfloat V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {\n\tfloat a2 = pow2( alpha );\n\tfloat gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );\n\tfloat gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );\n\treturn 0.5 / max( gv + gl, EPSILON );\n}\nfloat D_GGX( const in float alpha, const in float dotNH ) {\n\tfloat a2 = pow2( alpha );\n\tfloat denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;\n\treturn RECIPROCAL_PI * a2 / pow2( denom );\n}\nvec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( f0, f90, dotVH );\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#ifdef USE_IRIDESCENCE\nvec3 BRDF_GGX_Iridescence( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 f0, const in float f90, const in float iridescence, const in vec3 iridescenceFresnel, const in float roughness ) {\n\tfloat alpha = pow2( roughness );\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = mix(F_Schlick( f0, f90, dotVH ), iridescenceFresnel, iridescence);\n\tfloat V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );\n\tfloat D = D_GGX( alpha, dotNH );\n\treturn F * ( V * D );\n}\n#endif\nvec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {\n\tconst float LUT_SIZE = 64.0;\n\tconst float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;\n\tconst float LUT_BIAS = 0.5 / LUT_SIZE;\n\tfloat dotNV = saturate( dot( N, V ) );\n\tvec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );\n\tuv = uv * LUT_SCALE + LUT_BIAS;\n\treturn uv;\n}\nfloat LTC_ClippedSphereFormFactor( const in vec3 f ) {\n\tfloat l = length( f );\n\treturn max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );\n}\nvec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {\n\tfloat x = dot( v1, v2 );\n\tfloat y = abs( x );\n\tfloat a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;\n\tfloat b = 3.4175940 + ( 4.1616724 + y ) * y;\n\tfloat v = a / b;\n\tfloat theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;\n\treturn cross( v1, v2 ) * theta_sintheta;\n}\nvec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {\n\tvec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];\n\tvec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];\n\tvec3 lightNormal = cross( v1, v2 );\n\tif( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );\n\tvec3 T1, T2;\n\tT1 = normalize( V - N * dot( V, N ) );\n\tT2 = - cross( N, T1 );\n\tmat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );\n\tvec3 coords[ 4 ];\n\tcoords[ 0 ] = mat * ( rectCoords[ 0 ] - P );\n\tcoords[ 1 ] = mat * ( rectCoords[ 1 ] - P );\n\tcoords[ 2 ] = mat * ( rectCoords[ 2 ] - P );\n\tcoords[ 3 ] = mat * ( rectCoords[ 3 ] - P );\n\tcoords[ 0 ] = normalize( coords[ 0 ] );\n\tcoords[ 1 ] = normalize( coords[ 1 ] );\n\tcoords[ 2 ] = normalize( coords[ 2 ] );\n\tcoords[ 3 ] = normalize( coords[ 3 ] );\n\tvec3 vectorFormFactor = vec3( 0.0 );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );\n\tvectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );\n\tfloat result = LTC_ClippedSphereFormFactor( vectorFormFactor );\n\treturn vec3( result );\n}\nfloat G_BlinnPhong_Implicit( ) {\n\treturn 0.25;\n}\nfloat D_BlinnPhong( const in float shininess, const in float dotNH ) {\n\treturn RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );\n}\nvec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat dotVH = saturate( dot( viewDir, halfDir ) );\n\tvec3 F = F_Schlick( specularColor, 1.0, dotVH );\n\tfloat G = G_BlinnPhong_Implicit( );\n\tfloat D = D_BlinnPhong( shininess, dotNH );\n\treturn F * ( G * D );\n}\n#if defined( USE_SHEEN )\nfloat D_Charlie( float roughness, float dotNH ) {\n\tfloat alpha = pow2( roughness );\n\tfloat invAlpha = 1.0 / alpha;\n\tfloat cos2h = dotNH * dotNH;\n\tfloat sin2h = max( 1.0 - cos2h, 0.0078125 );\n\treturn ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );\n}\nfloat V_Neubelt( float dotNV, float dotNL ) {\n\treturn saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );\n}\nvec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {\n\tvec3 halfDir = normalize( lightDir + viewDir );\n\tfloat dotNL = saturate( dot( normal, lightDir ) );\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat dotNH = saturate( dot( normal, halfDir ) );\n\tfloat D = D_Charlie( sheenRoughness, dotNH );\n\tfloat V = V_Neubelt( dotNV, dotNL );\n\treturn sheenColor * ( D * V );\n}\n#endif",iridescence_fragment:"#ifdef USE_IRIDESCENCE\nconst mat3 XYZ_TO_REC709 = mat3(\n    3.2404542, -0.9692660,  0.0556434,\n   -1.5371385,  1.8760108, -0.2040259,\n   -0.4985314,  0.0415560,  1.0572252\n);\nvec3 Fresnel0ToIor( vec3 fresnel0 ) {\n   vec3 sqrtF0 = sqrt( fresnel0 );\n   return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );\n}\nvec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {\n   return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );\n}\nfloat IorToFresnel0( float transmittedIor, float incidentIor ) {\n   return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));\n}\nvec3 evalSensitivity( float OPD, vec3 shift ) {\n   float phase = 2.0 * PI * OPD * 1.0e-9;\n   vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );\n   vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );\n   vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );\n   vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( -pow2( phase ) * var );\n   xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[0] ) * exp( -4.5282e+09 * pow2( phase ) );\n   xyz /= 1.0685e-7;\n   vec3 srgb = XYZ_TO_REC709 * xyz;\n   return srgb;\n}\nvec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {\n   vec3 I;\n   float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );\n   float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );\n   float cosTheta2Sq = 1.0 - sinTheta2Sq;\n   if ( cosTheta2Sq < 0.0 ) {\n       return vec3( 1.0 );\n   }\n   float cosTheta2 = sqrt( cosTheta2Sq );\n   float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );\n   float R12 = F_Schlick( R0, 1.0, cosTheta1 );\n   float R21 = R12;\n   float T121 = 1.0 - R12;\n   float phi12 = 0.0;\n   if ( iridescenceIOR < outsideIOR ) phi12 = PI;\n   float phi21 = PI - phi12;\n   vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );   vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );\n   vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );\n   vec3 phi23 = vec3( 0.0 );\n   if ( baseIOR[0] < iridescenceIOR ) phi23[0] = PI;\n   if ( baseIOR[1] < iridescenceIOR ) phi23[1] = PI;\n   if ( baseIOR[2] < iridescenceIOR ) phi23[2] = PI;\n   float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;\n   vec3 phi = vec3( phi21 ) + phi23;\n   vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );\n   vec3 r123 = sqrt( R123 );\n   vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );\n   vec3 C0 = R12 + Rs;\n   I = C0;\n   vec3 Cm = Rs - T121;\n   for ( int m = 1; m <= 2; ++m ) {\n       Cm *= r123;\n       vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );\n       I += Cm * Sm;\n   }\n   return max( I, vec3( 0.0 ) );\n}\n#endif",bumpmap_pars_fragment:"#ifdef USE_BUMPMAP\n\tuniform sampler2D bumpMap;\n\tuniform float bumpScale;\n\tvec2 dHdxy_fwd() {\n\t\tvec2 dSTdx = dFdx( vUv );\n\t\tvec2 dSTdy = dFdy( vUv );\n\t\tfloat Hll = bumpScale * texture2D( bumpMap, vUv ).x;\n\t\tfloat dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;\n\t\tfloat dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;\n\t\treturn vec2( dBx, dBy );\n\t}\n\tvec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {\n\t\tvec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );\n\t\tvec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );\n\t\tvec3 vN = surf_norm;\n\t\tvec3 R1 = cross( vSigmaY, vN );\n\t\tvec3 R2 = cross( vN, vSigmaX );\n\t\tfloat fDet = dot( vSigmaX, R1 ) * faceDirection;\n\t\tvec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );\n\t\treturn normalize( abs( fDet ) * surf_norm - vGrad );\n\t}\n#endif",clipping_planes_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvec4 plane;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {\n\t\tplane = clippingPlanes[ i ];\n\t\tif ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;\n\t}\n\t#pragma unroll_loop_end\n\t#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES\n\t\tbool clipped = true;\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {\n\t\t\tplane = clippingPlanes[ i ];\n\t\t\tclipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;\n\t\t}\n\t\t#pragma unroll_loop_end\n\t\tif ( clipped ) discard;\n\t#endif\n#endif",clipping_planes_pars_fragment:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n\tuniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];\n#endif",clipping_planes_pars_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvarying vec3 vClipPosition;\n#endif",clipping_planes_vertex:"#if NUM_CLIPPING_PLANES > 0\n\tvClipPosition = - mvPosition.xyz;\n#endif",color_fragment:"#if defined( USE_COLOR_ALPHA )\n\tdiffuseColor *= vColor;\n#elif defined( USE_COLOR )\n\tdiffuseColor.rgb *= vColor;\n#endif",color_pars_fragment:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR )\n\tvarying vec3 vColor;\n#endif",color_pars_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvarying vec4 vColor;\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvarying vec3 vColor;\n#endif",color_vertex:"#if defined( USE_COLOR_ALPHA )\n\tvColor = vec4( 1.0 );\n#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR )\n\tvColor = vec3( 1.0 );\n#endif\n#ifdef USE_COLOR\n\tvColor *= color;\n#endif\n#ifdef USE_INSTANCING_COLOR\n\tvColor.xyz *= instanceColor.xyz;\n#endif",common:"#define PI 3.141592653589793\n#define PI2 6.283185307179586\n#define PI_HALF 1.5707963267948966\n#define RECIPROCAL_PI 0.3183098861837907\n#define RECIPROCAL_PI2 0.15915494309189535\n#define EPSILON 1e-6\n#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\n#define whiteComplement( a ) ( 1.0 - saturate( a ) )\nfloat pow2( const in float x ) { return x*x; }\nvec3 pow2( const in vec3 x ) { return x*x; }\nfloat pow3( const in float x ) { return x*x*x; }\nfloat pow4( const in float x ) { float x2 = x*x; return x2*x2; }\nfloat max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }\nfloat average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }\nhighp float rand( const in vec2 uv ) {\n\tconst highp float a = 12.9898, b = 78.233, c = 43758.5453;\n\thighp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );\n\treturn fract( sin( sn ) * c );\n}\n#ifdef HIGH_PRECISION\n\tfloat precisionSafeLength( vec3 v ) { return length( v ); }\n#else\n\tfloat precisionSafeLength( vec3 v ) {\n\t\tfloat maxComponent = max3( abs( v ) );\n\t\treturn length( v / maxComponent ) * maxComponent;\n\t}\n#endif\nstruct IncidentLight {\n\tvec3 color;\n\tvec3 direction;\n\tbool visible;\n};\nstruct ReflectedLight {\n\tvec3 directDiffuse;\n\tvec3 directSpecular;\n\tvec3 indirectDiffuse;\n\tvec3 indirectSpecular;\n};\nstruct GeometricContext {\n\tvec3 position;\n\tvec3 normal;\n\tvec3 viewDir;\n#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal;\n#endif\n};\nvec3 transformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );\n}\nvec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {\n\treturn normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );\n}\nmat3 transposeMat3( const in mat3 m ) {\n\tmat3 tmp;\n\ttmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );\n\ttmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );\n\ttmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );\n\treturn tmp;\n}\nfloat linearToRelativeLuminance( const in vec3 color ) {\n\tvec3 weights = vec3( 0.2126, 0.7152, 0.0722 );\n\treturn dot( weights, color.rgb );\n}\nbool isPerspectiveMatrix( mat4 m ) {\n\treturn m[ 2 ][ 3 ] == - 1.0;\n}\nvec2 equirectUv( in vec3 dir ) {\n\tfloat u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;\n\tfloat v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;\n\treturn vec2( u, v );\n}",cube_uv_reflection_fragment:"#ifdef ENVMAP_TYPE_CUBE_UV\n\t#define cubeUV_minMipLevel 4.0\n\t#define cubeUV_minTileSize 16.0\n\tfloat getFace( vec3 direction ) {\n\t\tvec3 absDirection = abs( direction );\n\t\tfloat face = - 1.0;\n\t\tif ( absDirection.x > absDirection.z ) {\n\t\t\tif ( absDirection.x > absDirection.y )\n\t\t\t\tface = direction.x > 0.0 ? 0.0 : 3.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t} else {\n\t\t\tif ( absDirection.z > absDirection.y )\n\t\t\t\tface = direction.z > 0.0 ? 2.0 : 5.0;\n\t\t\telse\n\t\t\t\tface = direction.y > 0.0 ? 1.0 : 4.0;\n\t\t}\n\t\treturn face;\n\t}\n\tvec2 getUV( vec3 direction, float face ) {\n\t\tvec2 uv;\n\t\tif ( face == 0.0 ) {\n\t\t\tuv = vec2( direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 1.0 ) {\n\t\t\tuv = vec2( - direction.x, - direction.z ) / abs( direction.y );\n\t\t} else if ( face == 2.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.y ) / abs( direction.z );\n\t\t} else if ( face == 3.0 ) {\n\t\t\tuv = vec2( - direction.z, direction.y ) / abs( direction.x );\n\t\t} else if ( face == 4.0 ) {\n\t\t\tuv = vec2( - direction.x, direction.z ) / abs( direction.y );\n\t\t} else {\n\t\t\tuv = vec2( direction.x, direction.y ) / abs( direction.z );\n\t\t}\n\t\treturn 0.5 * ( uv + 1.0 );\n\t}\n\tvec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {\n\t\tfloat face = getFace( direction );\n\t\tfloat filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );\n\t\tmipInt = max( mipInt, cubeUV_minMipLevel );\n\t\tfloat faceSize = exp2( mipInt );\n\t\tvec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;\n\t\tif ( face > 2.0 ) {\n\t\t\tuv.y += faceSize;\n\t\t\tface -= 3.0;\n\t\t}\n\t\tuv.x += face * faceSize;\n\t\tuv.x += filterInt * 3.0 * cubeUV_minTileSize;\n\t\tuv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );\n\t\tuv.x *= CUBEUV_TEXEL_WIDTH;\n\t\tuv.y *= CUBEUV_TEXEL_HEIGHT;\n\t\t#ifdef texture2DGradEXT\n\t\t\treturn texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;\n\t\t#else\n\t\t\treturn texture2D( envMap, uv ).rgb;\n\t\t#endif\n\t}\n\t#define r0 1.0\n\t#define v0 0.339\n\t#define m0 - 2.0\n\t#define r1 0.8\n\t#define v1 0.276\n\t#define m1 - 1.0\n\t#define r4 0.4\n\t#define v4 0.046\n\t#define m4 2.0\n\t#define r5 0.305\n\t#define v5 0.016\n\t#define m5 3.0\n\t#define r6 0.21\n\t#define v6 0.0038\n\t#define m6 4.0\n\tfloat roughnessToMip( float roughness ) {\n\t\tfloat mip = 0.0;\n\t\tif ( roughness >= r1 ) {\n\t\t\tmip = ( r0 - roughness ) * ( m1 - m0 ) / ( r0 - r1 ) + m0;\n\t\t} else if ( roughness >= r4 ) {\n\t\t\tmip = ( r1 - roughness ) * ( m4 - m1 ) / ( r1 - r4 ) + m1;\n\t\t} else if ( roughness >= r5 ) {\n\t\t\tmip = ( r4 - roughness ) * ( m5 - m4 ) / ( r4 - r5 ) + m4;\n\t\t} else if ( roughness >= r6 ) {\n\t\t\tmip = ( r5 - roughness ) * ( m6 - m5 ) / ( r5 - r6 ) + m5;\n\t\t} else {\n\t\t\tmip = - 2.0 * log2( 1.16 * roughness );\t\t}\n\t\treturn mip;\n\t}\n\tvec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {\n\t\tfloat mip = clamp( roughnessToMip( roughness ), m0, CUBEUV_MAX_MIP );\n\t\tfloat mipF = fract( mip );\n\t\tfloat mipInt = floor( mip );\n\t\tvec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );\n\t\tif ( mipF == 0.0 ) {\n\t\t\treturn vec4( color0, 1.0 );\n\t\t} else {\n\t\t\tvec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );\n\t\t\treturn vec4( mix( color0, color1, mipF ), 1.0 );\n\t\t}\n\t}\n#endif",defaultnormal_vertex:"vec3 transformedNormal = objectNormal;\n#ifdef USE_INSTANCING\n\tmat3 m = mat3( instanceMatrix );\n\ttransformedNormal /= vec3( dot( m[ 0 ], m[ 0 ] ), dot( m[ 1 ], m[ 1 ] ), dot( m[ 2 ], m[ 2 ] ) );\n\ttransformedNormal = m * transformedNormal;\n#endif\ntransformedNormal = normalMatrix * transformedNormal;\n#ifdef FLIP_SIDED\n\ttransformedNormal = - transformedNormal;\n#endif\n#ifdef USE_TANGENT\n\tvec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#ifdef FLIP_SIDED\n\t\ttransformedTangent = - transformedTangent;\n\t#endif\n#endif",displacementmap_pars_vertex:"#ifdef USE_DISPLACEMENTMAP\n\tuniform sampler2D displacementMap;\n\tuniform float displacementScale;\n\tuniform float displacementBias;\n#endif",displacementmap_vertex:"#ifdef USE_DISPLACEMENTMAP\n\ttransformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );\n#endif",emissivemap_fragment:"#ifdef USE_EMISSIVEMAP\n\tvec4 emissiveColor = texture2D( emissiveMap, vUv );\n\ttotalEmissiveRadiance *= emissiveColor.rgb;\n#endif",emissivemap_pars_fragment:"#ifdef USE_EMISSIVEMAP\n\tuniform sampler2D emissiveMap;\n#endif",encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:"vec4 LinearToLinear( in vec4 value ) {\n\treturn value;\n}\nvec4 LinearTosRGB( in vec4 value ) {\n\treturn vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );\n}",envmap_fragment:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvec3 cameraToFrag;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToFrag = normalize( vWorldPosition - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvec3 reflectVec = reflect( cameraToFrag, worldNormal );\n\t\t#else\n\t\t\tvec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );\n\t\t#endif\n\t#else\n\t\tvec3 reflectVec = vReflect;\n\t#endif\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tvec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );\n\t#elif defined( ENVMAP_TYPE_CUBE_UV )\n\t\tvec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );\n\t#else\n\t\tvec4 envColor = vec4( 0.0 );\n\t#endif\n\t#ifdef ENVMAP_BLENDING_MULTIPLY\n\t\toutgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_MIX )\n\t\toutgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );\n\t#elif defined( ENVMAP_BLENDING_ADD )\n\t\toutgoingLight += envColor.xyz * specularStrength * reflectivity;\n\t#endif\n#endif",envmap_common_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float envMapIntensity;\n\tuniform float flipEnvMap;\n\t#ifdef ENVMAP_TYPE_CUBE\n\t\tuniform samplerCube envMap;\n\t#else\n\t\tuniform sampler2D envMap;\n\t#endif\n\t\n#endif",envmap_pars_fragment:"#ifdef USE_ENVMAP\n\tuniform float reflectivity;\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\tvarying vec3 vWorldPosition;\n\t\tuniform float refractionRatio;\n\t#else\n\t\tvarying vec3 vReflect;\n\t#endif\n#endif",envmap_pars_vertex:"#ifdef USE_ENVMAP\n\t#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )\n\t\t#define ENV_WORLDPOS\n\t#endif\n\t#ifdef ENV_WORLDPOS\n\t\t\n\t\tvarying vec3 vWorldPosition;\n\t#else\n\t\tvarying vec3 vReflect;\n\t\tuniform float refractionRatio;\n\t#endif\n#endif",envmap_physical_pars_fragment:"#if defined( USE_ENVMAP )\n\tvec3 getIBLIrradiance( const in vec3 normal ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );\n\t\t\treturn PI * envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n\tvec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {\n\t\t#if defined( ENVMAP_TYPE_CUBE_UV )\n\t\t\tvec3 reflectVec = reflect( - viewDir, normal );\n\t\t\treflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );\n\t\t\treflectVec = inverseTransformDirection( reflectVec, viewMatrix );\n\t\t\tvec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );\n\t\t\treturn envMapColor.rgb * envMapIntensity;\n\t\t#else\n\t\t\treturn vec3( 0.0 );\n\t\t#endif\n\t}\n#endif",envmap_vertex:"#ifdef USE_ENVMAP\n\t#ifdef ENV_WORLDPOS\n\t\tvWorldPosition = worldPosition.xyz;\n\t#else\n\t\tvec3 cameraToVertex;\n\t\tif ( isOrthographic ) {\n\t\t\tcameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );\n\t\t} else {\n\t\t\tcameraToVertex = normalize( worldPosition.xyz - cameraPosition );\n\t\t}\n\t\tvec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\t#ifdef ENVMAP_MODE_REFLECTION\n\t\t\tvReflect = reflect( cameraToVertex, worldNormal );\n\t\t#else\n\t\t\tvReflect = refract( cameraToVertex, worldNormal, refractionRatio );\n\t\t#endif\n\t#endif\n#endif",fog_vertex:"#ifdef USE_FOG\n\tvFogDepth = - mvPosition.z;\n#endif",fog_pars_vertex:"#ifdef USE_FOG\n\tvarying float vFogDepth;\n#endif",fog_fragment:"#ifdef USE_FOG\n\t#ifdef FOG_EXP2\n\t\tfloat fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );\n\t#else\n\t\tfloat fogFactor = smoothstep( fogNear, fogFar, vFogDepth );\n\t#endif\n\tgl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );\n#endif",fog_pars_fragment:"#ifdef USE_FOG\n\tuniform vec3 fogColor;\n\tvarying float vFogDepth;\n\t#ifdef FOG_EXP2\n\t\tuniform float fogDensity;\n\t#else\n\t\tuniform float fogNear;\n\t\tuniform float fogFar;\n\t#endif\n#endif",gradientmap_pars_fragment:"#ifdef USE_GRADIENTMAP\n\tuniform sampler2D gradientMap;\n#endif\nvec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {\n\tfloat dotNL = dot( normal, lightDirection );\n\tvec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );\n\t#ifdef USE_GRADIENTMAP\n\t\treturn vec3( texture2D( gradientMap, coord ).r );\n\t#else\n\t\treturn ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );\n\t#endif\n}",lightmap_fragment:"#ifdef USE_LIGHTMAP\n\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\treflectedLight.indirectDiffuse += lightMapIrradiance;\n#endif",lightmap_pars_fragment:"#ifdef USE_LIGHTMAP\n\tuniform sampler2D lightMap;\n\tuniform float lightMapIntensity;\n#endif",lights_lambert_vertex:"vec3 diffuse = vec3( 1.0 );\nGeometricContext geometry;\ngeometry.position = mvPosition.xyz;\ngeometry.normal = normalize( transformedNormal );\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );\nGeometricContext backGeometry;\nbackGeometry.position = geometry.position;\nbackGeometry.normal = -geometry.normal;\nbackGeometry.viewDir = geometry.viewDir;\nvLightFront = vec3( 0.0 );\nvIndirectFront = vec3( 0.0 );\n#ifdef DOUBLE_SIDED\n\tvLightBack = vec3( 0.0 );\n\tvIndirectBack = vec3( 0.0 );\n#endif\nIncidentLight directLight;\nfloat dotNL;\nvec3 directLightColor_Diffuse;\nvIndirectFront += getAmbientLightIrradiance( ambientLightColor );\nvIndirectFront += getLightProbeIrradiance( lightProbe, geometry.normal );\n#ifdef DOUBLE_SIDED\n\tvIndirectBack += getAmbientLightIrradiance( ambientLightColor );\n\tvIndirectBack += getLightProbeIrradiance( lightProbe, backGeometry.normal );\n#endif\n#if NUM_POINT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tgetPointLightInfo( pointLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tgetSpotLightInfo( spotLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_DIR_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tgetDirectionalLightInfo( directionalLights[ i ], geometry, directLight );\n\t\tdotNL = dot( geometry.normal, directLight.direction );\n\t\tdirectLightColor_Diffuse = directLight.color;\n\t\tvLightFront += saturate( dotNL ) * directLightColor_Diffuse;\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvLightBack += saturate( - dotNL ) * directLightColor_Diffuse;\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\tvIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\tvIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry.normal );\n\t\t#endif\n\t}\n\t#pragma unroll_loop_end\n#endif",lights_pars_begin:"uniform bool receiveShadow;\nuniform vec3 ambientLightColor;\nuniform vec3 lightProbe[ 9 ];\nvec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {\n\tfloat x = normal.x, y = normal.y, z = normal.z;\n\tvec3 result = shCoefficients[ 0 ] * 0.886227;\n\tresult += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;\n\tresult += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;\n\tresult += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;\n\tresult += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;\n\tresult += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;\n\tresult += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );\n\tresult += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;\n\tresult += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );\n\treturn result;\n}\nvec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {\n\tvec3 worldNormal = inverseTransformDirection( normal, viewMatrix );\n\tvec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );\n\treturn irradiance;\n}\nvec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {\n\tvec3 irradiance = ambientLightColor;\n\treturn irradiance;\n}\nfloat getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {\n\t#if defined ( PHYSICALLY_CORRECT_LIGHTS )\n\t\tfloat distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );\n\t\tif ( cutoffDistance > 0.0 ) {\n\t\t\tdistanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );\n\t\t}\n\t\treturn distanceFalloff;\n\t#else\n\t\tif ( cutoffDistance > 0.0 && decayExponent > 0.0 ) {\n\t\t\treturn pow( saturate( - lightDistance / cutoffDistance + 1.0 ), decayExponent );\n\t\t}\n\t\treturn 1.0;\n\t#endif\n}\nfloat getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {\n\treturn smoothstep( coneCosine, penumbraCosine, angleCosine );\n}\n#if NUM_DIR_LIGHTS > 0\n\tstruct DirectionalLight {\n\t\tvec3 direction;\n\t\tvec3 color;\n\t};\n\tuniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];\n\tvoid getDirectionalLightInfo( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tlight.color = directionalLight.color;\n\t\tlight.direction = directionalLight.direction;\n\t\tlight.visible = true;\n\t}\n#endif\n#if NUM_POINT_LIGHTS > 0\n\tstruct PointLight {\n\t\tvec3 position;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t};\n\tuniform PointLight pointLights[ NUM_POINT_LIGHTS ];\n\tvoid getPointLightInfo( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = pointLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat lightDistance = length( lVector );\n\t\tlight.color = pointLight.color;\n\t\tlight.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );\n\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t}\n#endif\n#if NUM_SPOT_LIGHTS > 0\n\tstruct SpotLight {\n\t\tvec3 position;\n\t\tvec3 direction;\n\t\tvec3 color;\n\t\tfloat distance;\n\t\tfloat decay;\n\t\tfloat coneCos;\n\t\tfloat penumbraCos;\n\t};\n\tuniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];\n\tvoid getSpotLightInfo( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight light ) {\n\t\tvec3 lVector = spotLight.position - geometry.position;\n\t\tlight.direction = normalize( lVector );\n\t\tfloat angleCos = dot( light.direction, spotLight.direction );\n\t\tfloat spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );\n\t\tif ( spotAttenuation > 0.0 ) {\n\t\t\tfloat lightDistance = length( lVector );\n\t\t\tlight.color = spotLight.color * spotAttenuation;\n\t\t\tlight.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );\n\t\t\tlight.visible = ( light.color != vec3( 0.0 ) );\n\t\t} else {\n\t\t\tlight.color = vec3( 0.0 );\n\t\t\tlight.visible = false;\n\t\t}\n\t}\n#endif\n#if NUM_RECT_AREA_LIGHTS > 0\n\tstruct RectAreaLight {\n\t\tvec3 color;\n\t\tvec3 position;\n\t\tvec3 halfWidth;\n\t\tvec3 halfHeight;\n\t};\n\tuniform sampler2D ltc_1;\tuniform sampler2D ltc_2;\n\tuniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];\n#endif\n#if NUM_HEMI_LIGHTS > 0\n\tstruct HemisphereLight {\n\t\tvec3 direction;\n\t\tvec3 skyColor;\n\t\tvec3 groundColor;\n\t};\n\tuniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];\n\tvec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {\n\t\tfloat dotNL = dot( normal, hemiLight.direction );\n\t\tfloat hemiDiffuseWeight = 0.5 * dotNL + 0.5;\n\t\tvec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );\n\t\treturn irradiance;\n\t}\n#endif",lights_toon_fragment:"ToonMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;",lights_toon_pars_fragment:"varying vec3 vViewPosition;\nstruct ToonMaterial {\n\tvec3 diffuseColor;\n};\nvoid RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\tvec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_Toon\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Toon\n#define Material_LightProbeLOD( material )\t(0)",lights_phong_fragment:"BlinnPhongMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb;\nmaterial.specularColor = specular;\nmaterial.specularShininess = shininess;\nmaterial.specularStrength = specularStrength;",lights_phong_pars_fragment:"varying vec3 vViewPosition;\nstruct BlinnPhongMaterial {\n\tvec3 diffuseColor;\n\tvec3 specularColor;\n\tfloat specularShininess;\n\tfloat specularStrength;\n};\nvoid RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n\treflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularShininess ) * material.specularStrength;\n}\nvoid RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\n#define RE_Direct\t\t\t\tRE_Direct_BlinnPhong\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_BlinnPhong\n#define Material_LightProbeLOD( material )\t(0)",lights_physical_fragment:"PhysicalMaterial material;\nmaterial.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );\nvec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );\nfloat geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );\nmaterial.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;\nmaterial.roughness = min( material.roughness, 1.0 );\n#ifdef IOR\n\t#ifdef SPECULAR\n\t\tfloat specularIntensityFactor = specularIntensity;\n\t\tvec3 specularColorFactor = specularColor;\n\t\t#ifdef USE_SPECULARINTENSITYMAP\n\t\t\tspecularIntensityFactor *= texture2D( specularIntensityMap, vUv ).a;\n\t\t#endif\n\t\t#ifdef USE_SPECULARCOLORMAP\n\t\t\tspecularColorFactor *= texture2D( specularColorMap, vUv ).rgb;\n\t\t#endif\n\t\tmaterial.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );\n\t#else\n\t\tfloat specularIntensityFactor = 1.0;\n\t\tvec3 specularColorFactor = vec3( 1.0 );\n\t\tmaterial.specularF90 = 1.0;\n\t#endif\n\tmaterial.specularColor = mix( min( pow2( ( ior - 1.0 ) / ( ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );\n#else\n\tmaterial.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );\n\tmaterial.specularF90 = 1.0;\n#endif\n#ifdef USE_CLEARCOAT\n\tmaterial.clearcoat = clearcoat;\n\tmaterial.clearcoatRoughness = clearcoatRoughness;\n\tmaterial.clearcoatF0 = vec3( 0.04 );\n\tmaterial.clearcoatF90 = 1.0;\n\t#ifdef USE_CLEARCOATMAP\n\t\tmaterial.clearcoat *= texture2D( clearcoatMap, vUv ).x;\n\t#endif\n\t#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\t\tmaterial.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vUv ).y;\n\t#endif\n\tmaterial.clearcoat = saturate( material.clearcoat );\tmaterial.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );\n\tmaterial.clearcoatRoughness += geometryRoughness;\n\tmaterial.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );\n#endif\n#ifdef USE_IRIDESCENCE\n\tmaterial.iridescence = iridescence;\n\tmaterial.iridescenceIOR = iridescenceIOR;\n\t#ifdef USE_IRIDESCENCEMAP\n\t\tmaterial.iridescence *= texture2D( iridescenceMap, vUv ).r;\n\t#endif\n\t#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\t\tmaterial.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vUv ).g + iridescenceThicknessMinimum;\n\t#else\n\t\tmaterial.iridescenceThickness = iridescenceThicknessMaximum;\n\t#endif\n#endif\n#ifdef USE_SHEEN\n\tmaterial.sheenColor = sheenColor;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tmaterial.sheenColor *= texture2D( sheenColorMap, vUv ).rgb;\n\t#endif\n\tmaterial.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tmaterial.sheenRoughness *= texture2D( sheenRoughnessMap, vUv ).a;\n\t#endif\n#endif",lights_physical_pars_fragment:"struct PhysicalMaterial {\n\tvec3 diffuseColor;\n\tfloat roughness;\n\tvec3 specularColor;\n\tfloat specularF90;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat clearcoat;\n\t\tfloat clearcoatRoughness;\n\t\tvec3 clearcoatF0;\n\t\tfloat clearcoatF90;\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\tfloat iridescence;\n\t\tfloat iridescenceIOR;\n\t\tfloat iridescenceThickness;\n\t\tvec3 iridescenceFresnel;\n\t\tvec3 iridescenceF0;\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tvec3 sheenColor;\n\t\tfloat sheenRoughness;\n\t#endif\n};\nvec3 clearcoatSpecular = vec3( 0.0 );\nvec3 sheenSpecular = vec3( 0.0 );\nfloat IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tfloat r2 = roughness * roughness;\n\tfloat a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;\n\tfloat b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;\n\tfloat DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );\n\treturn saturate( DG * RECIPROCAL_PI );\n}\nvec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {\n\tfloat dotNV = saturate( dot( normal, viewDir ) );\n\tconst vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );\n\tconst vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );\n\tvec4 r = roughness * c0 + c1;\n\tfloat a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;\n\tvec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;\n\treturn fab;\n}\nvec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\treturn specularColor * fab.x + specularF90 * fab.y;\n}\n#ifdef USE_IRIDESCENCE\nvoid computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#else\nvoid computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {\n#endif\n\tvec2 fab = DFGApprox( normal, viewDir, roughness );\n\t#ifdef USE_IRIDESCENCE\n\t\tvec3 Fr = mix( specularColor, iridescenceF0, iridescence );\n\t#else\n\t\tvec3 Fr = specularColor;\n\t#endif\n\tvec3 FssEss = Fr * fab.x + specularF90 * fab.y;\n\tfloat Ess = fab.x + fab.y;\n\tfloat Ems = 1.0 - Ess;\n\tvec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;\tvec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );\n\tsingleScatter += FssEss;\n\tmultiScatter += Fms * Ems;\n}\n#if NUM_RECT_AREA_LIGHTS > 0\n\tvoid RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\t\tvec3 normal = geometry.normal;\n\t\tvec3 viewDir = geometry.viewDir;\n\t\tvec3 position = geometry.position;\n\t\tvec3 lightPos = rectAreaLight.position;\n\t\tvec3 halfWidth = rectAreaLight.halfWidth;\n\t\tvec3 halfHeight = rectAreaLight.halfHeight;\n\t\tvec3 lightColor = rectAreaLight.color;\n\t\tfloat roughness = material.roughness;\n\t\tvec3 rectCoords[ 4 ];\n\t\trectCoords[ 0 ] = lightPos + halfWidth - halfHeight;\t\trectCoords[ 1 ] = lightPos - halfWidth - halfHeight;\n\t\trectCoords[ 2 ] = lightPos - halfWidth + halfHeight;\n\t\trectCoords[ 3 ] = lightPos + halfWidth + halfHeight;\n\t\tvec2 uv = LTC_Uv( normal, viewDir, roughness );\n\t\tvec4 t1 = texture2D( ltc_1, uv );\n\t\tvec4 t2 = texture2D( ltc_2, uv );\n\t\tmat3 mInv = mat3(\n\t\t\tvec3( t1.x, 0, t1.y ),\n\t\t\tvec3(    0, 1,    0 ),\n\t\t\tvec3( t1.z, 0, t1.w )\n\t\t);\n\t\tvec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );\n\t\treflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );\n\t\treflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );\n\t}\n#endif\nvoid RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\tfloat dotNL = saturate( dot( geometry.normal, directLight.direction ) );\n\tvec3 irradiance = dotNL * directLight.color;\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNLcc = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );\n\t\tvec3 ccIrradiance = dotNLcc * directLight.color;\n\t\tclearcoatSpecular += ccIrradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.clearcoatNormal, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * BRDF_Sheen( directLight.direction, geometry.viewDir, geometry.normal, material.sheenColor, material.sheenRoughness );\n\t#endif\n\t#ifdef USE_IRIDESCENCE\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX_Iridescence( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness );\n\t#else\n\t\treflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometry.viewDir, geometry.normal, material.specularColor, material.specularF90, material.roughness );\n\t#endif\n\treflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {\n\treflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );\n}\nvoid RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatSpecular += clearcoatRadiance * EnvironmentBRDF( geometry.clearcoatNormal, geometry.viewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );\n\t#endif\n\t#ifdef USE_SHEEN\n\t\tsheenSpecular += irradiance * material.sheenColor * IBLSheenBRDF( geometry.normal, geometry.viewDir, material.sheenRoughness );\n\t#endif\n\tvec3 singleScattering = vec3( 0.0 );\n\tvec3 multiScattering = vec3( 0.0 );\n\tvec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;\n\t#ifdef USE_IRIDESCENCE\n\t\tcomputeMultiscatteringIridescence( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );\n\t#else\n\t\tcomputeMultiscattering( geometry.normal, geometry.viewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );\n\t#endif\n\tvec3 totalScattering = singleScattering + multiScattering;\n\tvec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );\n\treflectedLight.indirectSpecular += radiance * singleScattering;\n\treflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;\n\treflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;\n}\n#define RE_Direct\t\t\t\tRE_Direct_Physical\n#define RE_Direct_RectArea\t\tRE_Direct_RectArea_Physical\n#define RE_IndirectDiffuse\t\tRE_IndirectDiffuse_Physical\n#define RE_IndirectSpecular\t\tRE_IndirectSpecular_Physical\nfloat computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {\n\treturn saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );\n}",lights_fragment_begin:"\nGeometricContext geometry;\ngeometry.position = - vViewPosition;\ngeometry.normal = normal;\ngeometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );\n#ifdef USE_CLEARCOAT\n\tgeometry.clearcoatNormal = clearcoatNormal;\n#endif\n#ifdef USE_IRIDESCENCE\nfloat dotNVi = saturate( dot( normal, geometry.viewDir ) );\nif ( material.iridescenceThickness == 0.0 ) {\n\tmaterial.iridescence = 0.0;\n} else {\n\tmaterial.iridescence = saturate( material.iridescence );\n}\nif ( material.iridescence > 0.0 ) {\n\tmaterial.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );\n\tmaterial.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );\n}\n#endif\nIncidentLight directLight;\n#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )\n\tPointLight pointLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {\n\t\tpointLight = pointLights[ i ];\n\t\tgetPointLightInfo( pointLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )\n\t\tpointLightShadow = pointLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )\n\tSpotLight spotLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {\n\t\tspotLight = spotLights[ i ];\n\t\tgetSpotLightInfo( spotLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )\n\t\tspotLightShadow = spotLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )\n\tDirectionalLight directionalLight;\n\t#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLightShadow;\n\t#endif\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {\n\t\tdirectionalLight = directionalLights[ i ];\n\t\tgetDirectionalLightInfo( directionalLight, geometry, directLight );\n\t\t#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )\n\t\tdirectionalLightShadow = directionalLightShadows[ i ];\n\t\tdirectLight.color *= all( bvec2( directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t\t#endif\n\t\tRE_Direct( directLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )\n\tRectAreaLight rectAreaLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {\n\t\trectAreaLight = rectAreaLights[ i ];\n\t\tRE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );\n\t}\n\t#pragma unroll_loop_end\n#endif\n#if defined( RE_IndirectDiffuse )\n\tvec3 iblIrradiance = vec3( 0.0 );\n\tvec3 irradiance = getAmbientLightIrradiance( ambientLightColor );\n\tirradiance += getLightProbeIrradiance( lightProbe, geometry.normal );\n\t#if ( NUM_HEMI_LIGHTS > 0 )\n\t\t#pragma unroll_loop_start\n\t\tfor ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {\n\t\t\tirradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry.normal );\n\t\t}\n\t\t#pragma unroll_loop_end\n\t#endif\n#endif\n#if defined( RE_IndirectSpecular )\n\tvec3 radiance = vec3( 0.0 );\n\tvec3 clearcoatRadiance = vec3( 0.0 );\n#endif",lights_fragment_maps:"#if defined( RE_IndirectDiffuse )\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\tvec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;\n\t\tirradiance += lightMapIrradiance;\n\t#endif\n\t#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )\n\t\tiblIrradiance += getIBLIrradiance( geometry.normal );\n\t#endif\n#endif\n#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )\n\tradiance += getIBLRadiance( geometry.viewDir, geometry.normal, material.roughness );\n\t#ifdef USE_CLEARCOAT\n\t\tclearcoatRadiance += getIBLRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness );\n\t#endif\n#endif",lights_fragment_end:"#if defined( RE_IndirectDiffuse )\n\tRE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );\n#endif\n#if defined( RE_IndirectSpecular )\n\tRE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );\n#endif",logdepthbuf_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tgl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;\n#endif",logdepthbuf_pars_fragment:"#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )\n\tuniform float logDepthBufFC;\n\tvarying float vFragDepth;\n\tvarying float vIsPerspective;\n#endif",logdepthbuf_pars_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvarying float vFragDepth;\n\t\tvarying float vIsPerspective;\n\t#else\n\t\tuniform float logDepthBufFC;\n\t#endif\n#endif",logdepthbuf_vertex:"#ifdef USE_LOGDEPTHBUF\n\t#ifdef USE_LOGDEPTHBUF_EXT\n\t\tvFragDepth = 1.0 + gl_Position.w;\n\t\tvIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );\n\t#else\n\t\tif ( isPerspectiveMatrix( projectionMatrix ) ) {\n\t\t\tgl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;\n\t\t\tgl_Position.z *= gl_Position.w;\n\t\t}\n\t#endif\n#endif",map_fragment:"#ifdef USE_MAP\n\tvec4 sampledDiffuseColor = texture2D( map, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tsampledDiffuseColor = vec4( mix( pow( sampledDiffuseColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), sampledDiffuseColor.rgb * 0.0773993808, vec3( lessThanEqual( sampledDiffuseColor.rgb, vec3( 0.04045 ) ) ) ), sampledDiffuseColor.w );\n\t#endif\n\tdiffuseColor *= sampledDiffuseColor;\n#endif",map_pars_fragment:"#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif",map_particle_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tvec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;\n#endif\n#ifdef USE_MAP\n\tdiffuseColor *= texture2D( map, uv );\n#endif\n#ifdef USE_ALPHAMAP\n\tdiffuseColor.a *= texture2D( alphaMap, uv ).g;\n#endif",map_particle_pars_fragment:"#if defined( USE_MAP ) || defined( USE_ALPHAMAP )\n\tuniform mat3 uvTransform;\n#endif\n#ifdef USE_MAP\n\tuniform sampler2D map;\n#endif\n#ifdef USE_ALPHAMAP\n\tuniform sampler2D alphaMap;\n#endif",metalnessmap_fragment:"float metalnessFactor = metalness;\n#ifdef USE_METALNESSMAP\n\tvec4 texelMetalness = texture2D( metalnessMap, vUv );\n\tmetalnessFactor *= texelMetalness.b;\n#endif",metalnessmap_pars_fragment:"#ifdef USE_METALNESSMAP\n\tuniform sampler2D metalnessMap;\n#endif",morphcolor_vertex:"#if defined( USE_MORPHCOLORS ) && defined( MORPHTARGETS_TEXTURE )\n\tvColor *= morphTargetBaseInfluence;\n\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t#if defined( USE_COLOR_ALPHA )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];\n\t\t#elif defined( USE_COLOR )\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];\n\t\t#endif\n\t}\n#endif",morphnormal_vertex:"#ifdef USE_MORPHNORMALS\n\tobjectNormal *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\tobjectNormal += morphNormal0 * morphTargetInfluences[ 0 ];\n\t\tobjectNormal += morphNormal1 * morphTargetInfluences[ 1 ];\n\t\tobjectNormal += morphNormal2 * morphTargetInfluences[ 2 ];\n\t\tobjectNormal += morphNormal3 * morphTargetInfluences[ 3 ];\n\t#endif\n#endif",morphtarget_pars_vertex:"#ifdef USE_MORPHTARGETS\n\tuniform float morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tuniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];\n\t\tuniform sampler2DArray morphTargetsTexture;\n\t\tuniform ivec2 morphTargetsTextureSize;\n\t\tvec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {\n\t\t\tint texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;\n\t\t\tint y = texelIndex / morphTargetsTextureSize.x;\n\t\t\tint x = texelIndex - y * morphTargetsTextureSize.x;\n\t\t\tivec3 morphUV = ivec3( x, y, morphTargetIndex );\n\t\t\treturn texelFetch( morphTargetsTexture, morphUV, 0 );\n\t\t}\n\t#else\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\tuniform float morphTargetInfluences[ 8 ];\n\t\t#else\n\t\t\tuniform float morphTargetInfluences[ 4 ];\n\t\t#endif\n\t#endif\n#endif",morphtarget_vertex:"#ifdef USE_MORPHTARGETS\n\ttransformed *= morphTargetBaseInfluence;\n\t#ifdef MORPHTARGETS_TEXTURE\n\t\tfor ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {\n\t\t\tif ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];\n\t\t}\n\t#else\n\t\ttransformed += morphTarget0 * morphTargetInfluences[ 0 ];\n\t\ttransformed += morphTarget1 * morphTargetInfluences[ 1 ];\n\t\ttransformed += morphTarget2 * morphTargetInfluences[ 2 ];\n\t\ttransformed += morphTarget3 * morphTargetInfluences[ 3 ];\n\t\t#ifndef USE_MORPHNORMALS\n\t\t\ttransformed += morphTarget4 * morphTargetInfluences[ 4 ];\n\t\t\ttransformed += morphTarget5 * morphTargetInfluences[ 5 ];\n\t\t\ttransformed += morphTarget6 * morphTargetInfluences[ 6 ];\n\t\t\ttransformed += morphTarget7 * morphTargetInfluences[ 7 ];\n\t\t#endif\n\t#endif\n#endif",normal_fragment_begin:"float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;\n#ifdef FLAT_SHADED\n\tvec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );\n\tvec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );\n\tvec3 normal = normalize( cross( fdx, fdy ) );\n#else\n\tvec3 normal = normalize( vNormal );\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\t#ifdef USE_TANGENT\n\t\tvec3 tangent = normalize( vTangent );\n\t\tvec3 bitangent = normalize( vBitangent );\n\t\t#ifdef DOUBLE_SIDED\n\t\t\ttangent = tangent * faceDirection;\n\t\t\tbitangent = bitangent * faceDirection;\n\t\t#endif\n\t\t#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )\n\t\t\tmat3 vTBN = mat3( tangent, bitangent, normal );\n\t\t#endif\n\t#endif\n#endif\nvec3 geometryNormal = normal;",normal_fragment_maps:"#ifdef OBJECTSPACE_NORMALMAP\n\tnormal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\t#ifdef FLIP_SIDED\n\t\tnormal = - normal;\n\t#endif\n\t#ifdef DOUBLE_SIDED\n\t\tnormal = normal * faceDirection;\n\t#endif\n\tnormal = normalize( normalMatrix * normal );\n#elif defined( TANGENTSPACE_NORMALMAP )\n\tvec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;\n\tmapN.xy *= normalScale;\n\t#ifdef USE_TANGENT\n\t\tnormal = normalize( vTBN * mapN );\n\t#else\n\t\tnormal = perturbNormal2Arb( - vViewPosition, normal, mapN, faceDirection );\n\t#endif\n#elif defined( USE_BUMPMAP )\n\tnormal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );\n#endif",normal_pars_fragment:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_pars_vertex:"#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n\t#ifdef USE_TANGENT\n\t\tvarying vec3 vTangent;\n\t\tvarying vec3 vBitangent;\n\t#endif\n#endif",normal_vertex:"#ifndef FLAT_SHADED\n\tvNormal = normalize( transformedNormal );\n\t#ifdef USE_TANGENT\n\t\tvTangent = normalize( transformedTangent );\n\t\tvBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );\n\t#endif\n#endif",normalmap_pars_fragment:"#ifdef USE_NORMALMAP\n\tuniform sampler2D normalMap;\n\tuniform vec2 normalScale;\n#endif\n#ifdef OBJECTSPACE_NORMALMAP\n\tuniform mat3 normalMatrix;\n#endif\n#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )\n\tvec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN, float faceDirection ) {\n\t\tvec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );\n\t\tvec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );\n\t\tvec2 st0 = dFdx( vUv.st );\n\t\tvec2 st1 = dFdy( vUv.st );\n\t\tvec3 N = surf_norm;\n\t\tvec3 q1perp = cross( q1, N );\n\t\tvec3 q0perp = cross( N, q0 );\n\t\tvec3 T = q1perp * st0.x + q0perp * st1.x;\n\t\tvec3 B = q1perp * st0.y + q0perp * st1.y;\n\t\tfloat det = max( dot( T, T ), dot( B, B ) );\n\t\tfloat scale = ( det == 0.0 ) ? 0.0 : faceDirection * inversesqrt( det );\n\t\treturn normalize( T * ( mapN.x * scale ) + B * ( mapN.y * scale ) + N * mapN.z );\n\t}\n#endif",clearcoat_normal_fragment_begin:"#ifdef USE_CLEARCOAT\n\tvec3 clearcoatNormal = geometryNormal;\n#endif",clearcoat_normal_fragment_maps:"#ifdef USE_CLEARCOAT_NORMALMAP\n\tvec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;\n\tclearcoatMapN.xy *= clearcoatNormalScale;\n\t#ifdef USE_TANGENT\n\t\tclearcoatNormal = normalize( vTBN * clearcoatMapN );\n\t#else\n\t\tclearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN, faceDirection );\n\t#endif\n#endif",clearcoat_pars_fragment:"#ifdef USE_CLEARCOATMAP\n\tuniform sampler2D clearcoatMap;\n#endif\n#ifdef USE_CLEARCOAT_ROUGHNESSMAP\n\tuniform sampler2D clearcoatRoughnessMap;\n#endif\n#ifdef USE_CLEARCOAT_NORMALMAP\n\tuniform sampler2D clearcoatNormalMap;\n\tuniform vec2 clearcoatNormalScale;\n#endif",iridescence_pars_fragment:"#ifdef USE_IRIDESCENCEMAP\n\tuniform sampler2D iridescenceMap;\n#endif\n#ifdef USE_IRIDESCENCE_THICKNESSMAP\n\tuniform sampler2D iridescenceThicknessMap;\n#endif",output_fragment:"#ifdef OPAQUE\ndiffuseColor.a = 1.0;\n#endif\n#ifdef USE_TRANSMISSION\ndiffuseColor.a *= transmissionAlpha + 0.1;\n#endif\ngl_FragColor = vec4( outgoingLight, diffuseColor.a );",packing:"vec3 packNormalToRGB( const in vec3 normal ) {\n\treturn normalize( normal ) * 0.5 + 0.5;\n}\nvec3 unpackRGBToNormal( const in vec3 rgb ) {\n\treturn 2.0 * rgb.xyz - 1.0;\n}\nconst float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;\nconst vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256., 256. );\nconst vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );\nconst float ShiftRight8 = 1. / 256.;\nvec4 packDepthToRGBA( const in float v ) {\n\tvec4 r = vec4( fract( v * PackFactors ), v );\n\tr.yzw -= r.xyz * ShiftRight8;\treturn r * PackUpscale;\n}\nfloat unpackRGBAToDepth( const in vec4 v ) {\n\treturn dot( v, UnpackFactors );\n}\nvec4 pack2HalfToRGBA( vec2 v ) {\n\tvec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );\n\treturn vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );\n}\nvec2 unpackRGBATo2Half( vec4 v ) {\n\treturn vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );\n}\nfloat viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( viewZ + near ) / ( near - far );\n}\nfloat orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {\n\treturn linearClipZ * ( near - far ) - near;\n}\nfloat viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {\n\treturn ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );\n}\nfloat perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {\n\treturn ( near * far ) / ( ( far - near ) * invClipZ - far );\n}",premultiplied_alpha_fragment:"#ifdef PREMULTIPLIED_ALPHA\n\tgl_FragColor.rgb *= gl_FragColor.a;\n#endif",project_vertex:"vec4 mvPosition = vec4( transformed, 1.0 );\n#ifdef USE_INSTANCING\n\tmvPosition = instanceMatrix * mvPosition;\n#endif\nmvPosition = modelViewMatrix * mvPosition;\ngl_Position = projectionMatrix * mvPosition;",dithering_fragment:"#ifdef DITHERING\n\tgl_FragColor.rgb = dithering( gl_FragColor.rgb );\n#endif",dithering_pars_fragment:"#ifdef DITHERING\n\tvec3 dithering( vec3 color ) {\n\t\tfloat grid_position = rand( gl_FragCoord.xy );\n\t\tvec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );\n\t\tdither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );\n\t\treturn color + dither_shift_RGB;\n\t}\n#endif",roughnessmap_fragment:"float roughnessFactor = roughness;\n#ifdef USE_ROUGHNESSMAP\n\tvec4 texelRoughness = texture2D( roughnessMap, vUv );\n\troughnessFactor *= texelRoughness.g;\n#endif",roughnessmap_pars_fragment:"#ifdef USE_ROUGHNESSMAP\n\tuniform sampler2D roughnessMap;\n#endif",shadowmap_pars_fragment:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n\tfloat texture2DCompare( sampler2D depths, vec2 uv, float compare ) {\n\t\treturn step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );\n\t}\n\tvec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {\n\t\treturn unpackRGBATo2Half( texture2D( shadow, uv ) );\n\t}\n\tfloat VSMShadow (sampler2D shadow, vec2 uv, float compare ){\n\t\tfloat occlusion = 1.0;\n\t\tvec2 distribution = texture2DDistribution( shadow, uv );\n\t\tfloat hard_shadow = step( compare , distribution.x );\n\t\tif (hard_shadow != 1.0 ) {\n\t\t\tfloat distance = compare - distribution.x ;\n\t\t\tfloat variance = max( 0.00000, distribution.y * distribution.y );\n\t\t\tfloat softness_probability = variance / (variance + distance * distance );\t\t\tsoftness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );\t\t\tocclusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );\n\t\t}\n\t\treturn occlusion;\n\t}\n\tfloat getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {\n\t\tfloat shadow = 1.0;\n\t\tshadowCoord.xyz /= shadowCoord.w;\n\t\tshadowCoord.z += shadowBias;\n\t\tbvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );\n\t\tbool inFrustum = all( inFrustumVec );\n\t\tbvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );\n\t\tbool frustumTest = all( frustumTestVec );\n\t\tif ( frustumTest ) {\n\t\t#if defined( SHADOWMAP_TYPE_PCF )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx0 = - texelSize.x * shadowRadius;\n\t\t\tfloat dy0 = - texelSize.y * shadowRadius;\n\t\t\tfloat dx1 = + texelSize.x * shadowRadius;\n\t\t\tfloat dy1 = + texelSize.y * shadowRadius;\n\t\t\tfloat dx2 = dx0 / 2.0;\n\t\t\tfloat dy2 = dy0 / 2.0;\n\t\t\tfloat dx3 = dx1 / 2.0;\n\t\t\tfloat dy3 = dy1 / 2.0;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )\n\t\t\t) * ( 1.0 / 17.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_PCF_SOFT )\n\t\t\tvec2 texelSize = vec2( 1.0 ) / shadowMapSize;\n\t\t\tfloat dx = texelSize.x;\n\t\t\tfloat dy = texelSize.y;\n\t\t\tvec2 uv = shadowCoord.xy;\n\t\t\tvec2 f = fract( uv * shadowMapSize + 0.5 );\n\t\t\tuv -= f * texelSize;\n\t\t\tshadow = (\n\t\t\t\ttexture2DCompare( shadowMap, uv, shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +\n\t\t\t\ttexture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),\n\t\t\t\t\t f.x ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t f.y ) +\n\t\t\t\tmix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), \n\t\t\t\t\t\t  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),\n\t\t\t\t\t\t  f.x ),\n\t\t\t\t\t f.y )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#elif defined( SHADOWMAP_TYPE_VSM )\n\t\t\tshadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#else\n\t\t\tshadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );\n\t\t#endif\n\t\t}\n\t\treturn shadow;\n\t}\n\tvec2 cubeToUV( vec3 v, float texelSizeY ) {\n\t\tvec3 absV = abs( v );\n\t\tfloat scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );\n\t\tabsV *= scaleToCube;\n\t\tv *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );\n\t\tvec2 planar = v.xy;\n\t\tfloat almostATexel = 1.5 * texelSizeY;\n\t\tfloat almostOne = 1.0 - almostATexel;\n\t\tif ( absV.z >= almostOne ) {\n\t\t\tif ( v.z > 0.0 )\n\t\t\t\tplanar.x = 4.0 - v.x;\n\t\t} else if ( absV.x >= almostOne ) {\n\t\t\tfloat signX = sign( v.x );\n\t\t\tplanar.x = v.z * signX + 2.0 * signX;\n\t\t} else if ( absV.y >= almostOne ) {\n\t\t\tfloat signY = sign( v.y );\n\t\t\tplanar.x = v.x + 2.0 * signY + 2.0;\n\t\t\tplanar.y = v.z * signY - 2.0;\n\t\t}\n\t\treturn vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );\n\t}\n\tfloat getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {\n\t\tvec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );\n\t\tvec3 lightToPosition = shadowCoord.xyz;\n\t\tfloat dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );\t\tdp += shadowBias;\n\t\tvec3 bd3D = normalize( lightToPosition );\n\t\t#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )\n\t\t\tvec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;\n\t\t\treturn (\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +\n\t\t\t\ttexture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )\n\t\t\t) * ( 1.0 / 9.0 );\n\t\t#else\n\t\t\treturn texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );\n\t\t#endif\n\t}\n#endif",shadowmap_pars_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t\tuniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tvarying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];\n\t\tstruct DirectionalLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];\n\t\tstruct SpotLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t};\n\t\tuniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t\tuniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tvarying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];\n\t\tstruct PointLightShadow {\n\t\t\tfloat shadowBias;\n\t\t\tfloat shadowNormalBias;\n\t\t\tfloat shadowRadius;\n\t\t\tvec2 shadowMapSize;\n\t\t\tfloat shadowCameraNear;\n\t\t\tfloat shadowCameraFar;\n\t\t};\n\t\tuniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];\n\t#endif\n#endif",shadowmap_vertex:"#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0 || NUM_SPOT_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0\n\t\tvec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );\n\t\tvec4 shadowWorldPosition;\n\t#endif\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tshadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );\n\t\tvPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n#endif",shadowmask_pars_fragment:"float getShadowMask() {\n\tfloat shadow = 1.0;\n\t#ifdef USE_SHADOWMAP\n\t#if NUM_DIR_LIGHT_SHADOWS > 0\n\tDirectionalLightShadow directionalLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {\n\t\tdirectionalLight = directionalLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_SPOT_LIGHT_SHADOWS > 0\n\tSpotLightShadow spotLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {\n\t\tspotLight = spotLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#if NUM_POINT_LIGHT_SHADOWS > 0\n\tPointLightShadow pointLight;\n\t#pragma unroll_loop_start\n\tfor ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {\n\t\tpointLight = pointLightShadows[ i ];\n\t\tshadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;\n\t}\n\t#pragma unroll_loop_end\n\t#endif\n\t#endif\n\treturn shadow;\n}",skinbase_vertex:"#ifdef USE_SKINNING\n\tmat4 boneMatX = getBoneMatrix( skinIndex.x );\n\tmat4 boneMatY = getBoneMatrix( skinIndex.y );\n\tmat4 boneMatZ = getBoneMatrix( skinIndex.z );\n\tmat4 boneMatW = getBoneMatrix( skinIndex.w );\n#endif",skinning_pars_vertex:"#ifdef USE_SKINNING\n\tuniform mat4 bindMatrix;\n\tuniform mat4 bindMatrixInverse;\n\tuniform highp sampler2D boneTexture;\n\tuniform int boneTextureSize;\n\tmat4 getBoneMatrix( const in float i ) {\n\t\tfloat j = i * 4.0;\n\t\tfloat x = mod( j, float( boneTextureSize ) );\n\t\tfloat y = floor( j / float( boneTextureSize ) );\n\t\tfloat dx = 1.0 / float( boneTextureSize );\n\t\tfloat dy = 1.0 / float( boneTextureSize );\n\t\ty = dy * ( y + 0.5 );\n\t\tvec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );\n\t\tvec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );\n\t\tvec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );\n\t\tvec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );\n\t\tmat4 bone = mat4( v1, v2, v3, v4 );\n\t\treturn bone;\n\t}\n#endif",skinning_vertex:"#ifdef USE_SKINNING\n\tvec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );\n\tvec4 skinned = vec4( 0.0 );\n\tskinned += boneMatX * skinVertex * skinWeight.x;\n\tskinned += boneMatY * skinVertex * skinWeight.y;\n\tskinned += boneMatZ * skinVertex * skinWeight.z;\n\tskinned += boneMatW * skinVertex * skinWeight.w;\n\ttransformed = ( bindMatrixInverse * skinned ).xyz;\n#endif",skinnormal_vertex:"#ifdef USE_SKINNING\n\tmat4 skinMatrix = mat4( 0.0 );\n\tskinMatrix += skinWeight.x * boneMatX;\n\tskinMatrix += skinWeight.y * boneMatY;\n\tskinMatrix += skinWeight.z * boneMatZ;\n\tskinMatrix += skinWeight.w * boneMatW;\n\tskinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;\n\tobjectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;\n\t#ifdef USE_TANGENT\n\t\tobjectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;\n\t#endif\n#endif",specularmap_fragment:"float specularStrength;\n#ifdef USE_SPECULARMAP\n\tvec4 texelSpecular = texture2D( specularMap, vUv );\n\tspecularStrength = texelSpecular.r;\n#else\n\tspecularStrength = 1.0;\n#endif",specularmap_pars_fragment:"#ifdef USE_SPECULARMAP\n\tuniform sampler2D specularMap;\n#endif",tonemapping_fragment:"#if defined( TONE_MAPPING )\n\tgl_FragColor.rgb = toneMapping( gl_FragColor.rgb );\n#endif",tonemapping_pars_fragment:"#ifndef saturate\n#define saturate( a ) clamp( a, 0.0, 1.0 )\n#endif\nuniform float toneMappingExposure;\nvec3 LinearToneMapping( vec3 color ) {\n\treturn toneMappingExposure * color;\n}\nvec3 ReinhardToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\treturn saturate( color / ( vec3( 1.0 ) + color ) );\n}\nvec3 OptimizedCineonToneMapping( vec3 color ) {\n\tcolor *= toneMappingExposure;\n\tcolor = max( vec3( 0.0 ), color - 0.004 );\n\treturn pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );\n}\nvec3 RRTAndODTFit( vec3 v ) {\n\tvec3 a = v * ( v + 0.0245786 ) - 0.000090537;\n\tvec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;\n\treturn a / b;\n}\nvec3 ACESFilmicToneMapping( vec3 color ) {\n\tconst mat3 ACESInputMat = mat3(\n\t\tvec3( 0.59719, 0.07600, 0.02840 ),\t\tvec3( 0.35458, 0.90834, 0.13383 ),\n\t\tvec3( 0.04823, 0.01566, 0.83777 )\n\t);\n\tconst mat3 ACESOutputMat = mat3(\n\t\tvec3(  1.60475, -0.10208, -0.00327 ),\t\tvec3( -0.53108,  1.10813, -0.07276 ),\n\t\tvec3( -0.07367, -0.00605,  1.07602 )\n\t);\n\tcolor *= toneMappingExposure / 0.6;\n\tcolor = ACESInputMat * color;\n\tcolor = RRTAndODTFit( color );\n\tcolor = ACESOutputMat * color;\n\treturn saturate( color );\n}\nvec3 CustomToneMapping( vec3 color ) { return color; }",transmission_fragment:"#ifdef USE_TRANSMISSION\n\tfloat transmissionAlpha = 1.0;\n\tfloat transmissionFactor = transmission;\n\tfloat thicknessFactor = thickness;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\ttransmissionFactor *= texture2D( transmissionMap, vUv ).r;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tthicknessFactor *= texture2D( thicknessMap, vUv ).g;\n\t#endif\n\tvec3 pos = vWorldPosition;\n\tvec3 v = normalize( cameraPosition - pos );\n\tvec3 n = inverseTransformDirection( normal, viewMatrix );\n\tvec4 transmission = getIBLVolumeRefraction(\n\t\tn, v, roughnessFactor, material.diffuseColor, material.specularColor, material.specularF90,\n\t\tpos, modelMatrix, viewMatrix, projectionMatrix, ior, thicknessFactor,\n\t\tattenuationColor, attenuationDistance );\n\ttotalDiffuse = mix( totalDiffuse, transmission.rgb, transmissionFactor );\n\ttransmissionAlpha = mix( transmissionAlpha, transmission.a, transmissionFactor );\n#endif",transmission_pars_fragment:"#ifdef USE_TRANSMISSION\n\tuniform float transmission;\n\tuniform float thickness;\n\tuniform float attenuationDistance;\n\tuniform vec3 attenuationColor;\n\t#ifdef USE_TRANSMISSIONMAP\n\t\tuniform sampler2D transmissionMap;\n\t#endif\n\t#ifdef USE_THICKNESSMAP\n\t\tuniform sampler2D thicknessMap;\n\t#endif\n\tuniform vec2 transmissionSamplerSize;\n\tuniform sampler2D transmissionSamplerMap;\n\tuniform mat4 modelMatrix;\n\tuniform mat4 projectionMatrix;\n\tvarying vec3 vWorldPosition;\n\tvec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {\n\t\tvec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );\n\t\tvec3 modelScale;\n\t\tmodelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );\n\t\tmodelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );\n\t\tmodelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );\n\t\treturn normalize( refractionVector ) * thickness * modelScale;\n\t}\n\tfloat applyIorToRoughness( const in float roughness, const in float ior ) {\n\t\treturn roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );\n\t}\n\tvec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {\n\t\tfloat framebufferLod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );\n\t\t#ifdef texture2DLodEXT\n\t\t\treturn texture2DLodEXT( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#else\n\t\t\treturn texture2D( transmissionSamplerMap, fragCoord.xy, framebufferLod );\n\t\t#endif\n\t}\n\tvec3 applyVolumeAttenuation( const in vec3 radiance, const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tif ( attenuationDistance == 0.0 ) {\n\t\t\treturn radiance;\n\t\t} else {\n\t\t\tvec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;\n\t\t\tvec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );\t\t\treturn transmittance * radiance;\n\t\t}\n\t}\n\tvec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,\n\t\tconst in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,\n\t\tconst in mat4 viewMatrix, const in mat4 projMatrix, const in float ior, const in float thickness,\n\t\tconst in vec3 attenuationColor, const in float attenuationDistance ) {\n\t\tvec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );\n\t\tvec3 refractedRayExit = position + transmissionRay;\n\t\tvec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );\n\t\tvec2 refractionCoords = ndcPos.xy / ndcPos.w;\n\t\trefractionCoords += 1.0;\n\t\trefractionCoords /= 2.0;\n\t\tvec4 transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );\n\t\tvec3 attenuatedColor = applyVolumeAttenuation( transmittedLight.rgb, length( transmissionRay ), attenuationColor, attenuationDistance );\n\t\tvec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );\n\t\treturn vec4( ( 1.0 - F ) * attenuatedColor * diffuseColor, transmittedLight.a );\n\t}\n#endif",uv_pars_fragment:"#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )\n\tvarying vec2 vUv;\n#endif",uv_pars_vertex:"#ifdef USE_UV\n\t#ifdef UVS_VERTEX_ONLY\n\t\tvec2 vUv;\n\t#else\n\t\tvarying vec2 vUv;\n\t#endif\n\tuniform mat3 uvTransform;\n#endif",uv_vertex:"#ifdef USE_UV\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n#endif",uv2_pars_fragment:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvarying vec2 vUv2;\n#endif",uv2_pars_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tattribute vec2 uv2;\n\tvarying vec2 vUv2;\n\tuniform mat3 uv2Transform;\n#endif",uv2_vertex:"#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )\n\tvUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;\n#endif",worldpos_vertex:"#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION )\n\tvec4 worldPosition = vec4( transformed, 1.0 );\n\t#ifdef USE_INSTANCING\n\t\tworldPosition = instanceMatrix * worldPosition;\n\t#endif\n\tworldPosition = modelMatrix * worldPosition;\n#endif",background_vert:"varying vec2 vUv;\nuniform mat3 uvTransform;\nvoid main() {\n\tvUv = ( uvTransform * vec3( uv, 1 ) ).xy;\n\tgl_Position = vec4( position.xy, 1.0, 1.0 );\n}",background_frag:"uniform sampler2D t2D;\nvarying vec2 vUv;\nvoid main() {\n\tgl_FragColor = texture2D( t2D, vUv );\n\t#ifdef DECODE_VIDEO_TEXTURE\n\t\tgl_FragColor = vec4( mix( pow( gl_FragColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), gl_FragColor.rgb * 0.0773993808, vec3( lessThanEqual( gl_FragColor.rgb, vec3( 0.04045 ) ) ) ), gl_FragColor.w );\n\t#endif\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",cube_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n\tgl_Position.z = gl_Position.w;\n}",cube_frag:"#include <envmap_common_pars_fragment>\nuniform float opacity;\nvarying vec3 vWorldDirection;\n#include <cube_uv_reflection_fragment>\nvoid main() {\n\tvec3 vReflect = vWorldDirection;\n\t#include <envmap_fragment>\n\tgl_FragColor = envColor;\n\tgl_FragColor.a *= opacity;\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",depth_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvHighPrecisionZW = gl_Position.zw;\n}",depth_frag:"#if DEPTH_PACKING == 3200\n\tuniform float opacity;\n#endif\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvarying vec2 vHighPrecisionZW;\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#if DEPTH_PACKING == 3200\n\t\tdiffuseColor.a = opacity;\n\t#endif\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <logdepthbuf_fragment>\n\tfloat fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;\n\t#if DEPTH_PACKING == 3200\n\t\tgl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );\n\t#elif DEPTH_PACKING == 3201\n\t\tgl_FragColor = packDepthToRGBA( fragCoordZ );\n\t#endif\n}",distanceRGBA_vert:"#define DISTANCE\nvarying vec3 vWorldPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <skinbase_vertex>\n\t#ifdef USE_DISPLACEMENTMAP\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <clipping_planes_vertex>\n\tvWorldPosition = worldPosition.xyz;\n}",distanceRGBA_frag:"#define DISTANCE\nuniform vec3 referencePosition;\nuniform float nearDistance;\nuniform float farDistance;\nvarying vec3 vWorldPosition;\n#include <common>\n#include <packing>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main () {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( 1.0 );\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\tfloat dist = length( vWorldPosition - referencePosition );\n\tdist = ( dist - nearDistance ) / ( farDistance - nearDistance );\n\tdist = saturate( dist );\n\tgl_FragColor = packDepthToRGBA( dist );\n}",equirect_vert:"varying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvWorldDirection = transformDirection( position, modelMatrix );\n\t#include <begin_vertex>\n\t#include <project_vertex>\n}",equirect_frag:"uniform sampler2D tEquirect;\nvarying vec3 vWorldDirection;\n#include <common>\nvoid main() {\n\tvec3 direction = normalize( vWorldDirection );\n\tvec2 sampleUV = equirectUv( direction );\n\tgl_FragColor = texture2D( tEquirect, sampleUV );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n}",linedashed_vert:"uniform float scale;\nattribute float lineDistance;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\tvLineDistance = scale * lineDistance;\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",linedashed_frag:"uniform vec3 diffuse;\nuniform float opacity;\nuniform float dashSize;\nuniform float totalSize;\nvarying float vLineDistance;\n#include <common>\n#include <color_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tif ( mod( vLineDistance, totalSize ) > dashSize ) {\n\t\tdiscard;\n\t}\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <color_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",meshbasic_vert:"#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )\n\t\t#include <beginnormal_vertex>\n\t\t#include <morphnormal_vertex>\n\t\t#include <skinbase_vertex>\n\t\t#include <skinnormal_vertex>\n\t\t#include <defaultnormal_vertex>\n\t#endif\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <fog_vertex>\n}",meshbasic_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#ifndef FLAT_SHADED\n\tvarying vec3 vNormal;\n#endif\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\t#ifdef USE_LIGHTMAP\n\t\tvec4 lightMapTexel = texture2D( lightMap, vUv2 );\n\t\treflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;\n\t#else\n\t\treflectedLight.indirectDiffuse += vec3( 1.0 );\n\t#endif\n\t#include <aomap_fragment>\n\treflectedLight.indirectDiffuse *= diffuseColor.rgb;\n\tvec3 outgoingLight = reflectedLight.indirectDiffuse;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshlambert_vert:"#define LAMBERT\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <envmap_pars_vertex>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <lights_lambert_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshlambert_frag:"uniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\nvarying vec3 vLightFront;\nvarying vec3 vIndirectFront;\n#ifdef DOUBLE_SIDED\n\tvarying vec3 vLightBack;\n\tvarying vec3 vIndirectBack;\n#endif\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <fog_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <emissivemap_fragment>\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;\n\t#else\n\t\treflectedLight.indirectDiffuse += vIndirectFront;\n\t#endif\n\t#include <lightmap_fragment>\n\treflectedLight.indirectDiffuse *= BRDF_Lambert( diffuseColor.rgb );\n\t#ifdef DOUBLE_SIDED\n\t\treflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;\n\t#else\n\t\treflectedLight.directDiffuse = vLightFront;\n\t#endif\n\treflectedLight.directDiffuse *= BRDF_Lambert( diffuseColor.rgb ) * getShadowMask();\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshmatcap_vert:"#define MATCAP\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <color_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n\tvViewPosition = - mvPosition.xyz;\n}",meshmatcap_frag:"#define MATCAP\nuniform vec3 diffuse;\nuniform float opacity;\nuniform sampler2D matcap;\nvarying vec3 vViewPosition;\n#include <common>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tvec3 viewDir = normalize( vViewPosition );\n\tvec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );\n\tvec3 y = cross( viewDir, x );\n\tvec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;\n\t#ifdef USE_MATCAP\n\t\tvec4 matcapColor = texture2D( matcap, uv );\n\t#else\n\t\tvec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );\n\t#endif\n\tvec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshnormal_vert:"#define NORMAL\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvViewPosition = - mvPosition.xyz;\n#endif\n}",meshnormal_frag:"#define NORMAL\nuniform float opacity;\n#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )\n\tvarying vec3 vViewPosition;\n#endif\n#include <packing>\n#include <uv_pars_fragment>\n#include <normal_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\t#include <logdepthbuf_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\tgl_FragColor = vec4( packNormalToRGB( normal ), opacity );\n\t#ifdef OPAQUE\n\t\tgl_FragColor.a = 1.0;\n\t#endif\n}",meshphong_vert:"#define PHONG\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <envmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <envmap_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshphong_frag:"#define PHONG\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform float shininess;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_pars_fragment>\n#include <cube_uv_reflection_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_phong_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <specularmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <specularmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_phong_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\n\t#include <envmap_fragment>\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshphysical_vert:"#define STANDARD\nvarying vec3 vViewPosition;\n#ifdef USE_TRANSMISSION\n\tvarying vec3 vWorldPosition;\n#endif\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n#ifdef USE_TRANSMISSION\n\tvWorldPosition = worldPosition.xyz;\n#endif\n}",meshphysical_frag:"#define STANDARD\n#ifdef PHYSICAL\n\t#define IOR\n\t#define SPECULAR\n#endif\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float roughness;\nuniform float metalness;\nuniform float opacity;\n#ifdef IOR\n\tuniform float ior;\n#endif\n#ifdef SPECULAR\n\tuniform float specularIntensity;\n\tuniform vec3 specularColor;\n\t#ifdef USE_SPECULARINTENSITYMAP\n\t\tuniform sampler2D specularIntensityMap;\n\t#endif\n\t#ifdef USE_SPECULARCOLORMAP\n\t\tuniform sampler2D specularColorMap;\n\t#endif\n#endif\n#ifdef USE_CLEARCOAT\n\tuniform float clearcoat;\n\tuniform float clearcoatRoughness;\n#endif\n#ifdef USE_IRIDESCENCE\n\tuniform float iridescence;\n\tuniform float iridescenceIOR;\n\tuniform float iridescenceThicknessMinimum;\n\tuniform float iridescenceThicknessMaximum;\n#endif\n#ifdef USE_SHEEN\n\tuniform vec3 sheenColor;\n\tuniform float sheenRoughness;\n\t#ifdef USE_SHEENCOLORMAP\n\t\tuniform sampler2D sheenColorMap;\n\t#endif\n\t#ifdef USE_SHEENROUGHNESSMAP\n\t\tuniform sampler2D sheenRoughnessMap;\n\t#endif\n#endif\nvarying vec3 vViewPosition;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <bsdfs>\n#include <iridescence_fragment>\n#include <cube_uv_reflection_fragment>\n#include <envmap_common_pars_fragment>\n#include <envmap_physical_pars_fragment>\n#include <fog_pars_fragment>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_physical_pars_fragment>\n#include <transmission_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <clearcoat_pars_fragment>\n#include <iridescence_pars_fragment>\n#include <roughnessmap_pars_fragment>\n#include <metalnessmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <roughnessmap_fragment>\n\t#include <metalnessmap_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <clearcoat_normal_fragment_begin>\n\t#include <clearcoat_normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_physical_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;\n\tvec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;\n\t#include <transmission_fragment>\n\tvec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;\n\t#ifdef USE_SHEEN\n\t\tfloat sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );\n\t\toutgoingLight = outgoingLight * sheenEnergyComp + sheenSpecular;\n\t#endif\n\t#ifdef USE_CLEARCOAT\n\t\tfloat dotNVcc = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );\n\t\tvec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );\n\t\toutgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + clearcoatSpecular * material.clearcoat;\n\t#endif\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",meshtoon_vert:"#define TOON\nvarying vec3 vViewPosition;\n#include <common>\n#include <uv_pars_vertex>\n#include <uv2_pars_vertex>\n#include <displacementmap_pars_vertex>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <normal_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\t#include <uv2_vertex>\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <normal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <displacementmap_vertex>\n\t#include <project_vertex>\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\tvViewPosition = - mvPosition.xyz;\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",meshtoon_frag:"#define TOON\nuniform vec3 diffuse;\nuniform vec3 emissive;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <dithering_pars_fragment>\n#include <color_pars_fragment>\n#include <uv_pars_fragment>\n#include <uv2_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <aomap_pars_fragment>\n#include <lightmap_pars_fragment>\n#include <emissivemap_pars_fragment>\n#include <gradientmap_pars_fragment>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <normal_pars_fragment>\n#include <lights_toon_pars_fragment>\n#include <shadowmap_pars_fragment>\n#include <bumpmap_pars_fragment>\n#include <normalmap_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\tReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );\n\tvec3 totalEmissiveRadiance = emissive;\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <color_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\t#include <normal_fragment_begin>\n\t#include <normal_fragment_maps>\n\t#include <emissivemap_fragment>\n\t#include <lights_toon_fragment>\n\t#include <lights_fragment_begin>\n\t#include <lights_fragment_maps>\n\t#include <lights_fragment_end>\n\t#include <aomap_fragment>\n\tvec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n\t#include <dithering_fragment>\n}",points_vert:"uniform float size;\nuniform float scale;\n#include <common>\n#include <color_pars_vertex>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <color_vertex>\n\t#include <morphcolor_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <project_vertex>\n\tgl_PointSize = size;\n\t#ifdef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );\n\t#endif\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <worldpos_vertex>\n\t#include <fog_vertex>\n}",points_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <color_pars_fragment>\n#include <map_particle_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_particle_fragment>\n\t#include <color_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n\t#include <premultiplied_alpha_fragment>\n}",shadow_vert:"#include <common>\n#include <fog_pars_vertex>\n#include <morphtarget_pars_vertex>\n#include <skinning_pars_vertex>\n#include <shadowmap_pars_vertex>\nvoid main() {\n\t#include <beginnormal_vertex>\n\t#include <morphnormal_vertex>\n\t#include <skinbase_vertex>\n\t#include <skinnormal_vertex>\n\t#include <defaultnormal_vertex>\n\t#include <begin_vertex>\n\t#include <morphtarget_vertex>\n\t#include <skinning_vertex>\n\t#include <project_vertex>\n\t#include <worldpos_vertex>\n\t#include <shadowmap_vertex>\n\t#include <fog_vertex>\n}",shadow_frag:"uniform vec3 color;\nuniform float opacity;\n#include <common>\n#include <packing>\n#include <fog_pars_fragment>\n#include <bsdfs>\n#include <lights_pars_begin>\n#include <shadowmap_pars_fragment>\n#include <shadowmask_pars_fragment>\nvoid main() {\n\tgl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}",sprite_vert:"uniform float rotation;\nuniform vec2 center;\n#include <common>\n#include <uv_pars_vertex>\n#include <fog_pars_vertex>\n#include <logdepthbuf_pars_vertex>\n#include <clipping_planes_pars_vertex>\nvoid main() {\n\t#include <uv_vertex>\n\tvec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );\n\tvec2 scale;\n\tscale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );\n\tscale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );\n\t#ifndef USE_SIZEATTENUATION\n\t\tbool isPerspective = isPerspectiveMatrix( projectionMatrix );\n\t\tif ( isPerspective ) scale *= - mvPosition.z;\n\t#endif\n\tvec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;\n\tvec2 rotatedPosition;\n\trotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;\n\trotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;\n\tmvPosition.xy += rotatedPosition;\n\tgl_Position = projectionMatrix * mvPosition;\n\t#include <logdepthbuf_vertex>\n\t#include <clipping_planes_vertex>\n\t#include <fog_vertex>\n}",sprite_frag:"uniform vec3 diffuse;\nuniform float opacity;\n#include <common>\n#include <uv_pars_fragment>\n#include <map_pars_fragment>\n#include <alphamap_pars_fragment>\n#include <alphatest_pars_fragment>\n#include <fog_pars_fragment>\n#include <logdepthbuf_pars_fragment>\n#include <clipping_planes_pars_fragment>\nvoid main() {\n\t#include <clipping_planes_fragment>\n\tvec3 outgoingLight = vec3( 0.0 );\n\tvec4 diffuseColor = vec4( diffuse, opacity );\n\t#include <logdepthbuf_fragment>\n\t#include <map_fragment>\n\t#include <alphamap_fragment>\n\t#include <alphatest_fragment>\n\toutgoingLight = diffuseColor.rgb;\n\t#include <output_fragment>\n\t#include <tonemapping_fragment>\n\t#include <encodings_fragment>\n\t#include <fog_fragment>\n}"},xSe={common:{diffuse:{value:new Oke(16777215)},opacity:{value:1},map:{value:null},uvTransform:{value:new bke},uv2Transform:{value:new bke},alphaMap:{value:null},alphaTest:{value:0}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new yke(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Oke(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new Oke(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new bke}},sprite:{diffuse:{value:new Oke(16777215)},opacity:{value:1},center:{value:new yke(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},alphaTest:{value:0},uvTransform:{value:new bke}}},kSe={basic:{uniforms:eSe([xSe.common,xSe.specularmap,xSe.envmap,xSe.aomap,xSe.lightmap,xSe.fog]),vertexShader:bSe.meshbasic_vert,fragmentShader:bSe.meshbasic_frag},lambert:{uniforms:eSe([xSe.common,xSe.specularmap,xSe.envmap,xSe.aomap,xSe.lightmap,xSe.emissivemap,xSe.fog,xSe.lights,{emissive:{value:new Oke(0)}}]),vertexShader:bSe.meshlambert_vert,fragmentShader:bSe.meshlambert_frag},phong:{uniforms:eSe([xSe.common,xSe.specularmap,xSe.envmap,xSe.aomap,xSe.lightmap,xSe.emissivemap,xSe.bumpmap,xSe.normalmap,xSe.displacementmap,xSe.fog,xSe.lights,{emissive:{value:new Oke(0)},specular:{value:new Oke(1118481)},shininess:{value:30}}]),vertexShader:bSe.meshphong_vert,fragmentShader:bSe.meshphong_frag},standard:{uniforms:eSe([xSe.common,xSe.envmap,xSe.aomap,xSe.lightmap,xSe.emissivemap,xSe.bumpmap,xSe.normalmap,xSe.displacementmap,xSe.roughnessmap,xSe.metalnessmap,xSe.fog,xSe.lights,{emissive:{value:new Oke(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:bSe.meshphysical_vert,fragmentShader:bSe.meshphysical_frag},toon:{uniforms:eSe([xSe.common,xSe.aomap,xSe.lightmap,xSe.emissivemap,xSe.bumpmap,xSe.normalmap,xSe.displacementmap,xSe.gradientmap,xSe.fog,xSe.lights,{emissive:{value:new Oke(0)}}]),vertexShader:bSe.meshtoon_vert,fragmentShader:bSe.meshtoon_frag},matcap:{uniforms:eSe([xSe.common,xSe.bumpmap,xSe.normalmap,xSe.displacementmap,xSe.fog,{matcap:{value:null}}]),vertexShader:bSe.meshmatcap_vert,fragmentShader:bSe.meshmatcap_frag},points:{uniforms:eSe([xSe.points,xSe.fog]),vertexShader:bSe.points_vert,fragmentShader:bSe.points_frag},dashed:{uniforms:eSe([xSe.common,xSe.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:bSe.linedashed_vert,fragmentShader:bSe.linedashed_frag},depth:{uniforms:eSe([xSe.common,xSe.displacementmap]),vertexShader:bSe.depth_vert,fragmentShader:bSe.depth_frag},normal:{uniforms:eSe([xSe.common,xSe.bumpmap,xSe.normalmap,xSe.displacementmap,{opacity:{value:1}}]),vertexShader:bSe.meshnormal_vert,fragmentShader:bSe.meshnormal_frag},sprite:{uniforms:eSe([xSe.sprite,xSe.fog]),vertexShader:bSe.sprite_vert,fragmentShader:bSe.sprite_frag},background:{uniforms:{uvTransform:{value:new bke},t2D:{value:null}},vertexShader:bSe.background_vert,fragmentShader:bSe.background_frag},cube:{uniforms:eSe([xSe.envmap,{opacity:{value:1}}]),vertexShader:bSe.cube_vert,fragmentShader:bSe.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:bSe.equirect_vert,fragmentShader:bSe.equirect_frag},distanceRGBA:{uniforms:eSe([xSe.common,xSe.displacementmap,{referencePosition:{value:new Yke},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:bSe.distanceRGBA_vert,fragmentShader:bSe.distanceRGBA_frag},shadow:{uniforms:eSe([xSe.lights,xSe.fog,{color:{value:new Oke(0)},opacity:{value:1}}]),vertexShader:bSe.shadow_vert,fragmentShader:bSe.shadow_frag}};function wSe(e,t,n,r,a,i){var o,s,u=new Oke(0),c=!0===a?0:1,l=null,h=0,f=null;function d(e,t){n.buffers.color.setClear(e.r,e.g,e.b,t,i)}return{getClearColor:function(){return u},setClearColor:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;u.set(e),d(u,c=t)},getClearAlpha:function(){return c},setClearAlpha:function(e){d(u,c=e)},render:function(n,a){var i=!1,p=!0===a.isScene?a.background:null;p&&p.isTexture&&(p=t.get(p));var v=e.xr,m=v.getSession&&v.getSession();m&&"additive"===m.environmentBlendMode&&(p=null),null===p?d(u,c):p&&p.isColor&&(d(p,1),i=!0),(e.autoClear||i)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),p&&(p.isCubeTexture||p.mapping===$ye)?(void 0===s&&((s=new Q_e(new J_e(1,1,1),new nSe({name:"BackgroundCubeMaterial",uniforms:$_e(kSe.cube.uniforms),vertexShader:kSe.cube.vertexShader,fragmentShader:kSe.cube.fragmentShader,side:iye,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),s.geometry.deleteAttribute("uv"),s.onBeforeRender=function(e,t,n){this.matrixWorld.copyPosition(n.matrixWorld)},Object.defineProperty(s.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(s)),s.material.uniforms.envMap.value=p,s.material.uniforms.flipEnvMap.value=p.isCubeTexture&&!1===p.isRenderTargetTexture?-1:1,l===p&&h===p.version&&f===e.toneMapping||(s.material.needsUpdate=!0,l=p,h=p.version,f=e.toneMapping),s.layers.enableAll(),n.unshift(s,s.geometry,s.material,0,0,null)):p&&p.isTexture&&(void 0===o&&((o=new Q_e(new ySe(2,2),new nSe({name:"BackgroundMaterial",uniforms:$_e(kSe.background.uniforms),vertexShader:kSe.background.vertexShader,fragmentShader:kSe.background.fragmentShader,side:aye,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(o.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(o)),o.material.uniforms.t2D.value=p,!0===p.matrixAutoUpdate&&p.updateMatrix(),o.material.uniforms.uvTransform.value.copy(p.matrix),l===p&&h===p.version&&f===e.toneMapping||(o.material.needsUpdate=!0,l=p,h=p.version,f=e.toneMapping),o.layers.enableAll(),n.unshift(o,o.geometry,o.material,0,0,null))}}}function _Se(e,t,n,r){var a=e.getParameter(34921),i=r.isWebGL2?null:t.get("OES_vertex_array_object"),o=r.isWebGL2||null!==i,s={},u=d(null),c=u,l=!1;function h(t){return r.isWebGL2?e.bindVertexArray(t):i.bindVertexArrayOES(t)}function f(t){return r.isWebGL2?e.deleteVertexArray(t):i.deleteVertexArrayOES(t)}function d(e){for(var t=[],n=[],r=[],i=0;i<a;i++)t[i]=0,n[i]=0,r[i]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:t,enabledAttributes:n,attributeDivisors:r,object:e,attributes:{},index:null}}function p(){for(var e=c.newAttributes,t=0,n=e.length;t<n;t++)e[t]=0}function v(e){m(e,0)}function m(n,a){var i=c.newAttributes,o=c.enabledAttributes,s=c.attributeDivisors;(i[n]=1,0===o[n]&&(e.enableVertexAttribArray(n),o[n]=1),s[n]!==a)&&((r.isWebGL2?e:t.get("ANGLE_instanced_arrays"))[r.isWebGL2?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](n,a),s[n]=a)}function g(){for(var t=c.newAttributes,n=c.enabledAttributes,r=0,a=n.length;r<a;r++)n[r]!==t[r]&&(e.disableVertexAttribArray(r),n[r]=0)}function y(t,n,a,i,o,s){!0!==r.isWebGL2||5124!==a&&5125!==a?e.vertexAttribPointer(t,n,a,i,o,s):e.vertexAttribIPointer(t,n,a,o,s)}function b(){x(),l=!0,c!==u&&h((c=u).object)}function x(){u.geometry=null,u.program=null,u.wireframe=!1}return{setup:function(a,u,f,b,x){var k=!1;if(o){var w=function(t,n,a){var o=!0===a.wireframe,u=s[t.id];void 0===u&&(u={},s[t.id]=u);var c=u[n.id];void 0===c&&(c={},u[n.id]=c);var l=c[o];void 0===l&&(l=d(r.isWebGL2?e.createVertexArray():i.createVertexArrayOES()),c[o]=l);return l}(b,f,u);c!==w&&h((c=w).object),k=function(e,t,n,r){var a=c.attributes,i=t.attributes,o=0,s=n.getAttributes();for(var u in s){if(s[u].location>=0){var l=a[u],h=i[u];if(void 0===h&&("instanceMatrix"===u&&e.instanceMatrix&&(h=e.instanceMatrix),"instanceColor"===u&&e.instanceColor&&(h=e.instanceColor)),void 0===l)return!0;if(l.attribute!==h)return!0;if(h&&l.data!==h.data)return!0;o++}}return c.attributesNum!==o||c.index!==r}(a,b,f,x),k&&function(e,t,n,r){var a={},i=t.attributes,o=0,s=n.getAttributes();for(var u in s){if(s[u].location>=0){var l=i[u];void 0===l&&("instanceMatrix"===u&&e.instanceMatrix&&(l=e.instanceMatrix),"instanceColor"===u&&e.instanceColor&&(l=e.instanceColor));var h={};h.attribute=l,l&&l.data&&(h.data=l.data),a[u]=h,o++}}c.attributes=a,c.attributesNum=o,c.index=r}(a,b,f,x)}else{var _=!0===u.wireframe;c.geometry===b.id&&c.program===f.id&&c.wireframe===_||(c.geometry=b.id,c.program=f.id,c.wireframe=_,k=!0)}null!==x&&n.update(x,34963),(k||l)&&(l=!1,function(a,i,o,s){if(!1===r.isWebGL2&&(a.isInstancedMesh||s.isInstancedBufferGeometry)&&null===t.get("ANGLE_instanced_arrays"))return;p();var u=s.attributes,c=o.getAttributes(),l=i.defaultAttributeValues;for(var h in c){var f=c[h];if(f.location>=0){var d=u[h];if(void 0===d&&("instanceMatrix"===h&&a.instanceMatrix&&(d=a.instanceMatrix),"instanceColor"===h&&a.instanceColor&&(d=a.instanceColor)),void 0!==d){var b=d.normalized,x=d.itemSize,k=n.get(d);if(void 0===k)continue;var w=k.buffer,_=k.type,S=k.bytesPerElement;if(d.isInterleavedBufferAttribute){var C=d.data,T=C.stride,E=d.offset;if(C.isInstancedInterleavedBuffer){for(var I=0;I<f.locationSize;I++)m(f.location+I,C.meshPerAttribute);!0!==a.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=C.meshPerAttribute*C.count)}else for(var A=0;A<f.locationSize;A++)v(f.location+A);e.bindBuffer(34962,w);for(var M=0;M<f.locationSize;M++)y(f.location+M,x/f.locationSize,_,b,T*S,(E+x/f.locationSize*M)*S)}else{if(d.isInstancedBufferAttribute){for(var N=0;N<f.locationSize;N++)m(f.location+N,d.meshPerAttribute);!0!==a.isInstancedMesh&&void 0===s._maxInstanceCount&&(s._maxInstanceCount=d.meshPerAttribute*d.count)}else for(var R=0;R<f.locationSize;R++)v(f.location+R);e.bindBuffer(34962,w);for(var D=0;D<f.locationSize;D++)y(f.location+D,x/f.locationSize,_,b,x*S,x/f.locationSize*D*S)}}else if(void 0!==l){var P=l[h];if(void 0!==P)switch(P.length){case 2:e.vertexAttrib2fv(f.location,P);break;case 3:e.vertexAttrib3fv(f.location,P);break;case 4:e.vertexAttrib4fv(f.location,P);break;default:e.vertexAttrib1fv(f.location,P)}}}}g()}(a,u,f,b),null!==x&&e.bindBuffer(34963,n.get(x).buffer))},reset:b,resetDefaultState:x,dispose:function(){for(var e in b(),s){var t=s[e];for(var n in t){var r=t[n];for(var a in r)f(r[a].object),delete r[a];delete t[n]}delete s[e]}},releaseStatesOfGeometry:function(e){if(void 0!==s[e.id]){var t=s[e.id];for(var n in t){var r=t[n];for(var a in r)f(r[a].object),delete r[a];delete t[n]}delete s[e.id]}},releaseStatesOfProgram:function(e){for(var t in s){var n=s[t];if(void 0!==n[e.id]){var r=n[e.id];for(var a in r)f(r[a].object),delete r[a];delete n[e.id]}}},initAttributes:p,enableAttribute:v,disableUnusedAttributes:g}}function SSe(e,t,n,r){var a,i=r.isWebGL2;this.setMode=function(e){a=e},this.render=function(t,r){e.drawArrays(a,t,r),n.update(r,a,1)},this.renderInstances=function(r,o,s){if(0!==s){var u,c;if(i)u=e,c="drawArraysInstanced";else if(c="drawArraysInstancedANGLE",null===(u=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");u[c](a,r,o,s),n.update(o,a,s)}}}function CSe(e,t,n){var r;function a(t){if("highp"===t){if(e.getShaderPrecisionFormat(35633,36338).precision>0&&e.getShaderPrecisionFormat(35632,36338).precision>0)return"highp";t="mediump"}return"mediump"===t&&e.getShaderPrecisionFormat(35633,36337).precision>0&&e.getShaderPrecisionFormat(35632,36337).precision>0?"mediump":"lowp"}var i="undefined"!==typeof WebGL2RenderingContext&&e instanceof WebGL2RenderingContext||"undefined"!==typeof WebGL2ComputeRenderingContext&&e instanceof WebGL2ComputeRenderingContext,o=void 0!==n.precision?n.precision:"highp",s=a(o);s!==o&&(console.warn("THREE.WebGLRenderer:",o,"not supported, using",s,"instead."),o=s);var u=i||t.has("WEBGL_draw_buffers"),c=!0===n.logarithmicDepthBuffer,l=e.getParameter(34930),h=e.getParameter(35660),f=e.getParameter(3379),d=e.getParameter(34076),p=e.getParameter(34921),v=e.getParameter(36347),m=e.getParameter(36348),g=e.getParameter(36349),y=h>0,b=i||t.has("OES_texture_float");return{isWebGL2:i,drawBuffers:u,getMaxAnisotropy:function(){if(void 0!==r)return r;if(!0===t.has("EXT_texture_filter_anisotropic")){var n=t.get("EXT_texture_filter_anisotropic");r=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else r=0;return r},getMaxPrecision:a,precision:o,logarithmicDepthBuffer:c,maxTextures:l,maxVertexTextures:h,maxTextureSize:f,maxCubemapSize:d,maxAttributes:p,maxVertexUniforms:v,maxVaryings:m,maxFragmentUniforms:g,vertexTextures:y,floatFragmentTextures:b,floatVertexTextures:y&&b,maxSamples:i?e.getParameter(36183):0}}function TSe(e){var t=this,n=null,r=0,a=!1,i=!1,o=new fSe,s=new bke,u={value:null,needsUpdate:!1};function c(){u.value!==n&&(u.value=n,u.needsUpdate=r>0),t.numPlanes=r,t.numIntersection=0}function l(e,n,r,a){var i=null!==e?e.length:0,c=null;if(0!==i){if(c=u.value,!0!==a||null===c){var l=r+4*i,h=n.matrixWorldInverse;s.getNormalMatrix(h),(null===c||c.length<l)&&(c=new Float32Array(l));for(var f=0,d=r;f!==i;++f,d+=4)o.copy(e[f]).applyMatrix4(h,s),o.normal.toArray(c,d),c[d+3]=o.constant}u.value=c,u.needsUpdate=!0}return t.numPlanes=i,t.numIntersection=0,c}this.uniform=u,this.numPlanes=0,this.numIntersection=0,this.init=function(e,t,i){var o=0!==e.length||t||0!==r||a;return a=t,n=l(e,i,0),r=e.length,o},this.beginShadows=function(){i=!0,l(null)},this.endShadows=function(){i=!1,c()},this.setState=function(t,o,s){var h=t.clippingPlanes,f=t.clipIntersection,d=t.clipShadows,p=e.get(t);if(!a||null===h||0===h.length||i&&!d)i?l(null):c();else{var v=i?0:r,m=4*v,g=p.clippingState||null;u.value=g,g=l(h,o,m,s);for(var y=0;y!==m;++y)g[y]=n[y];p.clippingState=g,this.numIntersection=f?this.numPlanes:0,this.numPlanes+=v}}}function ESe(e){var t=new WeakMap;function n(e,t){return t===Zye?e.mapping=Yye:t===Jye&&(e.mapping=Qye),e}function r(e){var n=e.target;n.removeEventListener("dispose",r);var a=t.get(n);void 0!==a&&(t.delete(n),a.dispose())}return{get:function(a){if(a&&a.isTexture&&!1===a.isRenderTargetTexture){var i=a.mapping;if(i===Zye||i===Jye){if(t.has(a))return n(t.get(a).texture,a.mapping);var o=a.image;if(o&&o.height>0){var s=new uSe(o.height/2);return s.fromEquirectangularTexture(e,a),t.set(a,s),a.addEventListener("dispose",r),n(s.texture,a.mapping)}return null}}return a},dispose:function(){t=new WeakMap}}}kSe.physical={uniforms:eSe([kSe.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatNormalScale:{value:new yke(1,1)},clearcoatNormalMap:{value:null},iridescence:{value:0},iridescenceMap:{value:null},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},sheen:{value:0},sheenColor:{value:new Oke(0)},sheenColorMap:{value:null},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},transmission:{value:0},transmissionMap:{value:null},transmissionSamplerSize:{value:new yke},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},attenuationDistance:{value:0},attenuationColor:{value:new Oke(0)},specularIntensity:{value:1},specularIntensityMap:{value:null},specularColor:{value:new Oke(1,1,1)},specularColorMap:{value:null}}]),vertexShader:bSe.meshphysical_vert,fragmentShader:bSe.meshphysical_frag};var ISe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:-1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.1,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2e3;return $n(this,n),(e=t.call(this)).isOrthographicCamera=!0,e.type="OrthographicCamera",e.zoom=1,e.view=null,e.left=r,e.right=a,e.top=i,e.bottom=o,e.near=s,e.far=u,e.updateProjectionMatrix(),e}return Jn(n,[{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=null===e.view?null:Object.assign({},e.view),this}},{key:"setViewOffset",value:function(e,t,n,r,a,i){null===this.view&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=r,this.view.width=a,this.view.height=i,this.updateProjectionMatrix()}},{key:"clearViewOffset",value:function(){null!==this.view&&(this.view.enabled=!1),this.updateProjectionMatrix()}},{key:"updateProjectionMatrix",value:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,r=(this.top+this.bottom)/2,a=n-e,i=n+e,o=r+t,s=r-t;if(null!==this.view&&this.view.enabled){var u=(this.right-this.left)/this.view.fullWidth/this.zoom,c=(this.top-this.bottom)/this.view.fullHeight/this.zoom;i=(a+=u*this.view.offsetX)+u*this.view.width,s=(o-=c*this.view.offsetY)-c*this.view.height}this.projectionMatrix.makeOrthographic(a,i,o,s,this.near,this.far),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}},{key:"toJSON",value:function(e){var t=ja(nr(n.prototype),"toJSON",this).call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,null!==this.view&&(t.object.view=Object.assign({},this.view)),t}}]),n}(rSe),ASe=[.125,.215,.35,.446,.526,.582],MSe=20,NSe=new ISe,RSe=new Oke,DSe=null,PSe=(1+Math.sqrt(5))/2,OSe=1/PSe,LSe=[new Yke(1,1,1),new Yke(-1,1,1),new Yke(1,1,-1),new Yke(-1,1,-1),new Yke(0,PSe,OSe),new Yke(0,PSe,-OSe),new Yke(OSe,0,PSe),new Yke(-OSe,0,PSe),new Yke(PSe,OSe,0),new Yke(-PSe,OSe,0)],FSe=function(){function e(t){$n(this,e),this._renderer=t,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}return Jn(e,[{key:"fromScene",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:100;DSe=this._renderer.getRenderTarget(),this._setSize(256);var a=this._allocateTargets();return a.depthBuffer=!0,this._sceneToCubeUV(e,n,r,a),t>0&&this._blur(a,0,0,t),this._applyPMREM(a),this._cleanup(a),a}},{key:"fromEquirectangular",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"fromCubemap",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return this._fromTexture(e,t)}},{key:"compileCubemapShader",value:function(){null===this._cubemapMaterial&&(this._cubemapMaterial=VSe(),this._compileMaterial(this._cubemapMaterial))}},{key:"compileEquirectangularShader",value:function(){null===this._equirectMaterial&&(this._equirectMaterial=USe(),this._compileMaterial(this._equirectMaterial))}},{key:"dispose",value:function(){this._dispose(),null!==this._cubemapMaterial&&this._cubemapMaterial.dispose(),null!==this._equirectMaterial&&this._equirectMaterial.dispose()}},{key:"_setSize",value:function(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}},{key:"_dispose",value:function(){null!==this._blurMaterial&&this._blurMaterial.dispose(),null!==this._pingPongRenderTarget&&this._pingPongRenderTarget.dispose();for(var e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}},{key:"_cleanup",value:function(e){this._renderer.setRenderTarget(DSe),e.scissorTest=!1,BSe(e,0,0,e.width,e.height)}},{key:"_fromTexture",value:function(e,t){e.mapping===Yye||e.mapping===Qye?this._setSize(0===e.image.length?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),DSe=this._renderer.getRenderTarget();var n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}},{key:"_allocateTargets",value:function(){var e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:ube,minFilter:ube,generateMipmaps:!1,type:xbe,format:Tbe,encoding:wxe,depthBuffer:!1},r=zSe(e,t,n);if(null===this._pingPongRenderTarget||this._pingPongRenderTarget.width!==e){null!==this._pingPongRenderTarget&&this._dispose(),this._pingPongRenderTarget=zSe(e,t,n);var a=this._lodMax,i=function(e){for(var t=[],n=[],r=[],a=e,i=e-4+1+ASe.length,o=0;o<i;o++){var s=Math.pow(2,a);n.push(s);var u=1/s;o>e-4?u=ASe[o-e+4-1]:0===o&&(u=0),r.push(u);for(var c=1/(s-2),l=-c,h=1+c,f=[l,l,h,l,h,h,l,l,h,h,l,h],d=6,p=6,v=3,m=2,g=1,y=new Float32Array(v*p*d),b=new Float32Array(m*p*d),x=new Float32Array(g*p*d),k=0;k<d;k++){var w=k%3*2/3-1,_=k>2?0:-1,S=[w,_,0,w+2/3,_,0,w+2/3,_+1,0,w,_,0,w+2/3,_+1,0,w,_+1,0];y.set(S,v*p*k),b.set(f,m*p*k);var C=[k,k,k,k,k,k];x.set(C,g*p*k)}var T=new R_e;T.setAttribute("position",new p_e(y,v)),T.setAttribute("uv",new p_e(b,m)),T.setAttribute("faceIndex",new p_e(x,g)),t.push(T),a>4&&a--}return{lodPlanes:t,sizeLods:n,sigmas:r}}(a);this._sizeLods=i.sizeLods,this._lodPlanes=i.lodPlanes,this._sigmas=i.sigmas,this._blurMaterial=function(e,t,n){var r=new Float32Array(MSe),a=new Yke(0,1,0);return new nSe({name:"SphericalGaussianBlur",defines:{n:MSe,CUBEUV_TEXEL_WIDTH:1/t,CUBEUV_TEXEL_HEIGHT:1/n,CUBEUV_MAX_MIP:"".concat(e,".0")},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:r},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:a}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\t\t\tuniform int samples;\n\t\t\tuniform float weights[ n ];\n\t\t\tuniform bool latitudinal;\n\t\t\tuniform float dTheta;\n\t\t\tuniform float mipInt;\n\t\t\tuniform vec3 poleAxis;\n\n\t\t\t#define ENVMAP_TYPE_CUBE_UV\n\t\t\t#include <cube_uv_reflection_fragment>\n\n\t\t\tvec3 getSample( float theta, vec3 axis ) {\n\n\t\t\t\tfloat cosTheta = cos( theta );\n\t\t\t\t// Rodrigues' axis-angle rotation\n\t\t\t\tvec3 sampleDirection = vOutputDirection * cosTheta\n\t\t\t\t\t+ cross( axis, vOutputDirection ) * sin( theta )\n\t\t\t\t\t+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );\n\n\t\t\t\treturn bilinearCubeUV( envMap, sampleDirection, mipInt );\n\n\t\t\t}\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );\n\n\t\t\t\tif ( all( equal( axis, vec3( 0.0 ) ) ) ) {\n\n\t\t\t\t\taxis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );\n\n\t\t\t\t}\n\n\t\t\t\taxis = normalize( axis );\n\n\t\t\t\tgl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );\n\t\t\t\tgl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );\n\n\t\t\t\tfor ( int i = 1; i < n; i++ ) {\n\n\t\t\t\t\tif ( i >= samples ) {\n\n\t\t\t\t\t\tbreak;\n\n\t\t\t\t\t}\n\n\t\t\t\t\tfloat theta = dTheta * float( i );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );\n\t\t\t\t\tgl_FragColor.rgb += weights[ i ] * getSample( theta, axis );\n\n\t\t\t\t}\n\n\t\t\t}\n\t\t",blending:cye,depthTest:!1,depthWrite:!1})}(a,e,t)}return r}},{key:"_compileMaterial",value:function(e){var t=new Q_e(this._lodPlanes[0],e);this._renderer.compile(t,NSe)}},{key:"_sceneToCubeUV",value:function(e,t,n,r){var a=new aSe(90,1,t,n),i=[1,-1,1,1,1,1],o=[1,1,1,-1,-1,-1],s=this._renderer,u=s.autoClear,c=s.toneMapping;s.getClearColor(RSe),s.toneMapping=Wye,s.autoClear=!1;var l=new h_e({name:"PMREM.Background",side:iye,depthWrite:!1,depthTest:!1}),h=new Q_e(new J_e,l),f=!1,d=e.background;d?d.isColor&&(l.color.copy(d),e.background=null,f=!0):(l.color.copy(RSe),f=!0);for(var p=0;p<6;p++){var v=p%3;0===v?(a.up.set(0,i[p],0),a.lookAt(o[p],0,0)):1===v?(a.up.set(0,0,i[p]),a.lookAt(0,o[p],0)):(a.up.set(0,i[p],0),a.lookAt(0,0,o[p]));var m=this._cubeSize;BSe(r,v*m,p>2?m:0,m,m),s.setRenderTarget(r),f&&s.render(h,a),s.render(e,a)}h.geometry.dispose(),h.material.dispose(),s.toneMapping=c,s.autoClear=u,e.background=d}},{key:"_textureToCubeUV",value:function(e,t){var n=this._renderer,r=e.mapping===Yye||e.mapping===Qye;r?(null===this._cubemapMaterial&&(this._cubemapMaterial=VSe()),this._cubemapMaterial.uniforms.flipEnvMap.value=!1===e.isRenderTargetTexture?-1:1):null===this._equirectMaterial&&(this._equirectMaterial=USe());var a=r?this._cubemapMaterial:this._equirectMaterial,i=new Q_e(this._lodPlanes[0],a);a.uniforms.envMap.value=e;var o=this._cubeSize;BSe(t,0,0,3*o,2*o),n.setRenderTarget(t),n.render(i,NSe)}},{key:"_applyPMREM",value:function(e){var t=this._renderer,n=t.autoClear;t.autoClear=!1;for(var r=1;r<this._lodPlanes.length;r++){var a=Math.sqrt(this._sigmas[r]*this._sigmas[r]-this._sigmas[r-1]*this._sigmas[r-1]),i=LSe[(r-1)%LSe.length];this._blur(e,r-1,r,a,i)}t.autoClear=n}},{key:"_blur",value:function(e,t,n,r,a){var i=this._pingPongRenderTarget;this._halfBlur(e,i,t,n,r,"latitudinal",a),this._halfBlur(i,e,n,n,r,"longitudinal",a)}},{key:"_halfBlur",value:function(e,t,n,r,a,i,o){var s=this._renderer,u=this._blurMaterial;"latitudinal"!==i&&"longitudinal"!==i&&console.error("blur direction must be either latitudinal or longitudinal!");var c=new Q_e(this._lodPlanes[r],u),l=u.uniforms,h=this._sizeLods[n]-1,f=isFinite(a)?Math.PI/(2*h):2*Math.PI/39,d=a/f,p=isFinite(a)?1+Math.floor(3*d):MSe;p>MSe&&console.warn("sigmaRadians, ".concat(a,", is too large and will clip, as it requested ").concat(p," samples when the maximum is set to ").concat(MSe));for(var v=[],m=0,g=0;g<MSe;++g){var y=g/d,b=Math.exp(-y*y/2);v.push(b),0===g?m+=b:g<p&&(m+=2*b)}for(var x=0;x<v.length;x++)v[x]=v[x]/m;l.envMap.value=e.texture,l.samples.value=p,l.weights.value=v,l.latitudinal.value="latitudinal"===i,o&&(l.poleAxis.value=o);var k=this._lodMax;l.dTheta.value=f,l.mipInt.value=k-n;var w=this._sizeLods[r];BSe(t,3*w*(r>k-4?r-k+4:0),4*(this._cubeSize-w),3*w,2*w),s.setRenderTarget(t),s.render(c,NSe)}}]),e}();function zSe(e,t,n){var r=new Wke(e,t,n);return r.texture.mapping=$ye,r.texture.name="PMREM.cubeUv",r.scissorTest=!0,r}function BSe(e,t,n,r,a){e.viewport.set(t,n,r,a),e.scissor.set(t,n,r,a)}function USe(){return new nSe({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform sampler2D envMap;\n\n\t\t\t#include <common>\n\n\t\t\tvoid main() {\n\n\t\t\t\tvec3 outputDirection = normalize( vOutputDirection );\n\t\t\t\tvec2 uv = equirectUv( outputDirection );\n\n\t\t\t\tgl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );\n\n\t\t\t}\n\t\t",blending:cye,depthTest:!1,depthWrite:!1})}function VSe(){return new nSe({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:"\n\n\t\tprecision mediump float;\n\t\tprecision mediump int;\n\n\t\tattribute float faceIndex;\n\n\t\tvarying vec3 vOutputDirection;\n\n\t\t// RH coordinate system; PMREM face-indexing convention\n\t\tvec3 getDirection( vec2 uv, float face ) {\n\n\t\t\tuv = 2.0 * uv - 1.0;\n\n\t\t\tvec3 direction = vec3( uv, 1.0 );\n\n\t\t\tif ( face == 0.0 ) {\n\n\t\t\t\tdirection = direction.zyx; // ( 1, v, u ) pos x\n\n\t\t\t} else if ( face == 1.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xz *= -1.0; // ( -u, 1, -v ) pos y\n\n\t\t\t} else if ( face == 2.0 ) {\n\n\t\t\t\tdirection.x *= -1.0; // ( -u, v, 1 ) pos z\n\n\t\t\t} else if ( face == 3.0 ) {\n\n\t\t\t\tdirection = direction.zyx;\n\t\t\t\tdirection.xz *= -1.0; // ( -1, v, -u ) neg x\n\n\t\t\t} else if ( face == 4.0 ) {\n\n\t\t\t\tdirection = direction.xzy;\n\t\t\t\tdirection.xy *= -1.0; // ( -u, -1, v ) neg y\n\n\t\t\t} else if ( face == 5.0 ) {\n\n\t\t\t\tdirection.z *= -1.0; // ( u, v, -1 ) neg z\n\n\t\t\t}\n\n\t\t\treturn direction;\n\n\t\t}\n\n\t\tvoid main() {\n\n\t\t\tvOutputDirection = getDirection( uv, faceIndex );\n\t\t\tgl_Position = vec4( position, 1.0 );\n\n\t\t}\n\t",fragmentShader:"\n\n\t\t\tprecision mediump float;\n\t\t\tprecision mediump int;\n\n\t\t\tuniform float flipEnvMap;\n\n\t\t\tvarying vec3 vOutputDirection;\n\n\t\t\tuniform samplerCube envMap;\n\n\t\t\tvoid main() {\n\n\t\t\t\tgl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );\n\n\t\t\t}\n\t\t",blending:cye,depthTest:!1,depthWrite:!1})}function WSe(e){var t=new WeakMap,n=null;function r(e){var n=e.target;n.removeEventListener("dispose",r);var a=t.get(n);void 0!==a&&(t.delete(n),a.dispose())}return{get:function(a){if(a&&a.isTexture){var i=a.mapping,o=i===Zye||i===Jye,s=i===Yye||i===Qye;if(o||s){if(a.isRenderTargetTexture&&!0===a.needsPMREMUpdate){a.needsPMREMUpdate=!1;var u=t.get(a);return null===n&&(n=new FSe(e)),u=o?n.fromEquirectangular(a,u):n.fromCubemap(a,u),t.set(a,u),u.texture}if(t.has(a))return t.get(a).texture;var c=a.image;if(o&&c&&c.height>0||s&&c&&function(e){for(var t=0,n=6,r=0;r<n;r++)void 0!==e[r]&&t++;return t===n}(c)){null===n&&(n=new FSe(e));var l=o?n.fromEquirectangular(a):n.fromCubemap(a);return t.set(a,l),a.addEventListener("dispose",r),l.texture}return null}}return a},dispose:function(){t=new WeakMap,null!==n&&(n.dispose(),n=null)}}}function GSe(e){var t={};function n(n){if(void 0!==t[n])return t[n];var r;switch(n){case"WEBGL_depth_texture":r=e.getExtension("WEBGL_depth_texture")||e.getExtension("MOZ_WEBGL_depth_texture")||e.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":r=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":r=e.getExtension("WEBGL_compressed_texture_s3tc")||e.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":r=e.getExtension("WEBGL_compressed_texture_pvrtc")||e.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:r=e.getExtension(n)}return t[n]=r,r}return{has:function(e){return null!==n(e)},init:function(e){e.isWebGL2?n("EXT_color_buffer_float"):(n("WEBGL_depth_texture"),n("OES_texture_float"),n("OES_texture_half_float"),n("OES_texture_half_float_linear"),n("OES_standard_derivatives"),n("OES_element_index_uint"),n("OES_vertex_array_object"),n("ANGLE_instanced_arrays")),n("OES_texture_float_linear"),n("EXT_color_buffer_half_float"),n("WEBGL_multisampled_render_to_texture")},get:function(e){var t=n(e);return null===t&&console.warn("THREE.WebGLRenderer: "+e+" extension not supported."),t}}}function jSe(e,t,n,r){var a={},i=new WeakMap;function o(e){var s=e.target;for(var u in null!==s.index&&t.remove(s.index),s.attributes)t.remove(s.attributes[u]);s.removeEventListener("dispose",o),delete a[s.id];var c=i.get(s);c&&(t.remove(c),i.delete(s)),r.releaseStatesOfGeometry(s),!0===s.isInstancedBufferGeometry&&delete s._maxInstanceCount,n.memory.geometries--}function s(e){var n=[],r=e.index,a=e.attributes.position,o=0;if(null!==r){var s=r.array;o=r.version;for(var u=0,c=s.length;u<c;u+=3){var l=s[u+0],h=s[u+1],f=s[u+2];n.push(l,h,h,f,f,l)}}else{var d=a.array;o=a.version;for(var p=0,v=d.length/3-1;p<v;p+=3){var m=p+0,g=p+1,y=p+2;n.push(m,g,g,y,y,m)}}var b=new(xke(n)?k_e:b_e)(n,1);b.version=o;var x=i.get(e);x&&t.remove(x),i.set(e,b)}return{get:function(e,t){return!0===a[t.id]||(t.addEventListener("dispose",o),a[t.id]=!0,n.memory.geometries++),t},update:function(e){var n=e.attributes;for(var r in n)t.update(n[r],34962);var a=e.morphAttributes;for(var i in a)for(var o=a[i],s=0,u=o.length;s<u;s++)t.update(o[s],34962)},getWireframeAttribute:function(e){var t=i.get(e);if(t){var n=e.index;null!==n&&t.version<n.version&&s(e)}else s(e);return i.get(e)}}}function qSe(e,t,n,r){var a,i,o,s=r.isWebGL2;this.setMode=function(e){a=e},this.setIndex=function(e){i=e.type,o=e.bytesPerElement},this.render=function(t,r){e.drawElements(a,r,i,t*o),n.update(r,a,1)},this.renderInstances=function(r,u,c){if(0!==c){var l,h;if(s)l=e,h="drawElementsInstanced";else if(h="drawElementsInstancedANGLE",null===(l=t.get("ANGLE_instanced_arrays")))return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");l[h](a,u,i,r*o,c),n.update(u,a,c)}}}function HSe(e){var t={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:t,programs:null,autoReset:!0,reset:function(){t.frame++,t.calls=0,t.triangles=0,t.points=0,t.lines=0},update:function(e,n,r){switch(t.calls++,n){case 4:t.triangles+=r*(e/3);break;case 1:t.lines+=r*(e/2);break;case 3:t.lines+=r*(e-1);break;case 2:t.lines+=r*e;break;case 0:t.points+=r*e;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",n)}}}}function XSe(e,t){return e[0]-t[0]}function KSe(e,t){return Math.abs(t[1])-Math.abs(e[1])}function YSe(e,t){var n=1,r=t.isInterleavedBufferAttribute?t.data.array:t.array;r instanceof Int8Array?n=127:r instanceof Uint8Array?n=255:r instanceof Uint16Array?n=65535:r instanceof Int16Array?n=32767:r instanceof Int32Array?n=2147483647:console.error("THREE.WebGLMorphtargets: Unsupported morph attribute data type: ",r),e.divideScalar(n)}function QSe(e,t,n){for(var r={},a=new Float32Array(8),i=new WeakMap,o=new Vke,s=[],u=0;u<8;u++)s[u]=[u,0];return{update:function(u,c,l,h){var f=u.morphTargetInfluences;if(!0===t.isWebGL2){var d=c.morphAttributes.position||c.morphAttributes.normal||c.morphAttributes.color,p=void 0!==d?d.length:0,v=i.get(c);if(void 0===v||v.count!==p){void 0!==v&&v.texture.dispose();var m=void 0!==c.morphAttributes.position,g=void 0!==c.morphAttributes.normal,y=void 0!==c.morphAttributes.color,b=c.morphAttributes.position||[],x=c.morphAttributes.normal||[],k=c.morphAttributes.color||[],w=0;!0===m&&(w=1),!0===g&&(w=2),!0===y&&(w=3);var _=c.attributes.position.count*w,S=1;_>t.maxTextureSize&&(S=Math.ceil(_/t.maxTextureSize),_=t.maxTextureSize);var C=new Float32Array(_*S*4*p),T=new Gke(C,_,S,p);T.type=bbe,T.needsUpdate=!0;for(var E=4*w,I=0;I<p;I++)for(var A=b[I],M=x[I],N=k[I],R=_*S*4*I,D=0;D<A.count;D++){var P=D*E;!0===m&&(o.fromBufferAttribute(A,D),!0===A.normalized&&YSe(o,A),C[R+P+0]=o.x,C[R+P+1]=o.y,C[R+P+2]=o.z,C[R+P+3]=0),!0===g&&(o.fromBufferAttribute(M,D),!0===M.normalized&&YSe(o,M),C[R+P+4]=o.x,C[R+P+5]=o.y,C[R+P+6]=o.z,C[R+P+7]=0),!0===y&&(o.fromBufferAttribute(N,D),!0===N.normalized&&YSe(o,N),C[R+P+8]=o.x,C[R+P+9]=o.y,C[R+P+10]=o.z,C[R+P+11]=4===N.itemSize?o.w:1)}v={count:p,texture:T,size:new yke(_,S)},i.set(c,v),c.addEventListener("dispose",(function e(){T.dispose(),i.delete(c),c.removeEventListener("dispose",e)}))}for(var O=0,L=0;L<f.length;L++)O+=f[L];var F=c.morphTargetsRelative?1:1-O;h.getUniforms().setValue(e,"morphTargetBaseInfluence",F),h.getUniforms().setValue(e,"morphTargetInfluences",f),h.getUniforms().setValue(e,"morphTargetsTexture",v.texture,n),h.getUniforms().setValue(e,"morphTargetsTextureSize",v.size)}else{var z=void 0===f?0:f.length,B=r[c.id];if(void 0===B||B.length!==z){B=[];for(var U=0;U<z;U++)B[U]=[U,0];r[c.id]=B}for(var V=0;V<z;V++){var W=B[V];W[0]=V,W[1]=f[V]}B.sort(KSe);for(var G=0;G<8;G++)G<z&&B[G][1]?(s[G][0]=B[G][0],s[G][1]=B[G][1]):(s[G][0]=Number.MAX_SAFE_INTEGER,s[G][1]=0);s.sort(XSe);for(var j=c.morphAttributes.position,q=c.morphAttributes.normal,H=0,X=0;X<8;X++){var K=s[X],Y=K[0],Q=K[1];Y!==Number.MAX_SAFE_INTEGER&&Q?(j&&c.getAttribute("morphTarget"+X)!==j[Y]&&c.setAttribute("morphTarget"+X,j[Y]),q&&c.getAttribute("morphNormal"+X)!==q[Y]&&c.setAttribute("morphNormal"+X,q[Y]),a[X]=Q,H+=Q):(j&&!0===c.hasAttribute("morphTarget"+X)&&c.deleteAttribute("morphTarget"+X),q&&!0===c.hasAttribute("morphNormal"+X)&&c.deleteAttribute("morphNormal"+X),a[X]=0)}var Z=c.morphTargetsRelative?1:1-H;h.getUniforms().setValue(e,"morphTargetBaseInfluence",Z),h.getUniforms().setValue(e,"morphTargetInfluences",a)}}}}function ZSe(e,t,n,r){var a=new WeakMap;function i(e){var t=e.target;t.removeEventListener("dispose",i),n.remove(t.instanceMatrix),null!==t.instanceColor&&n.remove(t.instanceColor)}return{update:function(e){var o=r.render.frame,s=e.geometry,u=t.get(e,s);return a.get(u)!==o&&(t.update(u),a.set(u,o)),e.isInstancedMesh&&(!1===e.hasEventListener("dispose",i)&&e.addEventListener("dispose",i),n.update(e.instanceMatrix,34962),null!==e.instanceColor&&n.update(e.instanceColor,34962)),u},dispose:function(){a=new WeakMap}}}var JSe=new Uke,$Se=new Gke,eCe=new qke,tCe=new sSe,nCe=[],rCe=[],aCe=new Float32Array(16),iCe=new Float32Array(9),oCe=new Float32Array(4);function sCe(e,t,n){var r=e[0];if(r<=0||r>0)return e;var a=t*n,i=nCe[a];if(void 0===i&&(i=new Float32Array(a),nCe[a]=i),0!==t){r.toArray(i,0);for(var o=1,s=0;o!==t;++o)s+=n,e[o].toArray(i,s)}return i}function uCe(e,t){if(e.length!==t.length)return!1;for(var n=0,r=e.length;n<r;n++)if(e[n]!==t[n])return!1;return!0}function cCe(e,t){for(var n=0,r=t.length;n<r;n++)e[n]=t[n]}function lCe(e,t){var n=rCe[t];void 0===n&&(n=new Int32Array(t),rCe[t]=n);for(var r=0;r!==t;++r)n[r]=e.allocateTextureUnit();return n}function hCe(e,t){var n=this.cache;n[0]!==t&&(e.uniform1f(this.addr,t),n[0]=t)}function fCe(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),n[0]=t.x,n[1]=t.y);else{if(uCe(n,t))return;e.uniform2fv(this.addr,t),cCe(n,t)}}function dCe(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),n[0]=t.x,n[1]=t.y,n[2]=t.z);else if(void 0!==t.r)n[0]===t.r&&n[1]===t.g&&n[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),n[0]=t.r,n[1]=t.g,n[2]=t.b);else{if(uCe(n,t))return;e.uniform3fv(this.addr,t),cCe(n,t)}}function pCe(e,t){var n=this.cache;if(void 0!==t.x)n[0]===t.x&&n[1]===t.y&&n[2]===t.z&&n[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),n[0]=t.x,n[1]=t.y,n[2]=t.z,n[3]=t.w);else{if(uCe(n,t))return;e.uniform4fv(this.addr,t),cCe(n,t)}}function vCe(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(uCe(n,t))return;e.uniformMatrix2fv(this.addr,!1,t),cCe(n,t)}else{if(uCe(n,r))return;oCe.set(r),e.uniformMatrix2fv(this.addr,!1,oCe),cCe(n,r)}}function mCe(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(uCe(n,t))return;e.uniformMatrix3fv(this.addr,!1,t),cCe(n,t)}else{if(uCe(n,r))return;iCe.set(r),e.uniformMatrix3fv(this.addr,!1,iCe),cCe(n,r)}}function gCe(e,t){var n=this.cache,r=t.elements;if(void 0===r){if(uCe(n,t))return;e.uniformMatrix4fv(this.addr,!1,t),cCe(n,t)}else{if(uCe(n,r))return;aCe.set(r),e.uniformMatrix4fv(this.addr,!1,aCe),cCe(n,r)}}function yCe(e,t){var n=this.cache;n[0]!==t&&(e.uniform1i(this.addr,t),n[0]=t)}function bCe(e,t){var n=this.cache;uCe(n,t)||(e.uniform2iv(this.addr,t),cCe(n,t))}function xCe(e,t){var n=this.cache;uCe(n,t)||(e.uniform3iv(this.addr,t),cCe(n,t))}function kCe(e,t){var n=this.cache;uCe(n,t)||(e.uniform4iv(this.addr,t),cCe(n,t))}function wCe(e,t){var n=this.cache;n[0]!==t&&(e.uniform1ui(this.addr,t),n[0]=t)}function _Ce(e,t){var n=this.cache;uCe(n,t)||(e.uniform2uiv(this.addr,t),cCe(n,t))}function SCe(e,t){var n=this.cache;uCe(n,t)||(e.uniform3uiv(this.addr,t),cCe(n,t))}function CCe(e,t){var n=this.cache;uCe(n,t)||(e.uniform4uiv(this.addr,t),cCe(n,t))}function TCe(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture2D(t||JSe,a)}function ECe(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture3D(t||eCe,a)}function ICe(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTextureCube(t||tCe,a)}function ACe(e,t,n){var r=this.cache,a=n.allocateTextureUnit();r[0]!==a&&(e.uniform1i(this.addr,a),r[0]=a),n.setTexture2DArray(t||$Se,a)}function MCe(e,t){e.uniform1fv(this.addr,t)}function NCe(e,t){var n=sCe(t,this.size,2);e.uniform2fv(this.addr,n)}function RCe(e,t){var n=sCe(t,this.size,3);e.uniform3fv(this.addr,n)}function DCe(e,t){var n=sCe(t,this.size,4);e.uniform4fv(this.addr,n)}function PCe(e,t){var n=sCe(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,n)}function OCe(e,t){var n=sCe(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,n)}function LCe(e,t){var n=sCe(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,n)}function FCe(e,t){e.uniform1iv(this.addr,t)}function zCe(e,t){e.uniform2iv(this.addr,t)}function BCe(e,t){e.uniform3iv(this.addr,t)}function UCe(e,t){e.uniform4iv(this.addr,t)}function VCe(e,t){e.uniform1uiv(this.addr,t)}function WCe(e,t){e.uniform2uiv(this.addr,t)}function GCe(e,t){e.uniform3uiv(this.addr,t)}function jCe(e,t){e.uniform4uiv(this.addr,t)}function qCe(e,t,n){var r=t.length,a=lCe(n,r);e.uniform1iv(this.addr,a);for(var i=0;i!==r;++i)n.setTexture2D(t[i]||JSe,a[i])}function HCe(e,t,n){var r=t.length,a=lCe(n,r);e.uniform1iv(this.addr,a);for(var i=0;i!==r;++i)n.setTexture3D(t[i]||eCe,a[i])}function XCe(e,t,n){var r=t.length,a=lCe(n,r);e.uniform1iv(this.addr,a);for(var i=0;i!==r;++i)n.setTextureCube(t[i]||tCe,a[i])}function KCe(e,t,n){var r=t.length,a=lCe(n,r);e.uniform1iv(this.addr,a);for(var i=0;i!==r;++i)n.setTexture2DArray(t[i]||$Se,a[i])}var YCe=Jn((function e(t,n,r){$n(this,e),this.id=t,this.addr=r,this.cache=[],this.setValue=function(e){switch(e){case 5126:return hCe;case 35664:return fCe;case 35665:return dCe;case 35666:return pCe;case 35674:return vCe;case 35675:return mCe;case 35676:return gCe;case 5124:case 35670:return yCe;case 35667:case 35671:return bCe;case 35668:case 35672:return xCe;case 35669:case 35673:return kCe;case 5125:return wCe;case 36294:return _Ce;case 36295:return SCe;case 36296:return CCe;case 35678:case 36198:case 36298:case 36306:case 35682:return TCe;case 35679:case 36299:case 36307:return ECe;case 35680:case 36300:case 36308:case 36293:return ICe;case 36289:case 36303:case 36311:case 36292:return ACe}}(n.type)})),QCe=Jn((function e(t,n,r){$n(this,e),this.id=t,this.addr=r,this.cache=[],this.size=n.size,this.setValue=function(e){switch(e){case 5126:return MCe;case 35664:return NCe;case 35665:return RCe;case 35666:return DCe;case 35674:return PCe;case 35675:return OCe;case 35676:return LCe;case 5124:case 35670:return FCe;case 35667:case 35671:return zCe;case 35668:case 35672:return BCe;case 35669:case 35673:return UCe;case 5125:return VCe;case 36294:return WCe;case 36295:return GCe;case 36296:return jCe;case 35678:case 36198:case 36298:case 36306:case 35682:return qCe;case 35679:case 36299:case 36307:return HCe;case 35680:case 36300:case 36308:case 36293:return XCe;case 36289:case 36303:case 36311:case 36292:return KCe}}(n.type)})),ZCe=function(){function e(t){$n(this,e),this.id=t,this.seq=[],this.map={}}return Jn(e,[{key:"setValue",value:function(e,t,n){for(var r=this.seq,a=0,i=r.length;a!==i;++a){var o=r[a];o.setValue(e,t[o.id],n)}}}]),e}(),JCe=/(\w+)(\])?(\[|\.)?/g;function $Ce(e,t){e.seq.push(t),e.map[t.id]=t}function eTe(e,t,n){var r=e.name,a=r.length;for(JCe.lastIndex=0;;){var i=JCe.exec(r),o=JCe.lastIndex,s=i[1],u="]"===i[2],c=i[3];if(u&&(s|=0),void 0===c||"["===c&&o+2===a){$Ce(n,void 0===c?new YCe(s,e,t):new QCe(s,e,t));break}var l=n.map[s];void 0===l&&$Ce(n,l=new ZCe(s)),n=l}}var tTe=function(){function e(t,n){$n(this,e),this.seq=[],this.map={};for(var r=t.getProgramParameter(n,35718),a=0;a<r;++a){var i=t.getActiveUniform(n,a);eTe(i,t.getUniformLocation(n,i.name),this)}}return Jn(e,[{key:"setValue",value:function(e,t,n,r){var a=this.map[t];void 0!==a&&a.setValue(e,n,r)}},{key:"setOptional",value:function(e,t,n){var r=t[n];void 0!==r&&this.setValue(e,n,r)}}],[{key:"upload",value:function(e,t,n,r){for(var a=0,i=t.length;a!==i;++a){var o=t[a],s=n[o.id];!1!==s.needsUpdate&&o.setValue(e,s.value,r)}}},{key:"seqWithValue",value:function(e,t){for(var n=[],r=0,a=e.length;r!==a;++r){var i=e[r];i.id in t&&n.push(i)}return n}}]),e}();function nTe(e,t,n){var r=e.createShader(t);return e.shaderSource(r,n),e.compileShader(r),r}var rTe=0;function aTe(e,t,n){var r=e.getShaderParameter(t,35713),a=e.getShaderInfoLog(t).trim();if(r&&""===a)return"";var i=/ERROR: 0:(\d+)/.exec(a);if(i){var o=parseInt(i[1]);return n.toUpperCase()+"\n\n"+a+"\n\n"+function(e,t){for(var n=e.split("\n"),r=[],a=Math.max(t-6,0),i=Math.min(t+6,n.length),o=a;o<i;o++){var s=o+1;r.push("".concat(s===t?">":" "," ").concat(s,": ").concat(n[o]))}return r.join("\n")}(e.getShaderSource(t),o)}return a}function iTe(e,t){var n=function(e){switch(e){case wxe:return["Linear","( value )"];case _xe:return["sRGB","( value )"];default:return console.warn("THREE.WebGLProgram: Unsupported encoding:",e),["Linear","( value )"]}}(t);return"vec4 "+e+"( vec4 value ) { return LinearTo"+n[0]+n[1]+"; }"}function oTe(e,t){var n;switch(t){case Gye:n="Linear";break;case jye:n="Reinhard";break;case qye:n="OptimizedCineon";break;case Hye:n="ACESFilmic";break;case Xye:n="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",t),n="Linear"}return"vec3 "+e+"( vec3 color ) { return "+n+"ToneMapping( color ); }"}function sTe(e){return""!==e}function uTe(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function cTe(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var lTe=/^[ \t]*#include +<([\w\d./]+)>/gm;function hTe(e){return e.replace(lTe,fTe)}function fTe(e,t){var n=bSe[t];if(void 0===n)throw new Error("Can not resolve #include <"+t+">");return hTe(n)}var dTe=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g,pTe=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function vTe(e){return e.replace(pTe,gTe).replace(dTe,mTe)}function mTe(e,t,n,r){return console.warn("WebGLProgram: #pragma unroll_loop shader syntax is deprecated. Please use #pragma unroll_loop_start syntax instead."),gTe(e,t,n,r)}function gTe(e,t,n,r){for(var a="",i=parseInt(t);i<parseInt(n);i++)a+=r.replace(/\[\s*i\s*\]/g,"[ "+i+" ]").replace(/UNROLLED_LOOP_INDEX/g,i);return a}function yTe(e){var t="precision "+e.precision+" float;\nprecision "+e.precision+" int;";return"highp"===e.precision?t+="\n#define HIGH_PRECISION":"mediump"===e.precision?t+="\n#define MEDIUM_PRECISION":"lowp"===e.precision&&(t+="\n#define LOW_PRECISION"),t}function bTe(e,t,n,r){var a,i,o=e.getContext(),s=n.defines,u=n.vertexShader,c=n.fragmentShader,l=function(e){var t="SHADOWMAP_TYPE_BASIC";return e.shadowMapType===tye?t="SHADOWMAP_TYPE_PCF":e.shadowMapType===nye?t="SHADOWMAP_TYPE_PCF_SOFT":e.shadowMapType===rye&&(t="SHADOWMAP_TYPE_VSM"),t}(n),h=function(e){var t="ENVMAP_TYPE_CUBE";if(e.envMap)switch(e.envMapMode){case Yye:case Qye:t="ENVMAP_TYPE_CUBE";break;case $ye:t="ENVMAP_TYPE_CUBE_UV"}return t}(n),f=function(e){var t="ENVMAP_MODE_REFLECTION";e.envMap&&e.envMapMode===Qye&&(t="ENVMAP_MODE_REFRACTION");return t}(n),d=function(e){var t="ENVMAP_BLENDING_NONE";if(e.envMap)switch(e.combine){case Bye:t="ENVMAP_BLENDING_MULTIPLY";break;case Uye:t="ENVMAP_BLENDING_MIX";break;case Vye:t="ENVMAP_BLENDING_ADD"}return t}(n),p=function(e){var t=e.envMapCubeUVHeight;if(null===t)return null;var n=Math.log2(t)-2,r=1/t;return{texelWidth:1/(3*Math.max(Math.pow(2,n),112)),texelHeight:r,maxMip:n}}(n),v=n.isWebGL2?"":function(e){return[e.extensionDerivatives||e.envMapCubeUVHeight||e.bumpMap||e.tangentSpaceNormalMap||e.clearcoatNormalMap||e.flatShading||"physical"===e.shaderID?"#extension GL_OES_standard_derivatives : enable":"",(e.extensionFragDepth||e.logarithmicDepthBuffer)&&e.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",e.extensionDrawBuffers&&e.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(e.extensionShaderTextureLOD||e.envMap||e.transmission)&&e.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(sTe).join("\n")}(n),m=function(e){var t=[];for(var n in e){var r=e[n];!1!==r&&t.push("#define "+n+" "+r)}return t.join("\n")}(s),g=o.createProgram(),y=n.glslVersion?"#version "+n.glslVersion+"\n":"";n.isRawShaderMaterial?((a=[m].filter(sTe).join("\n")).length>0&&(a+="\n"),(i=[v,m].filter(sTe).join("\n")).length>0&&(i+="\n")):(a=[yTe(n),"#define SHADER_NAME "+n.shaderName,m,n.instancing?"#define USE_INSTANCING":"",n.instancingColor?"#define USE_INSTANCING_COLOR":"",n.supportsVertexTextures?"#define VERTEX_TEXTURES":"",n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+f:"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.displacementMap&&n.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.flatShading?"#define FLAT_SHADED":"",n.skinning?"#define USE_SKINNING":"",n.morphTargets?"#define USE_MORPHTARGETS":"",n.morphNormals&&!1===n.flatShading?"#define USE_MORPHNORMALS":"",n.morphColors&&n.isWebGL2?"#define USE_MORPHCOLORS":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE":"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_TEXTURE_STRIDE "+n.morphTextureStride:"",n.morphTargetsCount>0&&n.isWebGL2?"#define MORPHTARGETS_COUNT "+n.morphTargetsCount:"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.sizeAttenuation?"#define USE_SIZEATTENUATION":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","\tattribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","\tattribute vec3 instanceColor;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","\tattribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","\tattribute vec4 color;","#elif defined( USE_COLOR )","\tattribute vec3 color;","#endif","#if ( defined( USE_MORPHTARGETS ) && ! defined( MORPHTARGETS_TEXTURE ) )","\tattribute vec3 morphTarget0;","\tattribute vec3 morphTarget1;","\tattribute vec3 morphTarget2;","\tattribute vec3 morphTarget3;","\t#ifdef USE_MORPHNORMALS","\t\tattribute vec3 morphNormal0;","\t\tattribute vec3 morphNormal1;","\t\tattribute vec3 morphNormal2;","\t\tattribute vec3 morphNormal3;","\t#else","\t\tattribute vec3 morphTarget4;","\t\tattribute vec3 morphTarget5;","\t\tattribute vec3 morphTarget6;","\t\tattribute vec3 morphTarget7;","\t#endif","#endif","#ifdef USE_SKINNING","\tattribute vec4 skinIndex;","\tattribute vec4 skinWeight;","#endif","\n"].filter(sTe).join("\n"),i=[v,yTe(n),"#define SHADER_NAME "+n.shaderName,m,n.useFog&&n.fog?"#define USE_FOG":"",n.useFog&&n.fogExp2?"#define FOG_EXP2":"",n.map?"#define USE_MAP":"",n.matcap?"#define USE_MATCAP":"",n.envMap?"#define USE_ENVMAP":"",n.envMap?"#define "+h:"",n.envMap?"#define "+f:"",n.envMap?"#define "+d:"",p?"#define CUBEUV_TEXEL_WIDTH "+p.texelWidth:"",p?"#define CUBEUV_TEXEL_HEIGHT "+p.texelHeight:"",p?"#define CUBEUV_MAX_MIP "+p.maxMip+".0":"",n.lightMap?"#define USE_LIGHTMAP":"",n.aoMap?"#define USE_AOMAP":"",n.emissiveMap?"#define USE_EMISSIVEMAP":"",n.bumpMap?"#define USE_BUMPMAP":"",n.normalMap?"#define USE_NORMALMAP":"",n.normalMap&&n.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",n.normalMap&&n.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",n.clearcoat?"#define USE_CLEARCOAT":"",n.clearcoatMap?"#define USE_CLEARCOATMAP":"",n.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",n.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",n.iridescence?"#define USE_IRIDESCENCE":"",n.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",n.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",n.specularMap?"#define USE_SPECULARMAP":"",n.specularIntensityMap?"#define USE_SPECULARINTENSITYMAP":"",n.specularColorMap?"#define USE_SPECULARCOLORMAP":"",n.roughnessMap?"#define USE_ROUGHNESSMAP":"",n.metalnessMap?"#define USE_METALNESSMAP":"",n.alphaMap?"#define USE_ALPHAMAP":"",n.alphaTest?"#define USE_ALPHATEST":"",n.sheen?"#define USE_SHEEN":"",n.sheenColorMap?"#define USE_SHEENCOLORMAP":"",n.sheenRoughnessMap?"#define USE_SHEENROUGHNESSMAP":"",n.transmission?"#define USE_TRANSMISSION":"",n.transmissionMap?"#define USE_TRANSMISSIONMAP":"",n.thicknessMap?"#define USE_THICKNESSMAP":"",n.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",n.vertexTangents?"#define USE_TANGENT":"",n.vertexColors||n.instancingColor?"#define USE_COLOR":"",n.vertexAlphas?"#define USE_COLOR_ALPHA":"",n.vertexUvs?"#define USE_UV":"",n.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",n.gradientMap?"#define USE_GRADIENTMAP":"",n.flatShading?"#define FLAT_SHADED":"",n.doubleSided?"#define DOUBLE_SIDED":"",n.flipSided?"#define FLIP_SIDED":"",n.shadowMapEnabled?"#define USE_SHADOWMAP":"",n.shadowMapEnabled?"#define "+l:"",n.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",n.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",n.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",n.logarithmicDepthBuffer&&n.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",n.toneMapping!==Wye?"#define TONE_MAPPING":"",n.toneMapping!==Wye?bSe.tonemapping_pars_fragment:"",n.toneMapping!==Wye?oTe("toneMapping",n.toneMapping):"",n.dithering?"#define DITHERING":"",n.opaque?"#define OPAQUE":"",bSe.encodings_pars_fragment,iTe("linearToOutputTexel",n.outputEncoding),n.useDepthPacking?"#define DEPTH_PACKING "+n.depthPacking:"","\n"].filter(sTe).join("\n")),u=cTe(u=uTe(u=hTe(u),n),n),c=cTe(c=uTe(c=hTe(c),n),n),u=vTe(u),c=vTe(c),n.isWebGL2&&!0!==n.isRawShaderMaterial&&(y="#version 300 es\n",a=["precision mediump sampler2DArray;","#define attribute in","#define varying out","#define texture2D texture"].join("\n")+"\n"+a,i=["#define varying in",n.glslVersion===rke?"":"layout(location = 0) out highp vec4 pc_fragColor;",n.glslVersion===rke?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join("\n")+"\n"+i);var b,x,k=y+i+c,w=nTe(o,35633,y+a+u),_=nTe(o,35632,k);if(o.attachShader(g,w),o.attachShader(g,_),void 0!==n.index0AttributeName?o.bindAttribLocation(g,0,n.index0AttributeName):!0===n.morphTargets&&o.bindAttribLocation(g,0,"position"),o.linkProgram(g),e.debug.checkShaderErrors){var S=o.getProgramInfoLog(g).trim(),C=o.getShaderInfoLog(w).trim(),T=o.getShaderInfoLog(_).trim(),E=!0,I=!0;if(!1===o.getProgramParameter(g,35714)){E=!1;var A=aTe(o,w,"vertex"),M=aTe(o,_,"fragment");console.error("THREE.WebGLProgram: Shader Error "+o.getError()+" - VALIDATE_STATUS "+o.getProgramParameter(g,35715)+"\n\nProgram Info Log: "+S+"\n"+A+"\n"+M)}else""!==S?console.warn("THREE.WebGLProgram: Program Info Log:",S):""!==C&&""!==T||(I=!1);I&&(this.diagnostics={runnable:E,programLog:S,vertexShader:{log:C,prefix:a},fragmentShader:{log:T,prefix:i}})}return o.deleteShader(w),o.deleteShader(_),this.getUniforms=function(){return void 0===b&&(b=new tTe(o,g)),b},this.getAttributes=function(){return void 0===x&&(x=function(e,t){for(var n={},r=e.getProgramParameter(t,35721),a=0;a<r;a++){var i=e.getActiveAttrib(t,a),o=i.name,s=1;35674===i.type&&(s=2),35675===i.type&&(s=3),35676===i.type&&(s=4),n[o]={type:i.type,location:e.getAttribLocation(t,o),locationSize:s}}return n}(o,g)),x},this.destroy=function(){r.releaseStatesOfProgram(this),o.deleteProgram(g),this.program=void 0},this.name=n.shaderName,this.id=rTe++,this.cacheKey=t,this.usedTimes=1,this.program=g,this.vertexShader=w,this.fragmentShader=_,this}var xTe=0,kTe=function(){function e(){$n(this,e),this.shaderCache=new Map,this.materialCache=new Map}return Jn(e,[{key:"update",value:function(e){var t=e.vertexShader,n=e.fragmentShader,r=this._getShaderStage(t),a=this._getShaderStage(n),i=this._getShaderCacheForMaterial(e);return!1===i.has(r)&&(i.add(r),r.usedTimes++),!1===i.has(a)&&(i.add(a),a.usedTimes++),this}},{key:"remove",value:function(e){var t,n=al(this.materialCache.get(e));try{for(n.s();!(t=n.n()).done;){var r=t.value;r.usedTimes--,0===r.usedTimes&&this.shaderCache.delete(r.code)}}catch($Pe){n.e($Pe)}finally{n.f()}return this.materialCache.delete(e),this}},{key:"getVertexShaderID",value:function(e){return this._getShaderStage(e.vertexShader).id}},{key:"getFragmentShaderID",value:function(e){return this._getShaderStage(e.fragmentShader).id}},{key:"dispose",value:function(){this.shaderCache.clear(),this.materialCache.clear()}},{key:"_getShaderCacheForMaterial",value:function(e){var t=this.materialCache;return!1===t.has(e)&&t.set(e,new Set),t.get(e)}},{key:"_getShaderStage",value:function(e){var t=this.shaderCache;if(!1===t.has(e)){var n=new wTe(e);t.set(e,n)}return t.get(e)}}]),e}(),wTe=Jn((function e(t){$n(this,e),this.id=xTe++,this.code=t,this.usedTimes=0}));function _Te(e,t,n,r,a,i,o){var s=new Fwe,u=new kTe,c=[],l=a.isWebGL2,h=a.logarithmicDepthBuffer,f=a.vertexTextures,d=a.precision,p={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};return{getParameters:function(i,s,c,v,m){var g=v.fog,y=m.geometry,b=i.isMeshStandardMaterial?v.environment:null,x=(i.isMeshStandardMaterial?n:t).get(i.envMap||b),k=x&&x.mapping===$ye?x.image.height:null,w=p[i.type];null!==i.precision&&(d=a.getMaxPrecision(i.precision))!==i.precision&&console.warn("THREE.WebGLProgram.getParameters:",i.precision,"not supported, using",d,"instead.");var _,S,C,T,E=y.morphAttributes.position||y.morphAttributes.normal||y.morphAttributes.color,I=void 0!==E?E.length:0,A=0;if(void 0!==y.morphAttributes.position&&(A=1),void 0!==y.morphAttributes.normal&&(A=2),void 0!==y.morphAttributes.color&&(A=3),w){var M=kSe[w];_=M.vertexShader,S=M.fragmentShader}else _=i.vertexShader,S=i.fragmentShader,u.update(i),C=u.getVertexShaderID(i),T=u.getFragmentShaderID(i);var N=e.getRenderTarget(),R=i.alphaTest>0,D=i.clearcoat>0,P=i.iridescence>0;return{isWebGL2:l,shaderID:w,shaderName:i.type,vertexShader:_,fragmentShader:S,defines:i.defines,customVertexShaderID:C,customFragmentShaderID:T,isRawShaderMaterial:!0===i.isRawShaderMaterial,glslVersion:i.glslVersion,precision:d,instancing:!0===m.isInstancedMesh,instancingColor:!0===m.isInstancedMesh&&null!==m.instanceColor,supportsVertexTextures:f,outputEncoding:null===N?e.outputEncoding:!0===N.isXRRenderTarget?N.texture.encoding:wxe,map:!!i.map,matcap:!!i.matcap,envMap:!!x,envMapMode:x&&x.mapping,envMapCubeUVHeight:k,lightMap:!!i.lightMap,aoMap:!!i.aoMap,emissiveMap:!!i.emissiveMap,bumpMap:!!i.bumpMap,normalMap:!!i.normalMap,objectSpaceNormalMap:i.normalMapType===Exe,tangentSpaceNormalMap:i.normalMapType===Txe,decodeVideoTexture:!!i.map&&!0===i.map.isVideoTexture&&i.map.encoding===_xe,clearcoat:D,clearcoatMap:D&&!!i.clearcoatMap,clearcoatRoughnessMap:D&&!!i.clearcoatRoughnessMap,clearcoatNormalMap:D&&!!i.clearcoatNormalMap,iridescence:P,iridescenceMap:P&&!!i.iridescenceMap,iridescenceThicknessMap:P&&!!i.iridescenceThicknessMap,displacementMap:!!i.displacementMap,roughnessMap:!!i.roughnessMap,metalnessMap:!!i.metalnessMap,specularMap:!!i.specularMap,specularIntensityMap:!!i.specularIntensityMap,specularColorMap:!!i.specularColorMap,opaque:!1===i.transparent&&i.blending===lye,alphaMap:!!i.alphaMap,alphaTest:R,gradientMap:!!i.gradientMap,sheen:i.sheen>0,sheenColorMap:!!i.sheenColorMap,sheenRoughnessMap:!!i.sheenRoughnessMap,transmission:i.transmission>0,transmissionMap:!!i.transmissionMap,thicknessMap:!!i.thicknessMap,combine:i.combine,vertexTangents:!!i.normalMap&&!!y.attributes.tangent,vertexColors:i.vertexColors,vertexAlphas:!0===i.vertexColors&&!!y.attributes.color&&4===y.attributes.color.itemSize,vertexUvs:!!i.map||!!i.bumpMap||!!i.normalMap||!!i.specularMap||!!i.alphaMap||!!i.emissiveMap||!!i.roughnessMap||!!i.metalnessMap||!!i.clearcoatMap||!!i.clearcoatRoughnessMap||!!i.clearcoatNormalMap||!!i.iridescenceMap||!!i.iridescenceThicknessMap||!!i.displacementMap||!!i.transmissionMap||!!i.thicknessMap||!!i.specularIntensityMap||!!i.specularColorMap||!!i.sheenColorMap||!!i.sheenRoughnessMap,uvsVertexOnly:!(i.map||i.bumpMap||i.normalMap||i.specularMap||i.alphaMap||i.emissiveMap||i.roughnessMap||i.metalnessMap||i.clearcoatNormalMap||i.iridescenceMap||i.iridescenceThicknessMap||i.transmission>0||i.transmissionMap||i.thicknessMap||i.specularIntensityMap||i.specularColorMap||i.sheen>0||i.sheenColorMap||i.sheenRoughnessMap)&&!!i.displacementMap,fog:!!g,useFog:!0===i.fog,fogExp2:g&&g.isFogExp2,flatShading:!!i.flatShading,sizeAttenuation:i.sizeAttenuation,logarithmicDepthBuffer:h,skinning:!0===m.isSkinnedMesh,morphTargets:void 0!==y.morphAttributes.position,morphNormals:void 0!==y.morphAttributes.normal,morphColors:void 0!==y.morphAttributes.color,morphTargetsCount:I,morphTextureStride:A,numDirLights:s.directional.length,numPointLights:s.point.length,numSpotLights:s.spot.length,numRectAreaLights:s.rectArea.length,numHemiLights:s.hemi.length,numDirLightShadows:s.directionalShadowMap.length,numPointLightShadows:s.pointShadowMap.length,numSpotLightShadows:s.spotShadowMap.length,numClippingPlanes:o.numPlanes,numClipIntersection:o.numIntersection,dithering:i.dithering,shadowMapEnabled:e.shadowMap.enabled&&c.length>0,shadowMapType:e.shadowMap.type,toneMapping:i.toneMapped?e.toneMapping:Wye,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:i.premultipliedAlpha,doubleSided:i.side===oye,flipSided:i.side===iye,useDepthPacking:!!i.depthPacking,depthPacking:i.depthPacking||0,index0AttributeName:i.index0AttributeName,extensionDerivatives:i.extensions&&i.extensions.derivatives,extensionFragDepth:i.extensions&&i.extensions.fragDepth,extensionDrawBuffers:i.extensions&&i.extensions.drawBuffers,extensionShaderTextureLOD:i.extensions&&i.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||r.has("EXT_frag_depth"),rendererExtensionDrawBuffers:l||r.has("WEBGL_draw_buffers"),rendererExtensionShaderTextureLod:l||r.has("EXT_shader_texture_lod"),customProgramCacheKey:i.customProgramCacheKey()}},getProgramCacheKey:function(t){var n=[];if(t.shaderID?n.push(t.shaderID):(n.push(t.customVertexShaderID),n.push(t.customFragmentShaderID)),void 0!==t.defines)for(var r in t.defines)n.push(r),n.push(t.defines[r]);return!1===t.isRawShaderMaterial&&(!function(e,t){e.push(t.precision),e.push(t.outputEncoding),e.push(t.envMapMode),e.push(t.envMapCubeUVHeight),e.push(t.combine),e.push(t.vertexUvs),e.push(t.fogExp2),e.push(t.sizeAttenuation),e.push(t.morphTargetsCount),e.push(t.morphAttributeCount),e.push(t.numDirLights),e.push(t.numPointLights),e.push(t.numSpotLights),e.push(t.numHemiLights),e.push(t.numRectAreaLights),e.push(t.numDirLightShadows),e.push(t.numPointLightShadows),e.push(t.numSpotLightShadows),e.push(t.shadowMapType),e.push(t.toneMapping),e.push(t.numClippingPlanes),e.push(t.numClipIntersection),e.push(t.depthPacking)}(n,t),function(e,t){s.disableAll(),t.isWebGL2&&s.enable(0);t.supportsVertexTextures&&s.enable(1);t.instancing&&s.enable(2);t.instancingColor&&s.enable(3);t.map&&s.enable(4);t.matcap&&s.enable(5);t.envMap&&s.enable(6);t.lightMap&&s.enable(7);t.aoMap&&s.enable(8);t.emissiveMap&&s.enable(9);t.bumpMap&&s.enable(10);t.normalMap&&s.enable(11);t.objectSpaceNormalMap&&s.enable(12);t.tangentSpaceNormalMap&&s.enable(13);t.clearcoat&&s.enable(14);t.clearcoatMap&&s.enable(15);t.clearcoatRoughnessMap&&s.enable(16);t.clearcoatNormalMap&&s.enable(17);t.iridescence&&s.enable(18);t.iridescenceMap&&s.enable(19);t.iridescenceThicknessMap&&s.enable(20);t.displacementMap&&s.enable(21);t.specularMap&&s.enable(22);t.roughnessMap&&s.enable(23);t.metalnessMap&&s.enable(24);t.gradientMap&&s.enable(25);t.alphaMap&&s.enable(26);t.alphaTest&&s.enable(27);t.vertexColors&&s.enable(28);t.vertexAlphas&&s.enable(29);t.vertexUvs&&s.enable(30);t.vertexTangents&&s.enable(31);t.uvsVertexOnly&&s.enable(32);t.fog&&s.enable(33);e.push(s.mask),s.disableAll(),t.useFog&&s.enable(0);t.flatShading&&s.enable(1);t.logarithmicDepthBuffer&&s.enable(2);t.skinning&&s.enable(3);t.morphTargets&&s.enable(4);t.morphNormals&&s.enable(5);t.morphColors&&s.enable(6);t.premultipliedAlpha&&s.enable(7);t.shadowMapEnabled&&s.enable(8);t.physicallyCorrectLights&&s.enable(9);t.doubleSided&&s.enable(10);t.flipSided&&s.enable(11);t.useDepthPacking&&s.enable(12);t.dithering&&s.enable(13);t.specularIntensityMap&&s.enable(14);t.specularColorMap&&s.enable(15);t.transmission&&s.enable(16);t.transmissionMap&&s.enable(17);t.thicknessMap&&s.enable(18);t.sheen&&s.enable(19);t.sheenColorMap&&s.enable(20);t.sheenRoughnessMap&&s.enable(21);t.decodeVideoTexture&&s.enable(22);t.opaque&&s.enable(23);e.push(s.mask)}(n,t),n.push(e.outputEncoding)),n.push(t.customProgramCacheKey),n.join()},getUniforms:function(e){var t,n=p[e.type];if(n){var r=kSe[n];t=tSe.clone(r.uniforms)}else t=e.uniforms;return t},acquireProgram:function(t,n){for(var r,a=0,o=c.length;a<o;a++){var s=c[a];if(s.cacheKey===n){++(r=s).usedTimes;break}}return void 0===r&&(r=new bTe(e,n,t,i),c.push(r)),r},releaseProgram:function(e){if(0===--e.usedTimes){var t=c.indexOf(e);c[t]=c[c.length-1],c.pop(),e.destroy()}},releaseShaderCache:function(e){u.remove(e)},programs:c,dispose:function(){u.dispose()}}}function STe(){var e=new WeakMap;return{get:function(t){var n=e.get(t);return void 0===n&&(n={},e.set(t,n)),n},remove:function(t){e.delete(t)},update:function(t,n,r){e.get(t)[n]=r},dispose:function(){e=new WeakMap}}}function CTe(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function TTe(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function ETe(){var e=[],t=0,n=[],r=[],a=[];function i(n,r,a,i,o,s){var u=e[t];return void 0===u?(u={id:n.id,object:n,geometry:r,material:a,groupOrder:i,renderOrder:n.renderOrder,z:o,group:s},e[t]=u):(u.id=n.id,u.object=n,u.geometry=r,u.material=a,u.groupOrder=i,u.renderOrder=n.renderOrder,u.z=o,u.group=s),t++,u}return{opaque:n,transmissive:r,transparent:a,init:function(){t=0,n.length=0,r.length=0,a.length=0},push:function(e,t,o,s,u,c){var l=i(e,t,o,s,u,c);o.transmission>0?r.push(l):!0===o.transparent?a.push(l):n.push(l)},unshift:function(e,t,o,s,u,c){var l=i(e,t,o,s,u,c);o.transmission>0?r.unshift(l):!0===o.transparent?a.unshift(l):n.unshift(l)},finish:function(){for(var n=t,r=e.length;n<r;n++){var a=e[n];if(null===a.id)break;a.id=null,a.object=null,a.geometry=null,a.material=null,a.group=null}},sort:function(e,t){n.length>1&&n.sort(e||CTe),r.length>1&&r.sort(t||TTe),a.length>1&&a.sort(t||TTe)}}}function ITe(){var e=new WeakMap;return{get:function(t,n){var r;return!1===e.has(t)?(r=new ETe,e.set(t,[r])):n>=e.get(t).length?(r=new ETe,e.get(t).push(r)):r=e.get(t)[n],r},dispose:function(){e=new WeakMap}}}function ATe(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":n={direction:new Yke,color:new Oke};break;case"SpotLight":n={position:new Yke,direction:new Yke,color:new Oke,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":n={position:new Yke,color:new Oke,distance:0,decay:0};break;case"HemisphereLight":n={direction:new Yke,skyColor:new Oke,groundColor:new Oke};break;case"RectAreaLight":n={color:new Oke,position:new Yke,halfWidth:new Yke,halfHeight:new Yke}}return e[t.id]=n,n}}}var MTe=0;function NTe(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function RTe(e,t){for(var n=new ATe,r=function(){var e={};return{get:function(t){if(void 0!==e[t.id])return e[t.id];var n;switch(t.type){case"DirectionalLight":case"SpotLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yke};break;case"PointLight":n={shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new yke,shadowCameraNear:1,shadowCameraFar:1e3}}return e[t.id]=n,n}}}(),a={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadow:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[]},i=0;i<9;i++)a.probe.push(new Yke);var o=new Yke,s=new Twe,u=new Twe;return{setup:function(i,o){for(var s=0,u=0,c=0,l=0;l<9;l++)a.probe[l].set(0,0,0);var h=0,f=0,d=0,p=0,v=0,m=0,g=0,y=0;i.sort(NTe);for(var b=!0!==o?Math.PI:1,x=0,k=i.length;x<k;x++){var w=i[x],_=w.color,S=w.intensity,C=w.distance,T=w.shadow&&w.shadow.map?w.shadow.map.texture:null;if(w.isAmbientLight)s+=_.r*S*b,u+=_.g*S*b,c+=_.b*S*b;else if(w.isLightProbe)for(var E=0;E<9;E++)a.probe[E].addScaledVector(w.sh.coefficients[E],S);else if(w.isDirectionalLight){var I=n.get(w);if(I.color.copy(w.color).multiplyScalar(w.intensity*b),w.castShadow){var A=w.shadow,M=r.get(w);M.shadowBias=A.bias,M.shadowNormalBias=A.normalBias,M.shadowRadius=A.radius,M.shadowMapSize=A.mapSize,a.directionalShadow[h]=M,a.directionalShadowMap[h]=T,a.directionalShadowMatrix[h]=w.shadow.matrix,m++}a.directional[h]=I,h++}else if(w.isSpotLight){var N=n.get(w);if(N.position.setFromMatrixPosition(w.matrixWorld),N.color.copy(_).multiplyScalar(S*b),N.distance=C,N.coneCos=Math.cos(w.angle),N.penumbraCos=Math.cos(w.angle*(1-w.penumbra)),N.decay=w.decay,w.castShadow){var R=w.shadow,D=r.get(w);D.shadowBias=R.bias,D.shadowNormalBias=R.normalBias,D.shadowRadius=R.radius,D.shadowMapSize=R.mapSize,a.spotShadow[d]=D,a.spotShadowMap[d]=T,a.spotShadowMatrix[d]=w.shadow.matrix,y++}a.spot[d]=N,d++}else if(w.isRectAreaLight){var P=n.get(w);P.color.copy(_).multiplyScalar(S),P.halfWidth.set(.5*w.width,0,0),P.halfHeight.set(0,.5*w.height,0),a.rectArea[p]=P,p++}else if(w.isPointLight){var O=n.get(w);if(O.color.copy(w.color).multiplyScalar(w.intensity*b),O.distance=w.distance,O.decay=w.decay,w.castShadow){var L=w.shadow,F=r.get(w);F.shadowBias=L.bias,F.shadowNormalBias=L.normalBias,F.shadowRadius=L.radius,F.shadowMapSize=L.mapSize,F.shadowCameraNear=L.camera.near,F.shadowCameraFar=L.camera.far,a.pointShadow[f]=F,a.pointShadowMap[f]=T,a.pointShadowMatrix[f]=w.shadow.matrix,g++}a.point[f]=O,f++}else if(w.isHemisphereLight){var z=n.get(w);z.skyColor.copy(w.color).multiplyScalar(S*b),z.groundColor.copy(w.groundColor).multiplyScalar(S*b),a.hemi[v]=z,v++}}p>0&&(t.isWebGL2||!0===e.has("OES_texture_float_linear")?(a.rectAreaLTC1=xSe.LTC_FLOAT_1,a.rectAreaLTC2=xSe.LTC_FLOAT_2):!0===e.has("OES_texture_half_float_linear")?(a.rectAreaLTC1=xSe.LTC_HALF_1,a.rectAreaLTC2=xSe.LTC_HALF_2):console.error("THREE.WebGLRenderer: Unable to use RectAreaLight. Missing WebGL extensions.")),a.ambient[0]=s,a.ambient[1]=u,a.ambient[2]=c;var B=a.hash;B.directionalLength===h&&B.pointLength===f&&B.spotLength===d&&B.rectAreaLength===p&&B.hemiLength===v&&B.numDirectionalShadows===m&&B.numPointShadows===g&&B.numSpotShadows===y||(a.directional.length=h,a.spot.length=d,a.rectArea.length=p,a.point.length=f,a.hemi.length=v,a.directionalShadow.length=m,a.directionalShadowMap.length=m,a.pointShadow.length=g,a.pointShadowMap.length=g,a.spotShadow.length=y,a.spotShadowMap.length=y,a.directionalShadowMatrix.length=m,a.pointShadowMatrix.length=g,a.spotShadowMatrix.length=y,B.directionalLength=h,B.pointLength=f,B.spotLength=d,B.rectAreaLength=p,B.hemiLength=v,B.numDirectionalShadows=m,B.numPointShadows=g,B.numSpotShadows=y,a.version=MTe++)},setupView:function(e,t){for(var n=0,r=0,i=0,c=0,l=0,h=t.matrixWorldInverse,f=0,d=e.length;f<d;f++){var p=e[f];if(p.isDirectionalLight){var v=a.directional[n];v.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),v.direction.sub(o),v.direction.transformDirection(h),n++}else if(p.isSpotLight){var m=a.spot[i];m.position.setFromMatrixPosition(p.matrixWorld),m.position.applyMatrix4(h),m.direction.setFromMatrixPosition(p.matrixWorld),o.setFromMatrixPosition(p.target.matrixWorld),m.direction.sub(o),m.direction.transformDirection(h),i++}else if(p.isRectAreaLight){var g=a.rectArea[c];g.position.setFromMatrixPosition(p.matrixWorld),g.position.applyMatrix4(h),u.identity(),s.copy(p.matrixWorld),s.premultiply(h),u.extractRotation(s),g.halfWidth.set(.5*p.width,0,0),g.halfHeight.set(0,.5*p.height,0),g.halfWidth.applyMatrix4(u),g.halfHeight.applyMatrix4(u),c++}else if(p.isPointLight){var y=a.point[r];y.position.setFromMatrixPosition(p.matrixWorld),y.position.applyMatrix4(h),r++}else if(p.isHemisphereLight){var b=a.hemi[l];b.direction.setFromMatrixPosition(p.matrixWorld),b.direction.transformDirection(h),l++}}},state:a}}function DTe(e,t){var n=new RTe(e,t),r=[],a=[];return{init:function(){r.length=0,a.length=0},state:{lightsArray:r,shadowsArray:a,lights:n},setupLights:function(e){n.setup(r,e)},setupLightsView:function(e){n.setupView(r,e)},pushLight:function(e){r.push(e)},pushShadow:function(e){a.push(e)}}}function PTe(e,t){var n=new WeakMap;return{get:function(r){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return!1===n.has(r)?(a=new DTe(e,t),n.set(r,[a])):i>=n.get(r).length?(a=new DTe(e,t),n.get(r).push(a)):a=n.get(r)[i],a},dispose:function(){n=new WeakMap}}}var OTe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isMeshDepthMaterial=!0,r.type="MeshDepthMaterial",r.depthPacking=Sxe,r.map=null,r.alphaMap=null,r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.wireframe=!1,r.wireframeLinewidth=1,r.setValues(e),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}]),n}(l_e),LTe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isMeshDistanceMaterial=!0,r.type="MeshDistanceMaterial",r.referencePosition=new Yke,r.nearDistance=1,r.farDistance=1e3,r.map=null,r.alphaMap=null,r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.setValues(e),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}]),n}(l_e);function FTe(e,t,n){var r=new vSe,a=new yke,i=new yke,o=new Vke,s=new OTe({depthPacking:Cxe}),u=new LTe,c={},l=n.maxTextureSize,h={0:iye,1:aye,2:oye},f=new nSe({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new yke},radius:{value:4}},vertexShader:"void main() {\n\tgl_Position = vec4( position, 1.0 );\n}",fragmentShader:"uniform sampler2D shadow_pass;\nuniform vec2 resolution;\nuniform float radius;\n#include <packing>\nvoid main() {\n\tconst float samples = float( VSM_SAMPLES );\n\tfloat mean = 0.0;\n\tfloat squared_mean = 0.0;\n\tfloat uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );\n\tfloat uvStart = samples <= 1.0 ? 0.0 : - 1.0;\n\tfor ( float i = 0.0; i < samples; i ++ ) {\n\t\tfloat uvOffset = uvStart + i * uvStride;\n\t\t#ifdef HORIZONTAL_PASS\n\t\t\tvec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );\n\t\t\tmean += distribution.x;\n\t\t\tsquared_mean += distribution.y * distribution.y + distribution.x * distribution.x;\n\t\t#else\n\t\t\tfloat depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );\n\t\t\tmean += depth;\n\t\t\tsquared_mean += depth * depth;\n\t\t#endif\n\t}\n\tmean = mean / samples;\n\tsquared_mean = squared_mean / samples;\n\tfloat std_dev = sqrt( squared_mean - mean * mean );\n\tgl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );\n}"}),d=f.clone();d.defines.HORIZONTAL_PASS=1;var p=new R_e;p.setAttribute("position",new p_e(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var v=new Q_e(p,f),m=this;function g(n,r){var i=t.update(v);f.defines.VSM_SAMPLES!==n.blurSamples&&(f.defines.VSM_SAMPLES=n.blurSamples,d.defines.VSM_SAMPLES=n.blurSamples,f.needsUpdate=!0,d.needsUpdate=!0),null===n.mapPass&&(n.mapPass=new Wke(a.x,a.y)),f.uniforms.shadow_pass.value=n.map.texture,f.uniforms.resolution.value=n.mapSize,f.uniforms.radius.value=n.radius,e.setRenderTarget(n.mapPass),e.clear(),e.renderBufferDirect(r,null,i,f,v,null),d.uniforms.shadow_pass.value=n.mapPass.texture,d.uniforms.resolution.value=n.mapSize,d.uniforms.radius.value=n.radius,e.setRenderTarget(n.map),e.clear(),e.renderBufferDirect(r,null,i,d,v,null)}function y(t,n,r,a,i,o){var l=null,f=!0===r.isPointLight?t.customDistanceMaterial:t.customDepthMaterial;if(l=void 0!==f?f:!0===r.isPointLight?u:s,e.localClippingEnabled&&!0===n.clipShadows&&Array.isArray(n.clippingPlanes)&&0!==n.clippingPlanes.length||n.displacementMap&&0!==n.displacementScale||n.alphaMap&&n.alphaTest>0){var d=l.uuid,p=n.uuid,v=c[d];void 0===v&&(v={},c[d]=v);var m=v[p];void 0===m&&(m=l.clone(),v[p]=m),l=m}return l.visible=n.visible,l.wireframe=n.wireframe,l.side=o===rye?null!==n.shadowSide?n.shadowSide:n.side:null!==n.shadowSide?n.shadowSide:h[n.side],l.alphaMap=n.alphaMap,l.alphaTest=n.alphaTest,l.clipShadows=n.clipShadows,l.clippingPlanes=n.clippingPlanes,l.clipIntersection=n.clipIntersection,l.displacementMap=n.displacementMap,l.displacementScale=n.displacementScale,l.displacementBias=n.displacementBias,l.wireframeLinewidth=n.wireframeLinewidth,l.linewidth=n.linewidth,!0===r.isPointLight&&!0===l.isMeshDistanceMaterial&&(l.referencePosition.setFromMatrixPosition(r.matrixWorld),l.nearDistance=a,l.farDistance=i),l}function b(n,a,i,o,s){if(!1!==n.visible){if(n.layers.test(a.layers)&&(n.isMesh||n.isLine||n.isPoints)&&(n.castShadow||n.receiveShadow&&s===rye)&&(!n.frustumCulled||r.intersectsObject(n))){n.modelViewMatrix.multiplyMatrices(i.matrixWorldInverse,n.matrixWorld);var u=t.update(n),c=n.material;if(Array.isArray(c))for(var l=u.groups,h=0,f=l.length;h<f;h++){var d=l[h],p=c[d.materialIndex];if(p&&p.visible){var v=y(n,p,o,i.near,i.far,s);e.renderBufferDirect(i,null,u,v,n,d)}}else if(c.visible){var m=y(n,c,o,i.near,i.far,s);e.renderBufferDirect(i,null,u,m,n,null)}}for(var g=n.children,x=0,k=g.length;x<k;x++)b(g[x],a,i,o,s)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=tye,this.render=function(t,n,s){if(!1!==m.enabled&&(!1!==m.autoUpdate||!1!==m.needsUpdate)&&0!==t.length){var u=e.getRenderTarget(),c=e.getActiveCubeFace(),h=e.getActiveMipmapLevel(),f=e.state;f.setBlending(cye),f.buffers.color.setClear(1,1,1,1),f.buffers.depth.setTest(!0),f.setScissorTest(!1);for(var d=0,p=t.length;d<p;d++){var v=t[d],y=v.shadow;if(void 0!==y){if(!1!==y.autoUpdate||!1!==y.needsUpdate){a.copy(y.mapSize);var x=y.getFrameExtents();if(a.multiply(x),i.copy(y.mapSize),(a.x>l||a.y>l)&&(a.x>l&&(i.x=Math.floor(l/x.x),a.x=i.x*x.x,y.mapSize.x=i.x),a.y>l&&(i.y=Math.floor(l/x.y),a.y=i.y*x.y,y.mapSize.y=i.y)),null===y.map){var k=this.type!==rye?{minFilter:rbe,magFilter:rbe}:{};y.map=new Wke(a.x,a.y,k),y.map.texture.name=v.name+".shadowMap",y.camera.updateProjectionMatrix()}e.setRenderTarget(y.map),e.clear();for(var w=y.getViewportCount(),_=0;_<w;_++){var S=y.getViewport(_);o.set(i.x*S.x,i.y*S.y,i.x*S.z,i.y*S.w),f.viewport(o),y.updateMatrices(v,_),r=y.getFrustum(),b(n,s,y.camera,v,this.type)}!0!==y.isPointLightShadow&&this.type===rye&&g(y,s),y.needsUpdate=!1}}else console.warn("THREE.WebGLShadowMap:",v,"has no shadow.")}m.needsUpdate=!1,e.setRenderTarget(u,c,h)}}}function zTe(e,t,n){var r,a,i=n.isWebGL2;var o=new function(){var t=!1,n=new Vke,r=null,a=new Vke(0,0,0,0);return{setMask:function(n){r===n||t||(e.colorMask(n,n,n,n),r=n)},setLocked:function(e){t=e},setClear:function(t,r,i,o,s){!0===s&&(t*=o,r*=o,i*=o),n.set(t,r,i,o),!1===a.equals(n)&&(e.clearColor(t,r,i,o),a.copy(n))},reset:function(){t=!1,r=null,a.set(-1,0,0,0)}}},s=new function(){var t=!1,n=null,r=null,a=null;return{setTest:function(e){e?U(2929):V(2929)},setMask:function(r){n===r||t||(e.depthMask(r),n=r)},setFunc:function(t){if(r!==t){if(t)switch(t){case Nye:e.depthFunc(512);break;case Rye:e.depthFunc(519);break;case Dye:e.depthFunc(513);break;case Pye:e.depthFunc(515);break;case Oye:e.depthFunc(514);break;case Lye:e.depthFunc(518);break;case Fye:e.depthFunc(516);break;case zye:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);r=t}},setLocked:function(e){t=e},setClear:function(t){a!==t&&(e.clearDepth(t),a=t)},reset:function(){t=!1,n=null,r=null,a=null}}},u=new function(){var t=!1,n=null,r=null,a=null,i=null,o=null,s=null,u=null,c=null;return{setTest:function(e){t||(e?U(2960):V(2960))},setMask:function(r){n===r||t||(e.stencilMask(r),n=r)},setFunc:function(t,n,o){r===t&&a===n&&i===o||(e.stencilFunc(t,n,o),r=t,a=n,i=o)},setOp:function(t,n,r){o===t&&s===n&&u===r||(e.stencilOp(t,n,r),o=t,s=n,u=r)},setLocked:function(e){t=e},setClear:function(t){c!==t&&(e.clearStencil(t),c=t)},reset:function(){t=!1,n=null,r=null,a=null,i=null,o=null,s=null,u=null,c=null}}},c={},l={},h=new WeakMap,f=[],d=null,p=!1,v=null,m=null,g=null,y=null,b=null,x=null,k=null,w=!1,_=null,S=null,C=null,T=null,E=null,I=e.getParameter(35661),A=!1,M=0,N=e.getParameter(7938);-1!==N.indexOf("WebGL")?(M=parseFloat(/^WebGL (\d)/.exec(N)[1]),A=M>=1):-1!==N.indexOf("OpenGL ES")&&(M=parseFloat(/^OpenGL ES (\d)/.exec(N)[1]),A=M>=2);var R=null,D={},P=e.getParameter(3088),O=e.getParameter(2978),L=(new Vke).fromArray(P),F=(new Vke).fromArray(O);function z(t,n,r){var a=new Uint8Array(4),i=e.createTexture();e.bindTexture(t,i),e.texParameteri(t,10241,9728),e.texParameteri(t,10240,9728);for(var o=0;o<r;o++)e.texImage2D(n+o,0,6408,1,1,0,6408,5121,a);return i}var B={};function U(t){!0!==c[t]&&(e.enable(t),c[t]=!0)}function V(t){!1!==c[t]&&(e.disable(t),c[t]=!1)}B[3553]=z(3553,3553,1),B[34067]=z(34067,34069,6),o.setClear(0,0,0,1),s.setClear(1),u.setClear(0),U(2929),s.setFunc(Pye),H(!1),X(Zge),U(2884),q(cye);var W=(IE(r={},vye,32774),IE(r,mye,32778),IE(r,gye,32779),r);if(i)W[yye]=32775,W[bye]=32776;else{var G=t.get("EXT_blend_minmax");null!==G&&(W[yye]=G.MIN_EXT,W[bye]=G.MAX_EXT)}var j=(IE(a={},xye,0),IE(a,kye,1),IE(a,wye,768),IE(a,Sye,770),IE(a,Mye,776),IE(a,Iye,774),IE(a,Tye,772),IE(a,_ye,769),IE(a,Cye,771),IE(a,Aye,775),IE(a,Eye,773),a);function q(t,n,r,a,i,o,s,u){if(t!==cye){if(!1===p&&(U(3042),p=!0),t===pye)i=i||n,o=o||r,s=s||a,n===m&&i===b||(e.blendEquationSeparate(W[n],W[i]),m=n,b=i),r===g&&a===y&&o===x&&s===k||(e.blendFuncSeparate(j[r],j[a],j[o],j[s]),g=r,y=a,x=o,k=s),v=t,w=null;else if(t!==v||u!==w){if(m===vye&&b===vye||(e.blendEquation(32774),m=vye,b=vye),u)switch(t){case lye:e.blendFuncSeparate(1,771,1,771);break;case hye:e.blendFunc(1,1);break;case fye:e.blendFuncSeparate(0,769,0,1);break;case dye:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}else switch(t){case lye:e.blendFuncSeparate(770,771,1,771);break;case hye:e.blendFunc(770,1);break;case fye:e.blendFuncSeparate(0,769,0,1);break;case dye:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",t)}g=null,y=null,x=null,k=null,v=t,w=u}}else!0===p&&(V(3042),p=!1)}function H(t){_!==t&&(t?e.frontFace(2304):e.frontFace(2305),_=t)}function X(t){t!==Qge?(U(2884),t!==S&&(t===Zge?e.cullFace(1029):t===Jge?e.cullFace(1028):e.cullFace(1032))):V(2884),S=t}function K(t,n,r){t?(U(32823),T===n&&E===r||(e.polygonOffset(n,r),T=n,E=r)):V(32823)}function Y(t){void 0===t&&(t=33984+I-1),R!==t&&(e.activeTexture(t),R=t)}return{buffers:{color:o,depth:s,stencil:u},enable:U,disable:V,bindFramebuffer:function(t,n){return l[t]!==n&&(e.bindFramebuffer(t,n),l[t]=n,i&&(36009===t&&(l[36160]=n),36160===t&&(l[36009]=n)),!0)},drawBuffers:function(r,a){var i=f,o=!1;if(r)if(void 0===(i=h.get(a))&&(i=[],h.set(a,i)),r.isWebGLMultipleRenderTargets){var s=r.texture;if(i.length!==s.length||36064!==i[0]){for(var u=0,c=s.length;u<c;u++)i[u]=36064+u;i.length=s.length,o=!0}}else 36064!==i[0]&&(i[0]=36064,o=!0);else 1029!==i[0]&&(i[0]=1029,o=!0);o&&(n.isWebGL2?e.drawBuffers(i):t.get("WEBGL_draw_buffers").drawBuffersWEBGL(i))},useProgram:function(t){return d!==t&&(e.useProgram(t),d=t,!0)},setBlending:q,setMaterial:function(e,t){e.side===oye?V(2884):U(2884);var n=e.side===iye;t&&(n=!n),H(n),e.blending===lye&&!1===e.transparent?q(cye):q(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),s.setFunc(e.depthFunc),s.setTest(e.depthTest),s.setMask(e.depthWrite),o.setMask(e.colorWrite);var r=e.stencilWrite;u.setTest(r),r&&(u.setMask(e.stencilWriteMask),u.setFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),u.setOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),K(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),!0===e.alphaToCoverage?U(32926):V(32926)},setFlipSided:H,setCullFace:X,setLineWidth:function(t){t!==C&&(A&&e.lineWidth(t),C=t)},setPolygonOffset:K,setScissorTest:function(e){e?U(3089):V(3089)},activeTexture:Y,bindTexture:function(t,n){null===R&&Y();var r=D[R];void 0===r&&(r={type:void 0,texture:void 0},D[R]=r),r.type===t&&r.texture===n||(e.bindTexture(t,n||B[t]),r.type=t,r.texture=n)},unbindTexture:function(){var t=D[R];void 0!==t&&void 0!==t.type&&(e.bindTexture(t.type,null),t.type=void 0,t.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage2D:function(){try{e.texStorage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texStorage3D:function(){try{e.texStorage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage2D:function(){try{e.texSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},texSubImage3D:function(){try{e.texSubImage3D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},compressedTexSubImage2D:function(){try{e.compressedTexSubImage2D.apply(e,arguments)}catch(t){console.error("THREE.WebGLState:",t)}},scissor:function(t){!1===L.equals(t)&&(e.scissor(t.x,t.y,t.z,t.w),L.copy(t))},viewport:function(t){!1===F.equals(t)&&(e.viewport(t.x,t.y,t.z,t.w),F.copy(t))},reset:function(){e.disable(3042),e.disable(2884),e.disable(2929),e.disable(32823),e.disable(3089),e.disable(2960),e.disable(32926),e.blendEquation(32774),e.blendFunc(1,0),e.blendFuncSeparate(1,0,1,0),e.colorMask(!0,!0,!0,!0),e.clearColor(0,0,0,0),e.depthMask(!0),e.depthFunc(513),e.clearDepth(1),e.stencilMask(4294967295),e.stencilFunc(519,0,4294967295),e.stencilOp(7680,7680,7680),e.clearStencil(0),e.cullFace(1029),e.frontFace(2305),e.polygonOffset(0,0),e.activeTexture(33984),e.bindFramebuffer(36160,null),!0===i&&(e.bindFramebuffer(36009,null),e.bindFramebuffer(36008,null)),e.useProgram(null),e.lineWidth(1),e.scissor(0,0,e.canvas.width,e.canvas.height),e.viewport(0,0,e.canvas.width,e.canvas.height),c={},R=null,D={},l={},h=new WeakMap,f=[],d=null,p=!1,v=null,m=null,g=null,y=null,b=null,x=null,k=null,w=!1,_=null,S=null,C=null,T=null,E=null,L.set(0,0,e.canvas.width,e.canvas.height),F.set(0,0,e.canvas.width,e.canvas.height),o.reset(),s.reset(),u.reset()}}}function BTe(e,t,n,r,a,i,o){var s,u,c,l=a.isWebGL2,h=a.maxTextures,f=a.maxCubemapSize,d=a.maxTextureSize,p=a.maxSamples,v=t.has("WEBGL_multisampled_render_to_texture")?t.get("WEBGL_multisampled_render_to_texture"):null,m=/OculusBrowser/g.test(navigator.userAgent),g=new WeakMap,y=new WeakMap,b=!1;try{b="undefined"!==typeof OffscreenCanvas&&null!==new OffscreenCanvas(1,1).getContext("2d")}catch($Pe){}function x(e,t){return b?new OffscreenCanvas(e,t):_ke("canvas")}function k(e,t,n,r){var a=1;if((e.width>r||e.height>r)&&(a=r/Math.max(e.width,e.height)),a<1||!0===t){if("undefined"!==typeof HTMLImageElement&&e instanceof HTMLImageElement||"undefined"!==typeof HTMLCanvasElement&&e instanceof HTMLCanvasElement||"undefined"!==typeof ImageBitmap&&e instanceof ImageBitmap){var i=t?mke:Math.floor,o=i(a*e.width),s=i(a*e.height);void 0===c&&(c=x(o,s));var u=n?x(o,s):c;return u.width=o,u.height=s,u.getContext("2d").drawImage(e,0,0,o,s),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+e.width+"x"+e.height+") to ("+o+"x"+s+")."),u}return"data"in e&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+e.width+"x"+e.height+")."),e}return e}function w(e){return pke(e.width)&&pke(e.height)}function _(e,t){return e.generateMipmaps&&t&&e.minFilter!==rbe&&e.minFilter!==ube}function S(t){e.generateMipmap(t)}function C(n,r,a,i){var o=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(!1===l)return r;if(null!==n){if(void 0!==e[n])return e[n];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+n+"'")}var s=r;return 6403===r&&(5126===a&&(s=33326),5131===a&&(s=33325),5121===a&&(s=33321)),33319===r&&(5126===a&&(s=33328),5131===a&&(s=33327),5121===a&&(s=33323)),6408===r&&(5126===a&&(s=34836),5131===a&&(s=34842),5121===a&&(s=i===_xe&&!1===o?35907:32856),32819===a&&(s=32854),32820===a&&(s=32855)),33325!==s&&33326!==s&&33327!==s&&33328!==s&&34842!==s&&34836!==s||t.get("EXT_color_buffer_float"),s}function T(e,t,n){return!0===_(e,n)||e.isFramebufferTexture&&e.minFilter!==rbe&&e.minFilter!==ube?Math.log2(Math.max(t.width,t.height))+1:void 0!==e.mipmaps&&e.mipmaps.length>0?e.mipmaps.length:e.isCompressedTexture&&Array.isArray(e.image)?t.mipmaps.length:1}function E(e){return e===rbe||e===abe||e===obe?9728:9729}function I(e){var t=e.target;t.removeEventListener("dispose",I),function(e){var t=r.get(e);if(void 0===t.__webglInit)return;var n=e.source,a=y.get(n);if(a){var i=a[t.__cacheKey];i.usedTimes--,0===i.usedTimes&&M(e),0===Object.keys(a).length&&y.delete(n)}r.remove(e)}(t),t.isVideoTexture&&g.delete(t)}function A(t){var n=t.target;n.removeEventListener("dispose",A),function(t){var n=t.texture,a=r.get(t),i=r.get(n);void 0!==i.__webglTexture&&(e.deleteTexture(i.__webglTexture),o.memory.textures--);t.depthTexture&&t.depthTexture.dispose();if(t.isWebGLCubeRenderTarget)for(var s=0;s<6;s++)e.deleteFramebuffer(a.__webglFramebuffer[s]),a.__webglDepthbuffer&&e.deleteRenderbuffer(a.__webglDepthbuffer[s]);else{if(e.deleteFramebuffer(a.__webglFramebuffer),a.__webglDepthbuffer&&e.deleteRenderbuffer(a.__webglDepthbuffer),a.__webglMultisampledFramebuffer&&e.deleteFramebuffer(a.__webglMultisampledFramebuffer),a.__webglColorRenderbuffer)for(var u=0;u<a.__webglColorRenderbuffer.length;u++)a.__webglColorRenderbuffer[u]&&e.deleteRenderbuffer(a.__webglColorRenderbuffer[u]);a.__webglDepthRenderbuffer&&e.deleteRenderbuffer(a.__webglDepthRenderbuffer)}if(t.isWebGLMultipleRenderTargets)for(var c=0,l=n.length;c<l;c++){var h=r.get(n[c]);h.__webglTexture&&(e.deleteTexture(h.__webglTexture),o.memory.textures--),r.remove(n[c])}r.remove(n),r.remove(t)}(n)}function M(t){var n=r.get(t);e.deleteTexture(n.__webglTexture);var a=t.source;delete y.get(a)[n.__cacheKey],o.memory.textures--}var N=0;function R(e,t){var a=r.get(e);if(e.isVideoTexture&&function(e){var t=o.render.frame;g.get(e)!==t&&(g.set(e,t),e.update())}(e),!1===e.isRenderTargetTexture&&e.version>0&&a.__version!==e.version){var i=e.image;if(null===i)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else{if(!1!==i.complete)return void F(a,e,t);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}n.activeTexture(33984+t),n.bindTexture(3553,a.__webglTexture)}var D=(IE(s={},ebe,10497),IE(s,tbe,33071),IE(s,nbe,33648),s),P=(IE(u={},rbe,9728),IE(u,abe,9984),IE(u,obe,9986),IE(u,ube,9729),IE(u,cbe,9985),IE(u,hbe,9987),u);function O(n,i,o){if(o?(e.texParameteri(n,10242,D[i.wrapS]),e.texParameteri(n,10243,D[i.wrapT]),32879!==n&&35866!==n||e.texParameteri(n,32882,D[i.wrapR]),e.texParameteri(n,10240,P[i.magFilter]),e.texParameteri(n,10241,P[i.minFilter])):(e.texParameteri(n,10242,33071),e.texParameteri(n,10243,33071),32879!==n&&35866!==n||e.texParameteri(n,32882,33071),i.wrapS===tbe&&i.wrapT===tbe||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(n,10240,E(i.magFilter)),e.texParameteri(n,10241,E(i.minFilter)),i.minFilter!==rbe&&i.minFilter!==ube&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter.")),!0===t.has("EXT_texture_filter_anisotropic")){var s=t.get("EXT_texture_filter_anisotropic");if(i.type===bbe&&!1===t.has("OES_texture_float_linear"))return;if(!1===l&&i.type===xbe&&!1===t.has("OES_texture_half_float_linear"))return;(i.anisotropy>1||r.get(i).__currentAnisotropy)&&(e.texParameterf(n,s.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(i.anisotropy,a.getMaxAnisotropy())),r.get(i).__currentAnisotropy=i.anisotropy)}}function L(t,n){var r=!1;void 0===t.__webglInit&&(t.__webglInit=!0,n.addEventListener("dispose",I));var a=n.source,i=y.get(a);void 0===i&&(i={},y.set(a,i));var s=function(e){var t=[];return t.push(e.wrapS),t.push(e.wrapT),t.push(e.magFilter),t.push(e.minFilter),t.push(e.anisotropy),t.push(e.internalFormat),t.push(e.format),t.push(e.type),t.push(e.generateMipmaps),t.push(e.premultiplyAlpha),t.push(e.flipY),t.push(e.unpackAlignment),t.push(e.encoding),t.join()}(n);if(s!==t.__cacheKey){void 0===i[s]&&(i[s]={texture:e.createTexture(),usedTimes:0},o.memory.textures++,r=!0),i[s].usedTimes++;var u=i[t.__cacheKey];void 0!==u&&(i[t.__cacheKey].usedTimes--,0===u.usedTimes&&M(n)),t.__cacheKey=s,t.__webglTexture=i[s].texture}return r}function F(t,r,a){var o=3553;r.isDataArrayTexture&&(o=35866),r.isData3DTexture&&(o=32879);var s=L(t,r),u=r.source;if(n.activeTexture(33984+a),n.bindTexture(o,t.__webglTexture),u.version!==u.__currentVersion||!0===s){e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);var c,h=function(e){return!l&&(e.wrapS!==tbe||e.wrapT!==tbe||e.minFilter!==rbe&&e.minFilter!==ube)}(r)&&!1===w(r.image),f=k(r.image,h,!1,d),p=w(f=G(r,f))||l,v=i.convert(r.format,r.encoding),m=i.convert(r.type),g=C(r.internalFormat,v,m,r.encoding,r.isVideoTexture);O(o,r,p);var y=r.mipmaps,b=l&&!0!==r.isVideoTexture,x=void 0===u.__currentVersion||!0===s,E=T(r,f,p);if(r.isDepthTexture)g=6402,l?g=r.type===bbe?36012:r.type===ybe?33190:r.type===_be?35056:33189:r.type===bbe&&console.error("WebGLRenderer: Floating point depth texture requires WebGL2."),r.format===Abe&&6402===g&&r.type!==mbe&&r.type!==ybe&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),r.type=ybe,m=i.convert(r.type)),r.format===Mbe&&6402===g&&(g=34041,r.type!==_be&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),r.type=_be,m=i.convert(r.type))),x&&(b?n.texStorage2D(3553,1,g,f.width,f.height):n.texImage2D(3553,0,g,f.width,f.height,0,v,m,null));else if(r.isDataTexture)if(y.length>0&&p){b&&x&&n.texStorage2D(3553,E,g,y[0].width,y[0].height);for(var I=0,A=y.length;I<A;I++)c=y[I],b?n.texSubImage2D(3553,I,0,0,c.width,c.height,v,m,c.data):n.texImage2D(3553,I,g,c.width,c.height,0,v,m,c.data);r.generateMipmaps=!1}else b?(x&&n.texStorage2D(3553,E,g,f.width,f.height),n.texSubImage2D(3553,0,0,0,f.width,f.height,v,m,f.data)):n.texImage2D(3553,0,g,f.width,f.height,0,v,m,f.data);else if(r.isCompressedTexture){b&&x&&n.texStorage2D(3553,E,g,y[0].width,y[0].height);for(var M=0,N=y.length;M<N;M++)c=y[M],r.format!==Tbe?null!==v?b?n.compressedTexSubImage2D(3553,M,0,0,c.width,c.height,v,c.data):n.compressedTexImage2D(3553,M,g,c.width,c.height,0,c.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):b?n.texSubImage2D(3553,M,0,0,c.width,c.height,v,m,c.data):n.texImage2D(3553,M,g,c.width,c.height,0,v,m,c.data)}else if(r.isDataArrayTexture)b?(x&&n.texStorage3D(35866,E,g,f.width,f.height,f.depth),n.texSubImage3D(35866,0,0,0,0,f.width,f.height,f.depth,v,m,f.data)):n.texImage3D(35866,0,g,f.width,f.height,f.depth,0,v,m,f.data);else if(r.isData3DTexture)b?(x&&n.texStorage3D(32879,E,g,f.width,f.height,f.depth),n.texSubImage3D(32879,0,0,0,0,f.width,f.height,f.depth,v,m,f.data)):n.texImage3D(32879,0,g,f.width,f.height,f.depth,0,v,m,f.data);else if(r.isFramebufferTexture){if(x)if(b)n.texStorage2D(3553,E,g,f.width,f.height);else for(var R=f.width,D=f.height,P=0;P<E;P++)n.texImage2D(3553,P,g,R,D,0,v,m,null),R>>=1,D>>=1}else if(y.length>0&&p){b&&x&&n.texStorage2D(3553,E,g,y[0].width,y[0].height);for(var F=0,z=y.length;F<z;F++)c=y[F],b?n.texSubImage2D(3553,F,0,0,v,m,c):n.texImage2D(3553,F,g,v,m,c);r.generateMipmaps=!1}else b?(x&&n.texStorage2D(3553,E,g,f.width,f.height),n.texSubImage2D(3553,0,0,0,v,m,f)):n.texImage2D(3553,0,g,v,m,f);_(r,p)&&S(o),u.__currentVersion=u.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}function z(t,a,o,s,u){var c=i.convert(o.format,o.encoding),l=i.convert(o.type),h=C(o.internalFormat,c,l,o.encoding);r.get(a).__hasExternalTextures||(32879===u||35866===u?n.texImage3D(u,0,h,a.width,a.height,a.depth,0,c,l,null):n.texImage2D(u,0,h,a.width,a.height,0,c,l,null)),n.bindFramebuffer(36160,t),W(a)?v.framebufferTexture2DMultisampleEXT(36160,s,u,r.get(o).__webglTexture,0,V(a)):e.framebufferTexture2D(36160,s,u,r.get(o).__webglTexture,0),n.bindFramebuffer(36160,null)}function B(t,n,r){if(e.bindRenderbuffer(36161,t),n.depthBuffer&&!n.stencilBuffer){var a=33189;if(r||W(n)){var o=n.depthTexture;o&&o.isDepthTexture&&(o.type===bbe?a=36012:o.type===ybe&&(a=33190));var s=V(n);W(n)?v.renderbufferStorageMultisampleEXT(36161,s,a,n.width,n.height):e.renderbufferStorageMultisample(36161,s,a,n.width,n.height)}else e.renderbufferStorage(36161,a,n.width,n.height);e.framebufferRenderbuffer(36160,36096,36161,t)}else if(n.depthBuffer&&n.stencilBuffer){var u=V(n);r&&!1===W(n)?e.renderbufferStorageMultisample(36161,u,35056,n.width,n.height):W(n)?v.renderbufferStorageMultisampleEXT(36161,u,35056,n.width,n.height):e.renderbufferStorage(36161,34041,n.width,n.height),e.framebufferRenderbuffer(36160,33306,36161,t)}else for(var c=!0===n.isWebGLMultipleRenderTargets?n.texture:[n.texture],l=0;l<c.length;l++){var h=c[l],f=i.convert(h.format,h.encoding),d=i.convert(h.type),p=C(h.internalFormat,f,d,h.encoding),m=V(n);r&&!1===W(n)?e.renderbufferStorageMultisample(36161,m,p,n.width,n.height):W(n)?v.renderbufferStorageMultisampleEXT(36161,m,p,n.width,n.height):e.renderbufferStorage(36161,p,n.width,n.height)}e.bindRenderbuffer(36161,null)}function U(t){var a=r.get(t),i=!0===t.isWebGLCubeRenderTarget;if(t.depthTexture&&!a.__autoAllocateDepthBuffer){if(i)throw new Error("target.depthTexture not supported in Cube render targets");!function(t,a){if(a&&a.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(n.bindFramebuffer(36160,t),!a.depthTexture||!a.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");r.get(a.depthTexture).__webglTexture&&a.depthTexture.image.width===a.width&&a.depthTexture.image.height===a.height||(a.depthTexture.image.width=a.width,a.depthTexture.image.height=a.height,a.depthTexture.needsUpdate=!0),R(a.depthTexture,0);var i=r.get(a.depthTexture).__webglTexture,o=V(a);if(a.depthTexture.format===Abe)W(a)?v.framebufferTexture2DMultisampleEXT(36160,36096,3553,i,0,o):e.framebufferTexture2D(36160,36096,3553,i,0);else{if(a.depthTexture.format!==Mbe)throw new Error("Unknown depthTexture format");W(a)?v.framebufferTexture2DMultisampleEXT(36160,33306,3553,i,0,o):e.framebufferTexture2D(36160,33306,3553,i,0)}}(a.__webglFramebuffer,t)}else if(i){a.__webglDepthbuffer=[];for(var o=0;o<6;o++)n.bindFramebuffer(36160,a.__webglFramebuffer[o]),a.__webglDepthbuffer[o]=e.createRenderbuffer(),B(a.__webglDepthbuffer[o],t,!1)}else n.bindFramebuffer(36160,a.__webglFramebuffer),a.__webglDepthbuffer=e.createRenderbuffer(),B(a.__webglDepthbuffer,t,!1);n.bindFramebuffer(36160,null)}function V(e){return Math.min(p,e.samples)}function W(e){var n=r.get(e);return l&&e.samples>0&&!0===t.has("WEBGL_multisampled_render_to_texture")&&!1!==n.__useRenderToTexture}function G(e,n){var r=e.encoding,a=e.format,i=e.type;return!0===e.isCompressedTexture||!0===e.isVideoTexture||e.format===ake||r!==wxe&&(r===_xe?!1===l?!0===t.has("EXT_sRGB")&&a===Tbe?(e.format=ake,e.minFilter=ube,e.generateMipmaps=!1):n=Lke.sRGBToLinear(n):a===Tbe&&i===dbe||console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture encoding:",r)),n}this.allocateTextureUnit=function(){var e=N;return e>=h&&console.warn("THREE.WebGLTextures: Trying to use "+e+" texture units while this GPU supports only "+h),N+=1,e},this.resetTextureUnits=function(){N=0},this.setTexture2D=R,this.setTexture2DArray=function(e,t){var a=r.get(e);e.version>0&&a.__version!==e.version?F(a,e,t):(n.activeTexture(33984+t),n.bindTexture(35866,a.__webglTexture))},this.setTexture3D=function(e,t){var a=r.get(e);e.version>0&&a.__version!==e.version?F(a,e,t):(n.activeTexture(33984+t),n.bindTexture(32879,a.__webglTexture))},this.setTextureCube=function(t,a){var o=r.get(t);t.version>0&&o.__version!==t.version?function(t,r,a){if(6!==r.image.length)return;var o=L(t,r),s=r.source;if(n.activeTexture(33984+a),n.bindTexture(34067,t.__webglTexture),s.version!==s.__currentVersion||!0===o){e.pixelStorei(37440,r.flipY),e.pixelStorei(37441,r.premultiplyAlpha),e.pixelStorei(3317,r.unpackAlignment),e.pixelStorei(37443,0);for(var u=r.isCompressedTexture||r.image[0].isCompressedTexture,c=r.image[0]&&r.image[0].isDataTexture,h=[],d=0;d<6;d++)h[d]=u||c?c?r.image[d].image:r.image[d]:k(r.image[d],!1,!0,f),h[d]=G(r,h[d]);var p,v=h[0],m=w(v)||l,g=i.convert(r.format,r.encoding),y=i.convert(r.type),b=C(r.internalFormat,g,y,r.encoding),x=l&&!0!==r.isVideoTexture,E=void 0===s.__currentVersion||!0===o,I=T(r,v,m);if(O(34067,r,m),u){x&&E&&n.texStorage2D(34067,I,b,v.width,v.height);for(var A=0;A<6;A++){p=h[A].mipmaps;for(var M=0;M<p.length;M++){var N=p[M];r.format!==Tbe?null!==g?x?n.compressedTexSubImage2D(34069+A,M,0,0,N.width,N.height,g,N.data):n.compressedTexImage2D(34069+A,M,b,N.width,N.height,0,N.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):x?n.texSubImage2D(34069+A,M,0,0,N.width,N.height,g,y,N.data):n.texImage2D(34069+A,M,b,N.width,N.height,0,g,y,N.data)}}}else{p=r.mipmaps,x&&E&&(p.length>0&&I++,n.texStorage2D(34067,I,b,h[0].width,h[0].height));for(var R=0;R<6;R++)if(c){x?n.texSubImage2D(34069+R,0,0,0,h[R].width,h[R].height,g,y,h[R].data):n.texImage2D(34069+R,0,b,h[R].width,h[R].height,0,g,y,h[R].data);for(var D=0;D<p.length;D++){var P=p[D].image[R].image;x?n.texSubImage2D(34069+R,D+1,0,0,P.width,P.height,g,y,P.data):n.texImage2D(34069+R,D+1,b,P.width,P.height,0,g,y,P.data)}}else{x?n.texSubImage2D(34069+R,0,0,0,g,y,h[R]):n.texImage2D(34069+R,0,b,g,y,h[R]);for(var F=0;F<p.length;F++){var z=p[F];x?n.texSubImage2D(34069+R,F+1,0,0,g,y,z.image[R]):n.texImage2D(34069+R,F+1,b,g,y,z.image[R])}}}_(r,m)&&S(34067),s.__currentVersion=s.version,r.onUpdate&&r.onUpdate(r)}t.__version=r.version}(o,t,a):(n.activeTexture(33984+a),n.bindTexture(34067,o.__webglTexture))},this.rebindTextures=function(e,t,n){var a=r.get(e);void 0!==t&&z(a.__webglFramebuffer,e,e.texture,36064,3553),void 0!==n&&U(e)},this.setupRenderTarget=function(t){var s=t.texture,u=r.get(t),c=r.get(s);t.addEventListener("dispose",A),!0!==t.isWebGLMultipleRenderTargets&&(void 0===c.__webglTexture&&(c.__webglTexture=e.createTexture()),c.__version=s.version,o.memory.textures++);var h=!0===t.isWebGLCubeRenderTarget,f=!0===t.isWebGLMultipleRenderTargets,d=w(t)||l;if(h){u.__webglFramebuffer=[];for(var p=0;p<6;p++)u.__webglFramebuffer[p]=e.createFramebuffer()}else{if(u.__webglFramebuffer=e.createFramebuffer(),f)if(a.drawBuffers)for(var v=t.texture,m=0,g=v.length;m<g;m++){var y=r.get(v[m]);void 0===y.__webglTexture&&(y.__webglTexture=e.createTexture(),o.memory.textures++)}else console.warn("THREE.WebGLRenderer: WebGLMultipleRenderTargets can only be used with WebGL2 or WEBGL_draw_buffers extension.");if(l&&t.samples>0&&!1===W(t)){var b=f?s:[s];u.__webglMultisampledFramebuffer=e.createFramebuffer(),u.__webglColorRenderbuffer=[],n.bindFramebuffer(36160,u.__webglMultisampledFramebuffer);for(var x=0;x<b.length;x++){var k=b[x];u.__webglColorRenderbuffer[x]=e.createRenderbuffer(),e.bindRenderbuffer(36161,u.__webglColorRenderbuffer[x]);var T=i.convert(k.format,k.encoding),E=i.convert(k.type),I=C(k.internalFormat,T,E,k.encoding),M=V(t);e.renderbufferStorageMultisample(36161,M,I,t.width,t.height),e.framebufferRenderbuffer(36160,36064+x,36161,u.__webglColorRenderbuffer[x])}e.bindRenderbuffer(36161,null),t.depthBuffer&&(u.__webglDepthRenderbuffer=e.createRenderbuffer(),B(u.__webglDepthRenderbuffer,t,!0)),n.bindFramebuffer(36160,null)}}if(h){n.bindTexture(34067,c.__webglTexture),O(34067,s,d);for(var N=0;N<6;N++)z(u.__webglFramebuffer[N],t,s,36064,34069+N);_(s,d)&&S(34067),n.unbindTexture()}else if(f){for(var R=t.texture,D=0,P=R.length;D<P;D++){var L=R[D],F=r.get(L);n.bindTexture(3553,F.__webglTexture),O(3553,L,d),z(u.__webglFramebuffer,t,L,36064+D,3553),_(L,d)&&S(3553)}n.unbindTexture()}else{var G=3553;(t.isWebGL3DRenderTarget||t.isWebGLArrayRenderTarget)&&(l?G=t.isWebGL3DRenderTarget?32879:35866:console.error("THREE.WebGLTextures: THREE.Data3DTexture and THREE.DataArrayTexture only supported with WebGL2.")),n.bindTexture(G,c.__webglTexture),O(G,s,d),z(u.__webglFramebuffer,t,s,36064,G),_(s,d)&&S(G),n.unbindTexture()}t.depthBuffer&&U(t)},this.updateRenderTargetMipmap=function(e){for(var t=w(e)||l,a=!0===e.isWebGLMultipleRenderTargets?e.texture:[e.texture],i=0,o=a.length;i<o;i++){var s=a[i];if(_(s,t)){var u=e.isWebGLCubeRenderTarget?34067:3553,c=r.get(s).__webglTexture;n.bindTexture(u,c),S(u),n.unbindTexture()}}},this.updateMultisampleRenderTarget=function(t){if(l&&t.samples>0&&!1===W(t)){var a=t.isWebGLMultipleRenderTargets?t.texture:[t.texture],i=t.width,o=t.height,s=16384,u=[],c=t.stencilBuffer?33306:36096,h=r.get(t),f=!0===t.isWebGLMultipleRenderTargets;if(f)for(var d=0;d<a.length;d++)n.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+d,36161,null),n.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+d,3553,null,0);n.bindFramebuffer(36008,h.__webglMultisampledFramebuffer),n.bindFramebuffer(36009,h.__webglFramebuffer);for(var p=0;p<a.length;p++){u.push(36064+p),t.depthBuffer&&u.push(c);var v=void 0!==h.__ignoreDepthValues&&h.__ignoreDepthValues;if(!1===v&&(t.depthBuffer&&(s|=256),t.stencilBuffer&&(s|=1024)),f&&e.framebufferRenderbuffer(36008,36064,36161,h.__webglColorRenderbuffer[p]),!0===v&&(e.invalidateFramebuffer(36008,[c]),e.invalidateFramebuffer(36009,[c])),f){var g=r.get(a[p]).__webglTexture;e.framebufferTexture2D(36009,36064,3553,g,0)}e.blitFramebuffer(0,0,i,o,0,0,i,o,s,9728),m&&e.invalidateFramebuffer(36008,u)}if(n.bindFramebuffer(36008,null),n.bindFramebuffer(36009,null),f)for(var y=0;y<a.length;y++){n.bindFramebuffer(36160,h.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064+y,36161,h.__webglColorRenderbuffer[y]);var b=r.get(a[y]).__webglTexture;n.bindFramebuffer(36160,h.__webglFramebuffer),e.framebufferTexture2D(36009,36064+y,3553,b,0)}n.bindFramebuffer(36009,h.__webglMultisampledFramebuffer)}},this.setupDepthRenderbuffer=U,this.setupFrameBufferTexture=z,this.useMultisampledRTT=W}function UTe(e,t,n){var r=n.isWebGL2;return{convert:function(n){var a,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(n===dbe)return 5121;if(n===kbe)return 32819;if(n===wbe)return 32820;if(n===pbe)return 5120;if(n===vbe)return 5122;if(n===mbe)return 5123;if(n===gbe)return 5124;if(n===ybe)return 5125;if(n===bbe)return 5126;if(n===xbe)return r?5131:null!==(a=t.get("OES_texture_half_float"))?a.HALF_FLOAT_OES:null;if(n===Sbe)return 6406;if(n===Tbe)return 6408;if(n===Ebe)return 6409;if(n===Ibe)return 6410;if(n===Abe)return 6402;if(n===Mbe)return 34041;if(n===Nbe)return 6403;if(n===Cbe)return console.warn("THREE.WebGLRenderer: THREE.RGBFormat has been removed. Use THREE.RGBAFormat instead. https://github.com/mrdoob/three.js/pull/23228"),6408;if(n===ake)return null!==(a=t.get("EXT_sRGB"))?a.SRGB_ALPHA_EXT:null;if(n===Rbe)return 36244;if(n===Dbe)return 33319;if(n===Pbe)return 33320;if(n===Obe)return 36249;if(n===Lbe||n===Fbe||n===zbe||n===Bbe)if(i===_xe){if(null===(a=t.get("WEBGL_compressed_texture_s3tc_srgb")))return null;if(n===Lbe)return a.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===Fbe)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===zbe)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Bbe)return a.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else{if(null===(a=t.get("WEBGL_compressed_texture_s3tc")))return null;if(n===Lbe)return a.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===Fbe)return a.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===zbe)return a.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Bbe)return a.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(n===Ube||n===Vbe||n===Wbe||n===Gbe){if(null===(a=t.get("WEBGL_compressed_texture_pvrtc")))return null;if(n===Ube)return a.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Vbe)return a.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Wbe)return a.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Gbe)return a.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}if(n===jbe)return null!==(a=t.get("WEBGL_compressed_texture_etc1"))?a.COMPRESSED_RGB_ETC1_WEBGL:null;if(n===qbe||n===Hbe){if(null===(a=t.get("WEBGL_compressed_texture_etc")))return null;if(n===qbe)return i===_xe?a.COMPRESSED_SRGB8_ETC2:a.COMPRESSED_RGB8_ETC2;if(n===Hbe)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:a.COMPRESSED_RGBA8_ETC2_EAC}if(n===Xbe||n===Kbe||n===Ybe||n===Qbe||n===Zbe||n===Jbe||n===$be||n===exe||n===txe||n===nxe||n===rxe||n===axe||n===ixe||n===oxe){if(null===(a=t.get("WEBGL_compressed_texture_astc")))return null;if(n===Xbe)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:a.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===Kbe)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:a.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===Ybe)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:a.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===Qbe)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:a.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===Zbe)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:a.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===Jbe)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:a.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===$be)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:a.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===exe)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:a.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===txe)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:a.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===nxe)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:a.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===rxe)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:a.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===axe)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:a.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===ixe)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:a.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===oxe)return i===_xe?a.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:a.COMPRESSED_RGBA_ASTC_12x12_KHR}if(n===sxe){if(null===(a=t.get("EXT_texture_compression_bptc")))return null;if(n===sxe)return i===_xe?a.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:a.COMPRESSED_RGBA_BPTC_UNORM_EXT}return n===_be?r?34042:null!==(a=t.get("WEBGL_depth_texture"))?a.UNSIGNED_INT_24_8_WEBGL:null:void 0!==e[n]?e[n]:null}}}var VTe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return $n(this,n),(e=t.call(this)).isArrayCamera=!0,e.cameras=r,e}return Jn(n)}(aSe),WTe=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this)).isGroup=!0,e.type="Group",e}return Jn(n)}(Zwe),GTe={type:"move"},jTe=function(){function e(){$n(this,e),this._targetRay=null,this._grip=null,this._hand=null}return Jn(e,[{key:"getHandSpace",value:function(){return null===this._hand&&(this._hand=new WTe,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}},{key:"getTargetRaySpace",value:function(){return null===this._targetRay&&(this._targetRay=new WTe,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Yke,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Yke),this._targetRay}},{key:"getGripSpace",value:function(){return null===this._grip&&(this._grip=new WTe,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Yke,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Yke),this._grip}},{key:"dispatchEvent",value:function(e){return null!==this._targetRay&&this._targetRay.dispatchEvent(e),null!==this._grip&&this._grip.dispatchEvent(e),null!==this._hand&&this._hand.dispatchEvent(e),this}},{key:"disconnect",value:function(e){return this.dispatchEvent({type:"disconnected",data:e}),null!==this._targetRay&&(this._targetRay.visible=!1),null!==this._grip&&(this._grip.visible=!1),null!==this._hand&&(this._hand.visible=!1),this}},{key:"update",value:function(e,t,n){var r=null,a=null,i=null,o=this._targetRay,s=this._grip,u=this._hand;if(e&&"visible-blurred"!==t.session.visibilityState){if(u&&e.hand){i=!0;var c,l=al(e.hand.values());try{for(l.s();!(c=l.n()).done;){var h=c.value,f=t.getJointPose(h,n);if(void 0===u.joints[h.jointName]){var d=new WTe;d.matrixAutoUpdate=!1,d.visible=!1,u.joints[h.jointName]=d,u.add(d)}var p=u.joints[h.jointName];null!==f&&(p.matrix.fromArray(f.transform.matrix),p.matrix.decompose(p.position,p.rotation,p.scale),p.jointRadius=f.radius),p.visible=null!==f}}catch($Pe){l.e($Pe)}finally{l.f()}var v=u.joints["index-finger-tip"],m=u.joints["thumb-tip"],g=v.position.distanceTo(m.position);u.inputState.pinching&&g>.025?(u.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!u.inputState.pinching&&g<=.015&&(u.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else null!==s&&e.gripSpace&&null!==(a=t.getPose(e.gripSpace,n))&&(s.matrix.fromArray(a.transform.matrix),s.matrix.decompose(s.position,s.rotation,s.scale),a.linearVelocity?(s.hasLinearVelocity=!0,s.linearVelocity.copy(a.linearVelocity)):s.hasLinearVelocity=!1,a.angularVelocity?(s.hasAngularVelocity=!0,s.angularVelocity.copy(a.angularVelocity)):s.hasAngularVelocity=!1);null!==o&&(null===(r=t.getPose(e.targetRaySpace,n))&&null!==a&&(r=a),null!==r&&(o.matrix.fromArray(r.transform.matrix),o.matrix.decompose(o.position,o.rotation,o.scale),r.linearVelocity?(o.hasLinearVelocity=!0,o.linearVelocity.copy(r.linearVelocity)):o.hasLinearVelocity=!1,r.angularVelocity?(o.hasAngularVelocity=!0,o.angularVelocity.copy(r.angularVelocity)):o.hasAngularVelocity=!1,this.dispatchEvent(GTe)))}return null!==o&&(o.visible=null!==r),null!==s&&(s.visible=null!==a),null!==u&&(u.visible=null!==i),this}}]),e}(),qTe=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i,o,s,u,c,l,h){var f;if($n(this,n),(h=void 0!==h?h:Abe)!==Abe&&h!==Mbe)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");return void 0===a&&h===Abe&&(a=ybe),void 0===a&&h===Mbe&&(a=_be),(f=t.call(this,null,i,o,s,u,c,h,a,l)).isDepthTexture=!0,f.image={width:e,height:r},f.magFilter=void 0!==u?u:rbe,f.minFilter=void 0!==c?c:rbe,f.flipY=!1,f.generateMipmaps=!1,f}return Jn(n)}(Uke),HTe=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;$n(this,n);var i=ir(a=t.call(this)),o=null,s=1,u=null,c="local-floor",l=null,h=null,f=null,d=null,p=null,v=null,m=r.getContextAttributes(),g=null,y=null,b=[],x=[],k=new aSe;k.layers.enable(1),k.viewport=new Vke;var w=new aSe;w.layers.enable(2),w.viewport=new Vke;var _=[k,w],S=new VTe;S.layers.enable(1),S.layers.enable(2);var C=null,T=null;function E(e){var t=x.indexOf(e.inputSource);if(-1!==t){var n=b[t];void 0!==n&&n.dispatchEvent({type:e.type,data:e.inputSource})}}function I(){o.removeEventListener("select",E),o.removeEventListener("selectstart",E),o.removeEventListener("selectend",E),o.removeEventListener("squeeze",E),o.removeEventListener("squeezestart",E),o.removeEventListener("squeezeend",E),o.removeEventListener("end",I),o.removeEventListener("inputsourceschange",A);for(var t=0;t<b.length;t++){var n=x[t];null!==n&&(x[t]=null,b[t].disconnect(n))}C=null,T=null,e.setRenderTarget(g),p=null,d=null,f=null,o=null,y=null,P.stop(),i.isPresenting=!1,i.dispatchEvent({type:"sessionend"})}function A(e){for(var t=0;t<e.removed.length;t++){var n=e.removed[t],r=x.indexOf(n);r>=0&&(x[r]=null,b[r].dispatchEvent({type:"disconnected",data:n}))}for(var a=0;a<e.added.length;a++){var i=e.added[a],o=x.indexOf(i);if(-1===o){for(var s=0;s<b.length;s++){if(s>=x.length){x.push(i),o=s;break}if(null===x[s]){x[s]=i,o=s;break}}if(-1===o)break}var u=b[o];u&&u.dispatchEvent({type:"connected",data:i})}}a.cameraAutoUpdate=!0,a.enabled=!1,a.isPresenting=!1,a.getController=function(e){var t=b[e];return void 0===t&&(t=new jTe,b[e]=t),t.getTargetRaySpace()},a.getControllerGrip=function(e){var t=b[e];return void 0===t&&(t=new jTe,b[e]=t),t.getGripSpace()},a.getHand=function(e){var t=b[e];return void 0===t&&(t=new jTe,b[e]=t),t.getHandSpace()},a.setFramebufferScaleFactor=function(e){s=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},a.setReferenceSpaceType=function(e){c=e,!0===i.isPresenting&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},a.getReferenceSpace=function(){return l||u},a.setReferenceSpace=function(e){l=e},a.getBaseLayer=function(){return null!==d?d:p},a.getBinding=function(){return f},a.getFrame=function(){return v},a.getSession=function(){return o},a.setSession=function(){var t=ns(es().mark((function t(n){var a,h,v,b,x;return es().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(null===(o=n)){t.next=25;break}if(g=e.getRenderTarget(),o.addEventListener("select",E),o.addEventListener("selectstart",E),o.addEventListener("selectend",E),o.addEventListener("squeeze",E),o.addEventListener("squeezestart",E),o.addEventListener("squeezeend",E),o.addEventListener("end",I),o.addEventListener("inputsourceschange",A),!0===m.xrCompatible){t.next=14;break}return t.next=14,r.makeXRCompatible();case 14:return void 0===o.renderState.layers||!1===e.capabilities.isWebGL2?(a={antialias:void 0!==o.renderState.layers||m.antialias,alpha:m.alpha,depth:m.depth,stencil:m.stencil,framebufferScaleFactor:s},p=new XRWebGLLayer(o,r,a),o.updateRenderState({baseLayer:p}),y=new Wke(p.framebufferWidth,p.framebufferHeight,{format:Tbe,type:dbe,encoding:e.outputEncoding})):(h=null,v=null,b=null,m.depth&&(b=m.stencil?35056:33190,h=m.stencil?Mbe:Abe,v=m.stencil?_be:ybe),x={colorFormat:32856,depthFormat:b,scaleFactor:s},f=new XRWebGLBinding(o,r),d=f.createProjectionLayer(x),o.updateRenderState({layers:[d]}),y=new Wke(d.textureWidth,d.textureHeight,{format:Tbe,type:dbe,depthTexture:new qTe(d.textureWidth,d.textureHeight,v,void 0,void 0,void 0,void 0,void 0,void 0,h),stencilBuffer:m.stencil,encoding:e.outputEncoding,samples:m.antialias?4:0}),e.properties.get(y).__ignoreDepthValues=d.ignoreDepthValues),y.isXRRenderTarget=!0,this.setFoveation(1),l=null,t.next=20,o.requestReferenceSpace(c);case 20:u=t.sent,P.setContext(o),P.start(),i.isPresenting=!0,i.dispatchEvent({type:"sessionstart"});case 25:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}();var M=new Yke,N=new Yke;function R(e,t){null===t?e.matrixWorld.copy(e.matrix):e.matrixWorld.multiplyMatrices(t.matrixWorld,e.matrix),e.matrixWorldInverse.copy(e.matrixWorld).invert()}a.updateCamera=function(e){if(null!==o){S.near=w.near=k.near=e.near,S.far=w.far=k.far=e.far,C===S.near&&T===S.far||(o.updateRenderState({depthNear:S.near,depthFar:S.far}),C=S.near,T=S.far);var t=e.parent,n=S.cameras;R(S,t);for(var r=0;r<n.length;r++)R(n[r],t);S.matrixWorld.decompose(S.position,S.quaternion,S.scale),e.position.copy(S.position),e.quaternion.copy(S.quaternion),e.scale.copy(S.scale),e.matrix.copy(S.matrix),e.matrixWorld.copy(S.matrixWorld);for(var a=e.children,i=0,s=a.length;i<s;i++)a[i].updateMatrixWorld(!0);2===n.length?function(e,t,n){M.setFromMatrixPosition(t.matrixWorld),N.setFromMatrixPosition(n.matrixWorld);var r=M.distanceTo(N),a=t.projectionMatrix.elements,i=n.projectionMatrix.elements,o=a[14]/(a[10]-1),s=a[14]/(a[10]+1),u=(a[9]+1)/a[5],c=(a[9]-1)/a[5],l=(a[8]-1)/a[0],h=(i[8]+1)/i[0],f=o*l,d=o*h,p=r/(-l+h),v=p*-l;t.matrixWorld.decompose(e.position,e.quaternion,e.scale),e.translateX(v),e.translateZ(p),e.matrixWorld.compose(e.position,e.quaternion,e.scale),e.matrixWorldInverse.copy(e.matrixWorld).invert();var m=o+p,g=s+p,y=f-v,b=d+(r-v),x=u*s/g*m,k=c*s/g*m;e.projectionMatrix.makePerspective(y,b,x,k,m,g)}(S,k,w):S.projectionMatrix.copy(k.projectionMatrix)}},a.getCamera=function(){return S},a.getFoveation=function(){return null!==d?d.fixedFoveation:null!==p?p.fixedFoveation:void 0},a.setFoveation=function(e){null!==d&&(d.fixedFoveation=e),null!==p&&void 0!==p.fixedFoveation&&(p.fixedFoveation=e)};var D=null;var P=new mSe;return P.setAnimationLoop((function(t,n){if(h=n.getViewerPose(l||u),v=n,null!==h){var r=h.views;null!==p&&(e.setRenderTargetFramebuffer(y,p.framebuffer),e.setRenderTarget(y));var a=!1;r.length!==S.cameras.length&&(S.cameras.length=0,a=!0);for(var i=0;i<r.length;i++){var o=r[i],s=null;if(null!==p)s=p.getViewport(o);else{var c=f.getViewSubImage(d,o);s=c.viewport,0===i&&(e.setRenderTargetTextures(y,c.colorTexture,d.ignoreDepthValues?void 0:c.depthStencilTexture),e.setRenderTarget(y))}var m=_[i];void 0===m&&((m=new aSe).layers.enable(i),m.viewport=new Vke,_[i]=m),m.matrix.fromArray(o.transform.matrix),m.projectionMatrix.fromArray(o.projectionMatrix),m.viewport.set(s.x,s.y,s.width,s.height),0===i&&S.matrix.copy(m.matrix),!0===a&&S.cameras.push(m)}}for(var g=0;g<b.length;g++){var k=x[g],w=b[g];null!==k&&void 0!==w&&w.update(k,n,l||u)}D&&D(t,n),v=null})),a.setAnimationLoop=function(e){D=e},a.dispose=function(){},a}return Jn(n)}(ike);function XTe(e,t){function n(n,r){n.opacity.value=r.opacity,r.color&&n.diffuse.value.copy(r.color),r.emissive&&n.emissive.value.copy(r.emissive).multiplyScalar(r.emissiveIntensity),r.map&&(n.map.value=r.map),r.alphaMap&&(n.alphaMap.value=r.alphaMap),r.bumpMap&&(n.bumpMap.value=r.bumpMap,n.bumpScale.value=r.bumpScale,r.side===iye&&(n.bumpScale.value*=-1)),r.displacementMap&&(n.displacementMap.value=r.displacementMap,n.displacementScale.value=r.displacementScale,n.displacementBias.value=r.displacementBias),r.emissiveMap&&(n.emissiveMap.value=r.emissiveMap),r.normalMap&&(n.normalMap.value=r.normalMap,n.normalScale.value.copy(r.normalScale),r.side===iye&&n.normalScale.value.negate()),r.specularMap&&(n.specularMap.value=r.specularMap),r.alphaTest>0&&(n.alphaTest.value=r.alphaTest);var a,i,o=t.get(r).envMap;if(o&&(n.envMap.value=o,n.flipEnvMap.value=o.isCubeTexture&&!1===o.isRenderTargetTexture?-1:1,n.reflectivity.value=r.reflectivity,n.ior.value=r.ior,n.refractionRatio.value=r.refractionRatio),r.lightMap){n.lightMap.value=r.lightMap;var s=!0!==e.physicallyCorrectLights?Math.PI:1;n.lightMapIntensity.value=r.lightMapIntensity*s}r.aoMap&&(n.aoMap.value=r.aoMap,n.aoMapIntensity.value=r.aoMapIntensity),r.map?a=r.map:r.specularMap?a=r.specularMap:r.displacementMap?a=r.displacementMap:r.normalMap?a=r.normalMap:r.bumpMap?a=r.bumpMap:r.roughnessMap?a=r.roughnessMap:r.metalnessMap?a=r.metalnessMap:r.alphaMap?a=r.alphaMap:r.emissiveMap?a=r.emissiveMap:r.clearcoatMap?a=r.clearcoatMap:r.clearcoatNormalMap?a=r.clearcoatNormalMap:r.clearcoatRoughnessMap?a=r.clearcoatRoughnessMap:r.iridescenceMap?a=r.iridescenceMap:r.iridescenceThicknessMap?a=r.iridescenceThicknessMap:r.specularIntensityMap?a=r.specularIntensityMap:r.specularColorMap?a=r.specularColorMap:r.transmissionMap?a=r.transmissionMap:r.thicknessMap?a=r.thicknessMap:r.sheenColorMap?a=r.sheenColorMap:r.sheenRoughnessMap&&(a=r.sheenRoughnessMap),void 0!==a&&(a.isWebGLRenderTarget&&(a=a.texture),!0===a.matrixAutoUpdate&&a.updateMatrix(),n.uvTransform.value.copy(a.matrix)),r.aoMap?i=r.aoMap:r.lightMap&&(i=r.lightMap),void 0!==i&&(i.isWebGLRenderTarget&&(i=i.texture),!0===i.matrixAutoUpdate&&i.updateMatrix(),n.uv2Transform.value.copy(i.matrix))}return{refreshFogUniforms:function(e,t){e.fogColor.value.copy(t.color),t.isFog?(e.fogNear.value=t.near,e.fogFar.value=t.far):t.isFogExp2&&(e.fogDensity.value=t.density)},refreshMaterialUniforms:function(e,r,a,i,o){r.isMeshBasicMaterial||r.isMeshLambertMaterial?n(e,r):r.isMeshToonMaterial?(n(e,r),function(e,t){t.gradientMap&&(e.gradientMap.value=t.gradientMap)}(e,r)):r.isMeshPhongMaterial?(n(e,r),function(e,t){e.specular.value.copy(t.specular),e.shininess.value=Math.max(t.shininess,1e-4)}(e,r)):r.isMeshStandardMaterial?(n(e,r),function(e,n){e.roughness.value=n.roughness,e.metalness.value=n.metalness,n.roughnessMap&&(e.roughnessMap.value=n.roughnessMap);n.metalnessMap&&(e.metalnessMap.value=n.metalnessMap);t.get(n).envMap&&(e.envMapIntensity.value=n.envMapIntensity)}(e,r),r.isMeshPhysicalMaterial&&function(e,t,n){e.ior.value=t.ior,t.sheen>0&&(e.sheenColor.value.copy(t.sheenColor).multiplyScalar(t.sheen),e.sheenRoughness.value=t.sheenRoughness,t.sheenColorMap&&(e.sheenColorMap.value=t.sheenColorMap),t.sheenRoughnessMap&&(e.sheenRoughnessMap.value=t.sheenRoughnessMap));t.clearcoat>0&&(e.clearcoat.value=t.clearcoat,e.clearcoatRoughness.value=t.clearcoatRoughness,t.clearcoatMap&&(e.clearcoatMap.value=t.clearcoatMap),t.clearcoatRoughnessMap&&(e.clearcoatRoughnessMap.value=t.clearcoatRoughnessMap),t.clearcoatNormalMap&&(e.clearcoatNormalScale.value.copy(t.clearcoatNormalScale),e.clearcoatNormalMap.value=t.clearcoatNormalMap,t.side===iye&&e.clearcoatNormalScale.value.negate()));t.iridescence>0&&(e.iridescence.value=t.iridescence,e.iridescenceIOR.value=t.iridescenceIOR,e.iridescenceThicknessMinimum.value=t.iridescenceThicknessRange[0],e.iridescenceThicknessMaximum.value=t.iridescenceThicknessRange[1],t.iridescenceMap&&(e.iridescenceMap.value=t.iridescenceMap),t.iridescenceThicknessMap&&(e.iridescenceThicknessMap.value=t.iridescenceThicknessMap));t.transmission>0&&(e.transmission.value=t.transmission,e.transmissionSamplerMap.value=n.texture,e.transmissionSamplerSize.value.set(n.width,n.height),t.transmissionMap&&(e.transmissionMap.value=t.transmissionMap),e.thickness.value=t.thickness,t.thicknessMap&&(e.thicknessMap.value=t.thicknessMap),e.attenuationDistance.value=t.attenuationDistance,e.attenuationColor.value.copy(t.attenuationColor));e.specularIntensity.value=t.specularIntensity,e.specularColor.value.copy(t.specularColor),t.specularIntensityMap&&(e.specularIntensityMap.value=t.specularIntensityMap);t.specularColorMap&&(e.specularColorMap.value=t.specularColorMap)}(e,r,o)):r.isMeshMatcapMaterial?(n(e,r),function(e,t){t.matcap&&(e.matcap.value=t.matcap)}(e,r)):r.isMeshDepthMaterial?n(e,r):r.isMeshDistanceMaterial?(n(e,r),function(e,t){e.referencePosition.value.copy(t.referencePosition),e.nearDistance.value=t.nearDistance,e.farDistance.value=t.farDistance}(e,r)):r.isMeshNormalMaterial?n(e,r):r.isLineBasicMaterial?(function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity}(e,r),r.isLineDashedMaterial&&function(e,t){e.dashSize.value=t.dashSize,e.totalSize.value=t.dashSize+t.gapSize,e.scale.value=t.scale}(e,r)):r.isPointsMaterial?function(e,t,n,r){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.size.value=t.size*n,e.scale.value=.5*r,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);var a;t.map?a=t.map:t.alphaMap&&(a=t.alphaMap);void 0!==a&&(!0===a.matrixAutoUpdate&&a.updateMatrix(),e.uvTransform.value.copy(a.matrix))}(e,r,a,i):r.isSpriteMaterial?function(e,t){e.diffuse.value.copy(t.color),e.opacity.value=t.opacity,e.rotation.value=t.rotation,t.map&&(e.map.value=t.map);t.alphaMap&&(e.alphaMap.value=t.alphaMap);t.alphaTest>0&&(e.alphaTest.value=t.alphaTest);var n;t.map?n=t.map:t.alphaMap&&(n=t.alphaMap);void 0!==n&&(!0===n.matrixAutoUpdate&&n.updateMatrix(),e.uvTransform.value.copy(n.matrix))}(e,r):r.isShadowMaterial?(e.color.value.copy(r.color),e.opacity.value=r.opacity):r.isShaderMaterial&&(r.uniformsNeedUpdate=!1)}}}function KTe(){var e=_ke("canvas");return e.style.display="block",e}function YTe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.isWebGLRenderer=!0;var t,n=void 0!==e.canvas?e.canvas:KTe(),r=void 0!==e.context?e.context:null,a=void 0===e.depth||e.depth,i=void 0===e.stencil||e.stencil,o=void 0!==e.antialias&&e.antialias,s=void 0===e.premultipliedAlpha||e.premultipliedAlpha,u=void 0!==e.preserveDrawingBuffer&&e.preserveDrawingBuffer,c=void 0!==e.powerPreference?e.powerPreference:"default",l=void 0!==e.failIfMajorPerformanceCaveat&&e.failIfMajorPerformanceCaveat;t=null!==r?r.getContextAttributes().alpha:void 0!==e.alpha&&e.alpha;var h=null,f=null,d=[],p=[];this.domElement=n,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.outputEncoding=wxe,this.physicallyCorrectLights=!1,this.toneMapping=Wye,this.toneMappingExposure=1,Object.defineProperties(this,{gammaFactor:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaFactor has been removed."),2},set:function(){console.warn("THREE.WebGLRenderer: .gammaFactor has been removed.")}}});var v=this,m=!1,g=0,y=0,b=null,x=-1,k=null,w=new Vke,_=new Vke,S=null,C=n.width,T=n.height,E=1,I=null,A=null,M=new Vke(0,0,C,T),N=new Vke(0,0,C,T),R=!1,D=new vSe,P=!1,O=!1,L=null,F=new Twe,z=new yke,B=new Yke,U={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};function V(){return null===b?E:1}var W,G,j,q,H,X,K,Y,Q,Z,J,$,ee,te,ne,re,ae,ie,oe,se,ue,ce,le,he=r;function fe(e,t){for(var r=0;r<e.length;r++){var a=e[r],i=n.getContext(a,t);if(null!==i)return i}return null}try{var de={alpha:!0,depth:a,stencil:i,antialias:o,premultipliedAlpha:s,preserveDrawingBuffer:u,powerPreference:c,failIfMajorPerformanceCaveat:l};if("setAttribute"in n&&n.setAttribute("data-engine","three.js r".concat(Xge)),n.addEventListener("webglcontextlost",ge,!1),n.addEventListener("webglcontextrestored",ye,!1),n.addEventListener("webglcontextcreationerror",be,!1),null===he){var pe=["webgl2","webgl","experimental-webgl"];if(!0===v.isWebGL1Renderer&&pe.shift(),null===(he=fe(pe,de)))throw fe(pe)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}void 0===he.getShaderPrecisionFormat&&(he.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(ze){throw console.error("THREE.WebGLRenderer: "+ze.message),ze}function ve(){W=new GSe(he),G=new CSe(he,W,e),W.init(G),ce=new UTe(he,W,G),j=new zTe(he,W,G),q=new HSe,H=new STe,X=new BTe(he,W,j,H,G,ce,q),K=new ESe(v),Y=new WSe(v),Q=new gSe(he,G),le=new _Se(he,W,Q,G),Z=new jSe(he,Q,q,le),J=new ZSe(he,Z,Q,q),oe=new QSe(he,G,X),re=new TSe(H),$=new _Te(v,K,Y,W,G,le,re),ee=new XTe(v,H),te=new ITe,ne=new PTe(W,G),ie=new wSe(v,K,j,J,t,s),ae=new FTe(v,J,G),se=new SSe(he,W,q,G),ue=new qSe(he,W,q,G),q.programs=$.programs,v.capabilities=G,v.extensions=W,v.properties=H,v.renderLists=te,v.shadowMap=ae,v.state=j,v.info=q}ve();var me=new HTe(v,he);function ge(e){e.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),m=!0}function ye(){console.log("THREE.WebGLRenderer: Context Restored."),m=!1;var e=q.autoReset,t=ae.enabled,n=ae.autoUpdate,r=ae.needsUpdate,a=ae.type;ve(),q.autoReset=e,ae.enabled=t,ae.autoUpdate=n,ae.needsUpdate=r,ae.type=a}function be(e){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",e.statusMessage)}function xe(e){var t=e.target;t.removeEventListener("dispose",xe),ke(t)}function ke(e){we(e),H.remove(e)}function we(e){var t=H.get(e).programs;void 0!==t&&(t.forEach((function(e){$.releaseProgram(e)})),e.isShaderMaterial&&$.releaseShaderCache(e))}this.xr=me,this.getContext=function(){return he},this.getContextAttributes=function(){return he.getContextAttributes()},this.forceContextLoss=function(){var e=W.get("WEBGL_lose_context");e&&e.loseContext()},this.forceContextRestore=function(){var e=W.get("WEBGL_lose_context");e&&e.restoreContext()},this.getPixelRatio=function(){return E},this.setPixelRatio=function(e){void 0!==e&&(E=e,this.setSize(C,T,!1))},this.getSize=function(e){return e.set(C,T)},this.setSize=function(e,t,r){me.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(C=e,T=t,n.width=Math.floor(e*E),n.height=Math.floor(t*E),!1!==r&&(n.style.width=e+"px",n.style.height=t+"px"),this.setViewport(0,0,e,t))},this.getDrawingBufferSize=function(e){return e.set(C*E,T*E).floor()},this.setDrawingBufferSize=function(e,t,r){C=e,T=t,E=r,n.width=Math.floor(e*r),n.height=Math.floor(t*r),this.setViewport(0,0,e,t)},this.getCurrentViewport=function(e){return e.copy(w)},this.getViewport=function(e){return e.copy(M)},this.setViewport=function(e,t,n,r){e.isVector4?M.set(e.x,e.y,e.z,e.w):M.set(e,t,n,r),j.viewport(w.copy(M).multiplyScalar(E).floor())},this.getScissor=function(e){return e.copy(N)},this.setScissor=function(e,t,n,r){e.isVector4?N.set(e.x,e.y,e.z,e.w):N.set(e,t,n,r),j.scissor(_.copy(N).multiplyScalar(E).floor())},this.getScissorTest=function(){return R},this.setScissorTest=function(e){j.setScissorTest(R=e)},this.setOpaqueSort=function(e){I=e},this.setTransparentSort=function(e){A=e},this.getClearColor=function(e){return e.copy(ie.getClearColor())},this.setClearColor=function(){ie.setClearColor.apply(ie,arguments)},this.getClearAlpha=function(){return ie.getClearAlpha()},this.setClearAlpha=function(){ie.setClearAlpha.apply(ie,arguments)},this.clear=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],r=0;e&&(r|=16384),t&&(r|=256),n&&(r|=1024),he.clear(r)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){n.removeEventListener("webglcontextlost",ge,!1),n.removeEventListener("webglcontextrestored",ye,!1),n.removeEventListener("webglcontextcreationerror",be,!1),te.dispose(),ne.dispose(),H.dispose(),K.dispose(),Y.dispose(),J.dispose(),le.dispose(),$.dispose(),me.dispose(),me.removeEventListener("sessionstart",Ce),me.removeEventListener("sessionend",Te),L&&(L.dispose(),L=null),Ee.stop()},this.renderBufferDirect=function(e,t,n,r,a,i){null===t&&(t=U);var o=a.isMesh&&a.matrixWorld.determinant()<0,s=Oe(e,t,n,r,a);j.setMaterial(r,o);var u=n.index,c=n.attributes.position;if(null===u){if(void 0===c||0===c.count)return}else if(0===u.count)return;var l,h=1;!0===r.wireframe&&(u=Z.getWireframeAttribute(n),h=2),le.setup(a,r,s,n,u);var f=se;null!==u&&(l=Q.get(u),(f=ue).setIndex(l));var d=null!==u?u.count:c.count,p=n.drawRange.start*h,v=n.drawRange.count*h,m=null!==i?i.start*h:0,g=null!==i?i.count*h:1/0,y=Math.max(p,m),b=Math.min(d,p+v,m+g)-1,x=Math.max(0,b-y+1);if(0!==x){if(a.isMesh)!0===r.wireframe?(j.setLineWidth(r.wireframeLinewidth*V()),f.setMode(1)):f.setMode(4);else if(a.isLine){var k=r.linewidth;void 0===k&&(k=1),j.setLineWidth(k*V()),a.isLineSegments?f.setMode(1):a.isLineLoop?f.setMode(2):f.setMode(3)}else a.isPoints?f.setMode(0):a.isSprite&&f.setMode(4);if(a.isInstancedMesh)f.renderInstances(y,x,a.count);else if(n.isInstancedBufferGeometry){var w=Math.min(n.instanceCount,n._maxInstanceCount);f.renderInstances(y,x,w)}else f.render(y,x)}},this.compile=function(e,t){(f=ne.get(e)).init(),p.push(f),e.traverseVisible((function(e){e.isLight&&e.layers.test(t.layers)&&(f.pushLight(e),e.castShadow&&f.pushShadow(e))})),f.setupLights(v.physicallyCorrectLights),e.traverse((function(t){var n=t.material;if(n)if(Array.isArray(n))for(var r=0;r<n.length;r++){De(n[r],e,t)}else De(n,e,t)})),p.pop(),f=null};var _e=null;function Se(e){_e&&_e(e)}function Ce(){Ee.stop()}function Te(){Ee.start()}var Ee=new mSe;function Ie(e,t,n,r){if(!1!==e.visible){if(e.layers.test(t.layers))if(e.isGroup)n=e.renderOrder;else if(e.isLOD)!0===e.autoUpdate&&e.update(t);else if(e.isLight)f.pushLight(e),e.castShadow&&f.pushShadow(e);else if(e.isSprite){if(!e.frustumCulled||D.intersectsSprite(e)){r&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);var a=J.update(e),i=e.material;i.visible&&h.push(e,a,i,n,B.z,null)}}else if((e.isMesh||e.isLine||e.isPoints)&&(e.isSkinnedMesh&&e.skeleton.frame!==q.render.frame&&(e.skeleton.update(),e.skeleton.frame=q.render.frame),!e.frustumCulled||D.intersectsObject(e))){r&&B.setFromMatrixPosition(e.matrixWorld).applyMatrix4(F);var o=J.update(e),s=e.material;if(Array.isArray(s))for(var u=o.groups,c=0,l=u.length;c<l;c++){var d=u[c],p=s[d.materialIndex];p&&p.visible&&h.push(e,o,p,n,B.z,d)}else s.visible&&h.push(e,o,s,n,B.z,null)}for(var v=e.children,m=0,g=v.length;m<g;m++)Ie(v[m],t,n,r)}}function Ae(e,t,n,r){var a=e.opaque,i=e.transmissive,o=e.transparent;f.setupLightsView(n),i.length>0&&Me(a,t,n),r&&j.viewport(w.copy(r)),a.length>0&&Ne(a,t,n),i.length>0&&Ne(i,t,n),o.length>0&&Ne(o,t,n),j.buffers.depth.setTest(!0),j.buffers.depth.setMask(!0),j.buffers.color.setMask(!0),j.setPolygonOffset(!1)}function Me(e,t,n){var r=G.isWebGL2;null===L&&(L=new Wke(1,1,{generateMipmaps:!0,type:W.has("EXT_color_buffer_half_float")?xbe:dbe,minFilter:hbe,samples:r&&!0===o?4:0})),v.getDrawingBufferSize(z),r?L.setSize(z.x,z.y):L.setSize(mke(z.x),mke(z.y));var a=v.getRenderTarget();v.setRenderTarget(L),v.clear();var i=v.toneMapping;v.toneMapping=Wye,Ne(e,t,n),v.toneMapping=i,X.updateMultisampleRenderTarget(L),X.updateRenderTargetMipmap(L),v.setRenderTarget(a)}function Ne(e,t,n){for(var r=!0===t.isScene?t.overrideMaterial:null,a=0,i=e.length;a<i;a++){var o=e[a],s=o.object,u=o.geometry,c=null===r?o.material:r,l=o.group;s.layers.test(n.layers)&&Re(s,t,n,u,c,l)}}function Re(e,t,n,r,a,i){e.onBeforeRender(v,t,n,r,a,i),e.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,e.matrixWorld),e.normalMatrix.getNormalMatrix(e.modelViewMatrix),a.onBeforeRender(v,t,n,r,e,i),!0===a.transparent&&a.side===oye?(a.side=iye,a.needsUpdate=!0,v.renderBufferDirect(n,t,r,a,e,i),a.side=aye,a.needsUpdate=!0,v.renderBufferDirect(n,t,r,a,e,i),a.side=oye):v.renderBufferDirect(n,t,r,a,e,i),e.onAfterRender(v,t,n,r,a,i)}function De(e,t,n){!0!==t.isScene&&(t=U);var r=H.get(e),a=f.state.lights,i=f.state.shadowsArray,o=a.state.version,s=$.getParameters(e,a.state,i,t,n),u=$.getProgramCacheKey(s),c=r.programs;r.environment=e.isMeshStandardMaterial?t.environment:null,r.fog=t.fog,r.envMap=(e.isMeshStandardMaterial?Y:K).get(e.envMap||r.environment),void 0===c&&(e.addEventListener("dispose",xe),c=new Map,r.programs=c);var l=c.get(u);if(void 0!==l){if(r.currentProgram===l&&r.lightsStateVersion===o)return Pe(e,s),l}else s.uniforms=$.getUniforms(e),e.onBuild(n,s,v),e.onBeforeCompile(s,v),l=$.acquireProgram(s,u),c.set(u,l),r.uniforms=s.uniforms;var h=r.uniforms;(e.isShaderMaterial||e.isRawShaderMaterial)&&!0!==e.clipping||(h.clippingPlanes=re.uniform),Pe(e,s),r.needsLights=Fe(e),r.lightsStateVersion=o,r.needsLights&&(h.ambientLightColor.value=a.state.ambient,h.lightProbe.value=a.state.probe,h.directionalLights.value=a.state.directional,h.directionalLightShadows.value=a.state.directionalShadow,h.spotLights.value=a.state.spot,h.spotLightShadows.value=a.state.spotShadow,h.rectAreaLights.value=a.state.rectArea,h.ltc_1.value=a.state.rectAreaLTC1,h.ltc_2.value=a.state.rectAreaLTC2,h.pointLights.value=a.state.point,h.pointLightShadows.value=a.state.pointShadow,h.hemisphereLights.value=a.state.hemi,h.directionalShadowMap.value=a.state.directionalShadowMap,h.directionalShadowMatrix.value=a.state.directionalShadowMatrix,h.spotShadowMap.value=a.state.spotShadowMap,h.spotShadowMatrix.value=a.state.spotShadowMatrix,h.pointShadowMap.value=a.state.pointShadowMap,h.pointShadowMatrix.value=a.state.pointShadowMatrix);var d=l.getUniforms(),p=tTe.seqWithValue(d.seq,h);return r.currentProgram=l,r.uniformsList=p,l}function Pe(e,t){var n=H.get(e);n.outputEncoding=t.outputEncoding,n.instancing=t.instancing,n.skinning=t.skinning,n.morphTargets=t.morphTargets,n.morphNormals=t.morphNormals,n.morphColors=t.morphColors,n.morphTargetsCount=t.morphTargetsCount,n.numClippingPlanes=t.numClippingPlanes,n.numIntersection=t.numClipIntersection,n.vertexAlphas=t.vertexAlphas,n.vertexTangents=t.vertexTangents,n.toneMapping=t.toneMapping}function Oe(e,t,n,r,a){!0!==t.isScene&&(t=U),X.resetTextureUnits();var i=t.fog,o=r.isMeshStandardMaterial?t.environment:null,s=null===b?v.outputEncoding:!0===b.isXRRenderTarget?b.texture.encoding:wxe,u=(r.isMeshStandardMaterial?Y:K).get(r.envMap||o),c=!0===r.vertexColors&&!!n.attributes.color&&4===n.attributes.color.itemSize,l=!!r.normalMap&&!!n.attributes.tangent,h=!!n.morphAttributes.position,d=!!n.morphAttributes.normal,p=!!n.morphAttributes.color,m=r.toneMapped?v.toneMapping:Wye,g=n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color,y=void 0!==g?g.length:0,w=H.get(r),_=f.state.lights;if(!0===P&&(!0===O||e!==k)){var S=e===k&&r.id===x;re.setState(r,e,S)}var C=!1;r.version===w.__version?w.needsLights&&w.lightsStateVersion!==_.state.version||w.outputEncoding!==s||a.isInstancedMesh&&!1===w.instancing?C=!0:a.isInstancedMesh||!0!==w.instancing?a.isSkinnedMesh&&!1===w.skinning?C=!0:a.isSkinnedMesh||!0!==w.skinning?w.envMap!==u||!0===r.fog&&w.fog!==i?C=!0:void 0===w.numClippingPlanes||w.numClippingPlanes===re.numPlanes&&w.numIntersection===re.numIntersection?(w.vertexAlphas!==c||w.vertexTangents!==l||w.morphTargets!==h||w.morphNormals!==d||w.morphColors!==p||w.toneMapping!==m||!0===G.isWebGL2&&w.morphTargetsCount!==y)&&(C=!0):C=!0:C=!0:C=!0:(C=!0,w.__version=r.version);var I=w.currentProgram;!0===C&&(I=De(r,t,a));var A=!1,M=!1,N=!1,R=I.getUniforms(),D=w.uniforms;if(j.useProgram(I.program)&&(A=!0,M=!0,N=!0),r.id!==x&&(x=r.id,M=!0),A||k!==e){if(R.setValue(he,"projectionMatrix",e.projectionMatrix),G.logarithmicDepthBuffer&&R.setValue(he,"logDepthBufFC",2/(Math.log(e.far+1)/Math.LN2)),k!==e&&(k=e,M=!0,N=!0),r.isShaderMaterial||r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshStandardMaterial||r.envMap){var F=R.map.cameraPosition;void 0!==F&&F.setValue(he,B.setFromMatrixPosition(e.matrixWorld))}(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial)&&R.setValue(he,"isOrthographic",!0===e.isOrthographicCamera),(r.isMeshPhongMaterial||r.isMeshToonMaterial||r.isMeshLambertMaterial||r.isMeshBasicMaterial||r.isMeshStandardMaterial||r.isShaderMaterial||r.isShadowMaterial||a.isSkinnedMesh)&&R.setValue(he,"viewMatrix",e.matrixWorldInverse)}if(a.isSkinnedMesh){R.setOptional(he,a,"bindMatrix"),R.setOptional(he,a,"bindMatrixInverse");var z=a.skeleton;z&&(G.floatVertexTextures?(null===z.boneTexture&&z.computeBoneTexture(),R.setValue(he,"boneTexture",z.boneTexture,X),R.setValue(he,"boneTextureSize",z.boneTextureSize)):console.warn("THREE.WebGLRenderer: SkinnedMesh can only be used with WebGL 2. With WebGL 1 OES_texture_float and vertex textures support is required."))}var V=n.morphAttributes;return(void 0!==V.position||void 0!==V.normal||void 0!==V.color&&!0===G.isWebGL2)&&oe.update(a,n,r,I),(M||w.receiveShadow!==a.receiveShadow)&&(w.receiveShadow=a.receiveShadow,R.setValue(he,"receiveShadow",a.receiveShadow)),M&&(R.setValue(he,"toneMappingExposure",v.toneMappingExposure),w.needsLights&&Le(D,N),i&&!0===r.fog&&ee.refreshFogUniforms(D,i),ee.refreshMaterialUniforms(D,r,E,T,L),tTe.upload(he,w.uniformsList,D,X)),r.isShaderMaterial&&!0===r.uniformsNeedUpdate&&(tTe.upload(he,w.uniformsList,D,X),r.uniformsNeedUpdate=!1),r.isSpriteMaterial&&R.setValue(he,"center",a.center),R.setValue(he,"modelViewMatrix",a.modelViewMatrix),R.setValue(he,"normalMatrix",a.normalMatrix),R.setValue(he,"modelMatrix",a.matrixWorld),I}function Le(e,t){e.ambientLightColor.needsUpdate=t,e.lightProbe.needsUpdate=t,e.directionalLights.needsUpdate=t,e.directionalLightShadows.needsUpdate=t,e.pointLights.needsUpdate=t,e.pointLightShadows.needsUpdate=t,e.spotLights.needsUpdate=t,e.spotLightShadows.needsUpdate=t,e.rectAreaLights.needsUpdate=t,e.hemisphereLights.needsUpdate=t}function Fe(e){return e.isMeshLambertMaterial||e.isMeshToonMaterial||e.isMeshPhongMaterial||e.isMeshStandardMaterial||e.isShadowMaterial||e.isShaderMaterial&&!0===e.lights}Ee.setAnimationLoop(Se),"undefined"!==typeof self&&Ee.setContext(self),this.setAnimationLoop=function(e){_e=e,me.setAnimationLoop(e),null===e?Ee.stop():Ee.start()},me.addEventListener("sessionstart",Ce),me.addEventListener("sessionend",Te),this.render=function(e,t){if(void 0===t||!0===t.isCamera){if(!0!==m){!0===e.autoUpdate&&e.updateMatrixWorld(),null===t.parent&&t.updateMatrixWorld(),!0===me.enabled&&!0===me.isPresenting&&(!0===me.cameraAutoUpdate&&me.updateCamera(t),t=me.getCamera()),!0===e.isScene&&e.onBeforeRender(v,e,t,b),(f=ne.get(e,p.length)).init(),p.push(f),F.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),D.setFromProjectionMatrix(F),O=this.localClippingEnabled,P=re.init(this.clippingPlanes,O,t),(h=te.get(e,d.length)).init(),d.push(h),Ie(e,t,0,v.sortObjects),h.finish(),!0===v.sortObjects&&h.sort(I,A),!0===P&&re.beginShadows();var n=f.state.shadowsArray;if(ae.render(n,e,t),!0===P&&re.endShadows(),!0===this.info.autoReset&&this.info.reset(),ie.render(h,e),f.setupLights(v.physicallyCorrectLights),t.isArrayCamera)for(var r=t.cameras,a=0,i=r.length;a<i;a++){var o=r[a];Ae(h,e,o,o.viewport)}else Ae(h,e,t);null!==b&&(X.updateMultisampleRenderTarget(b),X.updateRenderTargetMipmap(b)),!0===e.isScene&&e.onAfterRender(v,e,t),le.resetDefaultState(),x=-1,k=null,p.pop(),f=p.length>0?p[p.length-1]:null,d.pop(),h=d.length>0?d[d.length-1]:null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.getActiveCubeFace=function(){return g},this.getActiveMipmapLevel=function(){return y},this.getRenderTarget=function(){return b},this.setRenderTargetTextures=function(e,t,n){H.get(e.texture).__webglTexture=t,H.get(e.depthTexture).__webglTexture=n;var r=H.get(e);r.__hasExternalTextures=!0,r.__hasExternalTextures&&(r.__autoAllocateDepthBuffer=void 0===n,r.__autoAllocateDepthBuffer||!0===W.has("WEBGL_multisampled_render_to_texture")&&(console.warn("THREE.WebGLRenderer: Render-to-texture extension was disabled because an external texture was provided"),r.__useRenderToTexture=!1))},this.setRenderTargetFramebuffer=function(e,t){var n=H.get(e);n.__webglFramebuffer=t,n.__useDefaultFramebuffer=void 0===t},this.setRenderTarget=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;b=e,g=t,y=n;var r=!0;if(e){var a=H.get(e);void 0!==a.__useDefaultFramebuffer?(j.bindFramebuffer(36160,null),r=!1):void 0===a.__webglFramebuffer?X.setupRenderTarget(e):a.__hasExternalTextures&&X.rebindTextures(e,H.get(e.texture).__webglTexture,H.get(e.depthTexture).__webglTexture)}var i=null,o=!1,s=!1;if(e){var u=e.texture;(u.isData3DTexture||u.isDataArrayTexture)&&(s=!0);var c=H.get(e).__webglFramebuffer;e.isWebGLCubeRenderTarget?(i=c[t],o=!0):i=G.isWebGL2&&e.samples>0&&!1===X.useMultisampledRTT(e)?H.get(e).__webglMultisampledFramebuffer:c,w.copy(e.viewport),_.copy(e.scissor),S=e.scissorTest}else w.copy(M).multiplyScalar(E).floor(),_.copy(N).multiplyScalar(E).floor(),S=R;var l=j.bindFramebuffer(36160,i);if(l&&G.drawBuffers&&r&&j.drawBuffers(e,i),j.viewport(w),j.scissor(_),j.setScissorTest(S),o){var h=H.get(e.texture);he.framebufferTexture2D(36160,36064,34069+t,h.__webglTexture,n)}else if(s){var f=H.get(e.texture),d=t||0;he.framebufferTextureLayer(36160,36064,f.__webglTexture,n||0,d)}x=-1},this.readRenderTargetPixels=function(e,t,n,r,a,i,o){if(e&&e.isWebGLRenderTarget){var s=H.get(e).__webglFramebuffer;if(e.isWebGLCubeRenderTarget&&void 0!==o&&(s=s[o]),s){j.bindFramebuffer(36160,s);try{var u=e.texture,c=u.format,l=u.type;if(c!==Tbe&&ce.convert(c)!==he.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");var h=l===xbe&&(W.has("EXT_color_buffer_half_float")||G.isWebGL2&&W.has("EXT_color_buffer_float"));if(l!==dbe&&ce.convert(l)!==he.getParameter(35738)&&(l!==bbe||!(G.isWebGL2||W.has("OES_texture_float")||W.has("WEBGL_color_buffer_float")))&&!h)return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");t>=0&&t<=e.width-r&&n>=0&&n<=e.height-a&&he.readPixels(t,n,r,a,ce.convert(c),ce.convert(l),i)}finally{var f=null!==b?H.get(b).__webglFramebuffer:null;j.bindFramebuffer(36160,f)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Math.pow(2,-n),a=Math.floor(t.image.width*r),i=Math.floor(t.image.height*r);X.setTexture2D(t,0),he.copyTexSubImage2D(3553,n,0,0,e.x,e.y,a,i),j.unbindTexture()},this.copyTextureToTexture=function(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,a=t.image.width,i=t.image.height,o=ce.convert(n.format),s=ce.convert(n.type);X.setTexture2D(n,0),he.pixelStorei(37440,n.flipY),he.pixelStorei(37441,n.premultiplyAlpha),he.pixelStorei(3317,n.unpackAlignment),t.isDataTexture?he.texSubImage2D(3553,r,e.x,e.y,a,i,o,s,t.image.data):t.isCompressedTexture?he.compressedTexSubImage2D(3553,r,e.x,e.y,t.mipmaps[0].width,t.mipmaps[0].height,o,t.mipmaps[0].data):he.texSubImage2D(3553,r,e.x,e.y,o,s,t.image),0===r&&n.generateMipmaps&&he.generateMipmap(3553),j.unbindTexture()},this.copyTextureToTexture3D=function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;if(v.isWebGL1Renderer)console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: can only be used with WebGL2.");else{var i,o=e.max.x-e.min.x+1,s=e.max.y-e.min.y+1,u=e.max.z-e.min.z+1,c=ce.convert(r.format),l=ce.convert(r.type);if(r.isData3DTexture)X.setTexture3D(r,0),i=32879;else{if(!r.isDataArrayTexture)return void console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: only supports THREE.DataTexture3D and THREE.DataTexture2DArray.");X.setTexture2DArray(r,0),i=35866}he.pixelStorei(37440,r.flipY),he.pixelStorei(37441,r.premultiplyAlpha),he.pixelStorei(3317,r.unpackAlignment);var h=he.getParameter(3314),f=he.getParameter(32878),d=he.getParameter(3316),p=he.getParameter(3315),m=he.getParameter(32877),g=n.isCompressedTexture?n.mipmaps[0]:n.image;he.pixelStorei(3314,g.width),he.pixelStorei(32878,g.height),he.pixelStorei(3316,e.min.x),he.pixelStorei(3315,e.min.y),he.pixelStorei(32877,e.min.z),n.isDataTexture||n.isData3DTexture?he.texSubImage3D(i,a,t.x,t.y,t.z,o,s,u,c,l,g.data):n.isCompressedTexture?(console.warn("THREE.WebGLRenderer.copyTextureToTexture3D: untested support for compressed srcTexture."),he.compressedTexSubImage3D(i,a,t.x,t.y,t.z,o,s,u,c,g.data)):he.texSubImage3D(i,a,t.x,t.y,t.z,o,s,u,c,l,g),he.pixelStorei(3314,h),he.pixelStorei(32878,f),he.pixelStorei(3316,d),he.pixelStorei(3315,p),he.pixelStorei(32877,m),0===a&&r.generateMipmaps&&he.generateMipmap(i),j.unbindTexture()}},this.initTexture=function(e){e.isCubeTexture?X.setTextureCube(e,0):e.isData3DTexture?X.setTexture3D(e,0):e.isDataArrayTexture?X.setTexture2DArray(e,0):X.setTexture2D(e,0),j.unbindTexture()},this.resetState=function(){g=0,y=0,b=null,j.reset(),le.reset()},"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}var QTe=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n)}(YTe);QTe.prototype.isWebGL1Renderer=!0;var ZTe,JTe=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:25e-5;$n(this,e),this.isFogExp2=!0,this.name="",this.color=new Oke(t),this.density=n}return Jn(e,[{key:"clone",value:function(){return new e(this.color,this.density)}},{key:"toJSON",value:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}]),e}(),$Te=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3;$n(this,e),this.isFog=!0,this.name="",this.color=new Oke(t),this.near=n,this.far=r}return Jn(e,[{key:"clone",value:function(){return new e(this.color,this.near,this.far)}},{key:"toJSON",value:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}]),e}(),eEe=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this)).isScene=!0,e.type="Scene",e.background=null,e.environment=null,e.fog=null,e.overrideMaterial=null,e.autoUpdate=!0,"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:ir(e)})),e}return Jn(n,[{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),null!==e.background&&(this.background=e.background.clone()),null!==e.environment&&(this.environment=e.environment.clone()),null!==e.fog&&(this.fog=e.fog.clone()),null!==e.overrideMaterial&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this}},{key:"toJSON",value:function(e){var t=ja(nr(n.prototype),"toJSON",this).call(this,e);return null!==this.fog&&(t.object.fog=this.fog.toJSON()),t}}]),n}(Zwe),tEe=function(){function e(t,n){$n(this,e),this.isInterleavedBuffer=!0,this.array=t,this.stride=n,this.count=void 0!==t?t.length/n:0,this.usage=Xxe,this.updateRange={offset:0,count:-1},this.version=0,this.uuid=lke()}return Jn(e,[{key:"onUploadCallback",value:function(){}},{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setUsage",value:function(e){return this.usage=e,this}},{key:"copy",value:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}},{key:"copyAt",value:function(e,t,n){e*=this.stride,n*=t.stride;for(var r=0,a=this.stride;r<a;r++)this.array[e+r]=t.array[n+r];return this}},{key:"set",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.array.set(e,t),this}},{key:"clone",value:function(e){void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=lke()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);var t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}},{key:"onUpload",value:function(e){return this.onUploadCallback=e,this}},{key:"toJSON",value:function(e){return void 0===e.arrayBuffers&&(e.arrayBuffers={}),void 0===this.array.buffer._uuid&&(this.array.buffer._uuid=lke()),void 0===e.arrayBuffers[this.array.buffer._uuid]&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}]),e}(),nEe=new Yke,rEe=function(){function e(t,n,r){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];$n(this,e),this.isInterleavedBufferAttribute=!0,this.name="",this.data=t,this.itemSize=n,this.offset=r,this.normalized=!0===a}return Jn(e,[{key:"count",get:function(){return this.data.count}},{key:"array",get:function(){return this.data.array}},{key:"needsUpdate",set:function(e){this.data.needsUpdate=e}},{key:"applyMatrix4",value:function(e){for(var t=0,n=this.data.count;t<n;t++)nEe.fromBufferAttribute(this,t),nEe.applyMatrix4(e),this.setXYZ(t,nEe.x,nEe.y,nEe.z);return this}},{key:"applyNormalMatrix",value:function(e){for(var t=0,n=this.count;t<n;t++)nEe.fromBufferAttribute(this,t),nEe.applyNormalMatrix(e),this.setXYZ(t,nEe.x,nEe.y,nEe.z);return this}},{key:"transformDirection",value:function(e){for(var t=0,n=this.count;t<n;t++)nEe.fromBufferAttribute(this,t),nEe.transformDirection(e),this.setXYZ(t,nEe.x,nEe.y,nEe.z);return this}},{key:"setX",value:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this}},{key:"setY",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this}},{key:"setZ",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this}},{key:"setW",value:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this}},{key:"getX",value:function(e){return this.data.array[e*this.data.stride+this.offset]}},{key:"getY",value:function(e){return this.data.array[e*this.data.stride+this.offset+1]}},{key:"getZ",value:function(e){return this.data.array[e*this.data.stride+this.offset+2]}},{key:"getW",value:function(e){return this.data.array[e*this.data.stride+this.offset+3]}},{key:"setXY",value:function(e,t,n){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this}},{key:"setXYZ",value:function(e,t,n,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this}},{key:"setXYZW",value:function(e,t,n,r,a){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=r,this.data.array[e+3]=a,this}},{key:"clone",value:function(t){if(void 0===t){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will deinterleave buffer data.");for(var n=[],r=0;r<this.count;r++)for(var a=r*this.data.stride+this.offset,i=0;i<this.itemSize;i++)n.push(this.data.array[a+i]);return new p_e(new this.array.constructor(n),this.itemSize,this.normalized)}return void 0===t.interleavedBuffers&&(t.interleavedBuffers={}),void 0===t.interleavedBuffers[this.data.uuid]&&(t.interleavedBuffers[this.data.uuid]=this.data.clone(t)),new e(t.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}},{key:"toJSON",value:function(e){if(void 0===e){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will deinterleave buffer data.");for(var t=[],n=0;n<this.count;n++)for(var r=n*this.data.stride+this.offset,a=0;a<this.itemSize;a++)t.push(this.data.array[r+a]);return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}return void 0===e.interleavedBuffers&&(e.interleavedBuffers={}),void 0===e.interleavedBuffers[this.data.uuid]&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}]),e}(),aEe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isSpriteMaterial=!0,r.type="SpriteMaterial",r.color=new Oke(16777215),r.map=null,r.alphaMap=null,r.rotation=0,r.sizeAttenuation=!0,r.transparent=!0,r.fog=!0,r.setValues(e),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}]),n}(l_e),iEe=new Yke,oEe=new Yke,sEe=new Yke,uEe=new yke,cEe=new yke,lEe=new Twe,hEe=new Yke,fEe=new Yke,dEe=new Yke,pEe=new yke,vEe=new yke,mEe=new yke,gEe=function(e){tr(n,e);var t=sr(n);function n(e){var r;if($n(this,n),(r=t.call(this)).isSprite=!0,r.type="Sprite",void 0===ZTe){ZTe=new R_e;var a=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),i=new tEe(a,5);ZTe.setIndex([0,1,2,0,2,3]),ZTe.setAttribute("position",new rEe(i,3,0,!1)),ZTe.setAttribute("uv",new rEe(i,2,3,!1))}return r.geometry=ZTe,r.material=void 0!==e?e:new aEe,r.center=new yke(.5,.5),r}return Jn(n,[{key:"raycast",value:function(e,t){null===e.camera&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),oEe.setFromMatrixScale(this.matrixWorld),lEe.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),sEe.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&!1===this.material.sizeAttenuation&&oEe.multiplyScalar(-sEe.z);var n,r,a=this.material.rotation;0!==a&&(r=Math.cos(a),n=Math.sin(a));var i=this.center;yEe(hEe.set(-.5,-.5,0),sEe,i,oEe,n,r),yEe(fEe.set(.5,-.5,0),sEe,i,oEe,n,r),yEe(dEe.set(.5,.5,0),sEe,i,oEe,n,r),pEe.set(0,0),vEe.set(1,0),mEe.set(1,1);var o=e.ray.intersectTriangle(hEe,fEe,dEe,!1,iEe);if(null!==o||(yEe(fEe.set(-.5,.5,0),sEe,i,oEe,n,r),vEe.set(0,1),null!==(o=e.ray.intersectTriangle(hEe,dEe,fEe,!1,iEe)))){var s=e.ray.origin.distanceTo(iEe);s<e.near||s>e.far||t.push({distance:s,point:iEe.clone(),uv:u_e.getUV(iEe,hEe,fEe,dEe,pEe,vEe,mEe,new yke),face:null,object:this})}}},{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),void 0!==e.center&&this.center.copy(e.center),this.material=e.material,this}}]),n}(Zwe);function yEe(e,t,n,r,a,i){uEe.subVectors(e,n).addScalar(.5).multiply(r),void 0!==a?(cEe.x=i*uEe.x-a*uEe.y,cEe.y=a*uEe.x+i*uEe.y):cEe.copy(uEe),e.copy(t),e.x+=cEe.x,e.y+=cEe.y,e.applyMatrix4(lEe)}var bEe=new Yke,xEe=new Yke,kEe=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this))._currentLevel=0,e.type="LOD",Object.defineProperties(ir(e),{levels:{enumerable:!0,value:[]},isLOD:{value:!0}}),e.autoUpdate=!0,e}return Jn(n,[{key:"copy",value:function(e){ja(nr(n.prototype),"copy",this).call(this,e,!1);for(var t=e.levels,r=0,a=t.length;r<a;r++){var i=t[r];this.addLevel(i.object.clone(),i.distance)}return this.autoUpdate=e.autoUpdate,this}},{key:"addLevel",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;t=Math.abs(t);var n,r=this.levels;for(n=0;n<r.length&&!(t<r[n].distance);n++);return r.splice(n,0,{distance:t,object:e}),this.add(e),this}},{key:"getCurrentLevel",value:function(){return this._currentLevel}},{key:"getObjectForDistance",value:function(e){var t=this.levels;if(t.length>0){var n,r;for(n=1,r=t.length;n<r&&!(e<t[n].distance);n++);return t[n-1].object}return null}},{key:"raycast",value:function(e,t){if(this.levels.length>0){bEe.setFromMatrixPosition(this.matrixWorld);var n=e.ray.origin.distanceTo(bEe);this.getObjectForDistance(n).raycast(e,t)}}},{key:"update",value:function(e){var t=this.levels;if(t.length>1){bEe.setFromMatrixPosition(e.matrixWorld),xEe.setFromMatrixPosition(this.matrixWorld);var n,r,a=bEe.distanceTo(xEe)/e.zoom;for(t[0].object.visible=!0,n=1,r=t.length;n<r&&a>=t[n].distance;n++)t[n-1].object.visible=!1,t[n].object.visible=!0;for(this._currentLevel=n-1;n<r;n++)t[n].object.visible=!1}}},{key:"toJSON",value:function(e){var t=ja(nr(n.prototype),"toJSON",this).call(this,e);!1===this.autoUpdate&&(t.object.autoUpdate=!1),t.object.levels=[];for(var r=this.levels,a=0,i=r.length;a<i;a++){var o=r[a];t.object.levels.push({object:o.object.uuid,distance:o.distance})}return t}}]),n}(Zwe),wEe=new Yke,_Ee=new Vke,SEe=new Vke,CEe=new Yke,TEe=new Twe,EEe=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this,e,r)).isSkinnedMesh=!0,a.type="SkinnedMesh",a.bindMode="attached",a.bindMatrix=new Twe,a.bindMatrixInverse=new Twe,a}return Jn(n,[{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,this}},{key:"bind",value:function(e,t){this.skeleton=e,void 0===t&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}},{key:"pose",value:function(){this.skeleton.pose()}},{key:"normalizeSkinWeights",value:function(){for(var e=new Vke,t=this.geometry.attributes.skinWeight,n=0,r=t.count;n<r;n++){e.fromBufferAttribute(t,n);var a=1/e.manhattanLength();a!==1/0?e.multiplyScalar(a):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}},{key:"updateMatrixWorld",value:function(e){ja(nr(n.prototype),"updateMatrixWorld",this).call(this,e),"attached"===this.bindMode?this.bindMatrixInverse.copy(this.matrixWorld).invert():"detached"===this.bindMode?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}},{key:"boneTransform",value:function(e,t){var n=this.skeleton,r=this.geometry;_Ee.fromBufferAttribute(r.attributes.skinIndex,e),SEe.fromBufferAttribute(r.attributes.skinWeight,e),wEe.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(var a=0;a<4;a++){var i=SEe.getComponent(a);if(0!==i){var o=_Ee.getComponent(a);TEe.multiplyMatrices(n.bones[o].matrixWorld,n.boneInverses[o]),t.addScaledVector(CEe.copy(wEe).applyMatrix4(TEe),i)}}return t.applyMatrix4(this.bindMatrixInverse)}}]),n}(Q_e),IEe=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this)).isBone=!0,e.type="Bone",e}return Jn(n)}(Zwe),AEe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,u=arguments.length>5?arguments[5]:void 0,c=arguments.length>6?arguments[6]:void 0,l=arguments.length>7?arguments[7]:void 0,h=arguments.length>8&&void 0!==arguments[8]?arguments[8]:rbe,f=arguments.length>9&&void 0!==arguments[9]?arguments[9]:rbe,d=arguments.length>10?arguments[10]:void 0,p=arguments.length>11?arguments[11]:void 0;return $n(this,n),(e=t.call(this,null,u,c,l,h,f,o,s,d,p)).isDataTexture=!0,e.image={data:r,width:a,height:i},e.generateMipmaps=!1,e.flipY=!1,e.unpackAlignment=1,e}return Jn(n)}(Uke),MEe=new Twe,NEe=new Twe,REe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];$n(this,e),this.uuid=lke(),this.bones=t.slice(0),this.boneInverses=n,this.boneMatrices=null,this.boneTexture=null,this.boneTextureSize=0,this.frame=-1,this.init()}return Jn(e,[{key:"init",value:function(){var e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(16*e.length),0===t.length)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(var n=0,r=this.bones.length;n<r;n++)this.boneInverses.push(new Twe)}}},{key:"calculateInverses",value:function(){this.boneInverses.length=0;for(var e=0,t=this.bones.length;e<t;e++){var n=new Twe;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}},{key:"pose",value:function(){for(var e=0,t=this.bones.length;e<t;e++){var n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(var r=0,a=this.bones.length;r<a;r++){var i=this.bones[r];i&&(i.parent&&i.parent.isBone?(i.matrix.copy(i.parent.matrixWorld).invert(),i.matrix.multiply(i.matrixWorld)):i.matrix.copy(i.matrixWorld),i.matrix.decompose(i.position,i.quaternion,i.scale))}}},{key:"update",value:function(){for(var e=this.bones,t=this.boneInverses,n=this.boneMatrices,r=this.boneTexture,a=0,i=e.length;a<i;a++){var o=e[a]?e[a].matrixWorld:NEe;MEe.multiplyMatrices(o,t[a]),MEe.toArray(n,16*a)}null!==r&&(r.needsUpdate=!0)}},{key:"clone",value:function(){return new e(this.bones,this.boneInverses)}},{key:"computeBoneTexture",value:function(){var e=Math.sqrt(4*this.bones.length);e=vke(e),e=Math.max(e,4);var t=new Float32Array(e*e*4);t.set(this.boneMatrices);var n=new AEe(t,e,e,Tbe,bbe);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this.boneTextureSize=e,this}},{key:"getBoneByName",value:function(e){for(var t=0,n=this.bones.length;t<n;t++){var r=this.bones[t];if(r.name===e)return r}}},{key:"dispose",value:function(){null!==this.boneTexture&&(this.boneTexture.dispose(),this.boneTexture=null)}},{key:"fromJSON",value:function(e,t){this.uuid=e.uuid;for(var n=0,r=e.bones.length;n<r;n++){var a=e.bones[n],i=t[a];void 0===i&&(console.warn("THREE.Skeleton: No bone found with UUID:",a),i=new IEe),this.bones.push(i),this.boneInverses.push((new Twe).fromArray(e.boneInverses[n]))}return this.init(),this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;for(var t=this.bones,n=this.boneInverses,r=0,a=t.length;r<a;r++){var i=t[r];e.bones.push(i.uuid);var o=n[r];e.boneInverses.push(o.toArray())}return e}}]),e}(),DEe=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return $n(this,n),"number"===typeof a&&(o=a,a=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),(i=t.call(this,e,r,a)).isInstancedBufferAttribute=!0,i.meshPerAttribute=o,i}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}]),n}(p_e),PEe=new Twe,OEe=new Twe,LEe=[],FEe=new Q_e,zEe=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;return $n(this,n),(i=t.call(this,e,r)).isInstancedMesh=!0,i.instanceMatrix=new DEe(new Float32Array(16*a),16),i.instanceColor=null,i.count=a,i.frustumCulled=!1,i}return Jn(n,[{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),this.instanceMatrix.copy(e.instanceMatrix),null!==e.instanceColor&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,this}},{key:"getColorAt",value:function(e,t){t.fromArray(this.instanceColor.array,3*e)}},{key:"getMatrixAt",value:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)}},{key:"raycast",value:function(e,t){var n=this.matrixWorld,r=this.count;if(FEe.geometry=this.geometry,FEe.material=this.material,void 0!==FEe.material)for(var a=0;a<r;a++){this.getMatrixAt(a,PEe),OEe.multiplyMatrices(n,PEe),FEe.matrixWorld=OEe,FEe.raycast(e,LEe);for(var i=0,o=LEe.length;i<o;i++){var s=LEe[i];s.instanceId=a,s.object=this,t.push(s)}LEe.length=0}}},{key:"setColorAt",value:function(e,t){null===this.instanceColor&&(this.instanceColor=new DEe(new Float32Array(3*this.instanceMatrix.count),3)),t.toArray(this.instanceColor.array,3*e)}},{key:"setMatrixAt",value:function(e,t){t.toArray(this.instanceMatrix.array,16*e)}},{key:"updateMorphTargets",value:function(){}},{key:"dispose",value:function(){this.dispatchEvent({type:"dispose"})}}]),n}(Q_e),BEe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isLineBasicMaterial=!0,r.type="LineBasicMaterial",r.color=new Oke(16777215),r.linewidth=1,r.linecap="round",r.linejoin="round",r.fog=!0,r.setValues(e),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}]),n}(l_e),UEe=new Yke,VEe=new Yke,WEe=new Twe,GEe=new Cwe,jEe=new gwe,qEe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new R_e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new BEe;return $n(this,n),(e=t.call(this)).isLine=!0,e.type="Line",e.geometry=r,e.material=a,e.updateMorphTargets(),e}return Jn(n,[{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),this.material=e.material,this.geometry=e.geometry,this}},{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[0],r=1,a=t.count;r<a;r++)UEe.fromBufferAttribute(t,r-1),VEe.fromBufferAttribute(t,r),n[r]=n[r-1],n[r]+=UEe.distanceTo(VEe);e.setAttribute("lineDistance",new __e(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.matrixWorld,a=e.params.Line.threshold,i=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),jEe.copy(n.boundingSphere),jEe.applyMatrix4(r),jEe.radius+=a,!1!==e.ray.intersectsSphere(jEe)){WEe.copy(r).invert(),GEe.copy(e.ray).applyMatrix4(WEe);var o=a/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,u=new Yke,c=new Yke,l=new Yke,h=new Yke,f=this.isLineSegments?2:1,d=n.index,p=n.attributes.position;if(null!==d)for(var v=Math.max(0,i.start),m=Math.min(d.count,i.start+i.count)-1;v<m;v+=f){var g=d.getX(v),y=d.getX(v+1);if(u.fromBufferAttribute(p,g),c.fromBufferAttribute(p,y),!(GEe.distanceSqToSegment(u,c,h,l)>s)){h.applyMatrix4(this.matrixWorld);var b=e.ray.origin.distanceTo(h);b<e.near||b>e.far||t.push({distance:b,point:l.clone().applyMatrix4(this.matrixWorld),index:v,face:null,faceIndex:null,object:this})}}else for(var x=Math.max(0,i.start),k=Math.min(p.count,i.start+i.count)-1;x<k;x+=f){if(u.fromBufferAttribute(p,x),c.fromBufferAttribute(p,x+1),!(GEe.distanceSqToSegment(u,c,h,l)>s)){h.applyMatrix4(this.matrixWorld);var w=e.ray.origin.distanceTo(h);w<e.near||w>e.far||t.push({distance:w,point:l.clone().applyMatrix4(this.matrixWorld),index:x,face:null,faceIndex:null,object:this})}}}}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=n.length;r<a;r++){var i=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=r}}}}}]),n}(Zwe),HEe=new Yke,XEe=new Yke,KEe=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this,e,r)).isLineSegments=!0,a.type="LineSegments",a}return Jn(n,[{key:"computeLineDistances",value:function(){var e=this.geometry;if(null===e.index){for(var t=e.attributes.position,n=[],r=0,a=t.count;r<a;r+=2)HEe.fromBufferAttribute(t,r),XEe.fromBufferAttribute(t,r+1),n[r]=0===r?0:n[r-1],n[r+1]=n[r]+HEe.distanceTo(XEe);e.setAttribute("lineDistance",new __e(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}]),n}(qEe),YEe=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this,e,r)).isLineLoop=!0,a.type="LineLoop",a}return Jn(n)}(qEe),QEe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isPointsMaterial=!0,r.type="PointsMaterial",r.color=new Oke(16777215),r.map=null,r.alphaMap=null,r.size=1,r.sizeAttenuation=!0,r.fog=!0,r.setValues(e),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}]),n}(l_e),ZEe=new Twe,JEe=new Cwe,$Ee=new gwe,eIe=new Yke,tIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new R_e,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new QEe;return $n(this,n),(e=t.call(this)).isPoints=!0,e.type="Points",e.geometry=r,e.material=a,e.updateMorphTargets(),e}return Jn(n,[{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),this.material=e.material,this.geometry=e.geometry,this}},{key:"raycast",value:function(e,t){var n=this.geometry,r=this.matrixWorld,a=e.params.Points.threshold,i=n.drawRange;if(null===n.boundingSphere&&n.computeBoundingSphere(),$Ee.copy(n.boundingSphere),$Ee.applyMatrix4(r),$Ee.radius+=a,!1!==e.ray.intersectsSphere($Ee)){ZEe.copy(r).invert(),JEe.copy(e.ray).applyMatrix4(ZEe);var o=a/((this.scale.x+this.scale.y+this.scale.z)/3),s=o*o,u=n.index,c=n.attributes.position;if(null!==u)for(var l=Math.max(0,i.start),h=Math.min(u.count,i.start+i.count);l<h;l++){var f=u.getX(l);eIe.fromBufferAttribute(c,f),nIe(eIe,f,s,r,e,t,this)}else for(var d=Math.max(0,i.start),p=Math.min(c.count,i.start+i.count);d<p;d++)eIe.fromBufferAttribute(c,d),nIe(eIe,d,s,r,e,t,this)}}},{key:"updateMorphTargets",value:function(){var e=this.geometry.morphAttributes,t=Object.keys(e);if(t.length>0){var n=e[t[0]];if(void 0!==n){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(var r=0,a=n.length;r<a;r++){var i=n[r].name||String(r);this.morphTargetInfluences.push(0),this.morphTargetDictionary[i]=r}}}}}]),n}(Zwe);function nIe(e,t,n,r,a,i,o){var s=JEe.distanceSqToPoint(e);if(s<n){var u=new Yke;JEe.closestPointToPoint(e,u),u.applyMatrix4(r);var c=a.ray.origin.distanceTo(u);if(c<a.near||c>a.far)return;i.push({distance:c,distanceToRay:Math.sqrt(s),point:u,index:t,face:null,object:o})}}var rIe=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i,o,s,u,c,l){var h;$n(this,n),(h=t.call(this,e,r,a,i,o,s,u,c,l)).isVideoTexture=!0,h.minFilter=void 0!==s?s:ube,h.magFilter=void 0!==o?o:ube,h.generateMipmaps=!1;var f=ir(h);return"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback((function t(){f.needsUpdate=!0,e.requestVideoFrameCallback(t)})),h}return Jn(n,[{key:"clone",value:function(){return new this.constructor(this.image).copy(this)}},{key:"update",value:function(){var e=this.image;!1==="requestVideoFrameCallback"in e&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}]),n}(Uke),aIe=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;return $n(this,n),(i=t.call(this,{width:e,height:r})).isFramebufferTexture=!0,i.format=a,i.magFilter=rbe,i.minFilter=rbe,i.generateMipmaps=!1,i.needsUpdate=!0,i}return Jn(n)}(Uke),iIe=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i,o,s,u,c,l,h,f,d){var p;return $n(this,n),(p=t.call(this,null,s,u,c,l,h,i,o,f,d)).isCompressedTexture=!0,p.image={width:r,height:a},p.mipmaps=e,p.flipY=!1,p.generateMipmaps=!1,p}return Jn(n)}(Uke),oIe=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i,o,s,u,c,l){var h;return $n(this,n),(h=t.call(this,e,r,a,i,o,s,u,c,l)).isCanvasTexture=!0,h.needsUpdate=!0,h}return Jn(n)}(Uke),sIe=function(){function e(){$n(this,e),this.type="Curve",this.arcLengthDivisions=200}return Jn(e,[{key:"getPoint",value:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null}},{key:"getPointAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getPoint(n,t)}},{key:"getPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5,t=[],n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}},{key:"getLength",value:function(){var e=this.getLengths();return e[e.length-1]}},{key:"getLengths",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.arcLengthDivisions;if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,n=[],r=this.getPoint(0),a=0;n.push(0);for(var i=1;i<=e;i++)a+=(t=this.getPoint(i/e)).distanceTo(r),n.push(a),r=t;return this.cacheArcLengths=n,n}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.getLengths()}},{key:"getUtoTmapping",value:function(e,t){var n,r=this.getLengths(),a=0,i=r.length;n=t||e*r[i-1];for(var o,s=0,u=i-1;s<=u;)if((o=r[a=Math.floor(s+(u-s)/2)]-n)<0)s=a+1;else{if(!(o>0)){u=a;break}u=a-1}if(r[a=u]===n)return a/(i-1);var c=r[a];return(a+(n-c)/(r[a+1]-c))/(i-1)}},{key:"getTangent",value:function(e,t){var n=1e-4,r=e-n,a=e+n;r<0&&(r=0),a>1&&(a=1);var i=this.getPoint(r),o=this.getPoint(a),s=t||(i.isVector2?new yke:new Yke);return s.copy(o).sub(i).normalize(),s}},{key:"getTangentAt",value:function(e,t){var n=this.getUtoTmapping(e);return this.getTangent(n,t)}},{key:"computeFrenetFrames",value:function(e,t){for(var n=new Yke,r=[],a=[],i=[],o=new Yke,s=new Twe,u=0;u<=e;u++){var c=u/e;r[u]=this.getTangentAt(c,new Yke)}a[0]=new Yke,i[0]=new Yke;var l=Number.MAX_VALUE,h=Math.abs(r[0].x),f=Math.abs(r[0].y),d=Math.abs(r[0].z);h<=l&&(l=h,n.set(1,0,0)),f<=l&&(l=f,n.set(0,1,0)),d<=l&&n.set(0,0,1),o.crossVectors(r[0],n).normalize(),a[0].crossVectors(r[0],o),i[0].crossVectors(r[0],a[0]);for(var p=1;p<=e;p++){if(a[p]=a[p-1].clone(),i[p]=i[p-1].clone(),o.crossVectors(r[p-1],r[p]),o.length()>Number.EPSILON){o.normalize();var v=Math.acos(hke(r[p-1].dot(r[p]),-1,1));a[p].applyMatrix4(s.makeRotationAxis(o,v))}i[p].crossVectors(r[p],a[p])}if(!0===t){var m=Math.acos(hke(a[0].dot(a[e]),-1,1));m/=e,r[0].dot(o.crossVectors(a[0],a[e]))>0&&(m=-m);for(var g=1;g<=e;g++)a[g].applyMatrix4(s.makeRotationAxis(r[g],m*g)),i[g].crossVectors(r[g],a[g])}return{tangents:r,normals:a,binormals:i}}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}},{key:"toJSON",value:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}},{key:"fromJSON",value:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}]),e}(),uIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI,c=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:0;return $n(this,n),(e=t.call(this)).isEllipseCurve=!0,e.type="EllipseCurve",e.aX=r,e.aY=a,e.xRadius=i,e.yRadius=o,e.aStartAngle=s,e.aEndAngle=u,e.aClockwise=c,e.aRotation=l,e}return Jn(n,[{key:"getPoint",value:function(e,t){for(var n=t||new yke,r=2*Math.PI,a=this.aEndAngle-this.aStartAngle,i=Math.abs(a)<Number.EPSILON;a<0;)a+=r;for(;a>r;)a-=r;a<Number.EPSILON&&(a=i?0:r),!0!==this.aClockwise||i||(a===r?a=-r:a-=r);var o=this.aStartAngle+e*a,s=this.aX+this.xRadius*Math.cos(o),u=this.aY+this.yRadius*Math.sin(o);if(0!==this.aRotation){var c=Math.cos(this.aRotation),l=Math.sin(this.aRotation),h=s-this.aX,f=u-this.aY;s=h*c-f*l+this.aX,u=h*l+f*c+this.aY}return n.set(s,u)}},{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}},{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}},{key:"fromJSON",value:function(e){return ja(nr(n.prototype),"fromJSON",this).call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}]),n}(sIe),cIe=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i,o,s){var u;return $n(this,n),(u=t.call(this,e,r,a,a,i,o,s)).isArcCurve=!0,u.type="ArcCurve",u}return Jn(n)}(uIe);function lIe(){var e=0,t=0,n=0,r=0;function a(a,i,o,s){e=a,t=o,n=-3*a+3*i-2*o-s,r=2*a-2*i+o+s}return{initCatmullRom:function(e,t,n,r,i){a(t,n,i*(n-e),i*(r-t))},initNonuniformCatmullRom:function(e,t,n,r,i,o,s){var u=(t-e)/i-(n-e)/(i+o)+(n-t)/o,c=(n-t)/o-(r-t)/(o+s)+(r-n)/s;a(t,n,u*=o,c*=o)},calc:function(a){var i=a*a;return e+t*a+n*i+r*(i*a)}}}var hIe=new Yke,fIe=new lIe,dIe=new lIe,pIe=new lIe,vIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"centripetal",o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.5;return $n(this,n),(e=t.call(this)).isCatmullRomCurve3=!0,e.type="CatmullRomCurve3",e.points=r,e.closed=a,e.curveType=i,e.tension=o,e}return Jn(n,[{key:"getPoint",value:function(e){var t,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yke,a=r,i=this.points,o=i.length,s=(o-(this.closed?0:1))*e,u=Math.floor(s),c=s-u;this.closed?u+=u>0?0:(Math.floor(Math.abs(u)/o)+1)*o:0===c&&u===o-1&&(u=o-2,c=1),this.closed||u>0?t=i[(u-1)%o]:(hIe.subVectors(i[0],i[1]).add(i[0]),t=hIe);var l=i[u%o],h=i[(u+1)%o];if(this.closed||u+2<o?n=i[(u+2)%o]:(hIe.subVectors(i[o-1],i[o-2]).add(i[o-1]),n=hIe),"centripetal"===this.curveType||"chordal"===this.curveType){var f="chordal"===this.curveType?.5:.25,d=Math.pow(t.distanceToSquared(l),f),p=Math.pow(l.distanceToSquared(h),f),v=Math.pow(h.distanceToSquared(n),f);p<1e-4&&(p=1),d<1e-4&&(d=p),v<1e-4&&(v=p),fIe.initNonuniformCatmullRom(t.x,l.x,h.x,n.x,d,p,v),dIe.initNonuniformCatmullRom(t.y,l.y,h.y,n.y,d,p,v),pIe.initNonuniformCatmullRom(t.z,l.z,h.z,n.z,d,p,v)}else"catmullrom"===this.curveType&&(fIe.initCatmullRom(t.x,l.x,h.x,n.x,this.tension),dIe.initCatmullRom(t.y,l.y,h.y,n.y,this.tension),pIe.initCatmullRom(t.z,l.z,h.z,n.z,this.tension));return a.set(fIe.calc(c),dIe.calc(c),pIe.calc(c)),a}},{key:"copy",value:function(e){ja(nr(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var a=e.points[t];this.points.push(a.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}},{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var a=this.points[t];e.points.push(a.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}},{key:"fromJSON",value:function(e){ja(nr(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var a=e.points[t];this.points.push((new Yke).fromArray(a))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}]),n}(sIe);function mIe(e,t,n,r,a){var i=.5*(r-t),o=.5*(a-n),s=e*e;return(2*n-2*r+i+o)*(e*s)+(-3*n+3*r-2*i-o)*s+i*e+n}function gIe(e,t,n,r){return function(e,t){var n=1-e;return n*n*t}(e,t)+function(e,t){return 2*(1-e)*e*t}(e,n)+function(e,t){return e*e*t}(e,r)}function yIe(e,t,n,r,a){return function(e,t){var n=1-e;return n*n*n*t}(e,t)+function(e,t){var n=1-e;return 3*n*n*e*t}(e,n)+function(e,t){return 3*(1-e)*e*e*t}(e,r)+function(e,t){return e*e*e*t}(e,a)}var bIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yke,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yke,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new yke,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new yke;return $n(this,n),(e=t.call(this)).isCubicBezierCurve=!0,e.type="CubicBezierCurve",e.v0=r,e.v1=a,e.v2=i,e.v3=o,e}return Jn(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yke,n=t,r=this.v0,a=this.v1,i=this.v2,o=this.v3;return n.set(yIe(e,r.x,a.x,i.x,o.x),yIe(e,r.y,a.y,i.y,o.y)),n}},{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return ja(nr(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(sIe),xIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yke,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yke,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Yke,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Yke;return $n(this,n),(e=t.call(this)).isCubicBezierCurve3=!0,e.type="CubicBezierCurve3",e.v0=r,e.v1=a,e.v2=i,e.v3=o,e}return Jn(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yke,n=t,r=this.v0,a=this.v1,i=this.v2,o=this.v3;return n.set(yIe(e,r.x,a.x,i.x,o.x),yIe(e,r.y,a.y,i.y,o.y),yIe(e,r.z,a.z,i.z,o.z)),n}},{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}},{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}},{key:"fromJSON",value:function(e){return ja(nr(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}]),n}(sIe),kIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yke,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yke;return $n(this,n),(e=t.call(this)).isLineCurve=!0,e.type="LineCurve",e.v1=r,e.v2=a,e}return Jn(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yke,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"getTangent",value:function(e,t){var n=t||new yke;return n.copy(this.v2).sub(this.v1).normalize(),n}},{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return ja(nr(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(sIe),wIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yke,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yke;return $n(this,n),(e=t.call(this)).isLineCurve3=!0,e.type="LineCurve3",e.v1=r,e.v2=a,e}return Jn(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yke,n=t;return 1===e?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}},{key:"getPointAt",value:function(e,t){return this.getPoint(e,t)}},{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return ja(nr(n.prototype),"fromJSON",this).call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(sIe),_Ie=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yke,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yke,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new yke;return $n(this,n),(e=t.call(this)).isQuadraticBezierCurve=!0,e.type="QuadraticBezierCurve",e.v0=r,e.v1=a,e.v2=i,e}return Jn(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yke,n=t,r=this.v0,a=this.v1,i=this.v2;return n.set(gIe(e,r.x,a.x,i.x),gIe(e,r.y,a.y,i.y)),n}},{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return ja(nr(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(sIe),SIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yke,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yke,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Yke;return $n(this,n),(e=t.call(this)).isQuadraticBezierCurve3=!0,e.type="QuadraticBezierCurve3",e.v0=r,e.v1=a,e.v2=i,e}return Jn(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yke,n=t,r=this.v0,a=this.v1,i=this.v2;return n.set(gIe(e,r.x,a.x,i.x),gIe(e,r.y,a.y,i.y),gIe(e,r.z,a.z,i.z)),n}},{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}},{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}},{key:"fromJSON",value:function(e){return ja(nr(n.prototype),"fromJSON",this).call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}]),n}(sIe),CIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return $n(this,n),(e=t.call(this)).isSplineCurve=!0,e.type="SplineCurve",e.points=r,e}return Jn(n,[{key:"getPoint",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yke,n=t,r=this.points,a=(r.length-1)*e,i=Math.floor(a),o=a-i,s=r[0===i?i:i-1],u=r[i],c=r[i>r.length-2?r.length-1:i+1],l=r[i>r.length-3?r.length-1:i+2];return n.set(mIe(o,s.x,u.x,c.x,l.x),mIe(o,s.y,u.y,c.y,l.y)),n}},{key:"copy",value:function(e){ja(nr(n.prototype),"copy",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var a=e.points[t];this.points.push(a.clone())}return this}},{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var a=this.points[t];e.points.push(a.toArray())}return e}},{key:"fromJSON",value:function(e){ja(nr(n.prototype),"fromJSON",this).call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var a=e.points[t];this.points.push((new yke).fromArray(a))}return this}}]),n}(sIe),TIe=Object.freeze({__proto__:null,ArcCurve:cIe,CatmullRomCurve3:vIe,CubicBezierCurve:bIe,CubicBezierCurve3:xIe,EllipseCurve:uIe,LineCurve:kIe,LineCurve3:wIe,QuadraticBezierCurve:_Ie,QuadraticBezierCurve3:SIe,SplineCurve:CIe}),EIe=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this)).type="CurvePath",e.curves=[],e.autoClose=!1,e}return Jn(n,[{key:"add",value:function(e){this.curves.push(e)}},{key:"closePath",value:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new kIe(t,e))}},{key:"getPoint",value:function(e,t){for(var n=e*this.getLength(),r=this.getCurveLengths(),a=0;a<r.length;){if(r[a]>=n){var i=r[a]-n,o=this.curves[a],s=o.getLength(),u=0===s?0:1-i/s;return o.getPointAt(u,t)}a++}return null}},{key:"getLength",value:function(){var e=this.getCurveLengths();return e[e.length-1]}},{key:"updateArcLengths",value:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}},{key:"getCurveLengths",value:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,n=0,r=this.curves.length;n<r;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}},{key:"getSpacedPoints",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:40,t=[],n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}},{key:"getPoints",value:function(){for(var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:12,n=[],r=0,a=this.curves;r<a.length;r++)for(var i=a[r],o=i.isEllipseCurve?2*t:i.isLineCurve||i.isLineCurve3?1:i.isSplineCurve?t*i.points.length:t,s=i.getPoints(o),u=0;u<s.length;u++){var c=s[u];e&&e.equals(c)||(n.push(c),e=c)}return this.autoClose&&n.length>1&&!n[n.length-1].equals(n[0])&&n.push(n[0]),n}},{key:"copy",value:function(e){ja(nr(n.prototype),"copy",this).call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var a=e.curves[t];this.curves.push(a.clone())}return this.autoClose=e.autoClose,this}},{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var a=this.curves[t];e.curves.push(a.toJSON())}return e}},{key:"fromJSON",value:function(e){ja(nr(n.prototype),"fromJSON",this).call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var a=e.curves[t];this.curves.push((new TIe[a.type]).fromJSON(a))}return this}}]),n}(sIe),IIe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).type="Path",r.currentPoint=new yke,e&&r.setFromPoints(e),r}return Jn(n,[{key:"setFromPoints",value:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}},{key:"moveTo",value:function(e,t){return this.currentPoint.set(e,t),this}},{key:"lineTo",value:function(e,t){var n=new kIe(this.currentPoint.clone(),new yke(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,r){var a=new _Ie(this.currentPoint.clone(),new yke(e,t),new yke(n,r));return this.curves.push(a),this.currentPoint.set(n,r),this}},{key:"bezierCurveTo",value:function(e,t,n,r,a,i){var o=new bIe(this.currentPoint.clone(),new yke(e,t),new yke(n,r),new yke(a,i));return this.curves.push(o),this.currentPoint.set(a,i),this}},{key:"splineThru",value:function(e){var t=[this.currentPoint.clone()].concat(e),n=new CIe(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}},{key:"arc",value:function(e,t,n,r,a,i){var o=this.currentPoint.x,s=this.currentPoint.y;return this.absarc(e+o,t+s,n,r,a,i),this}},{key:"absarc",value:function(e,t,n,r,a,i){return this.absellipse(e,t,n,n,r,a,i),this}},{key:"ellipse",value:function(e,t,n,r,a,i,o,s){var u=this.currentPoint.x,c=this.currentPoint.y;return this.absellipse(e+u,t+c,n,r,a,i,o,s),this}},{key:"absellipse",value:function(e,t,n,r,a,i,o,s){var u=new uIe(e,t,n,r,a,i,o,s);if(this.curves.length>0){var c=u.getPoint(0);c.equals(this.currentPoint)||this.lineTo(c.x,c.y)}this.curves.push(u);var l=u.getPoint(1);return this.currentPoint.copy(l),this}},{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.currentPoint.copy(e.currentPoint),this}},{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);return e.currentPoint=this.currentPoint.toArray(),e}},{key:"fromJSON",value:function(e){return ja(nr(n.prototype),"fromJSON",this).call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}]),n}(EIe),AIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[new yke(0,.5),new yke(.5,0),new yke(0,-.5)],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;$n(this,n),(e=t.call(this)).type="LatheGeometry",e.parameters={points:r,segments:a,phiStart:i,phiLength:o},a=Math.floor(a),o=hke(o,0,2*Math.PI);for(var s=[],u=[],c=[],l=[],h=[],f=1/a,d=new Yke,p=new yke,v=new Yke,m=new Yke,g=new Yke,y=0,b=0,x=0;x<=r.length-1;x++)switch(x){case 0:y=r[x+1].x-r[x].x,b=r[x+1].y-r[x].y,v.x=1*b,v.y=-y,v.z=0*b,g.copy(v),v.normalize(),l.push(v.x,v.y,v.z);break;case r.length-1:l.push(g.x,g.y,g.z);break;default:y=r[x+1].x-r[x].x,b=r[x+1].y-r[x].y,v.x=1*b,v.y=-y,v.z=0*b,m.copy(v),v.x+=g.x,v.y+=g.y,v.z+=g.z,v.normalize(),l.push(v.x,v.y,v.z),g.copy(m)}for(var k=0;k<=a;k++)for(var w=i+k*f*o,_=Math.sin(w),S=Math.cos(w),C=0;C<=r.length-1;C++){d.x=r[C].x*_,d.y=r[C].y,d.z=r[C].x*S,u.push(d.x,d.y,d.z),p.x=k/a,p.y=C/(r.length-1),c.push(p.x,p.y);var T=l[3*C+0]*_,E=l[3*C+1],I=l[3*C+0]*S;h.push(T,E,I)}for(var A=0;A<a;A++)for(var M=0;M<r.length-1;M++){var N=M+A*r.length,R=N,D=N+r.length,P=N+r.length+1,O=N+1;s.push(R,D,O),s.push(P,O,D)}return e.setIndex(s),e.setAttribute("position",new __e(u,3)),e.setAttribute("uv",new __e(c,2)),e.setAttribute("normal",new __e(h,3)),e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.points,e.segments,e.phiStart,e.phiLength)}}]),n}(R_e),MIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8;$n(this,n);var s=new IIe;return s.absarc(0,-a/2,r,1.5*Math.PI,0),s.absarc(0,a/2,r,0,.5*Math.PI),(e=t.call(this,s.getPoints(i),o)).type="CapsuleGeometry",e.parameters={radius:r,height:a,capSegments:i,radialSegments:o},e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.length,e.capSegments,e.radialSegments)}}]),n}(AIe),NIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:2*Math.PI;$n(this,n),(e=t.call(this)).type="CircleGeometry",e.parameters={radius:r,segments:a,thetaStart:i,thetaLength:o},a=Math.max(3,a);var s=[],u=[],c=[],l=[],h=new Yke,f=new yke;u.push(0,0,0),c.push(0,0,1),l.push(.5,.5);for(var d=0,p=3;d<=a;d++,p+=3){var v=i+d/a*o;h.x=r*Math.cos(v),h.y=r*Math.sin(v),u.push(h.x,h.y,h.z),c.push(0,0,1),f.x=(u[p]/r+1)/2,f.y=(u[p+1]/r+1)/2,l.push(f.x,f.y)}for(var m=1;m<=a;m++)s.push(m,m+1,0);return e.setIndex(s),e.setAttribute("position",new __e(u,3)),e.setAttribute("normal",new __e(c,3)),e.setAttribute("uv",new __e(l,2)),e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.segments,e.thetaStart,e.thetaLength)}}]),n}(R_e),RIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1,u=arguments.length>5&&void 0!==arguments[5]&&arguments[5],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0,l=arguments.length>7&&void 0!==arguments[7]?arguments[7]:2*Math.PI;$n(this,n),(e=t.call(this)).type="CylinderGeometry",e.parameters={radiusTop:r,radiusBottom:a,height:i,radialSegments:o,heightSegments:s,openEnded:u,thetaStart:c,thetaLength:l};var h=ir(e);o=Math.floor(o),s=Math.floor(s);var f=[],d=[],p=[],v=[],m=0,g=[],y=i/2,b=0;function x(){for(var e=new Yke,t=new Yke,n=0,u=(a-r)/i,x=0;x<=s;x++){for(var k=[],w=x/s,_=w*(a-r)+r,S=0;S<=o;S++){var C=S/o,T=C*l+c,E=Math.sin(T),I=Math.cos(T);t.x=_*E,t.y=-w*i+y,t.z=_*I,d.push(t.x,t.y,t.z),e.set(E,u,I).normalize(),p.push(e.x,e.y,e.z),v.push(C,1-w),k.push(m++)}g.push(k)}for(var A=0;A<o;A++)for(var M=0;M<s;M++){var N=g[M][A],R=g[M+1][A],D=g[M+1][A+1],P=g[M][A+1];f.push(N,R,P),f.push(R,D,P),n+=6}h.addGroup(b,n,0),b+=n}function k(e){for(var t=m,n=new yke,i=new Yke,s=0,u=!0===e?r:a,g=!0===e?1:-1,x=1;x<=o;x++)d.push(0,y*g,0),p.push(0,g,0),v.push(.5,.5),m++;for(var k=m,w=0;w<=o;w++){var _=w/o*l+c,S=Math.cos(_),C=Math.sin(_);i.x=u*C,i.y=y*g,i.z=u*S,d.push(i.x,i.y,i.z),p.push(0,g,0),n.x=.5*S+.5,n.y=.5*C*g+.5,v.push(n.x,n.y),m++}for(var T=0;T<o;T++){var E=t+T,I=k+T;!0===e?f.push(I,I+1,E):f.push(I+1,I,E),s+=3}h.addGroup(b,s,!0===e?1:2),b+=s}return x(),!1===u&&(r>0&&k(!0),a>0&&k(!1)),e.setIndex(f),e.setAttribute("position",new __e(d,3)),e.setAttribute("normal",new __e(p,3)),e.setAttribute("uv",new __e(v,2)),e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),n}(R_e),DIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4],u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:2*Math.PI;return $n(this,n),(e=t.call(this,0,r,a,i,o,s,u,c)).type="ConeGeometry",e.parameters={radius:r,height:a,radialSegments:i,heightSegments:o,openEnded:s,thetaStart:u,thetaLength:c},e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}]),n}(RIe),PIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;$n(this,n),(e=t.call(this)).type="PolyhedronGeometry",e.parameters={vertices:r,indices:a,radius:i,detail:o};var s=[],u=[];function c(e){for(var t=new Yke,n=new Yke,r=new Yke,i=0;i<a.length;i+=3)v(a[i+0],t),v(a[i+1],n),v(a[i+2],r),l(t,n,r,e)}function l(e,t,n,r){for(var a=r+1,i=[],o=0;o<=a;o++){i[o]=[];for(var s=e.clone().lerp(n,o/a),u=t.clone().lerp(n,o/a),c=a-o,l=0;l<=c;l++)i[o][l]=0===l&&o===a?s:s.clone().lerp(u,l/c)}for(var h=0;h<a;h++)for(var f=0;f<2*(a-h)-1;f++){var d=Math.floor(f/2);f%2===0?(p(i[h][d+1]),p(i[h+1][d]),p(i[h][d])):(p(i[h][d+1]),p(i[h+1][d+1]),p(i[h+1][d]))}}function h(e){for(var t=new Yke,n=0;n<s.length;n+=3)t.x=s[n+0],t.y=s[n+1],t.z=s[n+2],t.normalize().multiplyScalar(e),s[n+0]=t.x,s[n+1]=t.y,s[n+2]=t.z}function f(){for(var e=new Yke,t=0;t<s.length;t+=3){e.x=s[t+0],e.y=s[t+1],e.z=s[t+2];var n=y(e)/2/Math.PI+.5,r=b(e)/Math.PI+.5;u.push(n,1-r)}m(),d()}function d(){for(var e=0;e<u.length;e+=6){var t=u[e+0],n=u[e+2],r=u[e+4],a=Math.max(t,n,r),i=Math.min(t,n,r);a>.9&&i<.1&&(t<.2&&(u[e+0]+=1),n<.2&&(u[e+2]+=1),r<.2&&(u[e+4]+=1))}}function p(e){s.push(e.x,e.y,e.z)}function v(e,t){var n=3*e;t.x=r[n+0],t.y=r[n+1],t.z=r[n+2]}function m(){for(var e=new Yke,t=new Yke,n=new Yke,r=new Yke,a=new yke,i=new yke,o=new yke,c=0,l=0;c<s.length;c+=9,l+=6){e.set(s[c+0],s[c+1],s[c+2]),t.set(s[c+3],s[c+4],s[c+5]),n.set(s[c+6],s[c+7],s[c+8]),a.set(u[l+0],u[l+1]),i.set(u[l+2],u[l+3]),o.set(u[l+4],u[l+5]),r.copy(e).add(t).add(n).divideScalar(3);var h=y(r);g(a,l+0,e,h),g(i,l+2,t,h),g(o,l+4,n,h)}}function g(e,t,n,r){r<0&&1===e.x&&(u[t]=e.x-1),0===n.x&&0===n.z&&(u[t]=r/2/Math.PI+.5)}function y(e){return Math.atan2(e.z,-e.x)}function b(e){return Math.atan2(-e.y,Math.sqrt(e.x*e.x+e.z*e.z))}return c(o),h(i),f(),e.setAttribute("position",new __e(s,3)),e.setAttribute("normal",new __e(s.slice(),3)),e.setAttribute("uv",new __e(u,2)),0===o?e.computeVertexNormals():e.normalizeNormals(),e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.vertices,e.indices,e.radius,e.details)}}]),n}(R_e),OIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;$n(this,n);var i=(1+Math.sqrt(5))/2,o=1/i,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-o,-i,0,-o,i,0,o,-i,0,o,i,-o,-i,0,-o,i,0,o,-i,0,o,i,0,-i,0,-o,i,0,-o,-i,0,o,i,0,o],u=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];return(e=t.call(this,s,u,r,a)).type="DodecahedronGeometry",e.parameters={radius:r,detail:a},e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(PIe),LIe=new Yke,FIe=new Yke,zIe=new Yke,BIe=new u_e,UIe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if($n(this,n),(e=t.call(this)).type="EdgesGeometry",e.parameters={geometry:r,thresholdAngle:a},null!==r){for(var i=4,o=Math.pow(10,i),s=Math.cos(uke*a),u=r.getIndex(),c=r.getAttribute("position"),l=u?u.count:c.count,h=[0,0,0],f=["a","b","c"],d=new Array(3),p={},v=[],m=0;m<l;m+=3){u?(h[0]=u.getX(m),h[1]=u.getX(m+1),h[2]=u.getX(m+2)):(h[0]=m,h[1]=m+1,h[2]=m+2);var g=BIe.a,y=BIe.b,b=BIe.c;if(g.fromBufferAttribute(c,h[0]),y.fromBufferAttribute(c,h[1]),b.fromBufferAttribute(c,h[2]),BIe.getNormal(zIe),d[0]="".concat(Math.round(g.x*o),",").concat(Math.round(g.y*o),",").concat(Math.round(g.z*o)),d[1]="".concat(Math.round(y.x*o),",").concat(Math.round(y.y*o),",").concat(Math.round(y.z*o)),d[2]="".concat(Math.round(b.x*o),",").concat(Math.round(b.y*o),",").concat(Math.round(b.z*o)),d[0]!==d[1]&&d[1]!==d[2]&&d[2]!==d[0])for(var x=0;x<3;x++){var k=(x+1)%3,w=d[x],_=d[k],S=BIe[f[x]],C=BIe[f[k]],T="".concat(w,"_").concat(_),E="".concat(_,"_").concat(w);E in p&&p[E]?(zIe.dot(p[E].normal)<=s&&(v.push(S.x,S.y,S.z),v.push(C.x,C.y,C.z)),p[E]=null):T in p||(p[T]={index0:h[x],index1:h[k],normal:zIe.clone()})}}for(var I in p)if(p[I]){var A=p[I],M=A.index0,N=A.index1;LIe.fromBufferAttribute(c,M),FIe.fromBufferAttribute(c,N),v.push(LIe.x,LIe.y,LIe.z),v.push(FIe.x,FIe.y,FIe.z)}e.setAttribute("position",new __e(v,3))}return e}return Jn(n)}(R_e),VIe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).uuid=lke(),r.type="Shape",r.holes=[],r}return Jn(n,[{key:"getPointsHoles",value:function(e){for(var t=[],n=0,r=this.holes.length;n<r;n++)t[n]=this.holes[n].getPoints(e);return t}},{key:"extractPoints",value:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}},{key:"copy",value:function(e){ja(nr(n.prototype),"copy",this).call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var a=e.holes[t];this.holes.push(a.clone())}return this}},{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var a=this.holes[t];e.holes.push(a.toJSON())}return e}},{key:"fromJSON",value:function(e){ja(nr(n.prototype),"fromJSON",this).call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var a=e.holes[t];this.holes.push((new IIe).fromJSON(a))}return this}}]),n}(IIe),WIe=function(e,t){var n,r,a,i,o,s,u,c=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,l=t&&t.length,h=l?t[0]*c:e.length,f=GIe(e,0,h,c,!0),d=[];if(!f||f.next===f.prev)return d;if(l&&(f=QIe(e,t,f,c)),e.length>80*c){n=a=e[0],r=i=e[1];for(var p=c;p<h;p+=c)(o=e[p])<n&&(n=o),(s=e[p+1])<r&&(r=s),o>a&&(a=o),s>i&&(i=s);u=0!==(u=Math.max(a-n,i-r))?1/u:0}return qIe(f,d,c,n,r,u),d};function GIe(e,t,n,r,a){var i,o;if(a===function(e,t,n,r){for(var a=0,i=t,o=n-r;i<n;i+=r)a+=(e[o]-e[i])*(e[i+1]+e[o+1]),o=i;return a}(e,t,n,r)>0)for(i=t;i<n;i+=r)o=hAe(i,e[i],e[i+1],o);else for(i=n-r;i>=t;i-=r)o=hAe(i,e[i],e[i+1],o);return o&&iAe(o,o.next)&&(fAe(o),o=o.next),o}function jIe(e,t){if(!e)return e;t||(t=e);var n,r=e;do{if(n=!1,r.steiner||!iAe(r,r.next)&&0!==aAe(r.prev,r,r.next))r=r.next;else{if(fAe(r),(r=t=r.prev)===r.next)break;n=!0}}while(n||r!==t);return t}function qIe(e,t,n,r,a,i,o){if(e){!o&&i&&function(e,t,n,r){var a=e;do{null===a.z&&(a.z=eAe(a.x,a.y,t,n,r)),a.prevZ=a.prev,a.nextZ=a.next,a=a.next}while(a!==e);a.prevZ.nextZ=null,a.prevZ=null,function(e){var t,n,r,a,i,o,s,u,c=1;do{for(n=e,e=null,i=null,o=0;n;){for(o++,r=n,s=0,t=0;t<c&&(s++,r=r.nextZ);t++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(a=n,n=n.nextZ,s--):(a=r,r=r.nextZ,u--),i?i.nextZ=a:e=a,a.prevZ=i,i=a;n=r}i.nextZ=null,c*=2}while(o>1)}(a)}(e,r,a,i);for(var s,u,c=e;e.prev!==e.next;)if(s=e.prev,u=e.next,i?XIe(e,r,a,i):HIe(e))t.push(s.i/n),t.push(e.i/n),t.push(u.i/n),fAe(e),e=u.next,c=u.next;else if((e=u)===c){o?1===o?qIe(e=KIe(jIe(e),t,n),t,n,r,a,i,2):2===o&&YIe(e,t,n,r,a,i):qIe(jIe(e),t,n,r,a,i,1);break}}}function HIe(e){var t=e.prev,n=e,r=e.next;if(aAe(t,n,r)>=0)return!1;for(var a=e.next.next;a!==e.prev;){if(nAe(t.x,t.y,n.x,n.y,r.x,r.y,a.x,a.y)&&aAe(a.prev,a,a.next)>=0)return!1;a=a.next}return!0}function XIe(e,t,n,r){var a=e.prev,i=e,o=e.next;if(aAe(a,i,o)>=0)return!1;for(var s=a.x<i.x?a.x<o.x?a.x:o.x:i.x<o.x?i.x:o.x,u=a.y<i.y?a.y<o.y?a.y:o.y:i.y<o.y?i.y:o.y,c=a.x>i.x?a.x>o.x?a.x:o.x:i.x>o.x?i.x:o.x,l=a.y>i.y?a.y>o.y?a.y:o.y:i.y>o.y?i.y:o.y,h=eAe(s,u,t,n,r),f=eAe(c,l,t,n,r),d=e.prevZ,p=e.nextZ;d&&d.z>=h&&p&&p.z<=f;){if(d!==e.prev&&d!==e.next&&nAe(a.x,a.y,i.x,i.y,o.x,o.y,d.x,d.y)&&aAe(d.prev,d,d.next)>=0)return!1;if(d=d.prevZ,p!==e.prev&&p!==e.next&&nAe(a.x,a.y,i.x,i.y,o.x,o.y,p.x,p.y)&&aAe(p.prev,p,p.next)>=0)return!1;p=p.nextZ}for(;d&&d.z>=h;){if(d!==e.prev&&d!==e.next&&nAe(a.x,a.y,i.x,i.y,o.x,o.y,d.x,d.y)&&aAe(d.prev,d,d.next)>=0)return!1;d=d.prevZ}for(;p&&p.z<=f;){if(p!==e.prev&&p!==e.next&&nAe(a.x,a.y,i.x,i.y,o.x,o.y,p.x,p.y)&&aAe(p.prev,p,p.next)>=0)return!1;p=p.nextZ}return!0}function KIe(e,t,n){var r=e;do{var a=r.prev,i=r.next.next;!iAe(a,i)&&oAe(a,r,r.next,i)&&cAe(a,i)&&cAe(i,a)&&(t.push(a.i/n),t.push(r.i/n),t.push(i.i/n),fAe(r),fAe(r.next),r=e=i),r=r.next}while(r!==e);return jIe(r)}function YIe(e,t,n,r,a,i){var o=e;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&rAe(o,s)){var u=lAe(o,s);return o=jIe(o,o.next),u=jIe(u,u.next),qIe(o,t,n,r,a,i),void qIe(u,t,n,r,a,i)}s=s.next}o=o.next}while(o!==e)}function QIe(e,t,n,r){var a,i,o,s=[];for(a=0,i=t.length;a<i;a++)(o=GIe(e,t[a]*r,a<i-1?t[a+1]*r:e.length,r,!1))===o.next&&(o.steiner=!0),s.push(tAe(o));for(s.sort(ZIe),a=0;a<s.length;a++)JIe(s[a],n),n=jIe(n,n.next);return n}function ZIe(e,t){return e.x-t.x}function JIe(e,t){if(t=function(e,t){var n,r=t,a=e.x,i=e.y,o=-1/0;do{if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){var s=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=a&&s>o){if(o=s,s===a){if(i===r.y)return r;if(i===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==t);if(!n)return null;if(a===o)return n;var u,c=n,l=n.x,h=n.y,f=1/0;r=n;do{a>=r.x&&r.x>=l&&a!==r.x&&nAe(i<h?a:o,i,l,h,i<h?o:a,i,r.x,r.y)&&(u=Math.abs(i-r.y)/(a-r.x),cAe(r,e)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&$Ie(n,r)))&&(n=r,f=u)),r=r.next}while(r!==c);return n}(e,t),t){var n=lAe(t,e);jIe(t,t.next),jIe(n,n.next)}}function $Ie(e,t){return aAe(e.prev,e,t.prev)<0&&aAe(t.next,e,e.next)<0}function eAe(e,t,n,r,a){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-n)*a)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-r)*a)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function tAe(e){var t=e,n=e;do{(t.x<n.x||t.x===n.x&&t.y<n.y)&&(n=t),t=t.next}while(t!==e);return n}function nAe(e,t,n,r,a,i,o,s){return(a-o)*(t-s)-(e-o)*(i-s)>=0&&(e-o)*(r-s)-(n-o)*(t-s)>=0&&(n-o)*(i-s)-(a-o)*(r-s)>=0}function rAe(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){var n=e;do{if(n.i!==e.i&&n.next.i!==e.i&&n.i!==t.i&&n.next.i!==t.i&&oAe(n,n.next,e,t))return!0;n=n.next}while(n!==e);return!1}(e,t)&&(cAe(e,t)&&cAe(t,e)&&function(e,t){var n=e,r=!1,a=(e.x+t.x)/2,i=(e.y+t.y)/2;do{n.y>i!==n.next.y>i&&n.next.y!==n.y&&a<(n.next.x-n.x)*(i-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==e);return r}(e,t)&&(aAe(e.prev,e,t.prev)||aAe(e,t.prev,t))||iAe(e,t)&&aAe(e.prev,e,e.next)>0&&aAe(t.prev,t,t.next)>0)}function aAe(e,t,n){return(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y)}function iAe(e,t){return e.x===t.x&&e.y===t.y}function oAe(e,t,n,r){var a=uAe(aAe(e,t,n)),i=uAe(aAe(e,t,r)),o=uAe(aAe(n,r,e)),s=uAe(aAe(n,r,t));return a!==i&&o!==s||(!(0!==a||!sAe(e,n,t))||(!(0!==i||!sAe(e,r,t))||(!(0!==o||!sAe(n,e,r))||!(0!==s||!sAe(n,t,r)))))}function sAe(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}function uAe(e){return e>0?1:e<0?-1:0}function cAe(e,t){return aAe(e.prev,e,e.next)<0?aAe(e,t,e.next)>=0&&aAe(e,e.prev,t)>=0:aAe(e,t,e.prev)<0||aAe(e,e.next,t)<0}function lAe(e,t){var n=new dAe(e.i,e.x,e.y),r=new dAe(t.i,t.x,t.y),a=e.next,i=t.prev;return e.next=t,t.prev=e,n.next=a,a.prev=n,r.next=n,n.prev=r,i.next=r,r.prev=i,r}function hAe(e,t,n,r){var a=new dAe(e,t,n);return r?(a.next=r.next,a.prev=r,r.next.prev=a,r.next=a):(a.prev=a,a.next=a),a}function fAe(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function dAe(e,t,n){this.i=e,this.x=t,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}var pAe=function(){function e(){$n(this,e)}return Jn(e,null,[{key:"area",value:function(e){for(var t=e.length,n=0,r=t-1,a=0;a<t;r=a++)n+=e[r].x*e[a].y-e[a].x*e[r].y;return.5*n}},{key:"isClockWise",value:function(t){return e.area(t)<0}},{key:"triangulateShape",value:function(e,t){var n=[],r=[],a=[];vAe(e),mAe(n,e);var i=e.length;t.forEach(vAe);for(var o=0;o<t.length;o++)r.push(i),i+=t[o].length,mAe(n,t[o]);for(var s=WIe(n,r),u=0;u<s.length;u+=3)a.push(s.slice(u,u+3));return a}}]),e}();function vAe(e){var t=e.length;t>2&&e[t-1].equals(e[0])&&e.pop()}function mAe(e,t){for(var n=0;n<t.length;n++)e.push(t[n].x),e.push(t[n].y)}var gAe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new VIe([new yke(.5,.5),new yke(-.5,.5),new yke(-.5,-.5),new yke(.5,-.5)]),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};$n(this,n),(e=t.call(this)).type="ExtrudeGeometry",e.parameters={shapes:r,options:a},r=Array.isArray(r)?r:[r];for(var i=ir(e),o=[],s=[],u=0,c=r.length;u<c;u++){var l=r[u];h(l)}function h(e){var t=[],n=void 0!==a.curveSegments?a.curveSegments:12,r=void 0!==a.steps?a.steps:1,u=void 0!==a.depth?a.depth:1,c=void 0===a.bevelEnabled||a.bevelEnabled,l=void 0!==a.bevelThickness?a.bevelThickness:.2,h=void 0!==a.bevelSize?a.bevelSize:l-.1,f=void 0!==a.bevelOffset?a.bevelOffset:0,d=void 0!==a.bevelSegments?a.bevelSegments:3,p=a.extrudePath,v=void 0!==a.UVGenerator?a.UVGenerator:yAe;void 0!==a.amount&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),u=a.amount);var m,g,y,b,x,k=!1;p&&(m=p.getSpacedPoints(r),k=!0,c=!1,g=p.computeFrenetFrames(r,!1),y=new Yke,b=new Yke,x=new Yke),c||(d=0,l=0,h=0,f=0);var w=e.extractPoints(n),_=w.shape,S=w.holes;if(!pAe.isClockWise(_)){_=_.reverse();for(var C=0,T=S.length;C<T;C++){var E=S[C];pAe.isClockWise(E)&&(S[C]=E.reverse())}}for(var I=pAe.triangulateShape(_,S),A=_,M=0,N=S.length;M<N;M++){var R=S[M];_=_.concat(R)}function D(e,t,n){return t||console.error("THREE.ExtrudeGeometry: vec does not exist"),t.clone().multiplyScalar(n).add(e)}var P=_.length,O=I.length;function L(e,t,n){var r,a,i,o=e.x-t.x,s=e.y-t.y,u=n.x-e.x,c=n.y-e.y,l=o*o+s*s,h=o*c-s*u;if(Math.abs(h)>Number.EPSILON){var f=Math.sqrt(l),d=Math.sqrt(u*u+c*c),p=t.x-s/f,v=t.y+o/f,m=((n.x-c/d-p)*c-(n.y+u/d-v)*u)/(o*c-s*u),g=(r=p+o*m-e.x)*r+(a=v+s*m-e.y)*a;if(g<=2)return new yke(r,a);i=Math.sqrt(g/2)}else{var y=!1;o>Number.EPSILON?u>Number.EPSILON&&(y=!0):o<-Number.EPSILON?u<-Number.EPSILON&&(y=!0):Math.sign(s)===Math.sign(c)&&(y=!0),y?(r=-s,a=o,i=Math.sqrt(l)):(r=o,a=s,i=Math.sqrt(l/2))}return new yke(r/i,a/i)}for(var F=[],z=0,B=A.length,U=B-1,V=z+1;z<B;z++,U++,V++)U===B&&(U=0),V===B&&(V=0),F[z]=L(A[z],A[U],A[V]);for(var W,G=[],j=F.concat(),q=0,H=S.length;q<H;q++){var X=S[q];W=[];for(var K=0,Y=X.length,Q=Y-1,Z=K+1;K<Y;K++,Q++,Z++)Q===Y&&(Q=0),Z===Y&&(Z=0),W[K]=L(X[K],X[Q],X[Z]);G.push(W),j=j.concat(W)}for(var J=0;J<d;J++){for(var $=J/d,ee=l*Math.cos($*Math.PI/2),te=h*Math.sin($*Math.PI/2)+f,ne=0,re=A.length;ne<re;ne++){var ae=D(A[ne],F[ne],te);Ne(ae.x,ae.y,-ee)}for(var ie=0,oe=S.length;ie<oe;ie++){var se=S[ie];W=G[ie];for(var ue=0,ce=se.length;ue<ce;ue++){var le=D(se[ue],W[ue],te);Ne(le.x,le.y,-ee)}}}for(var he=h+f,fe=0;fe<P;fe++){var de=c?D(_[fe],j[fe],he):_[fe];k?(b.copy(g.normals[0]).multiplyScalar(de.x),y.copy(g.binormals[0]).multiplyScalar(de.y),x.copy(m[0]).add(b).add(y),Ne(x.x,x.y,x.z)):Ne(de.x,de.y,0)}for(var pe=1;pe<=r;pe++)for(var ve=0;ve<P;ve++){var me=c?D(_[ve],j[ve],he):_[ve];k?(b.copy(g.normals[pe]).multiplyScalar(me.x),y.copy(g.binormals[pe]).multiplyScalar(me.y),x.copy(m[pe]).add(b).add(y),Ne(x.x,x.y,x.z)):Ne(me.x,me.y,u/r*pe)}for(var ge=d-1;ge>=0;ge--){for(var ye=ge/d,be=l*Math.cos(ye*Math.PI/2),xe=h*Math.sin(ye*Math.PI/2)+f,ke=0,we=A.length;ke<we;ke++){var _e=D(A[ke],F[ke],xe);Ne(_e.x,_e.y,u+be)}for(var Se=0,Ce=S.length;Se<Ce;Se++){var Te=S[Se];W=G[Se];for(var Ee=0,Ie=Te.length;Ee<Ie;Ee++){var Ae=D(Te[Ee],W[Ee],xe);k?Ne(Ae.x,Ae.y+m[r-1].y,m[r-1].x+be):Ne(Ae.x,Ae.y,u+be)}}}function Me(e,t){for(var n=e.length;--n>=0;){var a=n,i=n-1;i<0&&(i=e.length-1);for(var o=0,s=r+2*d;o<s;o++){var u=P*o,c=P*(o+1);De(t+a+u,t+i+u,t+i+c,t+a+c)}}}function Ne(e,n,r){t.push(e),t.push(n),t.push(r)}function Re(e,t,n){Pe(e),Pe(t),Pe(n);var r=o.length/3,a=v.generateTopUV(i,o,r-3,r-2,r-1);Oe(a[0]),Oe(a[1]),Oe(a[2])}function De(e,t,n,r){Pe(e),Pe(t),Pe(r),Pe(t),Pe(n),Pe(r);var a=o.length/3,s=v.generateSideWallUV(i,o,a-6,a-3,a-2,a-1);Oe(s[0]),Oe(s[1]),Oe(s[3]),Oe(s[1]),Oe(s[2]),Oe(s[3])}function Pe(e){o.push(t[3*e+0]),o.push(t[3*e+1]),o.push(t[3*e+2])}function Oe(e){s.push(e.x),s.push(e.y)}!function(){var e=o.length/3;if(c){for(var t=0,n=P*t,a=0;a<O;a++){var s=I[a];Re(s[2]+n,s[1]+n,s[0]+n)}n=P*(t=r+2*d);for(var u=0;u<O;u++){var l=I[u];Re(l[0]+n,l[1]+n,l[2]+n)}}else{for(var h=0;h<O;h++){var f=I[h];Re(f[2],f[1],f[0])}for(var p=0;p<O;p++){var v=I[p];Re(v[0]+P*r,v[1]+P*r,v[2]+P*r)}}i.addGroup(e,o.length/3-e,0)}(),function(){var e=o.length/3,t=0;Me(A,t),t+=A.length;for(var n=0,r=S.length;n<r;n++){var a=S[n];Me(a,t),t+=a.length}i.addGroup(e,o.length/3-e,1)}()}return e.setAttribute("position",new __e(o,3)),e.setAttribute("uv",new __e(s,2)),e.computeVertexNormals(),e}return Jn(n,[{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);return function(e,t,n){if(n.shapes=[],Array.isArray(e))for(var r=0,a=e.length;r<a;r++){var i=e[r];n.shapes.push(i.uuid)}else n.shapes.push(e.uuid);n.options=Object.assign({},t),void 0!==t.extrudePath&&(n.options.extrudePath=t.extrudePath.toJSON());return n}(this.parameters.shapes,this.parameters.options,e)}}],[{key:"fromJSON",value:function(e,t){for(var r=[],a=0,i=e.shapes.length;a<i;a++){var o=t[e.shapes[a]];r.push(o)}var s=e.options.extrudePath;return void 0!==s&&(e.options.extrudePath=(new TIe[s.type]).fromJSON(s)),new n(r,e.options)}}]),n}(R_e),yAe={generateTopUV:function(e,t,n,r,a){var i=t[3*n],o=t[3*n+1],s=t[3*r],u=t[3*r+1],c=t[3*a],l=t[3*a+1];return[new yke(i,o),new yke(s,u),new yke(c,l)]},generateSideWallUV:function(e,t,n,r,a,i){var o=t[3*n],s=t[3*n+1],u=t[3*n+2],c=t[3*r],l=t[3*r+1],h=t[3*r+2],f=t[3*a],d=t[3*a+1],p=t[3*a+2],v=t[3*i],m=t[3*i+1],g=t[3*i+2];return Math.abs(s-l)<Math.abs(o-c)?[new yke(o,1-u),new yke(c,1-h),new yke(f,1-p),new yke(v,1-g)]:[new yke(s,1-u),new yke(l,1-h),new yke(d,1-p),new yke(m,1-g)]}};var bAe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;$n(this,n);var i=(1+Math.sqrt(5))/2,o=[-1,i,0,1,i,0,-1,-i,0,1,-i,0,0,-1,i,0,1,i,0,-1,-i,0,1,-i,i,0,-1,i,0,1,-i,0,-1,-i,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];return(e=t.call(this,o,s,r,a)).type="IcosahedronGeometry",e.parameters={radius:r,detail:a},e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(PIe),xAe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;$n(this,n);var i=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],o=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];return(e=t.call(this,i,o,r,a)).type="OctahedronGeometry",e.parameters={radius:r,detail:a},e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(PIe),kAe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:.5,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:2*Math.PI;$n(this,n),(e=t.call(this)).type="RingGeometry",e.parameters={innerRadius:r,outerRadius:a,thetaSegments:i,phiSegments:o,thetaStart:s,thetaLength:u},i=Math.max(3,i);for(var c=[],l=[],h=[],f=[],d=r,p=(a-r)/(o=Math.max(1,o)),v=new Yke,m=new yke,g=0;g<=o;g++){for(var y=0;y<=i;y++){var b=s+y/i*u;v.x=d*Math.cos(b),v.y=d*Math.sin(b),l.push(v.x,v.y,v.z),h.push(0,0,1),m.x=(v.x/a+1)/2,m.y=(v.y/a+1)/2,f.push(m.x,m.y)}d+=p}for(var x=0;x<o;x++)for(var k=x*(i+1),w=0;w<i;w++){var _=w+k,S=_,C=_+i+1,T=_+i+2,E=_+1;c.push(S,C,E),c.push(C,T,E)}return e.setIndex(c),e.setAttribute("position",new __e(l,3)),e.setAttribute("normal",new __e(h,3)),e.setAttribute("uv",new __e(f,2)),e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}]),n}(R_e),wAe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new VIe([new yke(0,.5),new yke(-.5,-.5),new yke(.5,-.5)]),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;$n(this,n),(e=t.call(this)).type="ShapeGeometry",e.parameters={shapes:r,curveSegments:a};var i=[],o=[],s=[],u=[],c=0,l=0;if(!1===Array.isArray(r))f(r);else for(var h=0;h<r.length;h++)f(r[h]),e.addGroup(c,l,h),c+=l,l=0;function f(e){var t=o.length/3,n=e.extractPoints(a),r=n.shape,c=n.holes;!1===pAe.isClockWise(r)&&(r=r.reverse());for(var h=0,f=c.length;h<f;h++){var d=c[h];!0===pAe.isClockWise(d)&&(c[h]=d.reverse())}for(var p=pAe.triangulateShape(r,c),v=0,m=c.length;v<m;v++){var g=c[v];r=r.concat(g)}for(var y=0,b=r.length;y<b;y++){var x=r[y];o.push(x.x,x.y,0),s.push(0,0,1),u.push(x.x,x.y)}for(var k=0,w=p.length;k<w;k++){var _=p[k],S=_[0]+t,C=_[1]+t,T=_[2]+t;i.push(S,C,T),l+=3}}return e.setIndex(i),e.setAttribute("position",new __e(o,3)),e.setAttribute("normal",new __e(s,3)),e.setAttribute("uv",new __e(u,2)),e}return Jn(n,[{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);return function(e,t){if(t.shapes=[],Array.isArray(e))for(var n=0,r=e.length;n<r;n++){var a=e[n];t.shapes.push(a.uuid)}else t.shapes.push(e.uuid);return t}(this.parameters.shapes,e)}}],[{key:"fromJSON",value:function(e,t){for(var r=[],a=0,i=e.shapes.length;a<i;a++){var o=t[e.shapes[a]];r.push(o)}return new n(r,e.curveSegments)}}]),n}(R_e);var _Ae=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:32,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:Math.PI;$n(this,n),(e=t.call(this)).type="SphereGeometry",e.parameters={radius:r,widthSegments:a,heightSegments:i,phiStart:o,phiLength:s,thetaStart:u,thetaLength:c},a=Math.max(3,Math.floor(a)),i=Math.max(2,Math.floor(i));for(var l=Math.min(u+c,Math.PI),h=0,f=[],d=new Yke,p=new Yke,v=[],m=[],g=[],y=[],b=0;b<=i;b++){var x=[],k=b/i,w=0;0==b&&0==u?w=.5/a:b==i&&l==Math.PI&&(w=-.5/a);for(var _=0;_<=a;_++){var S=_/a;d.x=-r*Math.cos(o+S*s)*Math.sin(u+k*c),d.y=r*Math.cos(u+k*c),d.z=r*Math.sin(o+S*s)*Math.sin(u+k*c),m.push(d.x,d.y,d.z),p.copy(d).normalize(),g.push(p.x,p.y,p.z),y.push(S+w,1-k),x.push(h++)}f.push(x)}for(var C=0;C<i;C++)for(var T=0;T<a;T++){var E=f[C][T+1],I=f[C][T],A=f[C+1][T],M=f[C+1][T+1];(0!==C||u>0)&&v.push(E,I,M),(C!==i-1||l<Math.PI)&&v.push(I,A,M)}return e.setIndex(v),e.setAttribute("position",new __e(m,3)),e.setAttribute("normal",new __e(g,3)),e.setAttribute("uv",new __e(y,2)),e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}]),n}(R_e),SAe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;$n(this,n);var i=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],o=[2,1,0,0,3,2,1,3,0,2,3,1];return(e=t.call(this,i,o,r,a)).type="TetrahedronGeometry",e.parameters={radius:r,detail:a},e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.detail)}}]),n}(PIe),CAe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2*Math.PI;$n(this,n),(e=t.call(this)).type="TorusGeometry",e.parameters={radius:r,tube:a,radialSegments:i,tubularSegments:o,arc:s},i=Math.floor(i),o=Math.floor(o);for(var u=[],c=[],l=[],h=[],f=new Yke,d=new Yke,p=new Yke,v=0;v<=i;v++)for(var m=0;m<=o;m++){var g=m/o*s,y=v/i*Math.PI*2;d.x=(r+a*Math.cos(y))*Math.cos(g),d.y=(r+a*Math.cos(y))*Math.sin(g),d.z=a*Math.sin(y),c.push(d.x,d.y,d.z),f.x=r*Math.cos(g),f.y=r*Math.sin(g),p.subVectors(d,f).normalize(),l.push(p.x,p.y,p.z),h.push(m/o),h.push(v/i)}for(var b=1;b<=i;b++)for(var x=1;x<=o;x++){var k=(o+1)*b+x-1,w=(o+1)*(b-1)+x-1,_=(o+1)*(b-1)+x,S=(o+1)*b+x;u.push(k,w,S),u.push(w,_,S)}return e.setIndex(u),e.setAttribute("position",new __e(c,3)),e.setAttribute("normal",new __e(l,3)),e.setAttribute("uv",new __e(h,2)),e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}]),n}(R_e),TAe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.4,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:64,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:2,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:3;$n(this,n),(e=t.call(this)).type="TorusKnotGeometry",e.parameters={radius:r,tube:a,tubularSegments:i,radialSegments:o,p:s,q:u},i=Math.floor(i),o=Math.floor(o);for(var c=[],l=[],h=[],f=[],d=new Yke,p=new Yke,v=new Yke,m=new Yke,g=new Yke,y=new Yke,b=new Yke,x=0;x<=i;++x){var k=x/i*s*Math.PI*2;R(k,s,u,r,v),R(k+.01,s,u,r,m),y.subVectors(m,v),b.addVectors(m,v),g.crossVectors(y,b),b.crossVectors(g,y),g.normalize(),b.normalize();for(var w=0;w<=o;++w){var _=w/o*Math.PI*2,S=-a*Math.cos(_),C=a*Math.sin(_);d.x=v.x+(S*b.x+C*g.x),d.y=v.y+(S*b.y+C*g.y),d.z=v.z+(S*b.z+C*g.z),l.push(d.x,d.y,d.z),p.subVectors(d,v).normalize(),h.push(p.x,p.y,p.z),f.push(x/i),f.push(w/o)}}for(var T=1;T<=i;T++)for(var E=1;E<=o;E++){var I=(o+1)*(T-1)+(E-1),A=(o+1)*T+(E-1),M=(o+1)*T+E,N=(o+1)*(T-1)+E;c.push(I,A,N),c.push(A,M,N)}function R(e,t,n,r,a){var i=Math.cos(e),o=Math.sin(e),s=n/t*e,u=Math.cos(s);a.x=r*(2+u)*.5*i,a.y=r*(2+u)*o*.5,a.z=r*Math.sin(s)*.5}return e.setIndex(c),e.setAttribute("position",new __e(l,3)),e.setAttribute("normal",new __e(h,3)),e.setAttribute("uv",new __e(f,2)),e}return Jn(n,null,[{key:"fromJSON",value:function(e){return new n(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}]),n}(R_e),EAe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new SIe(new Yke(-1,-1,0),new Yke(-1,1,0),new Yke(1,1,0)),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8,s=arguments.length>4&&void 0!==arguments[4]&&arguments[4];$n(this,n),(e=t.call(this)).type="TubeGeometry",e.parameters={path:r,tubularSegments:a,radius:i,radialSegments:o,closed:s};var u=r.computeFrenetFrames(a,s);e.tangents=u.tangents,e.normals=u.normals,e.binormals=u.binormals;var c=new Yke,l=new Yke,h=new yke,f=new Yke,d=[],p=[],v=[],m=[];function g(){for(var e=0;e<a;e++)y(e);y(!1===s?a:0),x(),b()}function y(e){f=r.getPointAt(e/a,f);for(var t=u.normals[e],n=u.binormals[e],s=0;s<=o;s++){var h=s/o*Math.PI*2,v=Math.sin(h),m=-Math.cos(h);l.x=m*t.x+v*n.x,l.y=m*t.y+v*n.y,l.z=m*t.z+v*n.z,l.normalize(),p.push(l.x,l.y,l.z),c.x=f.x+i*l.x,c.y=f.y+i*l.y,c.z=f.z+i*l.z,d.push(c.x,c.y,c.z)}}function b(){for(var e=1;e<=a;e++)for(var t=1;t<=o;t++){var n=(o+1)*(e-1)+(t-1),r=(o+1)*e+(t-1),i=(o+1)*e+t,s=(o+1)*(e-1)+t;m.push(n,r,s),m.push(r,i,s)}}function x(){for(var e=0;e<=a;e++)for(var t=0;t<=o;t++)h.x=e/a,h.y=t/o,v.push(h.x,h.y)}return g(),e.setIndex(m),e.setAttribute("position",new __e(d,3)),e.setAttribute("normal",new __e(p,3)),e.setAttribute("uv",new __e(v,2)),e}return Jn(n,[{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this);return e.path=this.parameters.path.toJSON(),e}}],[{key:"fromJSON",value:function(e){return new n((new TIe[e.path.type]).fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}]),n}(R_e),IAe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if($n(this,n),(e=t.call(this)).type="WireframeGeometry",e.parameters={geometry:r},null!==r){var a=[],i=new Set,o=new Yke,s=new Yke;if(null!==r.index){var u=r.attributes.position,c=r.index,l=r.groups;0===l.length&&(l=[{start:0,count:c.count,materialIndex:0}]);for(var h=0,f=l.length;h<f;++h)for(var d=l[h],p=d.start,v=d.count,m=p,g=p+v;m<g;m+=3)for(var y=0;y<3;y++){var b=c.getX(m+y),x=c.getX(m+(y+1)%3);o.fromBufferAttribute(u,b),s.fromBufferAttribute(u,x),!0===AAe(o,s,i)&&(a.push(o.x,o.y,o.z),a.push(s.x,s.y,s.z))}}else for(var k=r.attributes.position,w=0,_=k.count/3;w<_;w++)for(var S=0;S<3;S++){var C=3*w+S,T=3*w+(S+1)%3;o.fromBufferAttribute(k,C),s.fromBufferAttribute(k,T),!0===AAe(o,s,i)&&(a.push(o.x,o.y,o.z),a.push(s.x,s.y,s.z))}e.setAttribute("position",new __e(a,3))}return e}return Jn(n)}(R_e);function AAe(e,t,n){var r="".concat(e.x,",").concat(e.y,",").concat(e.z,"-").concat(t.x,",").concat(t.y,",").concat(t.z),a="".concat(t.x,",").concat(t.y,",").concat(t.z,"-").concat(e.x,",").concat(e.y,",").concat(e.z);return!0!==n.has(r)&&!0!==n.has(a)&&(n.add(r),n.add(a),!0)}var MAe=Object.freeze({__proto__:null,BoxGeometry:J_e,BoxBufferGeometry:J_e,CapsuleGeometry:MIe,CapsuleBufferGeometry:MIe,CircleGeometry:NIe,CircleBufferGeometry:NIe,ConeGeometry:DIe,ConeBufferGeometry:DIe,CylinderGeometry:RIe,CylinderBufferGeometry:RIe,DodecahedronGeometry:OIe,DodecahedronBufferGeometry:OIe,EdgesGeometry:UIe,ExtrudeGeometry:gAe,ExtrudeBufferGeometry:gAe,IcosahedronGeometry:bAe,IcosahedronBufferGeometry:bAe,LatheGeometry:AIe,LatheBufferGeometry:AIe,OctahedronGeometry:xAe,OctahedronBufferGeometry:xAe,PlaneGeometry:ySe,PlaneBufferGeometry:ySe,PolyhedronGeometry:PIe,PolyhedronBufferGeometry:PIe,RingGeometry:kAe,RingBufferGeometry:kAe,ShapeGeometry:wAe,ShapeBufferGeometry:wAe,SphereGeometry:_Ae,SphereBufferGeometry:_Ae,TetrahedronGeometry:SAe,TetrahedronBufferGeometry:SAe,TorusGeometry:CAe,TorusBufferGeometry:CAe,TorusKnotGeometry:TAe,TorusKnotBufferGeometry:TAe,TubeGeometry:EAe,TubeBufferGeometry:EAe,WireframeGeometry:IAe}),NAe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isShadowMaterial=!0,r.type="ShadowMaterial",r.color=new Oke(0),r.transparent=!0,r.fog=!0,r.setValues(e),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.fog=e.fog,this}}]),n}(l_e),RAe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).isRawShaderMaterial=!0,r.type="RawShaderMaterial",r}return Jn(n)}(nSe),DAe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isMeshStandardMaterial=!0,r.defines={STANDARD:""},r.type="MeshStandardMaterial",r.color=new Oke(16777215),r.roughness=1,r.metalness=0,r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new Oke(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=Txe,r.normalScale=new yke(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.roughnessMap=null,r.metalnessMap=null,r.alphaMap=null,r.envMap=null,r.envMapIntensity=1,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.flatShading=!1,r.fog=!0,r.setValues(e),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}(l_e),PAe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isMeshPhysicalMaterial=!0,r.defines={STANDARD:"",PHYSICAL:""},r.type="MeshPhysicalMaterial",r.clearcoatMap=null,r.clearcoatRoughness=0,r.clearcoatRoughnessMap=null,r.clearcoatNormalScale=new yke(1,1),r.clearcoatNormalMap=null,r.ior=1.5,Object.defineProperty(ir(r),"reflectivity",{get:function(){return hke(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(e){this.ior=(1+.4*e)/(1-.4*e)}}),r.iridescenceMap=null,r.iridescenceIOR=1.3,r.iridescenceThicknessRange=[100,400],r.iridescenceThicknessMap=null,r.sheenColor=new Oke(0),r.sheenColorMap=null,r.sheenRoughness=1,r.sheenRoughnessMap=null,r.transmissionMap=null,r.thickness=0,r.thicknessMap=null,r.attenuationDistance=0,r.attenuationColor=new Oke(1,1,1),r.specularIntensity=1,r.specularIntensityMap=null,r.specularColor=new Oke(1,1,1),r.specularColorMap=null,r._sheen=0,r._clearcoat=0,r._iridescence=0,r._transmission=0,r.setValues(e),r}return Jn(n,[{key:"sheen",get:function(){return this._sheen},set:function(e){this._sheen>0!==e>0&&this.version++,this._sheen=e}},{key:"clearcoat",get:function(){return this._clearcoat},set:function(e){this._clearcoat>0!==e>0&&this.version++,this._clearcoat=e}},{key:"iridescence",get:function(){return this._iridescence},set:function(e){this._iridescence>0!==e>0&&this.version++,this._iridescence=e}},{key:"transmission",get:function(){return this._transmission},set:function(e){this._transmission>0!==e>0&&this.version++,this._transmission=e}},{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=Tt(e.iridescenceThicknessRange),this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}]),n}(DAe),OAe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isMeshPhongMaterial=!0,r.type="MeshPhongMaterial",r.color=new Oke(16777215),r.specular=new Oke(1118481),r.shininess=30,r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new Oke(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=Txe,r.normalScale=new yke(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=Bye,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.flatShading=!1,r.fog=!0,r.setValues(e),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}(l_e),LAe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isMeshToonMaterial=!0,r.defines={TOON:""},r.type="MeshToonMaterial",r.color=new Oke(16777215),r.map=null,r.gradientMap=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new Oke(0),r.emissiveIntensity=1,r.emissiveMap=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=Txe,r.normalScale=new yke(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.alphaMap=null,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.fog=!0,r.setValues(e),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),n}(l_e),FAe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isMeshNormalMaterial=!0,r.type="MeshNormalMaterial",r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=Txe,r.normalScale=new yke(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.wireframe=!1,r.wireframeLinewidth=1,r.flatShading=!1,r.setValues(e),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}]),n}(l_e),zAe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isMeshLambertMaterial=!0,r.type="MeshLambertMaterial",r.color=new Oke(16777215),r.map=null,r.lightMap=null,r.lightMapIntensity=1,r.aoMap=null,r.aoMapIntensity=1,r.emissive=new Oke(0),r.emissiveIntensity=1,r.emissiveMap=null,r.specularMap=null,r.alphaMap=null,r.envMap=null,r.combine=Bye,r.reflectivity=1,r.refractionRatio=.98,r.wireframe=!1,r.wireframeLinewidth=1,r.wireframeLinecap="round",r.wireframeLinejoin="round",r.fog=!0,r.setValues(e),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}]),n}(l_e),BAe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isMeshMatcapMaterial=!0,r.defines={MATCAP:""},r.type="MeshMatcapMaterial",r.color=new Oke(16777215),r.matcap=null,r.map=null,r.bumpMap=null,r.bumpScale=1,r.normalMap=null,r.normalMapType=Txe,r.normalScale=new yke(1,1),r.displacementMap=null,r.displacementScale=1,r.displacementBias=0,r.alphaMap=null,r.flatShading=!1,r.fog=!0,r.setValues(e),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}]),n}(l_e),UAe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).isLineDashedMaterial=!0,r.type="LineDashedMaterial",r.scale=1,r.dashSize=3,r.gapSize=1,r.setValues(e),r}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}]),n}(BEe),VAe={arraySlice:function(e,t,n){return VAe.isTypedArray(e)?new e.constructor(e.subarray(t,void 0!==n?n:e.length)):e.slice(t,n)},convertArray:function(e,t,n){return!e||!n&&e.constructor===t?e:"number"===typeof t.BYTES_PER_ELEMENT?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,n=new Array(t),r=0;r!==t;++r)n[r]=r;return n.sort((function(t,n){return e[t]-e[n]})),n},sortedArray:function(e,t,n){for(var r=e.length,a=new e.constructor(r),i=0,o=0;o!==r;++i)for(var s=n[i]*t,u=0;u!==t;++u)a[o++]=e[s+u];return a},flattenJSON:function(e,t,n,r){for(var a=1,i=e[0];void 0!==i&&void 0===i[r];)i=e[a++];if(void 0!==i){var o=i[r];if(void 0!==o)if(Array.isArray(o))do{void 0!==(o=i[r])&&(t.push(i.time),n.push.apply(n,o)),i=e[a++]}while(void 0!==i);else if(void 0!==o.toArray)do{void 0!==(o=i[r])&&(t.push(i.time),o.toArray(n,n.length)),i=e[a++]}while(void 0!==i);else do{void 0!==(o=i[r])&&(t.push(i.time),n.push(o)),i=e[a++]}while(void 0!==i)}},subclip:function(e,t,n,r){var a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:30,i=e.clone();i.name=t;for(var o=[],s=0;s<i.tracks.length;++s){for(var u=i.tracks[s],c=u.getValueSize(),l=[],h=[],f=0;f<u.times.length;++f){var d=u.times[f]*a;if(!(d<n||d>=r)){l.push(u.times[f]);for(var p=0;p<c;++p)h.push(u.values[f*c+p])}}0!==l.length&&(u.times=VAe.convertArray(l,u.times.constructor),u.values=VAe.convertArray(h,u.values.constructor),o.push(u))}i.tracks=o;for(var v=1/0,m=0;m<i.tracks.length;++m)v>i.tracks[m].times[0]&&(v=i.tracks[m].times[0]);for(var g=0;g<i.tracks.length;++g)i.tracks[g].shift(-1*v);return i.resetDuration(),i},makeClipAdditive:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:e,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30;r<=0&&(r=30);for(var a=n.tracks.length,i=t/r,o=function(t){var r=n.tracks[t],a=r.ValueTypeName;if("bool"===a||"string"===a)return"continue";var o=e.tracks.find((function(e){return e.name===r.name&&e.ValueTypeName===a}));if(void 0===o)return"continue";var s=0,u=r.getValueSize();r.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(s=u/3);var c=0,l=o.getValueSize();o.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(c=l/3);var h=r.times.length-1,f=void 0;if(i<=r.times[0]){var d=s,p=u-s;f=VAe.arraySlice(r.values,d,p)}else if(i>=r.times[h]){var v=h*u+s,m=v+u-s;f=VAe.arraySlice(r.values,v,m)}else{var g=r.createInterpolant(),y=s,b=u-s;g.evaluate(i),f=VAe.arraySlice(g.resultBuffer,y,b)}"quaternion"===a&&(new Kke).fromArray(f).normalize().conjugate().toArray(f);for(var x=o.times.length,k=0;k<x;++k){var w=k*l+c;if("quaternion"===a)Kke.multiplyQuaternionsFlat(o.values,w,f,0,o.values,w);else for(var _=l-2*c,S=0;S<_;++S)o.values[w+S]-=f[S]}},s=0;s<a;++s)o(s);return e.blendMode=yxe,e}},WAe=function(){function e(t,n,r,a){$n(this,e),this.parameterPositions=t,this._cachedIndex=0,this.resultBuffer=void 0!==a?a:new n.constructor(r),this.sampleValues=n,this.valueSize=r,this.settings=null,this.DefaultSettings_={}}return Jn(e,[{key:"evaluate",value:function(e){var t=this.parameterPositions,n=this._cachedIndex,r=t[n],a=t[n-1];e:{t:{var i;n:{r:if(!(e<r)){for(var o=n+2;;){if(void 0===r){if(e<a)break r;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===o)break;if(a=r,e<(r=t[++n]))break t}i=t.length;break n}if(e>=a)break e;var s=t[1];e<s&&(n=2,a=s);for(var u=n-2;;){if(void 0===a)return this._cachedIndex=0,this.copySampleValue_(0);if(n===u)break;if(r=a,e>=(a=t[--n-1]))break t}i=n,n=0}for(;n<i;){var c=n+i>>>1;e<t[c]?i=c:n=c+1}if(r=t[n],void 0===(a=t[n-1]))return this._cachedIndex=0,this.copySampleValue_(0);if(void 0===r)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,a,r)}return this.interpolate_(n,a,e,r)}},{key:"getSettings_",value:function(){return this.settings||this.DefaultSettings_}},{key:"copySampleValue_",value:function(e){for(var t=this.resultBuffer,n=this.sampleValues,r=this.valueSize,a=e*r,i=0;i!==r;++i)t[i]=n[a+i];return t}},{key:"interpolate_",value:function(){throw new Error("call to abstract method")}},{key:"intervalChanged_",value:function(){}}]),e}(),GAe=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i){var o;return $n(this,n),(o=t.call(this,e,r,a,i))._weightPrev=-0,o._offsetPrev=-0,o._weightNext=-0,o._offsetNext=-0,o.DefaultSettings_={endingStart:pxe,endingEnd:pxe},o}return Jn(n,[{key:"intervalChanged_",value:function(e,t,n){var r=this.parameterPositions,a=e-2,i=e+1,o=r[a],s=r[i];if(void 0===o)switch(this.getSettings_().endingStart){case vxe:a=e,o=2*t-n;break;case mxe:o=t+r[a=r.length-2]-r[a+1];break;default:a=e,o=n}if(void 0===s)switch(this.getSettings_().endingEnd){case vxe:i=e,s=2*n-t;break;case mxe:i=1,s=n+r[1]-r[0];break;default:i=e-1,s=t}var u=.5*(n-t),c=this.valueSize;this._weightPrev=u/(t-o),this._weightNext=u/(s-n),this._offsetPrev=a*c,this._offsetNext=i*c}},{key:"interpolate_",value:function(e,t,n,r){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,c=this._offsetPrev,l=this._offsetNext,h=this._weightPrev,f=this._weightNext,d=(n-t)/(r-t),p=d*d,v=p*d,m=-h*v+2*h*p-h*d,g=(1+h)*v+(-1.5-2*h)*p+(-.5+h)*d+1,y=(-1-f)*v+(1.5+f)*p+.5*d,b=f*v-f*p,x=0;x!==o;++x)a[x]=m*i[c+x]+g*i[u+x]+y*i[s+x]+b*i[l+x];return a}}]),n}(WAe),jAe=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i){return $n(this,n),t.call(this,e,r,a,i)}return Jn(n,[{key:"interpolate_",value:function(e,t,n,r){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=e*o,u=s-o,c=(n-t)/(r-t),l=1-c,h=0;h!==o;++h)a[h]=i[u+h]*l+i[s+h]*c;return a}}]),n}(WAe),qAe=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i){return $n(this,n),t.call(this,e,r,a,i)}return Jn(n,[{key:"interpolate_",value:function(e){return this.copySampleValue_(e-1)}}]),n}(WAe),HAe=function(){function e(t,n,r,a){if($n(this,e),void 0===t)throw new Error("THREE.KeyframeTrack: track name is undefined");if(void 0===n||0===n.length)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+t);this.name=t,this.times=VAe.convertArray(n,this.TimeBufferType),this.values=VAe.convertArray(r,this.ValueBufferType),this.setInterpolation(a||this.DefaultInterpolation)}return Jn(e,[{key:"InterpolantFactoryMethodDiscrete",value:function(e){return new qAe(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodLinear",value:function(e){return new jAe(this.times,this.values,this.getValueSize(),e)}},{key:"InterpolantFactoryMethodSmooth",value:function(e){return new GAe(this.times,this.values,this.getValueSize(),e)}},{key:"setInterpolation",value:function(e){var t;switch(e){case hxe:t=this.InterpolantFactoryMethodDiscrete;break;case fxe:t=this.InterpolantFactoryMethodLinear;break;case dxe:t=this.InterpolantFactoryMethodSmooth}if(void 0===t){var n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(void 0===this.createInterpolant){if(e===this.DefaultInterpolation)throw new Error(n);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}},{key:"getInterpolation",value:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return hxe;case this.InterpolantFactoryMethodLinear:return fxe;case this.InterpolantFactoryMethodSmooth:return dxe}}},{key:"getValueSize",value:function(){return this.values.length/this.times.length}},{key:"shift",value:function(e){if(0!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]+=e;return this}},{key:"scale",value:function(e){if(1!==e)for(var t=this.times,n=0,r=t.length;n!==r;++n)t[n]*=e;return this}},{key:"trim",value:function(e,t){for(var n=this.times,r=n.length,a=0,i=r-1;a!==r&&n[a]<e;)++a;for(;-1!==i&&n[i]>t;)--i;if(++i,0!==a||i!==r){a>=i&&(a=(i=Math.max(i,1))-1);var o=this.getValueSize();this.times=VAe.arraySlice(n,a,i),this.values=VAe.arraySlice(this.values,a*o,i*o)}return this}},{key:"validate",value:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var n=this.times,r=this.values,a=n.length;0===a&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var i=null,o=0;o!==a;o++){var s=n[o];if("number"===typeof s&&isNaN(s)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,o,s),e=!1;break}if(null!==i&&i>s){console.error("THREE.KeyframeTrack: Out of order keys.",this,o,s,i),e=!1;break}i=s}if(void 0!==r&&VAe.isTypedArray(r))for(var u=0,c=r.length;u!==c;++u){var l=r[u];if(isNaN(l)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,u,l),e=!1;break}}return e}},{key:"optimize",value:function(){for(var e=VAe.arraySlice(this.times),t=VAe.arraySlice(this.values),n=this.getValueSize(),r=this.getInterpolation()===dxe,a=e.length-1,i=1,o=1;o<a;++o){var s=!1,u=e[o];if(u!==e[o+1]&&(1!==o||u!==e[0]))if(r)s=!0;else for(var c=o*n,l=c-n,h=c+n,f=0;f!==n;++f){var d=t[c+f];if(d!==t[l+f]||d!==t[h+f]){s=!0;break}}if(s){if(o!==i){e[i]=e[o];for(var p=o*n,v=i*n,m=0;m!==n;++m)t[v+m]=t[p+m]}++i}}if(a>0){e[i]=e[a];for(var g=a*n,y=i*n,b=0;b!==n;++b)t[y+b]=t[g+b];++i}return i!==e.length?(this.times=VAe.arraySlice(e,0,i),this.values=VAe.arraySlice(t,0,i*n)):(this.times=e,this.values=t),this}},{key:"clone",value:function(){var e=VAe.arraySlice(this.times,0),t=VAe.arraySlice(this.values,0),n=new(0,this.constructor)(this.name,e,t);return n.createInterpolant=this.createInterpolant,n}}],[{key:"toJSON",value:function(e){var t,n=e.constructor;if(n.toJSON!==this.toJSON)t=n.toJSON(e);else{t={name:e.name,times:VAe.convertArray(e.times,Array),values:VAe.convertArray(e.values,Array)};var r=e.getInterpolation();r!==e.DefaultInterpolation&&(t.interpolation=r)}return t.type=e.ValueTypeName,t}}]),e}();HAe.prototype.TimeBufferType=Float32Array,HAe.prototype.ValueBufferType=Float32Array,HAe.prototype.DefaultInterpolation=fxe;var XAe=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n)}(HAe);XAe.prototype.ValueTypeName="bool",XAe.prototype.ValueBufferType=Array,XAe.prototype.DefaultInterpolation=hxe,XAe.prototype.InterpolantFactoryMethodLinear=void 0,XAe.prototype.InterpolantFactoryMethodSmooth=void 0;var KAe=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n)}(HAe);KAe.prototype.ValueTypeName="color";var YAe=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n)}(HAe);YAe.prototype.ValueTypeName="number";var QAe=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i){return $n(this,n),t.call(this,e,r,a,i)}return Jn(n,[{key:"interpolate_",value:function(e,t,n,r){for(var a=this.resultBuffer,i=this.sampleValues,o=this.valueSize,s=(n-t)/(r-t),u=e*o,c=u+o;u!==c;u+=4)Kke.slerpFlat(a,0,i,u-o,i,u,s);return a}}]),n}(WAe),ZAe=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n,[{key:"InterpolantFactoryMethodLinear",value:function(e){return new QAe(this.times,this.values,this.getValueSize(),e)}}]),n}(HAe);ZAe.prototype.ValueTypeName="quaternion",ZAe.prototype.DefaultInterpolation=fxe,ZAe.prototype.InterpolantFactoryMethodSmooth=void 0;var JAe=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n)}(HAe);JAe.prototype.ValueTypeName="string",JAe.prototype.ValueBufferType=Array,JAe.prototype.DefaultInterpolation=hxe,JAe.prototype.InterpolantFactoryMethodLinear=void 0,JAe.prototype.InterpolantFactoryMethodSmooth=void 0;var $Ae=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),t.apply(this,arguments)}return Jn(n)}(HAe);$Ae.prototype.ValueTypeName="vector";var eMe=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-1,r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:gxe;$n(this,e),this.name=t,this.tracks=r,this.duration=n,this.blendMode=a,this.uuid=lke(),this.duration<0&&this.resetDuration()}return Jn(e,[{key:"resetDuration",value:function(){for(var e=0,t=0,n=this.tracks.length;t!==n;++t){var r=this.tracks[t];e=Math.max(e,r.times[r.times.length-1])}return this.duration=e,this}},{key:"trim",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}},{key:"validate",value:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}},{key:"optimize",value:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}},{key:"clone",value:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}},{key:"toJSON",value:function(){return this.constructor.toJSON(this)}}],[{key:"parse",value:function(e){for(var t=[],n=e.tracks,r=1/(e.fps||1),a=0,i=n.length;a!==i;++a)t.push(tMe(n[a]).scale(r));var o=new this(e.name,e.duration,t,e.blendMode);return o.uuid=e.uuid,o}},{key:"toJSON",value:function(e){for(var t=[],n=e.tracks,r={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode},a=0,i=n.length;a!==i;++a)t.push(HAe.toJSON(n[a]));return r}},{key:"CreateFromMorphTargetSequence",value:function(e,t,n,r){for(var a=t.length,i=[],o=0;o<a;o++){var s=[],u=[];s.push((o+a-1)%a,o,(o+1)%a),u.push(0,1,0);var c=VAe.getKeyframeOrder(s);s=VAe.sortedArray(s,1,c),u=VAe.sortedArray(u,1,c),r||0!==s[0]||(s.push(a),u.push(u[0])),i.push(new YAe(".morphTargetInfluences["+t[o].name+"]",s,u).scale(1/n))}return new this(e,-1,i)}},{key:"findByName",value:function(e,t){var n=e;if(!Array.isArray(e)){var r=e;n=r.geometry&&r.geometry.animations||r.animations}for(var a=0;a<n.length;a++)if(n[a].name===t)return n[a];return null}},{key:"CreateClipsFromMorphTargetSequences",value:function(e,t,n){for(var r={},a=/^([\w-]*?)([\d]+)$/,i=0,o=e.length;i<o;i++){var s=e[i],u=s.name.match(a);if(u&&u.length>1){var c=u[1],l=r[c];l||(r[c]=l=[]),l.push(s)}}var h=[];for(var f in r)h.push(this.CreateFromMorphTargetSequence(f,r[f],t,n));return h}},{key:"parseAnimation",value:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var n=function(e,t,n,r,a){if(0!==n.length){var i=[],o=[];VAe.flattenJSON(n,i,o,r),0!==i.length&&a.push(new e(t,i,o))}},r=[],a=e.name||"default",i=e.fps||30,o=e.blendMode,s=e.length||-1,u=e.hierarchy||[],c=0;c<u.length;c++){var l=u[c].keys;if(l&&0!==l.length)if(l[0].morphTargets){var h={},f=void 0;for(f=0;f<l.length;f++)if(l[f].morphTargets)for(var d=0;d<l[f].morphTargets.length;d++)h[l[f].morphTargets[d]]=-1;for(var p in h){for(var v=[],m=[],g=0;g!==l[f].morphTargets.length;++g){var y=l[f];v.push(y.time),m.push(y.morphTarget===p?1:0)}r.push(new YAe(".morphTargetInfluence["+p+"]",v,m))}s=h.length*i}else{var b=".bones["+t[c].name+"]";n($Ae,b+".position",l,"pos",r),n(ZAe,b+".quaternion",l,"rot",r),n($Ae,b+".scale",l,"scl",r)}}return 0===r.length?null:new this(a,s,r,o)}}]),e}();function tMe(e){if(void 0===e.type)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(e){switch(e.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return YAe;case"vector":case"vector2":case"vector3":case"vector4":return $Ae;case"color":return KAe;case"quaternion":return ZAe;case"bool":case"boolean":return XAe;case"string":return JAe}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+e)}(e.type);if(void 0===e.times){var n=[],r=[];VAe.flattenJSON(e.keys,n,r,"value"),e.times=n,e.values=r}return void 0!==t.parse?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}var nMe,rMe={enabled:!1,files:{},add:function(e,t){!1!==this.enabled&&(this.files[e]=t)},get:function(e){if(!1!==this.enabled)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}},aMe=Jn((function e(t,n,r){$n(this,e);var a=this,i=!1,o=0,s=0,u=void 0,c=[];this.onStart=void 0,this.onLoad=t,this.onProgress=n,this.onError=r,this.itemStart=function(e){s++,!1===i&&void 0!==a.onStart&&a.onStart(e,o,s),i=!0},this.itemEnd=function(e){o++,void 0!==a.onProgress&&a.onProgress(e,o,s),o===s&&(i=!1,void 0!==a.onLoad&&a.onLoad())},this.itemError=function(e){void 0!==a.onError&&a.onError(e)},this.resolveURL=function(e){return u?u(e):e},this.setURLModifier=function(e){return u=e,this},this.addHandler=function(e,t){return c.push(e,t),this},this.removeHandler=function(e){var t=c.indexOf(e);return-1!==t&&c.splice(t,2),this},this.getHandler=function(e){for(var t=0,n=c.length;t<n;t+=2){var r=c[t],a=c[t+1];if(r.global&&(r.lastIndex=0),r.test(e))return a}return null}})),iMe=new aMe,oMe=function(){function e(t){$n(this,e),this.manager=void 0!==t?t:iMe,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}return Jn(e,[{key:"load",value:function(){}},{key:"loadAsync",value:function(e,t){var n=this;return new Promise((function(r,a){n.load(e,r,t,a)}))}},{key:"parse",value:function(){}},{key:"setCrossOrigin",value:function(e){return this.crossOrigin=e,this}},{key:"setWithCredentials",value:function(e){return this.withCredentials=e,this}},{key:"setPath",value:function(e){return this.path=e,this}},{key:"setResourcePath",value:function(e){return this.resourcePath=e,this}},{key:"setRequestHeader",value:function(e){return this.requestHeader=e,this}}]),e}(),sMe={},uMe=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"load",value:function(e,t,n,r){var a=this;void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var i=rMe.get(e);if(void 0!==i)return this.manager.itemStart(e),setTimeout((function(){t&&t(i),a.manager.itemEnd(e)}),0),i;if(void 0===sMe[e]){sMe[e]=[],sMe[e].push({onLoad:t,onProgress:n,onError:r});var o=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),s=this.mimeType,u=this.responseType;fetch(o).then((function(t){if(200===t.status||0===t.status){if(0===t.status&&console.warn("THREE.FileLoader: HTTP Status 0 received."),"undefined"===typeof ReadableStream||void 0===t.body||void 0===t.body.getReader)return t;var n=sMe[e],r=t.body.getReader(),a=t.headers.get("Content-Length"),i=a?parseInt(a):0,o=0!==i,s=0,u=new ReadableStream({start:function(e){!function t(){r.read().then((function(r){var a=r.done,u=r.value;if(a)e.close();else{s+=u.byteLength;for(var c=new ProgressEvent("progress",{lengthComputable:o,loaded:s,total:i}),l=0,h=n.length;l<h;l++){var f=n[l];f.onProgress&&f.onProgress(c)}e.enqueue(u),t()}}))}()}});return new Response(u)}throw Error('fetch for "'.concat(t.url,'" responded with ').concat(t.status,": ").concat(t.statusText))})).then((function(e){switch(u){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"document":return e.text().then((function(e){return(new DOMParser).parseFromString(e,s)}));case"json":return e.json();default:if(void 0===s)return e.text();var t=/charset="?([^;"\s]*)"?/i.exec(s),n=t&&t[1]?t[1].toLowerCase():void 0,r=new TextDecoder(n);return e.arrayBuffer().then((function(e){return r.decode(e)}))}})).then((function(t){rMe.add(e,t);var n=sMe[e];delete sMe[e];for(var r=0,a=n.length;r<a;r++){var i=n[r];i.onLoad&&i.onLoad(t)}})).catch((function(t){var n=sMe[e];if(void 0===n)throw a.manager.itemError(e),t;delete sMe[e];for(var r=0,i=n.length;r<i;r++){var o=n[r];o.onError&&o.onError(t)}a.manager.itemError(e)})).finally((function(){a.manager.itemEnd(e)})),this.manager.itemStart(e)}else sMe[e].push({onLoad:t,onProgress:n,onError:r})}},{key:"setResponseType",value:function(e){return this.responseType=e,this}},{key:"setMimeType",value:function(e){return this.mimeType=e,this}}]),n}(oMe),cMe=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new uMe(this.manager);i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(function(n){try{t(a.parse(JSON.parse(n)))}catch(i){r?r(i):console.error(i),a.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e){for(var t=[],n=0;n<e.length;n++){var r=eMe.parse(e[n]);t.push(r)}return t}}]),n}(oMe),lMe=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"load",value:function(e,t,n,r){var a=this,i=[],o=new iIe,s=new uMe(this.manager);s.setPath(this.path),s.setResponseType("arraybuffer"),s.setRequestHeader(this.requestHeader),s.setWithCredentials(a.withCredentials);var u=0;function c(c){s.load(e[c],(function(e){var n=a.parse(e,!0);i[c]={width:n.width,height:n.height,format:n.format,mipmaps:n.mipmaps},6===(u+=1)&&(1===n.mipmapCount&&(o.minFilter=ube),o.image=i,o.format=n.format,o.needsUpdate=!0,t&&t(o))}),n,r)}if(Array.isArray(e))for(var l=0,h=e.length;l<h;++l)c(l);else s.load(e,(function(e){var n=a.parse(e,!0);if(n.isCubemap){for(var r=n.mipmaps.length/n.mipmapCount,s=0;s<r;s++){i[s]={mipmaps:[]};for(var u=0;u<n.mipmapCount;u++)i[s].mipmaps.push(n.mipmaps[s*n.mipmapCount+u]),i[s].format=n.format,i[s].width=n.width,i[s].height=n.height}o.image=i}else o.image.width=n.width,o.image.height=n.height,o.mipmaps=n.mipmaps;1===n.mipmapCount&&(o.minFilter=ube),o.format=n.format,o.needsUpdate=!0,t&&t(o)}),n,r);return o}}]),n}(oMe),hMe=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"load",value:function(e,t,n,r){void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=this,i=rMe.get(e);if(void 0!==i)return a.manager.itemStart(e),setTimeout((function(){t&&t(i),a.manager.itemEnd(e)}),0),i;var o=_ke("img");function s(){c(),rMe.add(e,this),t&&t(this),a.manager.itemEnd(e)}function u(t){c(),r&&r(t),a.manager.itemError(e),a.manager.itemEnd(e)}function c(){o.removeEventListener("load",s,!1),o.removeEventListener("error",u,!1)}return o.addEventListener("load",s,!1),o.addEventListener("error",u,!1),"data:"!==e.slice(0,5)&&void 0!==this.crossOrigin&&(o.crossOrigin=this.crossOrigin),a.manager.itemStart(e),o.src=e,o}}]),n}(oMe),fMe=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"load",value:function(e,t,n,r){var a=new sSe,i=new hMe(this.manager);i.setCrossOrigin(this.crossOrigin),i.setPath(this.path);var o=0;function s(n){i.load(e[n],(function(e){a.images[n]=e,6===++o&&(a.needsUpdate=!0,t&&t(a))}),void 0,r)}for(var u=0;u<e.length;++u)s(u);return a}}]),n}(oMe),dMe=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new AEe,o=new uMe(this.manager);return o.setResponseType("arraybuffer"),o.setRequestHeader(this.requestHeader),o.setPath(this.path),o.setWithCredentials(a.withCredentials),o.load(e,(function(e){var n=a.parse(e);n&&(void 0!==n.image?i.image=n.image:void 0!==n.data&&(i.image.width=n.width,i.image.height=n.height,i.image.data=n.data),i.wrapS=void 0!==n.wrapS?n.wrapS:tbe,i.wrapT=void 0!==n.wrapT?n.wrapT:tbe,i.magFilter=void 0!==n.magFilter?n.magFilter:ube,i.minFilter=void 0!==n.minFilter?n.minFilter:ube,i.anisotropy=void 0!==n.anisotropy?n.anisotropy:1,void 0!==n.encoding&&(i.encoding=n.encoding),void 0!==n.flipY&&(i.flipY=n.flipY),void 0!==n.format&&(i.format=n.format),void 0!==n.type&&(i.type=n.type),void 0!==n.mipmaps&&(i.mipmaps=n.mipmaps,i.minFilter=hbe),1===n.mipmapCount&&(i.minFilter=ube),void 0!==n.generateMipmaps&&(i.generateMipmaps=n.generateMipmaps),i.needsUpdate=!0,t&&t(i,n))}),n,r),i}}]),n}(oMe),pMe=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"load",value:function(e,t,n,r){var a=new Uke,i=new hMe(this.manager);return i.setCrossOrigin(this.crossOrigin),i.setPath(this.path),i.load(e,(function(e){a.image=e,a.needsUpdate=!0,void 0!==t&&t(a)}),n,r),a}}]),n}(oMe),vMe=function(e){tr(n,e);var t=sr(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return $n(this,n),(r=t.call(this)).isLight=!0,r.type="Light",r.color=new Oke(e),r.intensity=a,r}return Jn(n,[{key:"dispose",value:function(){}},{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),this.color.copy(e.color),this.intensity=e.intensity,this}},{key:"toJSON",value:function(e){var t=ja(nr(n.prototype),"toJSON",this).call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,void 0!==this.groundColor&&(t.object.groundColor=this.groundColor.getHex()),void 0!==this.distance&&(t.object.distance=this.distance),void 0!==this.angle&&(t.object.angle=this.angle),void 0!==this.decay&&(t.object.decay=this.decay),void 0!==this.penumbra&&(t.object.penumbra=this.penumbra),void 0!==this.shadow&&(t.object.shadow=this.shadow.toJSON()),t}}]),n}(Zwe),mMe=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;return $n(this,n),(i=t.call(this,e,a)).isHemisphereLight=!0,i.type="HemisphereLight",i.position.copy(Zwe.DefaultUp),i.updateMatrix(),i.groundColor=new Oke(r),i}return Jn(n,[{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),this.groundColor.copy(e.groundColor),this}}]),n}(vMe),gMe=new Twe,yMe=new Yke,bMe=new Yke,xMe=function(){function e(t){$n(this,e),this.camera=t,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new yke(512,512),this.map=null,this.mapPass=null,this.matrix=new Twe,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new vSe,this._frameExtents=new yke(1,1),this._viewportCount=1,this._viewports=[new Vke(0,0,1,1)]}return Jn(e,[{key:"getViewportCount",value:function(){return this._viewportCount}},{key:"getFrustum",value:function(){return this._frustum}},{key:"updateMatrices",value:function(e){var t=this.camera,n=this.matrix;yMe.setFromMatrixPosition(e.matrixWorld),t.position.copy(yMe),bMe.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(bMe),t.updateMatrixWorld(),gMe.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(gMe),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(t.projectionMatrix),n.multiply(t.matrixWorldInverse)}},{key:"getViewport",value:function(e){return this._viewports[e]}},{key:"getFrameExtents",value:function(){return this._frameExtents}},{key:"dispose",value:function(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}},{key:"copy",value:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e={};return 0!==this.bias&&(e.bias=this.bias),0!==this.normalBias&&(e.normalBias=this.normalBias),1!==this.radius&&(e.radius=this.radius),512===this.mapSize.x&&512===this.mapSize.y||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}]),e}(),kMe=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,new aSe(50,1,.5,500))).isSpotLightShadow=!0,e.focus=1,e}return Jn(n,[{key:"updateMatrices",value:function(e){var t=this.camera,r=2*cke*e.angle*this.focus,a=this.mapSize.width/this.mapSize.height,i=e.distance||t.far;r===t.fov&&a===t.aspect&&i===t.far||(t.fov=r,t.aspect=a,t.far=i,t.updateProjectionMatrix()),ja(nr(n.prototype),"updateMatrices",this).call(this,e)}},{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.focus=e.focus,this}}]),n}(xMe),wMe=function(e){tr(n,e);var t=sr(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Math.PI/3,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1;return $n(this,n),(a=t.call(this,e,r)).isSpotLight=!0,a.type="SpotLight",a.position.copy(Zwe.DefaultUp),a.updateMatrix(),a.target=new Zwe,a.distance=i,a.angle=o,a.penumbra=s,a.decay=u,a.shadow=new kMe,a}return Jn(n,[{key:"power",get:function(){return this.intensity*Math.PI},set:function(e){this.intensity=e/Math.PI}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(vMe),_Me=new Twe,SMe=new Yke,CMe=new Yke,TMe=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,new aSe(90,1,.5,500))).isPointLightShadow=!0,e._frameExtents=new yke(4,2),e._viewportCount=6,e._viewports=[new Vke(2,1,1,1),new Vke(0,1,1,1),new Vke(3,1,1,1),new Vke(1,1,1,1),new Vke(3,0,1,1),new Vke(1,0,1,1)],e._cubeDirections=[new Yke(1,0,0),new Yke(-1,0,0),new Yke(0,0,1),new Yke(0,0,-1),new Yke(0,1,0),new Yke(0,-1,0)],e._cubeUps=[new Yke(0,1,0),new Yke(0,1,0),new Yke(0,1,0),new Yke(0,1,0),new Yke(0,0,1),new Yke(0,0,-1)],e}return Jn(n,[{key:"updateMatrices",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.camera,r=this.matrix,a=e.distance||n.far;a!==n.far&&(n.far=a,n.updateProjectionMatrix()),SMe.setFromMatrixPosition(e.matrixWorld),n.position.copy(SMe),CMe.copy(n.position),CMe.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(CMe),n.updateMatrixWorld(),r.makeTranslation(-SMe.x,-SMe.y,-SMe.z),_Me.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(_Me)}}]),n}(xMe),EMe=function(e){tr(n,e);var t=sr(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;return $n(this,n),(a=t.call(this,e,r)).isPointLight=!0,a.type="PointLight",a.distance=i,a.decay=o,a.shadow=new TMe,a}return Jn(n,[{key:"power",get:function(){return 4*this.intensity*Math.PI},set:function(e){this.intensity=e/(4*Math.PI)}},{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}]),n}(vMe),IMe=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this,new ISe(-5,5,5,-5,.5,500))).isDirectionalLightShadow=!0,e}return Jn(n)}(xMe),AMe=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this,e,r)).isDirectionalLight=!0,a.type="DirectionalLight",a.position.copy(Zwe.DefaultUp),a.updateMatrix(),a.target=new Zwe,a.shadow=new IMe,a}return Jn(n,[{key:"dispose",value:function(){this.shadow.dispose()}},{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}]),n}(vMe),MMe=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),(a=t.call(this,e,r)).isAmbientLight=!0,a.type="AmbientLight",a}return Jn(n)}(vMe),NMe=function(e){tr(n,e);var t=sr(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:10,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:10;return $n(this,n),(a=t.call(this,e,r)).isRectAreaLight=!0,a.type="RectAreaLight",a.width=i,a.height=o,a}return Jn(n,[{key:"power",get:function(){return this.intensity*this.width*this.height*Math.PI},set:function(e){this.intensity=e/(this.width*this.height*Math.PI)}},{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.width=e.width,this.height=e.height,this}},{key:"toJSON",value:function(e){var t=ja(nr(n.prototype),"toJSON",this).call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}]),n}(vMe),RMe=function(){function e(){$n(this,e),this.isSphericalHarmonics3=!0,this.coefficients=[];for(var t=0;t<9;t++)this.coefficients.push(new Yke)}return Jn(e,[{key:"set",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}},{key:"zero",value:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}},{key:"getAt",value:function(e,t){var n=e.x,r=e.y,a=e.z,i=this.coefficients;return t.copy(i[0]).multiplyScalar(.282095),t.addScaledVector(i[1],.488603*r),t.addScaledVector(i[2],.488603*a),t.addScaledVector(i[3],.488603*n),t.addScaledVector(i[4],n*r*1.092548),t.addScaledVector(i[5],r*a*1.092548),t.addScaledVector(i[6],.315392*(3*a*a-1)),t.addScaledVector(i[7],n*a*1.092548),t.addScaledVector(i[8],.546274*(n*n-r*r)),t}},{key:"getIrradianceAt",value:function(e,t){var n=e.x,r=e.y,a=e.z,i=this.coefficients;return t.copy(i[0]).multiplyScalar(.886227),t.addScaledVector(i[1],1.023328*r),t.addScaledVector(i[2],1.023328*a),t.addScaledVector(i[3],1.023328*n),t.addScaledVector(i[4],.858086*n*r),t.addScaledVector(i[5],.858086*r*a),t.addScaledVector(i[6],.743125*a*a-.247708),t.addScaledVector(i[7],.858086*n*a),t.addScaledVector(i[8],.429043*(n*n-r*r)),t}},{key:"add",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}},{key:"addScaledSH",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}},{key:"scale",value:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}},{key:"lerp",value:function(e,t){for(var n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}},{key:"equals",value:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}},{key:"copy",value:function(e){return this.set(e.coefficients)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"fromArray",value:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].fromArray(e,t+3*r);return this}},{key:"toArray",value:function(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.coefficients,r=0;r<9;r++)n[r].toArray(e,t+3*r);return e}}],[{key:"getBasisAt",value:function(e,t){var n=e.x,r=e.y,a=e.z;t[0]=.282095,t[1]=.488603*r,t[2]=.488603*a,t[3]=.488603*n,t[4]=1.092548*n*r,t[5]=1.092548*r*a,t[6]=.315392*(3*a*a-1),t[7]=1.092548*n*a,t[8]=.546274*(n*n-r*r)}}]),e}(),DMe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new RMe,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return $n(this,n),(e=t.call(this,void 0,a)).isLightProbe=!0,e.sh=r,e}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.sh.copy(e.sh),this}},{key:"fromJSON",value:function(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}},{key:"toJSON",value:function(e){var t=ja(nr(n.prototype),"toJSON",this).call(this,e);return t.object.sh=this.sh.toArray(),t}}]),n}(vMe),PMe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).textures={},r}return Jn(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new uMe(a.manager);i.setPath(a.path),i.setRequestHeader(a.requestHeader),i.setWithCredentials(a.withCredentials),i.load(e,(function(n){try{t(a.parse(JSON.parse(n)))}catch(i){r?r(i):console.error(i),a.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e){var t=this.textures;function r(e){return void 0===t[e]&&console.warn("THREE.MaterialLoader: Undefined texture",e),t[e]}var a=n.createMaterialFromType(e.type);if(void 0!==e.uuid&&(a.uuid=e.uuid),void 0!==e.name&&(a.name=e.name),void 0!==e.color&&void 0!==a.color&&a.color.setHex(e.color),void 0!==e.roughness&&(a.roughness=e.roughness),void 0!==e.metalness&&(a.metalness=e.metalness),void 0!==e.sheen&&(a.sheen=e.sheen),void 0!==e.sheenColor&&(a.sheenColor=(new Oke).setHex(e.sheenColor)),void 0!==e.sheenRoughness&&(a.sheenRoughness=e.sheenRoughness),void 0!==e.emissive&&void 0!==a.emissive&&a.emissive.setHex(e.emissive),void 0!==e.specular&&void 0!==a.specular&&a.specular.setHex(e.specular),void 0!==e.specularIntensity&&(a.specularIntensity=e.specularIntensity),void 0!==e.specularColor&&void 0!==a.specularColor&&a.specularColor.setHex(e.specularColor),void 0!==e.shininess&&(a.shininess=e.shininess),void 0!==e.clearcoat&&(a.clearcoat=e.clearcoat),void 0!==e.clearcoatRoughness&&(a.clearcoatRoughness=e.clearcoatRoughness),void 0!==e.iridescence&&(a.iridescence=e.iridescence),void 0!==e.iridescenceIOR&&(a.iridescenceIOR=e.iridescenceIOR),void 0!==e.iridescenceThicknessRange&&(a.iridescenceThicknessRange=e.iridescenceThicknessRange),void 0!==e.transmission&&(a.transmission=e.transmission),void 0!==e.thickness&&(a.thickness=e.thickness),void 0!==e.attenuationDistance&&(a.attenuationDistance=e.attenuationDistance),void 0!==e.attenuationColor&&void 0!==a.attenuationColor&&a.attenuationColor.setHex(e.attenuationColor),void 0!==e.fog&&(a.fog=e.fog),void 0!==e.flatShading&&(a.flatShading=e.flatShading),void 0!==e.blending&&(a.blending=e.blending),void 0!==e.combine&&(a.combine=e.combine),void 0!==e.side&&(a.side=e.side),void 0!==e.shadowSide&&(a.shadowSide=e.shadowSide),void 0!==e.opacity&&(a.opacity=e.opacity),void 0!==e.transparent&&(a.transparent=e.transparent),void 0!==e.alphaTest&&(a.alphaTest=e.alphaTest),void 0!==e.depthTest&&(a.depthTest=e.depthTest),void 0!==e.depthWrite&&(a.depthWrite=e.depthWrite),void 0!==e.colorWrite&&(a.colorWrite=e.colorWrite),void 0!==e.stencilWrite&&(a.stencilWrite=e.stencilWrite),void 0!==e.stencilWriteMask&&(a.stencilWriteMask=e.stencilWriteMask),void 0!==e.stencilFunc&&(a.stencilFunc=e.stencilFunc),void 0!==e.stencilRef&&(a.stencilRef=e.stencilRef),void 0!==e.stencilFuncMask&&(a.stencilFuncMask=e.stencilFuncMask),void 0!==e.stencilFail&&(a.stencilFail=e.stencilFail),void 0!==e.stencilZFail&&(a.stencilZFail=e.stencilZFail),void 0!==e.stencilZPass&&(a.stencilZPass=e.stencilZPass),void 0!==e.wireframe&&(a.wireframe=e.wireframe),void 0!==e.wireframeLinewidth&&(a.wireframeLinewidth=e.wireframeLinewidth),void 0!==e.wireframeLinecap&&(a.wireframeLinecap=e.wireframeLinecap),void 0!==e.wireframeLinejoin&&(a.wireframeLinejoin=e.wireframeLinejoin),void 0!==e.rotation&&(a.rotation=e.rotation),1!==e.linewidth&&(a.linewidth=e.linewidth),void 0!==e.dashSize&&(a.dashSize=e.dashSize),void 0!==e.gapSize&&(a.gapSize=e.gapSize),void 0!==e.scale&&(a.scale=e.scale),void 0!==e.polygonOffset&&(a.polygonOffset=e.polygonOffset),void 0!==e.polygonOffsetFactor&&(a.polygonOffsetFactor=e.polygonOffsetFactor),void 0!==e.polygonOffsetUnits&&(a.polygonOffsetUnits=e.polygonOffsetUnits),void 0!==e.dithering&&(a.dithering=e.dithering),void 0!==e.alphaToCoverage&&(a.alphaToCoverage=e.alphaToCoverage),void 0!==e.premultipliedAlpha&&(a.premultipliedAlpha=e.premultipliedAlpha),void 0!==e.visible&&(a.visible=e.visible),void 0!==e.toneMapped&&(a.toneMapped=e.toneMapped),void 0!==e.userData&&(a.userData=e.userData),void 0!==e.vertexColors&&("number"===typeof e.vertexColors?a.vertexColors=e.vertexColors>0:a.vertexColors=e.vertexColors),void 0!==e.uniforms)for(var i in e.uniforms){var o=e.uniforms[i];switch(a.uniforms[i]={},o.type){case"t":a.uniforms[i].value=r(o.value);break;case"c":a.uniforms[i].value=(new Oke).setHex(o.value);break;case"v2":a.uniforms[i].value=(new yke).fromArray(o.value);break;case"v3":a.uniforms[i].value=(new Yke).fromArray(o.value);break;case"v4":a.uniforms[i].value=(new Vke).fromArray(o.value);break;case"m3":a.uniforms[i].value=(new bke).fromArray(o.value);break;case"m4":a.uniforms[i].value=(new Twe).fromArray(o.value);break;default:a.uniforms[i].value=o.value}}if(void 0!==e.defines&&(a.defines=e.defines),void 0!==e.vertexShader&&(a.vertexShader=e.vertexShader),void 0!==e.fragmentShader&&(a.fragmentShader=e.fragmentShader),void 0!==e.extensions)for(var s in e.extensions)a.extensions[s]=e.extensions[s];if(void 0!==e.shading&&(a.flatShading=1===e.shading),void 0!==e.size&&(a.size=e.size),void 0!==e.sizeAttenuation&&(a.sizeAttenuation=e.sizeAttenuation),void 0!==e.map&&(a.map=r(e.map)),void 0!==e.matcap&&(a.matcap=r(e.matcap)),void 0!==e.alphaMap&&(a.alphaMap=r(e.alphaMap)),void 0!==e.bumpMap&&(a.bumpMap=r(e.bumpMap)),void 0!==e.bumpScale&&(a.bumpScale=e.bumpScale),void 0!==e.normalMap&&(a.normalMap=r(e.normalMap)),void 0!==e.normalMapType&&(a.normalMapType=e.normalMapType),void 0!==e.normalScale){var u=e.normalScale;!1===Array.isArray(u)&&(u=[u,u]),a.normalScale=(new yke).fromArray(u)}return void 0!==e.displacementMap&&(a.displacementMap=r(e.displacementMap)),void 0!==e.displacementScale&&(a.displacementScale=e.displacementScale),void 0!==e.displacementBias&&(a.displacementBias=e.displacementBias),void 0!==e.roughnessMap&&(a.roughnessMap=r(e.roughnessMap)),void 0!==e.metalnessMap&&(a.metalnessMap=r(e.metalnessMap)),void 0!==e.emissiveMap&&(a.emissiveMap=r(e.emissiveMap)),void 0!==e.emissiveIntensity&&(a.emissiveIntensity=e.emissiveIntensity),void 0!==e.specularMap&&(a.specularMap=r(e.specularMap)),void 0!==e.specularIntensityMap&&(a.specularIntensityMap=r(e.specularIntensityMap)),void 0!==e.specularColorMap&&(a.specularColorMap=r(e.specularColorMap)),void 0!==e.envMap&&(a.envMap=r(e.envMap)),void 0!==e.envMapIntensity&&(a.envMapIntensity=e.envMapIntensity),void 0!==e.reflectivity&&(a.reflectivity=e.reflectivity),void 0!==e.refractionRatio&&(a.refractionRatio=e.refractionRatio),void 0!==e.lightMap&&(a.lightMap=r(e.lightMap)),void 0!==e.lightMapIntensity&&(a.lightMapIntensity=e.lightMapIntensity),void 0!==e.aoMap&&(a.aoMap=r(e.aoMap)),void 0!==e.aoMapIntensity&&(a.aoMapIntensity=e.aoMapIntensity),void 0!==e.gradientMap&&(a.gradientMap=r(e.gradientMap)),void 0!==e.clearcoatMap&&(a.clearcoatMap=r(e.clearcoatMap)),void 0!==e.clearcoatRoughnessMap&&(a.clearcoatRoughnessMap=r(e.clearcoatRoughnessMap)),void 0!==e.clearcoatNormalMap&&(a.clearcoatNormalMap=r(e.clearcoatNormalMap)),void 0!==e.clearcoatNormalScale&&(a.clearcoatNormalScale=(new yke).fromArray(e.clearcoatNormalScale)),void 0!==e.iridescenceMap&&(a.iridescenceMap=r(e.iridescenceMap)),void 0!==e.iridescenceThicknessMap&&(a.iridescenceThicknessMap=r(e.iridescenceThicknessMap)),void 0!==e.transmissionMap&&(a.transmissionMap=r(e.transmissionMap)),void 0!==e.thicknessMap&&(a.thicknessMap=r(e.thicknessMap)),void 0!==e.sheenColorMap&&(a.sheenColorMap=r(e.sheenColorMap)),void 0!==e.sheenRoughnessMap&&(a.sheenRoughnessMap=r(e.sheenRoughnessMap)),a}},{key:"setTextures",value:function(e){return this.textures=e,this}}],[{key:"createMaterialFromType",value:function(e){return new{ShadowMaterial:NAe,SpriteMaterial:aEe,RawShaderMaterial:RAe,ShaderMaterial:nSe,PointsMaterial:QEe,MeshPhysicalMaterial:PAe,MeshStandardMaterial:DAe,MeshPhongMaterial:OAe,MeshToonMaterial:LAe,MeshNormalMaterial:FAe,MeshLambertMaterial:zAe,MeshDepthMaterial:OTe,MeshDistanceMaterial:LTe,MeshBasicMaterial:h_e,MeshMatcapMaterial:BAe,LineDashedMaterial:UAe,LineBasicMaterial:BEe,Material:l_e}[e]}}]),n}(oMe),OMe=function(){function e(){$n(this,e)}return Jn(e,null,[{key:"decodeText",value:function(e){if("undefined"!==typeof TextDecoder)return(new TextDecoder).decode(e);for(var t="",n=0,r=e.length;n<r;n++)t+=String.fromCharCode(e[n]);try{return decodeURIComponent(escape(t))}catch(a){return t}}},{key:"extractUrlBase",value:function(e){var t=e.lastIndexOf("/");return-1===t?"./":e.slice(0,t+1)}},{key:"resolveURL",value:function(e,t){return"string"!==typeof e||""===e?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}]),e}(),LMe=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this)).isInstancedBufferGeometry=!0,e.type="InstancedBufferGeometry",e.instanceCount=1/0,e}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.instanceCount=e.instanceCount,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"toJSON",value:function(){var e=ja(nr(n.prototype),"toJSON",this).call(this,this);return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}]),n}(R_e),FMe=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new uMe(a.manager);i.setPath(a.path),i.setRequestHeader(a.requestHeader),i.setWithCredentials(a.withCredentials),i.load(e,(function(n){try{t(a.parse(JSON.parse(n)))}catch(i){r?r(i):console.error(i),a.manager.itemError(e)}}),n,r)}},{key:"parse",value:function(e){var t={},n={};function r(e,r){if(void 0!==t[r])return t[r];var a=e.interleavedBuffers[r],i=function(e,t){if(void 0!==n[t])return n[t];var r=e.arrayBuffers[t],a=new Uint32Array(r).buffer;return n[t]=a,a}(e,a.buffer),o=wke(a.type,i),s=new tEe(o,a.stride);return s.uuid=a.uuid,t[r]=s,s}var a=e.isInstancedBufferGeometry?new LMe:new R_e,i=e.data.index;if(void 0!==i){var o=wke(i.type,i.array);a.setIndex(new p_e(o,1))}var s=e.data.attributes;for(var u in s){var c=s[u],l=void 0;if(c.isInterleavedBufferAttribute){var h=r(e.data,c.data);l=new rEe(h,c.itemSize,c.offset,c.normalized)}else{var f=wke(c.type,c.array);l=new(c.isInstancedBufferAttribute?DEe:p_e)(f,c.itemSize,c.normalized)}void 0!==c.name&&(l.name=c.name),void 0!==c.usage&&l.setUsage(c.usage),void 0!==c.updateRange&&(l.updateRange.offset=c.updateRange.offset,l.updateRange.count=c.updateRange.count),a.setAttribute(u,l)}var d=e.data.morphAttributes;if(d)for(var p in d){for(var v=d[p],m=[],g=0,y=v.length;g<y;g++){var b=v[g],x=void 0;if(b.isInterleavedBufferAttribute){var k=r(e.data,b.data);x=new rEe(k,b.itemSize,b.offset,b.normalized)}else{var w=wke(b.type,b.array);x=new p_e(w,b.itemSize,b.normalized)}void 0!==b.name&&(x.name=b.name),m.push(x)}a.morphAttributes[p]=m}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);var _=e.data.groups||e.data.drawcalls||e.data.offsets;if(void 0!==_)for(var S=0,C=_.length;S!==C;++S){var T=_[S];a.addGroup(T.start,T.count,T.materialIndex)}var E=e.data.boundingSphere;if(void 0!==E){var I=new Yke;void 0!==E.center&&I.fromArray(E.center),a.boundingSphere=new gwe(I,E.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}]),n}(oMe),zMe=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"load",value:function(e,t,n,r){var a=this,i=""===this.path?OMe.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;var o=new uMe(this.manager);o.setPath(this.path),o.setRequestHeader(this.requestHeader),o.setWithCredentials(this.withCredentials),o.load(e,(function(n){var i=null;try{i=JSON.parse(n)}catch(s){return void 0!==r&&r(s),void console.error("THREE:ObjectLoader: Can't parse "+e+".",s.message)}var o=i.metadata;void 0!==o&&void 0!==o.type&&"geometry"!==o.type.toLowerCase()?a.parse(i,t):console.error("THREE.ObjectLoader: Can't load "+e)}),n,r)}},{key:"loadAsync",value:function(){var e=ns(es().mark((function e(t,n){var r,a,i,o,s,u;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this,a=""===this.path?OMe.extractUrlBase(t):this.path,this.resourcePath=this.resourcePath||a,(i=new uMe(this.manager)).setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),e.next=9,i.loadAsync(t,n);case 9:if(o=e.sent,s=JSON.parse(o),void 0!==(u=s.metadata)&&void 0!==u.type&&"geometry"!==u.type.toLowerCase()){e.next=14;break}throw new Error("THREE.ObjectLoader: Can't load "+t);case 14:return e.next=16,r.parseAsync(s);case 16:return e.abrupt("return",e.sent);case 17:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"parse",value:function(e,t){var n=this.parseAnimations(e.animations),r=this.parseShapes(e.shapes),a=this.parseGeometries(e.geometries,r),i=this.parseImages(e.images,(function(){void 0!==t&&t(u)})),o=this.parseTextures(e.textures,i),s=this.parseMaterials(e.materials,o),u=this.parseObject(e.object,a,s,o,n),c=this.parseSkeletons(e.skeletons,u);if(this.bindSkeletons(u,c),void 0!==t){var l=!1;for(var h in i)if(i[h].data instanceof HTMLImageElement){l=!0;break}!1===l&&t(u)}return u}},{key:"parseAsync",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,s,u,c;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.parseAnimations(t.animations),r=this.parseShapes(t.shapes),a=this.parseGeometries(t.geometries,r),e.next=5,this.parseImagesAsync(t.images);case 5:return i=e.sent,o=this.parseTextures(t.textures,i),s=this.parseMaterials(t.materials,o),u=this.parseObject(t.object,a,s,o,n),c=this.parseSkeletons(t.skeletons,u),this.bindSkeletons(u,c),e.abrupt("return",u);case 12:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parseShapes",value:function(e){var t={};if(void 0!==e)for(var n=0,r=e.length;n<r;n++){var a=(new VIe).fromJSON(e[n]);t[a.uuid]=a}return t}},{key:"parseSkeletons",value:function(e,t){var n={},r={};if(t.traverse((function(e){e.isBone&&(r[e.uuid]=e)})),void 0!==e)for(var a=0,i=e.length;a<i;a++){var o=(new REe).fromJSON(e[a],r);n[o.uuid]=o}return n}},{key:"parseGeometries",value:function(e,t){var n={};if(void 0!==e)for(var r=new FMe,a=0,i=e.length;a<i;a++){var o=void 0,s=e[a];switch(s.type){case"BufferGeometry":case"InstancedBufferGeometry":o=r.parse(s);break;case"Geometry":console.error("THREE.ObjectLoader: The legacy Geometry type is no longer supported.");break;default:s.type in MAe?o=MAe[s.type].fromJSON(s,t):console.warn('THREE.ObjectLoader: Unsupported geometry type "'.concat(s.type,'"'))}o.uuid=s.uuid,void 0!==s.name&&(o.name=s.name),!0===o.isBufferGeometry&&void 0!==s.userData&&(o.userData=s.userData),n[s.uuid]=o}return n}},{key:"parseMaterials",value:function(e,t){var n={},r={};if(void 0!==e){var a=new PMe;a.setTextures(t);for(var i=0,o=e.length;i<o;i++){var s=e[i];if("MultiMaterial"===s.type){for(var u=[],c=0;c<s.materials.length;c++){var l=s.materials[c];void 0===n[l.uuid]&&(n[l.uuid]=a.parse(l)),u.push(n[l.uuid])}r[s.uuid]=u}else void 0===n[s.uuid]&&(n[s.uuid]=a.parse(s)),r[s.uuid]=n[s.uuid]}}return r}},{key:"parseAnimations",value:function(e){var t={};if(void 0!==e)for(var n=0;n<e.length;n++){var r=e[n],a=eMe.parse(r);t[a.uuid]=a}return t}},{key:"parseImages",value:function(e,t){var n,r=this,a={};function i(e){if("string"===typeof e){var t=e;return function(e){return r.manager.itemStart(e),n.load(e,(function(){r.manager.itemEnd(e)}),void 0,(function(){r.manager.itemError(e),r.manager.itemEnd(e)}))}(/^(\/\/)|([a-z]+:(\/\/)?)/i.test(t)?t:r.resourcePath+t)}return e.data?{data:wke(e.type,e.data),width:e.width,height:e.height}:null}if(void 0!==e&&e.length>0){var o=new aMe(t);(n=new hMe(o)).setCrossOrigin(this.crossOrigin);for(var s=0,u=e.length;s<u;s++){var c=e[s],l=c.url;if(Array.isArray(l)){for(var h=[],f=0,d=l.length;f<d;f++){var p=i(l[f]);null!==p&&(p instanceof HTMLImageElement?h.push(p):h.push(new AEe(p.data,p.width,p.height)))}a[c.uuid]=new Fke(h)}else{var v=i(c.url);a[c.uuid]=new Fke(v)}}}return a}},{key:"parseImagesAsync",value:function(){var e=ns(es().mark((function e(t){var n,r,a,i,o,s,u,c,l,h,f,d,p,v,m;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=function(){return o=ns(es().mark((function e(t){var r,i;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("string"!==typeof t){e.next=8;break}return i=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(r=t)?r:n.resourcePath+r,e.next=5,a.loadAsync(i);case 5:return e.abrupt("return",e.sent);case 8:if(!t.data){e.next=12;break}return e.abrupt("return",{data:wke(t.type,t.data),width:t.width,height:t.height});case 12:return e.abrupt("return",null);case 13:case"end":return e.stop()}}),e)}))),o.apply(this,arguments)},i=function(e){return o.apply(this,arguments)},n=this,r={},!(void 0!==t&&t.length>0)){e.next=33;break}(a=new hMe(this.manager)).setCrossOrigin(this.crossOrigin),s=0,u=t.length;case 8:if(!(s<u)){e.next=33;break}if(c=t[s],l=c.url,!Array.isArray(l)){e.next=26;break}h=[],f=0,d=l.length;case 14:if(!(f<d)){e.next=23;break}return p=l[f],e.next=18,i(p);case 18:null!==(v=e.sent)&&(v instanceof HTMLImageElement?h.push(v):h.push(new AEe(v.data,v.width,v.height)));case 20:f++,e.next=14;break;case 23:r[c.uuid]=new Fke(h),e.next=30;break;case 26:return e.next=28,i(c.url);case 28:m=e.sent,r[c.uuid]=new Fke(m);case 30:s++,e.next=8;break;case 33:return e.abrupt("return",r);case 34:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"parseTextures",value:function(e,t){function n(e,t){return"number"===typeof e?e:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",e),t[e])}var r={};if(void 0!==e)for(var a=0,i=e.length;a<i;a++){var o=e[a];void 0===o.image&&console.warn('THREE.ObjectLoader: No "image" specified for',o.uuid),void 0===t[o.image]&&console.warn("THREE.ObjectLoader: Undefined image",o.image);var s=t[o.image],u=s.data,c=void 0;Array.isArray(u)?(c=new sSe,6===u.length&&(c.needsUpdate=!0)):(c=u&&u.data?new AEe:new Uke,u&&(c.needsUpdate=!0)),c.source=s,c.uuid=o.uuid,void 0!==o.name&&(c.name=o.name),void 0!==o.mapping&&(c.mapping=n(o.mapping,BMe)),void 0!==o.offset&&c.offset.fromArray(o.offset),void 0!==o.repeat&&c.repeat.fromArray(o.repeat),void 0!==o.center&&c.center.fromArray(o.center),void 0!==o.rotation&&(c.rotation=o.rotation),void 0!==o.wrap&&(c.wrapS=n(o.wrap[0],UMe),c.wrapT=n(o.wrap[1],UMe)),void 0!==o.format&&(c.format=o.format),void 0!==o.type&&(c.type=o.type),void 0!==o.encoding&&(c.encoding=o.encoding),void 0!==o.minFilter&&(c.minFilter=n(o.minFilter,VMe)),void 0!==o.magFilter&&(c.magFilter=n(o.magFilter,VMe)),void 0!==o.anisotropy&&(c.anisotropy=o.anisotropy),void 0!==o.flipY&&(c.flipY=o.flipY),void 0!==o.premultiplyAlpha&&(c.premultiplyAlpha=o.premultiplyAlpha),void 0!==o.unpackAlignment&&(c.unpackAlignment=o.unpackAlignment),void 0!==o.userData&&(c.userData=o.userData),r[o.uuid]=c}return r}},{key:"parseObject",value:function(e,t,n,r,a){var i,o,s;function u(e){return void 0===t[e]&&console.warn("THREE.ObjectLoader: Undefined geometry",e),t[e]}function c(e){if(void 0!==e){if(Array.isArray(e)){for(var t=[],r=0,a=e.length;r<a;r++){var i=e[r];void 0===n[i]&&console.warn("THREE.ObjectLoader: Undefined material",i),t.push(n[i])}return t}return void 0===n[e]&&console.warn("THREE.ObjectLoader: Undefined material",e),n[e]}}function l(e){return void 0===r[e]&&console.warn("THREE.ObjectLoader: Undefined texture",e),r[e]}switch(e.type){case"Scene":i=new eEe,void 0!==e.background&&(Number.isInteger(e.background)?i.background=new Oke(e.background):i.background=l(e.background)),void 0!==e.environment&&(i.environment=l(e.environment)),void 0!==e.fog&&("Fog"===e.fog.type?i.fog=new $Te(e.fog.color,e.fog.near,e.fog.far):"FogExp2"===e.fog.type&&(i.fog=new JTe(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new aSe(e.fov,e.aspect,e.near,e.far),void 0!==e.focus&&(i.focus=e.focus),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.filmGauge&&(i.filmGauge=e.filmGauge),void 0!==e.filmOffset&&(i.filmOffset=e.filmOffset),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new ISe(e.left,e.right,e.top,e.bottom,e.near,e.far),void 0!==e.zoom&&(i.zoom=e.zoom),void 0!==e.view&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new MMe(e.color,e.intensity);break;case"DirectionalLight":i=new AMe(e.color,e.intensity);break;case"PointLight":i=new EMe(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new NMe(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new wMe(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new mMe(e.color,e.groundColor,e.intensity);break;case"LightProbe":i=(new DMe).fromJSON(e);break;case"SkinnedMesh":o=u(e.geometry),s=c(e.material),i=new EEe(o,s),void 0!==e.bindMode&&(i.bindMode=e.bindMode),void 0!==e.bindMatrix&&i.bindMatrix.fromArray(e.bindMatrix),void 0!==e.skeleton&&(i.skeleton=e.skeleton);break;case"Mesh":o=u(e.geometry),s=c(e.material),i=new Q_e(o,s);break;case"InstancedMesh":o=u(e.geometry),s=c(e.material);var h=e.count,f=e.instanceMatrix,d=e.instanceColor;(i=new zEe(o,s,h)).instanceMatrix=new DEe(new Float32Array(f.array),16),void 0!==d&&(i.instanceColor=new DEe(new Float32Array(d.array),d.itemSize));break;case"LOD":i=new kEe;break;case"Line":i=new qEe(u(e.geometry),c(e.material));break;case"LineLoop":i=new YEe(u(e.geometry),c(e.material));break;case"LineSegments":i=new KEe(u(e.geometry),c(e.material));break;case"PointCloud":case"Points":i=new tIe(u(e.geometry),c(e.material));break;case"Sprite":i=new gEe(c(e.material));break;case"Group":i=new WTe;break;case"Bone":i=new IEe;break;default:i=new Zwe}if(i.uuid=e.uuid,void 0!==e.name&&(i.name=e.name),void 0!==e.matrix?(i.matrix.fromArray(e.matrix),void 0!==e.matrixAutoUpdate&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(void 0!==e.position&&i.position.fromArray(e.position),void 0!==e.rotation&&i.rotation.fromArray(e.rotation),void 0!==e.quaternion&&i.quaternion.fromArray(e.quaternion),void 0!==e.scale&&i.scale.fromArray(e.scale)),void 0!==e.castShadow&&(i.castShadow=e.castShadow),void 0!==e.receiveShadow&&(i.receiveShadow=e.receiveShadow),e.shadow&&(void 0!==e.shadow.bias&&(i.shadow.bias=e.shadow.bias),void 0!==e.shadow.normalBias&&(i.shadow.normalBias=e.shadow.normalBias),void 0!==e.shadow.radius&&(i.shadow.radius=e.shadow.radius),void 0!==e.shadow.mapSize&&i.shadow.mapSize.fromArray(e.shadow.mapSize),void 0!==e.shadow.camera&&(i.shadow.camera=this.parseObject(e.shadow.camera))),void 0!==e.visible&&(i.visible=e.visible),void 0!==e.frustumCulled&&(i.frustumCulled=e.frustumCulled),void 0!==e.renderOrder&&(i.renderOrder=e.renderOrder),void 0!==e.userData&&(i.userData=e.userData),void 0!==e.layers&&(i.layers.mask=e.layers),void 0!==e.children)for(var p=e.children,v=0;v<p.length;v++)i.add(this.parseObject(p[v],t,n,r,a));if(void 0!==e.animations)for(var m=e.animations,g=0;g<m.length;g++){var y=m[g];i.animations.push(a[y])}if("LOD"===e.type){void 0!==e.autoUpdate&&(i.autoUpdate=e.autoUpdate);for(var b=e.levels,x=0;x<b.length;x++){var k=b[x],w=i.getObjectByProperty("uuid",k.object);void 0!==w&&i.addLevel(w,k.distance)}}return i}},{key:"bindSkeletons",value:function(e,t){0!==Object.keys(t).length&&e.traverse((function(e){if(!0===e.isSkinnedMesh&&void 0!==e.skeleton){var n=t[e.skeleton];void 0===n?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",e.skeleton):e.bind(n,e.bindMatrix)}}))}},{key:"setTexturePath",value:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}]),n}(oMe),BMe={UVMapping:Kye,CubeReflectionMapping:Yye,CubeRefractionMapping:Qye,EquirectangularReflectionMapping:Zye,EquirectangularRefractionMapping:Jye,CubeUVReflectionMapping:$ye},UMe={RepeatWrapping:ebe,ClampToEdgeWrapping:tbe,MirroredRepeatWrapping:nbe},VMe={NearestFilter:rbe,NearestMipmapNearestFilter:abe,NearestMipmapLinearFilter:obe,LinearFilter:ube,LinearMipmapNearestFilter:cbe,LinearMipmapLinearFilter:hbe},WMe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).isImageBitmapLoader=!0,"undefined"===typeof createImageBitmap&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),"undefined"===typeof fetch&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),r.options={premultiplyAlpha:"none"},r}return Jn(n,[{key:"setOptions",value:function(e){return this.options=e,this}},{key:"load",value:function(e,t,n,r){void 0===e&&(e=""),void 0!==this.path&&(e=this.path+e),e=this.manager.resolveURL(e);var a=this,i=rMe.get(e);if(void 0!==i)return a.manager.itemStart(e),setTimeout((function(){t&&t(i),a.manager.itemEnd(e)}),0),i;var o={};o.credentials="anonymous"===this.crossOrigin?"same-origin":"include",o.headers=this.requestHeader,fetch(e,o).then((function(e){return e.blob()})).then((function(e){return createImageBitmap(e,Object.assign(a.options,{colorSpaceConversion:"none"}))})).then((function(n){rMe.add(e,n),t&&t(n),a.manager.itemEnd(e)})).catch((function(t){r&&r(t),a.manager.itemError(e),a.manager.itemEnd(e)})),a.manager.itemStart(e)}}]),n}(oMe),GMe={getContext:function(){return void 0===nMe&&(nMe=new(window.AudioContext||window.webkitAudioContext)),nMe},setContext:function(e){nMe=e}},jMe=function(e){tr(n,e);var t=sr(n);function n(e){return $n(this,n),t.call(this,e)}return Jn(n,[{key:"load",value:function(e,t,n,r){var a=this,i=new uMe(this.manager);i.setResponseType("arraybuffer"),i.setPath(this.path),i.setRequestHeader(this.requestHeader),i.setWithCredentials(this.withCredentials),i.load(e,(function(n){try{var i=n.slice(0);GMe.getContext().decodeAudioData(i,(function(e){t(e)}))}catch(o){r?r(o):console.error(o),a.manager.itemError(e)}}),n,r)}}]),n}(oMe),qMe=function(e){tr(n,e);var t=sr(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;$n(this,n),(a=t.call(this,void 0,i)).isHemisphereLightProbe=!0;var o=(new Oke).set(e),s=(new Oke).set(r),u=new Yke(o.r,o.g,o.b),c=new Yke(s.r,s.g,s.b),l=Math.sqrt(Math.PI),h=l*Math.sqrt(.75);return a.sh.coefficients[0].copy(u).add(c).multiplyScalar(l),a.sh.coefficients[1].copy(u).sub(c).multiplyScalar(h),a}return Jn(n)}(DMe),HMe=function(e){tr(n,e);var t=sr(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;$n(this,n),(r=t.call(this,void 0,a)).isAmbientLightProbe=!0;var i=(new Oke).set(e);return r.sh.coefficients[0].set(i.r,i.g,i.b).multiplyScalar(2*Math.sqrt(Math.PI)),r}return Jn(n)}(DMe),XMe=new Twe,KMe=new Twe,YMe=new Twe,QMe=function(){function e(){$n(this,e),this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new aSe,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new aSe,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}return Jn(e,[{key:"update",value:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,YMe.copy(e.projectionMatrix);var n,r,a=t.eyeSep/2,i=a*t.near/t.focus,o=t.near*Math.tan(uke*t.fov*.5)/t.zoom;KMe.elements[12]=-a,XMe.elements[12]=a,n=-o*t.aspect+i,r=o*t.aspect+i,YMe.elements[0]=2*t.near/(r-n),YMe.elements[8]=(r+n)/(r-n),this.cameraL.projectionMatrix.copy(YMe),n=-o*t.aspect-i,r=o*t.aspect-i,YMe.elements[0]=2*t.near/(r-n),YMe.elements[8]=(r+n)/(r-n),this.cameraR.projectionMatrix.copy(YMe)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(KMe),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(XMe)}}]),e}(),ZMe=function(){function e(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];$n(this,e),this.autoStart=t,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}return Jn(e,[{key:"start",value:function(){this.startTime=JMe(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=JMe();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}]),e}();function JMe(){return("undefined"===typeof performance?Date:performance).now()}var $Me=new Yke,eNe=new Kke,tNe=new Yke,nNe=new Yke,rNe=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this)).type="AudioListener",e.context=GMe.getContext(),e.gain=e.context.createGain(),e.gain.connect(e.context.destination),e.filter=null,e.timeDelta=0,e._clock=new ZMe,e}return Jn(n,[{key:"getInput",value:function(){return this.gain}},{key:"removeFilter",value:function(){return null!==this.filter&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}},{key:"getFilter",value:function(){return this.filter}},{key:"setFilter",value:function(e){return null!==this.filter?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}},{key:"getMasterVolume",value:function(){return this.gain.gain.value}},{key:"setMasterVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}},{key:"updateMatrixWorld",value:function(e){ja(nr(n.prototype),"updateMatrixWorld",this).call(this,e);var t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose($Me,eNe,tNe),nNe.set(0,0,-1).applyQuaternion(eNe),t.positionX){var a=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime($Me.x,a),t.positionY.linearRampToValueAtTime($Me.y,a),t.positionZ.linearRampToValueAtTime($Me.z,a),t.forwardX.linearRampToValueAtTime(nNe.x,a),t.forwardY.linearRampToValueAtTime(nNe.y,a),t.forwardZ.linearRampToValueAtTime(nNe.z,a),t.upX.linearRampToValueAtTime(r.x,a),t.upY.linearRampToValueAtTime(r.y,a),t.upZ.linearRampToValueAtTime(r.z,a)}else t.setPosition($Me.x,$Me.y,$Me.z),t.setOrientation(nNe.x,nNe.y,nNe.z,r.x,r.y,r.z)}}]),n}(Zwe),aNe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this)).type="Audio",r.listener=e,r.context=e.context,r.gain=r.context.createGain(),r.gain.connect(e.getInput()),r.autoplay=!1,r.buffer=null,r.detune=0,r.loop=!1,r.loopStart=0,r.loopEnd=0,r.offset=0,r.duration=void 0,r.playbackRate=1,r.isPlaying=!1,r.hasPlaybackControl=!0,r.source=null,r.sourceType="empty",r._startedAt=0,r._progress=0,r._connected=!1,r.filters=[],r}return Jn(n,[{key:"getOutput",value:function(){return this.gain}},{key:"setNodeSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}},{key:"setMediaElementSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}},{key:"setMediaStreamSource",value:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}},{key:"setBuffer",value:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}},{key:"play",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;if(!0!==this.isPlaying){if(!1!==this.hasPlaybackControl){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")}},{key:"pause",value:function(){if(!1!==this.hasPlaybackControl)return!0===this.isPlaying&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,!0===this.loop&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"stop",value:function(){if(!1!==this.hasPlaybackControl)return this._progress=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"connect",value:function(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}},{key:"disconnect",value:function(){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}},{key:"getFilters",value:function(){return this.filters}},{key:"setFilters",value:function(e){return e||(e=[]),!0===this._connected?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}},{key:"setDetune",value:function(e){if(this.detune=e,void 0!==this.source.detune)return!0===this.isPlaying&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}},{key:"getDetune",value:function(){return this.detune}},{key:"getFilter",value:function(){return this.getFilters()[0]}},{key:"setFilter",value:function(e){return this.setFilters(e?[e]:[])}},{key:"setPlaybackRate",value:function(e){if(!1!==this.hasPlaybackControl)return this.playbackRate=e,!0===this.isPlaying&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"getPlaybackRate",value:function(){return this.playbackRate}},{key:"onEnded",value:function(){this.isPlaying=!1}},{key:"getLoop",value:function(){return!1===this.hasPlaybackControl?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}},{key:"setLoop",value:function(e){if(!1!==this.hasPlaybackControl)return this.loop=e,!0===this.isPlaying&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")}},{key:"setLoopStart",value:function(e){return this.loopStart=e,this}},{key:"setLoopEnd",value:function(e){return this.loopEnd=e,this}},{key:"getVolume",value:function(){return this.gain.gain.value}},{key:"setVolume",value:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}}]),n}(Zwe),iNe=new Yke,oNe=new Kke,sNe=new Yke,uNe=new Yke,cNe=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this,e)).panner=r.context.createPanner(),r.panner.panningModel="HRTF",r.panner.connect(r.gain),r}return Jn(n,[{key:"disconnect",value:function(){ja(nr(n.prototype),"disconnect",this).call(this),this.panner.disconnect(this.gain)}},{key:"getOutput",value:function(){return this.panner}},{key:"getRefDistance",value:function(){return this.panner.refDistance}},{key:"setRefDistance",value:function(e){return this.panner.refDistance=e,this}},{key:"getRolloffFactor",value:function(){return this.panner.rolloffFactor}},{key:"setRolloffFactor",value:function(e){return this.panner.rolloffFactor=e,this}},{key:"getDistanceModel",value:function(){return this.panner.distanceModel}},{key:"setDistanceModel",value:function(e){return this.panner.distanceModel=e,this}},{key:"getMaxDistance",value:function(){return this.panner.maxDistance}},{key:"setMaxDistance",value:function(e){return this.panner.maxDistance=e,this}},{key:"setDirectionalCone",value:function(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}},{key:"updateMatrixWorld",value:function(e){if(ja(nr(n.prototype),"updateMatrixWorld",this).call(this,e),!0!==this.hasPlaybackControl||!1!==this.isPlaying){this.matrixWorld.decompose(iNe,oNe,sNe),uNe.set(0,0,1).applyQuaternion(oNe);var t=this.panner;if(t.positionX){var r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(iNe.x,r),t.positionY.linearRampToValueAtTime(iNe.y,r),t.positionZ.linearRampToValueAtTime(iNe.z,r),t.orientationX.linearRampToValueAtTime(uNe.x,r),t.orientationY.linearRampToValueAtTime(uNe.y,r),t.orientationZ.linearRampToValueAtTime(uNe.z,r)}else t.setPosition(iNe.x,iNe.y,iNe.z),t.setOrientation(uNe.x,uNe.y,uNe.z)}}}]),n}(aNe),lNe=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2048;$n(this,e),this.analyser=t.context.createAnalyser(),this.analyser.fftSize=n,this.data=new Uint8Array(this.analyser.frequencyBinCount),t.getOutput().connect(this.analyser)}return Jn(e,[{key:"getFrequencyData",value:function(){return this.analyser.getByteFrequencyData(this.data),this.data}},{key:"getAverageFrequency",value:function(){for(var e=0,t=this.getFrequencyData(),n=0;n<t.length;n++)e+=t[n];return e/t.length}}]),e}(),hNe=function(){function e(t,n,r){var a,i,o;switch($n(this,e),this.binding=t,this.valueSize=r,n){case"quaternion":a=this._slerp,i=this._slerpAdditive,o=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(6*r),this._workIndex=5;break;case"string":case"bool":a=this._select,i=this._select,o=this._setAdditiveIdentityOther,this.buffer=new Array(5*r);break;default:a=this._lerp,i=this._lerpAdditive,o=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(5*r)}this._mixBufferRegion=a,this._mixBufferRegionAdditive=i,this._setIdentity=o,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}return Jn(e,[{key:"accumulate",value:function(e,t){var n=this.buffer,r=this.valueSize,a=e*r+r,i=this.cumulativeWeight;if(0===i){for(var o=0;o!==r;++o)n[a+o]=n[o];i=t}else{var s=t/(i+=t);this._mixBufferRegion(n,a,0,s,r)}this.cumulativeWeight=i}},{key:"accumulateAdditive",value:function(e){var t=this.buffer,n=this.valueSize,r=n*this._addIndex;0===this.cumulativeWeightAdditive&&this._setIdentity(),this._mixBufferRegionAdditive(t,r,0,e,n),this.cumulativeWeightAdditive+=e}},{key:"apply",value:function(e){var t=this.valueSize,n=this.buffer,r=e*t+t,a=this.cumulativeWeight,i=this.cumulativeWeightAdditive,o=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,a<1){var s=t*this._origIndex;this._mixBufferRegion(n,r,s,1-a,t)}i>0&&this._mixBufferRegionAdditive(n,r,this._addIndex*t,1,t);for(var u=t,c=t+t;u!==c;++u)if(n[u]!==n[u+t]){o.setValue(n,r);break}}},{key:"saveOriginalState",value:function(){var e=this.binding,t=this.buffer,n=this.valueSize,r=n*this._origIndex;e.getValue(t,r);for(var a=n,i=r;a!==i;++a)t[a]=t[r+a%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}},{key:"restoreOriginalState",value:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)}},{key:"_setAdditiveIdentityNumeric",value:function(){for(var e=this._addIndex*this.valueSize,t=e+this.valueSize,n=e;n<t;n++)this.buffer[n]=0}},{key:"_setAdditiveIdentityQuaternion",value:function(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}},{key:"_setAdditiveIdentityOther",value:function(){for(var e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize,n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}},{key:"_select",value:function(e,t,n,r,a){if(r>=.5)for(var i=0;i!==a;++i)e[t+i]=e[n+i]}},{key:"_slerp",value:function(e,t,n,r){Kke.slerpFlat(e,t,e,t,e,n,r)}},{key:"_slerpAdditive",value:function(e,t,n,r,a){var i=this._workIndex*a;Kke.multiplyQuaternionsFlat(e,i,e,t,e,n),Kke.slerpFlat(e,t,e,t,e,i,r)}},{key:"_lerp",value:function(e,t,n,r,a){for(var i=1-r,o=0;o!==a;++o){var s=t+o;e[s]=e[s]*i+e[n+o]*r}}},{key:"_lerpAdditive",value:function(e,t,n,r,a){for(var i=0;i!==a;++i){var o=t+i;e[o]=e[o]+e[n+i]*r}}}]),e}(),fNe="\\[\\]\\.:\\/",dNe=new RegExp("[\\[\\]\\.:\\/]","g"),pNe="[^\\[\\]\\.:\\/]",vNe="[^"+fNe.replace("\\.","")+"]",mNe=new RegExp("^"+/((?:WC+[\/:])*)/.source.replace("WC",pNe)+/(WCOD+)?/.source.replace("WCOD",vNe)+/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",pNe)+/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",pNe)+"$"),gNe=["material","materials","bones"],yNe=function(){function e(t,n,r){$n(this,e);var a=r||bNe.parseTrackName(n);this._targetGroup=t,this._bindings=t.subscribe_(n,a)}return Jn(e,[{key:"getValue",value:function(e,t){this.bind();var n=this._targetGroup.nCachedObjects_,r=this._bindings[n];void 0!==r&&r.getValue(e,t)}},{key:"setValue",value:function(e,t){for(var n=this._bindings,r=this._targetGroup.nCachedObjects_,a=n.length;r!==a;++r)n[r].setValue(e,t)}},{key:"bind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}},{key:"unbind",value:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}]),e}(),bNe=function(){function e(t,n,r){$n(this,e),this.path=n,this.parsedPath=r||e.parseTrackName(n),this.node=e.findNode(t,this.parsedPath.nodeName)||t,this.rootNode=t,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}return Jn(e,[{key:"_getValue_unavailable",value:function(){}},{key:"_setValue_unavailable",value:function(){}},{key:"_getValue_direct",value:function(e,t){e[t]=this.targetObject[this.propertyName]}},{key:"_getValue_array",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)e[t++]=n[r]}},{key:"_getValue_arrayElement",value:function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}},{key:"_getValue_toArray",value:function(e,t){this.resolvedProperty.toArray(e,t)}},{key:"_setValue_direct",value:function(e,t){this.targetObject[this.propertyName]=e[t]}},{key:"_setValue_direct_setNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_direct_setMatrixWorldNeedsUpdate",value:function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_array",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)n[r]=e[t++]}},{key:"_setValue_array_setNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)n[r]=e[t++];this.targetObject.needsUpdate=!0}},{key:"_setValue_array_setMatrixWorldNeedsUpdate",value:function(e,t){for(var n=this.resolvedProperty,r=0,a=n.length;r!==a;++r)n[r]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_arrayElement",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}},{key:"_setValue_arrayElement_setNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}},{key:"_setValue_arrayElement_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_setValue_fromArray",value:function(e,t){this.resolvedProperty.fromArray(e,t)}},{key:"_setValue_fromArray_setNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}},{key:"_setValue_fromArray_setMatrixWorldNeedsUpdate",value:function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}},{key:"_getValue_unbound",value:function(e,t){this.bind(),this.getValue(e,t)}},{key:"_setValue_unbound",value:function(e,t){this.bind(),this.setValue(e,t)}},{key:"bind",value:function(){var t=this.node,n=this.parsedPath,r=n.objectName,a=n.propertyName,i=n.propertyIndex;if(t||(t=e.findNode(this.rootNode,n.nodeName)||this.rootNode,this.node=t),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,t){if(r){var o=n.objectIndex;switch(r){case"materials":if(!t.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!t.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);t=t.material.materials;break;case"bones":if(!t.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);t=t.skeleton.bones;for(var s=0;s<t.length;s++)if(t[s].name===o){o=s;break}break;default:if(void 0===t[r])return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);t=t[r]}if(void 0!==o){if(void 0===t[o])return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,t);t=t[o]}}var u=t[a];if(void 0!==u){var c=this.Versioning.None;this.targetObject=t,void 0!==t.needsUpdate?c=this.Versioning.NeedsUpdate:void 0!==t.matrixWorldNeedsUpdate&&(c=this.Versioning.MatrixWorldNeedsUpdate);var l=this.BindingType.Direct;if(void 0!==i){if("morphTargetInfluences"===a){if(!t.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(!t.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);void 0!==t.morphTargetDictionary[i]&&(i=t.morphTargetDictionary[i])}l=this.BindingType.ArrayElement,this.resolvedProperty=u,this.propertyIndex=i}else void 0!==u.fromArray&&void 0!==u.toArray?(l=this.BindingType.HasFromToArray,this.resolvedProperty=u):Array.isArray(u)?(l=this.BindingType.EntireArray,this.resolvedProperty=u):this.propertyName=a;this.getValue=this.GetterByBindingType[l],this.setValue=this.SetterByBindingTypeAndVersioning[l][c]}else{var h=n.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+h+"."+a+" but it wasn't found.",t)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")}},{key:"unbind",value:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}],[{key:"create",value:function(t,n,r){return t&&t.isAnimationObjectGroup?new e.Composite(t,n,r):new e(t,n,r)}},{key:"sanitizeNodeName",value:function(e){return e.replace(/\s/g,"_").replace(dNe,"")}},{key:"parseTrackName",value:function(e){var t=mNe.exec(e);if(null===t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},r=n.nodeName&&n.nodeName.lastIndexOf(".");if(void 0!==r&&-1!==r){var a=n.nodeName.substring(r+1);-1!==gNe.indexOf(a)&&(n.nodeName=n.nodeName.substring(0,r),n.objectName=a)}if(null===n.propertyName||0===n.propertyName.length)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}},{key:"findNode",value:function(e,t){if(void 0===t||""===t||"."===t||-1===t||t===e.name||t===e.uuid)return e;if(e.skeleton){var n=e.skeleton.getBoneByName(t);if(void 0!==n)return n}if(e.children){var r=function e(n){for(var r=0;r<n.length;r++){var a=n[r];if(a.name===t||a.uuid===t)return a;var i=e(a.children);if(i)return i}return null}(e.children);if(r)return r}return null}}]),e}();bNe.Composite=yNe,bNe.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},bNe.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},bNe.prototype.GetterByBindingType=[bNe.prototype._getValue_direct,bNe.prototype._getValue_array,bNe.prototype._getValue_arrayElement,bNe.prototype._getValue_toArray],bNe.prototype.SetterByBindingTypeAndVersioning=[[bNe.prototype._setValue_direct,bNe.prototype._setValue_direct_setNeedsUpdate,bNe.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[bNe.prototype._setValue_array,bNe.prototype._setValue_array_setNeedsUpdate,bNe.prototype._setValue_array_setMatrixWorldNeedsUpdate],[bNe.prototype._setValue_arrayElement,bNe.prototype._setValue_arrayElement_setNeedsUpdate,bNe.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[bNe.prototype._setValue_fromArray,bNe.prototype._setValue_fromArray_setNeedsUpdate,bNe.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];var xNe=function(){function e(){$n(this,e),this.isAnimationObjectGroup=!0,this.uuid=lke(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var t={};this._indicesByUUID=t;for(var n=0,r=arguments.length;n!==r;++n)t[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var a=this;this.stats={objects:{get total(){return a._objects.length},get inUse(){return this.total-a.nCachedObjects_}},get bindingsPerObject(){return a._bindings.length}}}return Jn(e,[{key:"add",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._paths,r=this._parsedPaths,a=this._bindings,i=a.length,o=void 0,s=e.length,u=this.nCachedObjects_,c=0,l=arguments.length;c!==l;++c){var h=arguments[c],f=h.uuid,d=t[f];if(void 0===d){d=s++,t[f]=d,e.push(h);for(var p=0,v=i;p!==v;++p)a[p].push(new bNe(h,n[p],r[p]))}else if(d<u){o=e[d];var m=--u,g=e[m];t[g.uuid]=d,e[d]=g,t[f]=m,e[m]=h;for(var y=0,b=i;y!==b;++y){var x=a[y],k=x[m],w=x[d];x[d]=k,void 0===w&&(w=new bNe(h,n[y],r[y])),x[m]=w}}else e[d]!==o&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=u}},{key:"remove",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length,a=this.nCachedObjects_,i=0,o=arguments.length;i!==o;++i){var s=arguments[i],u=s.uuid,c=t[u];if(void 0!==c&&c>=a){var l=a++,h=e[l];t[h.uuid]=c,e[c]=h,t[u]=l,e[l]=s;for(var f=0,d=r;f!==d;++f){var p=n[f],v=p[l],m=p[c];p[c]=v,p[l]=m}}}this.nCachedObjects_=a}},{key:"uncache",value:function(){for(var e=this._objects,t=this._indicesByUUID,n=this._bindings,r=n.length,a=this.nCachedObjects_,i=e.length,o=0,s=arguments.length;o!==s;++o){var u=arguments[o],c=u.uuid,l=t[c];if(void 0!==l)if(delete t[c],l<a){var h=--a,f=e[h],d=--i,p=e[d];t[f.uuid]=l,e[l]=f,t[p.uuid]=h,e[h]=p,e.pop();for(var v=0,m=r;v!==m;++v){var g=n[v],y=g[h],b=g[d];g[l]=y,g[h]=b,g.pop()}}else{var x=--i,k=e[x];x>0&&(t[k.uuid]=l),e[l]=k,e.pop();for(var w=0,_=r;w!==_;++w){var S=n[w];S[l]=S[x],S.pop()}}}this.nCachedObjects_=a}},{key:"subscribe_",value:function(e,t){var n=this._bindingsIndicesByPath,r=n[e],a=this._bindings;if(void 0!==r)return a[r];var i=this._paths,o=this._parsedPaths,s=this._objects,u=s.length,c=this.nCachedObjects_,l=new Array(u);r=a.length,n[e]=r,i.push(e),o.push(t),a.push(l);for(var h=c,f=s.length;h!==f;++h){var d=s[h];l[h]=new bNe(d,e,t)}return l}},{key:"unsubscribe_",value:function(e){var t=this._bindingsIndicesByPath,n=t[e];if(void 0!==n){var r=this._paths,a=this._parsedPaths,i=this._bindings,o=i.length-1,s=i[o];t[e[o]]=n,i[n]=s,i.pop(),a[n]=a[o],a.pop(),r[n]=r[o],r.pop()}}}]),e}(),kNe=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:n.blendMode;$n(this,e),this._mixer=t,this._clip=n,this._localRoot=r,this.blendMode=a;for(var i=n.tracks,o=i.length,s=new Array(o),u={endingStart:pxe,endingEnd:pxe},c=0;c!==o;++c){var l=i[c].createInterpolant(null);s[c]=l,l.settings=u}this._interpolantSettings=u,this._interpolants=s,this._propertyBindings=new Array(o),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=cxe,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}return Jn(e,[{key:"play",value:function(){return this._mixer._activateAction(this),this}},{key:"stop",value:function(){return this._mixer._deactivateAction(this),this.reset()}},{key:"reset",value:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}},{key:"isRunning",value:function(){return this.enabled&&!this.paused&&0!==this.timeScale&&null===this._startTime&&this._mixer._isActiveAction(this)}},{key:"isScheduled",value:function(){return this._mixer._isActiveAction(this)}},{key:"startAt",value:function(e){return this._startTime=e,this}},{key:"setLoop",value:function(e,t){return this.loop=e,this.repetitions=t,this}},{key:"setEffectiveWeight",value:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}},{key:"getEffectiveWeight",value:function(){return this._effectiveWeight}},{key:"fadeIn",value:function(e){return this._scheduleFading(e,0,1)}},{key:"fadeOut",value:function(e){return this._scheduleFading(e,1,0)}},{key:"crossFadeFrom",value:function(e,t,n){if(e.fadeOut(t),this.fadeIn(t),n){var r=this._clip.duration,a=e._clip.duration,i=a/r,o=r/a;e.warp(1,i,t),this.warp(o,1,t)}return this}},{key:"crossFadeTo",value:function(e,t,n){return e.crossFadeFrom(this,t,n)}},{key:"stopFading",value:function(){var e=this._weightInterpolant;return null!==e&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"setEffectiveTimeScale",value:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}},{key:"getEffectiveTimeScale",value:function(){return this._effectiveTimeScale}},{key:"setDuration",value:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}},{key:"syncWith",value:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}},{key:"halt",value:function(e){return this.warp(this._effectiveTimeScale,0,e)}},{key:"warp",value:function(e,t,n){var r=this._mixer,a=r.time,i=this.timeScale,o=this._timeScaleInterpolant;null===o&&(o=r._lendControlInterpolant(),this._timeScaleInterpolant=o);var s=o.parameterPositions,u=o.sampleValues;return s[0]=a,s[1]=a+n,u[0]=e/i,u[1]=t/i,this}},{key:"stopWarping",value:function(){var e=this._timeScaleInterpolant;return null!==e&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}},{key:"getMixer",value:function(){return this._mixer}},{key:"getClip",value:function(){return this._clip}},{key:"getRoot",value:function(){return this._localRoot||this._mixer._root}},{key:"_update",value:function(e,t,n,r){if(this.enabled){var a=this._startTime;if(null!==a){var i=(e-a)*n;if(i<0||0===n)return;this._startTime=null,t=n*i}t*=this._updateTimeScale(e);var o=this._updateTime(t),s=this._updateWeight(e);if(s>0){var u=this._interpolants,c=this._propertyBindings;if(this.blendMode===yxe)for(var l=0,h=u.length;l!==h;++l)u[l].evaluate(o),c[l].accumulateAdditive(s);else for(var f=0,d=u.length;f!==d;++f)u[f].evaluate(o),c[f].accumulate(r,s)}}else this._updateWeight(e)}},{key:"_updateWeight",value:function(e){var t=0;if(this.enabled){t=this.weight;var n=this._weightInterpolant;if(null!==n){var r=n.evaluate(e)[0];t*=r,e>n.parameterPositions[1]&&(this.stopFading(),0===r&&(this.enabled=!1))}}return this._effectiveWeight=t,t}},{key:"_updateTimeScale",value:function(e){var t=0;if(!this.paused){t=this.timeScale;var n=this._timeScaleInterpolant;if(null!==n)t*=n.evaluate(e)[0],e>n.parameterPositions[1]&&(this.stopWarping(),0===t?this.paused=!0:this.timeScale=t)}return this._effectiveTimeScale=t,t}},{key:"_updateTime",value:function(e){var t=this._clip.duration,n=this.loop,r=this.time+e,a=this._loopCount,i=n===lxe;if(0===e)return-1===a?r:i&&1===(1&a)?t-r:r;if(n===uxe){-1===a&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r>=t)r=t;else{if(!(r<0)){this.time=r;break e}r=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(-1===a&&(e>=0?(a=0,this._setEndings(!0,0===this.repetitions,i)):this._setEndings(0===this.repetitions,!0,i)),r>=t||r<0){var o=Math.floor(r/t);r-=t*o,a+=Math.abs(o);var s=this.repetitions-a;if(s<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,r=e>0?t:0,this.time=r,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(1===s){var u=e<0;this._setEndings(u,!u,i)}else this._setEndings(!1,!1,i);this._loopCount=a,this.time=r,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:o})}}else this.time=r;if(i&&1===(1&a))return t-r}return r}},{key:"_setEndings",value:function(e,t,n){var r=this._interpolantSettings;n?(r.endingStart=vxe,r.endingEnd=vxe):(r.endingStart=e?this.zeroSlopeAtStart?vxe:pxe:mxe,r.endingEnd=t?this.zeroSlopeAtEnd?vxe:pxe:mxe)}},{key:"_scheduleFading",value:function(e,t,n){var r=this._mixer,a=r.time,i=this._weightInterpolant;null===i&&(i=r._lendControlInterpolant(),this._weightInterpolant=i);var o=i.parameterPositions,s=i.sampleValues;return o[0]=a,s[0]=t,o[1]=a+e,s[1]=n,this}}]),e}(),wNe=new Float32Array(1),_Ne=function(e){tr(n,e);var t=sr(n);function n(e){var r;return $n(this,n),(r=t.call(this))._root=e,r._initMemoryManager(),r._accuIndex=0,r.time=0,r.timeScale=1,r}return Jn(n,[{key:"_bindAction",value:function(e,t){var n=e._localRoot||this._root,r=e._clip.tracks,a=r.length,i=e._propertyBindings,o=e._interpolants,s=n.uuid,u=this._bindingsByRootAndName,c=u[s];void 0===c&&(c={},u[s]=c);for(var l=0;l!==a;++l){var h=r[l],f=h.name,d=c[f];if(void 0!==d)++d.referenceCount,i[l]=d;else{if(void 0!==(d=i[l])){null===d._cacheIndex&&(++d.referenceCount,this._addInactiveBinding(d,s,f));continue}var p=t&&t._propertyBindings[l].binding.parsedPath;++(d=new hNe(bNe.create(n,f,p),h.ValueTypeName,h.getValueSize())).referenceCount,this._addInactiveBinding(d,s,f),i[l]=d}o[l].resultBuffer=d.buffer}}},{key:"_activateAction",value:function(e){if(!this._isActiveAction(e)){if(null===e._cacheIndex){var t=(e._localRoot||this._root).uuid,n=e._clip.uuid,r=this._actionsByClip[n];this._bindAction(e,r&&r.knownActions[0]),this._addInactiveAction(e,n,t)}for(var a=e._propertyBindings,i=0,o=a.length;i!==o;++i){var s=a[i];0===s.useCount++&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}},{key:"_deactivateAction",value:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var a=t[n];0===--a.useCount&&(a.restoreOriginalState(),this._takeBackBinding(a))}this._takeBackAction(e)}}},{key:"_initMemoryManager",value:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}},{key:"_isActiveAction",value:function(e){var t=e._cacheIndex;return null!==t&&t<this._nActiveActions}},{key:"_addInactiveAction",value:function(e,t,n){var r=this._actions,a=this._actionsByClip,i=a[t];if(void 0===i)i={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,a[t]=i;else{var o=i.knownActions;e._byClipCacheIndex=o.length,o.push(e)}e._cacheIndex=r.length,r.push(e),i.actionByRoot[n]=e}},{key:"_removeInactiveAction",value:function(e){var t=this._actions,n=t[t.length-1],r=e._cacheIndex;n._cacheIndex=r,t[r]=n,t.pop(),e._cacheIndex=null;var a=e._clip.uuid,i=this._actionsByClip,o=i[a],s=o.knownActions,u=s[s.length-1],c=e._byClipCacheIndex;u._byClipCacheIndex=c,s[c]=u,s.pop(),e._byClipCacheIndex=null,delete o.actionByRoot[(e._localRoot||this._root).uuid],0===s.length&&delete i[a],this._removeInactiveBindingsForAction(e)}},{key:"_removeInactiveBindingsForAction",value:function(e){for(var t=e._propertyBindings,n=0,r=t.length;n!==r;++n){var a=t[n];0===--a.referenceCount&&this._removeInactiveBinding(a)}}},{key:"_lendAction",value:function(e){var t=this._actions,n=e._cacheIndex,r=this._nActiveActions++,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}},{key:"_takeBackAction",value:function(e){var t=this._actions,n=e._cacheIndex,r=--this._nActiveActions,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}},{key:"_addInactiveBinding",value:function(e,t,n){var r=this._bindingsByRootAndName,a=this._bindings,i=r[t];void 0===i&&(i={},r[t]=i),i[n]=e,e._cacheIndex=a.length,a.push(e)}},{key:"_removeInactiveBinding",value:function(e){var t=this._bindings,n=e.binding,r=n.rootNode.uuid,a=n.path,i=this._bindingsByRootAndName,o=i[r],s=t[t.length-1],u=e._cacheIndex;s._cacheIndex=u,t[u]=s,t.pop(),delete o[a],0===Object.keys(o).length&&delete i[r]}},{key:"_lendBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,r=this._nActiveBindings++,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}},{key:"_takeBackBinding",value:function(e){var t=this._bindings,n=e._cacheIndex,r=--this._nActiveBindings,a=t[r];e._cacheIndex=r,t[r]=e,a._cacheIndex=n,t[n]=a}},{key:"_lendControlInterpolant",value:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,n=e[t];return void 0===n&&((n=new jAe(new Float32Array(2),new Float32Array(2),1,wNe)).__cacheIndex=t,e[t]=n),n}},{key:"_takeBackControlInterpolant",value:function(e){var t=this._controlInterpolants,n=e.__cacheIndex,r=--this._nActiveControlInterpolants,a=t[r];e.__cacheIndex=r,t[r]=e,a.__cacheIndex=n,t[n]=a}},{key:"clipAction",value:function(e,t,n){var r=t||this._root,a=r.uuid,i="string"===typeof e?eMe.findByName(r,e):e,o=null!==i?i.uuid:e,s=this._actionsByClip[o],u=null;if(void 0===n&&(n=null!==i?i.blendMode:gxe),void 0!==s){var c=s.actionByRoot[a];if(void 0!==c&&c.blendMode===n)return c;u=s.knownActions[0],null===i&&(i=u._clip)}if(null===i)return null;var l=new kNe(this,i,t,n);return this._bindAction(l,u),this._addInactiveAction(l,o,a),l}},{key:"existingAction",value:function(e,t){var n=t||this._root,r=n.uuid,a="string"===typeof e?eMe.findByName(n,e):e,i=a?a.uuid:e,o=this._actionsByClip[i];return void 0!==o&&o.actionByRoot[r]||null}},{key:"stopAllAction",value:function(){for(var e=this._actions,t=this._nActiveActions-1;t>=0;--t)e[t].stop();return this}},{key:"update",value:function(e){e*=this.timeScale;for(var t=this._actions,n=this._nActiveActions,r=this.time+=e,a=Math.sign(e),i=this._accuIndex^=1,o=0;o!==n;++o){t[o]._update(r,e,a,i)}for(var s=this._bindings,u=this._nActiveBindings,c=0;c!==u;++c)s[c].apply(i);return this}},{key:"setTime",value:function(e){this.time=0;for(var t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}},{key:"getRoot",value:function(){return this._root}},{key:"uncacheClip",value:function(e){var t=this._actions,n=e.uuid,r=this._actionsByClip,a=r[n];if(void 0!==a){for(var i=a.knownActions,o=0,s=i.length;o!==s;++o){var u=i[o];this._deactivateAction(u);var c=u._cacheIndex,l=t[t.length-1];u._cacheIndex=null,u._byClipCacheIndex=null,l._cacheIndex=c,t[c]=l,t.pop(),this._removeInactiveBindingsForAction(u)}delete r[n]}}},{key:"uncacheRoot",value:function(e){var t=e.uuid,n=this._actionsByClip;for(var r in n){var a=n[r].actionByRoot[t];void 0!==a&&(this._deactivateAction(a),this._removeInactiveAction(a))}var i=this._bindingsByRootAndName[t];if(void 0!==i)for(var o in i){var s=i[o];s.restoreOriginalState(),this._removeInactiveBinding(s)}}},{key:"uncacheAction",value:function(e,t){var n=this.existingAction(e,t);null!==n&&(this._deactivateAction(n),this._removeInactiveAction(n))}}]),n}(ike),SNe=function(){function e(t){$n(this,e),"string"===typeof t&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),t=arguments[1]),this.value=t}return Jn(e,[{key:"clone",value:function(){return new e(void 0===this.value.clone?this.value:this.value.clone())}}]),e}(),CNe=function(e){tr(n,e);var t=sr(n);function n(e,r){var a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;return $n(this,n),(a=t.call(this,e,r)).isInstancedInterleavedBuffer=!0,a.meshPerAttribute=i,a}return Jn(n,[{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}},{key:"clone",value:function(e){var t=ja(nr(n.prototype),"clone",this).call(this,e);return t.meshPerAttribute=this.meshPerAttribute,t}},{key:"toJSON",value:function(e){var t=ja(nr(n.prototype),"toJSON",this).call(this,e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}]),n}(tEe),TNe=function(){function e(t,n,r,a,i){$n(this,e),this.isGLBufferAttribute=!0,this.buffer=t,this.type=n,this.itemSize=r,this.elementSize=a,this.count=i,this.version=0}return Jn(e,[{key:"needsUpdate",set:function(e){!0===e&&this.version++}},{key:"setBuffer",value:function(e){return this.buffer=e,this}},{key:"setType",value:function(e,t){return this.type=e,this.elementSize=t,this}},{key:"setItemSize",value:function(e){return this.itemSize=e,this}},{key:"setCount",value:function(e){return this.count=e,this}}]),e}(),ENe=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;$n(this,e),this.ray=new Cwe(t,n),this.near=r,this.far=a,this.camera=null,this.layers=new Fwe,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}return Jn(e,[{key:"set",value:function(e,t){this.ray.set(e,t)}},{key:"setFromCamera",value:function(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}},{key:"intersectObject",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];return ANe(e,this,n,t),n.sort(INe),n}},{key:"intersectObjects",value:function(e){for(var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=0,a=e.length;r<a;r++)ANe(e[r],this,n,t);return n.sort(INe),n}}]),e}();function INe(e,t){return e.distance-t.distance}function ANe(e,t,n,r){if(e.layers.test(t.layers)&&e.raycast(t,n),!0===r)for(var a=e.children,i=0,o=a.length;i<o;i++)ANe(a[i],t,n,!0)}var MNe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return $n(this,e),this.radius=t,this.phi=n,this.theta=r,this}return Jn(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}},{key:"makeSafe",value:function(){var e=1e-6;return this.phi=Math.max(e,Math.min(Math.PI-e,this.phi)),this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),0===this.radius?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(hke(t/this.radius,-1,1))),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),NNe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return $n(this,e),this.radius=t,this.theta=n,this.y=r,this}return Jn(e,[{key:"set",value:function(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}},{key:"copy",value:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}},{key:"setFromVector3",value:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}},{key:"setFromCartesianCoords",value:function(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),RNe=new yke,DNe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new yke(1/0,1/0),n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new yke(-1/0,-1/0);$n(this,e),this.isBox2=!0,this.min=t,this.max=n}return Jn(e,[{key:"set",value:function(e,t){return this.min.copy(e),this.max.copy(t),this}},{key:"setFromPoints",value:function(e){this.makeEmpty();for(var t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}},{key:"setFromCenterAndSize",value:function(e,t){var n=RNe.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}},{key:"clone",value:function(){return(new this.constructor).copy(this)}},{key:"copy",value:function(e){return this.min.copy(e.min),this.max.copy(e.max),this}},{key:"makeEmpty",value:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}},{key:"isEmpty",value:function(){return this.max.x<this.min.x||this.max.y<this.min.y}},{key:"getCenter",value:function(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}},{key:"getSize",value:function(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}},{key:"expandByPoint",value:function(e){return this.min.min(e),this.max.max(e),this}},{key:"expandByVector",value:function(e){return this.min.sub(e),this.max.add(e),this}},{key:"expandByScalar",value:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this}},{key:"containsPoint",value:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)}},{key:"containsBox",value:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}},{key:"getParameter",value:function(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}},{key:"intersectsBox",value:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)}},{key:"clampPoint",value:function(e,t){return t.copy(e).clamp(this.min,this.max)}},{key:"distanceToPoint",value:function(e){return RNe.copy(e).clamp(this.min,this.max).sub(e).length()}},{key:"intersect",value:function(e){return this.min.max(e.min),this.max.min(e.max),this}},{key:"union",value:function(e){return this.min.min(e.min),this.max.max(e.max),this}},{key:"translate",value:function(e){return this.min.add(e),this.max.add(e),this}},{key:"equals",value:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}]),e}(),PNe=new Yke,ONe=new Yke,LNe=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yke,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yke;$n(this,e),this.start=t,this.end=n}return Jn(e,[{key:"set",value:function(e,t){return this.start.copy(e),this.end.copy(t),this}},{key:"copy",value:function(e){return this.start.copy(e.start),this.end.copy(e.end),this}},{key:"getCenter",value:function(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}},{key:"delta",value:function(e){return e.subVectors(this.end,this.start)}},{key:"distanceSq",value:function(){return this.start.distanceToSquared(this.end)}},{key:"distance",value:function(){return this.start.distanceTo(this.end)}},{key:"at",value:function(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}},{key:"closestPointToPointParameter",value:function(e,t){PNe.subVectors(e,this.start),ONe.subVectors(this.end,this.start);var n=ONe.dot(ONe),r=ONe.dot(PNe)/n;return t&&(r=hke(r,0,1)),r}},{key:"closestPointToPoint",value:function(e,t,n){var r=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(r).add(this.start)}},{key:"applyMatrix4",value:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}},{key:"equals",value:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}},{key:"clone",value:function(){return(new this.constructor).copy(this)}}]),e}(),FNe=new Yke,zNe=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;$n(this,n),(a=t.call(this)).light=e,a.light.updateMatrixWorld(),a.matrix=e.matrixWorld,a.matrixAutoUpdate=!1,a.color=r;for(var i=new R_e,o=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],s=0,u=1;s<32;s++,u++){var c=s/32*Math.PI*2,l=u/32*Math.PI*2;o.push(Math.cos(c),Math.sin(c),1,Math.cos(l),Math.sin(l),1)}i.setAttribute("position",new __e(o,3));var h=new BEe({fog:!1,toneMapped:!1});return a.cone=new KEe(i,h),a.add(a.cone),a.update(),a}return Jn(n,[{key:"dispose",value:function(){this.cone.geometry.dispose(),this.cone.material.dispose()}},{key:"update",value:function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),FNe.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(FNe),void 0!==this.color?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}]),n}(Zwe),BNe=new Yke,UNe=new Twe,VNe=new Twe,WNe=function(e){tr(n,e);var t=sr(n);function n(e){var r;$n(this,n);for(var a=GNe(e),i=new R_e,o=[],s=[],u=new Oke(0,0,1),c=new Oke(0,1,0),l=0;l<a.length;l++){var h=a[l];h.parent&&h.parent.isBone&&(o.push(0,0,0),o.push(0,0,0),s.push(u.r,u.g,u.b),s.push(c.r,c.g,c.b))}i.setAttribute("position",new __e(o,3)),i.setAttribute("color",new __e(s,3));var f=new BEe({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});return(r=t.call(this,i,f)).isSkeletonHelper=!0,r.type="SkeletonHelper",r.root=e,r.bones=a,r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r}return Jn(n,[{key:"updateMatrixWorld",value:function(e){var t=this.bones,r=this.geometry,a=r.getAttribute("position");VNe.copy(this.root.matrixWorld).invert();for(var i=0,o=0;i<t.length;i++){var s=t[i];s.parent&&s.parent.isBone&&(UNe.multiplyMatrices(VNe,s.matrixWorld),BNe.setFromMatrixPosition(UNe),a.setXYZ(o,BNe.x,BNe.y,BNe.z),UNe.multiplyMatrices(VNe,s.parent.matrixWorld),BNe.setFromMatrixPosition(UNe),a.setXYZ(o+1,BNe.x,BNe.y,BNe.z),o+=2)}r.getAttribute("position").needsUpdate=!0,ja(nr(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(KEe);function GNe(e){var t=[];!0===e.isBone&&t.push(e);for(var n=0;n<e.children.length;n++)t.push.apply(t,GNe(e.children[n]));return t}var jNe=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;$n(this,n);var o=new _Ae(r,4,2),s=new h_e({wireframe:!0,fog:!1,toneMapped:!1});return(i=t.call(this,o,s)).light=e,i.light.updateMatrixWorld(),i.color=a,i.type="PointLightHelper",i.matrix=i.light.matrixWorld,i.matrixAutoUpdate=!1,i.update(),i}return Jn(n,[{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}},{key:"update",value:function(){void 0!==this.color?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}]),n}(Q_e),qNe=new Yke,HNe=new Oke,XNe=new Oke,KNe=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;$n(this,n),(i=t.call(this)).light=e,i.light.updateMatrixWorld(),i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i.color=a;var o=new xAe(r);o.rotateY(.5*Math.PI),i.material=new h_e({wireframe:!0,fog:!1,toneMapped:!1}),void 0===i.color&&(i.material.vertexColors=!0);var s=o.getAttribute("position"),u=new Float32Array(3*s.count);return o.setAttribute("color",new p_e(u,3)),i.add(new Q_e(o,i.material)),i.update(),i}return Jn(n,[{key:"dispose",value:function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}},{key:"update",value:function(){var e=this.children[0];if(void 0!==this.color)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");HNe.copy(this.light.color),XNe.copy(this.light.groundColor);for(var n=0,r=t.count;n<r;n++){var a=n<r/2?HNe:XNe;t.setXYZ(n,a.r,a.g,a.b)}t.needsUpdate=!0}e.lookAt(qNe.setFromMatrixPosition(this.light.matrixWorld).negate())}}]),n}(Zwe),YNe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:4473924,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:8947848;$n(this,n),i=new Oke(i),o=new Oke(o);for(var s=a/2,u=r/a,c=r/2,l=[],h=[],f=0,d=0,p=-c;f<=a;f++,p+=u){l.push(-c,0,p,c,0,p),l.push(p,0,-c,p,0,c);var v=f===s?i:o;v.toArray(h,d),d+=3,v.toArray(h,d),d+=3,v.toArray(h,d),d+=3,v.toArray(h,d),d+=3}var m=new R_e;m.setAttribute("position",new __e(l,3)),m.setAttribute("color",new __e(h,3));var g=new BEe({vertexColors:!0,toneMapped:!1});return(e=t.call(this,m,g)).type="GridHelper",e}return Jn(n)}(KEe),QNe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:8,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:64,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:4473924,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:8947848;$n(this,n),s=new Oke(s),u=new Oke(u);for(var c=[],l=[],h=0;h<=a;h++){var f=h/a*(2*Math.PI),d=Math.sin(f)*r,p=Math.cos(f)*r;c.push(0,0,0),c.push(d,0,p);var v=1&h?s:u;l.push(v.r,v.g,v.b),l.push(v.r,v.g,v.b)}for(var m=0;m<=i;m++)for(var g=1&m?s:u,y=r-r/i*m,b=0;b<o;b++){var x=b/o*(2*Math.PI),k=Math.sin(x)*y,w=Math.cos(x)*y;c.push(k,0,w),l.push(g.r,g.g,g.b),x=(b+1)/o*(2*Math.PI),k=Math.sin(x)*y,w=Math.cos(x)*y,c.push(k,0,w),l.push(g.r,g.g,g.b)}var _=new R_e;_.setAttribute("position",new __e(c,3)),_.setAttribute("color",new __e(l,3));var S=new BEe({vertexColors:!0,toneMapped:!1});return(e=t.call(this,_,S)).type="PolarGridHelper",e}return Jn(n)}(KEe),ZNe=new Yke,JNe=new Yke,$Ne=new Yke,eRe=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;$n(this,n),(i=t.call(this)).light=e,i.light.updateMatrixWorld(),i.matrix=e.matrixWorld,i.matrixAutoUpdate=!1,i.color=a,void 0===r&&(r=1);var o=new R_e;o.setAttribute("position",new __e([-r,r,0,r,r,0,r,-r,0,-r,-r,0,-r,r,0],3));var s=new BEe({fog:!1,toneMapped:!1});return i.lightPlane=new qEe(o,s),i.add(i.lightPlane),(o=new R_e).setAttribute("position",new __e([0,0,0,0,0,1],3)),i.targetLine=new qEe(o,s),i.add(i.targetLine),i.update(),i}return Jn(n,[{key:"dispose",value:function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}},{key:"update",value:function(){ZNe.setFromMatrixPosition(this.light.matrixWorld),JNe.setFromMatrixPosition(this.light.target.matrixWorld),$Ne.subVectors(JNe,ZNe),this.lightPlane.lookAt(JNe),void 0!==this.color?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(JNe),this.targetLine.scale.z=$Ne.length()}}]),n}(Zwe),tRe=new Yke,nRe=new rSe,rRe=function(e){tr(n,e);var t=sr(n);function n(e){var r;$n(this,n);var a=new R_e,i=new BEe({color:16777215,vertexColors:!0,toneMapped:!1}),o=[],s=[],u={};function c(e,t){l(e),l(t)}function l(e){o.push(0,0,0),s.push(0,0,0),void 0===u[e]&&(u[e]=[]),u[e].push(o.length/3-1)}c("n1","n2"),c("n2","n4"),c("n4","n3"),c("n3","n1"),c("f1","f2"),c("f2","f4"),c("f4","f3"),c("f3","f1"),c("n1","f1"),c("n2","f2"),c("n3","f3"),c("n4","f4"),c("p","n1"),c("p","n2"),c("p","n3"),c("p","n4"),c("u1","u2"),c("u2","u3"),c("u3","u1"),c("c","t"),c("p","c"),c("cn1","cn2"),c("cn3","cn4"),c("cf1","cf2"),c("cf3","cf4"),a.setAttribute("position",new __e(o,3)),a.setAttribute("color",new __e(s,3)),(r=t.call(this,a,i)).type="CameraHelper",r.camera=e,r.camera.updateProjectionMatrix&&r.camera.updateProjectionMatrix(),r.matrix=e.matrixWorld,r.matrixAutoUpdate=!1,r.pointMap=u,r.update();var h=new Oke(16755200),f=new Oke(16711680),d=new Oke(43775),p=new Oke(16777215),v=new Oke(3355443);return r.setColors(h,f,d,p,v),r}return Jn(n,[{key:"setColors",value:function(e,t,n,r,a){var i=this.geometry.getAttribute("color");i.setXYZ(0,e.r,e.g,e.b),i.setXYZ(1,e.r,e.g,e.b),i.setXYZ(2,e.r,e.g,e.b),i.setXYZ(3,e.r,e.g,e.b),i.setXYZ(4,e.r,e.g,e.b),i.setXYZ(5,e.r,e.g,e.b),i.setXYZ(6,e.r,e.g,e.b),i.setXYZ(7,e.r,e.g,e.b),i.setXYZ(8,e.r,e.g,e.b),i.setXYZ(9,e.r,e.g,e.b),i.setXYZ(10,e.r,e.g,e.b),i.setXYZ(11,e.r,e.g,e.b),i.setXYZ(12,e.r,e.g,e.b),i.setXYZ(13,e.r,e.g,e.b),i.setXYZ(14,e.r,e.g,e.b),i.setXYZ(15,e.r,e.g,e.b),i.setXYZ(16,e.r,e.g,e.b),i.setXYZ(17,e.r,e.g,e.b),i.setXYZ(18,e.r,e.g,e.b),i.setXYZ(19,e.r,e.g,e.b),i.setXYZ(20,e.r,e.g,e.b),i.setXYZ(21,e.r,e.g,e.b),i.setXYZ(22,e.r,e.g,e.b),i.setXYZ(23,e.r,e.g,e.b),i.setXYZ(24,t.r,t.g,t.b),i.setXYZ(25,t.r,t.g,t.b),i.setXYZ(26,t.r,t.g,t.b),i.setXYZ(27,t.r,t.g,t.b),i.setXYZ(28,t.r,t.g,t.b),i.setXYZ(29,t.r,t.g,t.b),i.setXYZ(30,t.r,t.g,t.b),i.setXYZ(31,t.r,t.g,t.b),i.setXYZ(32,n.r,n.g,n.b),i.setXYZ(33,n.r,n.g,n.b),i.setXYZ(34,n.r,n.g,n.b),i.setXYZ(35,n.r,n.g,n.b),i.setXYZ(36,n.r,n.g,n.b),i.setXYZ(37,n.r,n.g,n.b),i.setXYZ(38,r.r,r.g,r.b),i.setXYZ(39,r.r,r.g,r.b),i.setXYZ(40,a.r,a.g,a.b),i.setXYZ(41,a.r,a.g,a.b),i.setXYZ(42,a.r,a.g,a.b),i.setXYZ(43,a.r,a.g,a.b),i.setXYZ(44,a.r,a.g,a.b),i.setXYZ(45,a.r,a.g,a.b),i.setXYZ(46,a.r,a.g,a.b),i.setXYZ(47,a.r,a.g,a.b),i.setXYZ(48,a.r,a.g,a.b),i.setXYZ(49,a.r,a.g,a.b),i.needsUpdate=!0}},{key:"update",value:function(){var e=this.geometry,t=this.pointMap;nRe.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),aRe("c",t,e,nRe,0,0,-1),aRe("t",t,e,nRe,0,0,1),aRe("n1",t,e,nRe,-1,-1,-1),aRe("n2",t,e,nRe,1,-1,-1),aRe("n3",t,e,nRe,-1,1,-1),aRe("n4",t,e,nRe,1,1,-1),aRe("f1",t,e,nRe,-1,-1,1),aRe("f2",t,e,nRe,1,-1,1),aRe("f3",t,e,nRe,-1,1,1),aRe("f4",t,e,nRe,1,1,1),aRe("u1",t,e,nRe,.7,1.1,-1),aRe("u2",t,e,nRe,-.7,1.1,-1),aRe("u3",t,e,nRe,0,2,-1),aRe("cf1",t,e,nRe,-1,0,1),aRe("cf2",t,e,nRe,1,0,1),aRe("cf3",t,e,nRe,0,-1,1),aRe("cf4",t,e,nRe,0,1,1),aRe("cn1",t,e,nRe,-1,0,-1),aRe("cn2",t,e,nRe,1,0,-1),aRe("cn3",t,e,nRe,0,-1,-1),aRe("cn4",t,e,nRe,0,1,-1),e.getAttribute("position").needsUpdate=!0}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(KEe);function aRe(e,t,n,r,a,i,o){tRe.set(a,i,o).unproject(r);var s=t[e];if(void 0!==s)for(var u=n.getAttribute("position"),c=0,l=s.length;c<l;c++)u.setXYZ(s[c],tRe.x,tRe.y,tRe.z)}var iRe,oRe,sRe=new Jke,uRe=function(e){tr(n,e);var t=sr(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;$n(this,n);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=new Float32Array(24),s=new R_e;return s.setIndex(new p_e(i,1)),s.setAttribute("position",new p_e(o,3)),(r=t.call(this,s,new BEe({color:a,toneMapped:!1}))).object=e,r.type="BoxHelper",r.matrixAutoUpdate=!1,r.update(),r}return Jn(n,[{key:"update",value:function(e){if(void 0!==e&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),void 0!==this.object&&sRe.setFromObject(this.object),!sRe.isEmpty()){var t=sRe.min,n=sRe.max,r=this.geometry.attributes.position,a=r.array;a[0]=n.x,a[1]=n.y,a[2]=n.z,a[3]=t.x,a[4]=n.y,a[5]=n.z,a[6]=t.x,a[7]=t.y,a[8]=n.z,a[9]=n.x,a[10]=t.y,a[11]=n.z,a[12]=n.x,a[13]=n.y,a[14]=t.z,a[15]=t.x,a[16]=n.y,a[17]=t.z,a[18]=t.x,a[19]=t.y,a[20]=t.z,a[21]=n.x,a[22]=t.y,a[23]=t.z,r.needsUpdate=!0,this.geometry.computeBoundingSphere()}}},{key:"setFromObject",value:function(e){return this.object=e,this.update(),this}},{key:"copy",value:function(e,t){return ja(nr(n.prototype),"copy",this).call(this,e,t),this.object=e.object,this}}]),n}(KEe),cRe=function(e){tr(n,e);var t=sr(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:16776960;$n(this,n);var i=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),o=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new R_e;return s.setIndex(new p_e(i,1)),s.setAttribute("position",new __e(o,3)),(r=t.call(this,s,new BEe({color:a,toneMapped:!1}))).box=e,r.type="Box3Helper",r.geometry.computeBoundingSphere(),r}return Jn(n,[{key:"updateMatrixWorld",value:function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),ja(nr(n.prototype),"updateMatrixWorld",this).call(this,e))}}]),n}(KEe),lRe=function(e){tr(n,e);var t=sr(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:16776960;$n(this,n);var o=i,s=[1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],u=new R_e;u.setAttribute("position",new __e(s,3)),u.computeBoundingSphere(),(r=t.call(this,u,new BEe({color:o,toneMapped:!1}))).type="PlaneHelper",r.plane=e,r.size=a;var c=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],l=new R_e;return l.setAttribute("position",new __e(c,3)),l.computeBoundingSphere(),r.add(new Q_e(l,new h_e({color:o,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1}))),r}return Jn(n,[{key:"updateMatrixWorld",value:function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?iye:aye,this.lookAt(this.plane.normal),ja(nr(n.prototype),"updateMatrixWorld",this).call(this,e)}}]),n}(qEe),hRe=new Yke,fRe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Yke(0,0,1),a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Yke(0,0,0),i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:16776960,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.2*i,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:.2*s;return $n(this,n),(e=t.call(this)).type="ArrowHelper",void 0===iRe&&((iRe=new R_e).setAttribute("position",new __e([0,0,0,0,1,0],3)),(oRe=new RIe(0,.5,1,5,1)).translate(0,-.5,0)),e.position.copy(a),e.line=new qEe(iRe,new BEe({color:o,toneMapped:!1})),e.line.matrixAutoUpdate=!1,e.add(e.line),e.cone=new Q_e(oRe,new h_e({color:o,toneMapped:!1})),e.cone.matrixAutoUpdate=!1,e.add(e.cone),e.setDirection(r),e.setLength(i,s,u),e}return Jn(n,[{key:"setDirection",value:function(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{hRe.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(hRe,t)}}},{key:"setLength",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.2*e,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2*t;this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}},{key:"setColor",value:function(e){this.line.material.color.set(e),this.cone.material.color.set(e)}},{key:"copy",value:function(e){return ja(nr(n.prototype),"copy",this).call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}}]),n}(Zwe),dRe=function(e){tr(n,e);var t=sr(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;$n(this,n);var a=[0,0,0,r,0,0,0,0,0,0,r,0,0,0,0,0,0,r],i=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],o=new R_e;o.setAttribute("position",new __e(a,3)),o.setAttribute("color",new __e(i,3));var s=new BEe({vertexColors:!0,toneMapped:!1});return(e=t.call(this,o,s)).type="AxesHelper",e}return Jn(n,[{key:"setColors",value:function(e,t,n){var r=new Oke,a=this.geometry.attributes.color.array;return r.set(e),r.toArray(a,0),r.toArray(a,3),r.set(t),r.toArray(a,6),r.toArray(a,9),r.set(n),r.toArray(a,12),r.toArray(a,15),this.geometry.attributes.color.needsUpdate=!0,this}},{key:"dispose",value:function(){this.geometry.dispose(),this.material.dispose()}}]),n}(KEe),pRe=function(){function e(){$n(this,e),this.type="ShapePath",this.color=new Oke,this.subPaths=[],this.currentPath=null}return Jn(e,[{key:"moveTo",value:function(e,t){return this.currentPath=new IIe,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}},{key:"lineTo",value:function(e,t){return this.currentPath.lineTo(e,t),this}},{key:"quadraticCurveTo",value:function(e,t,n,r){return this.currentPath.quadraticCurveTo(e,t,n,r),this}},{key:"bezierCurveTo",value:function(e,t,n,r,a,i){return this.currentPath.bezierCurveTo(e,t,n,r,a,i),this}},{key:"splineThru",value:function(e){return this.currentPath.splineThru(e),this}},{key:"toShapes",value:function(e,t){function n(e){for(var t=[],n=0,r=e.length;n<r;n++){var a=e[n],i=new VIe;i.curves=a.curves,t.push(i)}return t}function r(e,t){for(var n=t.length,r=!1,a=n-1,i=0;i<n;a=i++){var o=t[a],s=t[i],u=s.x-o.x,c=s.y-o.y;if(Math.abs(c)>Number.EPSILON){if(c<0&&(o=t[i],u=-u,s=t[a],c=-c),e.y<o.y||e.y>s.y)continue;if(e.y===o.y){if(e.x===o.x)return!0}else{var l=c*(e.x-o.x)-u*(e.y-o.y);if(0===l)return!0;if(l<0)continue;r=!r}}else{if(e.y!==o.y)continue;if(s.x<=e.x&&e.x<=o.x||o.x<=e.x&&e.x<=s.x)return!0}}return r}var a,i,o,s=pAe.isClockWise,u=this.subPaths;if(0===u.length)return[];if(!0===t)return n(u);var c=[];if(1===u.length)return i=u[0],(o=new VIe).curves=i.curves,c.push(o),c;var l=!s(u[0].getPoints());l=e?!l:l;var h,f,d=[],p=[],v=[],m=0;p[m]=void 0,v[m]=[];for(var g=0,y=u.length;g<y;g++)a=s(h=(i=u[g]).getPoints()),(a=e?!a:a)?(!l&&p[m]&&m++,p[m]={s:new VIe,p:h},p[m].s.curves=i.curves,l&&m++,v[m]=[]):v[m].push({h:i,p:h[0]});if(!p[0])return n(u);if(p.length>1){for(var b=!1,x=0,k=0,w=p.length;k<w;k++)d[k]=[];for(var _=0,S=p.length;_<S;_++)for(var C=v[_],T=0;T<C.length;T++){for(var E=C[T],I=!0,A=0;A<p.length;A++)r(E.p,p[A].p)&&(_!==A&&x++,I?(I=!1,d[A].push(E)):b=!0);I&&d[_].push(E)}x>0&&!1===b&&(v=d)}for(var M=0,N=p.length;M<N;M++){o=p[M].s,c.push(o);for(var R=0,D=(f=v[M]).length;R<D;R++)o.holes.push(f[R].h)}return c}}]),e}(),vRe=_Re(),mRe=vRe.floatView,gRe=vRe.uint32View,yRe=vRe.baseTable,bRe=vRe.shiftTable,xRe=vRe.mantissaTable,kRe=vRe.exponentTable,wRe=vRe.offsetTable;function _Re(){for(var e=new ArrayBuffer(4),t=new Float32Array(e),n=new Uint32Array(e),r=new Uint32Array(512),a=new Uint32Array(512),i=0;i<256;++i){var o=i-127;o<-27?(r[i]=0,r[256|i]=32768,a[i]=24,a[256|i]=24):o<-14?(r[i]=1024>>-o-14,r[256|i]=1024>>-o-14|32768,a[i]=-o-1,a[256|i]=-o-1):o<=15?(r[i]=o+15<<10,r[256|i]=o+15<<10|32768,a[i]=13,a[256|i]=13):o<128?(r[i]=31744,r[256|i]=64512,a[i]=24,a[256|i]=24):(r[i]=31744,r[256|i]=64512,a[i]=13,a[256|i]=13)}for(var s=new Uint32Array(2048),u=new Uint32Array(64),c=new Uint32Array(64),l=1;l<1024;++l){for(var h=l<<13,f=0;0===(8388608&h);)h<<=1,f-=8388608;h&=-8388609,f+=947912704,s[l]=h|f}for(var d=1024;d<2048;++d)s[d]=939524096+(d-1024<<13);for(var p=1;p<31;++p)u[p]=p<<23;u[31]=1199570944,u[32]=2147483648;for(var v=33;v<63;++v)u[v]=2147483648+(v-32<<23);u[63]=3347054592;for(var m=1;m<64;++m)32!==m&&(c[m]=1024);return{floatView:t,uint32View:n,baseTable:r,shiftTable:a,mantissaTable:s,exponentTable:u,offsetTable:c}}var SRe=Object.freeze({__proto__:null,toHalfFloat:function(e){Math.abs(e)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),e=hke(e,-65504,65504),mRe[0]=e;var t=gRe[0],n=t>>23&511;return yRe[n]+((8388607&t)>>bRe[n])},fromHalfFloat:function(e){var t=e>>10;return gRe[0]=xRe[wRe[t]+(1023&e)]+kRe[t],mRe[0]}}),CRe=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),console.error("THREE.ParametricGeometry has been moved to /examples/jsm/geometries/ParametricGeometry.js"),t.call(this)}return Jn(n)}(R_e),TRe=function(e){tr(n,e);var t=sr(n);function n(){return $n(this,n),console.error("THREE.TextGeometry has been moved to /examples/jsm/geometries/TextGeometry.js"),t.call(this)}return Jn(n)}(R_e);function ERe(){console.error("THREE.FontLoader has been moved to /examples/jsm/loaders/FontLoader.js")}function IRe(){console.error("THREE.Font has been moved to /examples/jsm/loaders/FontLoader.js")}function ARe(){console.error("THREE.ImmediateRenderObject has been removed.")}var MRe=function(e){tr(n,e);var t=sr(n);function n(e,r,a){var i;return $n(this,n),console.error('THREE.WebGLMultisampleRenderTarget has been removed. Use a normal render target and set the "samples" property to greater 0 to enable multisampling.'),(i=t.call(this,e,r,a)).samples=4,i}return Jn(n)}(Wke),NRe=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i){return $n(this,n),console.warn("THREE.DataTexture2DArray has been renamed to DataArrayTexture."),t.call(this,e,r,a,i)}return Jn(n)}(Gke),RRe=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i){return $n(this,n),console.warn("THREE.DataTexture3D has been renamed to Data3DTexture."),t.call(this,e,r,a,i)}return Jn(n)}(qke);"undefined"!==typeof __THREE_DEVTOOLS__&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Xge}})),"undefined"!==typeof window&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Xge);var DRe=__webpack_require__(4585);function PRe(e){var t,n=new Set,r=function(e,r){var a="function"===typeof e?e(t):e;if(a!==t){var i=t;t=r?a:Object.assign({},t,a),n.forEach((function(e){return e(t,i)}))}},a=function(){return t},i={setState:r,getState:a,subscribe:function(e,r,i){return r||i?function(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:a,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Object.is;console.warn("[DEPRECATED] Please use `subscribeWithSelector` middleware");var o=r(t);function s(){var n=r(t);if(!i(o,n)){var a=o;e(o=n,a)}}return n.add(s),function(){return n.delete(s)}}(e,r,i):(n.add(e),function(){return n.delete(e)})},destroy:function(){return n.clear()}};return t=e(r,a,i),i}var ORe="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?i.useEffect:i.useLayoutEffect;var LRe=__webpack_require__(258),FRe=__webpack_require__.n(LRe),zRe=__webpack_require__(5296);function BRe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e,t){return e===t};if(e===t)return!0;if(!e||!t)return!1;var r=e.length;if(t.length!==r)return!1;for(var a=0;a<r;a++)if(!n(e[a],t[a]))return!1;return!0}var URe=[];function VRe(e,t){var n,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=al(URe);try{for(i.s();!(n=i.n()).done;){var o=n.value;if(BRe(t,o.keys,o.equal)){if(r)return;if(Object.prototype.hasOwnProperty.call(o,"error"))throw o.error;if(Object.prototype.hasOwnProperty.call(o,"response"))return o.response;if(!r)throw o.promise}}}catch($Pe){i.e($Pe)}finally{i.f()}var s={keys:t,equal:a.equal,promise:e.apply(void 0,Tt(t)).then((function(e){return s.response=e})).then((function(){a.lifespan&&a.lifespan>0&&setTimeout((function(){var e=URe.indexOf(s);-1!==e&&URe.splice(e,1)}),a.lifespan)})).catch((function(e){return s.error=e}))};if(URe.push(s),!r)throw s.promise}var WRe=["children","key","ref"],GRe=["children","key","ref"],jRe=["args","attach"],qRe=["args","children"],HRe=["args","children"],XRe=["params"],KRe=function(e){return e&&e.isOrthographicCamera},YRe="undefined"===typeof window||!window.navigator||/ServerSideRendering|^Deno\//.test(window.navigator.userAgent)?i.useEffect:i.useLayoutEffect;function QRe(e){var t=i.useRef(e);return YRe((function(){t.current=e}),[e]),t}function ZRe(e){var t=e.set;return YRe((function(){return t(new Promise((function(){return null}))),function(){return t(!1)}}),[t]),null}var JRe=function(e){tr(n,e);var t=sr(n);function n(){var e;$n(this,n);for(var r=arguments.length,a=new Array(r),i=0;i<r;i++)a[i]=arguments[i];return(e=t.call.apply(t,[this].concat(a))).state={error:!1},e}return Jn(n,[{key:"componentDidCatch",value:function(e){this.props.set(e)}},{key:"render",value:function(){return this.state.error?null:this.props.children}}]),n}(i.Component);JRe.getDerivedStateFromError=function(){return{error:!0}};var $Re="__default";function eDe(e){return Array.isArray(e)?Math.min(Math.max(e[0],window.devicePixelRatio),e[1]):e}var tDe=function(e){var t;return null==(t=e.__r3f)?void 0:t.root.getState()},nDe={obj:function(e){return e===Object(e)&&!nDe.arr(e)&&"function"!==typeof e},fun:function(e){return"function"===typeof e},str:function(e){return"string"===typeof e},num:function(e){return"number"===typeof e},boo:function(e){return"boolean"===typeof e},und:function(e){return void 0===e},arr:function(e){return Array.isArray(e)},equ:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.arrays,a=void 0===r?"shallow":r,i=n.objects,o=void 0===i?"reference":i,s=n.strict,u=void 0===s||s;if(typeof e!==typeof t||!!e!==!!t)return!1;if(nDe.str(e)||nDe.num(e))return e===t;var c=nDe.obj(e);if(c&&"reference"===o)return e===t;var l,h=nDe.arr(e);if(h&&"reference"===a)return e===t;if((h||c)&&e===t)return!0;for(l in e)if(!(l in t))return!1;for(l in u?t:e)if(e[l]!==t[l])return!1;if(nDe.und(l)){if(h&&0===e.length&&0===t.length)return!0;if(c&&0===Object.keys(e).length&&0===Object.keys(t).length)return!0;if(e!==t)return!1}return!0}};function rDe(e){var t={nodes:{},materials:{}};return e&&e.traverse((function(e){e.name&&(t.nodes[e.name]=e),e.material&&!t.materials[e.material.name]&&(t.materials[e.material.name]=e.material)})),t}function aDe(e,t){var n=e;return(null!=t&&t.primitive||!n.__r3f)&&(n.__r3f=w3({type:"",root:null,previousAttach:null,memoizedProps:{},eventCount:0,handlers:{},objects:[],parent:null},t)),e}function iDe(e,t){var n=e;if(t.includes("-")){var r=t.split("-"),a=r.pop();return n=r.reduce((function(e,t){return e[t]}),e),{target:n,key:a}}return{target:n,key:t}}var oDe=/-\d+$/;function sDe(e,t,n){if(nDe.str(n)){if(oDe.test(n)){var r=iDe(e,n.replace(oDe,"")),a=r.target,i=r.key;Array.isArray(a[i])||(a[i]=[])}var o=iDe(e,n),s=o.target,u=o.key;t.__r3f.previousAttach=s[u],s[u]=t}else t.__r3f.previousAttach=n(e,t)}function uDe(e,t,n){var r,a;if(nDe.str(n)){var i=iDe(e,n),o=i.target,s=i.key,u=t.__r3f.previousAttach;void 0===u?delete o[s]:o[s]=u}else null==(r=t.__r3f)||null==r.previousAttach||r.previousAttach(e,t);null==(a=t.__r3f)||delete a.previousAttach}function cDe(e,t){t.children,t.key,t.ref;var n,r=G4(t,WRe),a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=(a.children,a.key,a.ref,G4(a,GRe)),o=arguments.length>3&&void 0!==arguments[3]&&arguments[3],s=null!=(n=null==e?void 0:e.__r3f)?n:{},u=Object.entries(r),c=[];if(o)for(var l=Object.keys(i),h=0;h<l.length;h++)r.hasOwnProperty(l[h])||u.unshift([l[h],$Re+"remove"]);u.forEach((function(t){var n,r=f(t,2),a=r[0],o=r[1];if((null==(n=e.__r3f)||!n.primitive||"object"!==a)&&!nDe.equ(o,i[a])){if(/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/.test(a))return c.push([a,o,!0,[]]);var s=[];a.includes("-")&&(s=a.split("-")),c.push([a,o,!1,s])}}));var d=w3({},r);return s.memoizedProps&&s.memoizedProps.args&&(d.args=s.memoizedProps.args),s.memoizedProps&&s.memoizedProps.attach&&(d.attach=s.memoizedProps.attach),{memoized:d,changes:c}}function lDe(e,t){var n,r,a,i=null!=(n=e.__r3f)?n:{},o=i.root,s=null!=(r=null==o||null==o.getState?void 0:o.getState())?r:{},u=(a=t)&&a.memoized&&a.changes?t:cDe(e,t),c=u.memoized,l=u.changes,h=i.eventCount;if(e.__r3f&&(e.__r3f.memoizedProps=c),l.forEach((function(t){var n,r=f(t,4),a=r[0],o=r[1],u=r[2],l=r[3],h=e,d=h[a];if(l.length&&(d=l.reduce((function(e,t){return e[t]}),e),!d||!d.set)){var p=Mb(l.reverse()),v=p[0];h=p.slice(1).reverse().reduce((function(e,t){return e[t]}),e),a=v}if(o===$Re+"remove")if(d&&d.constructor)o=ur(d.constructor,Tt(null!=(n=c.args)?n:[]));else if(h.constructor){var m,g=ur(h.constructor,Tt(null!=(m=h.__r3f.memoizedProps.args)?m:[]));o=g[d],g.dispose&&g.dispose()}else o=0;if(u)o?i.handlers[a]=o:delete i.handlers[a],i.eventCount=Object.keys(i.handlers).length;else if(d&&d.set&&(d.copy||d instanceof Fwe)){var y;if(Array.isArray(o))d.fromArray?d.fromArray(o):(y=d).set.apply(y,Tt(o));else if(d.copy&&o&&o.constructor&&d.constructor.name===o.constructor.name)d.copy(o);else if(void 0!==o){var b=d instanceof Oke;!b&&d.setScalar?d.setScalar(o):d instanceof Fwe&&o instanceof Fwe?d.mask=o.mask:d.set(o);0}}else h[a]=o,!s.linear&&h[a]instanceof Uke&&(h[a].encoding=_xe);hDe(e)})),i.parent&&s.internal&&e.raycast&&h!==i.eventCount){var d=s.internal.interaction.indexOf(e);d>-1&&s.internal.interaction.splice(d,1),i.eventCount&&s.internal.interaction.push(e)}return l.length&&e.parent&&fDe(e),e}function hDe(e){var t,n,r=null==(t=e.__r3f)||null==(n=t.root)||null==n.getState?void 0:n.getState();r&&0===r.internal.frames&&r.invalidate()}function fDe(e){null==e.onUpdate||e.onUpdate(e)}function dDe(e,t){e.manual||(KRe(e)?(e.left=t.width/-2,e.right=t.width/2,e.top=t.height/2,e.bottom=t.height/-2):e.aspect=t.width/t.height,e.updateProjectionMatrix(),e.updateMatrixWorld())}function pDe(e,t,n){var r=n.pop(),a=n.reduce((function(e,t){return e[t]}),e);return a[r]=t}function vDe(e){return(e.eventObject||e.object).uuid+"/"+e.index+e.instanceId}function mDe(e,t,n,r){var a=n.get(t);a&&(n.delete(t),0===n.size&&(e.delete(r),a.target.releasePointerCapture(r)))}function gDe(e){var t=new Yke;function n(e){return e.filter((function(e){return["Move","Over","Enter","Out","Leave"].some((function(t){var n;return null==(n=e.__r3f)?void 0:n.handlers["onPointer"+t]}))}))}function r(t){var n=e.getState().internal;Array.from(n.hovered.values()).forEach((function(e){if(!t.length||!t.find((function(t){return t.object===e.object&&t.index===e.index&&t.instanceId===e.instanceId}))){var r=e.eventObject.__r3f,a=null==r?void 0:r.handlers;if(n.hovered.delete(vDe(e)),null!=r&&r.eventCount){var i=w3(w3({},e),{},{intersections:t});null==a.onPointerOut||a.onPointerOut(i),null==a.onPointerLeave||a.onPointerLeave(i)}}}))}function a(e,t){t.forEach((function(t){var n;return null==(n=t.__r3f)||null==n.handlers.onPointerMissed?void 0:n.handlers.onPointerMissed(e)}))}return{handlePointer:function(i){switch(i){case"onPointerLeave":case"onPointerCancel":return function(){return r([])};case"onLostPointerCapture":return function(t){var n=e.getState().internal;"pointerId"in t&&!n.capturedMap.has(t.pointerId)&&(n.capturedMap.delete(t.pointerId),r([]))}}return function(o){var s=e.getState(),u=s.onPointerMissed,c=s.internal;c.lastEvent.current=o;var l="onPointerMove"===i,h="onClick"===i||"onContextMenu"===i||"onDoubleClick"===i,f=function(t,n){var r=e.getState(),a=new Set,i=[],o=n?n(r.internal.interaction):r.internal.interaction;o.forEach((function(e){var t=tDe(e);t&&(t.raycaster.camera=void 0)})),r.previousRoot||null==r.events.compute||r.events.compute(t,r);var s=o.flatMap((function(e){var n,r=tDe(e);return r&&r.events.enabled&&null!==r.raycaster.camera?(void 0===r.raycaster.camera&&(null==r.events.compute||r.events.compute(t,r,null==(n=r.previousRoot)?void 0:n.getState()),void 0===r.raycaster.camera&&(r.raycaster.camera=null)),r.raycaster.camera?r.raycaster.intersectObject(e,!0):[]):[]})).sort((function(e,t){var n=tDe(e.object),r=tDe(t.object);return n&&r?r.events.priority-n.events.priority||e.distance-t.distance:0})).filter((function(e){var t=vDe(e);return!a.has(t)&&(a.add(t),!0)}));r.events.filter&&(s=r.events.filter(s,r));var u,c=al(s);try{for(c.s();!(u=c.n()).done;)for(var l=u.value,h=l.object;h;){var f;null!=(f=h.__r3f)&&f.eventCount&&i.push(w3(w3({},l),{},{eventObject:h})),h=h.parent}}catch($Pe){c.e($Pe)}finally{c.f()}if("pointerId"in t&&r.internal.capturedMap.has(t.pointerId)){var d,p=al(r.internal.capturedMap.get(t.pointerId).values());try{for(p.s();!(d=p.n()).done;){var v=d.value;i.push(v.intersection)}}catch($Pe){p.e($Pe)}finally{p.f()}}return i}(o,l?n:void 0),d=h?function(t){var n=e.getState().internal,r=t.offsetX-n.initialClick[0],a=t.offsetY-n.initialClick[1];return Math.round(Math.sqrt(r*r+a*a))}(o):0;"onPointerDown"===i&&(c.initialClick=[o.offsetX,o.offsetY],c.initialHits=f.map((function(e){return e.eventObject}))),h&&!f.length&&d<=2&&(a(o,c.interaction),u&&u(o)),l&&r(f),function(n,a,i,o){var s=e.getState(),u=s.raycaster,c=s.pointer,l=s.camera,h=s.internal;n.length&&function(){var e,s=t.set(c.x,c.y,0).unproject(l),f={stopped:!1},d=al(n);try{var p=function(){var t=e.value,d=function(e){var n,r;return null!=(n=null==(r=h.capturedMap.get(e))?void 0:r.has(t.eventObject))&&n},p=function(e){var n={intersection:t,target:a.target};h.capturedMap.has(e)?h.capturedMap.get(e).set(t.eventObject,n):h.capturedMap.set(e,new Map([[t.eventObject,n]])),a.target.setPointerCapture(e)},v=function(e){var n=h.capturedMap.get(e);n&&mDe(h.capturedMap,t.eventObject,n,e)},m={};for(var g in a){var y=a[g];"function"!==typeof y&&(m[g]=y)}var b=w3(w3(w3({},t),m),{},{pointer:c,intersections:n,stopped:f.stopped,delta:i,unprojectedPoint:s,ray:u.ray,camera:l,stopPropagation:function(){var e="pointerId"in a&&h.capturedMap.get(a.pointerId);if((!e||e.has(t.eventObject))&&(b.stopped=f.stopped=!0,h.hovered.size&&Array.from(h.hovered.values()).find((function(e){return e.eventObject===t.eventObject})))){var i=n.slice(0,n.indexOf(t));r([].concat(Tt(i),[t]))}},target:{hasPointerCapture:d,setPointerCapture:p,releasePointerCapture:v},currentTarget:{hasPointerCapture:d,setPointerCapture:p,releasePointerCapture:v},nativeEvent:a});if(o(b),!0===f.stopped)return"break"};for(d.s();!(e=d.n()).done&&"break"!==p(););}catch($Pe){d.e($Pe)}finally{d.f()}}()}(f,o,d,(function(e){var t=e.eventObject,n=t.__r3f,r=null==n?void 0:n.handlers;if(null!=n&&n.eventCount)if(l){if(r.onPointerOver||r.onPointerEnter||r.onPointerOut||r.onPointerLeave){var s=vDe(e),u=c.hovered.get(s);u?u.stopped&&e.stopPropagation():(c.hovered.set(s,e),null==r.onPointerOver||r.onPointerOver(e),null==r.onPointerEnter||r.onPointerEnter(e))}null==r.onPointerMove||r.onPointerMove(e)}else{var f=r[i];f?h&&!c.initialHits.includes(t)||(a(o,c.interaction.filter((function(e){return!c.initialHits.includes(e)}))),f(e)):h&&c.initialHits.includes(t)&&a(o,c.interaction.filter((function(e){return!c.initialHits.includes(e)})))}}))}}}}var yDe={},bDe=function(e){yDe=w3(w3({},yDe),e)};var xDe,kDe=function(e){return!(null==e||!e.render)},wDe=i.createContext(null);var _De,SDe,CDe=new Set,TDe=new Set,EDe=new Set;function IDe(e,t){e.forEach((function(e){return(0,e.callback)(t)}))}function ADe(e,t,n){var r=t.clock.getDelta();for("never"===t.frameloop&&"number"===typeof e&&(r=e-t.clock.elapsedTime,t.clock.oldTime=t.clock.elapsedTime,t.clock.elapsedTime=e),_De=t.internal.subscribers,xDe=0;xDe<_De.length;xDe++)(SDe=_De[xDe]).ref.current(SDe.store.getState(),r,n);return!t.internal.priority&&t.gl.render&&t.gl.render(t.scene,t.camera),t.internal.frames=Math.max(0,t.internal.frames-1),"always"===t.frameloop?1:t.internal.frames}function MDe(){var e=i.useContext(wDe);if(!e)throw"R3F hooks can only be used within the Canvas component!";return e}function NDe(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e},t=arguments.length>1?arguments[1]:void 0;return MDe()(e,t)}function RDe(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=MDe(),r=n.getState().internal.subscribe,a=QRe(e);return YRe((function(){return r(a,t,n)}),[t,r,n]),null}function DDe(e,t){return function(n){var r=new n;e&&e(r);for(var a=arguments.length,i=new Array(a>1?a-1:0),o=1;o<a;o++)i[o-1]=arguments[o];return Promise.all(i.map((function(e){return new Promise((function(n,a){return r.load(e,(function(e){e.scene&&Object.assign(e,rDe(e.scene)),n(e)}),t,(function(t){return a("Could not load ".concat(e,": ").concat(t.message))}))}))})))}}function PDe(e,t,n,r){var a=Array.isArray(t)?t:[t],i=function(e,t,n){return VRe(e,t,!1,n)}(DDe(n,r),[e].concat(Tt(a)),{equal:nDe.equ});return Array.isArray(t)?i:i[0]}PDe.preload=function(e,t,n){var r=Array.isArray(t)?t:[t];return function(e,t,n){VRe(e,t,!0,n)}(DDe(n),[e].concat(Tt(r)))},PDe.clear=function(e,t){var n=Array.isArray(t)?t:[t];return function(e){if(void 0===e||0===e.length)URe.splice(0,URe.length);else{var t=URe.find((function(t){return BRe(e,t.keys,t.equal)}));if(t){var n=URe.indexOf(t);-1!==n&&URe.splice(n,1)}}}([e].concat(Tt(n)))};var ODe=new Map,LDe=function(e){var t,n,r,a=!1;function i(o){if(n=requestAnimationFrame(i),a=!0,t=0,CDe.size&&IDe(CDe,o),e.forEach((function(e){var n;!(r=e.store.getState()).internal.active||!("always"===r.frameloop||r.internal.frames>0)||null!=(n=r.gl.xr)&&n.isPresenting||(t+=ADe(o,r))})),TDe.size&&IDe(TDe,o),0===t)return EDe.size&&IDe(EDe,o),a=!1,cancelAnimationFrame(n)}return{loop:i,invalidate:function t(n){var r,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(!n)return e.forEach((function(e){return t(e.store.getState())}),o);null!=(r=n.gl.xr)&&r.isPresenting||!n.internal.active||"never"===n.frameloop||(n.internal.frames=Math.min(60,n.internal.frames+o),a||(a=!0,requestAnimationFrame(i)))},advance:function(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=arguments.length>2?arguments[2]:void 0,a=arguments.length>3?arguments[3]:void 0;n&&IDe(CDe,t),r?ADe(t,r,a):e.forEach((function(e){return ADe(t,e.store.getState())})),n&&IDe(TDe,t)}}}(ODe),FDe=LDe.invalidate,zDe=LDe.advance,BDe=function(e,t){function n(e,t,n){var r,a=t.args,i=void 0===a?[]:a,o=t.attach,s=G4(t,jRe),u="".concat(e[0].toUpperCase()).concat(e.slice(1));if(void 0===o&&(u.endsWith("Geometry")?o="geometry":u.endsWith("Material")&&(o="material")),"primitive"===e){if(void 0===s.object)throw"Primitives without 'object' are invalid!";r=aDe(s.object,{type:e,root:n,attach:o,primitive:!0})}else{var c=yDe[u];if(!c)throw"".concat(u," is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively");if(!Array.isArray(i))throw"The args prop must be an array!";r=aDe(ur(c,Tt(i)),{type:e,root:n,attach:o,memoizedProps:{args:i}})}return"inject"!==u&&lDe(r,s),r}function r(e,t){var n,r,a=!1;t&&(null!=(n=t.__r3f)&&n.attach?sDe(e,t,t.__r3f.attach):t.isObject3D&&e.isObject3D&&(e.add(t),a=!0),a||null==(r=e.__r3f)||r.objects.push(t),t.__r3f||aDe(t,{}),t.__r3f.parent=e,fDe(t),hDe(t))}function a(e,t,n){var r=!1;if(t){var a,i;if(null!=(a=t.__r3f)&&a.attach)sDe(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){t.parent=e,t.dispatchEvent({type:"added"});var o=e.children.filter((function(e){return e!==t})),s=o.indexOf(n);e.children=[].concat(Tt(o.slice(0,s)),[t],Tt(o.slice(s))),r=!0}r||null==(i=e.__r3f)||i.objects.push(t),t.__r3f||aDe(t,{}),t.__r3f.parent=e,fDe(t),hDe(t)}}function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e&&Tt(e).forEach((function(e){return o(t,e,n)}))}function o(e,t,n){if(t){var r,a,o;if(t.__r3f&&(t.__r3f.parent=null),null!=(r=e.__r3f)&&r.objects&&(e.__r3f.objects=e.__r3f.objects.filter((function(e){return e!==t}))),null!=(a=t.__r3f)&&a.attach)uDe(e,t,t.__r3f.attach);else if(t.isObject3D&&e.isObject3D){var s;e.remove(t),null!=(s=t.__r3f)&&s.root&&function(e,t){var n=e.getState().internal;n.interaction=n.interaction.filter((function(e){return e!==t})),n.initialHits=n.initialHits.filter((function(e){return e!==t})),n.hovered.forEach((function(e,r){e.eventObject!==t&&e.object!==t||n.hovered.delete(r)})),n.capturedMap.forEach((function(e,r){mDe(n.capturedMap,t,e,r)}))}(t.__r3f.root,t)}var u,c=null==(o=t.__r3f)?void 0:o.primitive,l=void 0===n?null!==t.dispose&&!c:n;if(!c)i(null==(u=t.__r3f)?void 0:u.objects,t,l),i(t.children,t,l);t.__r3f&&(delete t.__r3f.root,delete t.__r3f.objects,delete t.__r3f.handlers,delete t.__r3f.memoizedProps,c||delete t.__r3f),l&&t.dispose&&"Scene"!==t.type&&(0,zRe.unstable_scheduleCallback)(zRe.unstable_IdlePriority,(function(){try{t.dispose()}catch(e){}})),hDe(e)}}return{reconciler:FRe()({createInstance:n,removeChild:o,appendChild:r,appendInitialChild:r,insertBefore:a,supportsMutation:!0,isPrimaryRenderer:!1,supportsPersistence:!1,supportsHydration:!1,noTimeout:-1,appendChildToContainer:function(e,t){var n=e.getState().scene;n.__r3f.root=e,r(n,t)},removeChildFromContainer:function(e,t){return o(e.getState().scene,t)},insertInContainerBefore:function(e,t,n){return a(e.getState().scene,t,n)},getRootHostContext:function(){return null},getChildHostContext:function(e){return e},finalizeInitialChildren:function(e){var t,n=null!=(t=null==e?void 0:e.__r3f)?t:{};return Boolean(n.handlers)},prepareUpdate:function(e,t,n,r){if(e.__r3f.primitive&&r.object&&r.object!==e)return[!0];var a=r.args,i=void 0===a?[]:a,o=(r.children,G4(r,qRe)),s=n.args,u=void 0===s?[]:s,c=(n.children,G4(n,HRe));if(!Array.isArray(i))throw"The args prop must be an array!";if(i.some((function(e,t){return e!==u[t]})))return[!0];var l=cDe(e,o,c,!0);return l.changes.length?[!1,l]:null},commitUpdate:function(e,t,a,i,s,u){var c=f(t,2),l=c[0],h=c[1];l?function(e,t,a,i){var s,u=null==(s=e.__r3f)?void 0:s.parent;if(u){var c=n(t,a,e.__r3f.root);"primitive"!==t&&e.children&&(e.children.forEach((function(e){return r(c,e)})),e.children=[]),e.__r3f.objects.forEach((function(e){return r(c,e)})),e.__r3f.objects=[],o(u,e),r(u,c),c.raycast&&c.__r3f.eventCount&&c.__r3f.root.getState().internal.interaction.push(c),[i,i.alternate].forEach((function(e){null!==e&&(e.stateNode=c,e.ref&&("function"===typeof e.ref?e.ref(c):e.ref.current=c))}))}}(e,a,s,u):lDe(e,h)},commitMount:function(e,t,n,r){var a,i=null!=(a=e.__r3f)?a:{};e.raycast&&i.handlers&&i.eventCount&&e.__r3f.root.getState().internal.interaction.push(e)},getPublicInstance:function(e){return e},prepareForCommit:function(){return null},preparePortalMount:function(e){return aDe(e.getState().scene)},resetAfterCommit:function(){},shouldSetTextContent:function(){return!1},clearContainer:function(){return!1},hideInstance:function(e){var t,n=null!=(t=null==e?void 0:e.__r3f)?t:{},r=n.attach,a=n.parent;r&&a&&uDe(a,e,r),e.isObject3D&&(e.visible=!1),hDe(e)},unhideInstance:function(e,t){var n,r=null!=(n=null==e?void 0:e.__r3f)?n:{},a=r.attach,i=r.parent;a&&i&&sDe(i,e,a),(e.isObject3D&&null==t.visible||t.visible)&&(e.visible=!0),hDe(e)},createTextInstance:function(){throw new Error("Text is not allowed in the R3F tree.")},hideTextInstance:function(){throw new Error("Text is not allowed in the R3F tree.")},unhideTextInstance:function(){},getCurrentEventPriority:function(){return t?t():DRe.DefaultEventPriority},beforeActiveInstanceBlur:function(){},afterActiveInstanceBlur:function(){},detachDeletedInstance:function(){},now:"undefined"!==typeof performance&&nDe.fun(performance.now)?performance.now:nDe.fun(Date.now)?Date.now:function(){return 0},scheduleTimeout:nDe.fun(setTimeout)?setTimeout:void 0,cancelTimeout:nDe.fun(clearTimeout)?clearTimeout:void 0}),applyProps:lDe}}(0,(function(){var e,t;switch(null==(e=window)||null==(t=e.event)?void 0:t.type){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return DRe.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return DRe.ContinuousEventPriority;default:return DRe.DefaultEventPriority}})),UDe=BDe.reconciler,VDe=BDe.applyProps,WDe={objects:"shallow",strict:!1},GDe=function(e,t){var n="function"===typeof e?e(t):e;return kDe(n)?n:new YTe(w3({powerPreference:"high-performance",canvas:t,antialias:!0,alpha:!0},e))};function jDe(e){var t=ODe.get(e),n=null==t?void 0:t.fiber,r=null==t?void 0:t.store;t&&console.warn("R3F.createRoot should only be called once!");var o,s="function"===typeof reportError?reportError:console.error,u=r||function(e,t){var n=function(e){var t="function"===typeof e?PRe(e):e,n=function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:t.getState,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Object.is,a=f((0,i.useReducer)((function(e){return e+1}),0),2)[1],o=t.getState(),s=(0,i.useRef)(o),u=(0,i.useRef)(n),c=(0,i.useRef)(r),l=(0,i.useRef)(!1),h=(0,i.useRef)();void 0===h.current&&(h.current=n(o));var d=!1;(s.current!==o||u.current!==n||c.current!==r||l.current)&&(e=n(o),d=!r(h.current,e)),ORe((function(){d&&(h.current=e),s.current=o,u.current=n,c.current=r,l.current=!1}));var p=(0,i.useRef)(o);ORe((function(){var e=function(){try{var e=t.getState(),n=u.current(e);c.current(h.current,n)||(s.current=e,h.current=n,a())}catch(r){l.current=!0,a()}},n=t.subscribe(e);return t.getState()!==p.current&&e(),n}),[]);var v=d?e:h.current;return(0,i.useDebugValue)(v),v};return Object.assign(n,t),n[Symbol.iterator]=function(){console.warn("[useStore, api] = create() is deprecated and will be removed in v4");var e=[n,t];return{next:function(){var t=e.length<=0;return{value:e.shift(),done:t}}}},n}((function(n,r){var a=new Yke,o=new Yke,s=new Yke;function u(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:r().camera,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:r().size,i=n.width,u=n.height,c=n.top,l=n.left,h=i/u;t instanceof Yke?s.copy(t):s.set.apply(s,Tt(t));var f=e.getWorldPosition(a).distanceTo(s);if(KRe(e))return{width:i/e.zoom,height:u/e.zoom,top:c,left:l,factor:1,distance:f,aspect:h};var d=e.fov*Math.PI/180,p=2*Math.tan(d/2)*f,v=p*(i/u);return{width:v,height:p,top:c,left:l,factor:i/v,distance:f,aspect:h}}var c=void 0,l=function(e){return n((function(t){return{performance:w3(w3({},t.performance),{},{current:e})}}))},h=new yke,f={set:n,get:r,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},xr:null,invalidate:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return e(r(),t)},advance:function(e,n){return t(e,n,r())},legacy:!1,linear:!1,flat:!1,scene:aDe(new eEe),controls:null,clock:new ZMe,pointer:h,mouse:h,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:function(){var e=r();c&&clearTimeout(c),e.performance.current!==e.performance.min&&l(e.performance.min),c=setTimeout((function(){return l(r().performance.max)}),e.performance.debounce)}},size:{width:0,height:0,top:0,left:0,updateStyle:!1},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:u},setEvents:function(e){return n((function(t){return w3(w3({},t),{},{events:w3(w3({},t.events),e)})}))},setSize:function(e,t,a,i,s){var c=r().camera,l={width:e,height:t,top:i||0,left:s||0,updateStyle:a};n((function(e){return{size:l,viewport:w3(w3({},e.viewport),u(c,o,l))}}))},setDpr:function(e){return n((function(t){var n=eDe(e);return{viewport:w3(w3({},t.viewport),{},{dpr:n,initialDpr:t.viewport.initialDpr||n})}}))},setFrameloop:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"always",t=r().clock;t.stop(),t.elapsedTime=0,"never"!==e&&(t.start(),t.elapsedTime=0),n((function(){return{frameloop:e}}))},previousRoot:void 0,internal:{active:!1,priority:0,frames:0,lastEvent:i.createRef(),interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,subscribe:function(e,t,n){var a=r().internal;return a.priority=a.priority+(t>0?1:0),a.subscribers.push({ref:e,priority:t,store:n}),a.subscribers=a.subscribers.sort((function(e,t){return e.priority-t.priority})),function(){var n=r().internal;null!=n&&n.subscribers&&(n.priority=n.priority-(t>0?1:0),n.subscribers=n.subscribers.filter((function(t){return t.ref!==e})))}}}};return f})),r=n.getState(),a=r.size,o=r.viewport.dpr,s=r.camera;return n.subscribe((function(){var e=n.getState(),t=e.camera,r=e.size,i=e.viewport,u=e.gl,c=e.set;r===a&&i.dpr===o||(a=r,o=i.dpr,dDe(t,r),u.setPixelRatio(i.dpr),u.setSize(r.width,r.height,r.updateStyle)),t!==s&&(s=t,c((function(e){return{viewport:w3(w3({},e.viewport),e.viewport.getCurrentViewport(t))}})))})),n.subscribe((function(t){return e(t)})),n}(FDe,zDe),c=n||UDe.createContainer(u,DRe.ConcurrentRoot,null,!1,null,"",s,null);t||ODe.set(e,{fiber:c,store:u});var l=!1;return{configure:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.gl,r=t.size,i=t.events,s=t.onCreated,c=t.shadows,h=void 0!==c&&c,f=t.linear,d=void 0!==f&&f,p=t.flat,v=void 0!==p&&p,m=t.legacy,g=void 0!==m&&m,y=t.orthographic,b=void 0!==y&&y,x=t.frameloop,k=void 0===x?"always":x,w=t.dpr,_=void 0===w?[1,2]:w,S=t.performance,C=t.raycaster,T=t.camera,E=t.onPointerMissed,I=u.getState(),A=I.gl;I.gl||I.set({gl:A=GDe(n,e)});var M=I.raycaster;M||I.set({raycaster:M=new ENe});var N=C||{},R=N.params,D=G4(N,XRe);if(nDe.equ(D,M,WDe)||VDe(M,w3({},D)),nDe.equ(R,M.params,WDe)||VDe(M,{params:w3(w3({},M.params),R)}),!I.camera){var P=T instanceof rSe,O=P?T:b?new ISe(0,0,0,0,.1,1e3):new aSe(75,0,.1,1e3);P||(O.position.z=5,T&&VDe(O,T),null!=T&&T.rotation||O.lookAt(0,0,0)),I.set({camera:O})}if(!I.xr){var L=function(e,t){var n=u.getState();"never"!==n.frameloop&&zDe(e,!0,n,t)},F=function(){var e=u.getState();e.gl.xr.enabled=e.gl.xr.isPresenting,e.gl.xr.setAnimationLoop(e.gl.xr.isPresenting?L:null),e.gl.xr.isPresenting||FDe(e)},z={connect:function(){var e=u.getState().gl;e.xr.addEventListener("sessionstart",F),e.xr.addEventListener("sessionend",F)},disconnect:function(){var e=u.getState().gl;e.xr.removeEventListener("sessionstart",F),e.xr.removeEventListener("sessionend",F)}};A.xr&&z.connect(),I.set({xr:z})}if(A.shadowMap){var B=nDe.boo(h);if(B&&A.shadowMap.enabled!==h||!nDe.equ(h,A.shadowMap,WDe)){var U=A.shadowMap.enabled;A.shadowMap.enabled=!!h,B?A.shadowMap.type=nye:Object.assign(A.shadowMap,h),U!==A.shadowMap.enabled&&(A.shadowMap.needsUpdate=!0)}}pDe(a,g,["ColorManagement","legacyMode"]);var V=d?wxe:_xe,W=v?Wye:Hye;return A.outputEncoding!==V&&(A.outputEncoding=V),A.toneMapping!==W&&(A.toneMapping=W),I.legacy!==g&&I.set((function(){return{legacy:g}})),I.linear!==d&&I.set((function(){return{linear:d}})),I.flat!==v&&I.set((function(){return{flat:v}})),!n||nDe.fun(n)||kDe(n)||nDe.equ(n,A,WDe)||VDe(A,n),i&&!I.events.handlers&&I.set({events:i(u)}),_&&I.viewport.dpr!==eDe(_)&&I.setDpr(_),r=r||(e.parentElement?{width:e.parentElement.clientWidth,height:e.parentElement.clientHeight,top:e.parentElement.clientTop,left:e.parentElement.clientLeft}:{width:0,height:0,top:0,left:0}),nDe.equ(r,I.size,WDe)||I.setSize(r.width,r.height,r.updateStyle,r.top,r.left),I.frameloop!==k&&I.setFrameloop(k),I.onPointerMissed||I.set({onPointerMissed:E}),S&&!nDe.equ(S,I.performance,WDe)&&I.set((function(e){return{performance:w3(w3({},e.performance),S)}})),o=s,l=!0,this},render:function(t){return l||this.configure(),UDe.updateContainer(i.createElement(qDe,{store:u,children:t,onCreated:o,rootElement:e}),c,null,(function(){})),u},unmount:function(){HDe(e)}}}function qDe(e){var t=e.store,n=e.children,r=e.onCreated,a=e.rootElement;return YRe((function(){var e=t.getState();e.set((function(e){return{internal:w3(w3({},e.internal),{},{active:!0})}})),r&&r(e),t.getState().events.connected||null==e.events.connect||e.events.connect(a)}),[]),i.createElement(wDe.Provider,{value:t},n)}function HDe(e,t){var n=ODe.get(e),r=null==n?void 0:n.fiber;if(r){var a=null==n?void 0:n.store.getState();a&&(a.internal.active=!1),UDe.updateContainer(null,r,null,(function(){a&&setTimeout((function(){try{var n,r,i,o;null==a.events.disconnect||a.events.disconnect(),null==(n=a.gl)||null==(r=n.renderLists)||null==r.dispose||r.dispose(),null==(i=a.gl)||null==i.forceContextLoss||i.forceContextLoss(),null!=(o=a.gl)&&o.xr&&a.xr.disconnect(),function(e){for(var t in e.dispose&&"Scene"!==e.type&&e.dispose(),e)null==t.dispose||t.dispose(),delete e[t]}(a),ODe.delete(e),t&&t(e)}catch(s){}}),500)}))}}UDe.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:i.version});i.unstable_act;var XDe=__webpack_require__(7494),KDe=__webpack_require__.n(XDe);function YDe(e){var t=void 0===e?{debounce:0,scroll:!1,offsetSize:!1}:e,n=t.debounce,r=t.scroll,a=t.polyfill,o=t.offsetSize,s=a||("undefined"===typeof window?Jn((function e(){$n(this,e)})):window.ResizeObserver);if(!s)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");var u=f((0,i.useState)({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),2),c=u[0],l=u[1],h=(0,i.useRef)({element:null,scrollContainers:null,resizeObserver:null,lastBounds:c}),d=n?"number"===typeof n?n:n.scroll:null,p=n?"number"===typeof n?n:n.resize:null,v=(0,i.useRef)(!1);(0,i.useEffect)((function(){return v.current=!0,function(){v.current=!1}}));var m=f((0,i.useMemo)((function(){var e=function(){if(h.current.element){var e=h.current.element.getBoundingClientRect(),t={left:e.left,top:e.top,width:e.width,height:e.height,bottom:e.bottom,right:e.right,x:e.x,y:e.y};h.current.element instanceof HTMLElement&&o&&(t.height=h.current.element.offsetHeight,t.width=h.current.element.offsetWidth),Object.freeze(t),v.current&&!JDe(h.current.lastBounds,t)&&l(h.current.lastBounds=t)}};return[e,p?KDe()(e,p):e,d?KDe()(e,d):e]}),[l,o,d,p]),3),g=m[0],y=m[1],b=m[2];function x(){h.current.scrollContainers&&(h.current.scrollContainers.forEach((function(e){return e.removeEventListener("scroll",b,!0)})),h.current.scrollContainers=null),h.current.resizeObserver&&(h.current.resizeObserver.disconnect(),h.current.resizeObserver=null)}function k(){h.current.element&&(h.current.resizeObserver=new s(b),h.current.resizeObserver.observe(h.current.element),r&&h.current.scrollContainers&&h.current.scrollContainers.forEach((function(e){return e.addEventListener("scroll",b,{capture:!0,passive:!0})})))}var w,_,S;return w=b,_=Boolean(r),(0,i.useEffect)((function(){if(_){var e=w;return window.addEventListener("scroll",e,{capture:!0,passive:!0}),function(){window.removeEventListener("scroll",e,!0)}}}),[w,_]),S=y,(0,i.useEffect)((function(){var e=S;return window.addEventListener("resize",e),function(){window.removeEventListener("resize",e)}}),[S]),(0,i.useEffect)((function(){x(),k()}),[r,b,y]),(0,i.useEffect)((function(){return x}),[]),[function(e){e&&e!==h.current.element&&(x(),h.current.element=e,h.current.scrollContainers=QDe(e),k())},c,g]}function QDe(e){var t=[];if(!e||e===document.body)return t;var n=window.getComputedStyle(e);return[n.overflow,n.overflowX,n.overflowY].some((function(e){return"auto"===e||"scroll"===e}))&&t.push(e),[].concat(t,Tt(QDe(e.parentElement)))}var ZDe=["x","y","top","bottom","left","right","width","height"],JDe=function(e,t){return ZDe.every((function(n){return e[n]===t[n]}))},$De=["children","fallback","resize","style","gl","events","shadows","linear","flat","legacy","orthographic","frameloop","dpr","performance","raycaster","camera","onPointerMissed","onCreated"],ePe={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function tPe(e){var t=gDe(e).handlePointer;return{priority:1,enabled:!0,compute:function(e,t,n){t.pointer.set(e.offsetX/t.size.width*2-1,-e.offsetY/t.size.height*2+1),t.raycaster.setFromCamera(t.pointer,t.camera)},connected:void 0,handlers:Object.keys(ePe).reduce((function(e,n){return w3(w3({},e),{},IE({},n,t(n)))}),{}),connect:function(t){var n,r=e.getState(),a=r.set,i=r.events;null==i.disconnect||i.disconnect(),a((function(e){return{events:w3(w3({},e.events),{},{connected:t})}})),Object.entries(null!=(n=i.handlers)?n:[]).forEach((function(e){var n=f(e,2),r=n[0],a=n[1],i=f(ePe[r],2),o=i[0],s=i[1];t.addEventListener(o,a,{passive:s})}))},disconnect:function(){var t,n=e.getState(),r=n.set,a=n.events;a.connected&&(Object.entries(null!=(t=a.handlers)?t:[]).forEach((function(e){var t=f(e,2),n=t[0],r=t[1];if(a&&a.connected instanceof HTMLElement){var i=f(ePe[n],1)[0];a.connected.removeEventListener(i,r)}})),r((function(e){return{events:w3(w3({},e.events),{},{connected:void 0})}})))}}}var nPe=i.forwardRef((function(e,t){var n=e.children,r=e.fallback,o=e.resize,s=e.style,u=e.gl,c=e.events,l=void 0===c?tPe:c,h=e.shadows,d=e.linear,p=e.flat,v=e.legacy,m=e.orthographic,g=e.frameloop,y=e.dpr,b=e.performance,x=e.raycaster,k=e.camera,w=e.onPointerMissed,_=e.onCreated,S=G4(e,$De);i.useMemo((function(){return bDe(a)}),[]);var C=f(YDe(w3({scroll:!0,debounce:{scroll:50,resize:0}},o)),2),T=C[0],E=C[1],I=i.useRef(null),A=i.useRef(null),M=f(i.useState(null),2),N=M[0],R=M[1];i.useImperativeHandle(t,(function(){return I.current}));var D=QRe(w),P=f(i.useState(!1),2),O=P[0],L=P[1],F=f(i.useState(!1),2),z=F[0],B=F[1];if(O)throw O;if(z)throw z;var U=i.useRef(null);return E.width>0&&E.height>0&&N&&(U.current||(U.current=jDe(N)),U.current.configure({gl:u,events:l,shadows:h,linear:d,flat:p,legacy:v,orthographic:m,frameloop:g,dpr:y,performance:b,raycaster:x,camera:k,size:E,onPointerMissed:function(){return null==D.current?void 0:D.current.apply(D,arguments)},onCreated:function(e){null==e.events.connect||e.events.connect(A.current),null==_||_(e)}}),U.current.render(i.createElement(JRe,{set:B},i.createElement(i.Suspense,{fallback:i.createElement(ZRe,{set:L})},n)))),YRe((function(){R(I.current)}),[]),i.useEffect((function(){if(N)return function(){return HDe(N)}}),[N]),i.createElement("div",He({ref:A,style:w3({position:"relative",width:"100%",height:"100%",overflow:"hidden"},s)},S),i.createElement("div",{ref:T,style:{width:"100%",height:"100%"}},i.createElement("canvas",{ref:I,style:{display:"block"}},r)))})),rPe=function(e,t){return(e%t+t)%t},aPe=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;$n(this,n),IE(ir(a=t.call(this)),"object",void 0),IE(ir(a),"domElement",void 0),IE(ir(a),"enabled",!0),IE(ir(a),"target",new Yke),IE(ir(a),"minDistance",0),IE(ir(a),"maxDistance",1/0),IE(ir(a),"minZoom",0),IE(ir(a),"maxZoom",1/0),IE(ir(a),"minPolarAngle",0),IE(ir(a),"maxPolarAngle",Math.PI),IE(ir(a),"minAzimuthAngle",-1/0),IE(ir(a),"maxAzimuthAngle",1/0),IE(ir(a),"enableDamping",!1),IE(ir(a),"dampingFactor",.05),IE(ir(a),"enableZoom",!0),IE(ir(a),"zoomSpeed",1),IE(ir(a),"enableRotate",!0),IE(ir(a),"rotateSpeed",1),IE(ir(a),"enablePan",!0),IE(ir(a),"panSpeed",1),IE(ir(a),"screenSpacePanning",!0),IE(ir(a),"keyPanSpeed",7),IE(ir(a),"autoRotate",!1),IE(ir(a),"autoRotateSpeed",2),IE(ir(a),"reverseOrbit",!1),IE(ir(a),"keys",{LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"}),IE(ir(a),"mouseButtons",{LEFT:Kge.ROTATE,MIDDLE:Kge.DOLLY,RIGHT:Kge.PAN}),IE(ir(a),"touches",{ONE:Yge.ROTATE,TWO:Yge.DOLLY_PAN}),IE(ir(a),"target0",void 0),IE(ir(a),"position0",void 0),IE(ir(a),"zoom0",void 0),IE(ir(a),"_domElementKeyEvents",null),IE(ir(a),"getPolarAngle",void 0),IE(ir(a),"getAzimuthalAngle",void 0),IE(ir(a),"setPolarAngle",void 0),IE(ir(a),"setAzimuthalAngle",void 0),IE(ir(a),"getDistance",void 0),IE(ir(a),"listenToKeyEvents",void 0),IE(ir(a),"saveState",void 0),IE(ir(a),"reset",void 0),IE(ir(a),"update",void 0),IE(ir(a),"connect",void 0),IE(ir(a),"dispose",void 0),a.object=e,a.domElement=r,a.target0=a.target.clone(),a.position0=a.object.position.clone(),a.zoom0=a.object instanceof aSe?a.object.zoom:1,a.getPolarAngle=function(){return f.phi},a.getAzimuthalAngle=function(){return f.theta},a.setPolarAngle=function(e){var t=rPe(e,2*Math.PI),n=f.phi;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);var r=Math.abs(t-n);2*Math.PI-r<r&&(t<n?t+=2*Math.PI:n+=2*Math.PI),d.phi=t-n,i.update()},a.setAzimuthalAngle=function(e){var t=rPe(e,2*Math.PI),n=f.theta;n<0&&(n+=2*Math.PI),t<0&&(t+=2*Math.PI);var r=Math.abs(t-n);2*Math.PI-r<r&&(t<n?t+=2*Math.PI:n+=2*Math.PI),d.theta=t-n,i.update()},a.getDistance=function(){return i.object.position.distanceTo(i.target)},a.listenToKeyEvents=function(e){e.addEventListener("keydown",Y),a._domElementKeyEvents=e},a.saveState=function(){i.target0.copy(i.target),i.position0.copy(i.object.position),i.zoom0=i.object instanceof aSe?i.object.zoom:1},a.reset=function(){i.target.copy(i.target0),i.object.position.copy(i.position0),i.object instanceof aSe&&(i.object.zoom=i.zoom0,i.object.updateProjectionMatrix()),i.dispatchEvent(o),i.update(),l=c.NONE},a.update=function(){var t=new Yke,n=(new Kke).setFromUnitVectors(e.up,new Yke(0,1,0)),r=n.clone().invert(),a=new Yke,s=new Kke,u=2*Math.PI;return function(){var e=i.object.position;t.copy(e).sub(i.target),t.applyQuaternion(n),f.setFromVector3(t),i.autoRotate&&l===c.NONE&&A(2*Math.PI/60/60*i.autoRotateSpeed),i.enableDamping?(f.theta+=d.theta*i.dampingFactor,f.phi+=d.phi*i.dampingFactor):(f.theta+=d.theta,f.phi+=d.phi);var g=i.minAzimuthAngle,y=i.maxAzimuthAngle;return isFinite(g)&&isFinite(y)&&(g<-Math.PI?g+=u:g>Math.PI&&(g-=u),y<-Math.PI?y+=u:y>Math.PI&&(y-=u),f.theta=g<=y?Math.max(g,Math.min(y,f.theta)):f.theta>(g+y)/2?Math.max(g,f.theta):Math.min(y,f.theta)),f.phi=Math.max(i.minPolarAngle,Math.min(i.maxPolarAngle,f.phi)),f.makeSafe(),f.radius*=p,f.radius=Math.max(i.minDistance,Math.min(i.maxDistance,f.radius)),!0===i.enableDamping?i.target.addScaledVector(v,i.dampingFactor):i.target.add(v),t.setFromSpherical(f),t.applyQuaternion(r),e.copy(i.target).add(t),i.object.lookAt(i.target),!0===i.enableDamping?(d.theta*=1-i.dampingFactor,d.phi*=1-i.dampingFactor,v.multiplyScalar(1-i.dampingFactor)):(d.set(0,0,0),v.set(0,0,0)),p=1,!!(m||a.distanceToSquared(i.object.position)>h||8*(1-s.dot(i.object.quaternion))>h)&&(i.dispatchEvent(o),a.copy(i.object.position),s.copy(i.object.quaternion),m=!1,!0)}}(),a.connect=function(e){e===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),i.domElement=e,i.domElement.style.touchAction="none",i.domElement.addEventListener("contextmenu",Q),i.domElement.addEventListener("pointerdown",j),i.domElement.addEventListener("pointercancel",X),i.domElement.addEventListener("wheel",K)},a.dispose=function(){var e,t,n,r,a,o;null===(e=i.domElement)||void 0===e||e.removeEventListener("contextmenu",Q),null===(t=i.domElement)||void 0===t||t.removeEventListener("pointerdown",j),null===(n=i.domElement)||void 0===n||n.removeEventListener("pointercancel",X),null===(r=i.domElement)||void 0===r||r.removeEventListener("wheel",K),null===(a=i.domElement)||void 0===a||a.ownerDocument.removeEventListener("pointermove",q),null===(o=i.domElement)||void 0===o||o.ownerDocument.removeEventListener("pointerup",H),null!==i._domElementKeyEvents&&i._domElementKeyEvents.removeEventListener("keydown",Y)};var i=ir(a),o={type:"change"},s={type:"start"},u={type:"end"},c={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},l=c.NONE,h=1e-6,f=new MNe,d=new MNe,p=1,v=new Yke,m=!1,g=new yke,y=new yke,b=new yke,x=new yke,k=new yke,w=new yke,_=new yke,S=new yke,C=new yke,T=[],E={};function I(){return Math.pow(.95,i.zoomSpeed)}function A(e){i.reverseOrbit?d.theta+=e:d.theta-=e}function M(e){i.reverseOrbit?d.phi+=e:d.phi-=e}var N=function(){var e=new Yke;return function(t,n){e.setFromMatrixColumn(n,0),e.multiplyScalar(-t),v.add(e)}}(),R=function(){var e=new Yke;return function(t,n){!0===i.screenSpacePanning?e.setFromMatrixColumn(n,1):(e.setFromMatrixColumn(n,0),e.crossVectors(i.object.up,e)),e.multiplyScalar(t),v.add(e)}}(),D=function(){var e=new Yke;return function(t,n){var r=i.domElement;if(r&&i.object instanceof aSe&&i.object.isPerspectiveCamera){var a=i.object.position;e.copy(a).sub(i.target);var o=e.length();o*=Math.tan(i.object.fov/2*Math.PI/180),N(2*t*o/r.clientHeight,i.object.matrix),R(2*n*o/r.clientHeight,i.object.matrix)}else r&&i.object instanceof ISe&&i.object.isOrthographicCamera?(N(t*(i.object.right-i.object.left)/i.object.zoom/r.clientWidth,i.object.matrix),R(n*(i.object.top-i.object.bottom)/i.object.zoom/r.clientHeight,i.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),i.enablePan=!1)}}();function P(e){i.object instanceof aSe&&i.object.isPerspectiveCamera?p/=e:i.object instanceof ISe&&i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom*e)),i.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function O(e){i.object instanceof aSe&&i.object.isPerspectiveCamera?p*=e:i.object instanceof ISe&&i.object.isOrthographicCamera?(i.object.zoom=Math.max(i.minZoom,Math.min(i.maxZoom,i.object.zoom/e)),i.object.updateProjectionMatrix(),m=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),i.enableZoom=!1)}function L(e){g.set(e.clientX,e.clientY)}function F(e){x.set(e.clientX,e.clientY)}function z(){if(1==T.length)g.set(T[0].pageX,T[0].pageY);else{var e=.5*(T[0].pageX+T[1].pageX),t=.5*(T[0].pageY+T[1].pageY);g.set(e,t)}}function B(){if(1==T.length)x.set(T[0].pageX,T[0].pageY);else{var e=.5*(T[0].pageX+T[1].pageX),t=.5*(T[0].pageY+T[1].pageY);x.set(e,t)}}function U(){var e=T[0].pageX-T[1].pageX,t=T[0].pageY-T[1].pageY,n=Math.sqrt(e*e+t*t);_.set(0,n)}function V(e){if(1==T.length)y.set(e.pageX,e.pageY);else{var t=$(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);y.set(n,r)}b.subVectors(y,g).multiplyScalar(i.rotateSpeed);var a=i.domElement;a&&(A(2*Math.PI*b.x/a.clientHeight),M(2*Math.PI*b.y/a.clientHeight)),g.copy(y)}function W(e){if(1==T.length)k.set(e.pageX,e.pageY);else{var t=$(e),n=.5*(e.pageX+t.x),r=.5*(e.pageY+t.y);k.set(n,r)}w.subVectors(k,x).multiplyScalar(i.panSpeed),D(w.x,w.y),x.copy(k)}function G(e){var t=$(e),n=e.pageX-t.x,r=e.pageY-t.y,a=Math.sqrt(n*n+r*r);S.set(0,a),C.set(0,Math.pow(S.y/_.y,i.zoomSpeed)),P(C.y),_.copy(S)}function j(e){if(!1!==i.enabled){var t,n;if(0===T.length)null===(t=i.domElement)||void 0===t||t.ownerDocument.addEventListener("pointermove",q),null===(n=i.domElement)||void 0===n||n.ownerDocument.addEventListener("pointerup",H);!function(e){T.push(e)}(e),"touch"===e.pointerType?function(e){switch(J(e),T.length){case 1:switch(i.touches.ONE){case Yge.ROTATE:if(!1===i.enableRotate)return;z(),l=c.TOUCH_ROTATE;break;case Yge.PAN:if(!1===i.enablePan)return;B(),l=c.TOUCH_PAN;break;default:l=c.NONE}break;case 2:switch(i.touches.TWO){case Yge.DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;i.enableZoom&&U(),i.enablePan&&B(),l=c.TOUCH_DOLLY_PAN;break;case Yge.DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;i.enableZoom&&U(),i.enableRotate&&z(),l=c.TOUCH_DOLLY_ROTATE;break;default:l=c.NONE}break;default:l=c.NONE}l!==c.NONE&&i.dispatchEvent(s)}(e):function(e){var t;switch(e.button){case 0:t=i.mouseButtons.LEFT;break;case 1:t=i.mouseButtons.MIDDLE;break;case 2:t=i.mouseButtons.RIGHT;break;default:t=-1}switch(t){case Kge.DOLLY:if(!1===i.enableZoom)return;!function(e){_.set(e.clientX,e.clientY)}(e),l=c.DOLLY;break;case Kge.ROTATE:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enablePan)return;F(e),l=c.PAN}else{if(!1===i.enableRotate)return;L(e),l=c.ROTATE}break;case Kge.PAN:if(e.ctrlKey||e.metaKey||e.shiftKey){if(!1===i.enableRotate)return;L(e),l=c.ROTATE}else{if(!1===i.enablePan)return;F(e),l=c.PAN}break;default:l=c.NONE}l!==c.NONE&&i.dispatchEvent(s)}(e)}}function q(e){!1!==i.enabled&&("touch"===e.pointerType?function(e){switch(J(e),l){case c.TOUCH_ROTATE:if(!1===i.enableRotate)return;V(e),i.update();break;case c.TOUCH_PAN:if(!1===i.enablePan)return;W(e),i.update();break;case c.TOUCH_DOLLY_PAN:if(!1===i.enableZoom&&!1===i.enablePan)return;!function(e){i.enableZoom&&G(e),i.enablePan&&W(e)}(e),i.update();break;case c.TOUCH_DOLLY_ROTATE:if(!1===i.enableZoom&&!1===i.enableRotate)return;!function(e){i.enableZoom&&G(e),i.enableRotate&&V(e)}(e),i.update();break;default:l=c.NONE}}(e):function(e){if(!1===i.enabled)return;switch(l){case c.ROTATE:if(!1===i.enableRotate)return;!function(e){y.set(e.clientX,e.clientY),b.subVectors(y,g).multiplyScalar(i.rotateSpeed);var t=i.domElement;t&&(A(2*Math.PI*b.x/t.clientHeight),M(2*Math.PI*b.y/t.clientHeight)),g.copy(y),i.update()}(e);break;case c.DOLLY:if(!1===i.enableZoom)return;!function(e){S.set(e.clientX,e.clientY),C.subVectors(S,_),C.y>0?P(I()):C.y<0&&O(I()),_.copy(S),i.update()}(e);break;case c.PAN:if(!1===i.enablePan)return;!function(e){k.set(e.clientX,e.clientY),w.subVectors(k,x).multiplyScalar(i.panSpeed),D(w.x,w.y),x.copy(k),i.update()}(e)}}(e))}function H(e){var t,n,r;(Z(e),0===T.length)&&(null===(t=i.domElement)||void 0===t||t.releasePointerCapture(e.pointerId),null===(n=i.domElement)||void 0===n||n.ownerDocument.removeEventListener("pointermove",q),null===(r=i.domElement)||void 0===r||r.ownerDocument.removeEventListener("pointerup",H));i.dispatchEvent(u),l=c.NONE}function X(e){Z(e)}function K(e){!1===i.enabled||!1===i.enableZoom||l!==c.NONE&&l!==c.ROTATE||(e.preventDefault(),i.dispatchEvent(s),function(e){e.deltaY<0?O(I()):e.deltaY>0&&P(I()),i.update()}(e),i.dispatchEvent(u))}function Y(e){!1!==i.enabled&&!1!==i.enablePan&&function(e){var t=!1;switch(e.code){case i.keys.UP:D(0,i.keyPanSpeed),t=!0;break;case i.keys.BOTTOM:D(0,-i.keyPanSpeed),t=!0;break;case i.keys.LEFT:D(i.keyPanSpeed,0),t=!0;break;case i.keys.RIGHT:D(-i.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),i.update())}(e)}function Q(e){!1!==i.enabled&&e.preventDefault()}function Z(e){delete E[e.pointerId];for(var t=0;t<T.length;t++)if(T[t].pointerId==e.pointerId)return void T.splice(t,1)}function J(e){var t=E[e.pointerId];void 0===t&&(t=new yke,E[e.pointerId]=t),t.set(e.pageX,e.pageY)}function $(e){var t=e.pointerId===T[0].pointerId?T[1]:T[0];return E[t.pointerId]}return void 0!==r&&a.connect(r),a.update(),a}return Jn(n)}(ike),iPe=["makeDefault","camera","regress","domElement","enableDamping","onChange","onStart","onEnd"],oPe=i.forwardRef((function(e,t){var n=e.makeDefault,r=e.camera,a=e.regress,o=e.domElement,s=e.enableDamping,u=void 0===s||s,c=e.onChange,l=e.onStart,h=e.onEnd,f=G4(e,iPe),d=NDe((function(e){return e.invalidate})),p=NDe((function(e){return e.camera})),v=NDe((function(e){return e.gl})),m=NDe((function(e){return e.events})),g=NDe((function(e){return e.set})),y=NDe((function(e){return e.get})),b=NDe((function(e){return e.performance})),x=r||p,k=o||m.connected||v.domElement,w=i.useMemo((function(){return new aPe(x)}),[x]);return RDe((function(){w.enabled&&w.update()}),-1),i.useEffect((function(){return w.connect(k),function(){w.dispose()}}),[k,a,w,d]),i.useEffect((function(){var e=function(e){d(),a&&b.regress(),c&&c(e)};return w.addEventListener("change",e),l&&w.addEventListener("start",l),h&&w.addEventListener("end",h),function(){l&&w.removeEventListener("start",l),h&&w.removeEventListener("end",h),w.removeEventListener("change",e)}}),[c,l,h,w,d]),i.useEffect((function(){if(n){var e=y().controls;return g({controls:w}),function(){return g({controls:e})}}}),[n,w]),i.createElement("primitive",He({ref:t,object:w,enableDamping:u},f))})),sPe={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tgl_FragColor = opacity * texel;","}"].join("\n")},uPe=function(){function e(){$n(this,e),IE(this,"enabled",!0),IE(this,"needsSwap",!0),IE(this,"clear",!1),IE(this,"renderToScreen",!1)}return Jn(e,[{key:"setSize",value:function(e,t){}},{key:"render",value:function(e,t,n,r,a){console.error("THREE.Pass: .render() must be implemented in derived pass.")}}]),e}(),cPe=function(){function e(t){$n(this,e),IE(this,"camera",new ISe(-1,1,1,-1,0,1)),IE(this,"geometry",new ySe(2,2)),IE(this,"mesh",void 0),this.mesh=new Q_e(this.geometry,t)}return Jn(e,[{key:"material",get:function(){return this.mesh.material},set:function(e){this.mesh.material=e}},{key:"dispose",value:function(){this.mesh.geometry.dispose()}},{key:"render",value:function(e){e.render(this.mesh,this.camera)}}]),e}(),lPe=function(e){tr(n,e);var t=sr(n);function n(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"tDiffuse";return $n(this,n),IE(ir(r=t.call(this)),"textureID",void 0),IE(ir(r),"uniforms",void 0),IE(ir(r),"material",void 0),IE(ir(r),"fsQuad",void 0),r.textureID=a,e instanceof nSe?(r.uniforms=e.uniforms,r.material=e):(r.uniforms=tSe.clone(e.uniforms),r.material=new nSe({defines:Object.assign({},e.defines),uniforms:r.uniforms,vertexShader:e.vertexShader,fragmentShader:e.fragmentShader})),r.fsQuad=new cPe(r.material),r}return Jn(n,[{key:"render",value:function(e,t,n){this.uniforms[this.textureID]&&(this.uniforms[this.textureID].value=n.texture),this.fsQuad.material=this.material,this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(t),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),this.fsQuad.render(e))}}]),n}(uPe),hPe=function(e){tr(n,e);var t=sr(n);function n(e,r){var a;return $n(this,n),IE(ir(a=t.call(this)),"scene",void 0),IE(ir(a),"camera",void 0),IE(ir(a),"inverse",void 0),a.scene=e,a.camera=r,a.clear=!0,a.needsSwap=!1,a.inverse=!1,a}return Jn(n,[{key:"render",value:function(e,t,n){var r,a,i=e.getContext(),o=e.state;o.buffers.color.setMask(!1),o.buffers.depth.setMask(!1),o.buffers.color.setLocked(!0),o.buffers.depth.setLocked(!0),this.inverse?(r=0,a=1):(r=1,a=0),o.buffers.stencil.setTest(!0),o.buffers.stencil.setOp(i.REPLACE,i.REPLACE,i.REPLACE),o.buffers.stencil.setFunc(i.ALWAYS,r,4294967295),o.buffers.stencil.setClear(a),o.buffers.stencil.setLocked(!0),e.setRenderTarget(n),this.clear&&e.clear(),e.render(this.scene,this.camera),e.setRenderTarget(t),this.clear&&e.clear(),e.render(this.scene,this.camera),o.buffers.color.setLocked(!1),o.buffers.depth.setLocked(!1),o.buffers.stencil.setLocked(!1),o.buffers.stencil.setFunc(i.EQUAL,1,4294967295),o.buffers.stencil.setOp(i.KEEP,i.KEEP,i.KEEP),o.buffers.stencil.setLocked(!0)}}]),n}(uPe),fPe=function(e){tr(n,e);var t=sr(n);function n(){var e;return $n(this,n),(e=t.call(this)).needsSwap=!1,e}return Jn(n,[{key:"render",value:function(e){e.state.buffers.stencil.setLocked(!1),e.state.buffers.stencil.setTest(!1)}}]),n}(uPe),dPe=function(){function e(t,n){if($n(this,e),IE(this,"renderer",void 0),IE(this,"_pixelRatio",void 0),IE(this,"_width",void 0),IE(this,"_height",void 0),IE(this,"renderTarget1",void 0),IE(this,"renderTarget2",void 0),IE(this,"writeBuffer",void 0),IE(this,"readBuffer",void 0),IE(this,"renderToScreen",void 0),IE(this,"passes",[]),IE(this,"copyPass",void 0),IE(this,"clock",void 0),this.renderer=t,void 0===n){var r={minFilter:ube,magFilter:ube,format:Tbe},a=t.getSize(new yke);this._pixelRatio=t.getPixelRatio(),this._width=a.width,this._height=a.height,(n=new Wke(this._width*this._pixelRatio,this._height*this._pixelRatio,r)).texture.name="EffectComposer.rt1"}else this._pixelRatio=1,this._width=n.width,this._height=n.height;this.renderTarget1=n,this.renderTarget2=n.clone(),this.renderTarget2.texture.name="EffectComposer.rt2",this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2,this.renderToScreen=!0,void 0===sPe&&console.error("THREE.EffectComposer relies on CopyShader"),void 0===lPe&&console.error("THREE.EffectComposer relies on ShaderPass"),this.copyPass=new lPe(sPe),this.clock=new ZMe}return Jn(e,[{key:"swapBuffers",value:function(){var e=this.readBuffer;this.readBuffer=this.writeBuffer,this.writeBuffer=e}},{key:"addPass",value:function(e){this.passes.push(e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}},{key:"insertPass",value:function(e,t){this.passes.splice(t,0,e),e.setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}},{key:"removePass",value:function(e){var t=this.passes.indexOf(e);-1!==t&&this.passes.splice(t,1)}},{key:"isLastEnabledPass",value:function(e){for(var t=e+1;t<this.passes.length;t++)if(this.passes[t].enabled)return!1;return!0}},{key:"render",value:function(e){void 0===e&&(e=this.clock.getDelta());for(var t=this.renderer.getRenderTarget(),n=!1,r=this.passes.length,a=0;a<r;a++){var i=this.passes[a];if(!1!==i.enabled){if(i.renderToScreen=this.renderToScreen&&this.isLastEnabledPass(a),i.render(this.renderer,this.writeBuffer,this.readBuffer,e,n),i.needsSwap){if(n){var o=this.renderer.getContext(),s=this.renderer.state.buffers.stencil;s.setFunc(o.NOTEQUAL,1,4294967295),this.copyPass.render(this.renderer,this.writeBuffer,this.readBuffer,e),s.setFunc(o.EQUAL,1,4294967295)}this.swapBuffers()}void 0!==hPe&&(i instanceof hPe?n=!0:i instanceof fPe&&(n=!1))}}this.renderer.setRenderTarget(t)}},{key:"reset",value:function(e){if(void 0===e){var t=this.renderer.getSize(new yke);this._pixelRatio=this.renderer.getPixelRatio(),this._width=t.width,this._height=t.height,(e=this.renderTarget1.clone()).setSize(this._width*this._pixelRatio,this._height*this._pixelRatio)}this.renderTarget1.dispose(),this.renderTarget2.dispose(),this.renderTarget1=e,this.renderTarget2=e.clone(),this.writeBuffer=this.renderTarget1,this.readBuffer=this.renderTarget2}},{key:"setSize",value:function(e,t){this._width=e,this._height=t;var n=this._width*this._pixelRatio,r=this._height*this._pixelRatio;this.renderTarget1.setSize(n,r),this.renderTarget2.setSize(n,r);for(var a=0;a<this.passes.length;a++)this.passes[a].setSize(n,r)}},{key:"setPixelRatio",value:function(e){this._pixelRatio=e,this.setSize(this._width,this._height)}}]),e}(),pPe=function(e){tr(n,e);var t=sr(n);function n(e,r,a,i){var o,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0;return $n(this,n),IE(ir(o=t.call(this)),"scene",void 0),IE(ir(o),"camera",void 0),IE(ir(o),"overrideMaterial",void 0),IE(ir(o),"clearColor",void 0),IE(ir(o),"clearAlpha",void 0),IE(ir(o),"clearDepth",!1),IE(ir(o),"_oldClearColor",new Oke),o.scene=e,o.camera=r,o.overrideMaterial=a,o.clearColor=i,o.clearAlpha=s,o.clear=!0,o.needsSwap=!1,o}return Jn(n,[{key:"render",value:function(e,t,n){var r,a=e.autoClear;e.autoClear=!1;var i=null;void 0!==this.overrideMaterial&&(i=this.scene.overrideMaterial,this.scene.overrideMaterial=this.overrideMaterial),this.clearColor&&(e.getClearColor(this._oldClearColor),r=e.getClearAlpha(),e.setClearColor(this.clearColor,this.clearAlpha)),this.clearDepth&&e.clearDepth(),e.setRenderTarget(this.renderToScreen?null:n),this.clear&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),e.render(this.scene,this.camera),this.clearColor&&e.setClearColor(this._oldClearColor,r),void 0!==this.overrideMaterial&&(this.scene.overrideMaterial=i),e.autoClear=a}}]),n}(uPe),vPe={uniforms:{tDiffuse:{value:null}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","\tvec4 tex = texture2D( tDiffuse, vUv );","\tgl_FragColor = LinearTosRGB( tex );","}"].join("\n")};var mPe=function(e){return function(t){e.forEach((function(e){"function"===typeof e?e(t):null!=e&&(e.current=t)}))}},gPe=["children","multisamping","renderIndex","disableRender","disableGamma","disableRenderPass","depthBuffer","stencilBuffer","anisotropy","encoding","type"],yPe=i.forwardRef((function(e,t){var n=e.children,r=e.multisamping,a=void 0===r?8:r,o=e.renderIndex,s=void 0===o?1:o,u=e.disableRender,c=e.disableGamma,l=e.disableRenderPass,h=e.depthBuffer,d=void 0===h||h,p=e.stencilBuffer,v=void 0!==p&&p,m=e.anisotropy,g=void 0===m?1:m,y=e.encoding,b=e.type,x=G4(e,gPe);i.useMemo((function(){return bDe({EffectComposer:dPe,RenderPass:pPe,ShaderPass:lPe})}),[]);var k=i.useRef(),w=NDe(),_=w.scene,S=w.camera,C=w.gl,T=w.size,E=w.viewport,I=f(i.useState((function(){var e=new Wke(T.width,T.height,{type:b||xbe,format:Tbe,encoding:y||C.outputEncoding,depthBuffer:d,stencilBuffer:v,anisotropy:g});return e.samples=a,e})),1)[0];i.useEffect((function(){var e,t;null==(e=k.current)||e.setSize(T.width,T.height),null==(t=k.current)||t.setPixelRatio(E.dpr)}),[C,T,E.dpr]),RDe((function(){var e;u||null==(e=k.current)||e.render()}),s);var A=[];return l||A.push(i.createElement("renderPass",{key:"renderpass",attach:"passes-".concat(A.length),args:[_,S]})),c||A.push(i.createElement("shaderPass",{attach:"passes-".concat(A.length),key:"gammapass",args:[vPe]})),i.Children.forEach(n,(function(e){e&&A.push(i.cloneElement(e,{key:A.length,attach:"passes-".concat(A.length)}))})),i.createElement("effectComposer",He({ref:mPe([t,k]),args:[C,I]},x),A)})),bPe={shaderID:"luminosityHighPass",uniforms:{tDiffuse:{value:null},luminosityThreshold:{value:1},smoothWidth:{value:1},defaultColor:{value:new Oke(0)},defaultOpacity:{value:0}},vertexShader:["varying vec2 vUv;","void main() {","\tvUv = uv;","\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform sampler2D tDiffuse;","uniform vec3 defaultColor;","uniform float defaultOpacity;","uniform float luminosityThreshold;","uniform float smoothWidth;","varying vec2 vUv;","void main() {","\tvec4 texel = texture2D( tDiffuse, vUv );","\tvec3 luma = vec3( 0.299, 0.587, 0.114 );","\tfloat v = dot( texel.xyz, luma );","\tvec4 outputColor = vec4( defaultColor.rgb, defaultOpacity );","\tfloat alpha = smoothstep( luminosityThreshold, luminosityThreshold + smoothWidth, v );","\tgl_FragColor = mix( outputColor, texel, alpha );","}"].join("\n")},xPe=function(e,t,n,r){this.strength=void 0!==t?t:1,this.radius=n,this.threshold=r,this.resolution=void 0!==e?new yke(e.x,e.y):new yke(256,256),this.clearColor=new Oke(0,0,0);var a={minFilter:ube,magFilter:ube,format:Tbe};this.renderTargetsHorizontal=[],this.renderTargetsVertical=[],this.nMips=5;var i=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2);this.renderTargetBright=new Wke(i,o,a),this.renderTargetBright.texture.name="UnrealBloomPass.bright",this.renderTargetBright.texture.generateMipmaps=!1;for(var s=0;s<this.nMips;s++){var u=new Wke(i,o,a);u.texture.name="UnrealBloomPass.h"+s,u.texture.generateMipmaps=!1,this.renderTargetsHorizontal.push(u);var c=new Wke(i,o,a);c.texture.name="UnrealBloomPass.v"+s,c.texture.generateMipmaps=!1,this.renderTargetsVertical.push(c),i=Math.round(i/2),o=Math.round(o/2)}void 0===bPe&&console.error("THREE.UnrealBloomPass relies on LuminosityHighPassShader");var l=bPe;this.highPassUniforms=tSe.clone(l.uniforms),this.highPassUniforms.luminosityThreshold.value=r,this.highPassUniforms.smoothWidth.value=.01,this.materialHighPassFilter=new nSe({uniforms:this.highPassUniforms,vertexShader:l.vertexShader,fragmentShader:l.fragmentShader,defines:{}}),this.separableBlurMaterials=[];for(var h=[3,5,7,9,11],f=(i=Math.round(this.resolution.x/2),o=Math.round(this.resolution.y/2),0);f<this.nMips;f++)this.separableBlurMaterials.push(this.getSeperableBlurMaterial(h[f])),this.separableBlurMaterials[f].uniforms.texSize.value=new yke(i,o),i=Math.round(i/2),o=Math.round(o/2);this.compositeMaterial=this.getCompositeMaterial(this.nMips),this.compositeMaterial.uniforms.blurTexture1.value=this.renderTargetsVertical[0].texture,this.compositeMaterial.uniforms.blurTexture2.value=this.renderTargetsVertical[1].texture,this.compositeMaterial.uniforms.blurTexture3.value=this.renderTargetsVertical[2].texture,this.compositeMaterial.uniforms.blurTexture4.value=this.renderTargetsVertical[3].texture,this.compositeMaterial.uniforms.blurTexture5.value=this.renderTargetsVertical[4].texture,this.compositeMaterial.uniforms.bloomStrength.value=t,this.compositeMaterial.uniforms.bloomRadius.value=.1,this.compositeMaterial.needsUpdate=!0;this.compositeMaterial.uniforms.bloomFactors.value=[1,.8,.6,.4,.2],this.bloomTintColors=[new Yke(1,1,1),new Yke(1,1,1),new Yke(1,1,1),new Yke(1,1,1),new Yke(1,1,1)],this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,void 0===sPe&&console.error("THREE.UnrealBloomPass relies on CopyShader");var d=sPe;this.copyUniforms=tSe.clone(d.uniforms),this.copyUniforms.opacity.value=1,this.materialCopy=new nSe({uniforms:this.copyUniforms,vertexShader:d.vertexShader,fragmentShader:d.fragmentShader,blending:hye,depthTest:!1,depthWrite:!1,transparent:!0}),this.enabled=!0,this.needsSwap=!1,this._oldClearColor=new Oke,this.oldClearAlpha=1,this.basic=new h_e,this.fsQuad=new cPe(null)};function kPe(){var e=NDe(),t=e.size,n=e.scene,r=e.camera,a=(0,i.useMemo)((function(){return new yke(t.width,t.height)}),[t]);return(0,Wt.jsxs)(yPe,{multisamping:8,renderIndex:1,disableGamma:!0,disableRenderPass:!0,children:[(0,Wt.jsx)("renderPass",{attachArray:"passes",scene:n,camera:r}),(0,Wt.jsx)("unrealBloomPass",{attachArray:"passes",args:[a,.5,.5,0]})]})}xPe.prototype=Object.assign(Object.create(uPe.prototype),{constructor:xPe,dispose:function(){for(var e=0;e<this.renderTargetsHorizontal.length;e++)this.renderTargetsHorizontal[e].dispose();for(var t=0;t<this.renderTargetsVertical.length;t++)this.renderTargetsVertical[t].dispose();this.renderTargetBright.dispose()},setSize:function(e,t){var n=Math.round(e/2),r=Math.round(t/2);this.renderTargetBright.setSize(n,r);for(var a=0;a<this.nMips;a++)this.renderTargetsHorizontal[a].setSize(n,r),this.renderTargetsVertical[a].setSize(n,r),this.separableBlurMaterials[a].uniforms.texSize.value=new yke(n,r),n=Math.round(n/2),r=Math.round(r/2)},render:function(e,t,n,r,a){e.getClearColor(this._oldClearColor),this.oldClearAlpha=e.getClearAlpha();var i=e.autoClear;e.autoClear=!1,e.setClearColor(this.clearColor,0),a&&e.state.buffers.stencil.setTest(!1),this.renderToScreen&&(this.fsQuad.material=this.basic,this.basic.map=n.texture,e.setRenderTarget(null),e.clear(),this.fsQuad.render(e)),this.highPassUniforms.tDiffuse.value=n.texture,this.highPassUniforms.luminosityThreshold.value=this.threshold,this.fsQuad.material=this.materialHighPassFilter,e.setRenderTarget(this.renderTargetBright),e.clear(),this.fsQuad.render(e);for(var o=this.renderTargetBright,s=0;s<this.nMips;s++)this.fsQuad.material=this.separableBlurMaterials[s],this.separableBlurMaterials[s].uniforms.colorTexture.value=o.texture,this.separableBlurMaterials[s].uniforms.direction.value=xPe.BlurDirectionX,e.setRenderTarget(this.renderTargetsHorizontal[s]),e.clear(),this.fsQuad.render(e),this.separableBlurMaterials[s].uniforms.colorTexture.value=this.renderTargetsHorizontal[s].texture,this.separableBlurMaterials[s].uniforms.direction.value=xPe.BlurDirectionY,e.setRenderTarget(this.renderTargetsVertical[s]),e.clear(),this.fsQuad.render(e),o=this.renderTargetsVertical[s];this.fsQuad.material=this.compositeMaterial,this.compositeMaterial.uniforms.bloomStrength.value=this.strength,this.compositeMaterial.uniforms.bloomRadius.value=this.radius,this.compositeMaterial.uniforms.bloomTintColors.value=this.bloomTintColors,e.setRenderTarget(this.renderTargetsHorizontal[0]),e.clear(),this.fsQuad.render(e),this.fsQuad.material=this.materialCopy,this.copyUniforms.tDiffuse.value=this.renderTargetsHorizontal[0].texture,a&&e.state.buffers.stencil.setTest(!0),this.renderToScreen?(e.setRenderTarget(null),this.fsQuad.render(e)):(e.setRenderTarget(n),this.fsQuad.render(e)),e.setClearColor(this._oldClearColor,this.oldClearAlpha),e.autoClear=i},getSeperableBlurMaterial:function(e){return new nSe({defines:{KERNEL_RADIUS:e,SIGMA:e},uniforms:{colorTexture:{value:null},texSize:{value:new yke(.5,.5)},direction:{value:new yke(.5,.5)}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"#include <common>\t\t\t\tvarying vec2 vUv;\n\t\t\t\tuniform sampler2D colorTexture;\n\t\t\t\tuniform vec2 texSize;\t\t\t\tuniform vec2 direction;\t\t\t\t\t\t\t\tfloat gaussianPdf(in float x, in float sigma) {\t\t\t\t\treturn 0.39894 * exp( -0.5 * x * x/( sigma * sigma))/sigma;\t\t\t\t}\t\t\t\tvoid main() {\n\t\t\t\t\tvec2 invSize = 1.0 / texSize;\t\t\t\t\tfloat fSigma = float(SIGMA);\t\t\t\t\tfloat weightSum = gaussianPdf(0.0, fSigma);\t\t\t\t\tvec3 diffuseSum = texture2D( colorTexture, vUv).rgb * weightSum;\t\t\t\t\tfor( int i = 1; i < KERNEL_RADIUS; i ++ ) {\t\t\t\t\t\tfloat x = float(i);\t\t\t\t\t\tfloat w = gaussianPdf(x, fSigma);\t\t\t\t\t\tvec2 uvOffset = direction * invSize * x;\t\t\t\t\t\tvec3 sample1 = texture2D( colorTexture, vUv + uvOffset).rgb;\t\t\t\t\t\tvec3 sample2 = texture2D( colorTexture, vUv - uvOffset).rgb;\t\t\t\t\t\tdiffuseSum += (sample1 + sample2) * w;\t\t\t\t\t\tweightSum += 2.0 * w;\t\t\t\t\t}\t\t\t\t\tgl_FragColor = vec4(diffuseSum/weightSum, 1.0);\n\t\t\t\t}"})},getCompositeMaterial:function(e){return new nSe({defines:{NUM_MIPS:e},uniforms:{blurTexture1:{value:null},blurTexture2:{value:null},blurTexture3:{value:null},blurTexture4:{value:null},blurTexture5:{value:null},dirtTexture:{value:null},bloomStrength:{value:1},bloomFactors:{value:null},bloomTintColors:{value:null},bloomRadius:{value:0}},vertexShader:"varying vec2 vUv;\n\t\t\t\tvoid main() {\n\t\t\t\t\tvUv = uv;\n\t\t\t\t\tgl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n\t\t\t\t}",fragmentShader:"varying vec2 vUv;\t\t\t\tuniform sampler2D blurTexture1;\t\t\t\tuniform sampler2D blurTexture2;\t\t\t\tuniform sampler2D blurTexture3;\t\t\t\tuniform sampler2D blurTexture4;\t\t\t\tuniform sampler2D blurTexture5;\t\t\t\tuniform sampler2D dirtTexture;\t\t\t\tuniform float bloomStrength;\t\t\t\tuniform float bloomRadius;\t\t\t\tuniform float bloomFactors[NUM_MIPS];\t\t\t\tuniform vec3 bloomTintColors[NUM_MIPS];\t\t\t\t\t\t\t\tfloat lerpBloomFactor(const in float factor) { \t\t\t\t\tfloat mirrorFactor = 1.2 - factor;\t\t\t\t\treturn mix(factor, mirrorFactor, bloomRadius);\t\t\t\t}\t\t\t\t\t\t\t\tvoid main() {\t\t\t\t\tgl_FragColor = bloomStrength * ( lerpBloomFactor(bloomFactors[0]) * vec4(bloomTintColors[0], 1.0) * texture2D(blurTexture1, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[1]) * vec4(bloomTintColors[1], 1.0) * texture2D(blurTexture2, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[2]) * vec4(bloomTintColors[2], 1.0) * texture2D(blurTexture3, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[3]) * vec4(bloomTintColors[3], 1.0) * texture2D(blurTexture4, vUv) + \t\t\t\t\t\t\t\t\t\t\t\t\t lerpBloomFactor(bloomFactors[4]) * vec4(bloomTintColors[4], 1.0) * texture2D(blurTexture5, vUv) );\t\t\t\t}"})}}),xPe.BlurDirectionX=new yke(1,0),xPe.BlurDirectionY=new yke(0,1),bDe({UnrealBloomPass:xPe});var wPe=function(e,t){return Math.random()*(t-e)+e};function _Pe(e){var t=e.yLoc,n=e.color,r=e.speed,a=(0,i.useRef)();return RDe((function(e){var n=e.clock.getElapsedTime();a.current.position.y=1*t,a.current.rotation.y=n*r})),(0,Wt.jsxs)("mesh",{ref:a,children:[(0,Wt.jsx)("boxGeometry",{attach:"geometry",args:[4,1,4]}),(0,Wt.jsx)("meshLambertMaterial",{color:n,attach:"material"})]})}var SPe,CPe,TPe,EPe,IPe,APe,MPe=function(){var e=(0,i.useMemo)((function(){for(var e=[],t=0;t<51;t++)e.push({yLoc:t-25,color:"hsl(".concat(wPe(0,360),", 100%, 75%)"),speed:wPe(0,wPe(1,3))*(Math.random()<.5?-1:1)});return e}),[]);return(0,Wt.jsx)(Hge,{children:(0,Wt.jsxs)(nPe,{shadows:!0,dpr:[1,2],gl:{alpha:!1,antialias:!1},camera:{fov:90,position:[0,0,10],near:1,far:5e3},children:[(0,Wt.jsx)("ambientLight",{intensity:.4}),(0,Wt.jsx)("pointLight",{position:[100,100,100],color:"#F6DA77",intensity:.5}),(0,Wt.jsx)("pointLight",{position:[-50,80,-100],color:"#AAF500",intensity:.3}),(0,Wt.jsx)("pointLight",{position:[100,-150,-100],color:"#FCFAD1",intensity:.5}),(0,Wt.jsx)(i.Suspense,{fallback:null,children:e.map((function(e,t){return(0,i.createElement)(_Pe,w3(w3({},e),{},{key:t}))}))}),(0,Wt.jsx)(oPe,{}),(0,Wt.jsx)(kPe,{})]})})},NPe=je.div(SPe||(SPe=Et(["\n  ",";\n  ",";\n  flex-direction: column;\n"])),Dt,Pt),RPe=(je.div(CPe||(CPe=Et([""]))),je.div(TPe||(TPe=Et([""]))),{recordingSeconds:0,initRecording:!1,mediaStream:null,mediaRecorder:null,audio:null});function DPe(){var e=f((0,i.useState)(RPe),2),t=e[0],n=e[1];function r(){return r=ns(es().mark((function e(){var t;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,navigator.mediaDevices.getUserMedia({audio:!0});case 3:t=e.sent,n((function(e){return w3(w3({},e),{},{initRecording:!0,mediaStream:t})})),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0);case 10:case"end":return e.stop()}}),e,null,[[0,7]])}))),r.apply(this,arguments)}(0,i.useEffect)((function(){var e=null;return t.initRecording?e=setInterval((function(){a.current.getByteFrequencyData(o.current),n((function(e){return w3(w3({},e),{},{recordingSeconds:e.recordingSeconds+.01})}))}),10):clearInterval(e),function(){return clearInterval(e)}}),[t.initRecording]),(0,i.useEffect)((function(){t.mediaStream&&(!function(e){s.apply(this,arguments)}(t.mediaStream),n((function(e){return w3(w3({},e),{},{mediaRecorder:new MediaRecorder(e.mediaStream)})})))}),[t.mediaStream]),(0,i.useEffect)((function(){var e=t.mediaRecorder;if(e&&"inactive"===e.state){var r=[];e.start(),e.ondataavailable=function(e){r.push(e.data)},e.onstop=function(e){var t=new Blob(r,{type:"audio/ogg; codecs=opus"});r=[];var a=URL.createObjectURL(t);n((function(e){return w3(w3({},e),{},{audio:a})}))}}return function(){e&&e.stream.getAudioTracks().forEach((function(e){return e.stop()}))}}),[t.mediaRecorder]);var a=(0,i.useRef)(),o=(0,i.useRef)();function s(){return s=ns(es().mark((function e(t){var n,r;return es().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:n=window.AudioContext||window.webkitAudioContext,r=new n,a.current=r.createAnalyser(),a.current.fftSize=512,o.current=new Uint8Array(a.current.frequencyBinCount),r.createMediaStreamSource(t).connect(a.current);case 9:case"end":return e.stop()}}),e)}))),s.apply(this,arguments)}return{recorderState:t,analyserRef:a,dataRef:o,startRecording:function(){return function(){return r.apply(this,arguments)}()},saveRecording:function(){return"inactive"!==(e=t.mediaRecorder).state&&e.stop(),void n((function(e){return w3(w3({},e),{},{initRecording:!1})}));var e}}}var PPe=je.div(EPe||(EPe=Et([""]))),OPe=je.div(IPe||(IPe=Et(["\n  width: 60px;\n  height: 60px;\n  border-radius: 50%;\n  background: #ff0000;\n  position: absolute;\n  ",";\n  transition: opacity 1s;\n"])),Dt),LPe=je.div(APe||(APe=Et(["\n  background: white;\n  width: 78%;\n  height: 18%;\n"]))),FPe=function(e,t){return Math.random()*(t-e)+e};var zPe,BPe,UPe=function(e){var t=e.data,n=f(qe(),2),r=n[0],a=n[1],o=(0,i.useMemo)((function(){return new Array(64).fill(0).map((function(e,t){return{left:FPe(0,r),top:FPe(0,a)}}))}),[]);return(0,Wt.jsx)(PPe,{children:o.map((function(e,n){return(0,Wt.jsx)(OPe,{style:{left:"".concat(e.left,"px"),top:"".concat(e.top,"px"),opacity:"".concat(.01*Math.max(t[4*n]-100,0))},children:(0,Wt.jsx)(LPe,{})},n)}))})},VPe=je.div(zPe||(zPe=Et([""]))),WPe=je.div(BPe||(BPe=Et(["\n  position: absolute;\n  font-size: 1rem;\n  color: red;\n  text-shadow: 0 0 0.3rem red;\n"]))),GPe=function(e,t){return Math.random()*(t-e)+e};var jPe,qPe,HPe=function(e){var t=e.data,n=f(qe(),2),r=n[0],a=n[1],o=(0,i.useMemo)((function(){return new Array(200).fill(0).map((function(e,t){return{left:GPe(0,r),top:GPe(0,a)}}))}),[]);return(0,Wt.jsx)(VPe,{children:o.map((function(e,n){return(0,Wt.jsx)(WPe,{style:{left:"".concat(e.left,"px"),top:"".concat(e.top,"px"),opacity:"".concat(t[n+36]>50?1:.1)},children:"No"},n)}))})};je.div(jPe||(jPe=Et([""]))),je.div(qPe||(qPe=Et(["\n  ",";\n  width: 300px;\n  height: 100px;\n  background: rgba(232, 79, 71, 0.6);\n  font-weight: extra-bold;\n  color: white;\n"])),Dt);var XPe,KPe=function(){var e=DPe(),t=e.recorderState,n=(e.analyserRef,e.dataRef),r=e.startRecording,a=e.saveRecording;return(0,Wt.jsxs)(NPe,{onClick:function(){t.initRecording?a():r()},children:[n&&n.current&&(0,Wt.jsx)(UPe,{data:n.current}),n&&n.current&&(0,Wt.jsx)(HPe,{data:n.current})]})},YPe=je.div(XPe||(XPe=Et(["\n  ",";\n  ",";\n  flex-direction: column;\n  position: relative;\n\n  font-family: Dior;\n\n  letter-spacing: -0.07rem;\n\n  h1 {\n    font-size: 4rem;\n    font-weight: bold;\n  }\n\n  p {\n    margin: 0;\n    font-size: 1.5rem;\n  }\n"])),Pt,Dt),QPe=function(e,t){return Math.random()*(t-e)+e};var ZPe=function(){var e=["B5","C6","E6","F#6","G6"],t=f((0,i.useState)(0),2),n=t[0],r=t[1];return(0,Wt.jsxs)(YPe,{onClick:function(){var t=new ete(Ree).toDestination(),a=One(),i=QPe(0,2),o=QPe(3,5);t.triggerAttack(e[n],a+i),t.triggerRelease(e[n],a+o),r((function(t){return(1+t)%e.length}))},children:[(0,Wt.jsx)("h1",{children:"Oasis"}),(0,Wt.jsx)("p",{children:"Opening Soon"})]})};var JPe=function(){var e=f(qe(),2),t=e[0],n=e[1];return(0,Wt.jsx)(Be,{theme:{windowWidth:t,windowHeight:n},children:(0,Wt.jsx)(wt,{basename:"/off-line",children:(0,Wt.jsxs)(xt,{children:[(0,Wt.jsx)(yt,{exact:!0,path:"/",default:!0,element:(0,Wt.jsx)(un,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/rating1",element:(0,Wt.jsx)(Kt,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/five-times-dostoevsky",element:(0,Wt.jsx)(un,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/confirmation",element:(0,Wt.jsx)(Un,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/instructions",element:(0,Wt.jsx)(Yi,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/rebellion",element:(0,Wt.jsx)(to,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/range-stars",element:(0,Wt.jsx)(so,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/vibration",element:(0,Wt.jsx)(ho,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/epsilon",element:(0,Wt.jsx)(bo,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/layout",element:(0,Wt.jsx)(Ao,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/controller",element:(0,Wt.jsx)(zo,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/modern-traveling",element:(0,Wt.jsx)(Xo,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/seconds",element:(0,Wt.jsx)($o,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/friendly-guide-to-enjoy-this-artwork",element:(0,Wt.jsx)(Qc,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/converter",element:(0,Wt.jsx)(nl,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/magenta-test",element:(0,Wt.jsx)(Age,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/happy-birthday",element:(0,Wt.jsx)(zge,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/bascilica",element:(0,Wt.jsx)(qge,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/square-pillars",element:(0,Wt.jsx)(MPe,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/opposition",element:(0,Wt.jsx)(KPe,{})}),(0,Wt.jsx)(yt,{exact:!0,path:"/oasis",element:(0,Wt.jsx)(ZPe,{})})]})})})};s.createRoot(document.getElementById("root")).render((0,Wt.jsx)(i.StrictMode,{children:(0,Wt.jsx)(JPe,{})}))}()})();
//# sourceMappingURL=main.57740425.js.map